<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Smart contract et Solidity</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="smart_contracts_chapter">Smart contract et Solidity</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>As we discussed in <a href="#intro_chapter">[intro_chapter]</a>, there are two different types of accounts in Ethereum: externally owned accounts (EOAs) and contract accounts. EOAs are controlled by users, often via software such as a wallet application that is external to the Ethereum platform. In contrast, contract accounts are controlled by program code (also commonly referred to as &#x201c;smart contracts&#x201d;) that is executed by the Ethereum Virtual Machine. In short, EOAs are simple accounts without any associated code or data storage, whereas contract accounts have both associated code and data storage. EOAs are controlled by transactions created and cryptographically signed with a private key in the "real world" external to and independent of the protocol, whereas contract accounts do not have private keys and so "control themselves" in the predetermined way prescribed by their smart contract code. Both types of accounts are identified by an Ethereum address. In this chapter, we will discuss contract accounts and the program code that controls them.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="smart_contracts_definition">Qu&#8217;est-ce qu&#8217;un smart contract ?</h3>
<div class="paragraph data-line-9">
<p>The term <em>smart contract</em> has been used over the years to describe a wide variety of different things. In the 1990s, cryptographer Nick Szabo coined the term and defined it as “a set of promises, specified in digital form, including protocols within which the parties perform on the other promises.” Since then, the concept of smart contracts has evolved, especially after the introduction of decentralized blockchain platforms with the invention of Bitcoin in 2009. In the context of Ethereum, the term is actually a bit of a misnomer, given that Ethereum smart contracts are neither smart nor legal contracts, but the term has stuck. In this book, we use the term “smart contracts” to refer to immutable computer programs that run deterministically in the context of an Ethereum Virtual Machine as part of the Ethereum network protocol&#x2014;i.e., on the decentralized Ethereum world computer.</p>
</div>
<div class="paragraph data-line-11">
<p>Let’s unpack that definition:</p>
</div>
<div class="dlist data-line-13">
<dl>
<dt class="hdlist1">Computer programs</dt>
<dd>
<p>Smart contracts are simply computer programs. The word &#x201c;contract&#x201d; has no legal meaning in this context.</p>
</dd>
<dt class="hdlist1">Immutable</dt>
<dd>
<p>Once deployed, the code of a smart contract cannot change. Unlike with traditional software, the only way to modify a smart contract is to deploy a new instance.</p>
</dd>
<dt class="hdlist1">Deterministic</dt>
<dd>
<p>The outcome of the execution of a smart contract is the same for everyone who runs it, given the context of the transaction that initiated its execution and the state of the Ethereum blockchain at the moment of execution.</p>
</dd>
<dt class="hdlist1">EVM context</dt>
<dd>
<p>Smart contracts operate with a very limited execution context. They can access their own state, the context of the transaction that called them, and some information about the most recent blocks.</p>
</dd>
<dt class="hdlist1">Decentralized world computer</dt>
<dd>
<p>The EVM runs as a local instance on every Ethereum node, but because all instances of the EVM operate on the same initial state and produce the same final state, the system as a whole operates as a single "world computer."</p>
</dd>
</dl>
</div>
</div>
<div class="sect2 data-line-29">
<h3 id="smart_contract_lifecycle">Cycle de vie d&#8217;un smart contract</h3>
<div class="paragraph data-line-31">
<p>Smart contracts are typically written in a high-level language, such as Solidity. But in order to run, they must be compiled to the low-level bytecode that runs in the EVM. Once compiled, they are deployed on the Ethereum platform using a special <em>contract creation</em> transaction, which is identified as such by being sent to the special contract creation address, namely 0x0 (see <a href="#contract_reg">[contract_reg]</a>). Each contract is identified by an Ethereum address, which is derived from the contract creation transaction as a function of the originating account and nonce. The Ethereum address of a contract can be used in a transaction as the recipient, sending funds to the contract or calling one of the contract’s functions. Note that, unlike with EOAs, there are no keys associated with an account created for a new smart contract. As the contract creator, you don&#8217;t get any special privileges at the protocol level (although you can explicitly code them into the smart contract). You certainly don&#8217;t receive the private key for the contract account, which in fact does not exist&#x2014;we can say that smart contract accounts own themselves.</p>
</div>
<div class="paragraph data-line-33">
<p>Importantly, contracts <em>only run if they are called by a transaction</em>. All smart contracts in Ethereum are executed, ultimately, because of a transaction initiated from an EOA. A contract can call another contract that can call another contract, and so on, but the first contract in such a chain of execution will always have been called by a transaction from an EOA. Contracts never run “on their own” or “in the background.” Contracts effectively lie dormant until a transaction triggers execution, either directly or indirectly as part of a chain of contract calls. It is also worth noting that smart contracts are not executed "in parallel" in any sense&#x2014;the Ethereum world computer can be considered to be a single-threaded machine.</p>
</div>
<div class="paragraph data-line-35">
<p>Transactions are <em>atomic</em>, regardless of how many contracts they call or what those contracts do when called. Transactions execute in their entirety, with any changes in the global state (contracts, accounts, etc.) recorded only if all execution terminates successfully. Successful termination means that the program executed without an error and reached the end of execution. If execution fails due to an error, all of its effects (changes in state) are “rolled back” as if the transaction never ran. A failed transaction is still recorded as having been attempted, and the ether spent on gas for the execution is deducted from the originating account, but it otherwise has no other effects on contract or account state.</p>
</div>
<div class="paragraph data-line-37">
<p>As mentioned previously, it is important to remember that a contract’s code cannot be changed. However, a contract can be “deleted,” removing the code and its internal state (storage) from its address, leaving a blank account. Any transactions sent to that account address after the contract has been deleted do not result in any code execution, because there is no longer any code there to execute. To delete a contract, you execute an EVM opcode called SELFDESTRUCT (previously called SUICIDE). That operation costs “negative gas,” a gas refund, thereby incentivizing the release of network client resources from the deletion of stored state. Deleting a contract in this way does not remove the transaction history (past) of the contract, since the blockchain itself is immutable. It is also important to note that the SELFDESTRUCT capability will only be available if the contract author programmed the smart contract to have that functionality. If the contract&#8217;s code does not have a SELFDESTRUCT opcode, or it is inaccessible, the smart contract cannot be deleted.</p>
</div>
</div>
<div class="sect2 data-line-40">
<h3 id="high_level_languages">Introduction aux langages de haut niveau Ethereum</h3>
<div class="paragraph data-line-42">
<p>The EVM is a virtual machine that runs a special form of code called <em>EVM bytecode</em>, analogous to your computer&#8217;s CPU, which runs machine code such as x86_64. We will examine the operation and language of the EVM in much more detail in <a href="#evm_chapter">[evm_chapter]</a>. In this section we will look at how smart contracts are written to run on the EVM.</p>
</div>
<div class="paragraph data-line-44">
<p>While it is possible to program smart contracts directly in bytecode, EVM bytecode is rather unwieldy and very difficult for programmers to read and understand. Instead, most Ethereum developers use a high-level language to write programs, and a compiler to convert them into bytecode.</p>
</div>
<div class="paragraph data-line-46">
<p>While any high-level language could be adapted to write smart contracts, adapting an arbitrary language to be compilable to EVM bytecode is quite a cumbersome exercise and would in general lead to some amount of confusion. Smart contracts operate in a highly constrained and minimalistic execution environment (the EVM). In addition, a special set of EVM-specific system variables and functions needs to be available. As such, it is easier to build a smart contract language from scratch than it is to make a general-purpose language suitable for writing smart contracts. As a result, a number of special-purpose languages have emerged for programming smart contracts. Ethereum has several such languages, together with the compilers needed to produce EVM-executable bytecode.</p>
</div>
<div class="paragraph data-line-48">
<p>In general, programming languages can be classified into two broad programming paradigms: <em>declarative</em> and <em>imperative</em>, also known as <em>functional</em> and <em>procedural</em>, respectively. In declarative programming, we write functions that express the <em>logic</em> of a program, but not its <em>flow</em>. Declarative programming is used to create programs where there are no <em>side effects</em>, meaning that there are no changes to state outside of a function. Declarative programming languages include Haskell and SQL. Imperative programming, by contrast, is where a programmer writes a set of procedures that combine the logic and flow of a program. Imperative programming languages include C++ and Java. Some languages are “hybrid,” meaning that they encourage declarative programming but can also be used to express an imperative programming paradigm. Such hybrids include Lisp, JavaScript, and Python. In general, any imperative language can be used to write in a declarative paradigm, but it often results in inelegant code. By comparison, pure declarative languages cannot be used to write in an imperative paradigm. In purely declarative languages, <em>there are no “variables.”</em></p>
</div>
<div class="paragraph data-line-50">
<p>While imperative programming is more commonly used by programmers, it can be very difficult to write programs that execute <em>exactly as expected</em>. The ability of any part of the program to change the state of any other makes it difficult to reason about a program’s execution and introduces many opportunities for bugs. Declarative programming, by comparison, makes it easier to understand how a program will behave: since it has no side effects, any part of a program can be understood in isolation.</p>
</div>
<div class="paragraph data-line-52">
<p>In smart contracts, bugs literally cost money. As a result, it is critically important to write smart contracts without unintended effects. To do that, you must be able to clearly reason about the expected behavior of the program. So, declarative languages play a much bigger role in smart contracts than they do in general-purpose software. Nevertheless, as you will see, the most widely used language for smart contracts (Solidity) is imperative. Programmers, like most humans, resist change!</p>
</div>
<div class="paragraph data-line-54">
<p>Currently supported high-level programming languages for smart contracts include (ordered by approximate age):</p>
</div>
<div class="dlist data-line-56">
<dl>
<dt class="hdlist1">LLL</dt>
<dd>
<p>A functional (declarative) programming language, with Lisp-like syntax. It was the first high-level language for Ethereum smart contracts but is rarely used today.</p>
</dd>
<dt class="hdlist1">Serpent</dt>
<dd>
<p>A procedural (imperative) programming language with a syntax similar to Python. Can also be used to write functional (declarative) code, though it is not entirely free of side effects.</p>
</dd>
<dt class="hdlist1">Solidity</dt>
<dd>
<p>A procedural (imperative) programming language with a syntax similar to JavaScript, C++, or Java. The most popular and frequently used language for Ethereum smart contracts.</p>
</dd>
<dt class="hdlist1">Vyper</dt>
<dd>
<p>A more recently developed language, similar to Serpent and again with Python-like syntax. Intended to get closer to a pure-functional Python-like language than Serpent, but not to replace Serpent.</p>
</dd>
<dt class="hdlist1">Bamboo</dt>
<dd>
<p>A newly developed language, influenced by Erlang, with explicit state transitions and without iterative flows (loops). Intended to reduce side effects and increase auditability. Very new and yet to be widely adopted.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-66">
<p>As you can see, there are many languages to choose from. However, of all of these Solidity is by far the most popular, to the point of being the <em>de facto</em> high-level language of Ethereum and even other EVM-like blockchains. We will spend most of our time using Solidity, but will also explore some of the examples in other high-level languages to gain an understanding of their different philosophies.</p>
</div>
</div>
<div class="sect2 data-line-69">
<h3 id="building_a_smart_contract_sec">Construire un contrat intelligent avec Solidity</h3>
<div class="paragraph data-line-71">
<p>Solidity was created by Dr. Gavin Wood (coauthor of this book) as a language explicitly for writing smart contracts with features to directly support execution in the decentralized environment of the Ethereum world computer. The resulting attributes are quite general, and so it has ended up being used for coding smart contracts on several other blockchain platforms. It was developed by Christian Reitiwessner and then also by Alex Beregszaszi, Liana Husikyan, Yoichi Hirai, and several former Ethereum core contributors. Solidity is now developed and maintained as an independent project <a href="https://github.com/ethereum/solidity" data-href="https://github.com/ethereum/solidity">on GitHub</a>.</p>
</div>
<div class="paragraph data-line-73">
<p>The main "product" of the Solidity project is the Solidity compiler, solc, which converts programs written in the Solidity language to EVM bytecode. The project also manages the important application binary interface (ABI) standard for Ethereum smart contracts, which we will explore in detail in this chapter. Each version of the Solidity compiler corresponds to and compiles a specific version of the Solidity <span class="keep-together">language</span>.</p>
</div>
<div class="paragraph data-line-75">
<p>To get started, we will download a binary executable of the Solidity compiler. Then we will develop and compile a simple contract, following on from the example we started with in <a href="#intro_chapter">[intro_chapter]</a>.</p>
</div>
<div class="sect3 data-line-77">
<h4 id="_sélection_dune_version_de_solidity">Sélection d&#8217;une version de Solidity</h4>
<div class="paragraph data-line-79">
<p>Solidity follows a versioning model called <a href="https://semver.org/" data-href="https://semver.org/"><em>semantic versioning</em></a>, which specifies version numbers structured as three numbers separated by dots: <em>MAJOR.MINOR.PATCH</em>. The "major" number is incremented for major and <em>backward-incompatible</em> changes, the "minor" number is incremented as backward-compatible features are added in between major releases, and the "patch" number is incremented for backward-compatible bug fixes.</p>
</div>
<div class="paragraph data-line-81">
<p>At the time of writing, Solidity is at version 0.4.24.  The rules for major version 0, which is for initial development of a project, are different: anything may change at any time. In practice, Solidity treats the "minor" number as if it were the major version and the "patch" number as if it were the minor version. Therefore, in 0.4.24, 4 is considered to be the major version and 24 the minor version.</p>
</div>
<div class="paragraph data-line-83">
<p>The 0.5 major version release of Solidity is anticipated imminently.</p>
</div>
<div class="paragraph data-line-85">
<p>As you saw in <a href="#intro_chapter">[intro_chapter]</a>, your Solidity programs can contain a pragma directive that specifies the minimum and maximum versions of Solidity that it is compatible with, and can be used to compile your contract.</p>
</div>
<div class="paragraph data-line-87">
<p>Since Solidity is rapidly evolving, it is often better to install the latest release.</p>
</div>
</div>
<div class="sect3 data-line-89">
<h4 id="_téléchargement_et_installation">Téléchargement et installation</h4>
<div class="paragraph data-line-91">
<p>There are a number of methods you can use to download and install Solidity, either as a binary release or by compiling from source code. You can find detailed instructions in <a href="http://bit.ly/2RrZmup" data-href="http://bit.ly/2RrZmup">the Solidity documentation</a>.</p>
</div>
<div class="paragraph data-line-93">
<p>Here&#8217;s how to install the latest binary release of Solidity on an Ubuntu/Debian operating system, using the apt package manager:</p>
</div>
<pre data-type="programlisting">
$ <strong>sudo add-apt-repository ppa:ethereum/ethereum</strong>
$ <strong>sudo apt update</strong>
$ <strong>sudo apt install solc</strong>
</pre>
<div class="paragraph data-line-103">
<p>Once you have solc installed, check the version by running:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --version</strong>
solc, the solidity compiler commandline interface
Version: 0.4.24+commit.e67f0147.Linux.g++
</pre>
<div class="paragraph data-line-113">
<p>There are a number of other ways to install Solidity, depending on your operating system and requirements, including compiling from the source code directly. For more information see <a href="https://github.com/ethereum/solidity" class="undefined" data-href="https://github.com/ethereum/solidity">https://github.com/ethereum/solidity</a>.</p>
</div>
</div>
<div class="sect3 data-line-117">
<h4 id="_environnement_de_développement">Environnement de développement</h4>
<div class="paragraph data-line-119">
<p>To develop in Solidity, you can use any text editor and solc on the command line. However, you might find that some text editors designed for development, such as Emacs, Vim, and Atom, offer additional features such as syntax highlighting and macros that make Solidity development easier.</p>
</div>
<div class="paragraph data-line-121">
<p>There are also web-based development environments, such as <a href="https://remix.ethereum.org/" data-href="https://remix.ethereum.org/">Remix IDE</a> and <a href="https://ethfiddle.com/" data-href="https://ethfiddle.com/">EthFiddle</a>.</p>
</div>
<div class="paragraph data-line-123">
<p>Use the tools that make you productive. In the end, Solidity programs are just plain text files. While fancy editors and development environments can make things easier, you don&#8217;t need anything more than a simple text editor, such as nano (Linux/Unix), TextEdit (macOS), or even NotePad (Windows). Simply save your program source code with a <em>.sol</em> extension and it will be recognized by the Solidity compiler as a Solidity program.</p>
</div>
</div>
<div class="sect3 data-line-125">
<h4 id="_écriture_dun_premier_programme_solidity">Écriture d&#8217;un premier programme Solidity</h4>
<div class="paragraph data-line-127">
<p>In <a href="#intro_chapter">[intro_chapter]</a>, we wrote our first Solidity program.  When we first built the Faucet contract, we used the Remix IDE to compile and deploy the contract. In this section, we will revisit, improve, and embellish Faucet.</p>
</div>
<div class="paragraph data-line-129">
<p>Our first attempt looked like <a href="#original_sol_faucet">Faucet.sol: Un contrat Solidity définissant un faucet</a>.</p>
</div>
<div id="original_sol_faucet" class="exampleblock data-line-133">
<div class="title">Example 1. Faucet.sol: Un contrat Solidity définissant un faucet</div>
<div class="content">
<div class="listingblock data-line-135">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity 0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-140">
<h4 id="_compiler_avec_le_compilateur_solidity_solc">Compiler avec le compilateur Solidity (solc)</h4>
<div class="paragraph data-line-142">
<p>Now, we will use the Solidity compiler on the command line to compile our contract directly. The Solidity compiler solc offers a variety of options, which you can see by passing the --help argument.</p>
</div>
<div class="paragraph data-line-144">
<p>We use the --bin and --optimize arguments of solc to produce an optimized binary of our example contract:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --optimize --bin Faucet.sol</strong>
======= Faucet.sol:Faucet =======
Binary:
6060604052341561000f57600080fd5b60cf8061001d6000396000f300606060405260043610603e5
763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416
632e1a7d4d81146040575b005b3415604a57600080fd5b603e60043567016345785d8a00008111156
06357600080fd5b73ffffffffffffffffffffffffffffffffffffffff331681156108fc0282604051
600060405180830381858888f19350505050151560a057600080fd5b505600a165627a7a723058203
556d79355f2da19e773a9551e95f1ca7457f2b5fbbf4eacf7748ab59d2532130029
</pre>
<div class="paragraph data-line-162">
<p>The result that solc produces is a hex-serialized binary that can be submitted to the Ethereum blockchain.</p>
</div>
</div>
</div>
<div class="sect2 data-line-165">
<h3 id="eth_contract_abi_sec">Le contrat Ethereum ABI</h3>
<div class="paragraph data-line-167">
<p>In computer software, an <em>application binary interface</em> is an interface between two program modules; often, between the operating system and user programs. An ABI defines how data structures and functions are accessed in <em>machine code</em>; this is not to be confused with an API, which defines this access in high-level, often human-readable formats as <em>source code</em>. The ABI is thus the primary way of encoding and decoding data into and out of machine code.</p>
</div>
<div class="paragraph data-line-169">
<p>In Ethereum, the ABI is used to encode contract calls for the EVM and to read data out of transactions. The purpose of an ABI is to define the functions in the contract that can be invoked and describe how each function will accept arguments and return its result.</p>
</div>
<div class="paragraph data-line-171">
<p>A contract&#8217;s ABI is specified as a JSON array of function descriptions (see <a href="#solidity_functions">Fonctions</a>) and events (see <a href="#solidity_events">Événements</a>). A function description is a JSON object with fields <code>type</code>, <code>name</code>, <code>inputs</code>, <code>outputs</code>, <code>constant</code>, and <code>payable</code>. An event description object has fields <code>type</code>, <code>name</code>, <code>inputs</code>, and <code>anonymous</code>.</p>
</div>
<div class="paragraph data-line-173">
<p>We use the solc command-line Solidity compiler to produce the ABI for our <span class="keep-together"><em>Faucet.sol</em></span> example contract:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --abi Faucet.sol</strong>
======= Faucet.sol:Faucet =======
Contract JSON ABI
[{"constant":false,"inputs":[{"name":"withdraw_amount","type":"uint256"}], \
"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable", \
"type":"function"},{"payable":true,"stateMutability":"payable", \
"type":"fallback"}]
</pre>
<div class="paragraph data-line-187">
<p>As you can see, the compiler produces a JSON array describing the two functions that are defined by <em>Faucet.sol</em>. This JSON can be used by any application that wants to access the Faucet contract once it is deployed. Using the ABI, an application such as a wallet or DApp browser can construct transactions that call the functions in Faucet with the correct arguments and argument types. For example, a wallet would know that to call the function withdraw it would have to provide a uint256 argument named withdraw_amount. The wallet could prompt the user to provide that value, then create a transaction that encodes it and executes the withdraw function.</p>
</div>
<div class="paragraph data-line-189">
<p>All that is needed for an application to interact with a contract is an ABI and the address where the contract has been deployed.</p>
</div>
<div class="sect3 data-line-192">
<h4 id="solidity_pragma">Choix d&#8217;un compilateur Solidity et d&#8217;une version de langage</h4>
<div class="paragraph data-line-194">
<p>As we saw in the previous code, our Faucet contract compiles successfully with Solidity version 0.4.21. But what if we had used a different version of the Solidity compiler? The language is still in constant flux and things may change in unexpected ways. Our contract is fairly simple, but what if our program used a feature that was only added in Solidity version 0.4.19 and we tried to compile it with 0.4.18?</p>
</div>
<div class="paragraph data-line-196">
<p>To resolve such issues, Solidity offers a <em>compiler directive</em> known as a <em>version pragma</em> that instructs the compiler that the program expects a specific compiler (and language) version. Let’s look at an example:</p>
</div>
<div id="compiler_version" class="listingblock data-line-199">
<div class="content">
<pre>pragma solidity ^0.4.19;</pre>
</div>
</div>
<div class="paragraph data-line-203">
<p>The Solidity compiler reads the version pragma and will produce an error if the compiler version is incompatible with the version pragma. In this case, our version pragma says that this program can be compiled by a Solidity compiler with a minimum version of 0.4.19. The symbol ^ states, however, that we allow compilation with any <em>minor revision</em> above 0.4.19; e.g., 0.4.20, but not 0.5.0 (which is a major revision, not a minor revision). Pragma directives are not compiled into EVM bytecode. They are only used by the compiler to check compatibility.</p>
</div>
<div class="paragraph data-line-205">
<p>Let’s add a pragma directive to our Faucet contract. We will name the new file <span class="keep-together"><em>Faucet2.sol</em></span>, to keep track of our changes as we proceed through these examples starting in <a href="#add_pragma_to_faucet">Faucet2.sol: Adding the version pragma to Faucet</a>.</p>
</div>
<div id="add_pragma_to_faucet" class="exampleblock data-line-209">
<div class="title">Example 2. Faucet2.sol: Adding the version pragma to Faucet</div>
<div class="content">
<div class="listingblock data-line-211">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity ^0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-216">
<p>Adding a version pragma is a best practice, as it avoids problems with mismatched compiler and language versions. We will explore other best practices and continue to improve the Faucet contract throughout this chapter.</p>
</div>
</div>
</div>
<div class="sect2 data-line-218">
<h3 id="_programmer_avec_solidity">Programmer avec Solidity</h3>
<div class="paragraph data-line-220">
<p>In this section, we will look at some of the capabilities of the Solidity language. As we mentioned in <a href="#intro_chapter">[intro_chapter]</a>, our first contract example was very simple and also flawed in various ways. We&#8217;ll gradually improve it here, while exploring how to use Solidity. This won&#8217;t be a comprehensive Solidity tutorial, however, as Solidity is quite complex and rapidly evolving. We&#8217;ll cover the basics and give you enough of a foundation to be able to explore the rest on your own. The documentation for Solidity can be found
<a href="https://solidity.readthedocs.io/en/latest/" data-href="https://solidity.readthedocs.io/en/latest/">on the project website</a>.</p>
</div>
<div class="sect3 data-line-223">
<h4 id="_types_de_données">Types de données</h4>
<div class="paragraph data-line-225">
<p>First, let&#8217;s look at some of the basic data types offered in Solidity:</p>
</div>
<div class="dlist data-line-227">
<dl>
<dt class="hdlist1">Boolean (bool)</dt>
<dd>
<p>Valeur booléenne, true ou false, avec les opérateurs logiques ! (not), &amp;&amp; (and), || (or), == (equal), and != (not equal).</p>
</dd>
<dt class="hdlist1">Integer (int, uint)</dt>
<dd>
<p>Signed (int) and unsigned (uint) integers, declared in increments of 8 bits from int8 to uint256. Without a size suffix, 256-bit quantities are used, to match the word size of the EVM.</p>
</dd>
<dt class="hdlist1">Fixed point (fixed, ufixed)</dt>
<dd>
<p>Fixed-point numbers, declared with (<code>u</code>)<code>fixed<em>M</em>x<em>N</em></code> where <em>M</em> is the size in bits (increments of 8 up to 256) and <em>N</em> is the number of decimals after the point (up to 18); e.g., ufixed32x2.</p>
</dd>
<dt class="hdlist1">Address</dt>
<dd>
<p>A 20-byte Ethereum address. The address object has many helpful member functions, the main ones being balance (returns the account balance) and <span class="keep-together"><code>transfer</code></span> (transfers ether to the account).</p>
</dd>
<dt class="hdlist1">Byte array (fixed)</dt>
<dd>
<p>Fixed-size arrays of bytes, declared with bytes1 up to bytes32.</p>
</dd>
<dt class="hdlist1">Byte array (dynamic)</dt>
<dd>
<p>Variable-sized arrays of bytes, declared with bytes or string.</p>
</dd>
<dt class="hdlist1">Enum</dt>
<dd>
<p>User-defined type for enumerating discrete values: enum NAME {LABEL1, LABEL 2, ...}.</p>
</dd>
<dt class="hdlist1">Arrays</dt>
<dd>
<p>An array of any type, either fixed or dynamic: uint32[][5] is a fixed-size array of five dynamic arrays of unsigned integers.</p>
</dd>
<dt class="hdlist1">Struct</dt>
<dd>
<p>User-defined data containers for grouping variables: <code>struct NAME {TYPE1 <span class="keep-together">VARIABLE1</span>; TYPE2 VARIABLE2; ...}</code>.</p>
</dd>
<dt class="hdlist1">Mapping</dt>
<dd>
<p>Hash lookup tables for <em>key</em> =&gt; <em>value</em> pairs: mapping(KEY_TYPE =&gt; VALUE_TYPE) NAME.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-247">
<p>In addition to these data types, Solidity also offers a variety of value literals that can be used to calculate different units:</p>
</div>
<div class="dlist data-line-249">
<dl>
<dt class="hdlist1">Time units</dt>
<dd>
<p>The units seconds, minutes, hours, and days can be used as suffixes, converting to multiples of the base unit seconds.</p>
</dd>
<dt class="hdlist1">Ether units</dt>
<dd>
<p>The units wei, finney, szabo, and ether can be used as suffixes, converting to multiples of the base unit wei.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-253">
<p>In our Faucet contract example, we used a uint (which is an alias for uint256) for the withdraw_amount variable. We also indirectly used an address variable, which we set with msg.sender. We will use more of these data types in our examples in the rest of this chapter.</p>
</div>
<div class="paragraph data-line-255">
<p>Let&#8217;s use one of the unit multipliers to improve the readability of our example contract. In the withdraw function we limit the maximum withdrawal, expressing the limit in wei, the base unit of ether:</p>
</div>
<div class="listingblock data-line-257">
<div class="content">
<pre>require(withdraw_amount &lt;= 100000000000000000);</pre>
</div>
</div>
<div class="paragraph data-line-261">
<p>That&#8217;s not very easy to read. We can improve our code by using the unit multiplier ether, to express the value in ether instead of wei:</p>
</div>
<div class="listingblock data-line-263">
<div class="content">
<pre>require(withdraw_amount &lt;= 0.1 ether);</pre>
</div>
</div>
</div>
<div class="sect3 data-line-267">
<h4 id="_variables_et_fonctions_globales_prédéfinies">Variables et fonctions globales prédéfinies</h4>
<div class="paragraph data-line-269">
<p>When a contract is executed in the EVM, it has access to a small set of global objects. These include the block, msg, and tx objects. In addition, Solidity exposes a number of EVM opcodes as predefined functions. In this section we will examine the variables and functions you can access from within a smart contract in Solidity.</p>
</div>
<div class="sect4 data-line-271">
<h5 id="_contexte_dappel_dune_transaction_message">Contexte d&#8217;appel d&#8217;une transaction / message</h5>
<div class="paragraph data-line-273">
<p>The msg object is the transaction call (EOA originated) or message call (contract originated) that launched this contract execution. It contains a number of useful attributes:</p>
</div>
<div class="dlist data-line-275">
<dl>
<dt class="hdlist1">msg.sender</dt>
<dd>
<p>We&#8217;ve already used this one. It represents the address that initiated this contract call, not necessarily the originating EOA that sent the transaction. If our contract was called directly by an EOA transaction, then this is the address that signed the transaction, but otherwise it will be a contract address.</p>
</dd>
<dt class="hdlist1">msg.value</dt>
<dd>
<p>The value of ether sent with this call (in wei).</p>
</dd>
<dt class="hdlist1">msg.gas</dt>
<dd>
<p>The amount of gas left in the gas supply of this execution environment. This was deprecated in Solidity v0.4.21 and replaced by the gasleft function.</p>
</dd>
<dt class="hdlist1">msg.data</dt>
<dd>
<p>The data payload of this call into our contract.</p>
</dd>
<dt class="hdlist1">msg.sig</dt>
<dd>
<p>The first four bytes of the data payload, which is the function selector.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note data-line-286">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-287">
<p>Whenever a contract calls another contract, the values of all the attributes of msg change to reflect the new caller&#8217;s information. The only exception to this is the delegatecall function, which runs the code of another contract/library within the original msg <span class="keep-together">context</span>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-290">
<h5 id="_contexte_de_transaction">Contexte de transaction</h5>
<div class="paragraph data-line-292">
<p>The tx object provides a means of accessing transaction-related information:</p>
</div>
<div class="dlist data-line-294">
<dl>
<dt class="hdlist1">tx.gasprice</dt>
<dd>
<p>The gas price in the calling transaction.</p>
</dd>
<dt class="hdlist1">tx.origin</dt>
<dd>
<p>The address of the originating EOA for this transaction. WARNING: unsafe!</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-298">
<h5 id="_contexte_du_bloc">Contexte du bloc</h5>
<div class="paragraph data-line-300">
<p>The block object contains information about the current block:</p>
</div>
<div class="dlist data-line-302">
<dl>
<dt class="hdlist1">block.blockhash(__blockNumber__)</dt>
<dd>
<p>The block hash of the specified block number, up to 256 blocks in the past. Deprecated and replaced with the blockhash function in Solidity v0.4.22.</p>
</dd>
<dt class="hdlist1">block.coinbase</dt>
<dd>
<p>The address of the recipient of the current block&#8217;s fees and block reward.</p>
</dd>
<dt class="hdlist1">block.difficulty</dt>
<dd>
<p>The difficulty (proof of work) of the current block.</p>
</dd>
<dt class="hdlist1">block.gaslimit</dt>
<dd>
<p>The maximum amount of gas that can be spent across all transactions included in the current block.</p>
</dd>
<dt class="hdlist1">block.number</dt>
<dd>
<p>The current block number (blockchain height).</p>
</dd>
<dt class="hdlist1">block.timestamp</dt>
<dd>
<p>The timestamp placed in the current block by the miner (number of seconds since the Unix epoch).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-315">
<h5 id="solidity_address_object">Objet d&#8217;adresse</h5>
<div class="paragraph data-line-317">
<p>Any address, either passed as an input or cast from a contract object, has a number of attributes and methods:</p>
</div>
<div class="dlist data-line-319">
<dl>
<dt class="hdlist1">address.balance</dt>
<dd>
<p>The balance of the address, in wei. For example, the current contract balance is address(this).balance.</p>
</dd>
<dt class="hdlist1">address.transfer(__amount__)</dt>
<dd>
<p>Transfers the amount (in wei) to this address, throwing an exception on any error. We used this function in our Faucet example as a method on the msg.sender address, as msg.sender.transfer.</p>
</dd>
<dt class="hdlist1">address.send(__amount__)</dt>
<dd>
<p>Similar to transfer, only instead of throwing an exception, it returns false on error. WARNING: always check the return value of send.</p>
</dd>
<dt class="hdlist1">address.call(__payload__)</dt>
<dd>
<p>Low-level CALL function&#x2014;can construct an arbitrary message call with a data payload. Returns false on error. WARNING: unsafe&#x2014;recipient can (accidentally or maliciously) use up all your gas, causing your contract to halt with an OOG exception; always check the return value of call.</p>
</dd>
<dt class="hdlist1">address.callcode(__payload__)</dt>
<dd>
<p>Low-level CALLCODE function, like address(this).call(...) but with this contract&#8217;s code replaced with that of address. Returns false on error. WARNING: advanced use only!</p>
</dd>
<dt class="hdlist1">address.delegatecall()</dt>
<dd>
<p>Low-level DELEGATECALL function, like callcode(...) but with the full msg context seen by the current contract. Returns false on error. WARNING: advanced use only!</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-331">
<h5 id="_fonctions_intégrées">Fonctions intégrées</h5>
<div class="paragraph data-line-333">
<p>Other functions worth noting are:</p>
</div>
<div class="dlist data-line-335">
<dl>
<dt class="hdlist1">addmod, mulmod</dt>
<dd>
<p>For modulo addition and multiplication. For example, addmod(x,y,k) calculates (x + y) % k.</p>
</dd>
<dt class="hdlist1">keccak256, sha256, sha3, ripemd160</dt>
<dd>
<p>Functions to calculate hashes with various standard hash algorithms.</p>
</dd>
<dt class="hdlist1">ecrecover</dt>
<dd>
<p>Recovers the address used to sign a message from the signature.</p>
</dd>
<dt class="hdlist1">selfdestruct(__recipient_address__)</dt>
<dd>
<p>Deletes the current contract, sending any remaining ether in the account to the recipient address.</p>
</dd>
<dt class="hdlist1">this</dt>
<dd>
<p>The address of the currently executing contract account.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-345">
<h4 id="_définition_du_contrat">Définition du contrat</h4>
<div class="paragraph data-line-347">
<p>Solidity&#8217;s principal data type is contract; our Faucet example simply defines a <span class="keep-together"><code>contract</code></span> object. Similar to any object in an object-oriented language, the contract is a container that includes data and methods.</p>
</div>
<div class="paragraph data-line-349">
<p>Solidity offers two other object types that are similar to a contract:</p>
</div>
<div class="dlist data-line-351">
<dl>
<dt class="hdlist1">interface</dt>
<dd>
<p>An interface definition is structured exactly like a contract, except none of the functions are defined, they are only declared. This type of declaration is often called a <em>stub</em>; it tells you the functions' arguments and return types without any implementation. An interface specifies the "shape" of a contract; when inherited, each of the functions declared by the interface must be defined by the child.</p>
</dd>
<dt class="hdlist1">library</dt>
<dd>
<p>A library contract is one that is meant to be deployed only once and used by other contracts, using the delegatecall method (see <a href="#solidity_address_object">Objet d&#8217;adresse</a>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-356">
<h4 id="solidity_functions">Fonctions</h4>
<div class="paragraph data-line-358">
<p>Within a contract, we define functions that can be called by an EOA transaction or another contract. In our Faucet example, we have two functions: withdraw and the (unnamed) <em>fallback</em> function.</p>
</div>
<div class="paragraph data-line-360">
<p>The syntax we use to declare a function in Solidity is as follows:</p>
</div>
<pre data-type="programlisting">
function FunctionName([<em>parameters</em>]) {public|private|internal|external}
[pure|constant|view|payable] [<em>modifiers</em>] [returns (<em>return types</em>)]
</pre>
<div class="paragraph data-line-370">
<p>Let&#8217;s look at each of these components:</p>
</div>
<div class="dlist data-line-372">
<dl>
<dt class="hdlist1">FunctionName</dt>
<dd>
<p>The name of the function, which is used to call the function in a transaction (from an EOA), from another contract, or even from within the same contract. One function in each contract may be defined without a name, in which case it is the <em>fallback</em> function, which is called when no other function is named. The fallback function cannot have any arguments or return anything.</p>
</dd>
<dt class="hdlist1"><em>parameters</em></dt>
<dd>
<p>Following the name, we specify the arguments that must be passed to the function, with their names and types. In our Faucet example we defined uint withdraw_amount as the only argument to the <code><span class="keep-together">withdraw</span></code> function.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-376">
<p>The next set of keywords (public, private, internal, external) specify the function&#8217;s <em>visibility</em>:</p>
</div>
<div class="dlist data-line-378">
<dl>
<dt class="hdlist1">public</dt>
<dd>
<p>Public is the default; such functions can be called by other contracts or EOA transactions, or from within the contract. In our Faucet example, both functions are defined as public.</p>
</dd>
<dt class="hdlist1">external</dt>
<dd>
<p>External functions are like public functions, except they cannot be called from within the contract unless explicitly prefixed with the keyword this.</p>
</dd>
<dt class="hdlist1">internal</dt>
<dd>
<p>Internal functions are only accessible from within the contract&#x2014;they cannot be called by another contract or EOA transaction. They can be called by derived contracts (those that inherit this one).</p>
</dd>
<dt class="hdlist1">private</dt>
<dd>
<p>Private functions are like internal functions but cannot be called by derived <span class="keep-together">contracts</span>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-386">
<p>Keep in mind that the terms <em>internal</em> and <em>private</em> are somewhat misleading. Any function or data inside a contract is always <em>visible</em> on the public blockchain, meaning that anyone can see the code or data. The keywords described here only affect how and when a function can be <em>called</em>.</p>
</div>
<div class="paragraph data-line-388">
<p>The second set of keywords (pure, constant, view, payable) affect the behavior of the function:</p>
</div>
<div class="dlist data-line-390">
<dl>
<dt class="hdlist1">constant or view</dt>
<dd>
<p>A function marked as a <em>view</em> promises not to modify any state. The term <em>constant</em> is an alias for view that will be deprecated in a future release. At this time, the compiler does not enforce the view modifier, only producing a warning, but this is expected to become an enforced keyword in v0.5 of Solidity.</p>
</dd>
<dt class="hdlist1">pure</dt>
<dd>
<p>A pure function is one that neither reads nor writes any variables in storage. It can only operate on arguments and return data, without reference to any stored data. Pure functions are intended to encourage declarative-style programming without side effects or state.</p>
</dd>
<dt class="hdlist1">payable</dt>
<dd>
<p>A payable function is one that can accept incoming payments. Functions not declared as payable will reject incoming payments. There are two exceptions, due to design decisions in the EVM: coinbase payments and SELFDESTRUCT inheritance will be paid even if the fallback function is not declared as payable, but this makes sense because code execution is not part of those payments <span class="keep-together">anyway</span>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-396">
<p>As you can see in our Faucet example, we have one payable function (the fallback function), which is the only function that can receive incoming payments.</p>
</div>
</div>
<div class="sect3 data-line-398">
<h4 id="_constructeur_de_contrats_et_selfdestruct">Constructeur de contrats et selfdestruct</h4>
<div class="paragraph data-line-400">
<p>There is a special function that is only used once. When a contract is created, it also runs the <em>constructor function</em> if one exists, to initialize the state of the contract. The constructor is run in the same transaction as the contract creation. The constructor function is optional; you&#8217;ll notice our Faucet example doesn&#8217;t have one.</p>
</div>
<div class="paragraph data-line-402">
<p>Constructors can be specified in two ways. Up to and including in Solidity v0.4.21, the constructor is a function whose name matches the name of the contract, as you can see here:</p>
</div>
<div class="listingblock data-line-405">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract MEContract {
	function MEContract() {
		// This is the constructor
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-414">
<p>The difficulty with this format is that if the contract name is changed and the constructor function name is not changed, it is no longer a constructor. Likewise, if there is an accidental typo in the naming of the contract and/or constructor, the function is again no longer a constructor. This can cause some pretty nasty, unexpected, and difficult-to-find bugs. Imagine for example if the constructor is setting the owner of the contract for purposes of control. If the function is not actually the constructor because of a naming error, not only will the owner be left unset at the time of contract creation, but the function may also be deployed as a permanent and "callable" part of the contract, like a normal function, allowing any third party to hijack the contract and become the "owner" after contract creation.</p>
</div>
<div class="paragraph data-line-416">
<p>To address the potential problems with constructor functions being based on having an identical name as the contract, Solidity v0.4.22 introduces a constructor keyword that operates like a constructor function but does not have a name. Renaming the contract does not affect the constructor at all. Also, it is easier to identify which function is the constructor. It looks like this:</p>
</div>
<div class="listingblock data-line-419">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma ^0.4.22
contract MEContract {
	constructor () {
		// This is the constructor
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-428">
<p>To summarize, a contract&#8217;s life cycle starts with a creation transaction from an EOA or contract account. If there is a constructor, it is executed as part of contract creation, to initialize the state of the contract as it is being created, and is then discarded.</p>
</div>
<div class="paragraph data-line-430">
<p>The other end of the contract&#8217;s life cycle is <em>contract destruction</em>. Contracts are destroyed by a special EVM opcode called SELFDESTRUCT. It used to be called <span class="keep-together"><code>SUICIDE</code></span>, but that name was deprecated due to the negative associations of the word. In Solidity, this opcode is exposed as a high-level built-in function called selfdestruct, which takes one argument: the address to receive any ether balance remaining in the contract account. It looks like this:</p>
</div>
<div class="listingblock data-line-433">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">selfdestruct(address recipient);</code></pre>
</div>
</div>
<div class="paragraph data-line-437">
<p>Note that you must explicitly add this command to your contract if you want it to be deletable&#x2014;this is the only way a contract can be deleted, and it is not present by default. In this way, users of a contract who might rely on a contract being there forever can be certain that a contract can&#8217;t be deleted if it doesn&#8217;t contain a <span class="keep-together"><code>SELFDESTRUCT</code></span> opcode.</p>
</div>
</div>
<div class="sect3 data-line-439">
<h4 id="_ajout_dun_constructeur_et_selfdestruct_sur_lexemple_du_faucet">Ajout d&#8217;un constructeur et selfdestruct sur l&#8217;exemple du Faucet</h4>
<div class="paragraph data-line-441">
<p>The Faucet example contract we introduced in <a href="#intro_chapter">[intro_chapter]</a> does not have any constructor or selfdestruct functions. It is an eternal contract that cannot be deleted. Let&#8217;s change that, by adding a constructor and selfdestruct function. We probably want selfdestruct to be callable <em>only</em> by the EOA that originally created the contract. By convention, this is usually stored in an address variable called owner. Our constructor sets the owner variable, and the selfdestruct function will first check that the owner called it directly.</p>
</div>
<div class="paragraph data-line-443">
<p>First, our constructor:</p>
</div>
<div class="listingblock data-line-446">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version du compilateur Solidity pour lequel ce programme a été écrit
pragma solidity ^0.4.22;

// Notre premier contrat est un faucet!
contract Faucet {

	address owner;

	// Initialize Faucet contract: set owner
	constructor() {
		owner = msg.sender;
	}

[...]</code></pre>
</div>
</div>
<div class="paragraph data-line-463">
<p>We&#8217;ve changed the pragma directive to specify v0.4.22 as the minimum version for this example, as we are using the new constructor keyword introduced in v0.4.22 of Solidity. Our contract now has an address type variable named owner. The name "owner" is not special in any way. We could call this address variable "potato" and still use it the same way. The name owner simply makes its purpose clear.</p>
</div>
<div class="paragraph data-line-465">
<p>Next, our constructor, which runs as part of the contract creation transaction, assigns the address from msg.sender to the owner variable. We used msg.sender in the <span class="keep-together"><code>withdraw</code></span> function to identify the initiator of the withdrawal request. In the constructor, however, the msg.sender is the EOA or contract address that initiated contract creation. We know this is the case <em>because</em> this is a constructor function: it only runs once, during contract creation.</p>
</div>
<div class="paragraph data-line-467">
<p>Now we can add a function to destroy the contract. We need to make sure that only the owner can run this function, so we will use a require statement to control access. Here&#8217;s how it will look:</p>
</div>
<div class="listingblock data-line-470">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Contract destructor
function destroy() public {
	require(msg.sender == owner);
	selfdestruct(owner);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-478">
<p>If anyone calls this destroy function from an address other than owner, it will fail. But if the same address stored in owner by the constructor calls it, the contract will self-destruct and send any remaining balance to the owner address. Note that we did not use the unsafe tx.origin to determine whether the owner wished to destroy the contract&#x2014;using tx.origin would allow malign contracts to destroy your contract without your permission.</p>
</div>
</div>
<div class="sect3 data-line-480">
<h4 id="_modificateurs_de_fonction">Modificateurs de fonction</h4>
<div class="paragraph data-line-482">
<p>Solidity offers a special type of function called a <em>function modifier</em>. You apply modifiers to functions by adding the modifier name in the function declaration. Modifiers are most often used to create conditions that apply to many functions within a contract. We have an access control statement already, in our destroy function. Let&#8217;s create a function modifier that expresses that condition:</p>
</div>
<div class="listingblock data-line-485">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">modifier onlyOwner {
require (msg.sender == owner);
    _;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-493">
<p>This function modifier, named onlyOwner, sets a condition on any function that it modifies, requiring that the address stored as the owner of the contract is the same as the address of the transaction&#8217;s msg.sender. This is the basic design pattern for access control, allowing only the owner of a contract to execute any function that has the onlyOwner modifier.</p>
</div>
<div class="paragraph data-line-495">
<p>You may have noticed that our function modifier has a peculiar syntactic "placeholder" in it, an underscore followed by a semicolon (&amp;#95;;). This placeholder is replaced by the code of the function that is being modified. Essentially, the modifier is "wrapped around" the modified function, placing its code in the location identified by the underscore character.</p>
</div>
<div class="paragraph data-line-497">
<p>To apply a modifier, you add its name to the function declaration. More than one modifier can be applied to a function; they are applied in the sequence they are declared, as a comma-separated list.</p>
</div>
<div class="paragraph data-line-499">
<p>Let&#8217;s rewrite our destroy function to use the onlyOwner modifier:</p>
</div>
<div class="listingblock data-line-502">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function destroy() public onlyOwner {
    selfdestruct(owner);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-508">
<p>The function modifier&#8217;s name (onlyOwner) is after the keyword public and tells us that the destroy function is modified by the onlyOwner modifier. Essentially, you can read this as "Only the owner can destroy this contract." In practice, the resulting code is equivalent to "wrapping" the code from onlyOwner around destroy.</p>
</div>
<div class="paragraph data-line-510">
<p>Function modifiers are an extremely useful tool because they allow us to write preconditions for functions and apply them consistently, making the code easier to read and, as a result, easier to audit for security. They are most often used for access control, but they are quite versatile and can be used for a variety of other purposes.</p>
</div>
<div class="paragraph data-line-512">
<p>Inside a modifier, you can access all the values (variables and arguments) visible to the modified function. In this case, we can access the owner variable, which is declared within the contract. However, the inverse is not true: you cannot access any of the modifier&#8217;s variables inside the modified function.</p>
</div>
</div>
<div class="sect3 data-line-514">
<h4 id="_héritage_de_contrat">Héritage de contrat</h4>
<div class="paragraph data-line-516">
<p>Solidity&#8217;s contract object supports <em>inheritance</em>, which is a mechanism for extending a base contract with additional functionality. To use inheritance, specify a parent contract with the keyword is:</p>
</div>
<div class="listingblock data-line-519">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Child is Parent {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-525">
<p>With this construct, the Child contract inherits all the methods, functionality, and variables of Parent. Solidity also supports multiple inheritance, which can be specified by comma-separated contract names after the keyword is:</p>
</div>
<div class="listingblock data-line-528">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Child is Parent1, Parent2 {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-534">
<p>Contract inheritance allows us to write our contracts in such a way as to achieve modularity, extensibility, and reuse. We start with contracts that are simple and implement the most generic capabilities, then extend them by inheriting those capabilities in more specialized contracts.</p>
</div>
<div class="paragraph data-line-536">
<p>In our Faucet contract, we introduced the constructor and destructor, together with access control for an owner, assigned on construction. Those capabilities are quite generic: many contracts will have them. We can define them as generic contracts, then use inheritance to extend them to the Faucet contract.</p>
</div>
<div class="paragraph data-line-538">
<p>We start by defining a base contract owned, which has an owner variable, setting it in the contract&#8217;s constructor:</p>
</div>
<div class="listingblock data-line-541">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract owned {
	address owner;

	// Contract constructor: set owner
	constructor() {
		owner = msg.sender;
	}

	// Access control modifier
	modifier onlyOwner {
	    require(msg.sender == owner);
	    _;
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-558">
<p>Next, we define a base contract mortal, which inherits owned:</p>
</div>
<div class="listingblock data-line-561">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract mortal is owned {
	// Contract destructor
	function destroy() public onlyOwner {
		selfdestruct(owner);
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-570">
<p>As you can see, the mortal contract can use the onlyOwner function modifier, defined in owned. It indirectly also uses the owner address variable and the constructor defined in owned. Inheritance makes each contract simpler and focused on its specific functionality, allowing us to manage the details in a modular way.</p>
</div>
<div class="paragraph data-line-572">
<p>Now we can further extend the owned contract, inheriting its capabilities in Faucet:</p>
</div>
<div class="listingblock data-line-575">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet is mortal {
    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 0.1 ether);
        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
    // Accept any incoming amount
    function () external payable {}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-589">
<p>By inheriting mortal, which in turn inherits owned, the Faucet contract now has the constructor and destroy functions, and a defined owner. The functionality is the same as when those functions were within Faucet, but now we can reuse those functions in other contracts without writing them again. Code reuse and modularity make our code cleaner, easier to read, and easier to audit.</p>
</div>
</div>
<div class="sect3 data-line-591">
<h4 id="_gestion_des_erreurs_assert_require_revert">Gestion des erreurs (assert, require, revert)</h4>
<div class="paragraph data-line-593">
<p>A contract call can terminate and return an error. Error handling in Solidity is handled by four functions: assert, require, revert, and throw (now deprecated).</p>
</div>
<div class="paragraph data-line-595">
<p>When a contract terminates with an error, all the state changes (changes to variables, balances, etc.) are reverted, all the way up the chain of contract calls if more than one contract was called. This ensures that transactions are <em>atomic</em>, meaning they either complete successfully or have no effect on state and are reverted entirely.</p>
</div>
<div class="paragraph data-line-597">
<p>The assert and require functions operate in the same way, evaluating a condition and stopping execution with an error if the condition is false. By convention, assert is used when the outcome is expected to be true, meaning that we use assert to test internal conditions. By comparison, require is used when testing inputs (such as function arguments or transaction fields), setting our expectations for those <span class="keep-together">conditions</span>.</p>
</div>
<div class="paragraph data-line-599">
<p>We&#8217;ve used require in our function modifier onlyOwner, to test that the message sender is the owner of the contract:</p>
</div>
<div class="listingblock data-line-602">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(msg.sender == owner);</code></pre>
</div>
</div>
<div class="paragraph data-line-606">
<p>The require function acts as a <em>gate condition</em>, preventing execution of the rest of the function and producing an error if it is not satisfied.</p>
</div>
<div class="paragraph data-line-608">
<p>As of Solidity v0.4.22, require can also include a helpful text message that can be used to show the reason for the error. The error message is recorded in the transaction log. So, we can improve our code by adding an error message in our require function:</p>
</div>
<div class="listingblock data-line-611">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(msg.sender == owner, "Seul le propriétaire du contrat peut appeler cette fonction");</code></pre>
</div>
</div>
<div class="paragraph data-line-615">
<p>The revert and throw functions halt the execution of the contract and revert any state changes. The throw function is obsolete and will be removed in future versions of Solidity; you should use revert instead. The revert function can also take an error message as the only argument, which is recorded in the transaction log.</p>
</div>
<div class="paragraph data-line-617">
<p>Certain conditions in a contract will generate errors regardless of whether we explicitly check for them. For example, in our Faucet contract, we don&#8217;t check whether there is enough ether to satisfy a withdrawal request. That&#8217;s because the transfer function will fail with an error and revert the transaction if there is insufficient balance to make the transfer:</p>
</div>
<div class="listingblock data-line-620">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-624">
<p>However, it might be better to check explicitly and provide a clear error message on failure. We can do that by adding a require statement before the transfer:</p>
</div>
<div class="listingblock data-line-627">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(this.balance &gt;= withdraw_amount,
	"Insufficient balance in faucet for withdrawal request");
msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-633">
<p>Additional error-checking code like this will increase gas consumption slightly, but it offers better error reporting than if omitted. You will need to find the right balance between gas consumption and verbose error checking based on the expected use of your contract. In the case of a Faucet contract intended for a testnet, we&#8217;d probably err on the side of extra reporting even if it costs more gas. Perhaps for a mainnet contract we&#8217;d choose to be frugal with our gas usage instead.</p>
</div>
</div>
<div class="sect3 data-line-636">
<h4 id="solidity_events">Événements</h4>
<div class="paragraph data-line-638">
<p>When a transaction completes (successfully or not), it produces a <em>transaction receipt</em>, as we will see in <a href="#evm_chapter">[evm_chapter]</a>. The transaction receipt contains <em>log</em> entries that provide information about the actions that occurred during the execution of the transaction. <em>Events</em> are the Solidity high-level objects that are used to construct these logs.</p>
</div>
<div class="paragraph data-line-640">
<p>Events are especially useful for light clients and DApp services, which can "watch" for specific events and report them to the user interface, or make a change in the state of the application to reflect an event in an underlying contract.</p>
</div>
<div class="paragraph data-line-642">
<p>Event objects take arguments that are serialized and recorded in the transaction logs, in the blockchain. You can supply the keyword indexed before an argument, to make the value part of an indexed table (hash table) that can be searched or filtered by an application.</p>
</div>
<div class="paragraph data-line-644">
<p>We have not added any events in our Faucet example so far, so let&#8217;s do that. We will add two events, one to log any withdrawals and one to log any deposits. We will call these events Withdrawal and Deposit, respectively. First, we define the events in the Faucet contract:</p>
</div>
<div class="listingblock data-line-647">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet is mortal {
	event Withdrawal(address indexed to, uint amount);
	event Deposit(address indexed from, uint amount);

	[...]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-656">
<p>We&#8217;ve chosen to make the addresses indexed, to allow searching and filtering in any user interface built to access our Faucet.</p>
</div>
<div class="paragraph data-line-658">
<p>Next, we use the emit keyword to incorporate the event data in the transaction logs:</p>
</div>
<div class="listingblock data-line-661">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Give out ether to anyone who asks
function withdraw(uint withdraw_amount) public {
    [...]
    msg.sender.transfer(withdraw_amount);
    emit Withdrawal(msg.sender, withdraw_amount);
}
// Accept any incoming amount
function () external payable {
    emit Deposit(msg.sender, msg.value);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-674">
<p>The resulting <em>Faucet.sol</em> contract looks like <a href="#Faucet8_sol">Faucet8.sol: Revised Faucet contract, with events</a>.</p>
</div>
<div id="Faucet8_sol" class="exampleblock data-line-678">
<div class="title">Example 3. Faucet8.sol: Revised Faucet contract, with events</div>
<div class="content">
<div class="listingblock data-line-680">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity ^0.6.4;

contract Owned {
    address payable owner;

    // Contract constructor: set owner
    constructor() public {
        owner = msg.sender;
    }

    // Access control modifier
    modifier onlyOwner {
        require(msg.sender == owner, "Only the contract owner can call this function");
        _;
    }
}

contract Mortal is Owned {
    // Contract destructor
    function destroy() public onlyOwner {
        selfdestruct(owner);
    }
}

contract Faucet is Mortal {
    event Withdrawal(address indexed to, uint amount);
    event Deposit(address indexed from, uint amount);

    // Accept any incoming amount
    receive() external payable {
        emit Deposit(msg.sender, msg.value);
    }

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 0.1 ether);

        require(
            address(this).balance &gt;= withdraw_amount,
            "Insufficient balance in faucet for withdrawal request"
        );

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);

        emit Withdrawal(msg.sender, withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4 data-line-685">
<h5 id="_attraper_des_événements">Attraper des événements</h5>
<div class="paragraph data-line-687">
<p>OK, so we&#8217;ve set up our contract to emit events. How do we see the results of a transaction and "catch" the events? The web3.js library provides a data structure that contains a transaction&#8217;s logs. Within those we can see the events generated by the transaction.</p>
</div>
<div class="paragraph data-line-689">
<p>Let&#8217;s use truffle to run a test transaction on the revised Faucet contract. Follow the instructions in <a href="#truffle">[truffle]</a> to set up a project directory and compile the <span class="keep-together"><code>Faucet</code></span> code. The source code can be found in <a href="https://github.com/ethereumbook/ethereumbook" data-href="https://github.com/ethereumbook/ethereumbook">the book&#8217;s GitHub repository</a> under <em>code/truffle/FaucetEvents</em>.</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle develop</strong>
truffle(develop)> <strong>compile</strong>
truffle(develop)> <strong>migrate</strong>
Using network 'develop'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb77ceae7c3f5afb7fbe3a6c5974d352aa844f53f955ee7d707ef6f3f8e6b4e61
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Faucet...
  ... 0xfa850d754314c3fb83f43ca1fa6ee20bc9652d891c00a2f63fd43ab5bfb0d781
  Faucet: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

truffle(develop)> <strong>Faucet.deployed().then(i => {FaucetDeployed = i})</strong>
truffle(develop)> <strong>FaucetDeployed.send(web3.utils.toWei(1, "ether")).then(res => \
                  { console.log(res.logs[0].event, res.logs[0].args) })</strong>
Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }
truffle(develop)> <strong>FaucetDeployed.withdraw(web3.utils.toWei(0.1, "ether")).then(res => \
                  { console.log(res.logs[0].event, res.logs[0].args) })</strong>
Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }
</pre>
<div class="paragraph data-line-725">
<p>After deploying the contract using the deployed function, we execute two transactions. The first transaction is a deposit (using send), which emits a Deposit event in the transaction logs:</p>
</div>
<div class="listingblock data-line-727">
<div class="content">
<pre>Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }</pre>
</div>
</div>
<div class="paragraph data-line-732">
<p>Next, we use the withdraw function to make a withdrawal. This emits a Withdrawal event:</p>
</div>
<div class="listingblock data-line-734">
<div class="content">
<pre>Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }</pre>
</div>
</div>
<div class="paragraph data-line-739">
<p>To get these events, we looked at the logs array returned as a result (res) of the transactions. The first log entry (logs[0]) contains an event name in logs[0].event and the event arguments in logs[0].args. By showing these on the console, we can see the emitted event name and the event arguments.</p>
</div>
<div class="paragraph data-line-741">
<p>Events are a very useful mechanism, not only for intra-contract communication, but also for debugging during development.</p>
</div>
</div>
</div>
<div class="sect3 data-line-743">
<h4 id="_appeler_dautres_contrats_send_call_callcode_delegatecall">Appeler d&#8217;autres contrats (send, call, callcode, delegatecall)</h4>
<div class="paragraph data-line-745">
<p>Calling other contracts from within your contract is a very useful but potentially dangerous operation. We&#8217;ll examine the various ways you can achieve this and evaluate the risks of each method. In short, the risks arise from the fact that you may not know much about a contract you are calling into or that is calling into your contract. When writing smart contracts, you must keep in mind that while you may mostly expect to be dealing with EOAs, there is nothing to stop arbitrarily complex and perhaps malign contracts from calling into and being called by your code.</p>
</div>
<div class="sect4 data-line-747">
<h5 id="_créer_dune_nouvelle_instance">Créer d&#8217;une nouvelle instance</h5>
<div class="paragraph data-line-749">
<p>The safest way to call another contract is if you create that other contract yourself. That way, you are certain of its interfaces and behavior. To do this, you can simply instantiate it, using the keyword new, as in other object-oriented languages. In Solidity, the keyword new will create the contract on the blockchain and return an object that you can use to reference it. Let&#8217;s say you want to create and call a Faucet contract from within another contract called Token:</p>
</div>
<div class="listingblock pagebreak-before data-line-753">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-763">
<p>This mechanism for contract construction ensures that you know the exact type of the contract and its interface. The contract Faucet must be defined within the scope of Token, which you can do with an import statement if the definition is in another file:</p>
</div>
<div class="listingblock data-line-766">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-778">
<p>You can optionally specify the value of ether transfer on creation, and pass arguments to the new contract&#8217;s constructor:</p>
</div>
<div class="listingblock data-line-781">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-793">
<p>You can also then call the Faucet functions. In this example, we call the destroy function of Faucet from within the destroy function of Token:</p>
</div>
<div class="listingblock data-line-796">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}

	function destroy() ownerOnly {
		_faucet.destroy();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-812">
<p>Note that while you are the owner of the Token contract, the Token contract itself owns the new Faucet contract, so only the Token contract can destroy it.</p>
</div>
</div>
<div class="sect4 data-line-814">
<h5 id="_adresser_une_instance_existante">Adresser une instance existante</h5>
<div class="paragraph data-line-816">
<p>Another way you can call a contract is by casting the address of an existing instance of the contract. With this method, you apply a known interface to an existing instance. It is therefore critically important that you know, for sure, that the instance you are addressing is in fact of the type you assume. Let&#8217;s look at an example:</p>
</div>
<div class="listingblock data-line-819">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {

	Faucet _faucet;

	constructor(address _f) {
		_faucet = Faucet(_f);
		_faucet.withdraw(0.1 ether)
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-833">
<p>Here, we take an address provided as an argument to the constructor, _f, and we cast it to a Faucet object. This is much riskier than the previous mechanism, because we don&#8217;t know for sure whether that address actually is a Faucet object. When we call withdraw, we are assuming that it accepts the same arguments and executes the same code as our Faucet declaration, but we can&#8217;t be sure. For all we know, the withdraw function at this address could execute something completely different from what we expect, even if it is named the same. Using addresses passed as input and casting them into specific objects is therefore much more dangerous than creating the contract yourself.</p>
</div>
</div>
<div class="sect4 data-line-835">
<h5 id="_appel_brut_appel_délégué">Appel brut, appel délégué</h5>
<div class="paragraph data-line-837">
<p>Solidity offers some even more "low-level" functions for calling other contracts. These correspond directly to EVM opcodes of the same name and allow us to construct a contract-to-contract call manually. As such, they represent the most flexible <em>and</em> the most dangerous mechanisms for calling other contracts.</p>
</div>
<div class="paragraph data-line-839">
<p>Here&#8217;s the same example, using a call method:</p>
</div>
<div class="listingblock data-line-842">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	constructor(address _faucet) {
		_faucet.call("withdraw", 0.1 ether);
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-850">
<p>As you can see, this type of call is a <em>blind</em> call into a function, very much like constructing a raw transaction, only from within a contract&#8217;s context. It can expose your contract to a number of security risks, most importantly <em>reentrancy</em>, which we will discuss in more detail in <a href="#reentrancy_security">[reentrancy_security]</a>. The call function will return false if there is a problem, so you can evaluate the return value for error handling:</p>
</div>
<div class="listingblock data-line-853">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	constructor(address _faucet) {
		if !(_faucet.call("withdraw", 0.1 ether)) {
			revert("Withdrawal from faucet failed");
		}
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-863">
<p>Another variant of call is delegatecall, which replaced the more dangerous callcode. The <code><span class="keep-together">callcode</span></code> method will be deprecated soon, so it should not be used.</p>
</div>
<div class="paragraph data-line-865">
<p>As mentioned in <a href="#solidity_address_object">Objet d&#8217;adresse</a>, a delegatecall is different from a call in that the msg context does not change. For example, whereas a call changes the value of msg.sender to be the calling contract, a delegatecall keeps the same msg.sender as in the calling contract. Essentially, delegatecall runs the code of another contract inside the context of the execution of the current contract. It is most often used to invoke code from a library. It also allows you to draw on the pattern of using library functions stored elsewhere, but have that code work with the storage data of your contract.</p>
</div>
<div class="paragraph data-line-867">
<p>The delegate call should be used with great caution. It can have some unexpected effects, especially if the contract you call was not designed as a library.</p>
</div>
<div class="paragraph data-line-869">
<p>Let&#8217;s use an example contract to demonstrate the various call semantics used by call and delegatecall for calling libraries and contracts. In <a href="#call_examples_code">CallExamples.sol: An example of different call semantics</a>, we use an event to log the details of each call and see how the calling context changes depending on the call type.</p>
</div>
<div id="call_examples_code" class="exampleblock data-line-873">
<div class="title">Example 4. CallExamples.sol: An example of different call semantics</div>
<div class="content">
<div class="listingblock data-line-875">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.22;

contract calledContract {
    event callEvent(address sender, address origin, address from);
    function calledFunction() public {
        emit callEvent(msg.sender, tx.origin, this);
    }
}

library calledLibrary {
    event callEvent(address sender, address origin,  address from);
    function calledFunction() public {
        emit callEvent(msg.sender, tx.origin, this);
    }
}

contract caller {

    function make_calls(calledContract _calledContract) public {

    // Calling calledContract and calledLibrary directly
    _calledContract.calledFunction();
    calledLibrary.calledFunction();

    // Low-level calls using the address object for calledContract
    require(address(_calledContract).
            call(bytes4(keccak256("calledFunction()"))));
    require(address(_calledContract).
            delegatecall(bytes4(keccak256("calledFunction()"))));



	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-880">
<p>As you can see in this example, our main contract is caller, which calls a library calledLibrary and a contract calledContract. Both the called library and the contract have identical calledFunction functions, which emit an event calledEvent. The event calledEvent logs three pieces of data: msg.sender, tx.origin, and this. Each time calledFunction is called it may have a different execution context (with different values for potentially all the context variables), depending on whether it is called directly or through delegatecall.</p>
</div>
<div class="paragraph data-line-882">
<p>In caller, we first call the contract and library directly, by invoking calledFunction in each. Then, we explicitly use the low-level functions call and delegatecall to call calledContract.calledFunction. This way we can see how the various calling mechanisms behave.</p>
</div>
<div class="paragraph data-line-884">
<p>Let&#8217;s run this in a Truffle development environment and capture the events, to see how it looks:</p>
</div>
<pre data-type="programlisting">
truffle(develop)> <strong>migrate</strong>
Using network 'develop'.
[...]
Saving artifacts...
truffle(develop)> <strong>web3.eth.accounts[0]</strong>
'0x627306090abab3a6e1400e9345bc60c78a8bef57'
truffle(develop)> <strong>caller.address</strong>
'0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'
truffle(develop)> <strong>calledContract.address</strong>
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'
truffle(develop)> <strong>calledLibrary.address</strong>
'0xf25186b5081ff5ce73482ad761db0eb0d25abfbf'
truffle(develop)> <strong>caller.deployed().then( i => { callerDeployed = i })</strong>

truffle(develop)> <strong>callerDeployed.make_calls(calledContract.address).then(res => \
                  { res.logs.forEach( log => { console.log(log.args) })})</strong>
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }
</pre>
<div class="paragraph data-line-919">
<p>Let&#8217;s see what happened here. We called the make_calls function and passed the address of calledContract, then caught the four events emitted by each of the different calls. Let&#8217;s look at the make_calls function and walk through each step.</p>
</div>
<div class="paragraph data-line-921">
<p>The first call is:</p>
</div>
<div class="listingblock data-line-923">
<div class="content">
<pre>_calledContract.calledFunction();</pre>
</div>
</div>
<div class="paragraph data-line-927">
<p>Here, we&#8217;re calling calledContract.calledFunction directly, using the high-level ABI for calledFunction. The event emitted is:</p>
</div>
<div class="listingblock data-line-929">
<div class="content">
<pre>sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10'</pre>
</div>
</div>
<div class="paragraph data-line-935">
<p>As you can see, msg.sender is the address of the caller contract. The tx.origin is the address of our account, web3.eth.accounts[0], that sent the transaction to caller. The event was emitted by calledContract, as we can see from the last argument in the event.</p>
</div>
<div class="paragraph data-line-937">
<p>The next call in make_calls is to the library:</p>
</div>
<div class="listingblock data-line-939">
<div class="content">
<pre>calledLibrary.calledFunction();</pre>
</div>
</div>
<div class="paragraph data-line-943">
<p>It looks identical to how we called the contract, but behaves very differently. Let&#8217;s look at the second event emitted:</p>
</div>
<div class="listingblock data-line-945">
<div class="content">
<pre>sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'</pre>
</div>
</div>
<div class="paragraph data-line-951">
<p>This time, the msg.sender is not the address of caller. Instead, it is the address of our account, and is the same as the transaction origin. That&#8217;s because when you call a library, the call is always delegatecall and runs within the context of the caller. So, when the calledLibrary code was running, it inherited the execution context of caller, as if its code was running inside caller. The variable this (shown as from in the event emitted) is the address of caller, even though it is accessed from within <span class="keep-together"><code>calledLibrary</code></span>.</p>
</div>
<div class="paragraph data-line-953">
<p>The next two calls, using the low-level call and delegatecall, verify our expectations, emitting events that mirror what we just saw.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-956">
<h3 id="gas_sec">Considérations sur le gaz</h3>
<div class="paragraph data-line-958">
<p>Gas, described in more detail in <a href="#gas">[gas]</a>, is an incredibly important consideration in smart contract programming. Gas is a resource constraining the maximum amount of computation that Ethereum will allow a transaction to consume. If the gas limit is exceeded during computation, the following series of events occurs:</p>
</div>
<div class="ulist data-line-960">
<ul>
<li class="data-line-960">
<p>An "out of gas" exception is thrown.</p>
</li>
<li class="data-line-961">
<p>The state of the contract prior to execution is restored (reverted).</p>
</li>
<li class="data-line-962">
<p>All ether used to pay for the gas is taken as a transaction fee; it is <em>not</em> refunded.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-964">
<p>Because gas is paid by the user who initiates the transaction, users are discouraged from calling functions that have a high gas cost. It is thus in the programmer&#8217;s best interest to minimize the gas cost of a contract&#8217;s functions. To this end, there are certain practices that are recommended when constructing smart contracts, so as to minimize the gas cost of a function call.</p>
</div>
<div class="sect3 data-line-966">
<h4 id="_éviter_les_tableaux_de_taille_dynamique">Éviter les tableaux de taille dynamique</h4>
<div class="paragraph data-line-968">
<p>Any loop through a dynamically sized array where a function performs operations on each element or searches for a particular element introduces the risk of using too much gas. Indeed, the contract may run out of gas before finding the desired result, or before acting on every element, thus wasting time and ether without giving any result at all.</p>
</div>
</div>
<div class="sect3 data-line-970">
<h4 id="_éviter_les_appels_à_dautres_contrats">Éviter les appels à d&#8217;autres contrats</h4>
<div class="paragraph data-line-972">
<p>Calling other contracts, especially when the gas cost of their functions is not known, introduces the risk of running out of gas. Avoid using libraries that are not well tested and broadly used. The less scrutiny a library has received from other programmers, the greater the risk of using it.</p>
</div>
</div>
<div class="sect3 data-line-974">
<h4 id="_estimation_du_coût_du_gaz">Estimation du coût du gaz</h4>
<div class="paragraph data-line-976">
<p>If you need to estimate the gas necessary to execute a certain method of a contract considering its arguments, you could use the following procedure:</p>
</div>
<div class="listingblock data-line-979">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var contract = web3.eth.contract(abi).at(address);
var gasEstimate = contract.myAweSomeMethod.estimateGas(arg1, arg2,
    {from: account});</code></pre>
</div>
</div>
<div class="paragraph data-line-983">
<p>gasEstimate will tell you the number of gas units needed for its execution. It is an estimate because of the Turing completeness of the EVM&#x2014;it is relatively trivial to create a function that will take vastly different amounts of gas to execute different calls. Even production code can change execution paths in subtle ways, resulting in hugely different gas costs from one call to the next. However, most functions are sensible and estimateGas will give a good estimate most of the time.</p>
</div>
<div class="paragraph data-line-985">
<p>To obtain the gas price from the network you can use:</p>
</div>
<div class="listingblock data-line-988">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var gasPrice = web3.eth.getGasPrice();</code></pre>
</div>
</div>
<div class="paragraph data-line-990">
<p>And from there you can estimate the gas cost:</p>
</div>
<div class="listingblock data-line-993">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var gasCostInEther = web3.utils.fromWei((gasEstimate * gasPrice), 'ether');</code></pre>
</div>
</div>
<div class="paragraph data-line-995">
<p>Let&#8217;s apply our gas estimation functions to estimating the gas cost of our Faucet example, using the code <a href="http://bit.ly/2zf0SIO" data-href="http://bit.ly/2zf0SIO">from the book&#8217;s repository</a>.</p>
</div>
<div class="paragraph data-line-997">
<p>Start Truffle in development mode and execute the JavaScript file in <a href="#estimateGas_function">gas_estimates.js: Using the estimateGas function</a>, <em>gas_estimates.js</em>.</p>
</div>
<div id="estimateGas_function" class="exampleblock data-line-1002">
<div class="title">Example 5. gas_estimates.js: Using the estimateGas function</div>
<div class="content">
<div class="listingblock data-line-1004">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var FaucetContract = artifacts.require("./Faucet.sol");

FaucetContract.web3.eth.getGasPrice(function(error, result) {
    var gasPrice = Number(result);
    console.log("Gas Price is " + gasPrice + " wei"); // "10000000000000"

    // Get the contract instance
    FaucetContract.deployed().then(function(FaucetContractInstance) {

		// Use the keyword 'estimateGas' after the function name to get the gas
		// estimation for this particular function (aprove)
		FaucetContractInstance.send(web3.utils.toWei(1, "ether"));
        return FaucetContractInstance.withdraw.estimateGas(web3.utils.toWei(0.1, "ether"));

    }).then(function(result) {
        var gas = Number(result);

        console.log("gas estimation = " + gas + " units");
        console.log("gas cost estimation = " + (gas * gasPrice) + " wei");
        console.log("gas cost estimation = " +
                FaucetContract.web3.utils.fromWei((gas * gasPrice), 'ether') + " ether");
    });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1031">
<p>Here&#8217;s how that looks in the Truffle development console:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle develop</strong>

truffle(develop)> <strong>exec gas_estimates.js</strong>
Using network 'develop'.

Gas Price is 20000000000 wei
gas estimation = 31397 units
gas cost estimation = 627940000000000 wei
gas cost estimation = 0.00062794 ether
</pre>
<div class="paragraph data-line-1047">
<p>It is recommended that you evaluate the gas cost of functions as part of your development workflow, to avoid any surprises when deploying contracts to the mainnet.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1049">
<h3 id="_conclusions">Conclusions</h3>
<div class="paragraph data-line-1051">
<p>In this chapter we started working with smart contracts in detail and explored the Solidity contract programming language. We took a simple example contract, <em>Faucet.sol</em>, and gradually improved it and made it more complex, using it to explore various aspects of the Solidity language. In <a href="#vyper_chap">[vyper_chap]</a> we will work with Vyper, another contract-oriented programming language. We will compare Vyper to Solidity, showing some of the differences in the design of these two languages and deepening our understanding of smart contract programming.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-26 01:01:56 -0400
</div>
</div>
</body>
</html>