<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>La machine virtuelle Ethereum</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="evm_chapter">La machine virtuelle Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Au cœur du protocole et du fonctionnement Ethereum se trouve la machine virtuelle Ethereum, ou EVM en abrégé. Comme vous pouvez le deviner d&#39;après son nom, il s&#39;agit d&#39;un moteur de calcul, pas très différent des machines virtuelles du cadre de développement .NET de Microsoft, ou des interprètes d&#39;autres langages de programmation compilés par bytecode tels que Java. Dans ce chapitre, nous examinons en détail l&#39;EVM, y compris son jeu d&#39;instructions, sa structure et son fonctionnement, dans le contexte des mises à jour d&#39;état d&#39;Ethereum.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="evm_description">Qu&#39;est-ce que l&#39;EVM ?</h3>
<div class="paragraph data-line-8">
<p>L&#39;EVM est la partie d&#39;Ethereum qui gère le déploiement et l&#39;exécution des contrats intelligents. Les transactions simples de transfert de valeur d&#39;un EOA à un autre n&#39;ont pas besoin de l&#39;impliquer, pratiquement, mais tout le reste impliquera une mise à jour d&#39;état calculée par l&#39;EVM. À un niveau élevé, l&#39;EVM fonctionnant sur la chaîne de blocs Ethereum peut être considéré comme un ordinateur mondial décentralisé contenant des millions d&#39;objets exécutables, chacun avec son propre magasin de données permanent.</p>
</div>
<div class="paragraph data-line-10">
<p>L&#39;EVM est une machine d&#39;état quasi–Turing-complète ; &quot;quasi&quot; car tous les processus d&#39;exécution sont limités à un nombre fini d&#39;étapes de calcul par la quantité de gaz disponible pour toute exécution de contrat intelligent donnée. En tant que tel, le problème d&#39;arrêt est &quot;résolu&quot; (toutes les exécutions de programme s&#39;arrêteront) et la situation où l&#39;exécution pourrait (accidentellement ou par malveillance) s&#39;exécuter indéfiniment, amenant ainsi la plate-forme Ethereum à s&#39;arrêter dans son intégralité, est évitée.</p>
</div>
<div class="paragraph data-line-12">
<p>L&#39;EVM a une architecture basée sur la pile, stockant toutes les valeurs en mémoire sur une pile. Il fonctionne avec une taille de mot de 256 bits (principalement pour faciliter les opérations de hachage natif et de courbe elliptique) et possède plusieurs composants de données adressables :</p>
</div>
<div class="ulist pagebreak-before data-line-15">
<ul>
<li class="data-line-15">
<p>Un <em>code de programme ROM</em> immuable, chargé avec le bytecode du smart contract à exécuter</p>
</li>
<li class="data-line-16">
<p>Une <em>mémoire</em> volatile, avec chaque emplacement explicitement initialisé à zéro</p>
</li>
<li class="data-line-17">
<p>Un <em>stockage</em> permanent qui fait partie de l&#39;état Ethereum, également initialisé à zéro</p>
</li>
</ul>
</div>
<div class="paragraph data-line-19">
<p>Il existe également un ensemble de variables d&#39;environnement et de données disponibles pendant l&#39;exécution. Nous les détaillerons plus loin dans ce chapitre.</p>
</div>
<div class="paragraph data-line-21">
<p><a href="#evm_architecture">L&#39;architecture et le contexte d&#39;exécution de la machine virtuelle Ethereum (EVM)</a> montre l&#39;architecture EVM et le contexte d&#39;exécution.</p>
</div>
<div id="evm_architecture" class="imageblock data-line-25">
<div class="content">
<img src="images/evm-architecture.png" alt="&quot;L&#39;architecture de la machine virtuelle Ethereum (EVM) et son contexte d&#39;exécution&quot;">
</div>
<div class="title">Figure 1. L&#39;architecture et le contexte d&#39;exécution de la machine virtuelle Ethereum (EVM)</div>
</div>
<div class="sect3 data-line-28">
<h4 id="evm_comparison">Comparaison avec la technologie existante</h4>
<div class="paragraph data-line-30">
<p>Le terme &quot;machine virtuelle&quot; est souvent appliqué à la virtualisation d&#39;un ordinateur réel, typiquement par un &quot;hyperviseur&quot; tel que VirtualBox ou QEMU, ou d&#39;une instance entière du système d&#39;exploitation, comme le KVM de Linux. Ceux-ci doivent fournir une abstraction logicielle, respectivement, du matériel réel, des appels système et des autres fonctionnalités du noyau.</p>
</div>
<div class="paragraph data-line-32">
<p>L&#39;EVM fonctionne dans un domaine beaucoup plus limité : c&#39;est juste un moteur de calcul, et en tant que tel fournit une abstraction du calcul et du stockage, similaire à la spécification Java Virtual Machine (JVM), par exemple. D&#39;un point de vue de haut niveau, la JVM est conçue pour fournir un environnement d&#39;exécution indépendant du système d&#39;exploitation ou du matériel hôte sous-jacent, permettant la compatibilité entre une grande variété de systèmes. Les langages de programmation de haut niveau tels que Java ou Scala (qui utilisent la JVM) ou C# (qui utilise .NET) sont compilés dans le jeu d&#39;instructions bytecode de leur machine virtuelle respective. De la même manière, l&#39;EVM exécute son propre jeu d&#39;instructions de bytecode (décrit dans la section suivante), dans lequel sont compilés des langages de programmation de contrats intelligents de niveau supérieur tels que LLL, Serpent, Mutan ou Solidity.</p>
</div>
<div class="paragraph data-line-34">
<p>L&#39;EVM n&#39;a donc aucune capacité de planification, car l&#39;ordre d&#39;exécution est organisé en externe - les clients Ethereum exécutent des transactions de bloc vérifiées pour déterminer quels contrats intelligents doivent être exécutés et dans quel ordre. En ce sens, l&#39;ordinateur mondial Ethereum est mono-fil (d&#8217;exécution), comme JavaScript. L&#39;EVM n&#39;a pas non plus de gestion &quot;d&#39;interface système&quot; ou de &quot;support matériel&quot; - il n&#39;y a pas de machine physique avec laquelle s&#39;interfacer. L&#39;ordinateur mondial Ethereum est entièrement virtuel.</p>
</div>
</div>
<div class="sect3 data-line-37">
<h4 id="evm_bytecode_overview">Le jeu d&#39;instructions EVM (opérations de bytecode)</h4>
<div class="paragraph data-line-39">
<p>Le jeu d&#39;instructions EVM offre la plupart des opérations que l&#8217;on peut s&#39;attendre, y compris :</p>
</div>
<div class="ulist data-line-41">
<ul>
<li class="data-line-41">
<p>Opérations arithmétiques et logiques au niveau du bit</p>
</li>
<li class="data-line-42">
<p>Enquêtes sur le contexte d&#39;exécution</p>
</li>
<li class="data-line-43">
<p>Accès à la pile, à la mémoire et au stockage</p>
</li>
<li class="data-line-44">
<p>Contrôler les opérations de flux</p>
</li>
<li class="data-line-45">
<p>Journalisation, appels et autres opérateurs</p>
</li>
</ul>
</div>
<div class="paragraph data-line-47">
<p>En plus des opérations de code intermédiaire typiques, l&#39;EVM a également accès aux informations de compte (par exemple, l&#39;adresse et le solde) et aux informations de bloc (par exemple, le numéro de bloc et le prix actuel du gaz).</p>
</div>
<div class="paragraph data-line-49">
<p>Commençons notre exploration de l&#39;EVM plus en détail en examinant les opcodes disponibles et ce qu&#39;ils font. Comme vous pouvez vous y attendre, tous les opérandes sont extraits de la pile et le résultat (le cas échéant) est souvent
remis sur le dessus de la pile.</p>
</div>
<div class="admonitionblock note data-line-53">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-54">
<p>Une liste complète des opcodes et leur coût de gaz correspondant peut être trouvée dans <a href="#evm_opcodes">[evm_opcodes]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-57">
<p>Les opcodes disponibles peuvent être divisés dans les catégories suivantes :</p>
</div>
<div id="arithmetic_opcodes" class="dlist data-line-60">
<dl>
<dt class="hdlist1">Opérations arithmétiques</dt>
<dd>
<p>Instructions d&#39;opcode arithmétique :</p>
<div class="listingblock data-line-62">
<div class="content">
<pre>ADD        // Ajouter les deux premiers éléments de la pile
MUL        // Multiplier les deux premiers éléments de la pile
SUB        // Soustraire les deux premiers éléments de la pile
DIV        // Division entière
SDIV       // Division d&amp;#39;entier signé
MOD        // Opération modulo (reste)
SMOD       // Opération modulo signée
ADDMOD     // Addition modulo n&amp;#39;importe quel nombre
MULMOD     // Multiplication modulo n&amp;#39;importe quel nombre
EXP        // Opération exponentielle
SIGNEXTEND // Étend la longueur d&amp;#39;un entier signé complément à deux
SHA3       // Calcule le hachage Keccak-256 d&amp;#39;un bloc de mémoire</pre>
</div>
</div>
<div class="paragraph data-line-77">
<p>Notez que toute l&#39;arithmétique est effectuée modulo 2<sup>256</sup> (sauf indication contraire) et que la puissance zéro de zéro, 0<sup>0</sup>, est considérée comme égale à 1.</p>
</div>
</dd>
</dl>
</div>
<div id="stack_opcodes" class="dlist data-line-81">
<dl>
<dt class="hdlist1">Opérations de pile </dt>
<dd>
<p>Instructions de gestion de la pile, de la mémoire et du stockage :</p>
<div class="listingblock data-line-83">
<div class="content">
<pre>POP        // Supprime l&amp;#39;élément du haut de la pile
MLOAD      // Charger un mot machine de la mémoire
MSTORE     // Enregistre un mot machine en mémoire
MSTORE8    // Enregistre un octet en mémoire
SLOAD      // Charger un mot machine depuis le stockage
SSTORE     // Enregistrer un mot machine dans le stockage
MSIZE      // Récupère la taille de la mémoire active en octets
PUSHx      // Place l&amp;#39;élément x octet sur la pile, où x peut être n&amp;#39;importe quel entier de
           // 1 à 32 (mot machine complet) inclus
DUPx       // Dupliquer le x-ième élément de la pile, où x peut être n&amp;#39;importe quel entier de
           // 1 à 16 inclus
SWAPx      // Échangez les 1er et (x+1)-ème éléments de la pile, où x peut être n&amp;#39;importe quel
           // entier de 1 à 16 inclus</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="flow_opcodes" class="dlist data-line-101">
<dl>
<dt class="hdlist1">Opérations de flux de processus </dt>
<dd>
<p>Instructions pour le flux de contrôle :</p>
<div class="listingblock data-line-103">
<div class="content">
<pre>STOP     // Arrête l&amp;#39;exécution
JUMP     // Mettre le compteur de programme à n&amp;#39;importe quelle valeur
JUMPI    // Modifier conditionnellement le compteur de programme
PC       // Récupérer la valeur du compteur de programme (avant l&amp;#39;incrément
         // correspondant à cette instruction)
JUMPDEST // Marquer une destination valide pour les sauts</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="system_opcodes" class="dlist data-line-113">
<dl>
<dt class="hdlist1">Opérations système </dt>
<dd>
<p>Opcodes pour le système exécutant le programme :</p>
<div class="listingblock data-line-115">
<div class="content">
<pre>LOGx         // Ajouter un enregistrement de journal avec x sujets, où x est n&amp;#39;importe quel entier
             // de 0 à 4 inclus
CREATE       // Créer un nouveau compte avec le code associé
CALL         // Message-appel dans un autre compte, c&amp;#39;est-à-dire exécuter un autre
             // code du compte
CALLCODE     // Message-appel dans ce compte avec un autre
             // code du compte
RETURN       // Arrête l&amp;#39;exécution et renvoie les données de sortie
DELEGATECALL // Message-appel dans ce compte avec une alternative
             // code du compte, mais en conservant les valeurs actuelles pour
             // sender et value
STATICCALL   // Message-appel statique dans un compte
REVERT       // Arrête l&amp;#39;exécution, annule les changements d&amp;#39;état mais retourne
             // des données et le gaz restant
INVALID      // L&amp;#39;instruction invalide désignée
SELFDESTRUCT // Arrête l&amp;#39;exécution et enregistre le compte pour suppression</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="logic_opcides" class="dlist data-line-135">
<dl>
<dt class="hdlist1">Opérations logiques </dt>
<dd>
<p>Opcodes pour les comparaisons et la logique au niveau du bit :</p>
<div class="listingblock data-line-137">
<div class="content">
<pre>LT     // Comparaison inférieure à
GT     // Comparaison supérieure à
SLT    // Comparaison inférieure signée
SGT    // Comparaison supérieure signée
EQ     // Comparaison d&amp;#39;égalité
ISZERO // Opérateur NOT simple
AND    // Opération AND au niveau du bit
OR     // Opération OR au niveau du bit
XOR    // Opération XOR au niveau du bit
NOT    // Opération NOT au niveau du bit
BYTE   // Récupérer un seul octet d&amp;#39;un mot pleine largeur de 256 bits</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="environment_opcodes" class="dlist data-line-152">
<dl>
<dt class="hdlist1">Opérations environnementales </dt>
<dd>
<p>Opcodes traitant des informations sur l&#39;environnement d&#39;exécution :</p>
<div class="listingblock data-line-154">
<div class="content">
<pre>GAZ            // Obtenir la quantité de gaz disponible (après la réduction pour
               // cette instruction)
ADRESSE        // Obtenir l&amp;#39;adresse du compte en cours d&amp;#39;exécution
SOLDE          // Obtenir le solde du compte d&amp;#39;un compte donné
ORIGIN         // Obtenir l&amp;#39;adresse de l&amp;#39;EOA qui a lancé cette
               // éxecution EVM
APPELANT       // Obtenir l&amp;#39;adresse de l&amp;#39;appelant immédiatement responsable
               // pour cette exécution
CALLVALUE      // Obtenir le montant en ether déposé par l&amp;#39;appelant responsable
               // pour cette exécution
CALLDATALOAD   // Récupère les données d&amp;#39;entrée envoyées par l&amp;#39;appelant responsable de
               // cette exécution
CALLDATASIZE   // Récupère la taille des données d&amp;#39;entrée
CALLDATACOPY   // Copie les données d&amp;#39;entrée dans la mémoire
CODESIZE       // Récupère la taille du code en cours d&amp;#39;exécution dans l&amp;#39;environnement actuel
CODECOPY       // Copiez le code en cours d&amp;#39;exécution dans l&amp;#39;environnement actuel vers
               // la mémoire
GASPRICE       // Obtenir le prix du gaz spécifié par la
               // transaction d&amp;#39;origine
EXTCODESIZE    // Récupère la taille du code de n&amp;#39;importe quel compte
EXTCODECOPY    // Copie le code de n&amp;#39;importe quel compte en mémoire
RETURNDATASIZE // Récupère la taille des données de sortie de l&amp;#39;appel précédent
               // dans l&amp;#39;environnement actuel
RETURNDATACOPY // Copie la sortie des données de l&amp;#39;appel précédent dans la mémoire</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="block_opcodes" class="dlist data-line-182">
<dl>
<dt class="hdlist1">Opérations sur les blocs</dt>
<dd>
<p>Opcodes pour accéder aux informations sur le bloc actuel :</p>
<div class="listingblock data-line-184">
<div class="content">
<pre>BLOCKHASH  // Obtenir le hachage de l&amp;#39;un des 256 derniers
           // blocs complétés
COINBASE   // Obtenir l&amp;#39;adresse du bénéficiaire du bloc pour la récompense du bloc
TIMESTAMP  // Récupère l&amp;#39;horodatage du bloc
NUMBER     // Récupère le numéro du bloc
DIFFICULTY // Obtenir la difficulté du bloc
GASLIMIT   // Récupère la limite de gaz du bloc</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-195">
<h4 id="evm_state_descriptions">État Ethereum</h4>
<div class="paragraph data-line-197">
<p>Le travail de l&#39;EVM consiste à mettre à jour l&#39;état Ethereum en calculant des transitions d&#39;état valides à la suite de l&#39;exécution du code de contrat intelligent, tel que défini par le protocole Ethereum. Cet aspect conduit à la description d&#39;Ethereum comme une <em>machine à états basée sur les transactions</em>, qui reflète le fait que des acteurs externes (c&#39;est-à-dire les titulaires de compte et les mineurs) initient des transitions d&#39;état en créant, acceptant et ordonnant des transactions. Il est utile à ce stade de considérer ce qui constitue l&#39;état Ethereum.</p>
</div>
<div class="paragraph data-line-199">
<p>Au niveau supérieur, nous avons l&#39;état <em>mondial</em> d&#39;Ethereum. L&#39;état mondial est un mappage des adresses Ethereum (valeurs 160 bits) vers des <em>comptes</em>. Au niveau inférieur, chaque adresse Ethereum représente un compte comprenant un <em>solde</em> d&#8217;ether (stocké comme le nombre de wei détenu par le compte), un <em>nonce</em> (représentant le nombre de transactions envoyées avec succès depuis ce compte s&#39;il s&#39;agit d&#39;un EOA, ou le nombre de contrats créés par celui-ci s&#39;il s&#39;agit d&#39;un compte contractuel), le <em>stockage</em> du compte (qui est une donnée permanente store, utilisé uniquement par les contrats intelligents) et le <em>code programme</em> du compte (encore une fois, uniquement si le compte est un compte de contrat intelligent). Un EOA n&#39;aura toujours aucun code et un stockage vide.</p>
</div>
<div class="paragraph data-line-205">
<p>Lorsqu&#39;une transaction entraîne l&#39;exécution d&#39;un code de contrat intelligent, une EVM est instanciée avec toutes les informations requises par rapport au bloc en cours de création et à la transaction spécifique en cours de traitement. En particulier, la ROM de code de programme de l&#39;EVM est chargée avec le code du compte de contrat appelé, le compteur de programme est mis à zéro, la mémoire est chargée à partir de la mémoire du compte de contrat, la mémoire est mise à zéro, et tout le bloc et les variables d&#39;environnement sont définies. Une variable clé est l&#39;approvisionnement en gaz pour cette exécution, qui est fixé à la quantité de gaz payée par l&#39;expéditeur au début de la transaction (voir <a href="#gas">Gaz</a> pour plus de détails). Au fur et à mesure de l&#39;exécution du code, l&#39;alimentation en gaz est réduite en fonction du coût en gaz des opérations exécutées. Si, à un moment quelconque, l&#39;alimentation en gaz est réduite à zéro, nous obtenons une exception &quot;Out of Gas&quot; (OOG) ; l&#39;exécution s&#39;arrête immédiatement et la transaction est abandonnée. Aucune modification de l&#39;état d&#39;Ethereum n&#39;est appliquée, à l&#39;exception du nonce de l&#39;expéditeur qui est incrémenté et de son solde d&#39;ether qui diminue pour payer le bénéficiaire du bloc pour les ressources utilisées pour exécuter le code jusqu&#39;au point d&#39;arrêt. À ce stade, vous pouvez penser à l&#39;EVM s&#39;exécutant sur une copie en bac à sable de l&#39;état mondial d&#39;Ethereum, cette version en bac à sable étant complètement supprimée si l&#39;exécution ne peut pas se terminer pour une raison quelconque. Cependant, si l&#39;exécution réussit, l&#39;état réel est mis à jour pour correspondre à la version en bac à sable, y compris toute modification des données de stockage du contrat appelé, tout nouveau contrat créé et tout transfert de solde d&#39;ether initié.</p>
</div>
<div class="paragraph data-line-207">
<p>Notez que, comme un contrat intelligent peut lui-même initier efficacement des transactions, l&#39;exécution de code est un processus récursif. Un contrat peut appeler d&#39;autres contrats, chaque appel entraînant l&#39;instanciation d&#39;un autre EVM autour de la nouvelle cible de l&#39;appel. Chaque instanciation a son état mondial de bac à sable initialisé à partir du bac à sable de l&#39;EVM au niveau supérieur. Chaque instanciation reçoit également une quantité spécifiée de gaz pour son alimentation en gaz (n&#39;excédant pas la quantité de gaz restant dans le niveau supérieur, bien sûr), et peut donc elle-même s&#39;arrêter à une exception près en raison du manque de gaz pour terminer son exécution . Encore une fois, dans de tels cas, l&#39;état du bac à sable est ignoré et l&#39;exécution revient à l&#39;EVM au niveau supérieur.</p>
</div>
</div>
<div class="sect3 data-line-210">
<h4 id="compiling_solidity_to_evm">Compilation de Solidity en code intermédiaire EVM</h4>
<div id="solc_help" class="paragraph data-line-213">
<p>La compilation un fichier source Solidity en code intermédiaire EVM peut être réalisé via plusieurs méthodes. Dans <a href="#intro_chapter">[intro_chapter]</a> nous avons utilisé le compilateur Remix en ligne. Dans ce chapitre, nous utiliserons l&#39;exécutable solc en ligne de commande. Pour une liste d&#39;options, exécutez la <span class="keep-together">commande</span> suivante :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --help</strong>

</pre>
<div id="solc_opcodes_option" class="paragraph data-line-223">
<p>La génération du flux d&#39;opcode brut d&#39;un fichier source Solidity est facilement réalisée avec l&#39;option de ligne de commande --opcodes. Ce flux d&#39;opcode laisse de côté certaines informations (l&#39;option --asm produit les informations complètes), mais c&#39;est suffisant pour cette discussion. Par exemple, la compilation d&#39;un exemple de fichier Solidity, <em>Example.sol</em>, et l&#39;envoi de la sortie de l&#39;opcode dans un répertoire nommé <em>BytecodeDir</em> s&#39;effectuent avec la commande suivante :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --opcodes Example.sol</strong>

</pre>
<div class="paragraph data-line-232">
<p>ou alors:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --asm Example.sol</strong>

</pre>
<div id="solc_bin_option" class="paragraph data-line-242">
<p>La commande suivante produira le code intermédiaire binaire pour notre exemple de programme :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --bin Example.sol</strong>

</pre>
<div class="paragraph data-line-251">
<p>Les fichiers d&#39;opcode de sortie générés dépendront des contrats spécifiques contenus dans le fichier source Solidity. Notre fichier Solidity simple <em>Example.sol</em> n&#39;a qu&#39;un seul contrat, nommé example :</p>
</div>
<div id="simple_solidity_example" class="listingblock data-line-255">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.19;

contract example {

  address contractOwner;

  function example() {
    contractOwner = msg.sender;
  }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-268">
<p>Comme vous pouvez le voir, ce contrat ne contient qu&#39;une seule variable d&#39;état persistante, qui est définie comme l&#39;adresse du dernier compte pour exécuter ce contrat.</p>
</div>
<div class="paragraph data-line-270">
<p>Si vous regardez dans le répertoire <em>BytecodeDir</em>, vous verrez le fichier d&#39;opcode <em>example.opcode</em>, qui contient les instructions d&#39;opcode EVM du contrat example. L&#39;ouverture du fichier <em>example.opcode</em> dans un éditeur de texte affichera ce qui suit :</p>
</div>
<div id="opcode_output" class="listingblock data-line-273">
<div class="content">
<pre>PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH1 0xE JUMPI PUSH1 0x0 DUP1
REVERT JUMPDEST CALLER PUSH1 0x0 DUP1 PUSH2 0x100 EXP DUP2 SLOAD DUP2 PUSH20
0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF MUL NOT AND SWAP1 DUP4 PUSH20
0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF AND MUL OR SWAP1 SSTORE POP PUSH1
0x35 DUP1 PUSH1 0x5B PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x60 PUSH1
0x40 MSTORE PUSH1 0x0 DUP1 REVERT STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 JUMP
0xb9 SWAP14 0xcb 0x1e 0xdd RETURNDATACOPY 0xec 0xe0 0x1f 0x27 0xc9 PUSH5
0x9C5ABCC14A NUMBER 0x5e INVALID EXTCODESIZE 0xdb 0xcf EXTCODESIZE 0x27
EXTCODESIZE 0xe2 0xb8 SWAP10 0xed 0x</pre>
</div>
</div>
<div class="paragraph data-line-285">
<p>Compiler l&#39;exemple avec l&#39;option --asm produit un fichier nommé <em>example.evm</em> dans notre répertoire <em>BytecodeDir</em>. Celui-ci contient une description de niveau légèrement supérieur des instructions du bytecode EVM, ainsi que quelques annotations utiles :</p>
</div>
<div id="asm_output" class="listingblock data-line-289">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">/* "Example.sol":26:132  contract example {... */
  mstore(0x40, 0x60)
    /* "Example.sol":74:130  function example() {... */
  jumpi(tag_1, iszero(callvalue))
  0x0
  dup1
  revert
tag_1:
    /* "Example.sol":115:125  msg.sender */
  caller
    /* "Example.sol":99:112  contractOwner */
  0x0
  dup1
    /* "Example.sol":99:125  contractOwner = msg.sender */
  0x100
  exp
  dup2
  sload
  dup2
  0xffffffffffffffffffffffffffffffffffffffff
  mul
  not
  and
  swap1
  dup4
  0xffffffffffffffffffffffffffffffffffffffff
  and
  mul
  or
  swap1
  sstore
  pop
    /* "Example.sol":26:132  contract example {... */
  dataSize(sub_0)
  dup1
  dataOffset(sub_0)
  0x0
  codecopy
  0x0
  return
stop

sub_0: assembly {
        /* "Example.sol":26:132  contract example {... */
      mstore(0x40, 0x60)
      0x0
      dup1
      revert

    auxdata: 0xa165627a7a7230582056b99dcb1edd3eece01f27c9649c5abcc14a435efe3b...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-343">
<p>The --bin-runtime option produces the machine-readable hexadecimal bytecode:</p>
</div>
<div id="bin_output" class="listingblock data-line-346">
<div class="content">
<pre>60606040523415600e57600080fd5b336000806101000a81548173
ffffffffffffffffffffffffffffffffffffffff
021916908373
ffffffffffffffffffffffffffffffffffffffff
160217905550603580605b6000396000f3006060604052600080fd00a165627a7a7230582056b...</pre>
</div>
</div>
<div class="paragraph data-line-354">
<p>Vous pouvez enquêter sur ce qui se passe ici en détail en utilisant la liste des opcodes donnée dans <a href="#evm_bytecode_overview">Le jeu d&#39;instructions EVM (opérations de bytecode)</a>. Cependant, c&#39;est toute une tâche, alors commençons par examiner les quatre premières instructions :</p>
</div>
<div id="opcode_analysis_1" class="listingblock data-line-357">
<div class="content">
<pre>PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE</pre>
</div>
</div>
<div class="paragraph data-line-361">
<p>Ici, nous avons PUSH1 suivi d&#39;un octet brut de valeur 0x60. Cette instruction EVM prend l&#39;octet unique suivant l&#39;opcode dans le code du programme (en tant que valeur littérale) et le pousse sur la pile. Il est possible de pousser des valeurs de taille jusqu&#39;à 32 octets sur la pile, comme dans :</p>
</div>
<div class="listingblock data-line-363">
<div class="content">
<pre>PUSH32 0x436f6e67726174756c6174696f6e732120536f6f6e20746f206d617374657221</pre>
</div>
</div>
<div class="paragraph data-line-367">
<p>Le deuxième opcode PUSH1 de <em>example.opcode</em> stocke 0x40 en haut de la pile (en poussant le 0x60 déjà présent d&#39;un emplacement vers le bas).</p>
</div>
<div class="paragraph data-line-369">
<p>Vient ensuite MSTORE, qui est une opération de stockage en mémoire qui enregistre une valeur dans la mémoire de l&#39;EVM. Il prend deux arguments et, comme la plupart des opérations EVM, les obtient de la pile. Pour chaque argument, la pile est “poppée” (popped) c&#39;est-à-dire que la valeur supérieure de la pile est retirée et toutes les autres valeurs de la pile sont décalées d&#39;une position. Le premier argument de MSTORE est l&#39;adresse du mot en mémoire où sera mise la valeur à sauvegarder. Pour ce programme, nous avons 0x40 en haut de la pile, de sorte qu&#39;il est retiré de la pile et utilisé comme adresse mémoire. Le deuxième argument est la valeur à sauvegarder, qui est 0x60 ici. Après l&#39;exécution de l&#39;opération MSTORE, notre pile est à nouveau vide, mais nous avons la valeur 0x60 (96 en décimal) à l&#39;emplacement mémoire 0x40.</p>
</div>
<div class="paragraph data-line-371">
<p>L&#39;opcode suivant est CALLVALUE, qui est un opcode environnemental qui pousse vers le haut de la pile la quantité d&#39;ether (mesurée en wei) envoyée avec l&#39;appel de message qui a initié cette exécution.</p>
</div>
<div class="paragraph data-line-373">
<p>Nous pourrions continuer à parcourir ce programme de cette manière jusqu&#39;à ce que nous ayons une compréhension complète des changements d&#39;état de bas niveau que ce code effectue, mais cela ne nous aiderait pas à ce stade. Nous y reviendrons plus tard dans le chapitre. </p>
</div>
</div>
<div class="sect3 data-line-376">
<h4 id="contract_deployment_code">Code de déploiement du contrat</h4>
<div class="paragraph data-line-378">
<p>Il existe une différence importante mais subtile entre le code utilisé lors de la création et du déploiement d&#39;un nouveau contrat sur la plateforme Ethereum et le code du contrat lui-même. Afin de créer un nouveau contrat, une transaction spéciale est nécessaire dont le champ to est défini sur l&#39;adresse spéciale 0x0 et son champ data défini sur le <em>code d&#39;initiation</em> du contrat. Lorsqu&#39;une telle transaction de création de contrat est traitée, le code du nouveau compte de contrat n&#39;est <em>pas</em> le code du champ données de la transaction. Au lieu de cela, un EVM est instancié avec le code dans le champ data de la transaction chargée dans sa ROM de code de programme, puis la sortie de l&#39;exécution de ce code de déploiement est prise comme code pour le nouveau compte de contrat. C&#39;est ainsi que de nouveaux contrats peuvent être initialisés par programme en utilisant l&#39;état mondial Ethereum au moment du déploiement, en définissant des valeurs dans le stockage du contrat et même en envoyant de l&#39;ether ou en créant de nouveaux contrats.</p>
</div>
<div class="paragraph data-line-380">
<p>Lors de la compilation d&#39;un contrat hors ligne, par exemple, en utilisant solc sur la ligne de commande, vous pouvez soit obtenir le <em>code intermédiaire de déploiement</em> ou le <em>code intermédiaire d&#8217;exécution</em>.</p>
</div>
<div class="paragraph data-line-382">
<p>Le code intermédiaire de déploiement est utilisé pour chaque aspect de l&#39;initialisation d&#39;un nouveau compte de contrat, y compris le code intermédiaire qui finira par être exécuté lorsque les transactions appelleront ce nouveau contrat (c&#39;est-à-dire le code intermédiaire d&#39;exécution) et le code pour tout initialiser en fonction du constructeur du contrat.</p>
</div>
<div class="paragraph data-line-384">
<p>Le code intermédiaire d&#8217;exécution, en revanche, est exactement le bytecode qui finit par être exécuté lorsque le nouveau contrat est appelé, et rien de plus ; il n&#39;inclut pas le code intermédiaire nécessaire pour initialiser le contrat lors du déploiement.</p>
</div>
<div class="paragraph data-line-386">
<p>Prenons comme exemple le simple contrat <em>Faucet.sol</em> que nous avons créé précédemment :</p>
</div>
<div id="faucet_example" class="listingblock data-line-390">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version du compilateur Solidity pour lequel ce programme a été écrit
pragma solidity ^0.4.19;

// Notre premier contrat est un robinet !
contract Faucet {

  // Donnez de l&amp;#39;éther à quiconque demande
  function withdraw(uint withdraw_amount) public {

      // Limiter le montant du retrait
      require(withdraw_amount &lt;= 100000000000000000);

      // Envoie le montant à l&amp;#39;adresse qui l&amp;#39;a demandé
      msg.sender.transfer(withdraw_amount);
    }

  // Accepte tout montant entrant
  function () external payable {}

}</code></pre>
</div>
</div>
<div class="paragraph data-line-413">
<p>Pour obtenir le code intermédiaire de déploiement, nous exécuterions <code>solc --bin Faucet.sol</code>. Si nous voulions plutôt uniquement le code intermédiaire d&#39;exécution, nous exécuterions <code>solc --bin-runtime <span class="keep-together">Faucet.sol</span></code>.</p>
</div>
<div class="paragraph data-line-415">
<p>Si vous comparez la sortie de ces commandes, vous verrez que le code intermédiaire d&#39;exécution est un sous-ensemble du code intermédiaire de déploiement. En d&#39;autres termes, le code intermédiaire d&#39;exécution est entièrement contenu dans le code intermédiaire de déploiement.</p>
</div>
</div>
<div class="sect3 data-line-418">
<h4 id="disassembling_the_bytecode">Désassemblage du code intermédiaire</h4>
<div class="paragraph data-line-420">
<p>Le désassemblage du code intermédiaire EVM est un excellent moyen de comprendre comment le haut niveau de Solidity agit dans l&#39;EVM. Il existe quelques désassembleurs que vous pouvez utiliser pour cela :</p>
</div>
<div class="ulist data-line-422">
<ul>
<li class="data-line-422">
<p><a href="https://github.com/comaeio/porosity" data-href="https://github.com/comaeio/porosity"><em>Porosity</em></a> est un décompilateur à source libre populaire.</p>
</li>
<li class="data-line-423">
<p><a href="https://github.com/trailofbits/ethersplay" data-href="https://github.com/trailofbits/ethersplay"><em>Ethersplay</em></a> est un plug-in EVM pour Binary Ninja, un désassembleur.</p>
</li>
<li class="data-line-424">
<p><a href="https://github.com/trailofbits/ida-evm" data-href="https://github.com/trailofbits/ida-evm"><em>IDA-Evm</em></a> est un plugin EVM pour IDA, un autre désassembleur.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-426">
<p>Dans cette section, nous utiliserons le plug-in Ethersplay pour Binary Ninja et pour commencer <a href="#Faucet_disassembled">Démontage du code intermédiaire d&#39;exécution du robinet</a>. Après avoir obtenu le code intermédiaire d&#39;exécution de <em>Faucet.sol</em>, nous pouvons l&#39;introduire dans Binary Ninja (après avoir chargé le plug-in Ethersplay) pour voir à quoi ressemblent les instructions EVM.</p>
</div>
<div id="Faucet_disassembled" class="imageblock data-line-430">
<div class="content">
<img src="images/Faucet_disassembled.png" alt="&quot;Le code intermédiaire d&#39;exécution de Faucet.sol a été désassemblé&quot;">
</div>
<div class="title">Figure 2. Démontage du code intermédiaire d&#39;exécution du robinet</div>
</div>
<div class="paragraph data-line-432">
<p>Lorsque vous envoyez une transaction à un contrat intelligent compatible ABI (ce que vous pouvez supposer que tous les contrats le sont), la transaction interagit d&#39;abord avec le <em>répartiteur</em> de ce contrat intelligent. Le répartiteur lit le champ data de la transaction et envoie la partie pertinente à la fonction appropriée. Nous pouvons voir un exemple de répartiteur au début de notre code intermédiaire d&#39;exécution <em>Faucet.sol</em> désassemblé. Après l&#39;instruction familière MSTORE, nous voyons les instructions suivantes :</p>
</div>
<div id="faucet_instructions" class="listingblock data-line-435">
<div class="content">
<pre>PUSH1 0x4
CALLDATASIZE
LT
PUSH1 0x3f
JUMPI</pre>
</div>
</div>
<div class="paragraph data-line-443">
<p>Comme nous l&#39;avons vu, PUSH1 0x4 place 0x4 en haut de la pile, qui est autrement vide. CALLDATASIZE obtient la taille en octets des données envoyées avec la transaction (appelée <em>calldata</em>) et pousse ce nombre sur la pile. Une fois ces opérations exécutées, la pile ressemble à ceci :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-446" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;length of calldata from tx&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-452">
<p>Cette instruction suivante est LT, abréviation de &quot;plus petit que&quot;. L&#39;instruction LT vérifie si l&#39;élément du haut de la pile est inférieur à l&#39;élément suivant de la pile. Dans notre cas, il vérifie si le résultat de CALLDATASIZE est inférieur à 4 octets.</p>
</div>
<div class="paragraph data-line-454">
<p>Pourquoi l&#39;EVM vérifie-t-il que les données d&#39;appel de la transaction font au moins 4 octets ? En raison du fonctionnement des identificateurs de fonction. Chaque fonction est identifiée par les 4 premiers octets de son hachage Keccak-256. En plaçant le nom de la fonction et les arguments qu&#39;elle prend dans une fonction de hachage keccak256, nous pouvons déduire son identifiant de fonction. Dans notre cas, nous avons :</p>
</div>
<div id="faucet_function_identifier" class="listingblock data-line-457">
<div class="content">
<pre class="highlight"><code>keccak256("withdraw(uint256)") = 0x2e1a7d4d...</code></pre>
</div>
</div>
<div class="paragraph data-line-461">
<p>Ainsi, l&#39;identifiant de fonction pour la fonction withdraw(uint256) est 0x2e1a7d4d, puisqu&#39;il s&#39;agit des 4 premiers octets du hachage résultant. Un identifiant de fonction a toujours une longueur de 4 octets, donc si le champ entier data de la transaction envoyée au contrat est inférieur à 4 octets, alors il n&#39;y a pas de fonction avec laquelle la transaction pourrait éventuellement communiquer, à moins qu&#39;une <em>fonction de secours</em> ne soit définie. Parce que nous avons implémenté une telle fonction de secours dans <em>Faucet.sol</em>, l&#39;EVM saute à cette fonction lorsque la longueur des données d&#39;appel est inférieure à 4 octets.</p>
</div>
<div class="paragraph data-line-463">
<p>LT retire les deux premières valeurs de la pile et, si le champ data de la transaction est inférieur à 4 octets, il y pousse un 1. Sinon, il pousse un 0. Dans notre exemple, supposons que le champ data de la transaction envoyée à notre contrat <em>était</em> inférieur à 4 octets.</p>
</div>
<div class="paragraph data-line-465">
<p>L&#39;instruction PUSH1 0x3f pousse l&#39;octet 0x3f sur la pile. Après cette instruction, la pile ressemble à ceci :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-468" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3f</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-474">
<p>L&#39;instruction suivante est JUMPI, qui signifie &quot;sauter si&quot;. Cela fonctionne comme ceci :</p>
</div>
<div id="faucet_jump_instruction_text" class="listingblock data-line-477">
<div class="content">
<pre>jumpi(label, cond) // Aller à &amp;quot;label&amp;quot; si &amp;quot;cond&amp;quot; est vrai</pre>
</div>
</div>
<div class="paragraph data-line-481">
<p>Dans notre cas, label est 0x3f, où réside notre fonction de secours dans notre contrat intelligent. L&#39;argument cond est 1, qui était le résultat de l&#39;instruction LT précédente. Pour mettre toute cette séquence en mots, le contrat passe à la fonction de repli si les données de transaction sont inférieures à 4 octets.</p>
</div>
<div class="paragraph data-line-483">
<p>À 0x3f, seule une instruction STOP suit, car bien que nous ayons déclaré une fonction de repli, nous l&#39;avons laissée vide. Comme vous pouvez le voir dans <a href="#Faucet_jumpi_instruction">Instruction JUMPI menant à la fonction de repli</a>, si nous n&#39;avions pas implémenté une fonction de secours, le contrat lèverait une exception à la place.</p>
</div>
<div id="Faucet_jumpi_instruction" class="imageblock data-line-487">
<div class="content">
<img src="images/Faucet_jumpi_instruction.png" alt="&quot;Instruction JUMPI menant à la fonction de repli&quot;">
</div>
<div class="title">Figure 3. Instruction JUMPI menant à la fonction de repli</div>
</div>
<div class="paragraph data-line-489">
<p>Examinons le bloc central du répartiteur. En supposant que nous recevions des données d&#39;appel d&#39;une longueur supérieure à 4 octets, l&#39;instruction JUMPI ne passerait pas à la fonction de repli. Au lieu de cela, l&#39;exécution du code procéderait aux instructions suivantes :</p>
</div>
<div id="faucet_instructions2" class="listingblock data-line-492">
<div class="content">
<pre>PUSH1 0x0
CALLDATALOAD
PUSH29 0x1000000...
SWAP1
DIV
PUSH4 0xffffffff
AND
DUP1
PUSH4 0x2e1a7d4d
EQ
PUSH1 0x41
JUMPI</pre>
</div>
</div>
<div class="paragraph data-line-507">
<p>PUSH1 0x0 pousse 0 sur la pile, qui est maintenant à nouveau vide. CALLDATALOAD accepte comme argument un index dans les données d&#39;appel envoyées au contrat intelligent et lit 32 octets à partir de cet index, comme ceci :</p>
</div>
<div id="faucet_calldataload_instruction_text" class="listingblock data-line-510">
<div class="content">
<pre>calldataload(p) //charge 32 octets de données d&amp;#39;appel à partir de la position d&amp;#39;octet p</pre>
</div>
</div>
<div class="paragraph data-line-514">
<p>Puisque 0 était l&#39;index qui lui a été transmis par la commande PUSH1 0x0, CALLDATALOAD lit 32 octets de données d&#39;appel à partir de l&#39;octet 0, puis le pousse vers le haut de la pile (après avoir extrait le 0x0 d&#39;origine). Après l&#39;instruction PUSH29 0x1000000&#8230;&#8203;, la pile est alors :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-517" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000000&#8230;&#8203; (longueur de 29 octets)</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;32 bytes of calldata starting at byte 0&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-523">
<p>SWAP1 commute l&#39;élément supérieur sur la pile avec le <em>i</em>-ème élément après lui. Dans ce cas, il échange 0x1000000&#8230;&#8203; avec le calldata. La nouvelle pile est :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-526" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;32 bytes of calldata starting at byte 0&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000000&#8230;&#8203; (longueur de 29 octets)</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-532">
<p>L&#39;instruction suivante est DIV, qui fonctionne comme suit :</p>
</div>
<div id="faucet_div_instruction_text" class="listingblock data-line-535">
<div class="content">
<pre>div(x, y) // division entière x / y</pre>
</div>
</div>
<div class="paragraph data-line-539">
<p>Dans ce cas, x = 32 octets de calldata commençant à l&#39;octet 0, et y = 0x100000000&#8230;&#8203; (29 octets au total). Pouvez-vous penser à la raison pour laquelle le répartiteur fait la division ? Voici un indice : nous avons lu 32 octets de calldata plus tôt, en commençant à l&#39;index 0. Les 4 premiers octets de cette calldata sont l&#39;identifiant de la fonction.</p>
</div>
<div class="paragraph data-line-542">
<p>Le 0x100000000&#8230;&#8203; que nous avons poussé plus tôt fait 29 octets de long, composé d&#39;un 1 au début, suivi de tous les 0. Diviser nos 32 octets de données d&#39;appel par cette valeur ne nous laissera que les <em>4 octets les plus élevés</em> de notre charge de données d&#39;appel, à partir de l&#39;index 0. Ces 4 octets - les 4 premiers octets des données d&#39;appel commençant à l&#39;index 0 - sont l&#39;identifiant de la fonction, et cela est la façon dont l&#39;EVM extrait ce champ.</p>
</div>
<div class="paragraph data-line-544">
<p>Si cette partie n&#39;est pas claire pour vous, pensez-y comme ceci : en base 10, 1234000 / 1000 = 1234. En base 16, ce n&#39;est pas différent. Au lieu que chaque lieu soit un multiple de 10, c&#39;est un multiple de 16. Tout comme la division par 10<sup>3</sup> (1000) dans notre petit exemple ne conservait que les chiffres les plus élevés, divisant notre valeur de base 16 de 32 octets par 16<sup>29</sup> fait de même.</p>
</div>
<div class="paragraph data-line-546">
<p>Le résultat du DIV (l&#39;identifiant de la fonction) est poussé sur la pile, et notre pile est maintenant :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-549" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-554">
<p>Étant donné que les instructions PUSH4 0xffffffff et AND sont redondantes, nous pouvons les ignorer complètement, car la pile restera la même après leur exécution. L&#39;instruction DUP1 duplique le premier élément de la pile, qui est l&#39;identificateur de la fonction. L&#39;instruction suivante, PUSH4 0x2e1a7d4d, pousse l&#39;identificateur de fonction précalculé de la fonction <code><span class="keep-together">withdraw</span> (uint256)</code> sur la pile. La pile est maintenant :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-557" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2e1a7d4d</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-564">
<p>L&#39;instruction suivante, EQ, extrait les deux premiers éléments de la pile et les compare. C&#39;est là que le répartiteur fait son travail principal : il compare si l&#39;identifiant de la fonction envoyé dans le champ msg.data de la transaction correspond à celui de <code><span class="keep-together">withdraw</span> (uint256)</code>. S&#39;ils sont égaux, EQ pousse 1 sur la pile, qui sera finalement utilisé pour passer à la fonction de retrait. Sinon, EQ pousse 0 sur la pile.</p>
</div>
<div class="paragraph data-line-566">
<p>En supposant que la transaction envoyée à notre contrat a bien commencé avec l&#39;identifiant de fonction pour withdraw(uint256), notre pile est devenue :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-569" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt; (maintenant connu pour être 0x2e1a7d4d)</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-575">
<p>Ensuite, nous avons PUSH1 0x41, qui est l&#39;adresse à laquelle la fonction withdraw(uint256) vit dans le contrat. Après cette instruction, la pile ressemble à ceci :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-578" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x41</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identifiant de la fonction envoyé dans msg.data</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-585">
<p>L&#39;instruction JUMPI est la suivante, et elle accepte à nouveau les deux premiers éléments de la pile comme arguments. Dans ce cas, nous avons jumpi(0x41, 1), qui indique à l&#39;EVM d&#39;exécuter le saut vers l&#39;emplacement de la fonction withdraw(uint256), et l&#39;exécution du code de cette fonction peut continuer.</p>
</div>
</div>
</div>
<div class="sect2 data-line-588">
<h3 id="turing_completeness_and_gas">Complétude de Turing et Gaz</h3>
<div class="paragraph data-line-590">
<p>Comme nous l&#39;avons déjà évoqué, en termes simples, un système ou langage de programmation est <em>Turing complet</em> s&#39;il peut exécuter n&#39;importe quel programme. Cette capacité, cependant, s&#39;accompagne d&#39;une mise en garde très importante : certains programmes prennent une éternité à s&#39;exécuter. Un aspect important de ceci est que nous ne pouvons pas dire, juste en regardant un programme, s&#39;il prendra une éternité ou non à s&#39;exécuter. Nous devons en fait suivre l&#39;exécution du programme et attendre qu&#39;il se termine pour le savoir. Bien sûr, si l&#39;exécution prend une éternité, nous devrons attendre une éternité pour le savoir. C&#39;est ce qu&#39;on appelle le <em>problème d&#39;arrêt</em> et ce serait un énorme problème pour Ethereum s&#39;il n&#39;était pas résolu.</p>
</div>
<div class="paragraph data-line-592">
<p>En raison du problème d&#39;arrêt, l&#39;ordinateur du monde Ethereum risque de se voir demander d&#39;exécuter un programme qui ne s&#39;arrête jamais. Cela pourrait être par accident ou par malveillance. Nous avons discuté du fait qu&#39;Ethereum agit comme une machine à un seul fil d&#8217;exécution, sans aucun planificateur, et donc s&#39;il était bloqué dans une boucle infinie, cela signifierait qu&#39;il deviendrait inutilisable.</p>
</div>
<div class="paragraph data-line-594">
<p>Cependant, avec le gaz, il existe une solution : si après qu&#39;une quantité maximale de calculs a été effectuée, l&#39;exécution n&#39;est pas terminée, l&#39;exécution du programme est stoppée par l&#39;EVM. Cela fait de l&#39;EVM une machine <em>quasi</em>–Turing-complète : elle peut exécuter n&#39;importe quel programme que vous lui introduisez, mais seulement si le programme se termine dans un certain nombre de calculs. Cette limite n&#39;est pas fixée dans Ethereum - vous pouvez payer pour l&#39;augmenter jusqu&#39;à un maximum (appelé &quot;limite de gaz de bloc&quot;), et tout le monde peut accepter d&#39;augmenter ce maximum au fil du temps. Néanmoins, à tout moment, il y a une limite en place, et les transactions qui consomment trop de gaz lors de l&#39;exécution sont <span class="keep-together">stoppées</span>.</p>
</div>
<div class="paragraph data-line-596">
<p>Dans les sections suivantes, nous examinerons le gaz et examinerons en détail son fonctionnement.</p>
</div>
</div>
<div class="sect2 data-line-599">
<h3 id="gas">Gaz</h3>
<div class="paragraph data-line-601">
<p>Le <em>gaz</em> est l&#39;unité d&#39;Ethereum pour mesurer les ressources de calcul et de stockage nécessaires pour effectuer des actions sur la chaîne de blocs Ethereum. Contrairement à Bitcoin, dont les frais de transaction ne tiennent compte que de la taille d&#39;une transaction en kilo-octets, Ethereum doit tenir compte de chaque étape de calcul effectuée par les transactions et l&#39;exécution du code de contrat intelligent.</p>
</div>
<div class="paragraph data-line-603">
<p>Chaque opération effectuée par une transaction ou un contrat coûte une quantité fixe de gaz. Quelques exemples, tirés du Ethereum Yellow Paper :</p>
</div>
<div class="ulist data-line-605">
<ul>
<li class="data-line-605">
<p>L&#39;ajout de deux nombres coûte 3 gaz</p>
</li>
<li class="data-line-606">
<p>Le calcul d&#39;un hachage Keccak-256 coûte 30 gaz + 6 gaz pour chaque 256 bits de données hachés</p>
</li>
<li class="data-line-607">
<p>L&#39;envoi d&#39;une transaction coûte 21 000 gaz</p>
</li>
</ul>
</div>
<div class="paragraph data-line-609">
<p>Le gaz est un composant crucial d&#39;Ethereum et joue un double rôle : comme tampon entre le prix (volatile) d&#39;Ethereum et la récompense des mineurs pour le travail qu&#39;ils font, et comme défense contre les attaques par déni de service. Pour éviter les boucles infinies accidentelles ou malveillantes ou tout autre gaspillage de calcul dans le réseau, l&#39;initiateur de chaque transaction est tenu de fixer une limite à la quantité de calcul qu&#39;il est prêt à payer. Le système de gaz décourage ainsi les attaquants d&#39;envoyer des transactions de &quot;spam&quot;, car ils doivent payer proportionnellement pour les ressources de calcul, de bande passante et de stockage qu&#39;ils consomment.</p>
</div>
<div class="sect3 data-line-612">
<h4 id="gas_accounting_execution">Comptabilisation du gaz pendant l&#39;exécution</h4>
<div class="paragraph data-line-613">
<p>Lorsqu&#39;une EVM est nécessaire pour effectuer une transaction, en premier lieu il reçoit un approvisionnement en gaz égal au montant spécifié par la limite de gaz dans la transaction. Chaque opcode exécuté a un coût en gaz, et donc l&#39;approvisionnement en gaz de l&#39;EVM est réduit au fur et à mesure que l&#39;EVM avance dans le programme. Avant chaque opération, l&#39;EVM vérifie qu&#39;il y a suffisamment de gaz pour payer l&#39;exécution de l&#39;opération. S&#39;il n&#39;y a pas assez de gaz, l&#39;exécution est interrompue et la transaction est annulée.</p>
</div>
<div class="paragraph data-line-615">
<p>Si l&#39;EVM atteint la fin de l&#39;exécution avec succès, sans manquer de gaz, le coût du gaz utilisé est payé au mineur sous forme de frais de transaction, converti en ether sur la base du prix du gaz spécifié dans la transaction :</p>
</div>
<div class="listingblock data-line-617">
<div class="content">
<pre>frais de mineur = coût du gaz * prix du gaz</pre>
</div>
</div>
<div class="paragraph data-line-622">
<p>Le gaz restant dans l&#39;approvisionnement en gaz est remboursé à l&#39;expéditeur, à nouveau converti en ether sur la base du prix du gaz spécifié dans la transaction :</p>
</div>
<div class="listingblock data-line-624">
<div class="content">
<pre>gaz restant = limite de gaz - coût du gaz
ether remboursé = gaz restant * prix du gaz</pre>
</div>
</div>
<div class="paragraph data-line-629">
<p>Si la transaction « manque de gaz » pendant l&#39;exécution, l&#39;opération est immédiatement terminée, ce qui déclenche une exception « à court de gaz » (OOG). La transaction est annulée et toutes les modifications apportées à l&#39;état sont annulées.</p>
</div>
<div class="paragraph data-line-631">
<p>Bien que la transaction ait échoué, l&#39;expéditeur se verra facturer des frais de transaction, car les mineurs ont déjà effectué le travail de calcul jusqu&#39;à ce point et doivent être indemnisés pour cela.</p>
</div>
</div>
<div class="sect3 data-line-633">
<h4 id="_considérations_sur_la_comptabilisation_du_gaz">Considérations sur la comptabilisation du gaz</h4>
<div class="paragraph data-line-635">
<p>Les coûts relatifs du gaz des différentes opérations pouvant être effectuées par l&#39;EVM ont ont été soigneusement choisis pour protéger au mieux la chaîne de blocs Ethereum contre les attaques. Vous pouvez voir un tableau détaillé des coûts de gaz pour différents opcodes EVM dans <a href="#evm_opcodes_table">[evm_opcodes_table]</a>.</p>
</div>
<div class="paragraph data-line-637">
<p>Les opérations plus intensives en calcul coûtent plus de gaz. Par exemple, l&#39;exécution de la fonction SHA3 est 10 fois plus coûteuse (30 gaz) que l&#39;opération ADD (3 gaz). Plus important encore, certaines opérations, telles que EXP, nécessitent un paiement supplémentaire en fonction de la taille de l&#39;opérande. L&#39;utilisation de la mémoire EVM et le stockage des données dans le stockage en chaîne d&#39;un contrat entraînent également un coût en gaz.</p>
</div>
<div class="paragraph data-line-639">
<p>L&#39;importance de faire correspondre le coût du gaz au coût réel des ressources a été démontrée en 2016 lorsqu&#39;un attaquant a découvert et exploité une inadéquation des coûts. L&#39;attaque a généré des transactions très coûteuses en calcul et a presque paralysé le réseau principal Ethereum. Cette inadéquation a été résolue par un hard fork (nom de code &quot;Tangerine Whistle&quot;) qui a modifié les coûts relatifs du gaz.</p>
</div>
</div>
<div class="sect3 data-line-641">
<h4 id="_coût_du_gaz_versus_prix_du_gaz">Coût du gaz versus prix du gaz</h4>
<div class="paragraph data-line-642">
<p>Alors que le <em>coût</em> du gaz est une mesure de calcul et de stockage utilisée dans l&#39;EVM, le gaz lui-même a également un <em>prix</em> mesuré en ether. Lors d&#39;une transaction, l&#39;expéditeur spécifie le prix du gaz qu&#39;il est prêt à payer (en ether) pour chaque unité de gaz, permettant au marché de décider de la relation entre le prix de l&#39;ether et le coût des opérations informatiques (mesuré en gaz) :</p>
</div>
<div class="listingblock data-line-644">
<div class="content">
<pre>frais de transaction = total de gaz utilisé * prix du gaz payé (en ether)</pre>
</div>
</div>
<div class="paragraph data-line-648">
<p>Lors de la construction d&#39;un nouveau bloc, les mineurs du réseau Ethereum peuvent choisir parmi les transactions en attente en sélectionnant celles qui proposent de payer un prix du gaz plus élevé. Offrir un prix du gaz plus élevé incitera donc les mineurs à inclure votre transaction et à la faire confirmer plus rapidement.</p>
</div>
<div class="paragraph data-line-650">
<p>En pratique, l&#39;expéditeur d&#39;une transaction fixera une limite de gaz supérieure ou égale à la quantité de gaz qu&#39;il s&#39;attend à utiliser. Si la limite de gaz est fixée à une valeur supérieure à la quantité de gaz consommée, l&#39;expéditeur recevra un remboursement du montant excédentaire, car les mineurs ne sont indemnisés que pour le travail qu&#39;ils effectuent réellement.</p>
</div>
<div class="paragraph data-line-652">
<p>Il est important d&#39;être clair sur la distinction entre le <em>coût du gaz</em> et le <em>prix du gaz</em>. Récapituler:</p>
</div>
<div class="ulist data-line-654">
<ul>
<li class="data-line-654">
<p>Le coût du gaz est le nombre d&#39;unités de gaz nécessaires pour effectuer une opération particulière.</p>
</li>
<li class="data-line-656">
<p>Le prix du gaz est la quantité d&#39;ether que vous êtes prêt à payer par unité de gaz lorsque vous envoyez votre transaction au réseau Ethereum.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip data-line-659">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-660">
<p>Alors que le gaz a un prix, il ne peut pas être &quot;possédé&quot; ni &quot;dépensé&quot;. Le gaz n&#39;existe qu&#39;à l&#39;intérieur de l&#39;EVM, en tant que décompte de la quantité de travail de calcul effectué. L&#39;expéditeur se voit facturer des frais de transaction en ether, qui sont ensuite convertis en gaz pour la comptabilité EVM, puis de nouveau en ether en tant que frais de transaction payés aux mineurs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-664">
<h5 id="_coûts_de_gaz_négatifs">Coûts de gaz négatifs</h5>
<div class="paragraph data-line-666">
<p>Ethereum encourage la suppression des variables et des comptes de stockage utilisés en remboursant une partie du gaz utilisé lors de l&#39;exécution du contrat.</p>
</div>
<div class="paragraph data-line-668">
<p>Il y a deux opérations dans l&#39;EVM avec des coûts de gaz négatifs :</p>
</div>
<div class="ulist data-line-670">
<ul>
<li class="data-line-670">
<p>La suppression d&#39;un contrat (SELFDESTRUCT) vaut un remboursement de 24 000 gaz.</p>
</li>
<li class="data-line-671">
<p>Changer une adresse de stockage d&#39;une valeur différente de zéro à zéro (SSTORE[x] = 0) vaut un remboursement de 15 000 gaz.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-673">
<p>Pour éviter l&#39;exploitation du mécanisme de remboursement, le remboursement maximum pour une transaction est fixé à la moitié de la quantité totale de gaz consommée (arrondie à l&#39;inférieur).</p>
</div>
</div>
</div>
<div class="sect3 data-line-675">
<h4 id="_limite_de_gaz_du_bloc">Limite de gaz du bloc</h4>
<div class="paragraph data-line-677">
<p>La limite de gaz de bloc est la quantité maximale de gaz pouvant être consommée par toutes les transactions d&#39;un bloc et limite le nombre de transactions pouvant tenir dans un bloc.</p>
</div>
<div class="paragraph data-line-679">
<p>Par exemple, supposons que nous ayons 5 transactions dont les limites de gaz ont été fixées à 30 000, 30 000, 40 000, 50 000 et 50 000. Si la limite de gaz du bloc est de 180 000, alors quatre de ces transactions peuvent tenir dans un bloc, tandis que la cinquième devra attendre un futur bloc. Comme indiqué précédemment, les mineurs décident des transactions à inclure dans un bloc. Différents mineurs sont susceptibles de sélectionner différentes combinaisons, principalement parce qu&#39;ils reçoivent des transactions du réseau dans un ordre différent.</p>
</div>
<div class="paragraph data-line-681">
<p>Si un mineur essaie d&#39;inclure une transaction qui nécessite plus de gaz que la limite actuelle de gaz du bloc, le bloc sera rejeté par le réseau. La plupart des clients Ethereum vous empêcheront d&#39;émettre une telle transaction en donnant un avertissement du type &quot;la transaction dépasse la limite de gaz du bloc&quot;. La limite de gaz de bloc sur le réseau principal Ethereum est de 8 millions de gaz au moment de la rédaction selon <a href="https://etherscan.io" class="undefined" data-href="https://etherscan.io">https://etherscan.io</a>, ce qui signifie qu&#39;environ 380 transactions de base (chacune consommant 21 000 gaz) pourraient tenir dans un bloc.</p>
</div>
<div class="sect4 data-line-683">
<h5 id="_qui_décide_de_la_limite_de_gaz_du_bloc">Qui décide de la limite de gaz du bloc ?</h5>
<div class="paragraph data-line-685">
<p>Les mineurs du réseau décident collectivement de la limite de gaz du bloc. Les personnes qui souhaitent exploiter sur le réseau Ethereum utilisent un programme de minage, tel qu&#39;Ethminer, qui se connecte à un client Geth ou Parity Ethereum. Le protocole Ethereum a un mécanisme intégré où les mineurs peuvent voter sur la limite de gaz afin que la capacité puisse être augmentée ou diminuée dans les blocs suivants. Le mineur d&#39;un bloc peut voter pour ajuster la limite de gaz du bloc d&#39;un facteur de 1/1 024 (0,0976 %) dans les deux sens. Le résultat est une taille de bloc ajustable en fonction des besoins du réseau à ce moment-là. Ce mécanisme est couplé à une stratégie minière par défaut où les mineurs votent sur une limite de gaz d&#39;au moins 4,7 millions de gaz, mais qui cible une valeur de 150 % de la moyenne de la consommation totale récente de gaz par bloc (en utilisant un déplacement exponentiel de 1 024 blocs en moyenne).</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-687">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph data-line-689">
<p>Dans ce chapitre, nous avons exploré la machine virtuelle Ethereum, en retraçant l&#39;exécution de divers contrats intelligents et en examinant comment l&#39;EVM exécute le bytecode. Nous avons également examiné le gaz, le mécanisme de comptabilité de l&#39;EVM, et avons vu comment il résout le problème d&#39;arrêt et protège Ethereum des attaques par déni de service. Ensuite, dans <a href="#consensus">[consensus]</a>, nous examinerons le mécanisme utilisé par Ethereum pour parvenir à un consensus décentralisé.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-05-14 15:28:10 -0400
</div>
</div>
</body>
</html>