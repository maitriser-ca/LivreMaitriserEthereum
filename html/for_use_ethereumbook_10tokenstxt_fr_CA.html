<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Jetons</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="tokens_chapter">Jetons</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le mot "token" (jeton) dérive du vieil anglais "tācen", signifiant un signe ou un symbole. Il est couramment utilisé pour désigner des objets de type pièce de monnaie à usage spécial émis par des particuliers et ayant une valeur intrinsèque insignifiante, tels que des token ou jetons de transport, des jetons de blanchisserie et des jetons de jeux d&#8217;arcade.</p>
</div>
<div class="paragraph">
<p>De nos jours, les "tokens" ou "jetons" (nous utiliserons le terme français "jeton" pour le restant du chapitre) administrés sur les chaînes de blocs redéfinissent le mot pour désigner des abstractions basées sur la chaîne de blocs qui peuvent être possédées et qui représentent des actifs, des devises ou des droits d&#8217;accès.</p>
</div>
<div class="paragraph">
<p>L&#8217;association entre le mot "jeton" et la valeur insignifiante a beaucoup à voir avec l&#8217;utilisation limitée des versions physiques des jetons. Souvent limités à des entreprises, des organisations ou des emplacements spécifiques, les jetons physiques ne sont pas facilement échangeables et n&#8217;ont généralement qu&#8217;une seule fonction. Avec les jetons de chaîne de blocs, ces restrictions sont levées ou, plus précisément, complètement redéfinissables. De nombreux jetons de chaîne de blocs ont plusieurs objectifs à l&#8217;échelle mondiale et peuvent être échangés les uns contre les autres ou contre d&#8217;autres devises sur les marchés liquides mondiaux. Avec la disparition des restrictions d&#8217;utilisation et de propriété, l&#8217;attente d&#8217;une "valeur insignifiante" appartient également au passé.</p>
</div>
<div class="paragraph">
<p>Dans ce chapitre, nous examinons les différentes utilisations des jetons et comment ils sont créés. Nous discutons également des attributs des jetons tels que la fongibilité et l&#8217;intrinsèque. Enfin, nous examinons les normes et les technologies sur lesquelles ils sont basés et expérimentons en créant nos propres jetons.</p>
</div>
<div class="sect2">
<h3 id="tokens_use">Comment les jetons sont utilisés</h3>
<div class="paragraph">
<p>L&#8217;utilisation la plus évidente des jetons est celle des monnaies privées numériques. Cependant, ce n&#8217;est qu&#8217;une utilisation possible. Les jetons peuvent être programmés pour remplir de nombreuses fonctions différentes, qui se chevauchent souvent. Par exemple, un jeton peut simultanément transmettre un droit de vote, un droit d&#8217;accès et la propriété d&#8217;une ressource. Comme le montre la liste suivante, la devise n&#8217;est que la première "application" :</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Monnaie</dt>
<dd>
<p>Un jeton peut servir de forme de monnaie, avec une valeur déterminée par le commerce privé.</p>
</dd>
<dt class="hdlist1">Ressource</dt>
<dd>
<p>Un jeton peut représenter une ressource gagnée ou produite dans une économie de partage ou un environnement de partage de ressources ; par exemple, un jeton de stockage ou de processeur représentant des ressources qui peuvent être partagées sur un réseau.</p>
</dd>
<dt class="hdlist1">Actif</dt>
<dd>
<p>un jeton peut représenter la propriété d&#8217;un actif intrinsèque ou extrinsèque, tangible ou intangible ; par exemple, de l&#8217;or, de l&#8217;immobilier, une voiture, du pétrole, de l&#8217;énergie, des objets MMOG, etc.</p>
</dd>
<dt class="hdlist1">Accès</dt>
<dd>
<p>un jeton peut représenter des droits d&#8217;accès et accorder l&#8217;accès à une propriété numérique ou physique, telle qu&#8217;un forum de discussion, un site Web exclusif, une chambre d&#8217;hôtel ou une voiture de location.</p>
</dd>
<dt class="hdlist1">Équité</dt>
<dd>
<p>Un jeton peut représenter l&#8217;équité des actionnaires dans une organisation numérique (par exemple, un DAO) ou une entité juridique (par exemple, une société).</p>
</dd>
<dt class="hdlist1">Vote</dt>
<dd>
<p>Un jeton peut représenter des droits de vote dans un système numérique ou juridique.</p>
</dd>
<dt class="hdlist1">Objet de collection</dt>
<dd>
<p>Un jeton peut représenter un objet de collection numérique (par exemple, CryptoPunks) ou un objet de collection physique (par exemple, une peinture).</p>
</dd>
<dt class="hdlist1">Identité</dt>
<dd>
<p>Un jeton peut représenter une identité numérique (par exemple, un avatar) ou une identité légale (par exemple, une carte d&#8217;identité nationale).</p>
</dd>
<dt class="hdlist1">Attestation</dt>
<dd>
<p>Un jeton peut représenter une certification ou une attestation de fait par une autorité ou par un système de réputation décentralisé (par exemple, acte de mariage, certificat de naissance, diplôme universitaire).</p>
</dd>
<dt class="hdlist1">Utilitaire</dt>
<dd>
<p>Un jeton peut être utilisé pour accéder ou payer un service.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Souvent, un seul jeton englobe plusieurs de ces fonctions. Parfois, il est difficile de les distinguer, car les équivalents physiques ont toujours été inextricablement liés. Par exemple, dans le monde physique, un permis de conduire (attestation) est aussi un document d&#8217;identité (identité) et les deux ne peuvent pas être séparés. Dans le domaine numérique, les fonctions précédemment mélangées peuvent être séparées et développées indépendamment (par exemple, une attestation anonyme).</p>
</div>
</div>
<div class="sect2">
<h3 id="tokens_fungibility">Jetons et fongibilité</h3>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Fungibility">Wikipedia</a> dit : " En économie, la fongibilité est la propriété d&#8217;un bien ou d&#8217;une marchandise dont les unités individuelles sont essentiellement interchangeables."</p>
</div>
<div class="paragraph">
<p>Les jetons sont fongibles lorsque nous pouvons remplacer n&#8217;importe quelle unité du jeton par une autre sans aucune différence dans sa valeur ou sa fonction.</p>
</div>
<div class="paragraph">
<p>À proprement parler, si la provenance historique d&#8217;un jeton peut être suivie, il n&#8217;est pas entièrement fongible. La possibilité de suivre la provenance peut conduire à la mise sur liste noire et à la liste blanche, réduisant ou éliminant la fongibilité.</p>
</div>
<div class="paragraph">
<p>Les jetons non fongibles sont des jetons qui représentent chacun un élément tangible ou intangible unique et ne sont donc pas interchangeables. Par exemple, un jeton qui représente la propriété d&#8217;un tableau <em>spécifique</em> de Van Gogh n&#8217;est pas équivalent à un autre jeton qui représente un Picasso, même s&#8217;ils peuvent faire partie du même système de "jeton de propriété d&#8217;art". De même, un jeton représentant un objet de collection numérique <em>spécifique</em> tel qu&#8217;un CryptoKitty spécifique n&#8217;est pas interchangeable avec un autre CryptoKitty. Chaque jeton non fongible est associé à un identifiant unique, tel qu&#8217;un numéro de série.</p>
</div>
<div class="paragraph">
<p>Nous verrons des exemples de jetons fongibles et non fongibles plus loin dans ce chapitre.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Notez que "fongible" est souvent utilisé pour signifier "directement échangeable contre de l&#8217;argent" (par exemple, un jeton de casino peut être "encaissé", contrairement aux jetons de blanchisserie). Ce n&#8217;est <em>pas</em> le sens dans lequel nous utilisons le mot ici.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="counterparty_risk">Risque de contrepartie</h3>
<div class="paragraph">
<p>Le risque de contrepartie est le risque que l'<em>autre</em> partie à une transaction ne respecte pas ses obligations. Certains types de transactions présentent un risque de contrepartie supplémentaire car il y a plus de deux parties impliquées. Par exemple, si vous détenez un certificat de dépôt pour un métal précieux et que vous le vendez à quelqu&#8217;un, il y a au moins trois parties dans cette transaction : le vendeur, l&#8217;acheteur et le dépositaire du métal précieux. Quelqu&#8217;un détient l&#8217;actif physique ; par nécessité, ils deviennent partie à l&#8217;exécution de la transaction et ajoutent un risque de contrepartie à toute transaction impliquant cet actif. En général, lorsqu&#8217;un actif est négocié indirectement via l&#8217;échange d&#8217;un jeton de propriété, il existe un risque de contrepartie supplémentaire de la part du dépositaire de l&#8217;actif. En ont-ils l&#8217;atout ? Reconnaîtront-ils (ou autoriseront-ils) le transfert de propriété basé sur le transfert d&#8217;un jeton (tel qu&#8217;un certificat, un acte, un titre ou un jeton numérique) ? Dans le monde des jetons numériques représentant des actifs, comme dans le monde non numérique, il est important de comprendre qui détient l&#8217;actif représenté par le jeton et quelles règles s&#8217;appliquent à cet actif sous-jacent.</p>
</div>
</div>
<div class="sect2">
<h3 id="tokens_intrinsicality">Tokens et Intrinsicité</h3>
<div class="paragraph">
<p>Le mot "intrinsèque" dérive du latin "intra", qui signifie "de l&#8217;intérieur".</p>
</div>
<div class="paragraph">
<p>Certains jetons représentent des éléments numériques intrinsèques à la chaîne de blocs. Ces actifs numériques sont régis par des règles consensuelles, tout comme les jetons eux-mêmes. Cela a une implication importante : les jetons qui représentent des actifs intrinsèques ne comportent pas de risque de contrepartie supplémentaire. Si vous détenez les clés d&#8217;un CryptoKitty, aucune autre partie ne détient ce CryptoKitty pour vous - vous le possédez directement. Les règles de consensus de la chaîne de blocs s&#8217;appliquent et votre propriété (c&#8217;est-à-dire votre contrôle) des clés privées équivaut à la propriété de l&#8217;actif, sans aucun intermédiaire.</p>
</div>
<div class="paragraph">
<p>À l&#8217;inverse, de nombreux jetons sont utilisés pour représenter des choses <em>extrinsèques</em>, telles que l&#8217;immobilier, les actions avec droit de vote des entreprises, les marques et les lingots d&#8217;or. La propriété de ces éléments, qui ne sont pas "dans" la chaîne de blocs, est régie par la loi, la coutume et la politique, distinctes des règles consensuelles qui régissent le jeton. En d&#8217;autres termes, les émetteurs et propriétaires de jetons peuvent toujours dépendre de contrats réels non intelligents. En conséquence, ces actifs extrinsèques comportent un risque de contrepartie supplémentaire car ils sont détenus par des dépositaires, enregistrés dans des registres externes ou contrôlés par des lois et des politiques en dehors de l&#8217;environnement de la chaîne de blocs.</p>
</div>
<div class="paragraph">
<p>L&#8217;une des ramifications les plus importantes des jetons basés sur la chaîne de blocs est la capacité de convertir des actifs extrinsèques en actifs intrinsèques et ainsi de supprimer le risque de contrepartie. Un bon exemple est le passage de l&#8217;équité dans une société (extrinsèque) à une équité ou à un jeton de vote dans un <em>DAO</em> ou une organisation similaire (intrinsèque).</p>
</div>
</div>
<div class="sect2">
<h3 id="using_tokens">Utilisation de jetons : utilité ou équité</h3>
<div class="paragraph">
<p>Presque tous les projets d&#8217;Ethereum sont lancés aujourd&#8217;hui avec une sorte de jeton. Mais est-ce que tous ces projets ont vraiment besoin de jetons ? Y a-t-il des inconvénients à utiliser un jeton, ou verrons-nous le slogan "tokéniser toutes les choses" se concrétiser ? En principe, l&#8217;utilisation de jetons peut être considérée comme l&#8217;ultime outil de gestion ou d&#8217;organisation. Dans la pratique, l&#8217;intégration des plateformes de chaîne de blocs, y compris Ethereum, dans les structures existantes de la société signifie que, jusqu&#8217;à présent, il existe de nombreuses limites à leur applicabilité.</p>
</div>
<div class="paragraph">
<p>Commençons par clarifier le rôle d&#8217;un jeton dans un nouveau projet. La majorité des projets utilisent des jetons de deux manières : soit en tant que « jetons utilitaires », soit en tant que « jetons d&#8217;équité ». Très souvent, ces deux rôles sont confondus.</p>
</div>
<div class="paragraph">
<p>Les jetons utilitaires sont ceux où l&#8217;utilisation du jeton est nécessaire pour accéder à un service, une application ou une ressource. Des exemples de jetons utilitaires incluent des jetons qui représentent des ressources telles que le stockage partagé ou l&#8217;accès à des services tels que les réseaux de médias sociaux.</p>
</div>
<div class="paragraph">
<p>Les jetons d&#8217;équité sont ceux qui représentent des parts dans le contrôle ou la propriété de quelque chose, comme une startup. Les jetons d&#8217;équité peuvent être aussi limités que les actions sans droit de vote pour la distribution des dividendes et des bénéfices, ou aussi expansifs que les actions avec droit de vote dans une organisation autonome décentralisée, où la gestion de la plate-forme se fait par un système de gouvernance complexe basé sur les votes des détenteurs de jetons.</p>
</div>
<div class="sect3">
<h4 id="its_not_duck">C&#8217;est un canard !</h4>
<div class="paragraph">
<p>De nombreuses startups sont confrontées à un problème difficile : les jetons sont un excellent mécanisme de collecte de fonds, mais offrir des titres (actions) au public est une activité réglementée dans la plupart des juridictions. En déguisant les jetons d&#8217;équité en jetons utilitaires, de nombreuses startups espèrent contourner ces restrictions réglementaires et lever des fonds à partir d&#8217;une offre publique tout en la présentant comme une prévente de "bons d&#8217;accès au service" ou, comme nous les appelons, de jetons utilitaires. Reste à savoir si ces offres d&#8217;actions à peine déguisées pourront contourner les régulateurs.</p>
</div>
<div class="paragraph">
<p>Comme le dit le dicton populaire : "Si ça marche comme un canard et cancane comme un canard, c&#8217;est un canard." Les régulateurs ne risquent pas d&#8217;être distraits par ces contorsions sémantiques ; bien au contraire, ils sont plus susceptibles de considérer ce sophisme juridique comme une tentative de tromper le public.</p>
</div>
</div>
<div class="sect3">
<h4 id="who_needs_utility_tokens">Jetons utilitaires : qui en a besoin ?</h4>
<div class="paragraph">
<p>Le vrai problème est que les jetons utilitaires introduisent des risques importants et des obstacles à l&#8217;adoption pour les startups. Peut-être que dans un avenir lointain, "tokéniser toutes les choses" deviendra réalité, mais à l&#8217;heure actuelle, l&#8217;ensemble des personnes qui comprennent et souhaitent utiliser un jeton est un sous-ensemble du marché déjà petit de la crypto-monnaie.</p>
</div>
<div class="paragraph">
<p>Pour une startup, chaque innovation représente un risque et un filtre de marché. L&#8217;innovation, c&#8217;est emprunter le chemin le moins fréquenté, s&#8217;éloigner du chemin de la tradition. C&#8217;est déjà une promenade solitaire. Si une startup essaie d&#8217;innover dans un nouveau domaine technologique, tel que le partage de stockage sur des réseaux P2P, c&#8217;est une voie assez solitaire. L&#8217;ajout d&#8217;un jeton utilitaire à cette innovation et l&#8217;obligation pour les utilisateurs d&#8217;adopter des jetons afin d&#8217;utiliser le service aggravent le risque et augmentent les obstacles à l&#8217;adoption. C&#8217;est sortir de la piste déjà solitaire de l&#8217;innovation de stockage P2P et dans le désert.</p>
</div>
<div class="paragraph">
<p>Considérez chaque innovation comme un filtre. Cela limite l&#8217;adoption au sous-ensemble du marché qui peut devenir les premiers à adopter cette innovation. L&#8217;ajout d&#8217;un deuxième filtre aggrave cet effet, limitant davantage le marché adressable. Vous demandez à vos premiers utilisateurs d&#8217;adopter non pas une mais deux technologies entièrement nouvelles : la nouvelle application/plate-forme/service que vous avez créée et l&#8217;économie des jetons.</p>
</div>
<div class="paragraph">
<p>Pour une startup, chaque innovation introduit des risques qui augmentent les chances d&#8217;échec de la startup. Si vous prenez votre idée de démarrage déjà risquée et ajoutez un jeton utilitaire, vous ajoutez tous les risques de la plate-forme sous-jacente (Ethereum), de l&#8217;économie plus large (échanges, liquidité), de l&#8217;environnement réglementaire (régulateurs des actions/matières premières) et de la technologie (contrats intelligents , normes symboliques). C&#8217;est beaucoup de risques pour une startup.</p>
</div>
<div class="paragraph">
<p>Les partisans de la "tokénisation de toutes les choses" rétorqueront probablement qu&#8217;en adoptant des jetons, ils héritent également de l&#8217;enthousiasme du marché, des premiers utilisateurs, de la technologie, de l&#8217;innovation et de la liquidité de l&#8217;ensemble de l&#8217;économie des jetons. C&#8217;est vrai aussi. La question est de savoir si les avantages et l&#8217;enthousiasme l&#8217;emportent sur les risques et les incertitudes.</p>
</div>
<div class="paragraph">
<p>Néanmoins, certaines des idées commerciales les plus innovantes se déroulent effectivement dans le domaine de la cryptographie. Si les régulateurs ne sont pas assez rapides pour adopter des lois et soutenir de nouveaux modèles commerciaux, les entrepreneurs et les talents associés chercheront à opérer dans d&#8217;autres juridictions plus favorables à la cryptographie. Cela se produit déjà.</p>
</div>
<div class="paragraph">
<p>Enfin, au début de ce chapitre, lors de l&#8217;introduction des jetons, nous avons discuté de la signification familière du « jeton » comme « quelque chose de valeur insignifiante ». La raison sous-jacente de la valeur insignifiante de la plupart des jetons est qu&#8217;ils ne peuvent être utilisés que dans un contexte très étroit : une compagnie d&#8217;autobus, une buanderie automatique, une arcade, un hôtel ou un magasin d&#8217;entreprise. Une liquidité limitée, une applicabilité limitée et des coûts de conversion élevés réduisent la valeur des jetons jusqu&#8217;à ce qu&#8217;ils n&#8217;aient plus qu&#8217;une valeur « symbolique ». Ainsi, lorsque vous ajoutez un jeton utilitaire à votre plateforme, mais que le jeton ne peut être utilisé que sur votre seule plateforme avec un petit marché, vous recréez les conditions qui ont rendu les jetons physiques sans valeur. Cela peut en effet être la bonne façon d&#8217;intégrer la tokenisation dans votre projet. Cependant, si pour utiliser votre plate-forme, un utilisateur doit convertir quelque chose en votre jeton utilitaire, l&#8217;utiliser, puis reconvertir le reste en quelque chose de plus généralement utile, vous avez créé un certificat d&#8217;entreprise. Les coûts de commutation d&#8217;un jeton numérique sont des ordres de grandeur inférieurs à ceux d&#8217;un jeton physique sans marché, mais ils ne sont pas nuls. Les jetons utilitaires qui fonctionnent dans tout un secteur industriel seront très intéressants et probablement très précieux. Mais si vous configurez votre startup pour qu&#8217;elle doive amorcer une norme industrielle entière pour réussir, vous avez peut-être déjà échoué.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>L&#8217;un des avantages du déploiement de services sur des plates-formes à usage général comme Ethereum est de pouvoir connecter des contrats intelligents (et donc l&#8217;utilité des jetons) à travers les projets, augmentant ainsi le potentiel de liquidité et l&#8217;utilité des jetons.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Prenez cette décision pour les bonnes raisons. Adoptez un jeton car votre application <em>ne peut pas fonctionner sans jeton</em>. Adoptez-le car le jeton lève une barrière fondamentale du marché ou résout un problème d&#8217;accès. N&#8217;introduisez pas de jeton utilitaire car c&#8217;est le seul moyen de collecter des fonds rapidement et vous devez prétendre qu&#8217;il ne s&#8217;agit pas d&#8217;une offre publique de titres .</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="token_std">Jetons sur Ethereum</h3>
<div class="paragraph">
<p>Les jetons de chaîne de blocs existaient avant Ethereum. D&#8217;une certaine manière, la première monnaie chaîne de blocs, Bitcoin, est un jeton lui-même. De nombreuses plateformes de jetons ont également été développées sur Bitcoin et d&#8217;autres crypto-monnaies avant Ethereum. Cependant, l&#8217;introduction de la première norme de jeton sur Ethereum a conduit à une explosion de jetons.</p>
</div>
<div class="paragraph">
<p>Vitalik Buterin a suggéré les jetons comme l&#8217;une des applications les plus évidentes et les plus utiles d&#8217;une chaîne de blocs programmable généralisée telle qu&#8217;Ethereum. En fait, au cours de la première année d&#8217;Ethereum, il était courant de voir Vitalik et d&#8217;autres porter des T-shirts arborant le logo Ethereum et un échantillon de contrat intelligent au dos. Il y avait plusieurs variantes de ce T-shirt, mais la plus courante montrait une implémentation d&#8217;un jeton.</p>
</div>
<div class="paragraph">
<p>Avant de nous plonger dans les détails de la création de jetons sur Ethereum, il est important d&#8217;avoir un aperçu du fonctionnement des jetons sur Ethereum. Les jetons sont différents de l&#8217;ether car le protocole Ethereum ne sait rien d&#8217;eux. L&#8217;envoi d&#8217;ether est une action intrinsèque de la plateforme Ethereum, mais l&#8217;envoi ou même la possession de jetons ne l&#8217;est pas. Le solde d&#8217;ether des comptes Ethereum est géré au niveau du protocole, tandis que le solde de jetons des comptes Ethereum est géré au niveau du contrat intelligent. Afin de créer un nouveau jeton sur Ethereum, vous devez créer un nouveau contrat intelligent. Une fois déployé, le contrat intelligent gère tout, y compris la propriété, les transferts et les droits d&#8217;accès. Vous pouvez rédiger votre contrat intelligent pour effectuer toutes les actions nécessaires comme vous le souhaitez, mais il est probablement plus sage de suivre une norme existante. Nous examinerons ensuite ces normes. Nous discutons des avantages et des inconvénients des normes suivantes à la fin du chapitre.</p>
</div>
<div class="sect3">
<h4 id="ERC20_std">La norme de jeton ERC20</h4>
<div class="paragraph">
<p>La première norme a été introduite en novembre 2015 par Fabian Vogelsteller en tant que demande de commentaires Ethereum (ERC). Il s&#8217;est automatiquement vu attribuer le numéro de problème GitHub 20, donnant lieu au nom de "jeton ERC20". La grande majorité des jetons sont actuellement basés sur la norme ERC20. La demande de commentaires ERC20 est finalement devenue la proposition d&#8217;amélioration Ethereum 20 (EIP-20), mais elle est encore principalement désignée par le nom d&#8217;origine, ERC20.</p>
</div>
<div class="paragraph">
<p>ERC20 est une norme pour les <em>jetons fongibles</em>, ce qui signifie que différentes unités d&#8217;un token ERC20 sont interchangeables et n&#8217;ont pas de propriétés uniques.</p>
</div>
<div class="paragraph">
<p><a href="http://bit.ly/2CUf7WG">La norme ERC20</a> définit une interface commune pour les contrats mettant en œuvre un jeton, de sorte que tout jeton compatible est accessible et utilisable de la même manière. L&#8217;interface se compose d&#8217;un certain nombre de fonctions qui doivent être présentes dans chaque implémentation de la norme, ainsi que de certaines fonctions et attributs facultatifs qui peuvent être ajoutés par les développeurs.</p>
</div>
<div class="sect4">
<h5 id="ERC20_reqd_func">Fonctions et événements requis par ERC20</h5>
<div class="paragraph">
<p>Un contrat de jeton conforme à ERC20 doit fournir au moins les fonctions et événements suivants :</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">totalSupply</dt>
<dd>
<p>Renvoie le nombre total d&#8217;unités de ce jeton qui existent actuellement. Les jetons ERC20 peuvent avoir une offre fixe ou variable.</p>
</dd>
<dt class="hdlist1">balanceOf</dt>
<dd>
<p>Étant donné une adresse, renvoie le solde du jeton de cette adresse.</p>
</dd>
<dt class="hdlist1">transfer</dt>
<dd>
<p>Étant donné une adresse et un montant, transfère ce montant de jetons à cette adresse, à partir du solde de l&#8217;adresse qui a exécuté le transfert.</p>
</dd>
<dt class="hdlist1">transferFrom</dt>
<dd>
<p>Étant donné un expéditeur, un destinataire et un montant, transfère des jetons d&#8217;un compte à un autre. Utilisé en combinaison avec approve.</p>
</dd>
<dt class="hdlist1">approve</dt>
<dd>
<p>Étant donné une adresse et un montant de destinataire, autorise cette adresse à exécuter plusieurs virements jusqu&#8217;à ce montant, à partir du compte qui a émis l&#8217;approbation.</p>
</dd>
<dt class="hdlist1">allowance</dt>
<dd>
<p>Étant donné une adresse de propriétaire et une adresse de dépensier, renvoie le montant restant que le dépensier est autorisé à retirer au propriétaire.</p>
</dd>
<dt class="hdlist1">Transfer</dt>
<dd>
<p>Evénement déclenché lors d&#8217;un transfert réussi (appel à transfer ou <code>transferFrom</code>)(même pour les transferts de valeur nulle).</p>
</dd>
<dt class="hdlist1">Approval</dt>
<dd>
<p>Événement enregistré lors d&#8217;un appel réussi à approve.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="ERC20_optional_func">Fonctions optionnelles ERC20</h5>
<div class="paragraph">
<p>En plus des fonctions requises listées dans la section précédente, les fonctions optionnelles suivantes sont également définies par la norme :</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>Renvoie le nom lisible par l&#8217;homme (par exemple, "US Dollars") du jeton.</p>
</dd>
<dt class="hdlist1">symbol</dt>
<dd>
<p>Renvoie un symbole lisible par l&#8217;homme (par exemple, "USD") pour le jeton.</p>
</dd>
<dt class="hdlist1">decimals</dt>
<dd>
<p>Renvoie le nombre de décimales utilisées pour diviser les quantités de jetons. Par exemple, si decimals vaut <code>2</code>,alors le montant du jeton est divisé par 100 pour obtenir sa <span class="keep-together">représentation</span> d&#8217;usage.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="ERC20_interface">L&#8217;interface ERC20 définie dans Solidity</h5>
<div class="paragraph">
<p>Voici à quoi ressemble une spécification d&#8217;interface ERC20 dans Solidity :</p>
</div>
<div id="ERC20_interface_example" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract ERC20 {
   function totalSupply() constant returns (uint theTotalSupply);
   function balanceOf(address _owner) constant returns (uint balance);
   function transfer(address _to, uint _value) returns (bool success);
   function transferFrom(address _from, address _to, uint _value) returns
      (bool success);
   function approve(address _spender, uint _value) returns (bool success);
   function allowance(address _owner, address _spender) constant returns
      (uint remaining);
   event Transfer(address indexed _from, address indexed _to, uint _value);
   event Approval(address indexed _owner, address indexed _spender, uint _value);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ERC20_data_struct">Structures de données ERC20</h5>
<div class="paragraph">
<p>Si vous examinez une implémentation ERC20, vous verrez qu&#8217;elle contient deux structures de données, une pour suivre les soldes et une pour suivre indemnités. Dans Solidity, ils sont implémentés avec un <em>data mapping</em> ou <em>mappage de données</em>.</p>
</div>
<div class="paragraph">
<p>Le premier mappage de données implémente une table interne des soldes de jetons, par propriétaire. Cela permet au contrat de jeton de garder une trace de qui possède les jetons. Chaque transfert est une déduction d&#8217;un solde et un ajout à un autre solde :</p>
</div>
<div id="balance_mapping" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">mapping(address =&gt; uint256) balances;</code></pre>
</div>
</div>
<div class="paragraph">
<p>La deuxième structure de données est un mappage de données d&#8217;allocations. Comme nous le verrons dans la section suivante, avec les jetons ERC20, le propriétaire d&#8217;un jeton peut déléguer l&#8217;autorité à un dépensier, lui permettant de dépenser un montant spécifique (allocation) à partir du solde du propriétaire. Le contrat ERC20 assure le suivi des allocations avec un mappage bidimensionnel, la clé primaire étant l&#8217;adresse du propriétaire du jeton, mappée à une adresse de dépense et un montant d&#8217;allocation :</p>
</div>
<div id="allowance_mapping" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">mapping (address =&gt; mapping (address =&gt; uint256)) public allowed;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="transfer_workflows">Flux de travail ERC20 : "transfer" et "approve et transferFrom"</h5>
<div class="paragraph">
<p>La norme de jeton ERC20 a deux fonctions de transfert. Vous vous demandez peut-être pourquoi.</p>
</div>
<div class="paragraph">
<p>ERC20 permet deux flux de travail différents. Le premier est un flux de travail simple et à transaction unique utilisant la fonction <code>transfer</code>.Ce flux de travail est celui utilisé par les portefeuilles pour envoyer des jetons à d&#8217;autres portefeuilles. La grande majorité des transactions de jetons se produisent avec le flux de travail transfer.</p>
</div>
<div class="paragraph">
<p>L&#8217;exécution du contrat de transfert est très simple. Si Alice veut envoyer 10 jetons à Bob, son portefeuille envoie une transaction à l&#8217;adresse du contrat de jeton, en appelant la fonction <span class="keep-together"><code>transfer</code></span> avec l&#8217;adresse de Bob et 10 comme arguments. Le contrat de jeton ajuste le solde d&#8217;Alice (–10) et le solde de Bob (+10) et émet un événement Transfer.</p>
</div>
<div class="paragraph">
<p>Le deuxième flux de travail est un processus à deux transactions qui utilise approve suivi de <code>transferFrom</code>.Ce workflow permet à un propriétaire de jeton de déléguer son contrôle à une autre adresse. Il est le plus souvent utilisé pour déléguer le contrôle à un contrat de distribution de jetons, mais il peut également être utilisé par les échanges.</p>
</div>
<div class="paragraph">
<p>Par exemple, si une entreprise vend des tokens pour une ICO (Initial Coin Offerings ou "offres initiales de pièces"), elle peut approve (approuver) une adresse de contrat de crowdsale pour distribuer une certaine quantité de jetons. Le contrat de crowdsale peut alors transferFrom le solde du propriétaire du contrat de jeton à chaque acheteur du jeton, comme illustré dans <a href="#approve_transferFrom_workflow">Le flux de travail d&#8217;approbation et de transfert en deux étapes des jetons ERC20</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>("Initial Coin Offerings (ICOs)","défini"Une <em>Initial Coin Offering</em> (ICO) ou <em>Offres initiales de pièces</em> est un mécanisme de financement participatif utilisé par les entreprises et les organisations pour collecter des fonds en vendant des jetons. Le terme est dérivé de l&#8217;offre publique initiale (IPO), qui est le processus par lequel une société publique propose des actions à vendre aux investisseurs en bourse. Contrairement aux marchés des introductions en bourse hautement réglementés, les ICO sont ouverts, mondiaux et désordonnés. Les exemples et les explications des ICO dans ce livre ne constituent pas une approbation de ce type de collecte de fonds.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="approve_transferFrom_workflow" class="imageblock">
<div class="content">
<img src="images/approve_transferFrom_workflow.png" alt="Le flux de travail d&#8217;approbation et de transfert en deux étapes des jetons ERC20">
</div>
<div class="title">Figure 1. Le flux de travail d&#8217;approbation et de transfert en deux étapes des jetons ERC20</div>
</div>
<div class="paragraph">
<p>Pour le flux de travail approve et <code>transferFrom</code>,deux transactions sont nécessaires. Disons qu&#8217;Alice veut autoriser le contrat AliceICO à vendre 50 % de tous les jetons AliceCoin à des acheteurs comme Bob et Charlie. Tout d&#8217;abord, Alice lance le contrat AliceCoin ERC20, émettant tous les AliceCoin à sa propre adresse. Ensuite, Alice lance le contrat AliceICO qui peut vendre des jetons contre de l&#8217;ether. Ensuite, Alice lance le flux de travail approve et <code>transferFrom</code>.Elle envoie une transaction au contrat <code>AliceCoin</code>,en appelant approve avec l&#8217;adresse du contrat AliceICO et 50 % du totalSupply comme arguments. Cela déclenchera l&#8217;événement <code>Approbation</code>.Désormais, le contrat AliceICO peut vendre AliceCoin.</p>
</div>
<div class="paragraph">
<p>Lorsque le contrat AliceICO reçoit de l&#8217;ether de Bob, il doit envoyer des AliceCoin à Bob en retour. Dans le contrat AliceICO se trouve un taux de change entre AliceCoin et de l&#8217;Ether. Le taux de change qu&#8217;Alice a fixé lors de la création du contrat AliceICO détermine le nombre de jetons que Bob recevra pour la quantité d&#8217;ether envoyé au contrat <code>AliceICO</code>.Lorsque le contrat AliceICO appelle la fonction AliceCoin <code>transferFrom</code>,il définit l&#8217;adresse d&#8217;Alice comme expéditeur et l&#8217;adresse de Bob comme destinataire, et utilise le taux de change pour déterminer le nombre de jetons AliceCoin qui seront transférés à Bob dans le champ <code>value</code>.Le contrat AliceCoin transfère le solde de l&#8217;adresse d&#8217;Alice à l&#8217;adresse de Bob et déclenche un événement <code>Transfer</code>.Le contrat AliceICO peut appeler transferFrom un nombre illimité de fois, tant qu&#8217;il ne dépasse pas la limite d&#8217;approbation définie par Alice. Le contrat AliceICO peut suivre le nombre de jetons AliceCoin qu&#8217;il peut vendre en appelant la fonction allowance.</p>
</div>
</div>
<div class="sect4">
<h5 id="ERC20_implémentation">Implémentations ERC20</h5>
<div class="paragraph">
<p>Bien qu&#8217;il soit possible d&#8217;implémenter un jeton compatible ERC20 dans environ 30 lignes de code Solidity, la plupart des implémentations sont plus complexes. Ceci pour tenir compte des vulnérabilités de sécurité potentielles. Deux implémentations sont mentionnées dans la norme EIP-20 :</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="http://bit.ly/2EUYCMR">Consensys EIP20</a></dt>
<dd>
<p>Une implémentation simple et facile à lire d&#8217;un jeton compatible ERC20.</p>
</dd>
<dt class="hdlist1"><a href="https://bit.ly/2xPYck6">OpenZeppelin StandardToken</a></dt>
<dd>
<p>Cette implémentation est compatible ERC20, avec des précautions de sécurité supplémentaires. Il constitue la base des bibliothèques OpenZeppelin implémentant des jetons compatibles ERC20 plus complexes avec des plafonds de collecte de fonds, des enchères, des calendriers d&#8217;acquisition et d&#8217;autres fonctionnalités.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="METoken_example">Lancement de notre propre jeton ERC20</h4>
<div class="paragraph">
<p> Créons et lançons notre propre jeton. Pour cet exemple, nous utiliserons le cadre de développement (framework) Truffle. L&#8217;exemple suppose que vous avez déjà installé truffle et que vous l&#8217;avez configuré, et que vous êtes familiarisé avec son fonctionnement de base (pour plus de détails, voir <a href="#truffle">[truffle]</a>).</p>
</div>
<div class="paragraph">
<p>Nous appellerons notre jeton "Mastering Ethereum Token", avec le symbole "MET".</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Vous pouvez trouver cet exemple <a href="https://github.com/ethereumbook/ethereumbook/blob/develop/code/truffle/METoken">dans le référentiel GitHub du livre</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Commençons par créer et initialiser un répertoire de projet Truffle. Exécutez ces quatre commandes et acceptez les réponses par défaut à toutes les questions :</p>
</div>
<pre data-type="programlist">
$ <strong>mkdir METoken</strong>
$ <strong>cd METoken</strong>
METoken $ <strong>truffle init</strong>
METoken $ <strong>npm init</strong>

</pre>
<div class="paragraph">
<p>Vous devriez maintenant avoir la structure de répertoires suivante :</p>
</div>
<div id="truffle_directory" class="listingblock">
<div class="content">
<pre>METoken/
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- package.json
+---- test
+---- truffle-config.js
`---- truffle.js</pre>
</div>
</div>
<div class="paragraph">
<p>Modifiez le fichier de configuration <em>truffle.js</em> ou <em>truffle-config.js</em> pour configurer votre environnement Truffle, ou copiez ce dernier depuis <a href="http://bit.ly/2DdP2mz">le référentiel</a>.</p>
</div>
<div class="paragraph">
<p>Si vous utilisez l&#8217;exemple <em>truffle-config.js</em>, pensez à créer un fichier <em>.env</em> dans le dossier <em>METoken</em> contenant vos clés privées de test pour le test et le déploiement sur les réseaux publics de test Ethereum, tels que Ropsten ou Kovan. Vous pouvez exporter votre clé privée de réseau de test à partir de MetaMask.</p>
</div>
<div class="paragraph">
<p>Après cela, votre répertoire devrait ressembler à :</p>
</div>
<div id="truffle_directory_metoken" class="listingblock">
<div class="content">
<pre>METoken/
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- package.json
+---- test
+---- truffle-config.js
+---- truffle.js
`---- .env *new file*</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>N&#8217;utilisez que des clés de test ou des mnémoniques de test qui ne sont <em>pas</em> utilisés pour détenir des fonds sur le réseau Ethereum principal. <em>Ne jamais</em> utiliser des clés contenant de l&#8217;argent réel pour les tests.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour notre exemple, nous allons importer la bibliothèque OpenZeppelin, qui implémente des contrôles de sécurité importants et est facile à étendre :</p>
</div>
<pre data-type="programlist">
$ <strong>npm install openzeppelin-solidity@1.12.0</strong>

+ openzeppelin-solidity@1.12.0
added 1 package from 1 contributor and audited 2381 packages in 4.074s

</pre>
<div class="paragraph">
<p>Le module de dévelopement openzeppelin-solidity ajoutera environ 250 fichiers sous le répertoire <em>node_modules</em>. La bibliothèque OpenZeppelin comprend bien plus que le jeton ERC20, mais nous n&#8217;en utiliserons qu&#8217;une petite partie.</p>
</div>
<div class="paragraph">
<p>Ensuite, écrivons notre contrat de jeton. Créez un nouveau fichier, <em>METoken.sol</em>, et copiez l&#8217;exemple de code depuis <a href="http://bit.ly/2qfIFH0">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>Notre contrat, illustré en <a href="#solidity_token_example">METoken.sol : Un contrat Solidity implémentant un token ERC20</a>, est très simple, car il hérite toutes ses fonctionnalités de la bibliothèque OpenZeppelin.</p>
</div>
<div id="solidity_token_example" class="exampleblock">
<div class="title">Example 1. METoken.sol : Un contrat Solidity implémentant un token ERC20</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.21;

import 'openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol';

contract METoken is StandardToken {
    string public constant name = 'Mastering Ethereum Token';
    string public constant symbol = 'MET';
    uint8 public constant decimals = 2;
    uint constant _initial_supply = 2100000000;

    function METoken() public {
        totalSupply_ = _initial_supply;
        balances[msg.sender] = _initial_supply;
        emit Transfer(address(0), msg.sender, _initial_supply);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Ici, nous définissons les variables optionnelles <code>name</code>,symbol et <code>decimals</code>.Nous définissons également une variable <code>_initial_supply</code>,définie sur 21 millions de jetons ; avec deux décimales de subdivision qui donne 2,1 milliards d&#8217;unités au total. Dans la fonction d&#8217;initialisation (constructeur) du contrat, nous définissons le totalSupply égal à _initial_supply et allouons tout le _initial_supply au solde du compte (<code>msg.sender</code>)qui crée le contrat METoken.</p>
</div>
<div class="paragraph">
<p>Nous utilisons maintenant truffle pour compiler le code METoken :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle compile</strong>
Compiling ./contracts/METoken.sol...
Compiling ./contracts/Migrations.sol...
Compiling openzeppelin-solidity/contracts/math/SafeMath.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/BasicToken.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/ERC20.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/ERC20Basic.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol...

</pre>
<div class="paragraph">
<p>Comme vous pouvez le voir, truffle intègre les dépendances nécessaires des bibliothèques OpenZeppelin et compile également ces contrats.</p>
</div>
<div class="paragraph">
<p>Configurons un script de migration pour déployer le contrat <code>METoken</code>.Créez un nouveau fichier appelé <em>2_deploy_contracts.js</em>, dans le dossier <em>METoken/migrations</em>. Copiez le contenu de l&#8217;exemple <a href="http://bit.ly/2P0rHLl">dans le référentiel GitHub</a> :</p>
</div>
<div id="METoken_migration" class="listingblock">
<div class="title">2_deploy_contracts : Migration pour déployer METoken</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var METoken = artifacts.require("METoken");

module.exports = function(deployer) {
  // Deploy the METoken contract as our only task
  deployer.deploy(METoken);
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Avant de déployer sur l&#8217;un des réseaux de test Ethereum, démarrons une chaîne de blocs locale pour tout tester. Démarrez la chaîne de blocs <code>ganache</code>,soit depuis la ligne de commande avec <code>ganache-cli</code>,soit depuis l&#8217;interface utilisateur graphique.</p>
</div>
<div class="paragraph">
<p>Une fois ganache lancé, nous pouvons déployer notre contrat METoken et voir si tout fonctionne comme prévu :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle migrate --network ganache</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb2e90a056dc6ad8e654683921fc613c796a03b89df6760ec1db1084ea4a084eb
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying METoken...
  ... 0xbe9290d59678b412e60ed6aefedb17364f4ad2977cfb2076b9b8ad415c5dc9f0
  METoken: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

</pre>
<div class="paragraph">
<p>Sur la console <code>ganache</code>,nous devrions voir que notre déploiement a créé quatre nouvelles transactions, comme illustré dans <a href="#ganache_METoken">Déploiement METoken sur ganache</a>.</p>
</div>
<div id="ganache_METoken" class="imageblock">
<div class="content">
<img src="images/ganache_metoken.png" alt="Déploiement de METoken sur Ganache">
</div>
<div class="title">Figure 2. Déploiement METoken sur ganache</div>
</div>
<div class="sect4">
<h5 id="truffle_console">Interagir avec METoken à l&#8217;aide de la console Truffle</h5>
<div class="paragraph">
<p> Nous pouvons interagir avec notre contrat sur la chaîne de blocs ganache en utilisant la console Truffle. Il s&#8217;agit d&#8217;un environnement JavaScript interactif qui donne accès à l&#8217;environnement Truffle et, via web3, à la chaîne de blocs. Dans ce cas, nous allons connecter la console Truffle à la chaîne de blocs ganache :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt;

</pre>
<div class="paragraph">
<p>L&#8217;invite truffle(ganache)&amp;gt; indique que nous sommes connectés à la chaîne de blocs ganache et que nous sommes prêts à taper nos commandes. La console Truffle prend en charge toutes les commandes <code>truffle</code>,nous pourrions donc compiler et migrer depuis la console. Nous avons déjà exécuté ces commandes, allons donc directement au contrat lui-même. Le contrat METoken existe en tant qu&#8217;objet JavaScript dans l&#8217;environnement Truffle. Tapez METoken** à l&#8217;invite et il affichera l&#8217;intégralité de la définition du contrat :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken</strong>
{ [Function: TruffleContract]
  _static_methods:

[...]

currentProvider:
 HttpProvider {
   host: 'http://localhost:7545',
   timeout: 0,
   user: undefined,
   password: undefined,
   headers: undefined,
   send: [Function],
   sendAsync: [Function],
   _alreadyWrapped: true },
network_id: '5777' }

</pre>
<div class="paragraph">
<p>L&#8217;objet METoken expose également plusieurs attributs, tels que l&#8217;adresse du contrat (telle que déployée par la commande migrate) :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.address</strong>
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'

</pre>
<div class="paragraph">
<p>Si nous voulons interagir avec le contrat déployé, nous devons utiliser un appel asynchrone, sous la forme d&#8217;une "promesse" JavaScript. Nous utilisons la fonction deployed pour obtenir l&#8217;instance de contrat, puis appelons la fonction totalSupply :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance => instance.totalSupply())</strong>
BigNumber { s: 1, e: 9, c: [ 2100000000 ] }

</pre>
<div class="paragraph">
<p>Ensuite, utilisons les comptes créés par ganache pour vérifier notre solde de METoken et envoyer des METoken à une autre adresse. Commençons par obtenir les adresses de compte :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>let accounts</strong>
undefined
truffle(ganache)&gt; <strong>web3.eth.getAccounts((err,res) => { accounts = res })</strong>
undefined
truffle(ganache)&gt; <strong>accounts[0]</strong>
'0x627306090abab3a6e1400e9345bc60c78a8bef57'

</pre>
<div class="paragraph">
<p>La liste accounts contient maintenant tous les comptes créés par <code>ganache</code>,et account[0] est le compte qui a déployé le contrat <code>METoken</code>.Il devrait avoir un solde de <span class="keep-together">METoken</span>, car notre constructeur METoken donne l&#8217;intégralité de l&#8217;offre de jetons à l&#8217;adresse qui l&#8217;a créé. Allons vérifier:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =></strong>
                  <strong>{ instance.balanceOf(accounts[0]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 9, c: [ 2100000000 ] }</strong>

</pre>
<div class="paragraph">
<p>Enfin, transférons 1000.00 METoken de account[0] vers <code>account[1]</code>,en appelant la fonction transfer du contrat :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.transfer(accounts[1], 100000) })</strong>
undefined
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(accounts[0]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 9, c: [ 2099900000 ] }</strong>
undefined
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(accounts[1]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 5, c: [ 100000 ] }</strong>

</pre>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>METoken a 2 décimales de précision, ce qui signifie que 1 METoken correspond à 100 unités dans le contrat. Lorsque nous transférons 1 000 METoken, nous spécifions la valeur comme 100000 dans l&#8217;appel à la fonction transfer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Comme vous pouvez le voir, dans la console, account[0] a maintenant 20 999 000 MET, et account[1] a 1 000 MET.</p>
</div>
<div class="paragraph">
<p>Si vous passez à l&#8217;interface utilisateur graphique <code>ganache</code>,comme indiqué dans <a href="#ganache_METoken_transfer">Transfert METoken sur ganache</a>, vous verrez la transaction qui a appelé la fonction transfer.</p>
</div>
<div id="ganache_METoken_transfer" class="imageblock">
<div class="content">
<img src="images/ganache_metoken_transfer.png" alt="Transfert METoken sur Ganache">
</div>
<div class="title">Figure 3. Transfert METoken sur ganache</div>
</div>
</div>
<div class="sect4">
<h5 id="sending_erc20_tokens_contracts">Envoi de jetons ERC20 aux adresses contractuelles</h5>
<div class="paragraph">
<p> Jusqu&#8217;à présent, nous avons configuré un jeton ERC20 et transféré certains jetons d&#8217;un compte à un autre. Tous les comptes que nous avons utilisés pour ces démonstrations sont des comptes externes, ce qui signifie qu&#8217;ils sont contrôlés par une clé privée et non par un contrat. Que se passe-t-il si nous envoyons MET à une adresse contractuelle ? Découvrons-le!</p>
</div>
<div class="paragraph">
<p>Tout d&#8217;abord, déployons un autre contrat dans notre environnement de test. Pour cet exemple, nous utiliserons notre premier contrat, <em>Faucet.sol</em>. Ajoutons-le au projet METoken en le copiant dans le répertoire <em>contracts</em>. Notre répertoire devrait ressembler à ceci :</p>
</div>
<div id="METoken_directory" class="listingblock">
<div class="content">
<pre>METoken/
+---- contracts
|   +---- Faucet.sol
|   +---- METoken.sol
|   `---- Migrations.sol</pre>
</div>
</div>
<div class="paragraph">
<p>Nous ajouterons également une migration, pour déployer Faucet séparément de METoken :</p>
</div>
<div id="faucet_migration" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var Faucet = artifacts.require("Faucet");

module.exports = function(deployer) {
  // Déployer le contrat Faucet comme seule tâche
  deployer.deploy(Faucet);
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compilons et migrons les contrats depuis la console Truffle :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt; <strong>compile</strong>
Compiling ./contracts/Faucet.sol...
Writing artifacts to ./build/contracts

truffle(ganache)&gt; <strong>migrate</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x89f6a7bd2a596829c60a483ec99665c7af71e68c77a417fab503c394fcd7a0c9
  Migrations: 0xa1ccce36fb823810e729dce293b75f40fb6ea9c9
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing METoken...
  ... 0x28d0da26f48765f67e133e99dd275fac6a25fdfec6594060fd1a0e09a99b44ba
  METoken: 0x7d6bf9d5914d37bcba9d46df7107e71c59f3791f
Saving artifacts...
Running migration: 3_deploy_faucet.js
  Deploying Faucet...
  ... 0x6fbf283bcc97d7c52d92fd91f6ac02d565f5fded483a6a0f824f66edc6fa90c3
  Faucet: 0xb18a42e9468f7f1342fa3c329ec339f254bc7524
Saving artifacts...

</pre>
<div class="paragraph">
<p>Génial. Envoyons maintenant du MET au contrat Faucet :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.transfer(Faucet.address, 100000) })</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(Faucet.address).then(console.log)})</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 5, c: [ 100000 ] }</strong>

</pre>
<div class="paragraph">
<p>D&#8217;accord, nous avons transféré 1 000 MET au contrat <code>Faucet</code>.Maintenant, comment retirer ces jetons ?</p>
</div>
<div class="paragraph">
<p>N&#8217;oubliez pas que <em>Faucet.sol</em> est un contrat assez simple. Il n&#8217;a qu&#8217;une seule fonction, <span class="keep-together"><code>withdraw</code></span>, qui sert à retirer de l'<em>ether</em>. Il n&#8217;a pas de fonction pour retirer le MET, ou tout autre jeton ERC20. Si nous utilisons <code>withdraw</code>,il essaiera d&#8217;envoyer de l&#8217;ether, mais comme Faucet n&#8217;a pas encore de solde d&#8217;ether, il échouera.</p>
</div>
<div class="paragraph">
<p>Le contrat METoken sait que Faucet a un solde, mais le seul moyen de transférer ce solde est de recevoir un appel transfer de l&#8217;adresse du contrat. D&#8217;une manière ou d&#8217;une autre, nous devons faire en sorte que le contrat Faucet appelle la fonction transfer dans <span class="keep-together"><code>METoken</code></span>.</p>
</div>
<div class="paragraph">
<p>Si vous vous demandez quoi faire ensuite, ne le faites pas. Il n&#8217;y a pas de solution à ce problème. Le MET envoyé à Faucet est bloqué, pour toujours. Seul le contrat Faucet peut le transférer, et le contrat Faucet n&#8217;a pas de code pour appeler la fonction transfer d&#8217;un contrat de jeton ERC20.</p>
</div>
<div class="paragraph">
<p>Peut-être avez-vous anticipé ce problème. Très probablement, vous ne l&#8217;avez pas fait. En fait, des centaines d&#8217;utilisateurs d&#8217;Ethereum qui ont accidentellement transféré divers jetons vers des contrats qui n&#8217;avaient aucune capacité ERC20 n&#8217;en ont pas non plus fait. Selon certaines estimations, des jetons d&#8217;une valeur de plus d&#8217;environ 2,5 millions de dollars (au moment de la rédaction) sont restés "bloqués" comme ça et sont perdus à jamais.</p>
</div>
<div class="paragraph">
<p>L&#8217;une des façons dont les utilisateurs de jetons ERC20 peuvent perdre par inadvertance leurs jetons lors d&#8217;un transfert, c&#8217;est lorsqu&#8217;ils tentent de transférer vers un échange ou un autre service. Ils copient une adresse Ethereum à partir du site Web d&#8217;un échange, pensant qu&#8217;ils peuvent simplement lui envoyer des jetons. Cependant, de nombreux échanges publient des adresses de réception qui sont en fait des contrats ! Ces contrats sont uniquement destinés à recevoir de l&#8217;ether, pas des jetons ERC20, balayant le plus souvent tous les fonds qui leur sont envoyés vers un « stockage à froid » ou un autre portefeuille centralisé. Malgré les nombreux avertissements indiquant "n&#8217;envoyez pas de jetons à cette adresse", de nombreux jetons sont perdus de cette façon.</p>
</div>
</div>
<div class="sect4">
<h5 id="transfer_workflow_demo">Démonstration du flux de travail "approuver et transférer de"</h5>
<div class="paragraph">
<p>Notre contrat Faucet ne pouvait pas gérer les jetons ERC20. L&#8217;envoi de jetons à l&#8217;aide de la fonction + transfer + a entraîné la perte de ces jetons. Réécrivons maintenant le contrat et faisons en sorte qu&#8217;il gère les jetons ERC20. Plus précisément, nous allons le transformer en un robinet qui donne du MET à quiconque le demande.</p>
</div>
<div class="paragraph">
<p>Pour cet exemple, nous allons faire une copie du répertoire du projet <em>truffle</em> (nous l&#8217;appellerons <em>METoken_METFaucet</em>), initialiser truffle et <code>npm</code>,installer les dépendances OpenZeppelin et copier le contrat <em>METoken.sol</em>. Voir notre premier exemple, dans <a href="#METoken_example">Lancement de notre propre jeton ERC20</a>, pour les instructions détaillées.</p>
</div>
<div class="paragraph">
<p>Notre nouveau contrat de robinetterie, <em>METFaucet.sol</em>, ressemblera à <a href="#METFaucet">METFaucet.sol : Un robinet pour METoken</a>.</p>
</div>
<div id="METFaucet" class="exampleblock">
<div class="title">Example 2. METFaucet.sol : Un robinet pour METoken</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version of Solidity compiler this program was written for
pragma solidity ^0.4.19;

import 'openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol';


// A faucet for ERC20 token MET
contract METFaucet {

	StandardToken public METoken;
	address public METOwner;

	// METFaucet constructor, provide the address of METoken contract and
	// the owner address we will be approved to transferFrom
	function METFaucet(address _METoken, address _METOwner) public {

		// Initialize the METoken from the address provided
		METoken = StandardToken(_METoken);
		METOwner = _METOwner;
	}

	function withdraw(uint withdraw_amount) public {

    	// Limit withdrawal amount to 10 MET
    	require(withdraw_amount &lt;= 1000);

		// Use the transferFrom function of METoken
		METoken.transferFrom(METOwner, msg.sender, withdraw_amount);
    }

	// REJECT any incoming ether
	function () external payable { revert(); }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Nous avons apporté quelques modifications à l&#8217;exemple de base de <code>Faucet</code>.Puisque METFaucet utilisera la fonction transferFrom dans <code>METoken</code>,il aura besoin de deux variables supplémentaires. L&#8217;un contiendra l&#8217;adresse du contrat METoken déployé. L&#8217;autre détiendra l&#8217;adresse du propriétaire du MET, qui approuvera les retraits du robinet. Le contrat METFaucet appellera METoken.transferFrom et lui demandera de déplacer le MET du propriétaire vers l&#8217;adresse d&#8217;où provient la demande de retrait du robinet.</p>
</div>
<div class="paragraph">
<p>Nous déclarons ici ces deux variables :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">StandardToken public METoken;
address public METOwner;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Étant donné que notre robinet doit être initialisé avec les adresses correctes pour METoken et <code>METOwner</code>,nous devons déclarer un constructeur personnalisé :</p>
</div>
<div id="custom_constructor" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Constructeur METFaucet - fournir l'adresse du contrat METoken et
// l'adresse du propriétaire que nous serons autorisés à transférer avec transferFrom
function METFaucet(address _METoken, address _METOwner) public {

	// Initialise le METoken à partir de l'adresse fournie
	METoken = StandardToken(_METoken);
	METOwner = _METOwner;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le prochain changement concerne la fonction <code>withdraw</code>.Au lieu d&#8217;appeler <code>transfer</code>,METFaucet utilise la fonction transferFrom dans METoken et demande à METoken de transférer MET au destinataire du robinet :</p>
</div>
<div id="transfer_met" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Utiliser la fonction transferFrom de METoken
METoken.transferFrom(METOwner, msg.sender, withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enfin, puisque notre robinet n&#8217;envoie plus d&#8217;ether, nous devrions probablement empêcher quiconque d&#8217;envoyer de l&#8217;ether à <code>METFaucet</code>,car nous ne voudrions pas qu&#8217;il reste bloqué. Nous modifions la fonction de paiement de secours pour rejeter l&#8217;ether entrant, en utilisant la fonction revert pour annuler tout paiement entrant :</p>
</div>
<div id="reject_incoming_eth" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// REJETER tout ether entrant
function () external payable { revert(); }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maintenant que notre code <em>METFaucet.sol</em> est prêt, nous devons modifier le script de migration pour le déployer. Ce script de migration sera un peu plus complexe, car METFaucet dépend de l&#8217;adresse de <code>METoken</code>.Nous utiliserons une promesse JavaScript pour déployer les deux contrats en séquence. Créez <em>2_deploy_contracts.js</em> comme suit :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var METoken = artifacts.require("METoken");
var METFaucet = artifacts.require("METFaucet");
var owner = web3.eth.accounts[0];

module.exports = function(deployer) {

	// Déployer d'abord le contrat METoken
	deployer.deploy(METoken, {from: owner}).then(function() {
		// Ensuite, déployer METFaucet et passez l'adresse de METoken et
		// l'adresse du propriétaire de tous les MET qui agréera METFaucet
		return deployer.deploy(METFaucet, METoken.address, owner);
  	});
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maintenant, nous pouvons tout tester dans la console Truffle. Tout d&#8217;abord, nous utilisons migrate pour déployer les contrats. Lorsque METoken est déployé, il alloue tout le MET au compte qui l&#8217;a créé, <code>web3.eth.accounts[0]</code>.Ensuite, nous appelons la fonction approve dans <code><span class="keep-together">METoken</span></code> pour approuver METFaucet afin d&#8217;envoyer jusqu&#8217;à 1 000 MET au nom de <code>web3.eth.accounts[0]</code>.Enfin, pour tester notre faucet, nous appelons METFaucet.withdraw depuis web3.eth.accounts[1] et essayons de retirer 10 MET. Voici les commandes de la console :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt; <strong>migrate</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x79352b43e18cc46b023a779e9a0d16b30f127bfa40266c02f9871d63c26542c7
  Migrations: 0xaa588d3737b611bafd7bd713445b314bd453a5c8
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing METoken...
  ... 0xc42a57f22cddf95f6f8c19d794c8af3b2491f568b38b96fef15b13b6e8bfff21
  METoken: 0xf204a4ef082f5c04bb89f7d5e6568b796096735a
  Replacing METFaucet...
  ... 0xd9615cae2fa4f1e8a377de87f86162832cf4d31098779e6e00df1ae7f1b7f864
  METFaucet: 0x75c35c980c0d37ef46df04d31a140b65503c0eed
Saving artifacts...
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.approve(METFaucet.address, 100000) })</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(web3.eth.accounts[1]).then(console.log) })</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 0, c: [ 0 ] }</strong>
truffle(ganache)&gt; <strong>METFaucet.deployed().then(instance =>
                  { instance.withdraw(1000, {from:web3.eth.accounts[1]}) } )</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(web3.eth.accounts[1]).then(console.log) })</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 3, c: [ 1000 ] }</strong>

</pre>
<div class="paragraph">
<p>Comme vous pouvez le voir sur les résultats, nous pouvons utiliser le flux de travail approve et transferFrom pour autoriser un contrat à transférer des jetons définis dans un autre jeton. S&#8217;ils sont correctement utilisés, les jetons ERC20 peuvent être utilisés par les EOA et d&#8217;autres contrats.</p>
</div>
<div class="paragraph">
<p>Cependant, la charge de gérer correctement les jetons ERC20 est transmise à l&#8217;interface utilisateur. Si un utilisateur tente à tort de transférer des jetons ERC20 vers une adresse de contrat et que ce contrat n&#8217;est pas équipé pour recevoir des jetons ERC20, les jetons seront perdus.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ERC20_issues">Problèmes avec les jetons ERC20</h4>
<div class="paragraph">
<p>L&#8217;adoption de la norme de jeton ERC20 a été vraiment explosive. Des milliers de jetons ont été lancés, à la fois pour expérimenter de nouvelles capacités et pour lever des fonds dans diverses enchères et "financements participatifs" ICO. Cependant, il existe des pièges potentiels, comme nous l&#8217;avons vu avec la question du transfert de jetons vers des adresses contractuelles.</p>
</div>
<div class="paragraph">
<p>L&#8217;un des problèmes les moins évidents avec les jetons ERC20 est qu&#8217;ils exposent des différences subtiles entre les jetons et l&#8217;ether lui-même. Lorsque l&#8217;ether est transféré par une transaction qui a une adresse de destinataire comme destination, les transferts de jeton se produisent dans l'<em>état spécifique du contrat de jeton</em> et ont le contrat de jeton comme destination, et non l&#8217;adresse du destinataire. Le contrat de jeton suit les soldes et émet des événements. Dans un transfert de jeton, aucune transaction n&#8217;est réellement envoyée au destinataire du jeton. Au lieu de cela, l&#8217;adresse du destinataire est ajoutée à un tableau dans le contrat de jeton lui-même. Une transaction envoyant de l&#8217;ether à une adresse modifie l&#8217;état d&#8217;une adresse. Une transaction transférant un jeton à une adresse ne modifie que l&#8217;état du contrat de jeton, pas l&#8217;état de l&#8217;adresse du destinataire. Même un portefeuille prenant en charge les jetons ERC20 ne prend pas connaissance d&#8217;un solde de jetons à moins que l&#8217;utilisateur n&#8217;ajoute explicitement un contrat de jeton spécifique à « surveiller ». Certains portefeuilles surveillent les contrats de jetons les plus populaires pour détecter les soldes détenus par les adresses qu&#8217;ils contrôlent, mais cela est limité à une petite fraction des <span class="keep-together">contrats</span> ERC20 existants.</p>
</div>
<div class="paragraph">
<p>En fait, il est peu probable qu&#8217;un utilisateur veuille suivre tous les soldes de tous les contrats de jetons ERC20 possibles. De nombreux jetons ERC20 ressemblent plus à du courrier indésirable qu&#8217;à des jetons utilisables. Ils créent automatiquement des soldes pour les comptes qui ont une activité ether, afin d&#8217;attirer les utilisateurs. Si vous avez une adresse Ethereum avec une longue histoire d&#8217;activité, surtout si elle a été créée lors de la prévente, vous la trouverez pleine de jetons "indésirables" qui sont apparus de nulle part. Bien sûr, l&#8217;adresse n&#8217;est pas vraiment pleine de jetons ; ce sont les contrats symboliques qui contiennent votre adresse. Vous ne voyez ces soldes que si ces contrats de jetons sont surveillés par l&#8217;explorateur de blocs ou le portefeuille que vous utilisez pour afficher votre adresse.</p>
</div>
<div class="paragraph">
<p>Les jetons ne se comportent pas de la même manière que l&#8217;ether. L&#8217;ether est envoyé avec la fonction send et accepté par toute fonction payante dans un contrat ou toute adresse détenue en externe. Les jetons sont envoyés à l&#8217;aide des fonctions transfer ou approve et transferFrom qui n&#8217;existent que dans le contrat ERC20, et ne déclenchent (du moins dans ERC20) aucune fonction payante dans un contrat destinataire. Les jetons sont censés fonctionner comme une cryptomonnaie telle que l&#8217;ether, mais ils présentent certaines différences qui brisent cette illusion.</p>
</div>
<div class="paragraph">
<p>Envisagez un autre problème. Pour envoyer de l&#8217;ether ou utiliser un contrat Ethereum, vous avez besoin d&#8217;ether pour payer le gaz. Pour envoyer des jetons, vous avez <em>également besoin d&#8217;ether</em>. Vous ne pouvez pas payer le gaz d&#8217;une transaction avec un jeton et le contrat de jeton ne peut pas payer le gaz pour vous. Cela peut changer à un moment donné dans un avenir lointain, mais entre-temps, cela peut entraîner des expériences utilisateur plutôt étranges. Par exemple, supposons que vous utilisiez un échange ou ShapeShift pour convertir du bitcoin en jeton. Vous "recevez" le jeton dans un portefeuille qui suit le contrat de ce jeton et affiche votre solde. Il ressemble à toutes les autres crypto-monnaies que vous avez dans votre portefeuille. Essayez d&#8217;envoyer le jeton et votre portefeuille vous informera que vous avez besoin d&#8217;ether pour le faire. Vous pourriez être confus - après tout, vous n&#8217;aviez pas besoin d&#8217;ether pour recevoir le jeton. Peut-être que vous n&#8217;avez pas d&#8217;ether. Peut-être ne saviez-vous même pas que le jeton était un jeton ERC20 sur Ethereum; peut-être pensiez-vous qu&#8217;il s&#8217;agissait d&#8217;une cryptomonnaie avec sa propre chaîne de blocs. L&#8217;illusion vient de se briser.</p>
</div>
<div class="paragraph">
<p>Certains de ces problèmes sont spécifiques aux jetons ERC20. D&#8217;autres sont des problèmes plus généraux liés à l&#8217;abstraction et aux limites d&#8217;interface au sein d&#8217;Ethereum. Certains peuvent être résolus en modifiant l&#8217;interface du jeton, tandis que d&#8217;autres peuvent nécessiter des modifications des structures fondamentales au sein d&#8217;Ethereum (comme la distinction entre EOA et contrats, et entre transactions et messages). Certains peuvent ne pas être exactement "solvable" et peuvent nécessiter une conception d&#8217;interface utilisateur pour masquer les nuances et rendre l&#8217;expérience utilisateur cohérente, quelles que soient les distinctions sous-jacentes.</p>
</div>
<div class="paragraph">
<p>Dans les prochaines sections, nous examinerons diverses propositions qui tentent de résoudre certains de ces problèmes.</p>
</div>
</div>
<div class="sect3">
<h4 id="ERC223_std">ERC223 : une norme d&#8217;interface de contrat de jeton proposée</h4>
<div class="paragraph">
<p>La proposition ERC223 tente de résoudre le problème du transfert par inadvertance de jetons vers un contrat (qui peut ou non prendre en charge jetons) en détectant si l&#8217;adresse de destination est un contrat ou non. ERC223 exige que les contrats conçus pour accepter des jetons implémentent une fonction nommée <code>tokenFallback</code>.Si la destination d&#8217;un transfert est un contrat et que le contrat ne prend pas en charge les jetons (c&#8217;est-à-dire qu&#8217;il n&#8217;implémente pas tokenFallback), le transfert échoue.</p>
</div>
<div id="is_contract" class="paragraph">
<p>Pour détecter si l&#8217;adresse de destination est un contrat, l&#8217;implémentation de référence ERC223 utilise un petit segment de code intermédiaire en ligne d&#8217;une manière plutôt créative :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function isContract(address _addr) private view returns (bool is_contract) {
  uint length;
    assembly {
       // récupère la taille du code sur l'adresse cible ; cela nécessite un assemblage
       length := extcodesize(_addr)
    }
    return (length&gt;0);
}</code></pre>
</div>
</div>
<div id="ERC223_interface" class="paragraph">
<p>La spécification de l&#8217;interface de contrat ERC223 est :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC223Token {
  uint public totalSupply;
  function balanceOf(address who) public view returns (uint);

  function name() public view returns (string _name);
  function symbol() public view returns (string _symbol);
  function decimals() public view returns (uint8 _decimals);
  function totalSupply() public view returns (uint256 _supply);

  function transfer(address to, uint value) public returns (bool ok);
  function transfer(address to, uint value, bytes data) public returns (bool ok);
  function transfer(address to, uint value, bytes data, string custom_fallback)
      public returns (bool ok);

  event Transfer(address indexed from, address indexed to, uint value,
                 bytes indexed data);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ERC223 n&#8217;est pas largement mis en œuvre, et il y a un débat dans le fil <a href="https://github.com/ethereum/EIPs/issues/223">de discussion ERC</a> sur la rétrocompatibilité et les compromis entre la mise en œuvre des changements au niveau de l&#8217;interface du contrat par rapport à l&#8217;interface utilisateur. Le débat continue.</p>
</div>
</div>
<div class="sect3">
<h4 id="_erc777_une_norme_dinterface_de_contrat_de_jeton_proposée">ERC777 : une norme d&#8217;interface de contrat de jeton proposée</h4>
<div class="paragraph">
<p>Une autre proposition pour une norme de contrat de jeton améliorée est <a href="https://eips.ethereum.org/EIPS/eip-777">ERC777</a>. Cette proposition a plusieurs objectifs, notamment :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Offrir une interface compatible ERC20</p>
</li>
<li>
<p>Pour transférer des jetons à l&#8217;aide d&#8217;une fonction <code>send</code>,similaire aux transferts d&#8217;ether</p>
</li>
<li>
<p>Pour être compatible avec ERC820 pour l&#8217;enregistrement de contrat de jeton</p>
</li>
<li>
<p>Pour permettre aux contrats et aux adresses de contrôler les jetons qu&#8217;ils envoient via une fonction <code>tokensToSend</code> qui est appelée avant l&#8217;envoi</p>
</li>
<li>
<p>Pour permettre aux contrats et aux adresses d&#8217;être informés de la réception des jetons en appelant une fonction <code>tokensReceived</code> dans le destinataire, et pour réduire la probabilité que les jetons soient verrouillés dans des contrats en exigeant que les contrats fournissent une fonction <span class="keep-together"><code>tokensReceived</code></span></p>
</li>
<li>
<p>Pour permettre aux contrats existants d&#8217;utiliser des contrats par procuration pour les fonctions tokensToSend et tokensReceived</p>
</li>
<li>
<p>Pour fonctionner de la même manière que vous envoyiez vers un contrat ou un EOA</p>
</li>
<li>
<p>Pour fournir des événements spécifiques pour la frappe et la gravure de jetons</p>
</li>
<li>
<p>Pour permettre aux opérateurs (tiers de confiance, destinés à être des contrats vérifiés) de déplacer des jetons pour le compte d&#8217;un détenteur de jetons</p>
</li>
<li>
<p>Pour fournir des métadonnées sur les transactions de transfert de jetons dans les champs userData et operatorData</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La discussion en cours sur ERC777 peut être trouvée <a href="https://github.com/ethereum/EIPs/issues/777">sur GitHub</a>.</p>
</div>
<div id="ERC777_interface" class="paragraph">
<p>La spécification de l&#8217;interface de contrat ERC777 est :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777Token {
    function name() public constant returns (string);
    function symbol() public constant returns (string);
    function totalSupply() public constant returns (uint256);
    function granularity() public constant returns (uint256);
    function balanceOf(address owner) public constant returns (uint256);

    function send(address to, uint256 amount, bytes userData) public;

    function authorizeOperator(address operator) public;
    function revokeOperator(address operator) public;
    function isOperatorFor(address operator, address tokenHolder)
        public constant returns (bool);
    function operatorSend(address from, address to, uint256 amount,
                          bytes userData,bytes operatorData) public;

    event Sent(address indexed operator, address indexed from,
               address indexed to, uint256 amount, bytes userData,
               bytes operatorData);
    event Minted(address indexed operator, address indexed to,
                 uint256 amount, bytes operatorData);
    event Burned(address indexed operator, address indexed from,
                 uint256 amount, bytes userData, bytes operatorData);
    event AuthorizedOperator(address indexed operator,
                             address indexed tokenHolder);
    event RevokedOperator(address indexed operator, address indexed tokenHolder);
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="ERC777_hooks">Crochets ERC777</h5>
<div id="ERC777TokensSender_interface" class="paragraph">
<p>La spécification de crochet d&#8217;expéditeur de jetons ERC777 est :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777TokensSender {
    function tokensToSend(address operator, address from, address to,
                          uint value, bytes userData, bytes operatorData) public;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>La mise en place de cette interface est nécessaire pour toute adresse souhaitant être notifiée, gérer ou empêcher le débit de jetons. L&#8217;adresse pour laquelle le contrat implémente cette interface doit être enregistrée via ERC820, que le contrat implémente l&#8217;interface pour lui-même ou pour une autre adresse.</p>
</div>
<div id="ERC777TokensRecipient_interface" class="paragraph">
<p>La spécification du crochet du destinataire des jetons ERC777 est :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777TokensRecipient {
  function tokensReceived(
     address operator, address from, address to,
    uint amount, bytes userData, bytes operatorData
  ) public;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>La mise en place de cette interface est nécessaire pour toute adresse souhaitant être notifiée, traiter ou rejeter la réception de jetons. La même logique et les mêmes exigences s&#8217;appliquent au destinataire des jetons qu&#8217;à l&#8217;interface de l&#8217;expéditeur des jetons, avec la contrainte supplémentaire que les contrats destinataires doivent implémenter cette interface pour empêcher le verrouillage des jetons. Si le contrat destinataire n&#8217;enregistre pas d&#8217;adresse implémentant cette interface, le transfert des jetons échouera.</p>
</div>
<div class="paragraph">
<p>Un aspect important est qu&#8217;un seul expéditeur de jeton et un seul destinataire de jeton peuvent être enregistrés par adresse. Par conséquent, pour chaque transfert de jeton ERC777, les mêmes fonctions de crochet sont appelées lors du débit et de la réception de chaque transfert de jeton ERC777. Un jeton spécifique peut être identifié dans ces fonctions à l&#8217;aide de l&#8217;expéditeur du message, qui est l&#8217;adresse de contrat de jeton spécifique, pour gérer un cas d&#8217;utilisation particulier.</p>
</div>
<div class="paragraph">
<p>D&#8217;autre part, les mêmes hooks d&#8217;expéditeur et de destinataire de jeton peuvent être enregistrés pour plusieurs adresses et les hooks peuvent distinguer qui sont l&#8217;expéditeur et le destinataire prévu à l&#8217;aide des paramètres "from" et "to".</p>
</div>
<div class="paragraph">
<p>Une <a href="http://bit.ly/2qkAKba">implémentation de référence</a> d&#8217;ERC777 est liée dans la proposition. ERC777 dépend d&#8217;une proposition parallèle de contrat de registre, spécifiée dans ERC820. Une partie du débat sur ERC777 porte sur la complexité de l&#8217;adoption simultanée de deux grands changements : une nouvelle norme de jeton et une norme de registre. La discussion continue.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="erc721">ERC721 : norme de jeton non fongible (acte)</h4>
<div class="paragraph">
<p>Toutes les normes de jeton que nous avons examinées jusqu&#8217;à présent concernent les jetons <em>fungible</em>, ce qui signifie que les unités de un jeton sont interchangeables. La norme de jeton ERC20 ne suit que le solde final de chaque compte et ne suit pas (explicitement) la provenance d&#8217;un jeton.</p>
</div>
<div class="paragraph">
<p> La <a href="http://bit.ly/2Ogs7Im">proposition ERC721</a> concerne une norme pour les jetons <em>non fongibles</em>, également appelés <em>actes</em>.</p>
</div>
<div class="paragraph">
<p>Extrait du dictionnaire Oxford :</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>acte</em> : un document juridique qui est signé et remis, en particulier un document concernant la propriété d&#8217;un bien ou des droits légaux.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>L&#8217;utilisation du mot "acte" est destinée à refléter la partie "propriété d&#8217;un bien", même si ceux-ci ne sont pas reconnus comme des "documents juridiques" dans aucune juridiction - pour le moment. Il est probable qu&#8217;à un moment donné dans le futur, la propriété légale basée sur des signatures numériques sur une plate-forme chaîne de blocs sera légalement reconnue.</p>
</div>
<div class="paragraph">
<p>Les jetons non fongibles suivent la propriété d&#8217;une chose unique. L&#8217;objet possédé peut être un objet numérique, tel qu&#8217;un objet de jeu ou un objet de collection numérique ; ou la chose peut être un objet physique dont la propriété est suivie par un jeton, comme une maison, une voiture ou une œuvre d&#8217;art. Les actes peuvent également représenter des choses de valeur négative, telles que des prêts (dettes), des privilèges, des servitudes, etc. La norme ERC721 n&#8217;impose aucune limitation ou attente sur la nature de la chose dont la propriété est suivie par un acte et exige seulement qu&#8217;elle puisse être identifié de manière unique, ce qui, dans le cas de cette norme, est obtenu par un <span class="keep-together">identifiant</span> de 256 bits .</p>
</div>
<div class="paragraph">
<p>Les détails de la norme et de la discussion sont suivis sur deux <span class="keep-together">fils</span> GitHub différents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/ethereum/EIPs/issues/721">Proposition initiale</a></p>
</li>
<li>
<p><a href="https://github.com/ethereum/EIPs/pull/841">Discussion continue</a></p>
</li>
</ul>
</div>
<div id="map_deed_owner" class="paragraph">
<p>Pour saisir la différence fondamentale entre ERC20 et ERC721, il suffit de regarder la structure de données interne utilisée dans ERC721 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Mappage de l'ID de l'acte au propriétaire
mapping (uint256 =&gt; address) private deedOwner;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alors que l&#8217;ERC20 suit les soldes appartenant à chaque propriétaire, le propriétaire étant la clé primaire du mappage, l&#8217;ERC721 suit chaque ID d&#8217;acte et son propriétaire, l&#8217;ID d&#8217;acte étant la clé primaire du mappage. De cette différence fondamentale découlent toutes les propriétés d&#8217;un jeton non fongible.</p>
</div>
<div id="ERC721_interface" class="paragraph">
<p>La spécification de l&#8217;interface de contrat ERC721 est :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721 /* is ERC165 */ {
    event Transfer(address indexed _from, address indexed _to, uint256 _deedId);
    event Approval(address indexed _owner, address indexed _approved,
                   uint256 _deedId);
    event ApprovalForAll(address indexed _owner, address indexed _operator,
                         bool _approved);

    function balanceOf(address _owner) external view returns (uint256 _balance);
    function ownerOf(uint256 _deedId) external view returns (address _owner);
    function transfer(address _to, uint256 _deedId) external payable;
    function transferFrom(address _from, address _to, uint256 _deedId)
        external payable;
    function approve(address _approved, uint256 _deedId) external payable;
    function setApprovalForAll(address _operateor, boolean _approved) payable;
    function supportsInterface(bytes4 interfaceID) external view returns (bool);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ERC721 prend également en charge deux interfaces <em>optionnelles</em>, une pour les métadonnées et une pour l&#8217;énumération des actes et des propriétaires.</p>
</div>
<div id="ERC721_metadata" class="paragraph">
<p>L&#8217;interface optionnelle ERC721 pour les métadonnées est :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721Metadata /* is ERC721 */ {
    function name() external pure returns (string _name);
    function symbol() external pure returns (string _symbol);
    function deedUri(uint256 _deedId) external view returns (string _deedUri);
}</code></pre>
</div>
</div>
<div id="ERC721_enum" class="paragraph">
<p>L&#8217;interface optionnelle ERC721 pour l&#8217;énumération est :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721Enumerable /* is ERC721 */ {
    function totalSupply() external view returns (uint256 _count);
    function deedByIndex(uint256 _index) external view returns (uint256 _deedId);
    function countOfOwners() external view returns (uint256 _count);
    function ownerByIndex(uint256 _index) external view returns (address _owner);
    function deedOfOwnerByIndex(address _owner, uint256 _index) external view
        returns (uint256 _deedId);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="token_std_review">Utilisation des normes de jeton</h3>
<div class="paragraph">
<p>Dans la section précédente, nous avons examiné plusieurs normes proposées et quelques normes largement déployées pour les contrats de jetons. A quoi servent exactement ces normes ? Devez-vous utiliser ces normes ? Comment devriez-vous les utiliser ? Devriez-vous ajouter des fonctionnalités au-delà de ces normes ? Quelles normes devez-vous utiliser ? Nous examinerons ensuite certaines de ces questions.</p>
</div>
<div class="sect3">
<h4 id="token_std_purpose">Que sont les normes de jeton ? Quel est leur but ?</h4>
<div class="paragraph">
<p>Les normes de jetons sont les spécifications <em>minimales</em> pour une implémentation. Cela signifie que pour être conforme, par exemple, à ERC20, vous devez au minimum implémenter les fonctions et le comportement spécifiés par la norme ERC20. Vous êtes également libre d'<em>ajouter</em> à la fonctionnalité en implémentant des fonctions qui ne font pas partie de la norme.</p>
</div>
<div class="paragraph">
<p>L&#8217;objectif principal de ces normes est d&#8217;encourager l'<em>interopérabilité</em> entre les contrats. Ainsi, tous les portefeuilles, échanges, interfaces utilisateur et autres composants d&#8217;infrastructure peuvent <em>s&#8217;interfacer</em> de manière prévisible avec tout contrat qui suit la spécification. En d&#8217;autres termes, si vous déployez un contrat qui suit la norme ERC20, tous les utilisateurs de portefeuille existants peuvent commencer à échanger votre jeton de manière transparente sans aucune mise à niveau de portefeuille ni effort de votre part.</p>
</div>
<div class="paragraph">
<p>Les normes sont censées être <em>descriptives</em> plutôt que <em>prescriptives</em>. La façon dont vous choisissez de mettre en œuvre ces fonctions dépend de vous - le fonctionnement interne du contrat n&#8217;est pas pertinent pour la norme. Ils ont des exigences fonctionnelles, qui régissent le comportement dans des circonstances spécifiques, mais ils ne prescrivent pas de mise en œuvre. Un exemple de ceci est le comportement d&#8217;une fonction transfer si la valeur est définie sur zéro.</p>
</div>
</div>
<div class="sect3">
<h4 id="should_use_std">Devriez-vous utiliser ces normes ?</h4>
<div class="paragraph">
<p>Compte tenu de tous ces standards, chaque développeur est confronté à un dilemme : utiliser les standards existants ou innover au-delà des contraintes qu&#8217;ils imposent ?</p>
</div>
<div class="paragraph">
<p>Ce dilemme n&#8217;est pas facile à résoudre. Les normes restreignent nécessairement votre capacité à innover, en créant une "ornière" étroite que vous devez suivre. D&#8217;autre part, les normes de base ont émergé de l&#8217;expérience de centaines d&#8217;applications et s&#8217;adaptent souvent bien à la grande majorité des cas d&#8217;utilisation.</p>
</div>
<div class="paragraph">
<p>Dans le cadre de cette considération, il y a un problème encore plus important : la valeur de l&#8217;interopérabilité et de l&#8217;adoption à grande échelle. Si vous choisissez d&#8217;utiliser une norme existante, vous gagnez la valeur de tous les systèmes conçus pour fonctionner avec cette norme. Si vous choisissez de vous écarter de la norme, vous devez prendre en compte le coût de la construction de toute l&#8217;infrastructure de support par vous-même ou persuader les autres de prendre en charge votre mise en œuvre en tant que nouvelle norme. La tendance à forger votre propre chemin et à ignorer les normes existantes est connue sous le nom de syndrome "Not Invented Here" (Non inventé ici) et est contraire à la culture open source. D&#8217;autre part, le progrès et l&#8217;innovation dépendent parfois de l&#8217;abandon de la tradition. C&#8217;est un choix délicat, alors réfléchissez bien !</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Selon Wikipedia, <a href="https://en.wikipedia.org/wiki/Not_invented_here">"Not Invented Here"</a> est une position adoptée par les cultures sociales, d&#8217;entreprise ou institutionnelles qui évitent d&#8217;utiliser ou d&#8217;acheter des produits, des recherches, des normes ou des connaissances déjà existants en raison de leurs origines externes et de leurs coûts, tels que les redevances.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sécurité_maturité">Sécurité par maturité</h4>
<div class="paragraph">
<p>Au-delà du choix de la norme, il y a le choix parallèle de <em>la mise en oeuvre</em>. Lorsque vous décidez d&#8217;utiliser une norme telle que ERC20, vous devez ensuite décider comment mettre en œuvre une conception compatible. Il existe un certain nombre d&#8217;implémentations "de référence" existantes qui sont largement utilisées dans l&#8217;écosystème Ethereum, ou vous pouvez écrire la vôtre à partir de zéro. Encore une fois, ce choix représente un dilemme qui peut avoir de graves implications en matière de sécurité.</p>
</div>
<div class="paragraph">
<p>Les implémentations existantes sont "testées au combat". Bien qu&#8217;il soit impossible de prouver qu&#8217;ils sont sécurisés, beaucoup d&#8217;entre eux sous-tendent des millions de dollars de jetons. Ils ont été attaqués, à plusieurs reprises et vigoureusement. Jusqu&#8217;à présent, aucune vulnérabilité significative n&#8217;a été découverte. Rédiger le vôtre n&#8217;est pas facile - il existe de nombreuses façons subtiles de compromettre un contrat. Il est beaucoup plus sûr d&#8217;utiliser une implémentation largement testée et largement utilisée. Dans nos exemples, nous avons utilisé l&#8217;implémentation OpenZeppelin de la norme ERC20, car cette implémentation est entièrement axée sur la sécurité.</p>
</div>
<div class="paragraph">
<p>Si vous utilisez une implémentation existante, vous pouvez également l&#8217;étendre. Encore une fois, cependant, soyez prudent avec cette impulsion. La complexité est l&#8217;ennemie de la sécurité. Chaque ligne de code que vous ajoutez étend la <em>surface d&#8217;attaque</em> de votre contrat et pourrait représenter une vulnérabilité en attente. Vous ne remarquerez peut-être pas un problème jusqu&#8217;à ce que vous accordiez beaucoup de valeur au contrat et que quelqu&#8217;un le rompe.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Les normes et les choix de mise en œuvre sont des éléments importants de la conception globale des contrats intelligents sécurisés, mais ce ne sont pas les seules considérations. Voir <a href="#smart_contract_security">[smart_contract_security]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extend_token_interface">Extensions aux normes d&#8217;interface de jeton</h3>
<div class="paragraph">
<p>Les normes de jetons abordées dans ce chapitre fournissent une interface très minimale, avec des fonctionnalités limitées. De nombreux projets ont créé des implémentations étendues pour prendre en charge les fonctionnalités dont ils ont besoin pour leurs applications. Certaines de ces fonctionnalités incluent :</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Contrôle du propriétaire</dt>
<dd>
<p>La possibilité de donner des adresses spécifiques ou des ensembles d&#8217;adresses (c&#8217;est-à-dire des schémas multisignatures), des capacités spéciales, telles que la liste noire, la liste blanche, la frappe, la récupération, etc.</p>
</dd>
<dt class="hdlist1">Brûlure</dt>
<dd>
<p>La capacité de détruire délibérément ("brûler") des jetons en les transférant à une adresse inutilisable ou en effaçant un solde et en réduisant l&#8217;approvisionnement.</p>
</dd>
<dt class="hdlist1">Frappe</dt>
<dd>
<p>La possibilité d&#8217;ajouter à l&#8217;offre totale de jetons, à un rythme prévisible ou par "fiat" du créateur du jeton.</p>
</dd>
<dt class="hdlist1">Financement participatif</dt>
<dd>
<p>La possibilité de proposer des jetons à la vente, par exemple par le biais d&#8217;une vente aux enchères, d&#8217;une vente sur le marché, d&#8217;une vente aux enchères inversée, etc.</p>
</dd>
<dt class="hdlist1">Limites</dt>
<dd>
<p>La possibilité de fixer des limites prédéfinies et immuables sur l&#8217;offre totale (à l&#8217;opposé de la fonction "frappe").</p>
</dd>
<dt class="hdlist1">Portes dérobées de récupération</dt>
<dd>
<p>Fonctions pour récupérer des fonds, annuler des transferts ou démanteler le jeton qui peuvent être activés par une adresse désignée ou un ensemble d&#8217;adresses.</p>
</dd>
<dt class="hdlist1">Liste blanche</dt>
<dd>
<p>La possibilité de restreindre les actions (telles que les transferts de jetons) à des adresses spécifiques. Le plus souvent utilisé pour offrir des jetons à des "investisseurs accrédités" après vérification par les règles de différentes juridictions. Il existe généralement un mécanisme de mise à jour de la liste blanche.</p>
</dd>
<dt class="hdlist1">Liste noire</dt>
<dd>
<p>La possibilité de restreindre les transferts de jetons en interdisant des adresses spécifiques. Il existe généralement une fonction de mise à jour de la liste noire.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Il existe des implémentations de référence pour bon nombre de ces fonctions, par exemple dans la bibliothèque OpenZeppelin. Certains d&#8217;entre eux sont spécifiques à un cas d&#8217;utilisation et ne sont implémentés que dans quelques jetons. Il n&#8217;existe pas, à l&#8217;heure actuelle, de normes largement acceptées pour les interfaces avec ces fonctions.</p>
</div>
<div class="paragraph">
<p>Comme indiqué précédemment, la décision d&#8217;étendre une norme de jeton avec des fonctionnalités supplémentaires représente un compromis entre innovation/risque et interopérabilité/sécurité.</p>
</div>
</div>
<div class="sect2">
<h3 id="tokens_ico">Jetons et ICO</h3>
<div class="paragraph">
<p>Les jetons ont connu un développement explosif dans l&#8217;écosystème Ethereum. Il est probable qu&#8217;ils deviendront un élément très important de toutes les plateformes de contrats intelligents comme Ethereum.</p>
</div>
<div class="paragraph">
<p>Néanmoins, l&#8217;importance et l&#8217;impact futur de ces normes ne doivent pas être confondus avec une approbation des offres de jetons actuelles. Comme dans toute technologie à un stade précoce, la première vague de produits et d&#8217;entreprises échouera presque toutes, et certaines échoueront de manière spectaculaire. La plupart des jetons proposés dans Ethereum aujourd&#8217;hui sont des escroqueries à peine déguisées, des systèmes pyramidaux et des prises d&#8217;argent.</p>
</div>
<div class="paragraph">
<p>L&#8217;astuce consiste à séparer la vision et l&#8217;impact à long terme de cette technologie, qui risque d&#8217;être énorme, de la bulle à court terme des ICO symboliques, qui sont en proie à la fraude. Les normes de jetons et la plate-forme survivront à la manie actuelle des jetons, puis ils changeront probablement le monde.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>Les jetons sont un concept très puissant dans Ethereum et peuvent constituer la base de nombreuses applications décentralisées importantes. Dans ce chapitre, nous avons examiné les différents types de jetons et les normes de jeton, et vous avez construit votre premier jeton et l&#8217;application associée. Nous reviendrons à nouveau sur les jetons dans <a href="#decentralized_applications_chap">[decentralized_applications_chap]</a>, où vous utiliserez un jeton non fongible comme base pour un DApp d&#8217;enchères.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-05-15 05:36:38 -0400
</div>
</div>
</body>
</html>