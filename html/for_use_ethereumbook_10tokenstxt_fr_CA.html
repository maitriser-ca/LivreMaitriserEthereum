<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Jetons</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="tokens_chapter">Jetons</h2>
<div class="sectionbody">
<div class="paragraph data-line-5">
<p>The word "token" derives from the Old English "tƒÅcen," meaning a sign or symbol. It is commonly used to refer to privately issued special-purpose coin-like items of insignificant intrinsic value, such as transportation tokens, laundry tokens, and arcade game tokens.</p>
</div>
<div class="paragraph data-line-7">
<p>Nowadays, "tokens" administered on blockchains are redefining the word to mean blockchain-based abstractions that can be owned and that represent assets, currency, or access rights.</p>
</div>
<div class="paragraph data-line-9">
<p>The association between the word "token" and insignificant value has a lot to do with the limited use of the physical versions of tokens. Often restricted to specific businesses, organizations, or locations, physical tokens are not easily exchangeable and typically have only one function. With blockchain tokens, these restrictions are lifted&#x2014;or, more accurately, completely redefinable. Many blockchain tokens serve multiple purposes globally and can be traded for each other or for other currencies on global liquid markets. With the restrictions on use and ownership gone, the "insignificant value" expectation is also a thing of the past.</p>
</div>
<div class="paragraph data-line-11">
<p>In this chapter, we look at various uses for tokens and how they are created. We also discuss attributes of tokens such as fungibility and intrinsicality. Finally, we examine the standards and technologies that they are based on, and experiment by building our own tokens.</p>
</div>
<div class="sect2 data-line-14">
<h3 id="tokens_use">How Tokens Are Used</h3>
<div class="paragraph data-line-16">
<p>The most obvious use of tokens is as digital private currencies. However, this is only one possible use. Tokens can be programmed to serve many different functions, often overlapping. For example, a token can simultaneously convey a voting right, an access right, and ownership of a resource. As the following list shows, currency is just the first "app":</p>
</div>
<div class="dlist data-line-18">
<dl>
<dt class="hdlist1">Currency</dt>
<dd>
<p>A token can serve as a form of currency, with a value determined through private trade.</p>
</dd>
<dt class="hdlist1">Resource</dt>
<dd>
<p>A token can represent a resource earned or produced in a sharing economy or resource-sharing environment; for example, a storage or CPU token representing resources that can be shared over a network.</p>
</dd>
<dt class="hdlist1">Asset</dt>
<dd>
<p>A token can represent ownership of an intrinsic or extrinsic, tangible or intangible asset; for example, gold, real estate, a car, oil, energy, MMOG items, etc.</p>
</dd>
<dt class="hdlist1">Access</dt>
<dd>
<p>A token can represent access rights and grant access to a digital or physical property, such as a discussion forum, an exclusive website, a hotel room, or a rental car.</p>
</dd>
<dt class="hdlist1">Equity</dt>
<dd>
<p>A token can represent shareholder equity in a digital organization (e.g., a DAO) or legal entity (e.g., a corporation).</p>
</dd>
<dt class="hdlist1">Voting</dt>
<dd>
<p>A token can represent voting rights in a digital or legal system.</p>
</dd>
<dt class="hdlist1">Collectible</dt>
<dd>
<p>A token can represent a digital collectible (e.g., CryptoPunks) or physical collectible (e.g., a painting).</p>
</dd>
<dt class="hdlist1">Identity</dt>
<dd>
<p>A token can represent a digital identity (e.g., avatar) or legal identity (e.g., national ID).</p>
</dd>
<dt class="hdlist1">Attestation</dt>
<dd>
<p>A token can represent a certification or attestation of fact by some authority or by a decentralized reputation system (e.g., marriage record, birth certificate, college degree).</p>
</dd>
<dt class="hdlist1">Utility</dt>
<dd>
<p>A token can be used to access or pay for a service.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-38">
<p>Often, a single token encompasses several of these functions. Sometimes it is hard to discern between them, as the physical equivalents have always been inextricably linked. For example, in the physical world, a driver&#8217;s license (attestation) is also an identity document (identity) and the two cannot be separated. In the digital realm, previously commingled functions can be separated and developed independently (e.g., an anonymous attestation).</p>
</div>
</div>
<div class="sect2 data-line-41">
<h3 id="tokens_fungibility">Tokens and Fungibility</h3>
<div class="paragraph data-line-43">
<p><a href="https://en.wikipedia.org/wiki/Fungibility" data-href="https://en.wikipedia.org/wiki/Fungibility">Wikipedia</a> says: "In economics, fungibility is the property of a good or a commodity whose individual units are essentially interchangeable."</p>
</div>
<div class="paragraph data-line-45">
<p>Tokens are fungible when we can substitute any single unit of the token for another without any difference in its value or function.</p>
</div>
<div class="paragraph data-line-47">
<p>Strictly speaking, if a token&#8217;s historical provenance can be tracked, then it is not entirely fungible. The ability to track provenance can lead to blacklisting and whitelisting, reducing or eliminating fungibility.</p>
</div>
<div class="paragraph data-line-49">
<p>Non-fungible tokens are tokens that each represent a unique tangible or intangible item and therefore are not interchangeable. For example, a token that represents ownership of a <em>specific</em> Van Gogh painting is not equivalent to another token that represents a Picasso, even though they might be part of the same "art ownership token" system. Similarly, a token representing a <em>specific</em> digital collectible such as a specific CryptoKitty is not interchangeable with any other CryptoKitty. Each non-fungible token is associated with a unique identifier, such as a serial number.</p>
</div>
<div class="paragraph data-line-51">
<p>We will see examples of both fungible and non-fungible tokens later in this chapter.</p>
</div>
<div class="admonitionblock note data-line-54">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-55">
<p>Note that "fungible" is often used to mean "directly exchangeable for money" (for example, a casino token can be "cashed in," while laundry tokens typically cannot). This is <em>not</em> the sense in which we use the word here.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-59">
<h3 id="counterparty_risk">Counterparty Risk</h3>
<div class="paragraph data-line-61">
<p>Counterparty risk is the risk that the <em>other</em> party in a transaction will fail to meet their obligations. Some types of transactions suffer additional counterparty risk because there are more than two parties involved. For example, if you hold a certificate of deposit for a precious metal and you sell that to someone, there are at least three parties in that transaction: the seller, the buyer, and the custodian of the precious metal. Someone holds the physical asset; by necessity they become party to the fulfillment of the transaction and add counterparty risk to any transaction involving that asset. In general, when an asset is traded indirectly through the exchange of a token of ownership, there is additional counterparty risk from the custodian of the asset. Do they have the asset? Will they recognize (or allow) the transfer of ownership based on the transfer of a token (such as a certificate, deed, title, or digital token)? In the world of digital tokens representing assets, as in the nondigital world, it is important to understand who holds the asset that is represented by the token and what rules apply to that underlying asset.</p>
</div>
</div>
<div class="sect2 data-line-64">
<h3 id="tokens_intrinsicality">Tokens and Intrinsicality</h3>
<div class="paragraph data-line-66">
<p>The word "intrinsic" derives from the Latin "intra," meaning "from within."</p>
</div>
<div class="paragraph data-line-68">
<p>Some tokens represent digital items that are intrinsic to the blockchain. Those digital assets are governed by consensus rules, just like the tokens themselves. This has an important implication: tokens that represent intrinsic assets do not carry additional counterparty risk. If you hold the keys for a CryptoKitty, there is no other party holding that CryptoKitty for you&#x2014;you own it directly. The blockchain consensus rules apply and your ownership (i.e., control) of the private keys is equivalent to ownership of the asset, without any intermediary.</p>
</div>
<div class="paragraph data-line-70">
<p>Conversely, many tokens are used to represent <em>extrinsic</em> things, such as real estate, corporate voting shares, trademarks, and gold bars. The ownership of these items, which are not "within" the blockchain, is governed by law, custom, and policy, separate from the consensus rules that govern the token. In other words, token issuers and owners may still depend on real-world non-smart contracts. As a result, these extrinsic assets carry additional counterparty risk because they are held by custodians, recorded in external registries, or controlled by laws and policies outside the blockchain environment.</p>
</div>
<div class="paragraph data-line-72">
<p>One of the most important ramifications of blockchain-based tokens is the ability to convert extrinsic assets into intrinsic assets and thereby remove counterparty risk. A good example is moving from equity in a corporation (extrinsic) to an equity or voting token in a <em>DAO</em> or similar (intrinsic) organization.</p>
</div>
</div>
<div class="sect2 data-line-75">
<h3 id="using_tokens">Using Tokens: Utility or Equity</h3>
<div class="paragraph data-line-77">
<p>Almost all projects in Ethereum today launch with some kind of token. But do all these projects really need tokens? Are there any disadvantages to using a token, or will we see the slogan "tokenize all the things" come to fruition? In principle, the use of tokens can be seen as the ultimate management or organization tool. In practice, the integration of blockchain platforms, including Ethereum, into the existing structures of society means that, so far, there are many limitations to their applicability.</p>
</div>
<div class="paragraph data-line-79">
<p>Let&#8217;s start by clarifying the role of a token in a new project. The majority of projects are using tokens in one of two ways: either as "utility tokens" or as "equity tokens." Very often, those two roles are conflated.</p>
</div>
<div class="paragraph data-line-81">
<p>Utility tokens are those where the use of the token is required to gain access to a service, application, or resource. Examples of utility tokens include tokens that represent resources such as shared storage, or access to services such as social media networks.</p>
</div>
<div class="paragraph data-line-83">
<p>Equity tokens are those that represent shares in the control or ownership of something, such as a startup. Equity tokens can be as limited as nonvoting shares for distribution of dividends and profits, or as expansive as voting shares in a decentralized autonomous organization, where management of the platform is through some complex governance system based on votes by the token holders.</p>
</div>
<div class="sect3 data-line-86">
<h4 id="its_not_duck">It&#8217;s a Duck!</h4>
<div class="paragraph data-line-88">
<p>Many startups face a difficult problem: tokens are a great fundraising mechanism, but offering securities (equity) to the public is a regulated activity in most jurisdictions. By disguising equity tokens as utility tokens, many startups hope to get around these regulatory restrictions and raise money from a public offering while presenting it as a pre-sale of "service access vouchers" or, as we call them, utility tokens. Whether these thinly disguised equity offerings will be able to skirt the regulators remains to be seen.</p>
</div>
<div class="paragraph data-line-90">
<p>As the popular saying goes: "If it walks like a duck and quacks like a duck, it&#8217;s a duck." Regulators are not likely to be distracted by these semantic contortions; quite the opposite, they are more likely to see such legal sophistry as an attempt to deceive the public.</p>
</div>
</div>
<div class="sect3 data-line-93">
<h4 id="who_needs_utility_tokens">Utility Tokens: Who Needs Them?</h4>
<div class="paragraph data-line-95">
<p>The real problem is that utility tokens introduce significant risks and adoption barriers for startups. Perhaps in a distant future "tokenize all the things" will become reality, but at present the set of people who have an understanding of and desire to use a token is a subset of the already small cryptocurrency market.</p>
</div>
<div class="paragraph data-line-97">
<p>For a startup, each innovation represents a risk and a market filter. Innovation is taking the road least traveled, walking away from the path of tradition. It is already a lonely walk. If a startup is trying to innovate in a new area of technology, such as storage sharing over P2P networks, that is a lonely enough path. Adding a utility token to that innovation and requiring users to adopt tokens in order to use the service compounds the risk and increases the barriers to adoption. It&#8217;s walking off the already lonely trail of P2P storage innovation and into the wilderness.</p>
</div>
<div class="paragraph data-line-99">
<p>Think of each innovation as a filter. It limits adoption to the subset of the market that can become early adopters of this innovation. Adding a second filter compounds that effect, further limiting the addressable market. You are asking your early adopters to adopt not one but two completely new technologies: the novel application/platform/service you built, and the token economy.</p>
</div>
<div class="paragraph data-line-101">
<p>For a startup, each innovation introduces risks that increase the chance of failure of the startup. If you take your already risky startup idea and add a utility token, you are adding all the risks of the underlying platform (Ethereum), broader economy (exchanges, liquidity), regulatory environment (equity/commodity regulators), and technology (smart contracts, token standards). That&#8217;s a lot of risk for a startup.</p>
</div>
<div class="paragraph data-line-103">
<p>Advocates of "tokenize all the things" will likely counter that by adopting tokens they are also inheriting the market enthusiasm, early adopters, technology, innovation, and liquidity of the entire token economy. That is true too. The question is whether the benefits and enthusiasm outweigh the risks and uncertainties.</p>
</div>
<div class="paragraph data-line-105">
<p>Nevertheless, some of the most innovative business ideas are indeed taking place in the crypto realm. If regulators are not quick enough to adopt laws and support new business models, entrepreneurs and associated talent will seek to operate in other jurisdictions that are more crypto-friendly. This is already happening.</p>
</div>
<div class="paragraph data-line-107">
<p>Finally, at the beginning of this chapter, when introducing tokens, we discussed the colloquial meaning of "token" as "something of insignificant value." The underlying reason for the insignificant value of most tokens is because they can only be used in a very narrow context: one bus company, one laundromat, one arcade, one hotel, or one company store. Limited liquidity, limited applicability, and high conversion costs reduce the value of tokens until they are only of "token" value. So when you add a utility token to your platform, but the token can only be used on your single platform with a small market, you are recreating the conditions that made physical tokens worthless. This may indeed be the correct way to incorporate tokenization into your project. However, if in order to use your platform a user has to convert something into your utility token, use it, and then convert the remainder back into something more generally useful, you&#8217;ve created a company scrip. The switching costs of a digital token are orders of magnitude lower than for a physical token without a market, but they are not zero. Utility tokens that work across an entire industry sector will be very interesting and probably quite valuable. But if you set up your startup to have to bootstrap an entire industry standard in order to succeed, you may have already failed.</p>
</div>
<div class="admonitionblock note data-line-110">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-111">
<p>One of the benefits of deploying services on general-purpose platforms like Ethereum is being able to connect smart contracts (and therefore the utility of tokens) across projects, increasing the potential for liquidity and utility of tokens.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-114">
<p>Make this decision for the right reasons. Adopt a token because your application <em>cannot work without a token</em>. Adopt it because the token lifts a fundamental market barrier or solves an access problem. Don&#8217;t introduce a utility token because it is the only way you can raise money fast and you need to pretend it&#8217;s not a public securities offering.</p>
</div>
</div>
</div>
<div class="sect2 data-line-117">
<h3 id="token_std">Tokens on Ethereum</h3>
<div class="paragraph data-line-119">
<p>Blockchain tokens existed before Ethereum. In some ways, the first blockchain currency, Bitcoin, is a token itself. Many token platforms were also developed on Bitcoin and other cryptocurrencies before Ethereum. However, the introduction of the first token standard on Ethereum led to an explosion of tokens.</p>
</div>
<div class="paragraph data-line-121">
<p>Vitalik Buterin suggested tokens as one of the most obvious and useful applications of a generalized programmable blockchain such as Ethereum. In fact, in the first year of Ethereum, it was common to see Vitalik and others wearing T-shirts emblazoned with the Ethereum logo and a smart contract sample on the back. There were several variations of this T-shirt, but the most common showed an implementation of a token.</p>
</div>
<div class="paragraph data-line-123">
<p>Before we delve into the details of creating tokens on Ethereum, it is important to have an overview of how tokens work on Ethereum. Tokens are different from ether because the Ethereum protocol does not know anything about them. Sending ether is an intrinsic action of the Ethereum platform, but sending or even owning tokens is not. The ether balance of Ethereum accounts is handled at the protocol level, whereas the token balance of Ethereum accounts is handled at the smart contract level. In order to create a new token on Ethereum, you must create a new smart contract. Once deployed, the smart contract handles everything, including ownership, transfers, and access rights. You can write your smart contract to perform all the necessary actions any way you want, but it is probably wisest to follow an existing standard. We will look at such standards next. We discuss the pros and cons of the following standards at the end of the chapter.</p>
</div>
<div class="sect3 data-line-127">
<h4 id="ERC20_std">The ERC20 Token Standard</h4>
<div class="paragraph data-line-129">
<p>The first standard was introduced in November 2015 by Fabian Vogelsteller as an Ethereum Request for Comments (ERC). It was automatically assigned GitHub issue number 20, giving rise to the name "ERC20 token." The vast majority of tokens are currently based on the ERC20 standard. The ERC20 request for comments eventually became Ethereum Improvement Proposal 20 (EIP-20), but it is mostly still referred to by the original name, ERC20.</p>
</div>
<div class="paragraph data-line-131">
<p>ERC20 is a standard for <em>fungible tokens</em>, meaning that different units of an ERC20 token are interchangeable and have no unique properties.</p>
</div>
<div class="paragraph data-line-133">
<p><a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">The ERC20 standard</a> defines a common interface for contracts implementing a token, such that any compatible token can be accessed and used in the same way. The interface consists of a number of functions that must be present in every implementation of the standard, as well as some optional functions and attributes that may be added by developers.</p>
</div>
<div class="sect4 data-line-136">
<h5 id="ERC20_reqd_func">ERC20 required functions and events</h5>
<div class="paragraph data-line-138">
<p>An ERC20-compliant token contract must provide at least the following functions and events:</p>
</div>
<div class="dlist data-line-140">
<dl>
<dt class="hdlist1">totalSupply</dt>
<dd>
<p>Returns the total units of this token that currently exist. ERC20 tokens can have a fixed or a variable supply.</p>
</dd>
<dt class="hdlist1">balanceOf</dt>
<dd>
<p>Given an address, returns the token balance of that address.</p>
</dd>
<dt class="hdlist1">transfer</dt>
<dd>
<p>Given an address and amount, transfers that amount of tokens to that address, from the balance of the address that executed the transfer.</p>
</dd>
<dt class="hdlist1">transferFrom</dt>
<dd>
<p>Given a sender, recipient, and amount, transfers tokens from one account to another. Used in combination with approve.</p>
</dd>
<dt class="hdlist1">approve</dt>
<dd>
<p>Given a recipient address and amount, authorizes that address to execute several transfers up to that amount, from the account that issued the approval.</p>
</dd>
<dt class="hdlist1">allowance</dt>
<dd>
<p>Given an owner address and a spender address, returns the remaining amount that the spender is approved to withdraw from the owner.</p>
</dd>
<dt class="hdlist1">Transfer</dt>
<dd>
<p>Event triggered upon a successful transfer (call to transfer or transferFrom) (even for zero-value transfers).</p>
</dd>
<dt class="hdlist1">Approval</dt>
<dd>
<p>Event logged upon a successful call to approve.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-157">
<h5 id="ERC20_optional_func">ERC20 optional functions</h5>
<div class="paragraph data-line-159">
<p>In addition to the required functions listed in the previous section, the following optional functions are also defined by the standard:</p>
</div>
<div class="dlist data-line-161">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>Returns the human-readable name (e.g., "US Dollars") of the token.</p>
</dd>
<dt class="hdlist1">symbol</dt>
<dd>
<p>Returns a human-readable symbol (e.g., "USD") for the token.</p>
</dd>
<dt class="hdlist1">decimals</dt>
<dd>
<p>Returns the number of decimals used to divide token amounts. For example, if decimals is 2, then the token amount is divided by 100 to get its user <span class="keep-together">representation</span>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-168">
<h5 id="ERC20_interface">The ERC20 interface defined in Solidity</h5>
<div class="paragraph data-line-170">
<p>Here&#8217;s what an ERC20 interface specification looks like in Solidity:</p>
</div>
<div id="ERC20_interface_example" class="listingblock data-line-174">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract ERC20 {
   function totalSupply() constant returns (uint theTotalSupply);
   function balanceOf(address _owner) constant returns (uint balance);
   function transfer(address _to, uint _value) returns (bool success);
   function transferFrom(address _from, address _to, uint _value) returns
      (bool success);
   function approve(address _spender, uint _value) returns (bool success);
   function allowance(address _owner, address _spender) constant returns
      (uint remaining);
   event Transfer(address indexed _from, address indexed _to, uint _value);
   event Approval(address indexed _owner, address indexed _spender, uint _value);
}</code></pre>
</div>
</div>
</div>
<div class="sect4 data-line-190">
<h5 id="ERC20_data_struct">ERC20 data structures</h5>
<div class="paragraph data-line-192">
<p>If you examine any ERC20 implementation you will see that it contains two data structures, one to track balances and one to track allowances. In Solidity, they are implemented with a <em>data mapping</em>.</p>
</div>
<div class="paragraph data-line-194">
<p>The first data mapping implements an internal table of token balances, by owner. This allows the token contract to keep track of who owns the tokens. Each transfer is a deduction from one balance and an addition to another balance:</p>
</div>
<div id="balance_mapping" class="listingblock data-line-198">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">mapping(address =&gt; uint256) balances;</code></pre>
</div>
</div>
<div class="paragraph data-line-202">
<p>The second data structure is a data mapping of allowances. As we will see in the next section, with ERC20 tokens an owner of a token can delegate authority to a spender, allowing them to spend a specific amount (allowance) from the owner&#8217;s balance. The ERC20 contract keeps track of the allowances with a two-dimensional mapping, with the primary key being the address of the token owner, mapping to a spender address and an allowance amount:</p>
</div>
<div id="allowance_mapping" class="listingblock data-line-206">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">mapping (address =&gt; mapping (address =&gt; uint256)) public allowed;</code></pre>
</div>
</div>
</div>
<div class="sect4 data-line-212">
<h5 id="transfer_workflows">ERC20 workflows: "transfer" and "approve &amp; transferFrom"</h5>
<div class="paragraph data-line-214">
<p>The ERC20 token standard has two transfer functions. You might be wondering why.</p>
</div>
<div class="paragraph data-line-216">
<p>ERC20 allows for two different workflows. The first is a single-transaction, straightforward workflow using the transfer function. This workflow is the one used by wallets to send tokens to other wallets. The vast majority of token transactions happen with the transfer workflow.</p>
</div>
<div class="paragraph data-line-218">
<p>Executing the transfer contract is very simple. If Alice wants to send 10 tokens to Bob, her wallet sends a transaction to the token contract&#8217;s address, calling the <span class="keep-together"><code>transfer</code></span> function with Bob&#8217;s address and 10 as the arguments. The token contract adjusts Alice&#8217;s balance (&#x2013;10) and Bob&#8217;s balance (+10) and issues a Transfer event.</p>
</div>
<div class="paragraph data-line-220">
<p>The second workflow is a two-transaction workflow that uses approve followed by transferFrom. This workflow allows a token owner to delegate their control to another address. It is most often used to delegate control to a contract for distribution of tokens, but it can also be used by exchanges.</p>
</div>
<div class="paragraph data-line-222">
<p>For example, if a company is selling tokens for an ICO, they can approve a crowdsale contract address to distribute a certain amount of tokens. The crowdsale contract can then transferFrom the token contract owner&#8217;s balance to each buyer of the token, as illustrated in <a href="#approve_transferFrom_workflow">The two-step approve &amp; transferFrom workflow of ERC20 tokens</a>.</p>
</div>
<div class="admonitionblock note data-line-225">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-226">
<p>An <em>Initial Coin Offering</em> (ICO) is a crowdfunding mechanism used by companies and organizations to raise money by selling tokens. The term is derived from Initial Public Offering (IPO), which is the process by which a public company offers shares for sale to investors on a stock exchange. Unlike the highly regulated IPO markets, ICOs are open, global, and messy. The examples and explanations of ICOs in this book are not an endorsement of this type of fundraising.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="approve_transferFrom_workflow" class="imageblock data-line-231">
<div class="content">
<img src="images/approve_transferFrom_workflow.png" alt="The two-step approve &amp; transferFrom workflow of ERC20 tokens">
</div>
<div class="title">Figure 1. The two-step approve &amp; transferFrom workflow of ERC20 tokens</div>
</div>
<div class="paragraph data-line-233">
<p>For the approve &amp; transferFrom workflow, two transactions are needed. Let&#8217;s say that Alice wants to allow the AliceICO contract to sell 50% of all the AliceCoin tokens to buyers like Bob and Charlie. First, Alice launches the AliceCoin ERC20 contract, issuing all the AliceCoin to her own address. Then, Alice launches the AliceICO contract that can sell tokens for ether. Next, Alice initiates the approve &amp; transferFrom workflow. She sends a transaction to the AliceCoin contract, calling approve with the address of the AliceICO contract and 50% of the totalSupply as arguments. This will trigger the Approval event. Now, the AliceICO contract can sell AliceCoin.</p>
</div>
<div class="paragraph data-line-235">
<p>When the AliceICO contract receives ether from Bob, it needs to send some AliceCoin to Bob in return. Within the AliceICO contract is an exchange rate between AliceCoin and ether. The exchange rate that Alice set when she created the AliceICO contract determines how many tokens Bob will receive for the amount of ether sent to the AliceICO contract. When the AliceICO contract calls the AliceCoin transferFrom function, it sets Alice&#8217;s address as the sender and Bob&#8217;s address as the recipient, and uses the exchange rate to determine how many AliceCoin tokens will be transferred to Bob in the value field. The AliceCoin contract transfers the balance from Alice&#8217;s address to Bob&#8217;s address and triggers a Transfer event. The AliceICO contract can call transferFrom an unlimited number of times, as long as it doesn&#8217;t exceed the approval limit Alice set. The AliceICO contract can keep track of how many AliceCoin tokens it can sell by calling the allowance function.</p>
</div>
</div>
<div class="sect4 data-line-238">
<h5 id="ERC20_implementation">ERC20 implementations</h5>
<div class="paragraph data-line-240">
<p>While it is possible to implement an ERC20-compatible token in about 30 lines of Solidity code, most implementations are more complex. This is to account for potential security vulnerabilities. There are two implementations mentioned in the EIP-20 standard:</p>
</div>
<div class="dlist data-line-242">
<dl>
<dt class="hdlist1"><a href="http://bit.ly/2EUYCMR" data-href="http://bit.ly/2EUYCMR">Consensys EIP20</a></dt>
<dd>
<p>A simple and easy-to-read implementation of an ERC20-compatible token.</p>
</dd>
<dt class="hdlist1"><a href="https://bit.ly/2xPYck6" data-href="https://bit.ly/2xPYck6">OpenZeppelin StandardToken</a></dt>
<dd>
<p>This implementation is ERC20-compatible, with additional security precautions. It forms the basis of OpenZeppelin libraries implementing more complex ERC20-compatible tokens with fundraising caps, auctions, vesting schedules, and other features.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-247">
<h4 id="METoken_example">Launching Our Own ERC20 Token</h4>
<div class="paragraph data-line-249">
<p>Let&#8217;s create and launch our own token. For this example, we will use the Truffle framework. The example assumes you have already installed truffle and configured it, and are familiar with its basic operation (for details, see <a href="#truffle">[truffle]</a>).</p>
</div>
<div class="paragraph data-line-251">
<p>We will call our token "Mastering Ethereum Token,&#x201d; with the symbol "MET."</p>
</div>
<div class="admonitionblock note data-line-254">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-255">
<p>You can find this example <a href="https://github.com/ethereumbook/ethereumbook/blob/develop/code/truffle/METoken" data-href="https://github.com/ethereumbook/ethereumbook/blob/develop/code/truffle/METoken">in the book&#8217;s GitHub repository</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-258">
<p>First, let&#8217;s create and initialize a Truffle project directory. Run these four commands and accept the default answers to any questions:</p>
</div>
<pre data-type="programlist">
$ <strong>mkdir METoken</strong>
$ <strong>cd METoken</strong>
METoken $ <strong>truffle init</strong>
METoken $ <strong>npm init</strong>
</pre>
<div class="paragraph data-line-269">
<p>You should now have the following directory structure:</p>
</div>
<div id="truffle_directory" class="listingblock data-line-272">
<div class="content">
<pre>METoken/
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- package.json
+---- test
+---- truffle-config.js
`---- truffle.js</pre>
</div>
</div>
<div class="paragraph data-line-284">
<p>Edit the <em>truffle.js</em> or <em>truffle-config.js</em> configuration file to set up your Truffle environment, or copy the latter from <a href="http://bit.ly/2DdP2mz" data-href="http://bit.ly/2DdP2mz">the repository</a>.</p>
</div>
<div class="paragraph data-line-286">
<p>If you use the example <em>truffle-config.js</em>, remember to create a file <em>.env</em> in the <em>METoken</em> folder containing your test private keys for testing and deployment on public Ethereum test networks, such as Ropsten or Kovan. You can export your test network private key from MetaMask.</p>
</div>
<div class="paragraph data-line-288">
<p>After that your directory should look like:</p>
</div>
<div id="truffle_directory_metoken" class="listingblock data-line-291">
<div class="content">
<pre>METoken/
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- package.json
+---- test
+---- truffle-config.js
+---- truffle.js
`---- .env *new file*</pre>
</div>
</div>
<div class="admonitionblock warning data-line-305">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-306">
<p>Only use test keys or test mnemonics that are <em>not</em> used to hold funds on the main Ethereum network. <em>Never</em> use keys that hold real money for testing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-309">
<p>For our example, we will import the OpenZeppelin library, which implements some important security checks and is easy to extend:</p>
</div>
<pre data-type="programlist">
$ <strong>npm install openzeppelin-solidity@1.12.0</strong>

+ openzeppelin-solidity@1.12.0
added 1 package from 1 contributor and audited 2381 packages in 4.074s
</pre>
<div class="paragraph data-line-320">
<p>The openzeppelin-solidity package will add about 250 files under the <em>node_modules</em> directory. The OpenZeppelin library includes a lot more than the ERC20 token, but we will only use a small part of it.</p>
</div>
<div class="paragraph data-line-322">
<p>Next, let&#8217;s write our token contract. Create a new file, <em>METoken.sol</em>, and copy the example code from <a href="http://bit.ly/2qfIFH0" data-href="http://bit.ly/2qfIFH0">GitHub</a>.</p>
</div>
<div class="paragraph data-line-324">
<p>Our contract, shown in <a href="#solidity_token_example">METoken.sol: A Solidity contract implementing an ERC20 token</a>, is very simple, as it inherits all its functionality from the OpenZeppelin library.</p>
</div>
<div id="solidity_token_example" class="exampleblock data-line-328">
<div class="title">Example 1. METoken.sol: A Solidity contract implementing an ERC20 token</div>
<div class="content">
<div class="listingblock data-line-330">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.21;

import 'openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol';

contract METoken is StandardToken {
    string public constant name = 'Mastering Ethereum Token';
    string public constant symbol = 'MET';
    uint8 public constant decimals = 2;
    uint constant _initial_supply = 2100000000;

    function METoken() public {
        totalSupply_ = _initial_supply;
        balances[msg.sender] = _initial_supply;
        emit Transfer(address(0), msg.sender, _initial_supply);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-335">
<p>Here, we are defining the optional variables name, symbol, and decimals. We also define an _initial_supply variable, set to 21 million tokens; with two decimals of subdivision that gives 2.1 billion total units. In the contract&#8217;s initialization (constructor) function we set the totalSupply to be equal to _initial_supply and allocate all of the _initial_supply to the balance of the account (msg.sender) that creates the METoken contract.</p>
</div>
<div class="paragraph data-line-337">
<p>We now use truffle to compile the METoken code:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle compile</strong>
Compiling ./contracts/METoken.sol...
Compiling ./contracts/Migrations.sol...
Compiling openzeppelin-solidity/contracts/math/SafeMath.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/BasicToken.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/ERC20.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/ERC20Basic.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol...
</pre>
<div class="paragraph data-line-352">
<p>As you can see, truffle incorporates necessary dependencies from the OpenZeppelin libraries and compiles those contracts too.</p>
</div>
<div class="paragraph data-line-354">
<p>Let&#8217;s set up a migration script to deploy the METoken contract. Create a new file called <em>2_deploy_contracts.js</em>, in the <em>METoken/migrations</em> folder. Copy the contents from the example <a href="http://bit.ly/2P0rHLl" data-href="http://bit.ly/2P0rHLl">in the GitHub repository</a>:</p>
</div>
<div id="METoken_migration" class="listingblock data-line-0">
<div class="title">2_deploy_contracts: Migration to deploy METoken</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var METoken = artifacts.require("METoken");

module.exports = function(deployer) {
  // Deploy the METoken contract as our only task
  deployer.deploy(METoken);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-364">
<p>Before we deploy on one of the Ethereum test networks, let&#8217;s start a local blockchain to test everything. Start the ganache blockchain, either from the command line with ganache-cli or from the graphical user interface.</p>
</div>
<div class="paragraph data-line-366">
<p>Once ganache is started, we can deploy our METoken contract and see if everything works as expected:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle migrate --network ganache</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb2e90a056dc6ad8e654683921fc613c796a03b89df6760ec1db1084ea4a084eb
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying METoken...
  ... 0xbe9290d59678b412e60ed6aefedb17364f4ad2977cfb2076b9b8ad415c5dc9f0
  METoken: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...
</pre>
<div class="paragraph data-line-390">
<p>On the ganache console, we should see that our deployment has created four new transactions, as depicted in <a href="#ganache_METoken">METoken deployment on ganache</a>.</p>
</div>
<div id="ganache_METoken" class="imageblock data-line-394">
<div class="content">
<img src="images/ganache_metoken.png" alt="METoken deployment on Ganache">
</div>
<div class="title">Figure 2. METoken deployment on ganache</div>
</div>
<div class="sect4 data-line-397">
<h5 id="truffle_console">Interacting with METoken using the Truffle console</h5>
<div class="paragraph data-line-399">
<p>We can interact with our contract on the ganache blockchain using the Truffle console. This is an interactive JavaScript environment that provides access to the Truffle environment and, via web3, to the blockchain. In this case, we will connect the Truffle console to the ganache blockchain:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt;
</pre>
<div class="paragraph data-line-408">
<p>The truffle(ganache)&gt; prompt shows that we are connected to the ganache blockchain and are ready to type our commands. The Truffle console supports all the truffle commands, so we could compile and migrate from the console. We&#8217;ve already run those commands, so let&#8217;s go directly to the contract itself. The METoken contract exists as a JavaScript object within the Truffle environment. Type **METoken** at the prompt and it will dump the entire contract definition:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken</strong>
{ [Function: TruffleContract]
  _static_methods:

[...]

currentProvider:
 HttpProvider {
   host: 'http://localhost:7545',
   timeout: 0,
   user: undefined,
   password: undefined,
   headers: undefined,
   send: [Function],
   sendAsync: [Function],
   _alreadyWrapped: true },
network_id: '5777' }
</pre>
<div class="paragraph data-line-432">
<p>The METoken object also exposes several attributes, such as the address of the contract (as deployed by the migrate command):</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.address</strong>
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'
</pre>
<div class="paragraph data-line-441">
<p>If we want to interact with the deployed contract, we have to use an asynchronous call, in the form of a JavaScript "promise." We use the deployed function to get the contract instance and then call the totalSupply function:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance => instance.totalSupply())</strong>
BigNumber { s: 1, e: 9, c: [ 2100000000 ] }
</pre>
<div class="paragraph data-line-450">
<p>Next, let&#8217;s use the accounts created by ganache to check our METoken balance and send some METoken to another address. First, let&#8217;s get the account addresses:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>let accounts</strong>
undefined
truffle(ganache)&gt; <strong>web3.eth.getAccounts((err,res) => { accounts = res })</strong>
undefined
truffle(ganache)&gt; <strong>accounts[0]</strong>
'0x627306090abab3a6e1400e9345bc60c78a8bef57'
</pre>
<div class="paragraph data-line-463">
<p>The accounts list now contains all the accounts created by ganache, and account[0] is the account that deployed the METoken contract. It should have a balance of <span class="keep-together">METoken</span>, because our METoken constructor gives the entire token supply to the address that created it. Let&#8217;s check:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =></strong>
                  <strong>{ instance.balanceOf(accounts[0]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 9, c: [ 2100000000 ] }</strong>
</pre>
<div class="paragraph data-line-474">
<p>Finally, let&#8217;s transfer 1000.00 METoken from account[0] to account[1], by calling the contract&#8217;s transfer function:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.transfer(accounts[1], 100000) })</strong>
undefined
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(accounts[0]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 9, c: [ 2099900000 ] }</strong>
undefined
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(accounts[1]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 5, c: [ 100000 ] }</strong>
</pre>
<div class="admonitionblock tip data-line-494">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-495">
<p>METoken has 2 decimals of precision, meaning that 1 METoken is 100 units in the contract. When we transfer 1,000 METoken, we specify the value as 100000 in the call to the transfer function.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-498">
<p>As you can see, in the console, account[0] now has 20,999,000 MET, and account[1] has 1,000 MET.</p>
</div>
<div class="paragraph data-line-500">
<p>If you switch to the ganache graphical user interface, as shown in <a href="#ganache_METoken_transfer">METoken transfer on ganache</a>, you will see the transaction that called the transfer function.</p>
</div>
<div id="ganache_METoken_transfer" class="imageblock data-line-504">
<div class="content">
<img src="images/ganache_metoken_transfer.png" alt="METoken transfer on Ganache">
</div>
<div class="title">Figure 3. METoken transfer on ganache</div>
</div>
</div>
<div class="sect4 data-line-507">
<h5 id="sending_erc20_tokens_contracts">Sending ERC20 tokens to contract addresses</h5>
<div class="paragraph data-line-509">
<p>So far, we&#8217;ve set up an ERC20 token and transferred some tokens from one account to another. All the accounts we used for these demonstrations are externally owned accounts, meaning they are controlled by a private key, not a contract. What happens if we send MET to a contract address? Let&#8217;s find out!</p>
</div>
<div class="paragraph data-line-511">
<p>First, let&#8217;s deploy another contract into our test environment. For this example, we will use our first contract, <em>Faucet.sol</em>. Let&#8217;s add it to the METoken project by copying it to the <em>contracts</em> directory. Our directory should look like this:</p>
</div>
<div id="METoken_directory" class="listingblock data-line-514">
<div class="content">
<pre>METoken/
+---- contracts
|   +---- Faucet.sol
|   +---- METoken.sol
|   `---- Migrations.sol</pre>
</div>
</div>
<div class="paragraph data-line-522">
<p>We&#8217;ll also add a migration, to deploy Faucet separately from METoken:</p>
</div>
<div id="faucet_migration" class="listingblock data-line-526">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var Faucet = artifacts.require("Faucet");

module.exports = function(deployer) {
  // Deploy the Faucet contract as our only task
  deployer.deploy(Faucet);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-535">
<p>Let&#8217;s compile and migrate the contracts from the Truffle console:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt; <strong>compile</strong>
Compiling ./contracts/Faucet.sol...
Writing artifacts to ./build/contracts

truffle(ganache)&gt; <strong>migrate</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x89f6a7bd2a596829c60a483ec99665c7af71e68c77a417fab503c394fcd7a0c9
  Migrations: 0xa1ccce36fb823810e729dce293b75f40fb6ea9c9
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing METoken...
  ... 0x28d0da26f48765f67e133e99dd275fac6a25fdfec6594060fd1a0e09a99b44ba
  METoken: 0x7d6bf9d5914d37bcba9d46df7107e71c59f3791f
Saving artifacts...
Running migration: 3_deploy_faucet.js
  Deploying Faucet...
  ... 0x6fbf283bcc97d7c52d92fd91f6ac02d565f5fded483a6a0f824f66edc6fa90c3
  Faucet: 0xb18a42e9468f7f1342fa3c329ec339f254bc7524
Saving artifacts...
</pre>
<div class="paragraph data-line-565">
<p>Great. Now let&#8217;s send some MET to the Faucet contract:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.transfer(Faucet.address, 100000) })</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(Faucet.address).then(console.log)})</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 5, c: [ 100000 ] }</strong>
</pre>
<div class="paragraph data-line-577">
<p>Alright, we have transferred 1,000 MET to the Faucet contract. Now, how do we withdraw those tokens?</p>
</div>
<div class="paragraph data-line-579">
<p>Remember, <em>Faucet.sol</em> is a pretty simple contract. It only has one function, <span class="keep-together"><code>withdraw</code></span>, which is for withdrawing <em>ether</em>. It doesn&#8217;t have a function for withdrawing MET, or any other ERC20 token. If we use withdraw it will try to send ether, but since Faucet doesn&#8217;t have a balance of ether yet, it will fail.</p>
</div>
<div class="paragraph data-line-581">
<p>The METoken contract knows that Faucet has a balance, but the only way that it can transfer that balance is if it receives a transfer call from the address of the contract. Somehow we need to make the Faucet contract call the transfer function in <span class="keep-together"><code>METoken</code></span>.</p>
</div>
<div class="paragraph data-line-583">
<p>If you&#8217;re wondering what to do next, don&#8217;t. There is no solution to this problem. The MET sent to Faucet is stuck, forever. Only the Faucet contract can transfer it, and the Faucet contract doesn&#8217;t have code to call the transfer function of an ERC20 token contract.</p>
</div>
<div class="paragraph data-line-585">
<p>Perhaps you anticipated this problem. Most likely, you didn&#8217;t. In fact, neither did hundreds of Ethereum users who accidentally transferred various tokens to contracts that didn&#8217;t have any ERC20 capability. According to some estimates, tokens worth more than roughly $2.5 million USD (at the time of writing) have gotten "stuck" like this and are lost forever.</p>
</div>
<div class="paragraph data-line-587">
<p>One of the ways that users of ERC20 tokens can inadvertently lose their tokens in a transfer, is when they attempt to transfer to an exchange or another service. They copy an Ethereum address from the website of an exchange, thinking they can simply send tokens to it. However, many exchanges publish receiving addresses that are actually contracts! These contracts are only meant to receive ether, not ERC20 tokens, most often sweeping all funds sent to them to "cold storage" or another centralized wallet. Despite the many warnings saying "do not send tokens to this address," lots of tokens are lost this way.</p>
</div>
</div>
<div class="sect4 data-line-590">
<h5 id="transfer_workflow_demo">Demonstrating the &#x201c;approve &amp; transferFrom&#x201d; workflow</h5>
<div class="paragraph data-line-592">
<p>Our Faucet contract couldn&#8217;t handle ERC20 tokens. Sending tokens to it using the transfer function resulted in the loss of those tokens. Let&#8217;s rewrite the contract now and make it handle ERC20 tokens. Specifically, we will turn it into a faucet that gives out MET to anyone who asks.</p>
</div>
<div class="paragraph data-line-594">
<p>For this example, we&#8217;ll make a copy of the <em>truffle</em> project directory (we&#8217;ll call it <em>METoken_METFaucet</em>), initialize truffle and npm, install the OpenZeppelin dependencies, and copy the <em>METoken.sol</em> contract. See our first example, in <a href="#METoken_example">Launching Our Own ERC20 Token</a>, for the detailed instructions.</p>
</div>
<div class="paragraph data-line-596">
<p>Our new faucet contract, <em>METFaucet.sol</em>, will look like <a href="#METFaucet">METFaucet.sol: A faucet for METoken</a>.</p>
</div>
<div id="METFaucet" class="exampleblock data-line-600">
<div class="title">Example 2. METFaucet.sol: A faucet for METoken</div>
<div class="content">
<div class="listingblock data-line-602">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version of Solidity compiler this program was written for
pragma solidity ^0.4.19;

import 'openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol';


// A faucet for ERC20 token MET
contract METFaucet {

	StandardToken public METoken;
	address public METOwner;

	// METFaucet constructor, provide the address of METoken contract and
	// the owner address we will be approved to transferFrom
	function METFaucet(address _METoken, address _METOwner) public {

		// Initialize the METoken from the address provided
		METoken = StandardToken(_METoken);
		METOwner = _METOwner;
	}

	function withdraw(uint withdraw_amount) public {

    	// Limit withdrawal amount to 10 MET
    	require(withdraw_amount &lt;= 1000);

		// Use the transferFrom function of METoken
		METoken.transferFrom(METOwner, msg.sender, withdraw_amount);
    }

	// REJECT any incoming ether
	function () external payable { revert(); }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-607">
<p>We&#8217;ve made quite a few changes to the basic Faucet example. Since METFaucet will use the transferFrom function in METoken, it will need two additional variables. One will hold the address of the deployed METoken contract. The other will hold the address of the owner of the MET, who will approve the faucet withdrawals. The METFaucet contract will call METoken.transferFrom and instruct it to move MET from the owner to the address where the faucet withdrawal request came from.</p>
</div>
<div class="paragraph data-line-610">
<p>We declare these two variables here:</p>
</div>
<div class="listingblock data-line-613">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">StandardToken public METoken;
address public METOwner;</code></pre>
</div>
</div>
<div class="paragraph data-line-618">
<p>Since our faucet needs to be initialized with the correct addresses for METoken and METOwner, we need to declare a custom constructor:</p>
</div>
<div id="custom_constructor" class="listingblock data-line-622">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// METFaucet constructor - provide the address of the METoken contract and
// the owner address we will be approved to transferFrom
function METFaucet(address _METoken, address _METOwner) public {

	// Initialize the METoken from the address provided
	METoken = StandardToken(_METoken);
	METOwner = _METOwner;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-633">
<p>The next change is to the withdraw function. Instead of calling transfer, METFaucet uses the transferFrom function in METoken and asks METoken to transfer MET to the faucet recipient:</p>
</div>
<div id="transfer_met" class="listingblock data-line-637">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Use the transferFrom function of METoken
METoken.transferFrom(METOwner, msg.sender, withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-642">
<p>Finally, since our faucet no longer sends ether, we should probably prevent anyone from sending ether to METFaucet, as we wouldn&#8217;t want it to get stuck. We change the fallback payable function to reject incoming ether, using the revert function to revert any incoming payments:</p>
</div>
<div id="reject_incoming_eth" class="listingblock data-line-646">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// REJECT any incoming ether
function () external payable { revert(); }</code></pre>
</div>
</div>
<div class="paragraph data-line-651">
<p>Now that our <em>METFaucet.sol</em> code is ready, we need to modify the migration script to deploy it. This migration script will be a bit more complex, as METFaucet depends on the address of METoken. We will use a JavaScript promise to deploy the two contracts in sequence. Create <em>2_deploy_contracts.js</em> as follows:</p>
</div>
<div class="listingblock data-line-654">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var METoken = artifacts.require("METoken");
var METFaucet = artifacts.require("METFaucet");
var owner = web3.eth.accounts[0];

module.exports = function(deployer) {

	// Deploy the METoken contract first
	deployer.deploy(METoken, {from: owner}).then(function() {
		// Then deploy METFaucet and pass the address of METoken and the
		// address of the owner of all the MET who will approve METFaucet
		return deployer.deploy(METFaucet, METoken.address, owner);
  	});
}</code></pre>
</div>
</div>
<div class="paragraph data-line-670">
<p>Now, we can test everything in the Truffle console. First, we use migrate to deploy the contracts. When METoken is deployed it will allocate all the MET to the account that created it, web3.eth.accounts[0]. Then, we call the approve function in <code><span class="keep-together">METoken</span></code> to approve METFaucet to send up to 1,000 MET on behalf of web3.eth.accounts[0]. Finally, to test our faucet, we call METFaucet.withdraw from web3.eth.accounts[1] and try to withdraw 10 MET. Here are the console commands:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt; <strong>migrate</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x79352b43e18cc46b023a779e9a0d16b30f127bfa40266c02f9871d63c26542c7
  Migrations: 0xaa588d3737b611bafd7bd713445b314bd453a5c8
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing METoken...
  ... 0xc42a57f22cddf95f6f8c19d794c8af3b2491f568b38b96fef15b13b6e8bfff21
  METoken: 0xf204a4ef082f5c04bb89f7d5e6568b796096735a
  Replacing METFaucet...
  ... 0xd9615cae2fa4f1e8a377de87f86162832cf4d31098779e6e00df1ae7f1b7f864
  METFaucet: 0x75c35c980c0d37ef46df04d31a140b65503c0eed
Saving artifacts...
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.approve(METFaucet.address, 100000) })</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(web3.eth.accounts[1]).then(console.log) })</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 0, c: [ 0 ] }</strong>
truffle(ganache)&gt; <strong>METFaucet.deployed().then(instance =>
                  { instance.withdraw(1000, {from:web3.eth.accounts[1]}) } )</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(web3.eth.accounts[1]).then(console.log) })</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 3, c: [ 1000 ] }</strong>
</pre>
<div class="paragraph data-line-704">
<p>As you can see from the results, we can use the approve &amp; transferFrom workflow to authorize one contract to transfer tokens defined in another token. If properly used, ERC20 tokens can be used by EOAs and other contracts.</p>
</div>
<div class="paragraph data-line-706">
<p>However, the burden of managing ERC20 tokens correctly is pushed to the user interface. If a user incorrectly attempts to transfer ERC20 tokens to a contract address and that contract is not equipped to receive ERC20 tokens, the tokens will be lost.</p>
</div>
</div>
</div>
<div class="sect3 data-line-709">
<h4 id="ERC20_issues">Issues with ERC20 Tokens</h4>
<div class="paragraph data-line-711">
<p>The adoption of the ERC20 token standard has been truly explosive. Thousands of tokens have been launched, both to experiment with new capabilities and to raise funds in various "crowdfund" auctions and ICOs. However, there are some potential pitfalls, as we saw with the issue of transferring tokens to contract addresses.</p>
</div>
<div class="paragraph data-line-713">
<p>One of the less obvious issues with ERC20 tokens is that they expose subtle differences between tokens and ether itself. Where ether is transferred by a transaction that has a recipient address as its destination, token transfers occur within the <em>specific token contract state</em> and have the token contract as their destination, not the recipient&#8217;s address. The token contract tracks balances and issues events. In a token transfer, no transaction is actually sent to the recipient of the token. Instead, the recipient&#8217;s address is added to a map within the token contract itself. A transaction sending ether to an address changes the state of an address. A transaction transferring a token to an address only changes the state of the token contract, not the state of the recipient address. Even a wallet that has support for ERC20 tokens does not become aware of a token balance unless the user explicitly adds a specific token contract to "watch." Some wallets watch the most popular token contracts to detect balances held by addresses they control, but that&#8217;s limited to a small fraction of existing ERC20 <span class="keep-together">contracts</span>.</p>
</div>
<div class="paragraph data-line-715">
<p>In fact, it&#8217;s unlikely that a user would <em>want</em> to track all balances in all possible ERC20 token contracts. Many ERC20 tokens are more like email spam than usable tokens. They automatically create balances for accounts that have ether activity, in order to attract users. If you have an Ethereum address with a long history of activity, especially if it was created in the presale, you will find it full of "junk" tokens that appeared out of nowhere. Of course, the address isn&#8217;t really full of tokens; it&#8217;s the token contracts that have your address in them. You only see these balances if these token contracts are being watched by the block explorer or wallet you use to view your address.</p>
</div>
<div class="paragraph data-line-717">
<p>Tokens don&#8217;t behave the same way as ether. Ether is sent with the send function and accepted by any payable function in a contract or any externally owned address. Tokens are sent using transfer or approve &amp; transferFrom functions that exist only in the ERC20 contract, and do not (at least in ERC20) trigger any payable functions in a recipient contract. Tokens are meant to function just like a cryptocurrency such as ether, but they come with certain differences that break that illusion.</p>
</div>
<div class="paragraph data-line-719">
<p>Consider another issue. To send ether or use any Ethereum contract you need ether to pay for gas. To send tokens, you <em>also need ether</em>. You cannot pay for a transaction&#8217;s gas with a token and the token contract can&#8217;t pay for the gas for you. This may change at some point in the distant future, but in the meantime this can cause some rather strange user experiences. For example, let&#8217;s say you use an exchange or ShapeShift to convert some bitcoin to a token. You "receive" the token in a wallet that tracks that token&#8217;s contract and shows your balance. It looks the same as any of the other cryptocurrencies you have in your wallet. Try sending the token, though, and your wallet will inform you that you need ether to do that. You might be confused&#x2014;after all, you didn&#8217;t need ether to receive the token. Perhaps you have no ether. Perhaps you didn&#8217;t even know the token was an ERC20 token on Ethereum; maybe you thought it was a cryptocurrency with its own blockchain. The illusion just broke.</p>
</div>
<div class="paragraph data-line-721">
<p>Some of these issues are specific to ERC20 tokens. Others are more general issues that relate to abstraction and interface boundaries within Ethereum. Some can be solved by changing the token interface, while others may need changes to fundamental structures within Ethereum (such as the distinction between EOAs and contracts, and between transactions and messages). Some may not be "solvable" exactly and may require user interface design to hide the nuances and make the user experience consistent regardless of the underlying distinctions.</p>
</div>
<div class="paragraph data-line-723">
<p>In the next sections we will look at various proposals that attempt to address some of these issues.</p>
</div>
</div>
<div class="sect3 data-line-726">
<h4 id="ERC223_std">ERC223: A Proposed Token Contract Interface Standard</h4>
<div class="paragraph data-line-728">
<p>The ERC223 proposal attempts to solve the problem of inadvertent transfer of tokens to a contract (that may or may not support tokens) by detecting whether the destination address is a contract or not. ERC223 requires that contracts designed to accept tokens implement a function named tokenFallback. If the destination of a transfer is a contract and the contract does not have support for tokens (i.e., does not implement tokenFallback), the transfer fails.</p>
</div>
<div id="is_contract" class="paragraph data-line-731">
<p>To detect whether the destination address is a contract, the ERC223 reference implementation uses a small segment of inline bytecode in a rather creative way:</p>
</div>
<div class="listingblock data-line-734">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function isContract(address _addr) private view returns (bool is_contract) {
  uint length;
    assembly {
       // retrieve the size of the code on target address; this needs assembly
       length := extcodesize(_addr)
    }
    return (length&gt;0);
}</code></pre>
</div>
</div>
<div id="ERC223_interface" class="paragraph data-line-746">
<p>The ERC223 contract interface specification is:</p>
</div>
<div class="listingblock data-line-749">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC223Token {
  uint public totalSupply;
  function balanceOf(address who) public view returns (uint);

  function name() public view returns (string _name);
  function symbol() public view returns (string _symbol);
  function decimals() public view returns (uint8 _decimals);
  function totalSupply() public view returns (uint256 _supply);

  function transfer(address to, uint value) public returns (bool ok);
  function transfer(address to, uint value, bytes data) public returns (bool ok);
  function transfer(address to, uint value, bytes data, string custom_fallback)
      public returns (bool ok);

  event Transfer(address indexed from, address indexed to, uint value,
                 bytes indexed data);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-769">
<p>ERC223 is not widely implemented, and there is some debate in <a href="https://github.com/ethereum/EIPs/issues/223" data-href="https://github.com/ethereum/EIPs/issues/223">the ERC discussion</a> thread about backward compatibility and trade-offs between implementing changes at the contract interface level versus the user interface. The debate continues.</p>
</div>
</div>
<div class="sect3 data-line-771">
<h4 id="_erc777_a_proposed_token_contract_interface_standard">ERC777: A Proposed Token Contract Interface Standard</h4>
<div class="paragraph data-line-773">
<p>Another proposal for an improved token contract standard is <a href="https://eips.ethereum.org/EIPS/eip-777" data-href="https://eips.ethereum.org/EIPS/eip-777">ERC777</a>. This proposal has several goals, including:</p>
</div>
<div class="ulist data-line-775">
<ul>
<li class="data-line-775">
<p>To offer an ERC20-compatible interface</p>
</li>
<li class="data-line-776">
<p>To transfer tokens using a send function, similar to ether transfers</p>
</li>
<li class="data-line-777">
<p>To be compatible with ERC820 for token contract registration</p>
</li>
<li class="data-line-778">
<p>To allow contracts and addresses to control which tokens they send through a <code>tokensToSend</code> function that is called prior to sending</p>
</li>
<li class="data-line-779">
<p>To enable contracts and addresses to be notified of the tokens' receipt by calling a <code>tokensReceived</code> function in the recipient, and to reduce the probability of tokens being locked into contracts by requiring contracts to provide a <span class="keep-together"><code>tokensReceived</code></span> function</p>
</li>
<li class="data-line-780">
<p>To allow existing contracts to use proxy contracts for the tokensToSend and tokensReceived functions</p>
</li>
<li class="data-line-781">
<p>To operate in the same way whether sending to a contract or an EOA</p>
</li>
<li class="data-line-782">
<p>To provide specific events for the minting and burning of tokens</p>
</li>
<li class="data-line-783">
<p>To enable operators (trusted third parties, intended to be verified contracts) to move tokens on behalf of a token holder</p>
</li>
<li class="data-line-784">
<p>To provide metadata on token transfer transactions in userData and operatorData fields</p>
</li>
</ul>
</div>
<div class="paragraph data-line-786">
<p>The ongoing discussion on ERC777 can be found <a href="https://github.com/ethereum/EIPs/issues/777" data-href="https://github.com/ethereum/EIPs/issues/777">on GitHub</a>.</p>
</div>
<div id="ERC777_interface" class="paragraph data-line-789">
<p>The ERC777 contract interface specification is:</p>
</div>
<div class="listingblock data-line-792">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777Token {
    function name() public constant returns (string);
    function symbol() public constant returns (string);
    function totalSupply() public constant returns (uint256);
    function granularity() public constant returns (uint256);
    function balanceOf(address owner) public constant returns (uint256);

    function send(address to, uint256 amount, bytes userData) public;

    function authorizeOperator(address operator) public;
    function revokeOperator(address operator) public;
    function isOperatorFor(address operator, address tokenHolder)
        public constant returns (bool);
    function operatorSend(address from, address to, uint256 amount,
                          bytes userData,bytes operatorData) public;

    event Sent(address indexed operator, address indexed from,
               address indexed to, uint256 amount, bytes userData,
               bytes operatorData);
    event Minted(address indexed operator, address indexed to,
                 uint256 amount, bytes operatorData);
    event Burned(address indexed operator, address indexed from,
                 uint256 amount, bytes userData, bytes operatorData);
    event AuthorizedOperator(address indexed operator,
                             address indexed tokenHolder);
    event RevokedOperator(address indexed operator, address indexed tokenHolder);
}</code></pre>
</div>
</div>
<div class="sect4 data-line-823">
<h5 id="ERC777_hooks">ERC777 hooks</h5>
<div id="ERC777TokensSender_interface" class="paragraph data-line-826">
<p>The ERC777 tokens sender hook specification is:</p>
</div>
<div class="listingblock data-line-829">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777TokensSender {
    function tokensToSend(address operator, address from, address to,
                          uint value, bytes userData, bytes operatorData) public;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-836">
<p>The implementation of this interface is required for any address wishing to be notified of, to handle, or to prevent the debit of tokens. The address for which the contract implements this interface must be registered via ERC820, whether the contract implements the interface for itself or for another address.</p>
</div>
<div id="ERC777TokensRecipient_interface" class="paragraph data-line-839">
<p>The ERC777 tokens recipient hook specification is:</p>
</div>
<div class="listingblock data-line-842">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777TokensRecipient {
  function tokensReceived(
     address operator, address from, address to,
    uint amount, bytes userData, bytes operatorData
  ) public;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-851">
<p>The implementation of this interface is required for any address wishing to be notified of, to handle, or to reject the reception of tokens. The same logic and requirements apply to the tokens recipient as to the tokens sender interface, with the added constraint that recipient contracts must implement this interface to prevent locking tokens. If the recipient contract does not register an address implementing this interface, the transfer of tokens will fail.</p>
</div>
<div class="paragraph data-line-853">
<p>An important aspect is that only one token sender and one token recipient can be registered per address. Hence, for every ERC777 token transfer the same hook functions are called upon debit and reception of every ERC777 token transfer. A specific token can be identified in these functions using the message&#8217;s sender, which is the specific token contract address, to handle a particular use case.</p>
</div>
<div class="paragraph data-line-855">
<p>On the other hand, the same token sender and token recipient hooks can be registered for multiple addresses and the hooks can distinguish who are the sender and the intended recipient using the <code>from</code> and <code>to</code> parameters.</p>
</div>
<div class="paragraph data-line-857">
<p>A <a href="http://bit.ly/2qkAKba" data-href="http://bit.ly/2qkAKba">reference implementation</a> of ERC777 is linked in the proposal. ERC777 depends on a parallel proposal for a registry contract, specified in ERC820. Some of the debate on ERC777 is about the complexity of adopting two big changes at once: a new token standard and a registry standard. The discussion continues.</p>
</div>
</div>
</div>
<div class="sect3 data-line-860">
<h4 id="erc721">ERC721: Non-fungible Token (Deed) Standard</h4>
<div class="paragraph data-line-862">
<p>All the token standards we have looked at so far are for <em>fungible</em> tokens, meaning that units of a token are interchangeable. The ERC20 token standard only tracks the final balance of each account and does not (explicitly) track the provenance of any token.</p>
</div>
<div class="paragraph data-line-864">
<p>The <a href="http://bit.ly/2Ogs7Im" data-href="http://bit.ly/2Ogs7Im">ERC721 proposal</a> is for a standard for <em>non-fungible</em> tokens, also known as <em>deeds</em>.</p>
</div>
<div class="paragraph data-line-866">
<p>From the Oxford Dictionary:</p>
</div>
<div class="quoteblock data-line-868">
<blockquote>
<div class="paragraph data-line-869">
<p><em>deed</em>: A legal document that is signed and delivered, especially one regarding the ownership of property or legal rights.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-872">
<p>The use of the word "deed" is intended to reflect the "ownership of property" part, even though these are not recognized as "legal documents" in any jurisdiction&#x2014;yet. It is likely that at some point in the future, legal ownership based on digital signatures on a blockchain platform will be legally recognized.</p>
</div>
<div class="paragraph data-line-874">
<p>Non-fungible tokens track ownership of a unique thing. The thing owned can be a digital item, such as an in-game item or digital collectible; or the thing can be a physical item whose ownership is tracked by a token, such as a house, a car, or an artwork. Deeds can also represent things with negative value, such as loans (debt), liens, easements, etc. The ERC721 standard places no limitation or expectation on the nature of the thing whose ownership is tracked by a deed and requires only that it can be uniquely identified, which in the case of this standard is achieved by a 256-bit <span class="keep-together">identifier</span>.</p>
</div>
<div class="paragraph data-line-876">
<p>The details of the standard and discussion are tracked in two different GitHub <span class="keep-together">locations</span>:</p>
</div>
<div class="ulist data-line-878">
<ul>
<li class="data-line-878">
<p><a href="https://github.com/ethereum/EIPs/issues/721" data-href="https://github.com/ethereum/EIPs/issues/721">Initial proposal</a></p>
</li>
<li class="data-line-880">
<p><a href="https://github.com/ethereum/EIPs/pull/841" data-href="https://github.com/ethereum/EIPs/pull/841">Continued discussion</a></p>
</li>
</ul>
</div>
<div id="map_deed_owner" class="paragraph data-line-883">
<p>To grasp the basic difference between ERC20 and ERC721, it is sufficient to look at the internal data structure used in ERC721:</p>
</div>
<div class="listingblock data-line-886">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Mapping from deed ID to owner
mapping (uint256 =&gt; address) private deedOwner;</code></pre>
</div>
</div>
<div class="paragraph data-line-891">
<p>Whereas ERC20 tracks the balances that belong to each owner, with the owner being the primary key of the mapping, ERC721 tracks each deed ID and who owns it, with the deed ID being the primary key of the mapping. From this basic difference flow all the properties of a non-fungible token.</p>
</div>
<div id="ERC721_interface" class="paragraph data-line-894">
<p>The ERC721 contract interface specification is:</p>
</div>
<div class="listingblock data-line-897">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721 /* is ERC165 */ {
    event Transfer(address indexed _from, address indexed _to, uint256 _deedId);
    event Approval(address indexed _owner, address indexed _approved,
                   uint256 _deedId);
    event ApprovalForAll(address indexed _owner, address indexed _operator,
                         bool _approved);

    function balanceOf(address _owner) external view returns (uint256 _balance);
    function ownerOf(uint256 _deedId) external view returns (address _owner);
    function transfer(address _to, uint256 _deedId) external payable;
    function transferFrom(address _from, address _to, uint256 _deedId)
        external payable;
    function approve(address _approved, uint256 _deedId) external payable;
    function setApprovalForAll(address _operateor, boolean _approved) payable;
    function supportsInterface(bytes4 interfaceID) external view returns (bool);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-916">
<p>ERC721 also supports two <em>optional</em> interfaces, one for metadata and one for enumeration of deeds and owners.</p>
</div>
<div id="ERC721_metadata" class="paragraph data-line-919">
<p>The ERC721 optional interface for metadata is:</p>
</div>
<div class="listingblock data-line-922">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721Metadata /* is ERC721 */ {
    function name() external pure returns (string _name);
    function symbol() external pure returns (string _symbol);
    function deedUri(uint256 _deedId) external view returns (string _deedUri);
}</code></pre>
</div>
</div>
<div id="ERC721_enum" class="paragraph data-line-931">
<p>The ERC721 optional interface for enumeration is:</p>
</div>
<div class="listingblock data-line-934">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721Enumerable /* is ERC721 */ {
    function totalSupply() external view returns (uint256 _count);
    function deedByIndex(uint256 _index) external view returns (uint256 _deedId);
    function countOfOwners() external view returns (uint256 _count);
    function ownerByIndex(uint256 _index) external view returns (address _owner);
    function deedOfOwnerByIndex(address _owner, uint256 _index) external view
        returns (uint256 _deedId);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-946">
<h3 id="token_std_review">Using Token Standards</h3>
<div class="paragraph data-line-948">
<p>In the previous section we reviewed several proposed standards and a couple of widely deployed standards for token contracts. What exactly do these standards do? Should you use these standards? How should you use them? Should you add functionality beyond these standards? Which standards should you use? We will examine some of those questions next.</p>
</div>
<div class="sect3 data-line-951">
<h4 id="token_std_purpose">What Are Token Standards? What Is Their Purpose?</h4>
<div class="paragraph data-line-953">
<p>Token standards are the <em>minimum</em> specifications for an implementation. What that means is that in order to be compliant with, say, ERC20, you need to at minimum implement the functions and behavior specified by the ERC20 standard. You are also free to <em>add</em> to the functionality by implementing functions that are not part of the standard.</p>
</div>
<div class="paragraph data-line-955">
<p>The primary purpose of these standards is to encourage <em>interoperability</em> between contracts. Thus, all wallets, exchanges, user interfaces, and other infrastructure components can <em>interface</em> in a predictable manner with any contract that follows the specification. In other words, if you deploy a contract that follows the ERC20 standard, all existing wallet users can seamlessly start trading your token without any wallet upgrade or effort on your part.</p>
</div>
<div class="paragraph data-line-957">
<p>The standards are meant to be <em>descriptive</em>, rather than <em>prescriptive</em>. How you choose to implement those functions is up to you&#x2014;the internal functioning of the contract is not relevant to the standard. They have some functional requirements, which govern the behavior under specific circumstances, but they do not prescribe an implementation. An example of this is the behavior of a transfer function if the value is set to zero.</p>
</div>
</div>
<div class="sect3 data-line-960">
<h4 id="should_use_std">Should You Use These Standards?</h4>
<div class="paragraph data-line-962">
<p>Given all these standards, each developer faces a dilemma: use the existing standards or innovate beyond the restrictions they impose?</p>
</div>
<div class="paragraph data-line-964">
<p>This dilemma is not easy to resolve. Standards necessarily restrict your ability to innovate, by creating a narrow "rut" that you have to follow. On the other hand, the basic standards have emerged from experience with hundreds of applications and often fit well with the vast majority of use cases.</p>
</div>
<div class="paragraph data-line-966">
<p>As part of this consideration is an even bigger issue: the value of interoperability and broad adoption. If you choose to use an existing standard, you gain the value of all the systems designed to work with that standard. If you choose to depart from the standard, you have to consider the cost of building all of the support infrastructure on your own, or persuading others to support your implementation as a new standard. The tendency to forge your own path and ignore existing standards is known as "Not Invented Here" syndrome and is antithetical to open source culture. On the other hand, progress and innovation depend on departing from tradition sometimes. It&#8217;s a tricky choice, so consider it carefully!</p>
</div>
<div class="admonitionblock note data-line-969">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-970">
<p>Per Wikipedia, <a href="https://en.wikipedia.org/wiki/Not_invented_here" data-href="https://en.wikipedia.org/wiki/Not_invented_here">&#x201c;Not Invented Here&#x201d;</a> is a stance adopted by social, corporate, or institutional cultures that avoid using or buying already existing products, research, standards, or knowledge because of their external origins and costs, such as royalties.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-975">
<h4 id="security_maturity">Security by Maturity</h4>
<div class="paragraph data-line-977">
<p>Beyond the choice of standard, there is the parallel choice of <em>implementation</em>. When you decide to use a standard such as ERC20, you have to then decide how to implement a compatible design. There are a number of existing "reference" implementations that are widely used in the Ethereum ecosystem, or you could write your own from scratch. Again, this choice represents a dilemma that can have serious security implications.</p>
</div>
<div class="paragraph data-line-979">
<p>Existing implementations are &#x201c;battle-tested.&#x201d; While it is impossible to prove that they are secure, many of them underpin millions of dollars' worth of tokens. They have been attacked, repeatedly and vigorously. So far, no significant vulnerabilities have been discovered. Writing your own is not easy&#x2014;there are many subtle ways that a contract can be compromised. It is much safer to use a well-tested, widely used implementation. In our examples, we used the OpenZeppelin implementation of the ERC20 standard, as this implementation is security-focused from the ground up.</p>
</div>
<div class="paragraph data-line-981">
<p>If you use an existing implementation you can also extend it. Again, however, be careful with this impulse. Complexity is the enemy of security. Every single line of code you add expands the <em>attack surface</em> of your contract and could represent a vulnerability lying in wait. You may not notice a problem until you put a lot of value on top of the contract and someone breaks it.</p>
</div>
<div class="admonitionblock tip data-line-984">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-985">
<p>Standards and implementation choices are important parts of overall secure smart contract design, but they&#8217;re not the only considerations. See <a href="#smart_contract_security">[smart_contract_security]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-990">
<h3 id="extend_token_interface">Extensions to Token Interface Standards</h3>
<div class="paragraph data-line-992">
<p>The token standards discussed in this chapter provide a very minimal interface, with limited functionality. Many projects have created extended implementations to support features that they need for their applications. Some of these features include:</p>
</div>
<div class="dlist data-line-994">
<dl>
<dt class="hdlist1">Owner control</dt>
<dd>
<p>The ability to give specific addresses, or sets of addresses (i.e., multisignature schemes), special capabilities, such as blacklisting, whitelisting, minting, recovery, etc.</p>
</dd>
<dt class="hdlist1">Burning</dt>
<dd>
<p>The ability to deliberately destroy (&#x201c;burn&#x201d;) tokens by transferring them to an unspendable address or by erasing a balance and reducing the supply.</p>
</dd>
<dt class="hdlist1">Minting</dt>
<dd>
<p>The ability to add to the total supply of tokens, at a predictable rate or by "fiat" of the creator of the token.</p>
</dd>
<dt class="hdlist1">Crowdfunding</dt>
<dd>
<p>The ability to offer tokens for sale, for example through an auction, market sale, reverse auction, etc.</p>
</dd>
<dt class="hdlist1">Caps</dt>
<dd>
<p>The ability to set predefined and immutable limits on the total supply (the opposite of the "minting" feature).</p>
</dd>
<dt class="hdlist1">Recovery backdoors</dt>
<dd>
<p>Functions to recover funds, reverse transfers, or dismantle the token that can be activated by a designated address or set of addresses.</p>
</dd>
<dt class="hdlist1">Whitelisting</dt>
<dd>
<p>The ability to restrict actions (such as token transfers) to specific addresses. Most commonly used to offer tokens to "accredited investors" after vetting by the rules of different jurisdictions. There is usually a mechanism for updating the whitelist.</p>
</dd>
<dt class="hdlist1">Blacklisting</dt>
<dd>
<p>The ability to restrict token transfers by disallowing specific addresses. There is usually a function for updating the blacklist.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1010">
<p>There are reference implementations for many of these functions, for example in the OpenZeppelin library. Some of these are use case‚Äìspecific and only implemented in a few tokens. There are, as of now, no widely accepted standards for the interfaces to these functions.</p>
</div>
<div class="paragraph data-line-1012">
<p>As previously discussed, the decision to extend a token standard with additional functionality represents a trade-off between innovation/risk and interoperability/security.</p>
</div>
</div>
<div class="sect2 data-line-1015">
<h3 id="tokens_ico">Tokens and ICOs</h3>
<div class="paragraph data-line-1017">
<p>Tokens have been an explosive development in the Ethereum ecosystem. It is likely that they will become a very important component of all smart contract platforms like Ethereum.</p>
</div>
<div class="paragraph data-line-1019">
<p>Nevertheless, the importance and future impact of these standards should not be confused with an endorsement of current token offerings. As in any early-stage technology, the first wave of products and companies will almost all fail, and some will fail spectacularly. Many of the tokens on offer in Ethereum today are barely disguised scams, pyramid schemes, and money grabs.</p>
</div>
<div class="paragraph data-line-1021">
<p>The trick is to separate the long-term vision and impact of this technology, which is likely to be huge, from the short-term bubble of token ICOs, which are rife with fraud. Token standards and the platform will survive the current token mania, and then they will likely change the world.</p>
</div>
</div>
<div class="sect2 data-line-1023">
<h3 id="_conclusions">Conclusions</h3>
<div class="paragraph data-line-1025">
<p>Tokens are a very powerful concept in Ethereum and can form the basis of many important decentralized applications. In this chapter we looked at the different types of tokens and token standards, and you built your first token and related application. We will revisit tokens again in <a href="#decentralized_applications_chap">[decentralized_applications_chap]</a>, where you will use a non-fungible token as the basis for an auction DApp.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-26 12:14:52 -0400
</div>
</div>
</body>
</html>