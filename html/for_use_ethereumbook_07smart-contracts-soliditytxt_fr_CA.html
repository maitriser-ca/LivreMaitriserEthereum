<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Contrats intelligents et Solidity</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="smart_contracts_chapter">Contrats intelligents et Solidity</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Comme nous en avons discuté dans <a href="#intro_chapter">[intro_chapter]</a>, il existe deux types de comptes différents dans Ethereum : les comptes externes (EOA) et comptes contractuels. Les EOA sont contrôlés par les utilisateurs, souvent via un logiciel tel qu&#39;une application de portefeuille externe à la plate-forme Ethereum.  contrats ») qui est exécuté par la machine virtuelle Ethereum. En bref, les EOA sont de simples comptes sans code ni stockage de données associés, tandis que les comptes contractuels ont à la fois un code et un stockage de données associés. Les EOA sont contrôlés par des transactions créées et signées cryptographiquement avec une clé privée dans le &quot;monde réel&quot; externe et indépendant du protocole, alors que les comptes contractuels n&#39;ont pas de clés privées et &quot;se contrôlent&quot; donc de la manière prédéterminée prescrite par leur code de contrat intelligent. Les deux types de comptes sont identifiés par une adresse Ethereum. Dans ce chapitre, nous discuterons des comptes contractuels et du code de programme qui les contrôle.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="smart_contracts_definition">Qu&#39;est-ce qu&#39;un contrat intelligent ?</h3>
<div class="paragraph data-line-9">
<p>Le terme <em>contrat intelligent</em> a été utilisé au fil des ans pour décrire une grande variété de choses différentes. Dans les années 1990, le cryptographe Nick Szabo a inventé le terme et l&#39;a défini comme &quot;un ensemble de promesses, spécifiées sous forme numérique, y compris des protocoles au sein que les parties exécutent sur les autres promesses. Depuis lors, le concept de contrats intelligents a évolué, notamment après l&#39;introduction de plateformes de chaîne de blocs décentralisées avec l&#39;invention de Bitcoin en 2009. Dans le contexte d&#39;Ethereum, le terme est en fait un peu impropre, étant donné que les contrats intelligents Ethereum ne sont ni des contrats intelligents ni légaux, mais le terme est resté. Dans ce livre, nous utilisons le terme «contrats intelligents» pour désigner des programmes informatiques immuables qui s&#39;exécutent de manière déterministe dans le contexte d&#39;une machine virtuelle Ethereum dans le cadre du protocole réseau Ethereum, c&#39;est-à-dire sur l&#39;ordinateur mondial Ethereum décentralisé.</p>
</div>
<div class="paragraph data-line-11">
<p>Déballons cette définition :</p>
</div>
<div class="dlist data-line-13">
<dl>
<dt class="hdlist1">Logiciels d&#39;ordinateur</dt>
<dd>
<p>Les contrats intelligents sont simplement des programmes informatiques. Le mot « contrat » n&#39;a aucune signification juridique dans ce contexte.</p>
</dd>
<dt class="hdlist1">Immuable</dt>
<dd>
<p>Une fois déployé, le code d&#39;un contrat intelligent ne peut pas changer. Contrairement aux logiciels traditionnels, la seule façon de modifier un contrat intelligent est de déployer une nouvelle instance.</p>
</dd>
<dt class="hdlist1">Déterministe</dt>
<dd>
<p>Le résultat de l&#39;exécution d&#39;un contrat intelligent est le même pour tous ceux qui l&#39;exécutent, compte tenu du contexte de la transaction qui a initié son exécution et de l&#39;état de la chaîne de blocs Ethereum au moment de l&#39;exécution.</p>
</dd>
<dt class="hdlist1">Contexte EVM</dt>
<dd>
<p>Les contrats intelligents fonctionnent avec un contexte d&#39;exécution très limité. Ils peuvent accéder à leur propre état, au contexte de la transaction qui les a appelés et à certaines informations sur les blocs les plus récents.</p>
</dd>
<dt class="hdlist1">Ordinateur mondial décentralisé</dt>
<dd>
<p>L&#39;EVM fonctionne comme une instance locale sur chaque nœud Ethereum, mais comme toutes les instances de l&#39;EVM fonctionnent sur le même état initial et produisent le même état final, le système dans son ensemble fonctionne comme un seul &quot;ordinateur mondial&quot;.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2 data-line-29">
<h3 id="smart_contract_lifecycle">Cycle de vie d&#39;un contrat intelligent</h3>
<div class="paragraph data-line-31">
<p>Les contrats intelligents sont généralement écrits dans un langage de haut niveau, tel que Solidity. Mais pour fonctionner, ils doivent être compilés dans le code intermédiaire (bytecode) de bas niveau qui s&#39;exécute dans l&#39;EVM. Une fois compilés, ils sont déployés sur la plateforme Ethereum à l&#39;aide d&#39;une transaction spéciale de <em>création de contrat</em>, qui est identifiée comme telle en étant envoyée à l&#39;adresse spéciale de création de contrat, à savoir 0x0 (voir <a href="#contract_reg">[contract_reg]</a>). Chaque contrat est identifié par une adresse Ethereum, qui est dérivée de la transaction de création de contrat en fonction du compte d&#39;origine et du nonce. L&#39;adresse Ethereum d&#39;un contrat peut être utilisée dans une transaction en tant que destinataire, envoyer des fonds au contrat ou appeler l&#39;une des fonctions du contrat. Notez que, contrairement aux EOA, il n&#39;y a pas de clés associées à un compte créé pour un nouveau contrat intelligent. En tant que créateur du contrat, vous n&#39;obtenez aucun privilège spécial au niveau du protocole (bien que vous puissiez les coder explicitement dans le contrat intelligent). Vous ne recevez certainement pas la clé privée du compte de contrat, qui en fait n&#39;existe pas - nous pouvons dire que les comptes de contrat intelligents se possèdent eux-mêmes.</p>
</div>
<div class="paragraph data-line-33">
<p>Il est important de noter que les contrats <em>ne s&#39;exécutent que s&#39;ils sont appelés par une transaction</em>. Tous les contrats intelligents dans Ethereum sont exécutés, en fin de compte, en raison d&#39;une transaction initiée à partir d&#39;un EOA. Un contrat peut appeler un autre contrat qui peut appeler un autre contrat, et ainsi de suite, mais le premier contrat d&#39;une telle chaîne d&#39;exécution aura toujours été appelé par une transaction d&#39;un EOA. Les contrats ne fonctionnent jamais &quot;seuls&quot; ou &quot;en arrière-plan&quot;. Les contrats restent effectivement inactifs jusqu&#39;à ce qu&#39;une transaction déclenche l&#39;exécution, soit directement, soit indirectement dans le cadre d&#39;une chaîne d&#39;appels de contrats. Il convient également de noter que les contrats intelligents ne sont en aucun cas exécutés &quot;en parallèle&quot; - l&#39;ordinateur mondial Ethereum peut être considéré comme une machine à un seul fil d&#8217;exécution (thread).</p>
</div>
<div class="paragraph data-line-35">
<p>Les transactions sont <em>atomique</em>, quel que soit le nombre de contrats qu&#39;elles appellent ou ce que ces contrats font lorsqu&#39;ils sont appelés. Les transactions s&#39;exécutent dans leur intégralité, avec tout changement dans l&#39;état global (contrats, comptes, etc.) enregistré uniquement si toutes les exécutions se terminent avec succès. Une fin réussie signifie que le programme s&#39;est exécuté sans erreur et a atteint la fin de l&#39;exécution. Si l&#39;exécution échoue en raison d&#39;une erreur, tous ses effets (changements d&#39;état) sont &quot;annulés&quot; comme si la transaction n&#39;avait jamais été exécutée. Une transaction échouée est toujours enregistrée comme ayant été tentée, et l&#39;ether dépensé en gaz pour l&#39;exécution est déduit du compte d&#39;origine, mais cela n&#39;a par ailleurs aucun autre effet sur le contrat ou l&#39;état du compte.</p>
</div>
<div class="paragraph data-line-37">
<p>Comme mentionné précédemment, il est important de se rappeler que le code d&#39;un contrat ne peut pas être modifié. Cependant, un contrat peut être &quot;supprimé&quot;, supprimant le code et son état interne (stockage) de son adresse, laissant un compte vide. Toutes les transactions envoyées à cette adresse de compte après la suppression du contrat n&#39;entraînent aucune exécution de code, car il n&#39;y a plus de code à exécuter. Pour supprimer un contrat, vous exécutez un opcode EVM appelé SELFDESTRUCT (précédemment appelé SUICIDE). Cette opération coûte du &quot;gaz négatif&quot;, un remboursement de gaz, incitant ainsi à libérer les ressources du client du réseau à partir de la suppression de l&#39;état stocké. La suppression d&#39;un contrat de cette manière ne supprime pas l&#39;historique des transactions (passé) du contrat, car la blockchain elle-même est immuable. Il est également important de noter que la capacité SELFDESTRUCT ne sera disponible que si l&#39;auteur du contrat a programmé le contrat intelligent pour avoir cette fonctionnalité. Si le code du contrat n&#39;a pas d&#39;opcode SELFDESTRUCT, ou s&#39;il est inaccessible, le contrat intelligent ne peut pas être supprimé.</p>
</div>
</div>
<div class="sect2 data-line-40">
<h3 id="high_level_languages">Introduction aux langages de haut niveau Ethereum</h3>
<div class="paragraph data-line-42">
<p>L&#39;EVM est une machine virtuelle qui exécute une forme spéciale de code appelé <em>code intermédiaire EVM</em> ou <em>EVM bytecode</em>, analogue au processeur de votre ordinateur, qui exécute un code machine tel que x86_64. Nous examinerons le fonctionnement et le langage de l&#39;EVM de manière beaucoup plus détaillée dans <a href="#evm_chapter">[evm_chapter]</a>. Dans cette section, nous verrons comment les contrats intelligents sont écrits pour s&#39;exécuter sur l&#39;EVM.</p>
</div>
<div class="paragraph data-line-44">
<p>Bien qu&#39;il soit possible de programmer des contrats intelligents directement en code intermédiaire, le code intermédiaire EVM est plutôt lourd et très difficile à lire et à comprendre pour les programmeurs. Au lieu de cela, la plupart des développeurs Ethereum utilisent un langage de haut niveau pour écrire des programmes et un compilateur pour les convertir en code intermédiaire.</p>
</div>
<div class="paragraph data-line-46">
<p>Bien que n&#39;importe quel langage de haut niveau puisse être adapté pour écrire des contrats intelligents, adapter un langage arbitraire pour qu&#39;il soit compilable au code intermédiaire EVM est un exercice assez fastidieux et conduirait en général à une certaine confusion. Les contrats intelligents fonctionnent dans un environnement d&#39;exécution très contraint et minimaliste (l&#39;EVM). De plus, un ensemble spécial de variables système et de fonctions spécifiques à EVM doit être disponible. En tant que tel, il est plus facile de créer un langage de contrat intelligent à partir de zéro que de créer un langage à usage général adapté à l&#39;écriture de contrats intelligents. En conséquence, un certain nombre de langages spéciaux ont émergé pour programmer des contrats intelligents. Ethereum possède plusieurs langages de ce type, ainsi que les compilateurs nécessaires pour produire un code intermédiaire exécutable EVM.</p>
</div>
<div class="paragraph data-line-48">
<p>En général, les langages de programmation peuvent être classés en deux grands paradigmes de programmation : <em>déclaratif</em> et <em>impératif</em>, également appelés respectivement <em>fonctionnel</em> et <em>procédural</em>. En programmation déclarative, nous écrivons des fonctions qui expriment la <em>logique</em> d&#39;un programme, mais pas son <em>flux</em>. La programmation déclarative est utilisée pour créer des programmes sans <em>effets secondaires</em>, ce qui signifie qu&#39;il n&#39;y a pas de changement d&#39;état en dehors d&#39;une fonction. Les langages de programmation déclaratifs incluent Haskell et SQL. La programmation impérative, en revanche, est l&#39;endroit où un programmeur écrit un ensemble de procédures qui combinent la logique et le déroulement d&#39;un programme. Les langages de programmation impératifs incluent C++ et Java. Certains langages sont « hybrides », ce qui signifie qu&#39;ils encouragent la programmation déclarative mais peuvent également être utilisés pour exprimer un paradigme de programmation impérative. Ces hybrides incluent Lisp, JavaScript et Python. En général, n&#39;importe quel langage impératif peut être utilisé pour écrire dans un paradigme déclaratif, mais il en résulte souvent un code inélégant. Par comparaison, les langages déclaratifs purs ne peuvent pas être utilisés pour écrire dans un paradigme impératif. Dans les langages purement déclaratifs, <em>il n&#39;y a pas de &quot;variables&quot;.</em></p>
</div>
<div class="paragraph data-line-50">
<p>Bien que la programmation impérative soit plus couramment utilisée par les programmeurs, il peut être très difficile d&#39;écrire des programmes qui s&#39;exécutent <em>exactement comme prévu</em>. La capacité de n&#39;importe quelle partie du programme à modifier l&#39;état de n&#39;importe quelle autre rend difficile le raisonnement sur l&#39;exécution d&#39;un programme et introduit de nombreuses opportunités de bogues. La programmation déclarative, par comparaison, permet de comprendre plus facilement le comportement d&#39;un programme : puisqu&#39;elle n&#39;a pas d&#39;effets secondaires, n&#39;importe quelle partie d&#39;un programme peut être comprise isolément.</p>
</div>
<div class="paragraph data-line-52">
<p>Dans les contrats intelligents, les bogues coûtent littéralement de l&#39;argent. Par conséquent, il est extrêmement important de rédiger des contrats intelligents sans effets indésirables. Pour ce faire, vous devez être capable de raisonner clairement sur le comportement attendu du programme. Ainsi, les langages déclaratifs jouent un rôle beaucoup plus important dans les contrats intelligents que dans les logiciels à usage général. Néanmoins, comme vous le verrez, le langage le plus utilisé pour les contrats intelligents (Solidity) est impératif. Les programmeurs, comme la plupart des humains, résistent au changement !</p>
</div>
<div class="paragraph data-line-54">
<p>Les langages de programmation de haut niveau actuellement pris en charge pour les contrats intelligents incluent (classés par âge approximatif) :</p>
</div>
<div class="dlist data-line-56">
<dl>
<dt class="hdlist1">LLL</dt>
<dd>
<p>Un langage de programmation fonctionnel (déclaratif), avec une syntaxe de type Lisp. C&#39;était le premier langage de haut niveau pour les contrats intelligents Ethereum, mais il est rarement utilisé aujourd&#39;hui.</p>
</dd>
<dt class="hdlist1">Serpent</dt>
<dd>
<p>Un langage de programmation procédural (impératif) avec une syntaxe similaire à Python. Peut également être utilisé pour écrire du code fonctionnel (déclaratif), bien qu&#39;il ne soit pas entièrement exempt d&#39;effets secondaires.</p>
</dd>
<dt class="hdlist1">Solidity</dt>
<dd>
<p>Un langage de programmation procédural (impératif) avec une syntaxe similaire à JavaScript, C++, ou Java. Le langage le plus populaire et le plus fréquemment utilisé pour les contrats intelligents Ethereum.</p>
</dd>
<dt class="hdlist1">Vyper</dt>
<dd>
<p>Un langage développé plus récemment, similaire à Serpent et encore une fois avec une syntaxe de type Python. Destiné à se rapprocher d&#39;un langage de type Python purement fonctionnel que Serpent, mais pas à remplacer Serpent.</p>
</dd>
<dt class="hdlist1">Bamboo</dt>
<dd>
<p>Un langage nouvellement développé, influencé par Erlang, avec des transitions d&#39;état explicites et sans flux itératifs (boucles). Destiné à réduire les effets secondaires et à augmenter l&#39;auditabilité. Très nouveau et en attente d&#8217;être largement adopté.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-66">
<p>Comme vous pouvez le voir, il existe de nombreux languages parmi lesquelles choisir. Cependant, de tous, Solidity est de loin le plus populaire, au point d&#39;être le langage de haut niveau <em>de facto</em> d&#39;Ethereum et même d&#39;autres chaînes de blocs de type EVM. Nous passerons la plupart de notre temps à utiliser Solidity, mais nous explorerons également certains des exemples dans d&#39;autres langages de haut niveau pour comprendre leurs différentes philosophies.</p>
</div>
</div>
<div class="sect2 data-line-69">
<h3 id="building_a_smart_contract_sec">Construire un contrat intelligent avec Solidity</h3>
<div class="paragraph data-line-71">
<p>Solidity a été créé par Dr. Gavin Wood (co-auteur de ce livre) en tant que langage explicite pour écrire des contrats intelligents avec des fonctionnalités permettant de prendre directement en charge l&#39;exécution dans l&#39;environnement décentralisé de l&#39;ordinateur mondial Ethereum. Les attributs résultants sont assez généraux et ont donc fini par être utilisés pour coder des contrats intelligents sur plusieurs autres plateformes de chaîne de blocs. Il a été développé par Christian Reitiwessner puis également par Alex Beregszaszi, Liana Husikyan, Yoichi Hirai et plusieurs anciens contributeurs principaux d&#39;Ethereum. Solidity est maintenant développé et maintenu en tant que projet indépendant <a href="https://github.com/ethereum/solidity" data-href="https://github.com/ethereum/solidity">sur GitHub</a>.</p>
</div>
<div class="paragraph data-line-73">
<p>Le &quot;produit&quot; principal du projet Solidity est le compilateur Solidity, solc, qui convertit les programmes écrits dans le langage Solidity en bytecode EVM. Le projet gère également l&#39;importante norme d&#39;interface binaire d&#39;application (ABI) pour les contrats intelligents Ethereum, que nous explorerons en détail dans ce chapitre. Chaque version du compilateur Solidity correspond à et compile une version spécifique de <span class="keep-together">language</span> de Solidity.</p>
</div>
<div class="paragraph data-line-75">
<p>Pour commencer, nous allons télécharger un exécutable binaire du compilateur Solidity. Ensuite, nous développerons et compilerons un contrat simple, à la suite de l&#39;exemple avec lequel nous avons commencé dans <a href="#intro_chapter">[intro_chapter]</a>.</p>
</div>
<div class="sect3 data-line-77">
<h4 id="_sélection_dune_version_de_solidity">Sélection d&#39;une version de Solidity</h4>
<div class="paragraph data-line-79">
<p>Solidity suit un modèle de versionnage appelé <a href="https://semver.org/" data-href="https://semver.org/"><em>versionnage de sémantique</em></a> (<em>semantic versioning</em>), qui spécifie les numéros de version structurés comme trois nombres séparés par des points : <em>MAJEUR.MINEUR.CORRECTIF</em>. Le numéro &quot;majeur&quot; est incrémenté pour les modifications majeures et <em>rétro-incompatibles</em>, le numéro &quot;mineur&quot; est incrémenté lorsque des fonctionnalités rétrocompatibles sont ajoutées entre les versions majeures, et le numéro &quot;correctif&quot; est incrémenté pour les corrections de bogues rétrocompatibles.</p>
</div>
<div class="paragraph data-line-81">
<p>Au moment de la rédaction, Solidity est à la version 0.4.24. Les règles de la version majeure 0, qui concerne le développement initial d&#39;un projet, sont différentes : tout peut changer à tout moment. En pratique, Solidity traite le numéro &quot;mineur&quot; comme s&#39;il s&#39;agissait de la version majeure et le numéro de &quot;correctif&quot; comme s&#39;il s&#39;agissait de la version mineure. Par conséquent, dans la version 0.4.24, 4 est considérée comme la version majeure et 24 comme la version mineure.</p>
</div>
<div class="paragraph data-line-83">
<p>La sortie de la version majeure 0.5 de Solidity est attendue de manière imminente.</p>
</div>
<div class="paragraph data-line-85">
<p>Comme vous l&#39;avez vu dans <a href="#intro_chapter">[intro_chapter]</a>, vos programmes Solidity peuvent contenir une directive pragma qui spécifie les versions minimale et maximale de Solidity avec lesquelles il est compatible, et peut être utilisée pour compiler votre contrat.</p>
</div>
<div class="paragraph data-line-87">
<p>Étant donné que Solidity évolue rapidement, il est souvent préférable d&#39;installer la dernière version.</p>
</div>
</div>
<div class="sect3 data-line-89">
<h4 id="_télécharger_et_installer">Télécharger et installer</h4>
<div class="paragraph data-line-91">
<p>Il existe un certain nombre de méthodes que vous pouvez utiliser pour télécharger et installer Solidity, soit sous forme de version binaire, soit en compilant à partir du code source. Vous pouvez trouver des instructions détaillées dans <a href="http://bit.ly/2RrZmup" class="undefined" data-href="http://bit.ly/2RrZmup">http://bit.ly/2RrZmup</a> [la documentation de Solidity].</p>
</div>
<div class="paragraph data-line-93">
<p>Voici comment installer la dernière version binaire de Solidity sur un système d&#39;exploitation Ubuntu/Debian, en utilisant le gestionnaire de paquets apt :</p>
</div>
<pre data-type="programlisting">
$ <strong>sudo add-apt-repository ppa:ethereum/ethereum</strong>
$ <strong>sudo apt update</strong>
$ <strong>sudo apt install solc</strong>
</pre>
<div class="paragraph data-line-103">
<p>Une fois que vous avez installé solc, vérifiez la version en exécutant :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --version</strong>
solc, the solidity compiler commandline interface
Version: 0.4.24+commit.e67f0147.Linux.g++
</pre>
<div class="paragraph data-line-113">
<p>Il existe plusieurs autres façons d&#39;installer Solidity, en fonction de votre système d&#39;exploitation et de vos exigences, y compris la compilation directe à partir du code source. Pour plus d&#39;informations, consultez <a href="https://github.com/ethereum/solidity" class="undefined" data-href="https://github.com/ethereum/solidity">https://github.com/ethereum/solidity</a>.</p>
</div>
</div>
<div class="sect3 data-line-117">
<h4 id="_environnement_de_développement">Environnement de développement</h4>
<div class="paragraph data-line-119">
<p>Pour développer dans Solidity, vous pouvez utiliser n&#39;importe quel éditeur de texte et solc sur la ligne de commande. Cependant, vous constaterez peut-être que certains éditeurs de texte conçus pour le développement, tels que Emacs, Vim et Atom, offrent des fonctionnalités supplémentaires telles que la coloration syntaxique et les macros qui facilitent le développement de Solidity.</p>
</div>
<div class="paragraph data-line-121">
<p>Il existe également des environnements de développement basés sur le Web, tels que <a href="https://remix.ethereum.org/" data-href="https://remix.ethereum.org/">Remix IDE</a> et <a href="https://ethfiddle.com/" data-href="https://ethfiddle.com/">EthFiddle</a>.</p>
</div>
<div class="paragraph data-line-123">
<p>Utilisez les outils qui vous rendent productif. En fin de compte, les programmes Solidity ne sont que des fichiers texte. Bien que des éditeurs et des environnements de développement sophistiqués puissent faciliter les choses, vous n&#39;avez besoin de rien de plus qu&#39;un simple éditeur de texte, tel que nano (Linux/Unix), TextEdit (macOS) ou même NotePad (Windows). Enregistrez simplement le code source de votre programme avec une extension <em>.sol</em> et il sera reconnu par le compilateur Solidity comme un programme Solidity.</p>
</div>
</div>
<div class="sect3 data-line-125">
<h4 id="_écrire_un_programme_solidity_simple">Écrire un programme Solidity simple</h4>
<div class="paragraph data-line-127">
<p>Dans <a href="#intro_chapter">[intro_chapter]</a>, nous avons écrit notre premier programme Solidity. Lorsque nous avons créé le contrat Faucet pour la première fois, nous avons utilisé l&#39;IDE Remix pour compiler et déployer le contrat. Dans cette section, nous allons revisiter, améliorer et embellir Faucet.</p>
</div>
<div class="paragraph data-line-129">
<p>Notre première tentative ressemblait à <a href="#original_sol_faucet">Faucet.sol : Un contrat Solidity mettant en place un robinet</a>.</p>
</div>
<div id="original_sol_faucet" class="exampleblock data-line-133">
<div class="title">Example 1. Faucet.sol : Un contrat Solidity mettant en place un robinet</div>
<div class="content">
<div class="listingblock data-line-135">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity 0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-140">
<h4 id="_compiler_avec_le_compilateur_solidity_solc">Compiler avec le compilateur Solidity (solc)</h4>
<div class="paragraph data-line-142">
<p>Maintenant, nous allons utilisez le compilateur Solidity en ligne de commande pour compiler directement notre contrat. Le compilateur Solidity solc offre une variété d&#39;options, que vous pouvez voir en passant l&#39;argument --help.</p>
</div>
<div class="paragraph data-line-144">
<p>Nous utilisons les arguments --bin et --optimize de solc pour produire un binaire optimisé de notre exemple de contrat :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --optimize --bin Faucet.sol</strong>
======= Faucet.sol:Faucet =======
Binary:
6060604052341561000f57600080fd5b60cf8061001d6000396000f300606060405260043610603e5
763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416
632e1a7d4d81146040575b005b3415604a57600080fd5b603e60043567016345785d8a00008111156
06357600080fd5b73ffffffffffffffffffffffffffffffffffffffff331681156108fc0282604051
600060405180830381858888f19350505050151560a057600080fd5b505600a165627a7a723058203
556d79355f2da19e773a9551e95f1ca7457f2b5fbbf4eacf7748ab59d2532130029
</pre>
<div class="paragraph data-line-162">
<p>Le résultat que solc produit est un binaire sérialisé hexadécimal qui peut être soumis à la chaîne de blocs Ethereum.</p>
</div>
</div>
</div>
<div class="sect2 data-line-165">
<h3 id="eth_contract_abi_sec">L&#39;ABI du contrat Ethereum</h3>
<div class="paragraph data-line-167">
<p>Dans les logiciels informatiques, une <em>interface binaire d&#39;application</em> est une interface entre deux modules de programme ; souvent, entre le système d&#39;exploitation et les programmes utilisateur. Un ABI définit la façon dont les structures de données et les fonctions sont accessibles en <em>code machine</em> ; cela ne doit pas être confondu avec une API, qui définit cet accès dans des formats de haut niveau, souvent lisibles par l&#39;homme, en tant que <em>code source</em>. L&#39;ABI est donc le principal moyen d&#39;encoder et de décoder des données dans et hors du code machine.</p>
</div>
<div class="paragraph data-line-169">
<p>Dans Ethereum, l&#39;ABI est utilisé pour coder les appels de contrat pour l&#39;EVM et pour lire les données des transactions. Le but d&#39;un ABI est de définir les fonctions du contrat qui peuvent être invoquées et de décrire comment chaque fonction acceptera les arguments et renverra son résultat.</p>
</div>
<div class="paragraph data-line-171">
<p>L&#39;ABI d&#39;un contrat est spécifié sous la forme d&#39;un tableau JSON de descriptions de fonctions (voir <a href="#solidity_functions">Fonctions</a>) et événements (voir <a href="#solidity_events">Événements</a>). Une description de fonction est un objet JSON avec les champs <code>type</code>, <code>name</code>, <code>inputs</code>, <code>outputs</code>, <code>constant</code> et <code>payable</code>. Un objet de description d&#39;événement a des champs <code>type</code>, <code>name</code>, <code>inputs</code> et <code>anonymous</code>.</p>
</div>
<div class="paragraph data-line-173">
<p>Nous utilisons le compilateur Solidity en ligne de commande solc pour produire l&#39;ABI pour notre exemple de contrat <span class="keep-together"><em>Faucet.sol</em></span> :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --abi Faucet.sol</strong>
======= Faucet.sol:Faucet =======
Contract JSON ABI
[{"constant":false,"inputs":[{"name":"withdraw_amount","type":"uint256"}], \
"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable", \
"type":"function"},{"payable":true,"stateMutability":"payable", \
"type":"fallback"}]
</pre>
<div class="paragraph data-line-187">
<p>Comme vous pouvez le voir, le compilateur produit un tableau JSON décrivant les deux fonctions définies par <em>Faucet.sol</em>. Ce JSON peut être utilisé par toute application qui souhaite accéder au contrat Faucet une fois qu&#39;il est déployé. À l&#39;aide de l&#39;ABI, une application telle qu&#39;un portefeuille ou un navigateur DApp peut construire des transactions qui appellent les fonctions dans + Faucet + avec les arguments et types d&#39;arguments corrects. Par exemple, un portefeuille saura que pour appeler la fonction withdraw, il devra fournir un argument uint256 nommé withdraw_amount. Le portefeuille pourrait inviter l&#39;utilisateur à fournir cette valeur, puis à créer une transaction qui l&#39;encode et exécute la fonction retirer.</p>
</div>
<div class="paragraph data-line-189">
<p>Tout ce qui est nécessaire pour qu&#39;une application interagisse avec un contrat est un ABI et l&#39;adresse où le contrat a été déployé.</p>
</div>
<div class="sect3 data-line-192">
<h4 id="solidity_pragma">Sélection d&#39;un compilateur Solidity et d&#39;une version linguistique</h4>
<div class="paragraph data-line-194">
<p>Comme nous l&#39;avons vu dans le code précédent, notre contrat Faucet se compile avec succès avec Solidity version 0.4.21. Et si nous avions utilisé une version différente du compilateur Solidity ? Le language est toujours en constante évolution et les choses peuvent changer de manière inattendue. Notre contrat est assez simple, mais que se passerait-il si notre programme utilisait une fonctionnalité qui n&#39;a été ajoutée que dans la version 0.4.19 de Solidity et que nous essayions de la compiler avec la version 0.4.18 ?</p>
</div>
<div class="paragraph data-line-196">
<p>Pour résoudre ces problèmes, Solidity propose une <em>directive du compilateur</em> connue sous le nom de <em>version pragma</em> qui indique au compilateur que le programme attend un compilateur (et un langage) spécifique à une version. Regardons un exemple :</p>
</div>
<div id="compiler_version" class="listingblock data-line-199">
<div class="content">
<pre>pragma solidity ^0.4.19;</pre>
</div>
</div>
<div class="paragraph data-line-203">
<p>Le compilateur Solidity lit le pragma de version et génère une erreur si la version du compilateur est incompatible avec le pragma de version. Dans ce cas, notre pragma de version indique que ce programme peut être compilé par un compilateur Solidity avec une version minimale de 0.4.19. Le symbole ^ indique, cependant, que nous autorisons la compilation avec toute <em>révision mineure</em> au-dessus de 0.4.19 ; par exemple, 0.4.20, mais pas 0.5.0 (qui est une révision majeure, pas une révision mineure). Les directives Pragma ne sont pas compilées dans le code intermédiaire EVM. Ils ne sont utilisés par le compilateur que pour vérifier la compatibilité.</p>
</div>
<div class="paragraph data-line-205">
<p>Ajoutons une directive pragma à notre contrat Faucet. Nous nommerons le nouveau fichier <span class="keep-together"><em>Faucet2.sol</em></span>, pour garder une trace de nos modifications au fur et à mesure que nous avancerons dans ces exemples en commençant par <a href="#add_pragma_to_faucet">Faucet2.sol : Ajout du pragma de version à Faucet</a>.</p>
</div>
<div id="add_pragma_to_faucet" class="exampleblock data-line-209">
<div class="title">Example 2. Faucet2.sol : Ajout du pragma de version à Faucet</div>
<div class="content">
<div class="listingblock data-line-211">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity ^0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-216">
<p>L&#39;ajout d&#39;un pragma de version est une bonne pratique, car il évite les problèmes liés aux versions incompatibles du compilateur et du langage. Nous explorerons d&#39;autres bonnes pratiques et continuerons d&#39;améliorer le contrat Faucet tout au long de ce chapitre.</p>
</div>
</div>
</div>
<div class="sect2 data-line-218">
<h3 id="_programmation_avec_solidity">Programmation avec Solidity</h3>
<div class="paragraph data-line-220">
<p>Dans cette section, nous examinerons certaines des fonctionnalités du langage Solidity. Comme nous l&#39;avons mentionné dans <a href="#intro_chapter">[intro_chapter]</a>, notre premier exemple de contrat était très simple et également défectueux à plusieurs égards. Nous allons l&#39;améliorer progressivement ici, tout en explorant comment utiliser Solidity. Cependant, ce ne sera pas un didacticiel complet sur Solidity, car Solidity est assez complexe et évolue rapidement. Nous couvrirons les bases et vous donnerons suffisamment de bases pour pouvoir explorer le reste par vous-même. La documentation de Solidity se trouve
<a href="https://solidity.readthedocs.io/en/latest/" data-href="https://solidity.readthedocs.io/en/latest/">sur le site du projet</a>.</p>
</div>
<div class="paragraph data-line-223">
<p>====Types de données</p>
</div>
<div class="paragraph data-line-225">
<p>D&#39;abord, examinons certains des types de données de base proposés dans Solidity :</p>
</div>
<div class="dlist data-line-227">
<dl>
<dt class="hdlist1">Boolean (bool)</dt>
<dd>
<p>valeur booléenne, true ou false, avec les opérateurs logiques ! (not), &amp;amp;&amp;amp; (and), || (or), == (equal) et != (non égal).</p>
</dd>
<dt class="hdlist1">Integer (int, uint)</dt>
<dd>
<p>Entiers signés (int) et non signés (uint), déclarés par incréments de 8 bits de int8 à uint256. Sans suffixe de taille, des quantités de 256 bits sont utilisées pour correspondre à la taille de mot de l&#39;EVM.</p>
</dd>
<dt class="hdlist1">Fixed point (fixed, ufixed)</dt>
<dd>
<p>Nombres à virgule fixe, déclarés avec ( <code>u</code>) <code>fixed <em>M</em> x <em>N</em></code> où <em>M</em> est la taille en bits (incréments de 8 jusqu&#39;à 256) et <em>N</em> est le nombre de décimales après le point (jusqu&#39;à 18) ; par exemple, ufixed32x2.</p>
</dd>
<dt class="hdlist1">Address</dt>
<dd>
<p>Une adresse Ethereum de 20 octets. L&#39;objet address a de nombreuses fonctions membres utiles, les principales étant balance (renvoie le solde du compte) et <span class="keep-together"><code>transfer</code></span> (transfère l&#39;ether au compte).</p>
</dd>
<dt class="hdlist1">Byte array (fixe)</dt>
<dd>
<p>Tableaux d&#39;octets de taille fixe, déclarés avec bytes1 jusqu&#39;à bytes32.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-237">
<p>Byte array (dynamique):: tableaux d&#39;octets de taille variable, déclarés avec bytes ou string.</p>
</div>
<div class="dlist data-line-239">
<dl>
<dt class="hdlist1">Enum</dt>
<dd>
<p>Type défini par l&#39;utilisateur pour énumérer des valeurs discrètes : enum NAME {LABEL1, LABEL 2, ...}.</p>
</dd>
<dt class="hdlist1">Arrays</dt>
<dd>
<p>Un tableau de n&#39;importe quel type, fixe ou dynamique : uint32[][5] est un tableau de taille fixe de cinq tableaux dynamiques d&#39;entiers non signés.</p>
</dd>
<dt class="hdlist1">Struct</dt>
<dd>
<p>Conteneurs de données définis par l&#39;utilisateur pour regrouper les variables : <code>struct NAME {TYPE1 <span class="keep-together">VARIABLE1</span>; TYPE2 VARIABLE2; ...}</code>.</p>
</dd>
<dt class="hdlist1">Mapping</dt>
<dd>
<p>Tables de recherche de hachage pour les paires <em>key</em> =&amp;gt; <em>value</em> : mapping(KEY_TYPE =&amp;gt; VALUE_TYPE) NAME.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-247">
<p>En plus de ces types de données, Solidity propose également une variété de valeurs littérales qui peuvent être utilisées pour calculer différentes unités :</p>
</div>
<div class="dlist data-line-249">
<dl>
<dt class="hdlist1">Unités de temps</dt>
<dd>
<p>Les unités seconds, minutes, hours et days peuvent être utilisées comme suffixes, convertis en multiples de l&#39;unité de base seconds.</p>
</dd>
<dt class="hdlist1">Unités d&#39;ether</dt>
<dd>
<p>Les unités wei, finney, szabo et ether peuvent être utilisées comme suffixes, convertis en multiples de l&#39;unité de base wei.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-253">
<p>Dans notre exemple de contrat Faucet, nous avons utilisé un uint (qui est un alias pour uint256) pour la variable withdraw_amount. Nous avons également utilisé indirectement une variable address, que nous avons définie avec msg.sender. Nous utiliserons plus de ces types de données dans nos exemples dans le reste de ce chapitre.</p>
</div>
<div class="paragraph data-line-255">
<p>Utilisons l&#39;un des multiplicateurs d&#39;unités pour améliorer la lisibilité de notre exemple de contrat. Dans la fonction withdraw nous limitons le retrait maximum, en exprimant la limite en wei, l&#39;unité de base de l&#39;ether :</p>
</div>
<div class="listingblock data-line-257">
<div class="content">
<pre>require(withdraw_amount &lt;= 100000000000000000);</pre>
</div>
</div>
<div class="paragraph data-line-261">
<p>Ce n&#39;est pas très facile à lire. Nous pouvons améliorer notre code en utilisant le multiplicateur d&#39;unité ether, pour exprimer la valeur en ether au lieu de wei :</p>
</div>
<div class="listingblock data-line-263">
<div class="content">
<pre>require(withdraw_amount &lt;= 0.1 ether);</pre>
</div>
</div>
<div class="sect3 data-line-267">
<h4 id="_variables_et_fonctions_globales_prédéfinies">Variables et fonctions globales prédéfinies</h4>
<div class="paragraph data-line-269">
<p>Lorsqu&#39;un contrat est exécuté dans l&#39;EVM, il a accès à un petit ensemble d&#39;objets globaux. Ceux-ci incluent les objets block, msg et tx. De plus, Solidity expose un certain nombre d&#39;opcodes EVM en tant que fonctions prédéfinies. Dans cette section, nous examinerons les variables et les fonctions auxquelles vous pouvez accéder à partir d&#39;un contrat intelligent dans Solidity.</p>
</div>
<div class="sect4 data-line-271">
<h5 id="_contexte_dappel_de_transactionmessage">Contexte d&#39;appel de transaction/message</h5>
<div class="paragraph data-line-273">
<p>L&#39;objet msg est l&#39;appel de transaction (origine EOA) ou l&#39;appel de message (origine contrat) qui lancé l&#39;exécution de ce contrat. Il contient un certain nombre d&#39;attributs utiles :</p>
</div>
<div class="dlist data-line-275">
<dl>
<dt class="hdlist1">msg.sender</dt>
<dd>
<p>Nous avons déjà utilisé celui-ci. Il représente l&#39;adresse qui a lancé cet appel de contrat, pas nécessairement l&#39;EOA d&#39;origine qui a envoyé la transaction. Si notre contrat a été appelé directement par une transaction EOA, alors c&#39;est l&#39;adresse qui a signé la transaction, mais sinon ce sera une adresse de contrat.</p>
</dd>
<dt class="hdlist1">msg.value</dt>
<dd>
<p>La valeur d&#39;ether envoyée avec cet appel (en wei).</p>
</dd>
<dt class="hdlist1">msg.gas</dt>
<dd>
<p>La quantité de gaz restant dans l&#39;approvisionnement en gaz de cet environnement d&#39;exécution. Cela a été déprécié dans Solidity v0.4.21 et remplacé par la fonction gasleft.</p>
</dd>
<dt class="hdlist1">msg.data</dt>
<dd>
<p>La charge utile de données de cet appel dans notre contrat.</p>
</dd>
<dt class="hdlist1">msg.sig</dt>
<dd>
<p>Les quatre premiers octets de la charge utile de données, qui est le sélecteur de fonction.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note data-line-286">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-287">
<p>Chaque fois qu&#39;un contrat appelle un autre contrat, les valeurs de tous les attributs de msg changent pour refléter les informations du nouvel appelant. La seule exception à cela est la fonction delegatecall, qui exécute le code d&#39;un autre contrat/bibliothèque dans le <span class="keep-together">contexte</span> de msg.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-290">
<h5 id="_contexte_transactionnel">Contexte transactionnel</h5>
<div class="paragraph data-line-292">
<p>L&#39;objet tx fournit un moyen d&#39;accéder aux informations relatives à la transaction :</p>
</div>
<div class="dlist data-line-294">
<dl>
<dt class="hdlist1">tx.gasprice</dt>
<dd>
<p>Le prix du gaz dans la transaction d&#39;appel.</p>
</dd>
<dt class="hdlist1">tx.origin</dt>
<dd>
<p>L&#39;adresse de l&#39;EOA d&#39;origine pour cette transaction. ATTENTION : dangereux !</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-298">
<h5 id="_contexte_de_bloc">Contexte de bloc</h5>
<div class="paragraph data-line-300">
<p>L&#39;objet block contient des informations sur le bloc courant :</p>
</div>
<div class="dlist data-line-302">
<dl>
<dt class="hdlist1">block.blockhash(__blockNumber__)</dt>
<dd>
<p>Le hachage de bloc du numéro de bloc spécifié, jusqu&#39;à 256 blocs dans le passé. Obsolète et remplacé par la fonction blockhash dans Solidity v0.4.22.</p>
</dd>
<dt class="hdlist1">block.coinbase</dt>
<dd>
<p>L&#39;adresse du destinataire des frais du bloc actuel et de la récompense du bloc.</p>
</dd>
<dt class="hdlist1">block.difficulty</dt>
<dd>
<p>La difficulté (preuve de travail) du bloc actuel.</p>
</dd>
<dt class="hdlist1">block.gaslimit</dt>
<dd>
<p>La quantité maximale de gaz pouvant être dépensée pour toutes les transactions incluses dans le bloc actuel.</p>
</dd>
<dt class="hdlist1">block.number</dt>
<dd>
<p>Le numéro de bloc actuel (hauteur de la chaîne de blocs).</p>
</dd>
<dt class="hdlist1">block.timestamp</dt>
<dd>
<p>L&#39;horodatage placé dans le bloc actuel par le mineur (nombre de secondes depuis l&#39;époque Unix).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-315">
<h5 id="solidity_address_object">objet d&#39;adresse</h5>
<div class="paragraph data-line-317">
<p>Toute adresse, transmise en tant qu&#39;entrée ou extraite d&#39;un objet de contrat, possède un certain nombre d&#39;attributs et de méthodes :</p>
</div>
<div class="dlist data-line-319">
<dl>
<dt class="hdlist1">address.balance</dt>
<dd>
<p>Le solde de l&#39;adresse, en wei. Par exemple, le solde actuel du contrat est address(this).balance.</p>
</dd>
<dt class="hdlist1">address.transfer(__amount__)</dt>
<dd>
<p>Transfère le montant (en wei) à cette adresse, en levant une exception en cas d&#39;erreur. Nous avons utilisé cette fonction dans notre exemple Faucet comme méthode sur l&#39;adresse msg.sender, comme msg.sender.transfer.</p>
</dd>
<dt class="hdlist1">address.send(__amount__)</dt>
<dd>
<p>similaire à transfer, mais au lieu de lancer une exception, il renvoie false en cas d&#39;erreur. ATTENTION : vérifiez toujours la valeur de retour de send.</p>
</dd>
<dt class="hdlist1">address.call(__payload__)</dt>
<dd>
<p>fonction CALL de bas niveau — peut construire un appel de message arbitraire avec une charge utile de données. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT : dangereux : le destinataire peut (accidentellement ou par malveillance) utiliser tout votre gaz, provoquant l&#39;arrêt de votre contrat avec une exception OOG ; vérifiez toujours la valeur de retour de call.</p>
</dd>
<dt class="hdlist1">address.callcode(__payload__)</dt>
<dd>
<p>fonction CALLCODE de bas niveau, comme address(this).call(pass :[...]) mais avec le code de ce contrat remplacé par celui de address. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT : utilisation avancée uniquement !</p>
</dd>
<dt class="hdlist1">address.delegatecall()</dt>
<dd>
<p>Fonction DELEGATECALL de bas niveau, comme callcode(...) mais avec le contexte msg complet vu par le contrat actuel. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT : utilisation avancée uniquement !</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-331">
<h5 id="_fonctions_intégrées">Fonctions intégrées</h5>
<div class="paragraph data-line-333">
<p>Les autres fonctions à noter sont :</p>
</div>
<div class="dlist data-line-335">
<dl>
<dt class="hdlist1">addmod, mulmod</dt>
<dd>
<p>Pour l&#39;addition et la multiplication modulo. Par exemple, addmod(x,y,k) calcule (x + y) % k.</p>
</dd>
<dt class="hdlist1">keccak256, sha256, sha3, ripemd160</dt>
<dd>
<p>Fonctions pour calculer les hachages avec divers algorithmes de hachage standard.</p>
</dd>
<dt class="hdlist1">ecrecover</dt>
<dd>
<p>Récupère l&#39;adresse utilisée pour signer un message à partir de la signature.</p>
</dd>
<dt class="hdlist1">selfdestruct(__recipient_address__)</dt>
<dd>
<p>Supprime le contrat actuel, en envoyant tout ether restant dans le compte à l&#39;adresse du destinataire.</p>
</dd>
<dt class="hdlist1">this</dt>
<dd>
<p>L&#39;adresse du compte de contrat en cours d&#39;exécution.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-345">
<h4 id="_définition_du_contrat">Définition du contrat</h4>
<div class="paragraph data-line-347">
<p>Le type de données principal de Solidity est contract ; notre exemple Faucet définit simplement un objet <span class="keep-together"><code>contract</code></span>. Semblable à tout objet dans un langage orienté objet, le contrat est un conteneur qui inclut des données et des méthodes.</p>
</div>
<div class="paragraph data-line-349">
<p>Solidity propose deux autres types d&#39;objets qui s&#39;apparentent à un contrat :</p>
</div>
<div class="dlist data-line-351">
<dl>
<dt class="hdlist1">interface</dt>
<dd>
<p>Une définition d&#39;interface est structurée exactement comme un contrat, sauf qu&#39;aucune des fonctions n&#39;est définie, elles sont seulement déclarées. Ce type de déclaration est souvent appelé <em>stub</em> ou <em>souche</em> ; il vous indique les arguments des fonctions et les types de retour sans aucune implémentation. Une interface précise la « forme » d&#39;un contrat ; lorsqu&#39;elle est héritée, chacune des fonctions déclarées par l&#39;interface doit être définie par l&#39;enfant.</p>
</dd>
<dt class="hdlist1">library</dt>
<dd>
<p>Un contrat de bibliothèque est un contrat destiné à être déployé une seule fois et utilisé par d&#39;autres contrats, en utilisant la méthode delegatecall (voir <a href="#solidity_address_object">objet d&#39;adresse</a>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-356">
<h4 id="solidity_functions">Fonctions</h4>
<div class="paragraph data-line-358">
<p>Au sein d&#39;un contrat, on définit des fonctions qui peuvent être appelées par une transaction EOA ou un autre contrat. Dans notre exemple Faucet, nous avons deux fonctions : withdraw et la fonction (sans nom) <em>fallback</em>.</p>
</div>
<div class="paragraph data-line-360">
<p>La syntaxe que nous utilisons pour déclarer une fonction dans Solidity est la suivante :</p>
</div>
<pre data-type="programlisting">
function FunctionName([<em>parameters</em>]) {public|private|internal|external}
[pure|constant|view|payable] [<em>modifiers</em>] [returns (<em>return types</em>)]
</pre>
<div class="paragraph data-line-370">
<p>Examinons chacun de ces composants :</p>
</div>
<div class="dlist data-line-372">
<dl>
<dt class="hdlist1">FunctionName</dt>
<dd>
<p>Le nom de la fonction, qui est utilisé pour appeler la fonction dans une transaction (à partir d&#39;un EOA), à partir d&#39;un autre contrat, ou même à partir du même contrat. Une fonction dans chaque contrat peut être définie sans nom, auquel cas c&#39;est la fonction <em>fallback</em>, qui est appelée lorsqu&#39;aucune autre fonction n&#39;est nommée. La fonction de secours ne peut pas avoir d&#39;arguments ni rien renvoyer.</p>
</dd>
<dt class="hdlist1"><em>parameters</em></dt>
<dd>
<p>Après le nom, nous spécifions les arguments qui doivent être passés à la fonction, avec leurs noms et leurs types. Dans notre exemple Faucet, nous avons défini uint remove_amount comme le seul argument de la fonction <code><span class="keep-together">withdraw</span></code>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-376">
<p>Le prochain ensemble de mots clés (public, private, internal, external) spécifie la <em>visibilité</em> de la fonction :</p>
</div>
<div class="dlist data-line-378">
<dl>
<dt class="hdlist1">public</dt>
<dd>
<p>Public est la valeur par défaut ; ces fonctions peuvent être appelées par d&#39;autres contrats ou transactions EOA, ou depuis le contrat. Dans notre exemple Faucet, les deux fonctions sont définies comme publiques.</p>
</dd>
<dt class="hdlist1">external</dt>
<dd>
<p>Les fonctions externes sont comme des fonctions publiques, sauf qu&#39;elles ne peuvent pas être appelées depuis le contrat à moins d&#39;être explicitement préfixées avec le mot-clé this.</p>
</dd>
<dt class="hdlist1">interne </dt>
<dd>
<p>Les fonctions internes ne sont accessibles qu&#39;à partir du contrat - elles ne peuvent pas être appelées par un autre contrat ou une transaction EOA. Ils peuvent être appelés par des contrats dérivés (ceux qui héritent de celui-ci).</p>
</dd>
<dt class="hdlist1">private</dt>
<dd>
<p>Les fonctions privées sont comme des fonctions internes mais ne peuvent pas être appelées par les  <span class="keep-together">contrats</span> dérivés.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-386">
<p>Gardez à l&#39;esprit que les termes <em>internal</em> et <em>private</em> sont quelque peu trompeurs. Toute fonction ou donnée à l&#39;intérieur d&#39;un contrat est toujours <em>visible</em> sur la chaîne de blocs publique, ce qui signifie que n&#39;importe qui peut voir le code ou les données. Les mots clés décrits ici n&#39;affectent que comment et quand une fonction peut être <em>appelée</em>.</p>
</div>
<div class="paragraph data-line-388">
<p>Le deuxième ensemble de mots clés (pure, constant, view, payable) affecte le comportement de la fonction :</p>
</div>
<div class="dlist data-line-390">
<dl>
<dt class="hdlist1">constant ou view </dt>
<dd>
<p>Une fonction marquée comme <em>view</em> promet de ne modifier aucun état. Le terme <em>constant</em> est un alias pour la vue qui sera obsolète dans une future version. Pour le moment, le compilateur n&#39;applique pas le modificateur view, ne produisant qu&#39;un avertissement, mais cela devrait devenir un mot-clé appliqué dans la v0.5 de Solidity.</p>
</dd>
<dt class="hdlist1">pure</dt>
<dd>
<p>Une fonction pure est une fonction qui ne lit ni écrit aucune variable dans le stockage. Il ne peut fonctionner que sur des arguments et renvoyer des données, sans référence à aucune donnée stockée. Les fonctions pures sont destinées à encourager la programmation de style déclaratif sans effets secondaires ni état.</p>
</dd>
<dt class="hdlist1">payable</dt>
<dd>
<p>Une fonction payable est une fonction qui peut accepter des paiements entrants. Les fonctions non déclarées comme payable rejetteront les paiements entrants. Il existe deux exceptions, dues à des décisions de conception dans l&#39;EVM : les paiements coinbase et l&#39;héritage SELFDESTRUCT seront payés même si la fonction de secours n&#39;est pas déclarée comme payable, mais cela a du sens car l&#39;exécution de code ne fait pas partie de ces paiements <span class="keep-together">de toute façon</span>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-396">
<p>Comme vous pouvez le voir dans notre exemple Faucet, nous avons une fonction payante (la fonction de secours), qui est la seule fonction qui peut recevoir des paiements entrants.</p>
</div>
</div>
<div class="sect3 data-line-398">
<h4 id="_constructeur_de_contrat_et_autodestruction">Constructeur de contrat et autodestruction</h4>
<div class="paragraph data-line-400">
<p>Il existe une fonction spéciale qui n&#39;est utilisée qu&#39;une seule fois . Lorsqu&#39;un contrat est créé, il exécute également la <em>fonction constructor</em> s&#39;il en existe une, pour initialiser l&#39;état du contrat. Le constructeur est exécuté dans la même transaction que la création du contrat. La fonction constructeur est facultative ; vous remarquerez que notre exemple Faucet n&#39;en a pas.</p>
</div>
<div class="paragraph data-line-402">
<p>Les constructeurs peuvent être spécifiés de deux manières. Jusqu&#39;à et y compris dans Solidity v0.4.21, le constructeur est une fonction dont le nom correspond au nom du contrat, comme vous pouvez le voir ici :</p>
</div>
<div class="listingblock data-line-405">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract MEContract {
	function MEContract() {
// C&amp;#39;est le constructeur
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-414">
<p>La difficulté avec ce format est que si le nom du contrat est modifié et que le nom de la fonction constructeur n&#39;est pas modifié, ce n&#39;est plus un constructeur. De même, s&#39;il y a une faute de frappe accidentelle dans la dénomination du contrat et/ou du constructeur, la fonction n&#39;est plus un constructeur. Cela peut provoquer des bogues assez désagréables, inattendus et difficiles à trouver. Imaginez par exemple si le constructeur met le propriétaire du contrat à des fins de contrôle. Si la fonction n&#39;est pas réellement le constructeur en raison d&#39;une erreur de nommage, non seulement le propriétaire ne sera pas défini au moment de la création du contrat, mais la fonction peut également être déployée en tant que partie permanente et &quot;appelable&quot; du contrat, comme un fonction normale, permettant à tout tiers de détourner le contrat et d&#39;en devenir le &quot;propriétaire&quot; après la création du contrat.</p>
</div>
<div class="paragraph data-line-416">
<p>Pour résoudre les problèmes potentiels avec les fonctions constructeur basées sur le fait d&#39;avoir un nom identique à celui du contrat, Solidity v0.4.22 introduit un mot-clé constructor qui fonctionne comme une fonction constructeur mais n&#39;a pas de nom. Renommer le contrat n&#39;affecte en rien le constructeur. De plus, il est plus facile d&#39;identifier quelle fonction est le constructeur. Il ressemble à ceci :</p>
</div>
<div class="listingblock data-line-419">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma ^0.4.22
contract MEContract {
	constructor () {
// C&amp;#39;est le constructeur
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-428">
<p>Pour résumer, le cycle de vie d&#39;un contrat commence par une transaction de création à partir d&#39;un compte EOA ou un contrat. S&#39;il existe un constructeur, il est exécuté dans le cadre de la création du contrat, pour initialiser l&#39;état du contrat lors de sa création, puis est supprimé.</p>
</div>
<div class="paragraph data-line-430">
<p>L&#39;autre la fin du cycle de vie du contrat est la <em>destruction du contrat</em>. Les contrats sont détruits par un opcode EVM spécial appelé SELFDESTRUCT. Il s&#39;appelait autrefois <span class="keep-together"><code>SUICIDE</code></span>, mais ce nom a été déprécié en raison des associations négatives du mot. Dans Solidity, cet opcode est exposé sous la forme d&#39;une fonction intégrée de haut niveau appelée selfdestruct, qui prend un argument : l&#39;adresse pour recevoir tout solde d&#39;éther restant dans le compte du contrat. Il ressemble à ceci :</p>
</div>
<div class="listingblock data-line-433">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">selfdestruct(address recipient);</code></pre>
</div>
</div>
<div class="paragraph data-line-437">
<p>Notez que vous devez explicitement ajouter cette commande à votre contrat si vous voulez qu&#39;il soit supprimable - c&#39;est la seule façon de supprimer un contrat, et il n&#39;est pas présent par défaut. De cette manière, les utilisateurs d&#39;un contrat qui pourraient s&#39;attendre à ce qu&#39;un contrat soit là pour toujours peuvent être certains qu&#39;un contrat ne peut pas être supprimé s&#39;il ne contient pas d&#39;opcode <span class="keep-together"><code>SELFDESTRUCT</code></span>.</p>
</div>
</div>
<div class="sect3 data-line-439">
<h4 id="_ajout_dun_constructeur_et_autodestruction_à_notre_exemple_de_robinet">Ajout d&#39;un constructeur et autodestruction à notre exemple de robinet</h4>
<div class="paragraph data-line-441">
<p>L&#39;exemple de contrat Faucet que nous avons introduit dans <a href="#intro_chapter">[intro_chapter]</a> n&#39;a pas de constructeur ou de fonctions selfdestruct. C&#39;est un contrat éternel qui ne peut pas être supprimé. Changeons cela en ajoutant un constructeur et une fonction selfdestruct. Nous voulons probablement que selfdestruct soit appelable <em>uniquement</em> par l&#39;EOA qui a initialement créé le contrat. Par convention, ceci est généralement stocké dans une variable d&#39;adresse appelée owner. Notre constructeur définit la variable owner, et la fonction selfdestruct vérifiera d&#39;abord que le propriétaire l&#39;a appelée directement.</p>
</div>
<div class="paragraph data-line-443">
<p>Tout d&#39;abord, notre constructeur :</p>
</div>
<div class="listingblock data-line-446">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version du compilateur Solidity pour lequel ce programme a été écrit
pragma solidity ^0.4.22;

// Notre premier contrat est un robinet !
contract Faucet {

	address owner;

// Initialiser le contrat Faucet : définir le propriétaire
	constructor() {
		owner = msg.sender;
	}

[...]</code></pre>
</div>
</div>
<div class="paragraph data-line-463">
<p>Nous avons modifié la directive pragma pour spécifier la v0.4.22 comme version minimale pour cet exemple, car nous utilisons le nouveau mot-clé constructor introduit dans la v0.4.22 de Solidity. Notre contrat a maintenant une variable de type address nommée owner. Le nom &quot;owner&quot; n&#39;est en aucun cas spécial. Nous pourrions appeler cette variable d&#39;adresse &quot;potato&quot; et l&#39;utiliser toujours de la même manière. Le nom owner rend simplement son objectif clair.</p>
</div>
<div class="paragraph data-line-465">
<p>Ensuite, notre constructeur, qui s&#39;exécute dans le cadre de la transaction de création de contrat, attribue l&#39;adresse de msg.sender à la variable owner. Nous avons utilisé msg.sender dans la fonction remove pour identifier l&#39;initiateur de la demande de &lt;span class="keep-together"&gt;&lt;code&gt;withdraw&lt;/code&gt;&lt;/span&gt;. Dans le constructeur, cependant, le msg.sender est l&#39;EOA ou l&#39;adresse du contrat qui a initié la création du contrat. Nous savons que c&#39;est le cas <em>car</em> il s&#39;agit d&#39;une fonction constructeur : elle ne s&#39;exécute qu&#39;une seule fois, lors de la création du contrat.</p>
</div>
<div class="paragraph data-line-467">
<p>Nous pouvons maintenant ajouter une fonction pour détruire le contrat. Nous devons nous assurer que seul le propriétaire peut exécuter cette fonction, nous utiliserons donc une instruction require pour contrôler l&#39;accès. Voici à quoi cela ressemblera :</p>
</div>
<div class="listingblock data-line-470">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Destructeur de contrat
function destroy() public {
	require(msg.sender == owner);
	selfdestruct(owner);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-478">
<p>Si quelqu&#39;un appelle cette fonction destroy depuis une adresse autre que owner, elle échouera. Mais si la même adresse stockée dans owner par le constructeur l&#39;appelle, le contrat s&#39;autodétruira et enverra tout solde restant à l&#39;adresse owner. Notez que nous n&#39;avons pas utilisé le non sécurisé tx.origin pour déterminer si le propriétaire souhaitait détruire le contrat. L&#39;utilisation de tx.origin permettrait à des contrats malveillants de détruire votre contrat sans votre permission.</p>
</div>
</div>
<div class="sect3 data-line-480">
<h4 id="_modificateurs_de_fonction">Modificateurs de fonction</h4>
<div class="paragraph data-line-482">
<p>Solidity offre un type spécial de fonction appelé <em>modificateur de fonction</em>. Vous appliquez des modificateurs aux fonctions en ajoutant le nom du modificateur dans la déclaration de la fonction. Les modificateurs sont le plus souvent utilisés pour créer des conditions qui s&#39;appliquent à de nombreuses fonctions au sein d&#39;un contrat. Nous avons déjà une instruction de contrôle d&#39;accès dans notre fonction destroy. Créons un modificateur de fonction qui exprime cette condition :</p>
</div>
<div class="listingblock data-line-485">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">modifier onlyOwner {
    require(msg.sender == owner);
    _;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-493">
<p>Ce modificateur de fonction, nommé onlyOwner, définit une condition sur toute fonction qu&#39;il modifie, exigeant que l&#39;adresse stockée en tant que owner du contrat soit la même que l&#39;adresse du msg.sender de la transaction. Il s&#39;agit du modèle de conception de base pour le contrôle d&#39;accès, permettant uniquement au propriétaire d&#39;un contrat d&#39;exécuter toute fonction qui a le modificateur onlyOwner.</p>
</div>
<div class="paragraph data-line-495">
<p>Vous avez peut-être remarqué que notre modificateur de fonction contient un &quot;espace réservé&quot; syntaxique particulier, un trait de soulignement suivi d&#39;un point-virgule (_;). Cet espace réservé est remplacé par le code de la fonction en cours de modification. Essentiellement, le modificateur est &quot;enroulé autour&quot; de la fonction modifiée, plaçant son code à l&#39;emplacement identifié par le caractère de soulignement.</p>
</div>
<div class="paragraph data-line-497">
<p>Pour appliquer un modificateur, vous ajoutez son nom à la déclaration de la fonction. Plusieurs modificateurs peuvent être appliqués à une fonction ; ils sont appliqués dans l&#39;ordre dans lequel ils sont déclarés, sous forme de liste séparée par des virgules.</p>
</div>
<div class="paragraph data-line-499">
<p>Réécrivons notre fonction destroy pour utiliser le modificateur onlyOwner :</p>
</div>
<div class="listingblock data-line-502">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function destroy() public onlyOwner {
    selfdestruct(owner);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-508">
<p>Le nom du modificateur de fonction (onlyOwner) se trouve après le mot-clé public et nous indique que la fonction destroy est modifiée par le modificateur onlyOwner. Essentiellement, vous pouvez lire cela comme &quot;Seul le propriétaire peut détruire ce contrat&quot;. En pratique, le code résultant équivaut à &quot;envelopper&quot; le code de onlyOwner autour de destroy.</p>
</div>
<div class="paragraph data-line-510">
<p>Les modificateurs de fonction sont un outil extrêmement utile car ils nous permettent d&#39;écrire des conditions préalables pour les fonctions et de les appliquer de manière cohérente, ce qui rend le code plus facile à lire et, par conséquent, plus facile à auditer pour la sécurité. Ils sont le plus souvent utilisés pour le contrôle d&#39;accès, mais ils sont assez polyvalents et peuvent être utilisés à diverses autres fins.</p>
</div>
<div class="paragraph data-line-512">
<p>A l&#39;intérieur d&#39;un modificateur, vous pouvez accéder à toutes les valeurs (variables et arguments) visibles par la fonction modifiée. Dans ce cas, nous pouvons accéder à la variable owner, qui est déclarée dans le contrat. Cependant, l&#39;inverse n&#39;est pas vrai : vous ne pouvez accéder à aucune des variables du modificateur à l&#39;intérieur de la fonction modifiée.</p>
</div>
</div>
<div class="sect3 data-line-514">
<h4 id="_héritage_du_contrat">Héritage du contrat</h4>
<div class="paragraph data-line-516">
<p>L&#39;objet contract de Solidity prend en charge l'<em>héritage</em>, qui est un mécanisme permettant d&#39;étendre un contrat de base avec des fonctionnalités supplémentaires. Pour utiliser l&#39;héritage, spécifiez un contrat parent avec le mot-clé is :</p>
</div>
<div class="listingblock data-line-519">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Child is Parent {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-525">
<p>Avec cette construction, le contrat Child hérite de toutes les méthodes, fonctionnalités et variables de Parent. Solidity prend également en charge l&#39;héritage multiple, qui peut être spécifié par des noms de contrat séparés par des virgules après le mot-clé is :</p>
</div>
<div class="listingblock data-line-528">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Child is Parent1, Parent2 {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-534">
<p>L&#39;héritage de contrat nous permet d&#39;écrire nos contrats de manière à atteindre la modularité, l&#39;extensibilité et la réutilisation. Nous commençons par des contrats simples et implémentons les capacités les plus génériques, puis nous les étendons en héritant de ces capacités dans des contrats plus spécialisés.</p>
</div>
<div class="paragraph data-line-536">
<p>Dans notre contrat Faucet, nous avons introduit le constructeur et le destructeur, ainsi qu&#39;un contrôle d&#39;accès pour un propriétaire, assigné à la construction. Ces capacités sont assez génériques : de nombreux contrats en auront. Nous pouvons les définir comme des contrats génériques, puis utiliser l&#39;héritage pour les étendre au contrat Faucet.</p>
</div>
<div class="paragraph data-line-538">
<p>Nous commençons par définir un contrat de base owned, qui a une variable owner, en la définissant dans le constructeur du contrat :</p>
</div>
<div class="listingblock data-line-541">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract owned {
	address owner;

// Constructeur de contrat : définit le propriétaire
	constructor() {
		owner = msg.sender;
	}

// Modificateur de contrôle d&amp;#39;accès
	modifier onlyOwner {
	    require(msg.sender == owner);
	    _;
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-558">
<p>Ensuite, nous définissons un contrat de base mortal, qui hérite de owned :</p>
</div>
<div class="listingblock data-line-561">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract mortal is owned {
	// Contract destructor
	function destroy() public onlyOwner {
		selfdestruct(owner);
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-570">
<p>Comme vous pouvez le voir, le contrat mortal peut utiliser le modificateur de fonction onlyOwner, défini dans owned. Il utilise aussi indirectement la variable d&#39;adresse owner et le constructeur défini dans owned. L&#39;héritage rend chaque contrat plus simple et axé sur sa fonctionnalité spécifique, nous permettant de gérer les détails de manière modulaire.</p>
</div>
<div class="paragraph data-line-572">
<p>Nous pouvons maintenant étendre davantage le contrat owned, en héritant de ses capacités dans Faucet :</p>
</div>
<div class="listingblock data-line-575">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet is mortal {
// Donnez de l&amp;#39;éther à quiconque demande
    function withdraw(uint withdraw_amount) public {
// Limiter le montant du retrait
        require(withdraw_amount &lt;= 0.1 ether);
// Envoie le montant à l&amp;#39;adresse qui l&amp;#39;a demandé
        msg.sender.transfer(withdraw_amount);
    }
// Accepte tout montant entrant
    function () external payable {}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-589">
<p>En héritant de mortal, qui à son tour hérite de owned, le contrat Faucet a maintenant les fonctions constructeur et destroy, et un propriétaire défini. La fonctionnalité est la même que lorsque ces fonctions étaient dans Faucet, mais maintenant nous pouvons réutiliser ces fonctions dans d&#39;autres contrats sans les réécrire. La réutilisation et la modularité du code rendent notre code plus propre, plus facile à lire et plus facile à auditer.</p>
</div>
</div>
<div class="sect3 data-line-591">
<h4 id="_gestion_des_erreurs_assert_require_revert">Gestion des erreurs (assert, require, revert)</h4>
<div class="paragraph data-line-593">
<p>Un appel de contrat peut se terminer et renvoyer une erreur. La gestion des erreurs dans Solidity est gérée par quatre fonctions : assert, require, revert et throw (désormais obsolète).</p>
</div>
<div class="paragraph data-line-595">
<p>Lorsqu&#39;un contrat se termine avec une erreur, tous les changements d&#39;état (changements de variables, de soldes, etc.) sont annulés, tout au long de la chaîne d&#39;appels de contrat si plusieurs contrats ont été appelés. Cela garantit que les transactions sont <em>atomiques</em>, ce qui signifie qu&#39;elles se terminent avec succès ou n&#39;ont aucun effet sur l&#39;état et sont entièrement annulées.</p>
</div>
<div class="paragraph data-line-597">
<p>Les fonctions assert et require fonctionnent de la même manière, évaluant une condition et arrêtant l&#39;exécution avec une erreur si la condition c&#39;est fausse. Par convention, assert est utilisé lorsque le résultat est censé être vrai, ce qui signifie que nous utilisons assert pour tester les conditions internes. Par comparaison, require est utilisé lors du test d&#39;entrées (telles que des arguments de fonction ou des champs de transaction), définissant nos attentes pour ces <span class="keep-together">conditions</span>.</p>
</div>
<div class="paragraph data-line-599">
<p>Nous avons utilisé require dans notre modificateur de fonction onlyOwner, pour tester que l&#39;expéditeur du message est le propriétaire du contrat :</p>
</div>
<div class="listingblock data-line-602">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(msg.sender == owner);</code></pre>
</div>
</div>
<div class="paragraph data-line-606">
<p>La fonction require agit comme une <em>condition d&#8217;entrée</em>, empêchant l&#39;exécution du reste de la fonction et produisant une erreur si elle n&#39;est pas satisfaite.</p>
</div>
<div class="paragraph data-line-608">
<p>Depuis Solidity v0.4.22, require peut également inclure un message texte utile qui peut être utilisé pour indiquer la raison de l&#39;erreur. Le message d&#39;erreur est enregistré dans le journal des transactions. Ainsi, nous pouvons améliorer notre code en ajoutant un message d&#39;erreur dans notre fonction require :</p>
</div>
<div class="listingblock data-line-611">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(msg.sender == owner, &amp;quot;Seul le propriétaire du contrat peut appeler cette fonction&amp;quot;);</code></pre>
</div>
</div>
<div class="paragraph data-line-615">
<p>Les fonctions revert et throw interrompent l&#39;exécution du contrat et annulent tout changement d&#39;état. La fonction throw est obsolète et sera supprimée dans les futures versions de Solidity ; vous devriez utiliser revert à la place. La fonction revert peut également prendre un message d&#39;erreur comme seul argument, qui est enregistré dans le journal des transactions.</p>
</div>
<div class="paragraph data-line-617">
<p>Certaines conditions d&#39;un contrat généreront des erreurs, que nous les vérifiions explicitement ou non. Par exemple, dans notre contrat Faucet, nous ne vérifions pas s&#39;il y a suffisamment d&#39;éther pour satisfaire une demande de retrait. En effet, la fonction transfer échouera avec une erreur et annulera la transaction si le solde est insuffisant pour effectuer le transfert :</p>
</div>
<div class="listingblock data-line-620">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-624">
<p>Cependant, il peut être préférable de vérifier explicitement et de fournir un message d&#39;erreur clair en cas d&#39;échec. Nous pouvons le faire en ajoutant une instruction require avant le transfert :</p>
</div>
<div class="listingblock data-line-627">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(this.balance &gt;= withdraw_amount,
&amp;quot;Solde insuffisant dans le robinet pour la demande de retrait&amp;quot; );
msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-633">
<p>Un code de vérification d&#39;erreur supplémentaire comme celui-ci augmentera légèrement la consommation de gaz, mais il offre un meilleur rapport d&#39;erreur que s&#39;il est omis. Vous devrez trouver le bon équilibre entre la consommation de gaz et la vérification détaillée des erreurs en fonction de l&#39;utilisation prévue de votre contrat. Dans le cas d&#39;un contrat Faucet destiné à un testnet, nous pouvons probablement abuser du côté des rapports supplémentaires même si cela coûte plus cher en gaz. Peut-être que pour un contrat de réseau principal, nous choisirons plutôt d&#39;être économes avec notre consommation de gaz.</p>
</div>
</div>
<div class="sect3 data-line-636">
<h4 id="solidity_events">Événements</h4>
<div class="paragraph data-line-638">
<p>Lorsque une transaction se termine (avec succès ou non), elle produit une <em>réception de transaction</em>, comme nous le verrons dans <a href="#evm_chapter">[evm_chapter]</a>. Le reçu de transaction contient des entrées <em>log</em> qui fournissent des informations sur les actions qui se sont produites lors de l&#39;exécution de la transaction. Les <em>Événements</em> ou <em>Events</em> sont les objets de haut niveau de Solidity utilisés pour construire ces journaux.</p>
</div>
<div class="paragraph data-line-640">
<p>Les événements sont particulièrement utiles pour les clients légers et les services DApp, qui peuvent &quot;surveiller&quot; des événements spécifiques et les signaler à l&#39;interface utilisateur, ou modifier l&#39;état de l&#39;application pour refléter un événement dans un contrat sous-jacent.</p>
</div>
<div class="paragraph data-line-642">
<p>Les objets d&#39;événement prennent des arguments qui sont sérialisés et enregistrés dans les journaux de transactions, dans la chaîne de blocs. Vous pouvez fournir le mot-clé indexé avant un argument, pour que la valeur fasse partie d&#39;une table indexée (table de hachage) qui peut être recherchée ou filtrée par une application.</p>
</div>
<div class="paragraph data-line-644">
<p>Nous n&#39;avons ajouté aucun événement dans notre exemple Faucet jusqu&#39;à présent, alors faisons cela. Nous ajouterons deux événements, un pour enregistrer les retraits et un pour enregistrer les dépôts. Nous appellerons ces événements Withdrawal et Deposit, respectivement. Tout d&#39;abord, nous définissons les événements dans le contrat Faucet :</p>
</div>
<div class="listingblock data-line-647">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet is mortal {
	event Withdrawal(address indexed to, uint amount);
	event Deposit(address indexed from, uint amount);

	[...]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-656">
<p>Nous avons choisi de rendre les adresses indexed, pour permettre la recherche et le filtrage dans n&#39;importe quelle interface utilisateur conçue pour accéder à notre Faucet.</p>
</div>
<div class="paragraph data-line-658">
<p>Ensuite, nous utilisons le mot-clé emit pour incorporer les données d&#39;événement dans les journaux de transactions :</p>
</div>
<div class="listingblock data-line-661">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Donnez de l&amp;#39;éther à quiconque demande
function withdraw(uint withdraw_amount) public {
    [...]
    msg.sender.transfer(withdraw_amount);
    emit Withdrawal(msg.sender, withdraw_amount);
}
// Accepte tout montant entrant
function () external payable {
    emit Deposit(msg.sender, msg.value);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-674">
<p>Le contrat <em>Faucet.sol</em> résultant ressemble à <a href="#Faucet8_sol">Faucet8.sol : contrat de robinet révisé, avec événements</a>.</p>
</div>
<div id="Faucet8_sol" class="exampleblock data-line-678">
<div class="title">Example 3. Faucet8.sol : contrat de robinet révisé, avec événements</div>
<div class="content">
<div class="listingblock data-line-680">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity ^0.6.4;

contract Owned {
    address payable owner;

    // Contract constructor: set owner
    constructor() public {
        owner = msg.sender;
    }

    // Access control modifier
    modifier onlyOwner {
        require(msg.sender == owner, "Only the contract owner can call this function");
        _;
    }
}

contract Mortal is Owned {
    // Contract destructor
    function destroy() public onlyOwner {
        selfdestruct(owner);
    }
}

contract Faucet is Mortal {
    event Withdrawal(address indexed to, uint amount);
    event Deposit(address indexed from, uint amount);

    // Accept any incoming amount
    receive() external payable {
        emit Deposit(msg.sender, msg.value);
    }

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 0.1 ether);

        require(
            address(this).balance &gt;= withdraw_amount,
            "Insufficient balance in faucet for withdrawal request"
        );

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);

        emit Withdrawal(msg.sender, withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4 data-line-685">
<h5 id="_attraper_des_événements">Attraper des événements</h5>
<div class="paragraph data-line-687">
<p>OK, nous avons donc configuré notre contrat pour émettre des événements. Comment voir les résultats d&#39;une transaction et &quot;attraper&quot; les événements ? La bibliothèque web3.js fournit une structure de données qui contient les journaux d&#39;une transaction. Dans ceux-ci, nous pouvons voir les événements générés par la transaction.</p>
</div>
<div class="paragraph data-line-689">
<p>Utilisons truffle pour exécuter une transaction de test sur le contrat Faucet révisé. Suivez les instructions dans <a href="#truffle">[truffle]</a> pour configurer un répertoire de projet et compiler le code <span class="keep-together"><code>Faucet</code></span>. Le code source peut être trouvé dans <a href="https://github.com/ethereumbook/ethereumbook" class="undefined" data-href="https://github.com/ethereumbook/ethereumbook">https://github.com/ethereumbook/ethereumbook</a> [le référentiel GitHub du livre] sous <em>code/truffle/FaucetEvents</em>.</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle develop</strong>
truffle(develop)> <strong>compile</strong>
truffle(develop)> <strong>migrate</strong>
Using network 'develop'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb77ceae7c3f5afb7fbe3a6c5974d352aa844f53f955ee7d707ef6f3f8e6b4e61
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Faucet...
  ... 0xfa850d754314c3fb83f43ca1fa6ee20bc9652d891c00a2f63fd43ab5bfb0d781
  Faucet: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

truffle(develop)> <strong>Faucet.deployed().then(i => {FaucetDeployed = i})</strong>
truffle(develop)> <strong>FaucetDeployed.send(web3.utils.toWei(1, "ether")).then(res => \
                  { console.log(res.logs[0].event, res.logs[0].args) })</strong>
Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }
truffle(develop)> <strong>FaucetDeployed.withdraw(web3.utils.toWei(0.1, "ether")).then(res => \
                  { console.log(res.logs[0].event, res.logs[0].args) })</strong>
Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }
</pre>
<div class="paragraph data-line-725">
<p>Après avoir déployé le contrat à l&#39;aide de la fonction deployed, nous exécutons deux transactions. La première transaction est un dépôt (en utilisant send), qui émet un événement Deposit dans les journaux de transactions :</p>
</div>
<div class="listingblock data-line-727">
<div class="content">
<pre>Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }</pre>
</div>
</div>
<div class="paragraph data-line-732">
<p>Ensuite, nous utilisons la fonction withdraw pour effectuer un retrait. Cela émet un événement Withdrawal :</p>
</div>
<div class="listingblock data-line-734">
<div class="content">
<pre>Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }</pre>
</div>
</div>
<div class="paragraph data-line-739">
<p>Pour obtenir ces événements, nous avons examiné le tableau logs renvoyé comme résultat (res) des transactions. La première entrée de journal (logs[0]) contient un nom d&#39;événement dans logs[0].event et les arguments d&#39;événement dans logs[0].args. En les affichant sur la console, nous pouvons voir le nom de l&#39;événement émis et les arguments de l&#39;événement.</p>
</div>
<div class="paragraph data-line-741">
<p>Les événements sont un mécanisme très utile, non seulement pour la communication intra-contrat, mais aussi pour le débogage pendant le développement.</p>
</div>
</div>
</div>
<div class="sect3 data-line-743">
<h4 id="_appel_dautres_contrats_send_call_callcode_delegatecall">Appel d&#39;autres contrats (send, call, callcode, delegatecall)</h4>
<div class="paragraph data-line-745">
<p>Appeler d&#39;autres contrats depuis votre contrat est une opération très utile mais potentiellement dangereuse. Nous examinerons les différentes façons d&#39;y parvenir et évaluerons les risques de chaque méthode. En bref, les risques découlent du fait que vous ne savez peut-être pas grand-chose sur un contrat auquel vous faites appel ou qui fait appel à votre contrat. Lors de la rédaction de contrats intelligents, vous devez garder à l&#39;esprit que même si vous vous attendez principalement à traiter avec des EOA, rien n&#39;empêche des contrats arbitrairement complexes et peut-être malveillants d&#39;appeler et d&#39;être appelés par votre code.</p>
</div>
<div class="sect4 data-line-747">
<h5 id="_création_dune_nouvelle_instance">Création d&#39;une nouvelle instance</h5>
<div class="paragraph data-line-749">
<p>Le moyen le plus sûr d&#39;appeler un autre contrat est de créer vous-même cet autre contrat. De cette façon, vous êtes certain de ses interfaces et de son comportement. Pour ce faire, vous pouvez simplement l&#39;instancier, en utilisant le mot-clé new, comme dans d&#39;autres langages orientés objet. Dans Solidity, le mot-clé new créera le contrat sur la chaîne de blocs et renverra un objet que vous pourrez utiliser pour le référencer. Supposons que vous souhaitiez créer et appeler un contrat Faucet à partir d&#39;un autre contrat appelé Token :</p>
</div>
<div class="listingblock pagebreak-before data-line-753">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-763">
<p>Ce mécanisme de construction de contrat garantit que vous connaissez le type exact du contrat et son interface. Le contrat Faucet doit être défini dans la portée de Token, ce que vous pouvez faire avec une instruction import si la définition se trouve dans un autre fichier :</p>
</div>
<div class="listingblock data-line-766">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-778">
<p>Vous pouvez éventuellement spécifier la value du transfert d&#39;ether lors de la création et passer des arguments au constructeur du nouveau contrat :</p>
</div>
<div class="listingblock data-line-781">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-793">
<p>Vous pouvez également appeler ensuite les fonctions Faucet. Dans cet exemple, nous appelons la fonction destroy de Faucet depuis la fonction destroy de Token :</p>
</div>
<div class="listingblock data-line-796">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}

	function destroy() ownerOnly {
		_faucet.destroy();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-812">
<p>Notez que tant que vous êtes le propriétaire du contrat Token, le contrat Token lui-même possède le nouveau contrat Faucet, donc seul le contrat Token peut le détruire.</p>
</div>
</div>
<div class="sect4 data-line-814">
<h5 id="_adressage_dune_instance_existante">Adressage d&#39;une instance existante</h5>
<div class="paragraph data-line-816">
<p>Une autre façon d&#39;appeler un contrat consiste à convertir l&#39;adresse d&#39;une instance existante du contrat. Avec cette méthode, vous appliquez une interface connue à une instance existante. Il est donc extrêmement important que vous sachiez avec certitude que l&#39;instance à laquelle vous vous adressez est en fait du type que vous supposez. Regardons un exemple :</p>
</div>
<div class="listingblock data-line-819">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {

	Faucet _faucet;

	constructor(address _f) {
		_faucet = Faucet(_f);
		_faucet.withdraw(0.1 ether)
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-833">
<p>Ici, nous prenons une adresse fournie comme argument au constructeur, _f, et nous la transformons en un objet Faucet. C&#39;est beaucoup plus risqué que le mécanisme précédent, car nous ne savons pas avec certitude si cette adresse est réellement un objet Faucet. Lorsque nous appelons withdraw, nous supposons qu&#39;il accepte les mêmes arguments et exécute le même code que notre déclaration Faucet, mais nous ne pouvons pas en être sûrs. Pour autant que nous sachions, la fonction withdraw à cette adresse pourrait exécuter quelque chose de complètement différent de ce que nous attendons, même si elle porte le même nom. Utiliser des adresses passées en entrée et les intégrer dans des objets spécifiques est donc beaucoup plus dangereux que de créer soi-même le contrat.</p>
</div>
</div>
<div class="sect4 data-line-835">
<h5 id="_appel_brut_call_et_delegatecall">Appel brut call et delegatecall</h5>
<div class="paragraph data-line-837">
<p>Solidity propose des fonctions encore plus &quot;de bas niveau&quot; pour appeler d&#39;autres contrats. Ceux-ci correspondent directement aux opcodes EVM du même nom et nous permettent de construire manuellement un appel de contrat à contrat. En tant que tels, ils représentent les mécanismes les plus flexibles <em>et</em> les plus dangereux pour appeler d&#39;autres contrats.</p>
</div>
<div class="paragraph data-line-839">
<p>Voici le même exemple, en utilisant une méthode call :</p>
</div>
<div class="listingblock data-line-842">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	constructor(address _faucet) {
		_faucet.call("withdraw", 0.1 ether);
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-850">
<p>Comme vous pouvez le voir, ce type de call est un appel <em>aveugle</em> dans une fonction, un peu comme la construction d&#39;une transaction brute, uniquement à partir du contexte d&#39;un contrat. Cela peut exposer votre contrat à un certain nombre de risques de sécurité, le plus important étant la <em>réentrance</em>, dont nous discuterons plus en détail dans <a href="#reentrancy_security">[reentrancy_security]</a>. La fonction call renverra false s&#39;il y a un problème, vous pouvez donc évaluer la valeur de retour pour la gestion des erreurs :</p>
</div>
<div class="listingblock data-line-853">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	constructor(address _faucet) {
		if !(_faucet.call("withdraw", 0.1 ether)) {
			revert("Withdrawal from faucet failed");
		}
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-863">
<p>Une autre variante de call est delegatecall, qui a remplacé le plus dangereux callcode. La méthode <code><span class="keep-together">callcode</span></code> sera bientôt obsolète, elle ne doit donc pas être utilisée.</p>
</div>
<div class="paragraph data-line-865">
<p>Comme mentionné dans <a href="#solidity_address_object">objet d&#39;adresse</a>, un delegatecall est différent d&#39;un call en ce que le contexte msg ne change pas. Par exemple, alors qu&#39;un call change la valeur de msg.sender pour être le contrat d&#39;appel, un delegatecall conserve le même msg.sender que dans le contrat d&#39;appel. Essentiellement, delegatecall exécute le code d&#39;un autre contrat dans le contexte de l&#39;exécution du contrat en cours. Il est le plus souvent utilisé pour invoquer du code à partir d&#39;une bibliothèque. Cela vous permet également de dessiner sur le modèle d&#39;utilisation des fonctions de bibliothèque stockées ailleurs, mais de faire fonctionner ce code avec les données de stockage de votre contrat.</p>
</div>
<div class="paragraph data-line-867">
<p>L&#39;appel delegate doit être utilisé avec beaucoup de prudence. Cela peut avoir des effets inattendus, surtout si le contrat que vous appelez n&#39;a pas été conçu comme une bibliothèque.</p>
</div>
<div class="paragraph data-line-869">
<p>Utilisons un exemple de contrat pour démontrer les différentes sémantiques d&#39;appel utilisées par call et delegatecall pour appeler des bibliothèques et des contrats. Dans &lt;&lt;call_examples_code&gt; &gt;, nous utilisons un événement pour enregistrer les détails de chaque appel et voir comment le contexte d&#39;appel change en fonction du type d&#39;appel.</p>
</div>
<div id="call_examples_code" class="exampleblock data-line-873">
<div class="title">Example 4. CallExamples.sol : un exemple de différentes sémantiques d&#39;appel</div>
<div class="content">
<div class="listingblock data-line-875">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.22;

contract calledContract {
    event callEvent(address sender, address origin, address from);
    function calledFunction() public {
        emit callEvent(msg.sender, tx.origin, this);
    }
}

library calledLibrary {
    event callEvent(address sender, address origin,  address from);
    function calledFunction() public {
        emit callEvent(msg.sender, tx.origin, this);
    }
}

contract caller {

    function make_calls(calledContract _calledContract) public {

    // Calling calledContract and calledLibrary directly
    _calledContract.calledFunction();
    calledLibrary.calledFunction();

    // Low-level calls using the address object for calledContract
    require(address(_calledContract).
            call(bytes4(keccak256("calledFunction()"))));
    require(address(_calledContract).
            delegatecall(bytes4(keccak256("calledFunction()"))));



	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-880">
<p>Comme vous pouvez le voir dans cet exemple, notre contrat principal est caller, qui appelle une bibliothèque calledLibrary et un contrat calledContract. La bibliothèque appelée et le contrat ont des fonctions calledFunction identiques, qui émettent un événement calledEvent. L&#39;événement calledEvent enregistre trois éléments de données : msg.sender, tx.origin et this. Chaque fois que calledFunction est appelé, il peut avoir un contexte d&#39;exécution différent (avec des valeurs différentes pour potentiellement toutes les variables de contexte), selon qu&#39;il est appelé directement ou via delegatecall.</p>
</div>
<div class="paragraph data-line-882">
<p>Dans caller, nous appelons d&#39;abord le contrat et la bibliothèque directement, en invoquant calledFunction dans chacun. Ensuite, nous utilisons explicitement les fonctions de bas niveau call et delegatecall pour appeler calledContract.calledFunction. De cette façon, nous pouvons voir comment les différents mécanismes d&#39;appel se comportent.</p>
</div>
<div class="paragraph data-line-884">
<p>Exécutons ceci dans un environnement de développement Truffle et capturons les événements, pour voir à quoi cela ressemble :</p>
</div>
<pre data-type="programlisting">
truffle(develop)> <strong>migrate</strong>
Using network 'develop'.
[...]
Saving artifacts...
truffle(develop)> <strong>web3.eth.accounts[0]</strong>
'0x627306090abab3a6e1400e9345bc60c78a8bef57'
truffle(develop)> <strong>caller.address</strong>
'0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'
truffle(develop)> <strong>calledContract.address</strong>
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'
truffle(develop)> <strong>calledLibrary.address</strong>
'0xf25186b5081ff5ce73482ad761db0eb0d25abfbf'
truffle(develop)> <strong>caller.deployed().then( i => { callerDeployed = i })</strong>

truffle(develop)> <strong>callerDeployed.make_calls(calledContract.address).then(res => \
                  { res.logs.forEach( log => { console.log(log.args) })})</strong>
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }
</pre>
<div class="paragraph data-line-919">
<p>Voyons ce qui s&#39;est passé ici. Nous avons appelé la fonction make_calls et passé l&#39;adresse de calledContract, puis avons intercepté les quatre événements émis par chacun des différents appels. Examinons la fonction make_calls et passons en revue chaque étape.</p>
</div>
<div class="paragraph data-line-921">
<p>Le premier appel est :</p>
</div>
<div class="listingblock data-line-923">
<div class="content">
<pre>_calledContract.calledFunction();</pre>
</div>
</div>
<div class="paragraph data-line-927">
<p>Ici, nous appelons calledContract.calledFunction directement, en utilisant l&#39;ABI de haut niveau pour calledFunction. L&#39;événement émis est :</p>
</div>
<div class="listingblock data-line-929">
<div class="content">
<pre>sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10'</pre>
</div>
</div>
<div class="paragraph data-line-935">
<p>Comme vous pouvez le voir, msg.sender est l&#39;adresse du contrat caller. Le tx.origin est l&#39;adresse de notre compte, web3.eth.accounts[0], qui a envoyé la transaction à caller. L&#39;événement a été émis par calledContract, comme nous pouvons le voir sur le dernier argument de l&#39;événement.</p>
</div>
<div class="paragraph data-line-937">
<p>Le prochain appel dans make_calls est vers la bibliothèque :</p>
</div>
<div class="listingblock data-line-939">
<div class="content">
<pre>calledLibrary.calledFunction();</pre>
</div>
</div>
<div class="paragraph data-line-943">
<p>Il semble identique à la façon dont nous avons appelé le contrat, mais se comporte très différemment. Regardons le second événement émis :</p>
</div>
<div class="listingblock data-line-945">
<div class="content">
<pre>sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'</pre>
</div>
</div>
<div class="paragraph data-line-951">
<p>Cette fois, le msg.sender n&#39;est pas l&#39;adresse de caller. Au lieu de cela, c&#39;est l&#39;adresse de notre compte, et c&#39;est la même que l&#39;origine de la transaction. En effet, lorsque vous appelez une bibliothèque, l&#39;appel est toujours delegatecall et s&#39;exécute dans le contexte de l&#39;appelant. Ainsi, lorsque le code calledLibrary s&#39;exécutait, il héritait du contexte d&#39;exécution de caller, comme si son code s&#39;exécutait à l&#39;intérieur de caller. La variable this (affichée comme from dans l&#39;événement émis) est l&#39;adresse de caller, même si elle est accessible depuis <span class="keep-together"><code>calledLibrary</code></span>.</p>
</div>
<div class="paragraph data-line-953">
<p>Les deux appels suivants, utilisant les appels call et delegatecall de bas niveau, vérifient nos attentes, émettant des événements qui reflètent ce que nous venons de faire</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-956">
<h3 id="gas_sec">Considérations sur le gaz</h3>
<div class="paragraph data-line-958">
<p>Le gaz, décrit dans plus de détails dans <a href="#gas">[gas]</a>, est une considération extrêmement importante dans la programmation de contrats intelligents. Le gaz est une ressource limitant la quantité maximale de calculs qu&#39;Ethereum permettra à une transaction de consommer. Si la limite de gaz est dépassée pendant le calcul, la série d&#39;événements suivante se produit :</p>
</div>
<div class="ulist data-line-960">
<ul>
<li class="data-line-960">
<p>Une exception &quot;out of gas&quot; est levée.</p>
</li>
<li class="data-line-961">
<p>L&#39;état du contrat avant l&#39;exécution est restauré (inversé).</p>
</li>
<li class="data-line-962">
<p>Tout l&#39;éther utilisé pour payer le gaz est considéré comme des frais de transaction ; il n&#39;est <em>pas</em> remboursé.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-964">
<p>Étant donné que le gaz est payé par l&#39;utilisateur qui initie la transaction, les utilisateurs sont découragés d&#39;appeler des fonctions qui ont un coût de gaz élevé. Il est donc dans l&#39;intérêt du programmeur de minimiser le coût en gaz des fonctions d&#39;un contrat. À cette fin, certaines pratiques sont recommandées lors de la construction de contrats intelligents, afin de minimiser le coût en gaz d&#39;un appel de fonction.</p>
</div>
<div class="sect3 data-line-966">
<h4 id="_évitez_les_tableaux_dimensionnés_dynamiquement">Évitez les tableaux dimensionnés dynamiquement</h4>
<div class="paragraph data-line-968">
<p>Toute boucle à travers un tableau de taille dynamique où une fonction effectue des opérations sur chaque élément ou recherche un élément particulier introduit le risque d&#39;utiliser trop de gaz. En effet, le contrat peut s&#39;essouffler avant d&#39;avoir trouvé le résultat souhaité, ou avant d&#39;agir sur chaque élément, perdant ainsi du temps et de l&#39;éther sans donner le moindre résultat.</p>
</div>
</div>
<div class="sect3 data-line-970">
<h4 id="_évitez_les_appels_vers_dautres_contrats">Évitez les appels vers d&#39;autres contrats</h4>
<div class="paragraph data-line-972">
<p>Appeler d&#39;autres contrats, surtout lorsque le coût en gaz de leurs fonctions n&#39;est pas connu, introduit le risque de manquer de gaz. Évitez d&#39;utiliser des bibliothèques qui ne sont pas bien testées et largement utilisées. Moins une bibliothèque a été examinée par d&#39;autres programmeurs, plus le risque de l&#39;utiliser est grand.</p>
</div>
</div>
<div class="sect3 data-line-974">
<h4 id="_estimation_du_coût_du_gaz">Estimation du coût du gaz</h4>
<div class="paragraph data-line-976">
<p>Si vous avez besoin d&#39;estimer le gaz nécessaire pour exécuter une certaine méthode d&#39;un contrat en tenant compte ses arguments, vous pouvez utiliser la procédure suivante :</p>
</div>
<div class="listingblock data-line-979">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var contract = web3.eth.contract(abi).at(address);
var gasEstimate = contract.myAweSomeMethod.estimateGas(arg1, arg2,
    {from: account});</code></pre>
</div>
</div>
<div class="paragraph data-line-983">
<p>gasEstimate vous indiquera le nombre d&#39;unités de gaz nécessaires à son exécution. Il s&#39;agit d&#39;une estimation en raison de l&#39;exhaustivité de Turing de l&#39;EVM - il est relativement trivial de créer une fonction qui prendra des quantités de gaz très différentes pour exécuter différents appels. Même le code de production peut modifier les chemins d&#39;exécution de manière subtile, ce qui entraîne des coûts de gaz extrêmement différents d&#39;un appel à l&#39;autre. Cependant, la plupart des fonctions sont sensibles et estimateGas donnera une bonne estimation la plupart du temps.</p>
</div>
<div class="paragraph data-line-985">
<p>Pour obtenir le prix du gaz du réseau, vous pouvez utiliser :</p>
</div>
<div class="listingblock data-line-988">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var gasPrice = web3.eth.getGasPrice();</code></pre>
</div>
</div>
<div class="paragraph data-line-990">
<p>Et à partir de là, vous pouvez estimer le coût du gaz :</p>
</div>
<div class="listingblock data-line-993">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var gasCostInEther = web3.utils.fromWei((gasEstimate * gasPrice), 'ether');</code></pre>
</div>
</div>
<div class="paragraph data-line-995">
<p>Appliquons nos fonctions d&#39;estimation de gaz pour estimer le coût du gaz de notre exemple Faucet, en utilisant le code <a href="http://bit.ly/2zf0SIO" data-href="http://bit.ly/2zf0SIO">du référentiel du livre</a>.</p>
</div>
<div class="paragraph data-line-997">
<p>Démarrez Truffle en mode développement et exécutez le fichier JavaScript dans <a href="#estimateGas_function">gas_estimates.js : Utilisation de la fonction estimateGas</a>, <em>gas_estimates.js</em>.</p>
</div>
<div id="estimateGas_function" class="exampleblock data-line-1002">
<div class="title">Example 5. gas_estimates.js : Utilisation de la fonction estimateGas</div>
<div class="content">
<div class="listingblock data-line-1004">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var FaucetContract = artifacts.require("./Faucet.sol");

FaucetContract.web3.eth.getGasPrice(function(error, result) {
    var gasPrice = Number(result);
    console.log("Gas Price is " + gasPrice + " wei"); // "10000000000000"

// Récupère l&amp;#39;instance de contrat
    FaucetContract.deployed().then(function(FaucetContractInstance) {

// Utilisez le mot clé &amp;#39;estimateGas&amp;#39; après le nom de la fonction pour obtenir le gaz
// estimation pour cette fonction particulière (aprove)
		FaucetContractInstance.send(web3.utils.toWei(1, "ether"));
        return FaucetContractInstance.withdraw.estimateGas(web3.utils.toWei(0.1, "ether"));

    }).then(function(result) {
        var gas = Number(result);

        console.log("gas estimation = " + gas + " units");
        console.log("gas cost estimation = " + (gas * gasPrice) + " wei");
        console.log("gas cost estimation = " +
                FaucetContract.web3.utils.fromWei((gas * gasPrice), 'ether') + " ether");
    });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1031">
<p>Voici à quoi cela ressemble dans la console de développement Truffle :</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle develop</strong>

truffle(develop)> <strong>exec gas_estimates.js</strong>
Using network 'develop'.

Gas Price is 20000000000 wei
gas estimation = 31397 units
gas cost estimation = 627940000000000 wei
gas cost estimation = 0.00062794 ether
</pre>
<div class="paragraph data-line-1047">
<p>Il est recommandé d&#39;évaluer le coût en gaz des fonctions dans le cadre de votre workflow de développement, afin d&#39;éviter toute surprise lors du déploiement de contrats sur le réseau principal.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1049">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph data-line-1051">
<p>Dans ce chapitre, nous avons commencé à travailler en détail avec les contrats intelligents et exploré le langage de programmation de contrats Solidity. Nous avons pris un exemple de contrat simple, <em>Faucet.sol</em>, et l&#39;avons progressivement amélioré et rendu plus complexe, en l&#39;utilisant pour explorer divers aspects du langage Solidity. Dans <a href="#vyper_chap">[vyper_chap]</a> nous travaillerons avec Vyper, un autre langage de programmation orienté contrat. Nous comparerons Vyper à Solidity, montrant certaines des différences dans la conception de ces deux langages et approfondirons notre compréhension de la programmation de contrats intelligents.(range=&quot;endofrange&quot;, startref=&quot;ix_07smart-contracts-solidity-asciidoc0&quot; )</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-05-01 12:20:05 -0400
</div>
</div>
</body>
</html>