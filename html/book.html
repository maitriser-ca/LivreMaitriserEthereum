<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Maîtriser Ethereum</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
<h1>Maîtriser Ethereum</h1>
</div>
<div id="content">
<div class="sect1 pagenumrestart data-line-3">
<h2 id="whatis_chapter">Qu&#39;est-ce qu&#39;Ethereum ?</h2>
<div class="sectionbody">
<div class="paragraph data-line-5">
<p>Ethereum est souvent décrit comme &quot;l&#39;ordinateur du monde.&quot; Mais qu&#39;est-ce que cela signifie ? Commençons par une description axée sur l&#39;informatique, puis essayons de décrypter cela avec une analyse plus pratique des capacités et des caractéristiques d&#39;Ethereum, tout en le comparant à Bitcoin et à d&#39;autres plateformes d&#39;échange d&#39;informations décentralisées (ou « chaînes de blocs » pour court).</p>
</div>
<div class="paragraph data-line-7">
<p>D&#39;un point de vue informatique, Ethereum est une machine à états déterministe mais pratiquement illimitée, composée d&#39;un état singleton globalement accessible et d&#39;une machine virtuelle qui applique des modifications à cet état.</p>
</div>
<div class="paragraph data-line-9">
<p>D&#39;un point de vue plus pratique, Ethereum est une infrastructure informatique à source libre décentralisée à l&#39;échelle mondiale qui exécute des programmes appelés <em>contrats intelligents</em>. Il utilise une chaîne de blocs pour synchroniser et stocker les changements d&#39;état du système, ainsi qu&#39;une cryptomonnaie appelée <em>ether</em> pour mesurer et limiter les coûts des ressources d&#39;exécution.</p>
</div>
<div class="paragraph data-line-11">
<p>La plate-forme Ethereum permet aux développeurs de créer de puissantes applications décentralisées avec des fonctions économiques intégrées. Tout en offrant une disponibilité, une auditabilité, une transparence et une neutralité élevées, il réduit ou élimine également la censure et réduit certains risques de contrepartie.</p>
</div>
<div class="sect2 data-line-14">
<h3 id="bitcoin_comparison">Comparé à Bitcoin</h3>
<div class="paragraph data-line-16">
<p>Beaucoup de gens viendront à Ethereum avec une expérience préalable des cryptomonnaies, en particulier du Bitcoin. Ethereum partage de nombreux éléments communs avec d&#39;autres chaînes de blocs ouvertes : un réseau pair à pair reliant les participants, un algorithme de consensus byzantin tolérant aux pannes pour la synchronisation des mises à jour d&#39;état (une chaîne de blocs de preuve de travail), l&#39;utilisation de primitives cryptographiques telles que le numérique signatures et hachages, et une monnaie numérique (ether).</p>
</div>
<div class="paragraph data-line-18">
<p>Pourtant, à bien des égards, le but et la construction d&#39;Ethereum sont étonnamment différents de ceux des chaînes de blocs ouvertes qui l&#39;ont précédé, y compris Bitcoin.</p>
</div>
<div class="paragraph data-line-20">
<p> Le but d&#39;Ethereum n&#39;est pas principalement d&#39;être un réseau de paiement en monnaie numérique. Alors que la monnaie numérique ether fait à la fois partie intégrante et nécessaire au fonctionnement d&#39;Ethereum, l&#39;ether est conçu comme une <em>monnaie d&#39;utilité</em> pour payer l&#39;utilisation de la plate-forme Ethereum en tant qu&#39;ordinateur mondial.</p>
</div>
<div class="paragraph data-line-22">
<p>Contrairement à Bitcoin, qui a un langage de script très limité, Ethereum est conçu pour être une chaîne de blocs programmable à usage général qui exécute une <em>machine virtuelle</em> capable d&#39;exécuter du code d&#39;une complexité arbitraire et illimitée. Là où le langage de script de Bitcoin est, intentionnellement, contraint à une simple évaluation vrai/faux des conditions de dépenses, le langage d&#39;Ethereum est <em>Turing complet</em>, ce qui signifie qu&#39;Ethereum peut fonctionner directement comme un ordinateur à usage général.</p>
</div>
</div>
<div class="sect2 data-line-25">
<h3 id="blockchain_components">Composantes d&#39;une chaîne de blocs</h3>
<div class="paragraph data-line-27">
<p>Les composantes d&#39;une chaîne de blocs ouverte et publique sont (généralement) :</p>
</div>
<div class="ulist data-line-29">
<ul>
<li class="data-line-29">
<p>Un réseau pair à pair (P2P) connectant les participants et propageant les transactions et les blocs de transactions vérifiées, basé sur un &quot;échange&quot; <span class="keep-together">protocolaire</span> standardisé.</p>
</li>
<li class="data-line-30">
<p>Messages, sous forme de transactions, représentant des transitions d&#39;état</p>
</li>
<li class="data-line-31">
<p>Un ensemble de règles consensuelles, régissant ce qui constitue une transaction et ce qui constitue une transition d&#39;état valide</p>
</li>
<li class="data-line-32">
<p>Une machine à états qui traite les transactions selon les règles du consensus</p>
</li>
<li class="data-line-33">
<p>Une chaîne de blocs cryptographiquement sécurisés qui agit comme un journal de toutes les transitions d&#39;état vérifiées et acceptées</p>
</li>
<li class="data-line-34">
<p>Un algorithme de consensus qui décentralise le contrôle sur la chaîne de blocs, en forçant les participants à coopérer à l&#39;application des règles de consensus</p>
</li>
<li class="data-line-35">
<p>Un schéma d&#39;incitation théoriquement valable (par exemple, les coûts de la preuve de travail plus les récompenses globales) pour sécuriser économiquement la machine d&#39;état dans un <span class="keep-together">environnement</span> ouvert.</p>
</li>
<li class="data-line-36">
<p>Une ou plusieurs implémentations logicielles à source libre des éléments ci-dessus (&quot;clients&quot;)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-38">
<p>Tous ou la plupart de ces composants sont généralement combinés dans un seul client logiciel. Par exemple, dans Bitcoin, l&#39;implémentation de référence est développée par le projet à source libre <em>Bitcoin Core</em> et implémentée en tant que client <em>bitcoind</em>. Dans Ethereum, plutôt qu&#39;une implémentation de référence, il existe une <em>spécification de référence</em>, une description mathématique du système dans le livre jaune (voir <a href="#references">Lectures complémentaires</a>). Il existe un certain nombre de clients, qui sont construits selon la spécification de référence.</p>
</div>
<div class="paragraph data-line-40">
<p>Dans le passé, nous utilisions le terme &quot;chaîne de blocs&quot; pour représenter tous les composants que nous venons d&#39;énumérer, comme une référence abrégée à la combinaison de technologies qui englobent toutes les caractéristiques décrites. Aujourd&#39;hui, cependant, il existe une grande variété de chaînes de blocs avec des propriétés différentes. Nous avons besoin de qualificatifs pour nous aider à comprendre les caractéristiques de la chaîne de blocs en question, telles que <em>ouverte, publique, globale, décentralisée, neutre,</em> et <em>résistante à la censure</em>, pour identifier les caractéristiques émergentes importantes d&#39;un système &quot;chaîne de blocs&quot; que ces composants permettent.</p>
</div>
<div class="paragraph data-line-42">
<p>Toutes les chaînes de blocs ne sont pas créées égales. Quand quelqu&#39;un vous dit que quelque chose est une chaîne de blocs, vous n&#39;avez pas reçu de réponse ; vous devez plutôt commencer à poser beaucoup de questions pour clarifier ce qu&#39;elles veulent dire lorsqu&#39;elles utilisent le mot &quot;chaîne de blocs&quot;. Commencez par demander une description des composants de la liste précédente, puis demandez si cette &quot;chaîne de blocs&quot; présente les caractéristiques d&#39;être <em>ouverte, publique</em>, etc.</p>
</div>
</div>
<div class="sect2 data-line-45">
<h3 id="ethereum_birth">La naissance d&#39;Ethereum</h3>
<div class="paragraph data-line-47">
<p> Toutes les grandes innovations résolvent de vrais problèmes, et Ethereum ne fait pas exception. Ethereum a été conçu à une époque où les gens reconnaissaient la puissance du modèle Bitcoin et essayaient d&#39;aller au-delà des applications de cryptomonnaie. Mais les développeurs étaient confrontés à une énigme : ils devaient soit construire sur Bitcoin, soit démarrer une nouvelle chaîne de blocs. S&#39;appuyer sur Bitcoin signifiait vivre dans les limites intentionnelles du réseau et essayer de trouver des solutions de contournement. L&#39;ensemble limité de types de transactions, de types de données et de tailles de stockage de données semblait limiter les types d&#39;applications pouvant s&#39;exécuter directement sur Bitcoin ; tout le reste nécessitait des couches hors chaîne supplémentaires, ce qui annulait immédiatement bon nombre des avantages de l&#39;utilisation d&#39;une chaîne de blocs publique. Pour les projets qui avaient besoin de plus de liberté et de flexibilité tout en restant pertinent, une nouvelle chaîne de blocs était la seule option. Mais cela signifiait beaucoup de travail : démarrage de tous les éléments de l&#39;infrastructure, tests exhaustifs, etc.</p>
</div>
<div class="paragraph data-line-49">
<p> Vers la fin de 2013, Vitalik Buterin, un jeune programmeur et passionné de Bitcoin, a commencé à réfléchir à l&#39;extension des capacités de Bitcoin et Mastercoin (un protocole Bitcoin de superposition étendu pour offrir des contrats intelligents rudimentaires). En octobre de la même année, Vitalik a proposé une approche plus généralisée à l&#39;équipe Mastercoin, qui permettait à des contrats flexibles et scriptables (mais pas Turing-complets) de remplacer le langage contractuel spécialisé de Mastercoin. Bien que l&#39;équipe Mastercoin ait été impressionnée, cette proposition était un changement trop radical pour s&#39;intégrer dans leur feuille de route de développement.</p>
</div>
<div class="paragraph data-line-51">
<p>En décembre 2013, Vitalik a commencé à partager un livre blanc qui décrivait l&#39;idée derrière Ethereum : une chaîne de blocs à usage général complète de Turing. Quelques dizaines de personnes ont vu cette première ébauche et ont fait part de leurs commentaires, aidant Vitalik à faire évoluer la proposition.</p>
</div>
<div class="paragraph data-line-53">
<p>Les deux auteurs de ce livre ont reçu une première ébauche du livre blanc et l&#39;ont commentée. Andreas M. Antonopoulos a été intrigué par l&#39;idée et a posé de nombreuses questions à Vitalik sur l&#39;utilisation d&#39;une chaîne de blocs distincte pour appliquer des règles de consensus sur l&#39;exécution de contrats intelligents et les implications d&#39;un langage Turing-complet. Andreas a continué à suivre les progrès d&#39;Ethereum avec beaucoup d&#39;intérêt, mais en était aux premiers stades de l&#39;écriture de son livre <em>Mastering Bitcoin</em>, et n&#39;a participé directement à Ethereum que bien plus tard. Dr. Gavin Wood, cependant, a été l&#39;une des premières personnes à contacter Vitalik et à lui proposer de l&#39;aider avec ses compétences en programmation C++. Gavin est devenu le cofondateur, le codesigner et le CTO d&#39;Ethereum.</p>
</div>
<div class="paragraph data-line-55">
<p>Comme le raconte Vitalik dans son <a href="http://bit.ly/2T2t6zs" data-href="http://bit.ly/2T2t6zs">article &quot;Ethereum Prehistory&quot;</a> :</p>
</div>
<div class="quoteblock data-line-57">
<blockquote>
<div class="paragraph data-line-58">
<p>C&#39;était l&#39;époque où le protocole Ethereum était entièrement ma propre création. À partir de là, cependant, de nouveaux participants ont commencé à rejoindre le giron. De loin, le plus important du côté du protocole était Gavin Wood&#8230;&#8203;</p>
</div>
<div class="paragraph data-line-60">
<p>Gavin peut également être largement crédité du changement subtil de vision d&#39;Ethereum comme une plate-forme pour créer de l&#39;argent programmable, avec des contrats basés sur la chaîne de blocs qui peuvent contenir des actifs numériques et les transférer selon des règles prédéfinies, à une plate-forme informatique à usage général. Cela a commencé par de subtils changements d&#39;accent et de terminologie, et plus tard cette influence s&#39;est renforcée avec l&#39;accent croissant mis sur l&#39;ensemble &quot;Web 3&quot;, qui considérait Ethereum comme un élément d&#39;une suite de technologies décentralisées, les deux autres étant Whisper et Swarm.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-63">
<p>À partir de décembre 2013, Vitalik et Gavin ont affiné et fait évoluer l&#39;idée, construisant ensemble la couche de protocole qui est devenue Ethereum.</p>
</div>
<div class="paragraph data-line-65">
<p>Les fondateurs d&#39;Ethereum pensaient à une chaîne de blocs sans but précis, qui pourrait prendre en charge une grande variété d&#39;applications en étant <em>programmée</em>. L&#39;idée était qu&#39;en utilisant une chaîne de blocs à usage général comme Ethereum, un développeur pouvait programmer son application particulière sans avoir à mettre en œuvre les mécanismes sous-jacents des réseaux pair à pair, des chaînes de blocs, des algorithmes de consensus, etc. La plateforme Ethereum a été conçue pour abstraire ces détails en fournissant un environnement de programmation déterministe et sécurisé pour les applications chaîne de blocs décentralisées.</p>
</div>
<div class="paragraph data-line-67">
<p>Tout comme Satoshi, Vitalik et Gavin n&#39;ont pas simplement inventé une nouvelle technologie ; ils ont combiné de nouvelles inventions avec des technologies existantes d&#39;une manière nouvelle et ont livré le code prototype pour prouver leurs idées au monde.</p>
</div>
<div class="paragraph data-line-69">
<p>Les fondateurs ont travaillé pendant des années, construisant et affinant la vision. Et le 30 juillet 2015, le premier bloc Ethereum a été miné. L&#39;ordinateur du monde a commencé à servir le monde.</p>
</div>
<div class="admonitionblock note data-line-72">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-73">
<p>L&#39;article de Vitalik Buterin &quot;A Prehistory of Ethereum&quot; a été publié en septembre 2017 et offre une vue fascinante à la première personne des premiers instants d&#39;Ethereum.</p>
</div>
<div class="paragraph data-line-75">
<p>Vous pouvez le lire sur
<a href="https://vitalik.ca/general/2017/09/14/prehistory.html" class="undefined" data-href="https://vitalik.ca/general/2017/09/14/prehistory.html">https://vitalik.ca/general/2017/09/14/prehistory.html</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-80">
<h3 id="development_stages">Les quatre étapes de développement d&#39;Ethereum</h3>
<div class="paragraph data-line-82">
<p>Le développement d&#39;Ethereum a été planifié en quatre étapes distinctes, avec des changements majeurs à chaque étape.  Une étape peut inclure des sous-versions, appelées &quot;embranchements divergents&quot; (hard forks), qui modifient les fonctionnalités d&#39;une manière qui n&#39;est pas rétrocompatible .</p>
</div>
<div class="paragraph data-line-84">
<p>Les quatre principales étapes de développement portent le nom de code <em>Frontier</em>, <em>Homestead</em>, <em>Metropolis</em> et <em>Serenity</em>. Les embranchements divergents intermédiaires qui se sont produits (ou sont prévus) à ce jour portent les noms de code <em>Ice Age</em>, <em>DAO</em>, <em>Tangerine Whistle</em>, <em>Spurious Dragon</em>, <em>Byzantium</em> et <em>Constantinople</em>. Les étapes de développement et les embranchements divergents intermédiaires sont présentées sur la chronologie suivante, qui est &quot;datée&quot; par numéro de bloc :</p>
</div>
<div class="dlist data-line-87">
<dl>
<dt class="hdlist1">Bloc #0</dt>
<dd>
<p><em>Frontier</em>—L&#39;étape initiale d&#39;Ethereum, du 30 juillet 2015 à mars 2016.</p>
</dd>
<dt class="hdlist1">Bloc #200 000</dt>
<dd>
<p><em>Ice Age</em>—Un embranchement divergent pour introduire une augmentation exponentielle de la difficulté, pour motiver une transition vers PoS lorsque prêt.</p>
</dd>
<dt class="hdlist1">Bloc #1 150 000</dt>
<dd>
<p><em>Homestead</em>—La deuxième étape d&#39;Ethereum, lancée en mars 2016.</p>
</dd>
<dt class="hdlist1">Bloc #1 192 000</dt>
<dd>
<p><em>DAO</em>—Un embranchement divergent qui a remboursé les victimes du contrat DAO piraté et a provoqué la scission d&#39;Ethereum et d&#39;Ethereum Classic en deux systèmes concurrents.</p>
</dd>
<dt class="hdlist1">Bloc #2 463 000</dt>
<dd>
<p><em>Tangerine Whistle</em>—Un embranchement divergent pour modifier le calcul du gaz pour certaines opérations lourdes en E/S et pour effacer l&#39;état accumulé d&#39;un déni de service (DoS) attaque qui a exploité le faible coût du gaz de ces opérations.</p>
</dd>
<dt class="hdlist1">Bloc #2 675 000</dt>
<dd>
<p><em>Spurious Dragon</em>—Un embranchement divergent pour traiter plus de vecteurs d&#39;attaque DoS, et un autre effacement d&#39;état. En outre, un mécanisme de protection contre les attaques par relecture.</p>
</dd>
<dt class="hdlist1">Bloc #4 370 000</dt>
<dd>
<p><em>Metropolis Byzantium</em>—Metropolis est la troisième étape d&#39;Ethereum, en cours au moment de la rédaction de ce livre, lancée en octobre 2017. Byzance est le premier des deux embranchements divergents prévus pour Metropolis.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-103">
<p>Après Byzance, il y a un autre embranchement divergent prévu pour Metropolis : Constantinople. Metropolis sera suivi de la dernière étape du déploiement d&#39;Ethereum, baptisée Serenity.</p>
</div>
</div>
<div class="sect2 data-line-107">
<h3 id="general_purpose_blockchain">Ethereum : une chaîne de blocs à usage général</h3>
<div class="paragraph data-line-109">
<p>La chaîne de blocs d&#39;origine, à savoir la chaîne de blocs de Bitcoin, suit l&#39;état de unités de bitcoin et leur propriété.  Vous pouvez considérer Bitcoin comme une <em>machine à états</em> à consensus distribué, où les transactions provoquent une <em>transition d&#39;état</em> globale, modifiant la propriété des pièces. Les transitions d&#39;état sont contraintes par les règles du consensus, permettant à tous les participants de (éventuellement) converger vers un état commun (consensus) du système, après que plusieurs blocs aient été minés.</p>
</div>
<div class="paragraph data-line-111">
<p>Ethereum est également une machine à états distribuée. Mais au lieu de suivre uniquement l&#39;état de la propriété de la devise, Ethereum suit les transitions d&#39;état d&#39;un magasin de données à usage général, c&#39;est-à-dire un magasin pouvant contenir toutes les données exprimables en tant que <em>uplet clé–valeur</em>. Un magasin de données clé-valeur contient des valeurs arbitraires, chacune référencée par une clé ; par exemple, la valeur &quot;Mastering Ethereum&quot; référencée par la clé &quot;Titre du livre&quot;. À certains égards, cela sert le même objectif que le modèle de stockage de données de <em>Random Access Memory</em> (RAM) utilisé par la plupart des ordinateurs à usage général. Ethereum a une mémoire qui stocke à la fois le code et les données, et il utilise la chaîne de blocs Ethereum pour suivre l&#39;évolution de cette mémoire au fil du temps. Comme un ordinateur à programme stocké à usage général, Ethereum peut charger du code dans sa machine d&#39;état et <em>exécuter</em> ce code, en stockant les changements d&#39;état résultants dans sa chaîne de blocs. Deux des différences critiques par rapport à la plupart des ordinateurs à usage général sont que les changements d&#39;état d&#39;Ethereum sont régis par les règles du consensus et que l&#39;état est distribué à l&#39;échelle mondiale. Ethereum répond à la question : &quot;Et si nous pouvions suivre n&#39;importe quel état arbitraire et programmer la machine à états pour créer un ordinateur mondial fonctionnant par consensus ?&quot;</p>
</div>
</div>
<div class="sect2 data-line-114">
<h3 id="ethereum_components">Composants d&#39;Ethereum</h3>
<div class="paragraph data-line-116">
<p>Dans Ethereum, les composantes d&#39;un système de chaîne de blocs décrit dans <a href="#blockchain_components">Composantes d&#39;une chaîne de blocs</a> sont, plus précisément :</p>
</div>
<div class="dlist data-line-119">
<dl>
<dt class="hdlist1">Réseau P2P</dt>
<dd>
<p>Ethereum fonctionne sur le <em>réseau principal Ethereum</em>, qui est adressable sur le port TCP 30303, et exécute un protocole appelé <em>ÐΞVp2p</em>.</p>
</dd>
<dt class="hdlist1">Règles de consensus </dt>
<dd>
<p>Les règles de consensus d&#39;Ethereum sont définies dans la spécification de référence, le Yellow Paper (voir <a href="#references">Lectures complémentaires</a>).</p>
</dd>
<dt class="hdlist1">Transactions</dt>
<dd>
<p>Les transactions Ethereum sont des messages réseau qui incluent (entre autres) un expéditeur, un destinataire, une valeur et une charge utile de données.</p>
</dd>
</dl>
</div>
<div class="dlist pagebreak-before data-line-126">
<dl>
<dt class="hdlist1">Machine d&#39;état</dt>
<dd>
<p>Les transitions d&#39;état Ethereum sont traitées par la <em>Ethereum Virtual Machine</em> (EVM), une machine virtuelle basée sur la pile qui exécute le <em>bytecode</em> (code intermédiaire ou instructions en langage machine). Les programmes EVM, appelés « contrats intelligents », sont écrits dans des langages de haut niveau (par exemple, Solidity) et compilés en code intermédiaire pour être exécutés sur l&#39;EVM.</p>
</dd>
<dt class="hdlist1">Structures de données</dt>
<dd>
<p>L&#39;état d&#39;Ethereum est stocké localement sur chaque nœud en tant que <em>base de données</em> (généralement LevelDB de Google), qui contient les transactions et l&#39;état du système dans une structure de données hachée sérialisée appelée <em>Arbre Merkle Patricia</em>.</p>
</dd>
<dt class="hdlist1">Algorithme de consensus</dt>
<dd>
<p>Ethereum utilise le modèle de consensus de Bitcoin, Nakamoto Consensus, qui utilise des blocs séquentiels à signature unique, pondérés en importance par PoW pour déterminer la chaîne la plus longue et donc l&#39;état actuel. Cependant, il est prévu de passer à un système de vote pondéré PoS, nommé <em>Casper</em>, dans un proche avenir.</p>
</dd>
<dt class="hdlist1">Sécurité économique</dt>
<dd>
<p>Ethereum utilise actuellement un algorithme PoW appelé <em>Ethash</em>, mais cela finira par être abandonné avec le passage au PoS à un moment donné dans le futur.</p>
</dd>
<dt class="hdlist1">Clients</dt>
<dd>
<p>Ethereum a plusieurs implémentations interopérables du logiciel client, dont les plus importantes sont <em>Go-Ethereum</em> (<em>Geth</em>) et <em>Parity</em>.</p>
</dd>
</dl>
</div>
<div class="sect3 data-line-137">
<h4 id="references">Lectures complémentaires</h4>
<div class="paragraph data-line-139">
<p>Les références suivantes fournissent des informations supplémentaires sur les technologies mentionnées ici :</p>
</div>
<div class="ulist data-line-141">
<ul>
<li class="data-line-141">
<p>Le livre jaune Ethereum:
<a href="https://ethereum.github.io/yellowpaper/paper.pdf" class="undefined" data-href="https://ethereum.github.io/yellowpaper/paper.pdf">https://ethereum.github.io/yellowpaper/paper.pdf</a></p>
</li>
<li class="data-line-144">
<p>Le Livre Beige, une réécriture du Livre Jaune pour un public plus large dans un langage moins formel:
<a href="https://github.com/chronaeon/beigepaper" class="undefined" data-href="https://github.com/chronaeon/beigepaper">https://github.com/chronaeon/beigepaper</a></p>
</li>
<li class="data-line-147">
<p>Protocole réseau ÐΞVp2p:
<a href="http://bit.ly/2quAlTE" class="undefined" data-href="http://bit.ly/2quAlTE">http://bit.ly/2quAlTE</a></p>
</li>
<li class="data-line-150">
<p>Liste des ressources de la machine virtuelle Ethereum:
<a href="http://bit.ly/2PmtjiS" class="undefined" data-href="http://bit.ly/2PmtjiS">http://bit.ly/2PmtjiS</a></p>
</li>
<li class="data-line-153">
<p>Base de données LevelDB (utilisée le plus souvent pour stocker la copie locale de la chaîne de blocs):
<a href="https://github.com/google/leveldb" class="undefined" data-href="https://github.com/google/leveldb">https://github.com/google/leveldb</a></p>
</li>
<li class="data-line-156">
<p>Arbres Merkle Patricia:
<a href="https://github.com/ethereum/wiki/wiki/Patricia-Tree" class="undefined" data-href="https://github.com/ethereum/wiki/wiki/Patricia-Tree">https://github.com/ethereum/wiki/wiki/Patricia-Tree</a></p>
</li>
<li class="data-line-159">
<p>Algorithme Ethash PoW:
<a href="https://github.com/ethereum/wiki/wiki/Ethash" class="undefined" data-href="https://github.com/ethereum/wiki/wiki/Ethash">https://github.com/ethereum/wiki/wiki/Ethash</a></p>
</li>
<li class="data-line-162">
<p>Guide de mise en œuvre de Casper PoS v1:
<a href="http://bit.ly/2DyPr3l" class="undefined" data-href="http://bit.ly/2DyPr3l">http://bit.ly/2DyPr3l</a></p>
</li>
<li class="data-line-165">
<p>Client Go-Ethereum (Geth):
<a href="https://geth.ethereum.org/" class="undefined" data-href="https://geth.ethereum.org/">https://geth.ethereum.org/</a></p>
</li>
<li class="data-line-168">
<p>Client Ethereum Parity:
<a href="https://parity.io/" class="undefined" data-href="https://parity.io/">https://parity.io/</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 data-line-172">
<h3 id="turing_completeness">Complétude d&#39;Ethereum et de Turing</h3>
<div class="paragraph data-line-174">
<p>Dès que vous commencez à lire sur Ethereum, vous rencontrerez immédiatement le terme &quot;Turing complet&quot;. Ethereum, disent-ils, contrairement à Bitcoin, est Turing complet. Qu&#39;est-ce que cela veut dire exactement?</p>
</div>
<div class="paragraph data-line-176">
<p>Le terme fait référence au mathématicien anglais Alan Turing, qui est considéré comme le père de l&#39;informatique. En 1936, il crée un modèle mathématique d&#39;ordinateur consistant en une machine à états qui manipule des symboles en les lisant et en les écrivant sur une mémoire séquentielle (ressemblant à une bande de papier de longueur infinie). Avec cette construction, Turing a continué à fournir une base mathématique pour répondre (par la négative) aux questions sur la <em>calculabilité universelle</em>, c&#39;est-à-dire si tous les problèmes peuvent être résolus. Il a prouvé qu&#39;il existe des classes de problèmes qui ne sont pas calculables. Plus précisément, il a prouvé que le <em>problème d&#39;arrêt</em> (s&#39;il est possible, étant donné un programme arbitraire et son entrée, de déterminer si le programme finira par s&#39;arrêter) n&#39;est pas résoluble.</p>
</div>
<div class="paragraph data-line-178">
<p>Alan Turing a en outre défini un système comme étant <em>Turing complet</em> s&#39;il peut être utilisé pour simuler n&#39;importe quelle machine de Turing. Un tel système s&#39;appelle une <em>machine de Turing universelle</em> (UTM).</p>
</div>
<div class="paragraph data-line-180">
<p>La capacité d&#39;Ethereum à exécuter un programme stocké, dans une machine à états appelée Ethereum Virtual Machine, tout en lisant et en écrivant des données dans la mémoire en fait un système Turing complet et donc un UTM. Ethereum peut calculer n&#39;importe quel algorithme pouvant être calculé par n&#39;importe quelle machine de Turing, compte tenu des limites de la mémoire finie.</p>
</div>
<div class="paragraph data-line-182">
<p>L&#39;innovation révolutionnaire d&#39;Ethereum consiste à combiner l&#39;architecture informatique à usage général d&#39;un ordinateur à programme stocké avec une chaîne de blocs décentralisée, créant ainsi un ordinateur mondial distribué à un seul état (singleton). Les programmes Ethereum s&#39;exécutent &quot;partout&quot;, mais produisent un état commun qui est sécurisé par les règles de <span class="keep-together">consensus</span>.</p>
</div>
<div class="sect3 data-line-185">
<h4 id="turing_completeness_feature">Complétude de Turing en tant que &quot;fonctionnalité&quot;</h4>
<div class="paragraph data-line-187">
<p> En entendant qu&#39;Ethereum est Turing complet, vous pourriez arriver à la conclusion qu&#39;il s&#39;agit d&#39;une <em>fonctionnalité</em> qui manque d&#39;une manière ou d&#39;une autre dans un système qui est incomplet de Turing. C&#39;est plutôt le contraire. La complétude de Turing est très facile à réaliser ; en fait, <a href="http://bit.ly/2ABft33" class="undefined" data-href="http://bit.ly/2ABft33">http://bit.ly/2ABft33</a> [la machine d&#39;état Turing complète la plus simple connue] a 4 états et utilise 6 symboles, avec une définition d&#39;état qui ne compte que 22 instructions. En effet, il arrive parfois que des systèmes soient « accidentellement Turing complets ». Une référence amusante de tels systèmes peut être trouvée à <a href="http://bit.ly/2Og1VgX" class="undefined" data-href="http://bit.ly/2Og1VgX">http://bit.ly/2Og1VgX</a>.</p>
</div>
<div class="paragraph data-line-189">
<p>Cependant, l&#39;exhaustivité de Turing est très dangereuse, en particulier dans les systèmes à accès ouvert comme les chaînes de blocs publiques, en raison du problème d&#39;arrêt que nous avons évoqué plus tôt. Par exemple, les imprimantes modernes sont Turing complètes et peuvent recevoir des fichiers à imprimer qui les envoient dans un état figé. Le fait qu&#39;Ethereum soit Turing complet signifie que n&#39;importe quel programme de n&#39;importe quelle complexité peut être calculé par Ethereum. Mais cette flexibilité pose des problèmes épineux de sécurité et de gestion des ressources. Une imprimante qui ne répond pas peut être éteinte et rallumée. Ce n&#39;est pas possible avec une chaîne de blocs publique.</p>
</div>
</div>
<div class="sect3 data-line-192">
<h4 id="turing_completeness_implications">Implications de la complétude de Turing</h4>
<div class="paragraph data-line-194">
<p>Turing a prouvé que vous ne pouvez pas prédire si un programme se terminera en le simulant sur un ordinateur. En termes simples, nous ne pouvons pas prédire le chemin d&#39;un programme sans l&#39;exécuter. Les systèmes Turing-complets peuvent s&#39;exécuter en &quot;boucles infinies&quot;, un terme utilisé (en simplifiant à l&#39;extrême) pour décrire un programme qui ne se termine pas. Il est trivial de créer un programme qui exécute une boucle qui ne se termine jamais. Mais des boucles sans fin involontaires peuvent survenir sans avertissement, en raison d&#39;interactions complexes entre les conditions de départ et le code. Dans Ethereum, cela pose un défi : chaque nœud participant (client) doit valider chaque transaction, en exécutant tous les contrats intelligents qu&#39;il appelle. Mais comme Turing l&#39;a prouvé, Ethereum ne peut pas prédire si un contrat intelligent prendra fin, ou combien de temps il durera, sans réellement l&#39;exécuter (éventuellement pour toujours). Que ce soit par accident ou exprès, un contrat intelligent peut être créé de telle sorte qu&#39;il s&#39;exécute indéfiniment lorsqu&#39;un nœud tente de le valider. Il s&#39;agit en fait d&#39;une attaque DoS. Et bien sûr, entre un programme qui prend une milliseconde à valider et un autre qui s&#39;exécute indéfiniment, il existe une gamme infinie de programmes désagréables, monopolisant les ressources, gonflant la mémoire et provoquant une surchauffe du processeur qui gaspillent simplement des ressources. Dans un ordinateur mondial, un programme qui abuse des ressources arrive à abuser des ressources mondiales. Comment Ethereum limite-t-il les ressources utilisées par un contrat intelligent s&#39;il ne peut pas prédire l&#39;utilisation des ressources à l&#39;avance ?</p>
</div>
<div class="paragraph data-line-196">
<p>Pour répondre à ce défi, Ethereum introduit un mécanisme de mesure appelé <em>gaz</em>. Comme l&#39;EVM exécute un contrat intelligent, il comptabilise soigneusement chaque instruction (calcul, accès aux données, etc.). Chaque instruction a un coût prédéterminé en unités de gaz. Lorsqu&#39;une transaction déclenche l&#39;exécution d&#39;un contrat intelligent, elle doit inclure une quantité de gaz qui fixe la limite supérieure de ce qui peut être consommé en exécutant le contrat intelligent. L&#39;EVM terminera l&#39;exécution si la quantité de gaz consommée par le calcul dépasse le gaz disponible dans la transaction. Le gaz est le mécanisme utilisé par Ethereum pour permettre un calcul complet de Turing tout en limitant les ressources que tout programme peut consommer.</p>
</div>
<div class="paragraph data-line-198">
<p>La question suivante est, &quot;comment obtenir du gaz pour payer le calcul sur l&#39;ordinateur mondial Ethereum?&quot; Vous ne trouverez pas de gaz sur les échanges.  Il ne peut être acheté que dans le cadre d&#39;une transaction et ne peut être acheté qu&#39;avec de l&#39;ether. L&#39;ether doit être envoyé avec une transaction et il doit être explicitement affecté à l&#39;achat de gaz, avec un prix du gaz acceptable. Comme à la pompe, le prix de l&#39;essence n&#39;est pas fixe. Le gaz est acheté pour la transaction, le calcul est exécuté et tout gaz non utilisé est remboursé à l&#39;expéditeur de la transaction.</p>
</div>
</div>
</div>
<div class="sect2 data-line-201">
<h3 id="DApp">Des chaînes de blocs à usage général aux applications décentralisées (DApps)</h3>
<div class="paragraph data-line-203">
<p>Ethereum a commencé comme un moyen de créer une chaîne de blocs à usage général qui peut être programmé pour une variété d&#39;utilisations. Mais très rapidement, la vision d&#39;Ethereum s&#39;est élargie pour devenir une plateforme de programmation de DApps. Les DApps représentent une perspective plus large que les contrats intelligents. Un DApp est, à tout le moins, un contrat intelligent et une interface utilisateur Web. Plus généralement, une DApp est une application Web qui repose sur des services d&#39;infrastructure ouverts, décentralisés et pair à pair.</p>
</div>
<div class="paragraph data-line-205">
<p>Une DApp est composée d&#39;au moins :</p>
</div>
<div class="ulist data-line-207">
<ul>
<li class="data-line-207">
<p>Contrats intelligents sur une chaîne de blocs</p>
</li>
<li class="data-line-208">
<p>Une interface utilisateur Web frontale</p>
</li>
</ul>
</div>
<div class="paragraph data-line-210">
<p>De plus, de nombreux DApps incluent d&#39;autres composants décentralisés, tels que :</p>
</div>
<div class="ulist data-line-212">
<ul>
<li class="data-line-212">
<p>Un protocole et une plateforme de stockage décentralisé (P2P)</p>
</li>
<li class="data-line-213">
<p>Un protocole et une plateforme de messagerie décentralisée (P2P)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip data-line-216">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-217">
<p>Vous pouvez voir des DApps orthographiés comme <em>ÐApps</em>. Le caractère Ð est le caractère latin appelé &quot;ETH&quot;, faisant allusion à Ethereum. Pour afficher ce caractère, utilisez le point de code Unicode 0xD0, ou si nécessaire l&#39;entité caractère HTML eth (ou entité décimale #208).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-221">
<h3 id="evolving_WWW">Le troisième âge d&#39;Internet</h3>
<div class="paragraph data-line-223">
<p>En 2004, le terme &quot;Web 2.0&quot; a pris de l&#39;importance, décrivant une évolution du Web vers un contenu généré par l&#39;utilisateur, des interfaces réactives et l&#39;interactivité. Web 2.0 n&#39;est pas une spécification technique, mais plutôt un terme décrivant le nouveau centre d&#39;intérêt des <span class="keep-together">applications</span> Web.</p>
</div>
<div class="paragraph data-line-225">
<p>Le concept de DApps est destiné à faire passer le World Wide Web à sa prochaine étape d&#39;évolution naturelle, en introduisant la décentralisation avec des protocoles pair à pair dans tous les aspects d&#39;une application Web. Le terme utilisé pour décrire cette évolution est <em>web3</em>, c&#39;est-à-dire la troisième &quot;version&quot; du web.  Proposé pour la première fois par le Dr Gavin Wood, web3 représente une nouvelle vision et une nouvelle orientation pour les applications Web : des applications détenues et gérées de manière centralisée aux applications basées sur des protocoles décentralisés .</p>
</div>
<div class="paragraph data-line-227">
<p>Dans les chapitres suivants, nous explorerons la bibliothèque JavaScript Ethereum web3.js, qui relie les applications JavaScript qui s&#39;exécutent dans votre navigateur avec la chaîne de blocs Ethereum. La bibliothèque web3.js comprend également une interface vers un réseau de stockage P2P appelé <em>Swarm</em> et un service de messagerie P2P appelé <em>Whisper</em>. Avec ces trois composants inclus dans une bibliothèque JavaScript exécutée dans votre navigateur Web, les développeurs disposent d&#39;une suite complète de développement d&#39;applications qui leur permet de créer des DApps web3.</p>
</div>
</div>
<div class="sect2 data-line-230">
<h3 id="development_culture">Culture de développement d&#39;Ethereum</h3>
<div class="paragraph data-line-232">
<p> Jusqu&#39;à présent, nous avons expliqué en quoi les objectifs et la technologie d&#39;Ethereum diffèrent de ceux des autres chaînes de blocs qui l&#39;ont précédé , comme Bitcoin. Ethereum a également une culture de développement très différente.</p>
</div>
<div class="paragraph data-line-234">
<p>Dans Bitcoin, le développement est guidé par des principes conservateurs : tous les changements sont soigneusement étudiés pour s&#39;assurer qu&#39;aucun des systèmes existants ne soit perturbé. Pour la plupart, les modifications ne sont mises en œuvre que si elles sont rétrocompatibles. Les clients existants sont autorisés à s&#39;inscrire, mais continueront à fonctionner s&#39;ils décident de ne pas effectuer la mise à niveau.</p>
</div>
<div class="paragraph data-line-236">
<p>Dans Ethereum, en comparaison, la culture de développement de la communauté est axée sur l&#39;avenir plutôt que sur le passé. Le mantra (pas tout à fait sérieux) est &quot;avancez vite et cassez des choses&quot;. Si un changement est nécessaire, il est mis en œuvre, même si cela signifie invalider les hypothèses précédentes, rompre la compatibilité ou forcer les clients à se mettre à jour. La culture de développement d&#39;Ethereum se caractérise par une innovation et une évolution rapide et une volonté de déployer des améliorations tournées vers l&#39;avenir, même si cela se fait au détriment d&#39;une certaine rétrocompatibilité.</p>
</div>
<div class="paragraph data-line-238">
<p>Cela signifie pour vous, en tant que développeur, que vous devez rester flexible et être prêt à reconstruire votre infrastructure à mesure que certaines des hypothèses sous-jacentes changent. L&#39;un des grands défis auxquels sont confrontés les développeurs d&#39;Ethereum est la contradiction inhérente entre le déploiement de code sur un système immuable et une plate-forme de développement en constante évolution. Vous ne pouvez pas simplement &quot;mettre à niveau&quot; vos contrats intelligents. Vous devez être prêt à en déployer de nouveaux, à migrer les utilisateurs, les applications et les fonds, et à recommencer.</p>
</div>
<div class="paragraph data-line-240">
<p>Ironiquement, cela signifie également que l&#39;objectif de construire des systèmes avec plus d&#39;autonomie et moins de contrôle centralisé n&#39;est toujours pas pleinement atteint. L&#39;autonomie et la décentralisation nécessitent un peu plus de stabilité dans la plate-forme que vous n&#39;obtiendrez probablement dans Ethereum dans les prochaines années. Afin de &quot;faire évoluer&quot; la plateforme, vous devez être prêt à supprimer et redémarrer vos contrats intelligents, ce qui signifie que vous devez conserver un certain degré de contrôle sur eux.</p>
</div>
<div class="paragraph data-line-242">
<p>Mais, du côté positif, Ethereum avance très vite. Il y a peu d&#39;opportunités pour la &quot;bike-shedding&quot;, une expression qui signifie retarder le développement en se disputant sur des détails mineurs tels que la façon de construire le garage à vélos à l&#39;arrière d&#39;une centrale nucléaire. Si vous commencez à faire du vélo, vous découvrirez peut-être soudainement que pendant que vous étiez distrait, le reste de l&#39;équipe de développement a changé le plan et a abandonné les vélos en faveur de l&#39;aéroglisseur autonome.</p>
</div>
<div class="paragraph data-line-244">
<p>A terme, le développement de la plateforme Ethereum ralentira et ses interfaces deviendront fixes. Mais en attendant, l&#39;innovation est le principe moteur. Vous feriez mieux de suivre, car personne ne ralentira pour vous.</p>
</div>
</div>
<div class="sect2 data-line-247">
<h3 id="why_learn">Pourquoi apprendre Ethereum ?</h3>
<div class="paragraph data-line-249">
<p>Les chaînes de blocs ont une courbe d&#39;apprentissage très abrupte, car elles combinent plusieurs disciplines en un seul domaine: programmation, sécurité de l&#39;information, cryptographie, économie, systèmes distribués, réseaux pair à pair, etc. Ethereum rend cette courbe d&#39;apprentissage beaucoup moins abrupte, vous pouvez donc démarrer rapidement. Mais juste sous la surface d&#39;un environnement d&#39;une simplicité trompeuse se cache bien plus. Au fur et à mesure que vous apprenez et commencez à chercher plus profondément, il y a toujours une autre couche de complexité et d&#39;émerveillement.</p>
</div>
<div class="paragraph data-line-251">
<p>Ethereum est une excellente plate-forme pour en savoir plus sur les chaînes de blocs et construit une communauté massive de développeurs, plus rapidement que toute autre plate-forme de chaîne de blocs. Plus que tout autre, Ethereum est une <em>chaîne de blocs de développeurs</em>, construite par des développeurs pour des développeurs. Un développeur familiarisé avec les applications JavaScript peut se lancer dans Ethereum et commencer à produire du code fonctionnel très rapidement. Pendant les premières années de la vie d&#39;Ethereum, il était courant de voir des T-shirts annonçant que vous pouvez créer un jeton en seulement cinq lignes de code. Bien sûr, c&#39;est une épée à double tranchant. Il est facile d&#39;écrire du code, mais il est très difficile d&#39;écrire du <em>bon</em> code <em>sécurisé</em>.</p>
</div>
</div>
<div class="sect2 data-line-254">
<h3 id="teaching_objectives">Ce que ce livre vous apprendra</h3>
<div class="paragraph data-line-256">
<p>Ce livre plonge dans Ethereum et examine chaque composant. Vous commencerez par une transaction simple, décortiquerez son fonctionnement, établirez un contrat simple, l&#39;améliorerez et suivrez son parcours dans le système Ethereum.</p>
</div>
<div class="paragraph data-line-5">
<p>Vous apprendrez non seulement comment utiliser Ethereum - comment cela fonctionne - mais aussi pourquoi il est conçu comme il est. Vous pourrez comprendre comment chacune des pièces fonctionne, comment elles s&#39;emboîtent et pourquoi. </p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="intro_chapter">Les bases d&#39;Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p> Dans ce chapitre, nous commencerons à explorer Ethereum, à apprendre à utiliser les portefeuilles, à créer des transactions, et aussi comment exécuter un contrat intelligent de base.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="ether_units">L&#8217;ether comme unité monétaire</h3>
<div class="paragraph data-line-9">
<p>L&#39;unité monétaire d&#39;Ethereum est appelée <em>ether</em>, également identifiée par &quot;ETH&quot; ou avec les symboles &#926; (de la lettre grecque « Xi » qui ressemble à un E majuscule stylisé) ou, moins souvent, &#9830;: par exemple, 1 éther, ou 1 ETH, ou &#926;1, ou &#9830;1.</p>
</div>
<div class="admonitionblock tip data-line-12">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-13">
<p>Utilisez le caractère Unicode U+039E pour &#926; et U+2666 pour &#9830;.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-16">
<p>L&#39;ether est subdivisé en unités plus petites, jusqu&#39;à la plus petite unité possible, qui est nommée <em>wei</em>. Un ether est égal à 1 quintillion de wei (1 * 10<sup>18</sup> ou 1 000 000 000 000 000 000). Vous entendrez peut-être aussi les gens se référer à la devise &quot;Ethereum&quot;, mais c&#39;est une erreur courante pour les débutants. Ethereum est le système, ether est la monnaie.</p>
</div>
<div class="paragraph data-line-18">
<p>La valeur de l&#39;ether est toujours représentée en interne dans Ethereum sous la forme d&#39;une valeur entière non signée libellée en wei. Lorsque vous traitez 1 ether, la transaction encode 1000000000000000000 wei comme valeur.</p>
</div>
<div class="paragraph data-line-20">
<p>Les différentes dénominations d&#39;ether ont à la fois un <em>nom scientifique</em> utilisant le Système international d&#39;unités (<em>SI</em>) et un nom familier qui rend hommage à de nombreux grands esprits de l&#39;informatique et de la cryptographie.</p>
</div>
<div class="paragraph data-line-22">
<p><a href="#ether_denominations">Dénominations d&#8217;ether et noms d&#39;unités</a> montre les différentes unités, leurs noms familiers (communs) et leurs noms SI. Conformément à la représentation interne de la valeur, le tableau montre toutes les dénominations en wei (première ligne), avec l&#39;ether indiqué par 10<sup>18</sup> wei dans la 7e ligne.</p>
</div>
<table id="ether_denominations" class="tableblock frame-all grid-all stretch data-line-27">
<caption class="title">Table 1. Dénominations d&#8217;ether et noms d&#39;unités</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Valeur (en wei)</th>
<th class="tableblock halign-left valign-top">Exposant</th>
<th class="tableblock halign-left valign-top">Nom commun</th>
<th class="tableblock halign-left valign-top">Nom SI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wei</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wei</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>3</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Babbage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kilowei ou femtoether</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>6</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lovelace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mégawei ou picoether</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>9</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shanon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gigawei ou nanoether</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>12</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Szabo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microether ou micro</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>15</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finney</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Milliether ou milli</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>1 000 000 000 000 000 000</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>10<sup>18</sup></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Ether</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Ether</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000 000 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>21</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">grandiose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kiloether</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000 000 000 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>24</sup></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mégaether</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-41">
<h3 id="choosing_eth_wallet">Choisir un portefeuille Ethereum</h3>
<div class="paragraph data-line-43">
<p>Le terme &quot;portefeuille&quot; est venu signifier beaucoup de choses, bien qu&#39;elles soient toutes liées et qu&#39;elles se résument au quotidien à peu près à la même chose. Nous utiliserons le terme &quot;portefeuille&quot; pour désigner une application logicielle qui vous aide à gérer votre compte Ethereum. En bref, un portefeuille Ethereum est votre passerelle vers le système Ethereum. Il détient vos clés et peut créer et diffuser des transactions en votre nom. Choisir un portefeuille Ethereum peut être difficile car il existe de nombreuses options différentes avec des caractéristiques et des conceptions différentes. Certains sont plus adaptés aux débutants et certains sont plus adaptés aux experts. La plate-forme Ethereum elle-même est toujours en cours d&#39;amélioration, et les &quot;meilleurs&quot; portefeuilles sont souvent ceux qui s&#39;adaptent aux changements qui accompagnent les mises à niveau de la plate-forme.</p>
</div>
<div class="paragraph data-line-45">
<p>Mais ne vous inquiétez pas ! Si vous choisissez un portefeuille et que vous n&#39;aimez pas son fonctionnement, ou si vous l&#39;aimez au début, mais que vous souhaitez ensuite essayer autre chose, vous pouvez changer de portefeuille assez facilement. Tout ce que vous avez à faire est d&#39;effectuer une transaction qui envoie vos fonds de l&#39;ancien portefeuille vers le nouveau portefeuille, ou d&#39;exporter vos clés privées et de les importer dans le nouveau.</p>
</div>
<div class="paragraph data-line-47">
<p>Nous avons sélectionné trois types de portefeuilles différents à utiliser comme exemples tout au long du livre : un portefeuille mobile, un portefeuille de bureau et un portefeuille Web. Nous avons choisi ces trois portefeuilles car ils représentent un large éventail de complexité et de fonctionnalités. Cependant, la sélection de ces portefeuilles n&#39;est pas une approbation de leur qualité ou de leur sécurité. Ils sont simplement un bon point de départ pour des démonstrations et des tests.</p>
</div>
<div class="paragraph data-line-49">
<p>N&#39;oubliez pas que pour qu&#39;une application de portefeuille fonctionne, elle doit avoir accès à vos clés privées, il est donc essentiel que vous ne téléchargiez et n&#39;utilisiez que des applications de portefeuille provenant de sources de confiance. Heureusement, en général, plus une application de portefeuille est populaire, plus elle est susceptible d&#39;être fiable. Néanmoins, il est recommandé d&#39;éviter de &quot;mettre tous vos œufs dans le même panier&quot; et de répartir vos comptes Ethereum sur plusieurs portefeuilles.</p>
</div>
<div class="paragraph data-line-51">
<p>Voici quelques bons portefeuilles de démarrage :</p>
</div>
<div class="dlist data-line-53">
<dl>
<dt class="hdlist1">MetaMask</dt>
<dd>
<p>MetaMask est un portefeuille d&#39;extension de navigateur qui s&#39;exécute dans votre navigateur (Chrome, Firefox, Opera ou Brave Browser). Il est facile à utiliser et pratique pour les tests, car il est capable de se connecter à une variété de nœuds Ethereum et de tester des chaînes de blocs. MetaMask est un portefeuille basé sur le Web.</p>
</dd>
<dt class="hdlist1">Jaxx</dt>
<dd>
<p>Jaxx est un portefeuille multiplateforme et multidevise qui fonctionne sur une variété de systèmes d&#39;exploitation, y compris Android, iOS, Windows, macOS, et Linux. C&#39;est souvent un bon choix pour les nouveaux utilisateurs car il est conçu pour la simplicité et la facilité d&#39;utilisation. Jaxx est soit un portefeuille mobile, soit un portefeuille de bureau, selon l&#39;endroit où vous l&#39;installez.</p>
</dd>
<dt class="hdlist1">MyEtherWallet (MEW)</dt>
<dd>
<p>(&quot;portefeuilles&quot;,&quot;Emerald Wallet&quot; )MyEtherWallet est un portefeuille Web qui s&#39;exécute dans n&#39;importe quel navigateur. Il possède de multiples fonctionnalités sophistiquées que nous explorerons dans plusieurs de nos exemples. MyEtherWallet est un portefeuille basé sur le Web.</p>
</dd>
<dt class="hdlist1">Emerald Wallet</dt>
<dd>
<p>Emerald Wallet est conçu pour fonctionner avec la blockchain Ethereum Classic, mais est compatible avec d&#39;autres blockchains basées sur Ethereum. C&#39;est une application de bureau à source libre et fonctionne sous Windows, macOS et Linux. Emerald Wallet peut exécuter un nœud complet ou se connecter à un nœud distant public, fonctionnant en mode &quot;léger&quot;. Il dispose également d&#39;un outil compagnon pour effectuer toutes les opérations à partir de la ligne de commande.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-61">
<p>Nous commencerons par installer MetaMask sur un bureau, mais nous aborderons d&#39;abord brièvement le contrôle et la gestion des clés.</p>
</div>
</div>
<div class="sect2 data-line-64">
<h3 id="control_responsibility">Contrôle et responsabilité</h3>
<div class="paragraph data-line-66">
<p>Les chaînes de blocs ouvertes comme Ethereum sont importantes car elles fonctionnent comme un système <em>décentralisé</em>. Cela signifie beaucoup de choses, mais un aspect crucial est que chaque utilisateur d&#39;Ethereum peut et doit contrôler ses propres clés privées, qui contrôlent l&#39;accès aux fonds et aux contrats intelligents. Nous appelons parfois la combinaison de l&#39;accès aux fonds et des contrats intelligents un &quot;compte&quot; ou un &quot;portefeuille&quot;. Ces termes peuvent devenir assez complexes dans leur fonctionnalité, nous y reviendrons donc plus en détail plus tard. En tant que principe fondamental, cependant, c&#39;est aussi simple qu&#39;une clé privée équivaut à un &quot;compte&quot;. Certains utilisateurs choisissent de renoncer au contrôle de leurs clés privées en utilisant un dépositaire tiers, tel qu&#39;un échange en ligne. Dans ce livre, nous vous apprendrons à prendre le contrôle et à gérer vos propres clés privées.</p>
</div>
<div class="paragraph data-line-68">
<p>Avec le contrôle vient une grande responsabilité. Si vous perdez vos clés privées, vous perdez l&#39;accès à vos fonds et contrats. Personne ne peut vous aider à retrouver l&#39;accès - vos fonds seront verrouillés pour toujours. Voici quelques conseils pour vous aider à gérer cette responsabilité :</p>
</div>
<div class="ulist data-line-70">
<ul>
<li class="data-line-70">
<p>N&#39;improvisez pas la sécurité. Utilisez des approches standardisées.</p>
</li>
<li class="data-line-72">
<p>Plus le compte est important (par exemple, plus la valeur des fonds contrôlés est élevée, ou plus les contrats intelligents accessibles sont importants), plus les mesures de sécurité doivent être prises.</p>
</li>
<li class="data-line-74">
<p>La sécurité la plus élevée est obtenue à partir d&#39;un appareil isolé, mais ce niveau n&#39;est pas requis pour tous les comptes.</p>
</li>
<li class="data-line-76">
<p>Ne stockez jamais votre clé privée en clair, en particulier sous forme numérique. Heureusement, la plupart des interfaces utilisateur actuelles ne vous permettent même pas de voir la clé privée brute.</p>
</li>
<li class="data-line-78">
<p>Les clés privées peuvent être stockées sous forme cryptée, en tant que fichier &quot;keystore&quot; numérique. Étant cryptés, ils ont besoin d&#39;un mot de passe pour se déverrouiller. Lorsque vous êtes invité à choisir un mot de passe, rendez-le fort (c&#39;est-à-dire long et aléatoire), sauvegardez-le et ne le partagez pas. Si vous n&#39;avez pas de gestionnaire de mots de passe, écrivez-le et conservez-le dans un endroit sûr et secret. Pour accéder à votre compte, vous avez besoin à la fois du fichier keystore et du mot de passe.</p>
</li>
<li class="data-line-80">
<p>Ne stockez aucun mot de passe dans des documents numériques, des photos numériques, des captures d&#39;écran, des lecteurs en ligne, des PDF cryptés, etc. Encore une fois, n&#39;improvisez pas la sécurité. Utilisez un gestionnaire de mots de passe ou un stylo et du papier.</p>
</li>
<li class="data-line-82">
<p>Lorsque vous êtes invité à sauvegarder une clé sous forme de séquence de mots mnémoniques, utilisez un stylo et du papier pour effectuer une sauvegarde physique. Ne laissez pas cette tâche &quot;pour plus tard&quot; ; vous oublierez. Ces sauvegardes peuvent être utilisées pour reconstruire votre clé privée au cas où vous perdriez toutes les données enregistrées sur votre système, ou si vous oubliez ou perdez votre mot de passe. Cependant, ils peuvent également être utilisés par des attaquants pour obtenir vos clés privées. Ne les stockez donc jamais sous forme numérique et conservez la copie physique en toute sécurité dans un tiroir ou un coffre-fort verrouillé.</p>
</li>
<li class="data-line-84">
<p>Avant de transférer des montants importants (en particulier vers de nouvelles adresses), effectuez d&#39;abord une petite transaction test (par exemple, une valeur inférieure à 1 $) et attendez la confirmation de réception.</p>
</li>
<li class="data-line-86">
<p>Lorsque vous créez un nouveau compte, commencez par n&#39;envoyer qu&#39;une petite transaction test à la nouvelle adresse. Une fois que vous avez reçu la transaction de test, essayez de renvoyer à partir de ce compte. Il existe de nombreuses raisons pour lesquelles la création d&#39;un compte peut mal tourner, et si cela a mal tourné, il vaut mieux le découvrir avec une petite perte. Si les tests fonctionnent, tout va bien.</p>
</li>
<li class="data-line-88">
<p>Les explorateurs de blocs publics sont un moyen simple de voir indépendamment si une transaction a été acceptée par le réseau. Cependant, cette commodité a un impact négatif sur votre vie privée, car vous révélez vos adresses pour bloquer les explorateurs, qui peuvent vous suivre.</p>
</li>
<li class="data-line-90">
<p>N&#39;envoyez pas d&#39;argent à l&#39;une des adresses indiquées dans ce livre. Les clés privées sont répertoriées dans le livre et quelqu&#39;un prendra immédiatement cet argent.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-92">
<p>Maintenant que nous avons couvert quelques bonnes pratiques de base pour la gestion des clés et la sécurité, passons au travail avec MetaMask !</p>
</div>
</div>
<div class="sect2 data-line-95">
<h3 id="installing_MetaMask">Premiers pas avec MetaMask</h3>
<div class="paragraph data-line-97">
<p>Ouvrez le navigateur Google Chrome et accédez à <a href="https://chrome.google.com/webstore/category/extensions" class="undefined" data-href="https://chrome.google.com/webstore/category/extensions">https://chrome.google.com/webstore/category/extensions</a>.</p>
</div>
<div class="paragraph data-line-99">
<p>Recherchez &quot;MetaMask&quot; et cliquez sur le logo d&#39;un renard. Vous devriez voir quelque chose comme le résultat affiché dans <a href="#metamask_download">La page de détail de l&#39;extension MetaMask Chrome</a>.</p>
</div>
<div id="metamask_download" class="imageblock data-line-103">
<div class="content">
<img src="images/metamask_download.png" alt="&quot;Page de détails du métamasque&quot;">
</div>
<div class="title">Figure 1. La page de détail de l&#39;extension MetaMask Chrome</div>
</div>
<div class="paragraph data-line-105">
<p>Il est important de vérifier que vous téléchargez la véritable extension MetaMask, car parfois les gens sont capables de passer furtivement des extensions malveillantes au-delà des filtres de Google. Le vrai:</p>
</div>
<div class="ulist data-line-107">
<ul>
<li class="data-line-107">
<p>Affiche l&#39;ID nkbihfbeogaeaoehlefnkodbefgpgknn dans la barre d&#39;adresse</p>
</li>
<li class="data-line-108">
<p>Est offert par <a href="https://metamask.io" class="undefined" data-href="https://metamask.io">https://metamask.io</a></p>
</li>
<li class="data-line-109">
<p>A plus de 1 500 avis</p>
</li>
<li class="data-line-110">
<p>A plus de 1 000 000 d&#39;utilisateurs</p>
</li>
</ul>
</div>
<div class="paragraph data-line-112">
<p>Une fois que vous avez confirmé que vous recherchez la bonne extension, cliquez sur &quot;Ajouter à Chrome&quot; pour l&#39;installer.</p>
</div>
<div class="sect3 data-line-115">
<h4 id="using_MetaMask">Création d&#39;un portefeuille</h4>
<div class="paragraph data-line-117">
<p>Une fois MetaMask installé, vous devriez voir une nouvelle icône (la tête d&#39;un renard) dans la barre d&#39;outils de votre navigateur. Cliquez dessus pour commencer. Il vous sera demandé d&#39;accepter les termes et conditions puis de créer votre nouveau portefeuille Ethereum en saisissant un mot de passe (voir <a href="#metamask_password">La page de mot de passe de l&#39;extension MetaMask Chrome</a>).</p>
</div>
<div id="metamask_password" class="imageblock data-line-121">
<div class="content">
<img src="images/metamask_password.png" alt="&quot;Page de mot de passe du métamasque&quot;">
</div>
<div class="title">Figure 2. La page de mot de passe de l&#39;extension MetaMask Chrome</div>
</div>
<div class="admonitionblock tip data-line-124">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-125">
<p>Le mot de passe contrôle l&#39;accès à MetaMask, de sorte qu&#39;il ne peut être utilisé par personne ayant accès à votre navigateur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-128">
<p>Une fois que vous avez défini un mot de passe, MetaMask générera un portefeuille pour vous et vous montrera un <em>mnémonique de sauvegarde</em> composé de 12 mots anglais (voir <a href="#metamask_mnemonic">La sauvegarde mnémonique de votre portefeuille, créée par MetaMask</a>). Ces mots peuvent être utilisés dans n&#39;importe quel portefeuille compatible pour récupérer l&#39;accès à vos fonds si quelque chose arrivait à MetaMask ou à votre ordinateur. Vous n&#39;avez pas besoin du mot de passe pour cette récupération ; les 12 mots suffisent.</p>
</div>
<div class="admonitionblock tip data-line-131">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-132">
<p>Sauvegardez votre mnémonique (12 mots) sur papier, deux fois. Conservez les deux sauvegardes papier dans deux emplacements sécurisés distincts, tels qu&#39;un coffre-fort résistant au feu, un tiroir verrouillé ou un coffre-fort. Traitez les sauvegardes papier comme de l&#39;argent de valeur équivalente à ce que vous stockez dans votre portefeuille Ethereum. Toute personne ayant accès à ces mots peut y accéder et voler votre argent.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="metamask_mnemonic" class="imageblock data-line-137">
<div class="content">
<img src="images/metamask_mnemonic.png" alt="&quot;Page Mnémonique MetaMask&quot;">
</div>
<div class="title">Figure 3. La sauvegarde mnémonique de votre portefeuille, créée par MetaMask</div>
</div>
<div class="paragraph data-line-139">
<p>Une fois que vous avez confirmé que vous avez stocké le mnémonique en toute sécurité, vous pourrez voir les détails de votre compte Ethereum, comme indiqué dans <a href="#metamask_account">Votre compte Ethereum dans MetaMask</a>.</p>
</div>
<div id="metamask_account" class="imageblock data-line-143">
<div class="content">
<img src="images/metamask_account.png" alt="&quot;Page de compte MetaMask&quot;">
</div>
<div class="title">Figure 4. Votre compte Ethereum dans MetaMask</div>
</div>
<div class="paragraph data-line-145">
<p>La page de votre compte affiche le nom de votre compte (&quot;Account 1&quot; par défaut), une adresse Ethereum (0x9E713... dans l&#39;exemple), et une icône colorée pour vous aider à distinguer visuellement ce compte des autres comptes. En haut de la page du compte, vous pouvez voir sur quel réseau Ethereum vous travaillez actuellement (&quot;Main Network&quot; dans l&#39;exemple).</p>
</div>
<div class="paragraph data-line-147">
<p>Toutes nos félicitations! Vous avez configuré votre premier portefeuille Ethereum.</p>
</div>
</div>
<div class="sect3 data-line-150">
<h4 id="switching_networks">Changer le réseau</h4>
<div class="paragraph data-line-152">
<p>Comme vous pouvez le voir sur la page du compte MetaMask, vous pouvez choisir entre plusieurs réseaux Ethereum. Par défaut, MetaMask essaiera de se connecter au réseau principal. Les autres choix sont des réseaux de test publics, tout nœud Ethereum de votre choix ou des nœuds exécutant des chaînes de blocs privées sur votre propre ordinateur (localhost) :</p>
</div>
<div class="dlist data-line-154">
<dl>
<dt class="hdlist1">Réseau principal Ethereum</dt>
<dd>
<p>La principale chaîne de blocs publique Ethereum. Véritable ETH, valeur réelle et conséquences réelles.</p>
</dd>
<dt class="hdlist1">Réseau de test Ropsten</dt>
<dd>
<p>Chaîne de blocs et réseau de test public Ethereum. l&#8217;ETH sur ce réseau n&#39;a aucune valeur.</p>
</dd>
<dt class="hdlist1">Réseau de test Kovan</dt>
<dd>
<p>Chaîne de blocs et réseau de test public Ethereum utilisant le protocole de consensus Aura avec preuve d&#39;autorité (signature fédérée). ETH sur ce réseau n&#39;a aucune valeur. Le réseau de test Kovan est uniquement pris en charge par Parity. D&#39;autres clients Ethereum utilisent le protocole de consensus Clique, qui a été proposé plus tard, pour la preuve de la vérification basée sur l&#39;autorité.</p>
</dd>
<dt class="hdlist1">Réseau de test Rinkeby</dt>
<dd>
<p>Chaîne de blocs et réseau de test public Ethereum, utilisant le protocole de consensus Clique avec preuve d&#39;autorité (signature fédérée). ETH sur ce réseau n&#39;a aucune valeur.</p>
</dd>
<dt class="hdlist1">Localhost 8545</dt>
<dd>
<p>Se connecte à un nœud exécuté sur le même ordinateur que le navigateur. Le nœud peut faire partie de n&#39;importe quelle chaîne de blocs publique (principale ou testnet) ou d&#39;un testnet privé.</p>
</dd>
<dt class="hdlist1">RPC personnalisé</dt>
<dd>
<p>vous permet de connecter MetaMask à n&#39;importe quel nœud avec une interface d&#39;appel de procédure distante (RPC) compatible Geth. Le nœud peut faire partie de n&#39;importe quelle chaîne de blocs publique ou privée.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note data-line-167">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-168">
<p>Votre portefeuille MetaMask utilise la même clé privée et la même adresse Ethereum sur tous les réseaux auxquels il se connecte. Cependant, votre solde d&#39;adresses Ethereum sur chaque réseau Ethereum sera différent. Vos clés peuvent contrôler l&#39;éther et les contrats sur Ropsten, par exemple, mais pas sur le réseau principal.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-172">
<h4 id="getting_test_eth">Obtenir de l&#39;ether de test</h4>
<div class="paragraph data-line-174">
<p>Votre première tâche est de financer votre portefeuille. Vous ne ferez pas cela sur le réseau principal car l&#39;éther réel coûte de l&#39;argent et sa manipulation nécessite un peu plus d&#39;expérience. Pour l&#39;instant, vous allez charger votre portefeuille avec de l&#39;ether testnet.</p>
</div>
<div class="paragraph data-line-176">
<p>Passez MetaMask au <em>Réseau test Ropsten</em>. Cliquez sur Deposit, puis sur Ropsten Test Faucet. MetaMask ouvrira une nouvelle page Web, comme indiqué dans <a href="#metamask_ropsten_faucet">MetaMask et le robinet du réseau test Ropsten</a>.</p>
</div>
<div id="metamask_ropsten_faucet" class="imageblock data-line-180">
<div class="content">
<img src="images/metamask_ropsten_faucet.png" alt="&quot;MetaMask et le robinet du réseau test Ropsten&quot;">
</div>
<div class="title">Figure 5. MetaMask et le robinet du réseau test Ropsten</div>
</div>
<div class="paragraph data-line-182">
<p>Vous remarquerez peut-être que la page Web contient déjà l&#39;adresse Ethereum de votre portefeuille MetaMask. MetaMask intègre les pages Web compatibles Ethereum avec votre portefeuille MetaMask et peut &quot;voir&quot; les adresses Ethereum sur la page Web, vous permettant, par exemple, d&#39;envoyer un paiement à une boutique en ligne affichant une adresse Ethereum. MetaMask peut également remplir la page Web avec l&#39;adresse de votre propre portefeuille en tant qu&#39;adresse de destinataire si la page Web le demande. Sur cette page, l&#39;application du robinet demande à MetaMask une adresse de portefeuille à laquelle envoyer de l&#39;ether de test.</p>
</div>
<div class="paragraph data-line-184">
<p>Cliquez sur le bouton vert &quot;demander 1 éther au robinet&quot;. Vous verrez un ID de transaction apparaître dans la partie inférieure de la page. L&#39;application robinet ou "faucet" a créé une transaction, un paiement qui vous est destiné. L&#39;ID de transaction ressemble à ceci :</p>
</div>
<div id="faucet_tx_id" class="listingblock data-line-187">
<div class="content">
<pre>0x7c7ad5aaea6474adccf6f5c5d6abed11b70a350fbc6f9590109e099568090c57</pre>
</div>
</div>
<div class="paragraph data-line-191">
<p>Dans quelques secondes, la nouvelle transaction sera exploitée par les mineurs de Ropsten et votre portefeuille MetaMask affichera un solde de 1 ETH. Cliquez sur l&#39;ID de transaction et votre navigateur vous amènera à un <em>explorateur de bloc</em>, qui est un site Web qui vous permet de visualiser et d&#39;explorer des blocs, des adresses et des transactions. MetaMask utilise <a href="https://etherscan.io/" data-href="https://etherscan.io/">Explorateur de blocs Etherscan</a>, l&#39;un des explorateurs de blocs Ethereum les plus populaires. La transaction contenant le paiement du Ropsten Test Faucet est affichée dans <a href="#ropsten_block_explorer">Explorateur de blocs Ropsten sur Etherscan</a>.</p>
</div>
<div id="ropsten_block_explorer" class="imageblock data-line-195">
<div class="content">
<img src="images/ropsten_block_explorer.png" alt="&quot;Explorateur de blocs Ropsten sur Etherscan&quot;">
</div>
<div class="title">Figure 6. Explorateur de blocs Ropsten sur Etherscan</div>
</div>
<div class="paragraph data-line-197">
<p>La transaction a été enregistrée sur la chaîne de blocs Ropsten et peut être consultée à tout moment par n&#39;importe qui, simplement en recherchant l&#39;ID de transaction, ou <a href="http://bit.ly/2Q860Wk" data-href="http://bit.ly/2Q860Wk">en visitant le lien</a>.</p>
</div>
<div class="paragraph data-line-199">
<p>Essayez de visiter ce lien ou de saisir le hachage de la transaction sur le site Web <em>ropsten.etherscan.io</em> pour le voir par vous-même.</p>
</div>
</div>
<div class="sect3 data-line-202">
<h4 id="sending_eth_MetaMask">Envoi d&#39;ether depuis MetaMask</h4>
<div class="paragraph data-line-204">
<p>Une fois que vous avez reçu votre premier test d&#39;ether du Ropsten Test Faucet, vous pouvez expérimenter l&#39;envoi d&#39;ether en essayant d&#39;en renvoyer au robinet. Comme vous pouvez le voir sur la page Ropsten Test Faucet, il existe une option pour &quot;donner&quot; 1 ETH au robinet. Cette option est disponible pour qu&#39;une fois que vous avez terminé les tests, vous puissiez retourner le reste de votre ether de test, afin que quelqu&#39;un d&#39;autre puisse l&#39;utiliser ensuite. Même si l&#39;ether de test n&#39;a aucune valeur, certaines personnes l&#8217;accumulent, ce qui rend difficile pour tout le monde d&#39;utiliser les réseaux de test. L&#8217;accumulation de l&#39;ether de test est mal vue !</p>
</div>
<div class="paragraph data-line-206">
<p>Heureusement, nous ne sommes pas des accumulateurs d&#39;éther de test. Cliquez sur le bouton orange &quot;1 ether&quot; pour dire à MetaMask de créer une transaction payant le robinet 1 ether. MetaMask préparera une transaction et ouvrira une fenêtre avec la confirmation, comme indiqué dans <a href="#send_to_faucet">Envoi de 1 éther au robinet</a>.</p>
</div>
<div id="send_to_faucet" class="imageblock data-line-211">
<div class="content">
<img src="images/send_to_faucet.png" alt="&quot;Envoi d&#39;1 ether au robinet&quot;">
</div>
<div class="title">Figure 7. Envoi de 1 éther au robinet</div>
</div>
<div class="paragraph data-line-213">
<p>Oups! Vous avez probablement remarqué que vous ne pouvez pas terminer la transaction - MetaMask indique que vous avez un solde insuffisant. À première vue, cela peut sembler déroutant : vous avez 1 ETH, vous voulez envoyer 1 ETH, alors pourquoi MetaMask dit-il que vous avez des fonds insuffisants ?</p>
</div>
<div class="paragraph data-line-215">
<p>La réponse est à cause du coût de <em>gaz</em>. Chaque transaction Ethereum nécessite le paiement d&#39;une redevance, qui est perçue par les mineurs pour valider la transaction. Les frais d&#39;Ethereum sont facturés dans une monnaie virtuelle appelée gaz. Vous payez le gaz avec de l&#39;ether, dans le cadre de la transaction.</p>
</div>
<div class="admonitionblock note data-line-218">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-219">
<p>Des frais sont également exigés sur les réseaux de test. Sans frais, un réseau de test se comporterait différemment du réseau principal, ce qui en ferait une plate-forme de test inadéquate. Les frais protègent également les réseaux de test des attaques DoS et des contrats mal construits (par exemple, des boucles infinies), tout comme ils protègent le réseau principal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-222">
<p>Lorsque vous avez envoyé la transaction, MetaMask a calculé le prix moyen du gaz des récentes transactions réussies à 3 gwei, ce qui signifie gigawei. Wei est la plus petite <span class="keep-together">subdivision</span> de la monnaie ether, comme nous l&#39;avons vu dans <a href="#ether_units">L&#8217;ether comme unité monétaire</a>. La limite de gaz est fixée au prix de l&#39;envoi d&#39;une transaction de base, soit 21 000 unités de gaz. Par conséquent, le montant maximum d&#39;ETH que vous dépenserez est de 3 * 21 000 gwei = 63 000 gwei = 0,000063 ETH. (Sachez que les prix moyens du gaz peuvent fluctuer, car ils sont principalement déterminés par les mineurs. Nous verrons dans un chapitre ultérieur comment vous pouvez augmenter/diminuer votre limite de gaz pour vous assurer que votre transaction a la priorité si nécessaire.)</p>
</div>
<div class="paragraph data-line-224">
<p>Tout cela pour dire : faire une transaction à 1 ETH coûte 1,000063 ETH. MetaMask arrondit de manière confuse au <em>plancher</em> d'1 ETH lors de l&#39;affichage du total, mais le montant réel dont vous avez besoin est de 1,000063 ETH et vous n&#39;avez que 1 ETH. Cliquez sur Reject pour annuler cette transaction.</p>
</div>
<div class="paragraph data-line-226">
<p>Prenons un peu plus d&#39;ether de test ! Cliquez à nouveau sur le bouton vert &quot;request 1 ether from the faucet&quot; et attendez quelques secondes. Ne vous inquiétez pas, le robinet devrait avoir beaucoup d&#39;ether et vous en donnera plus si vous le demandez.</p>
</div>
<div class="paragraph data-line-228">
<p>Une fois que vous avez un solde de 2 ETH, vous pouvez réessayer. Cette fois, lorsque vous cliquez sur le bouton de don orange &quot;1 ether&quot;, vous disposez d&#39;un solde suffisant pour finaliser la transaction. Cliquez sur Soumettre lorsque MetaMask apparaît dans la fenêtre de paiement. Après tout cela, vous devriez voir un solde de 0,999937 ETH car vous avez envoyé 1 ETH au robinet avec 0,000063 ETH en gaz.</p>
</div>
</div>
<div class="sect3 data-line-231">
<h4 id="explore_tx_history">Explorer l&#39;historique des transactions d&#39;une adresse</h4>
<div class="paragraph data-line-233">
<p>Vous êtes maintenant devenu un expert dans l&#39;utilisation de MetaMask pour envoyer et recevoir de l&#39;ether de test. Votre portefeuille a reçu au moins deux paiements et en a envoyé au moins un. Vous pouvez afficher toutes ces transactions à l&#39;aide de l&#39;explorateur de blocs <em>ropsten.etherscan.io</em>. Vous pouvez soit copier l&#39;adresse de votre portefeuille et la coller dans la zone de recherche de l&#39;explorateur de blocs, soit demander à MetaMask d&#39;ouvrir la page pour vous. À côté de l&#39;icône de votre compte dans MetaMask, vous verrez un bouton affichant trois points. Cliquez dessus pour afficher un menu d&#39;options liées au compte (voir <a href="#metamask_account_context_menu">Menu contextuel du compte MetaMask</a>).</p>
</div>
<div id="metamask_account_context_menu" class="imageblock data-line-237">
<div class="content">
<img src="images/metamask_account_context_menu.png" alt="&quot;Menu contextuel du compte MetaMask&quot;">
</div>
<div class="title">Figure 8. Menu contextuel du compte MetaMask</div>
</div>
<div class="paragraph data-line-239">
<p>Sélectionnez &quot;View account on Etherscan&quot; pour ouvrir une page Web dans l&#39;explorateur de blocs affichant l&#39;historique des transactions de votre compte, comme indiqué dans <a href="#block_explorer_account_history">Historique des transactions d&#8217;une adresse sur Etherscan</a>.</p>
</div>
<div id="block_explorer_account_history" class="imageblock data-line-243">
<div class="content">
<img src="images/block_explorer_account_history.png" alt="&quot;Historique des transactions d&#39;adresses sur Etherscan&quot;">
</div>
<div class="title">Figure 9. Historique des transactions d&#8217;une adresse sur Etherscan</div>
</div>
<div class="paragraph data-line-245">
<p>Ici, vous pouvez voir l&#39;historique complet des transactions de votre adresse Ethereum. Il montre toutes les transactions enregistrées sur la chaîne de blocs Ropsten où votre adresse est l&#39;expéditeur ou le destinataire. Cliquez sur quelques-unes de ces transactions pour voir plus de détails.</p>
</div>
<div class="paragraph data-line-247">
<p>Vous pouvez explorer l&#39;historique des transactions de n&#39;importe quelle adresse. Jetez un œil à l&#39;historique des transactions de l&#39;adresse Ropsten Test Faucet (indice : il s&#39;agit de l&#39;adresse « expéditeur » répertoriée dans le plus ancien paiement à votre adresse). Vous pouvez voir tout l&#39;ether de test envoyé par le robinet à vous et à d&#39;autres adresses. Chaque transaction que vous voyez peut vous mener à plus d&#39;adresses et plus de transactions. D&#39;ici peu, vous serez perdu dans le labyrinthe de données interconnectées. Les chaînes de blocs publiques contiennent une énorme richesse d&#39;informations, qui peuvent toutes être explorées par programmation, comme nous le verrons dans de futurs exemples.</p>
</div>
</div>
</div>
<div class="sect2 data-line-250">
<h3 id="intro_world_computer">Présentation de l&#39;ordinateur mondial</h3>
<div class="paragraph data-line-252">
<p> Vous avez maintenant créé un portefeuille et envoyé et reçu de l&#39;ether. Jusqu&#39;à présent, nous avons traité Ethereum comme une cryptomonnaie. Mais Ethereum est bien plus que cela. En fait, la fonction de cryptomonnaie est subordonnée à la fonction d&#39;Ethereum en tant qu&#39;ordinateur mondial décentralisé. L&#8217;ether est destiné à être utilisé pour payer l&#39;exécution de <em>contrats intelligents</em> aussi, qui sont des programmes informatiques qui s&#39;exécutent sur un ordinateur émulé appelé <em>Ethereum Virtual Machine</em> (EVM).</p>
</div>
<div class="paragraph data-line-254">
<p>L&#39;EVM est un singleton global, ce qui signifie qu&#39;il fonctionne comme s&#39;il s&#39;agissait d&#39;un ordinateur global à instance unique, fonctionnant partout. Chaque nœud du réseau Ethereum exécute une copie locale de l&#39;EVM pour valider l&#39;exécution du contrat, tandis que la blockchain Ethereum enregistre l&#39;état changeant de cet ordinateur mondial lorsqu&#39;il traite les transactions et les contrats intelligents. Nous en discuterons plus en détail dans <a href="#evm_chapter">La machine virtuelle Ethereum</a>.</p>
</div>
</div>
<div class="sect2 data-line-257">
<h3 id="EOA_contracts">Comptes détenus en externe (EOA ou Externally Owned Accounts) et contrats</h3>
<div class="paragraph data-line-259">
<p>Le type de compte que vous avez créé dans le portefeuille MetaMask est appelé un <em>compte détenu par une personne externe</em> (EOA ou Externally Owned Accounts). Les comptes détenus en externe sont ceux qui ont une clé privée ; avoir la clé privée signifie contrôler l&#39;accès aux fonds ou aux contrats. Maintenant, vous devinez probablement qu&#39;il existe un autre type de compte. Cet autre type de compte est un <em>compte de contrat</em>. Un compte de contrat a un code de contrat intelligent, ce qu&#39;un simple EOA ne peut pas avoir. De plus, un compte contractuel ne possède pas de clé privée. Au lieu de cela, il est détenu (et contrôlé) par la logique de son code de contrat intelligent : le programme logiciel enregistré sur la blockchain Ethereum lors de la création du compte de contrat et exécuté par l&#39;EVM.</p>
</div>
<div class="paragraph data-line-261">
<p>Les contrats ont des adresses, tout comme les EOA. Les contrats peuvent également envoyer et recevoir de l&#39;ether, tout comme les EOA. Cependant, lorsqu&#39;une destination de transaction est une adresse de contrat, cela provoque l&#39;exécution de ce contrat dans l&#39;EVM, en utilisant la transaction et les données de la transaction comme entrée. En plus d&#39;ether, les transactions peuvent contenir des <em>données</em> indiquant quelle fonction spécifique du contrat exécuter et quels paramètres transmettre à cette fonction. De cette façon, les transactions peuvent <em>appeler</em> des fonctions dans les contrats.</p>
</div>
<div class="paragraph data-line-263">
<p>Notez qu&#39;étant donné qu&#39;un compte de contrat n&#39;a pas de clé privée, il ne peut pas <em>initier</em> une transaction. Seuls les EOA peuvent initier des transactions, mais les contrats peuvent <em>réagir</em> aux transactions en appelant d&#39;autres contrats, en créant des chemins d&#39;exécution complexes. Une utilisation typique de ceci est un EOA envoyant une transaction de demande à un portefeuille de contrats intelligents multisignatures pour envoyer des ETH à une autre adresse. Un modèle de programmation DApp typique consiste à ce que le contrat A appelle le contrat B afin de maintenir un état partagé entre les utilisateurs du contrat A.</p>
</div>
<div class="paragraph data-line-265">
<p>Dans les prochaines sections, nous rédigerons notre premier contrat. Vous apprendrez ensuite comment créer, financer et utiliser ce contrat avec votre portefeuille MetaMask et tester l&#39;éther sur le réseau de test Ropsten.</p>
</div>
</div>
<div class="sect2 data-line-268">
<h3 id="exemple_contrat_simple">Un contrat simple : un robinet test d&#8217;ether</h3>
<div class="paragraph data-line-270">
<p> Ethereum possède de nombreux langages de haut niveau différents, qui peuvent tous être utilisés pour écrire un contrat et produire un code intermédiaire ou bytecode EVM. Vous pouvez lire sur bon nombre des plus importantes et des plus intéressantes dans <a href="#high_level_languages">Introduction aux langages de haut niveau Ethereum</a>. Un langage de haut niveau est de loin le choix dominant pour la programmation de contrats intelligents : Solidity. Solidity a été créé par le Dr Gavin Wood, le co-auteur de ce livre, et est devenu le langage le plus largement utilisé dans Ethereum (et au-delà). Nous utiliserons Solidity pour rédiger notre premier contrat.</p>
</div>
<div class="paragraph data-line-272">
<p>Pour notre premier exemple (<a href="#solidity_faucet_example">Faucet.sol: Un contrat Solidity mettant en place un robinet</a>), nous allons écrire un contrat qui contrôle un <em>robinet</em>. Vous avez déjà utilisé un robinet pour obtenir de l&#39;ether de test sur le réseau de test de Ropsten. Un robinet est une chose relativement simple: il donne de l&#39;ether à toute adresse qui le demande et peut être rempli périodiquement. Vous pouvez implémenter un robinet comme un portefeuille contrôlé par un humain ou un serveur Web.</p>
</div>
<div id="solidity_faucet_example" class="exampleblock data-line-276">
<div class="title">Example 1. Faucet.sol: Un contrat Solidity mettant en place un robinet</div>
<div class="content">
<div class="listingblock data-line-278">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity 0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note data-line-284">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-285">
<p>Vous trouverez tous les exemples de code pour ce livre dans le sous-répertoire <em>code</em> de <a href="https://github.com/ethereumbook/ethereumbook/" data-href="https://github.com/ethereumbook/ethereumbook/">le référentiel GitHub du livre</a>. Concrètement, notre contrat <em>Faucet.sol</em> est en:</p>
</div>
<div class="listingblock data-line-287">
<div class="content">
<pre>code/Solidity/Faucet.sol</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-292">
<p>Il s&#39;agit d&#39;un contrat très simple, à peu près aussi simple que possible. Il s&#39;agit également d&#39;un contrat <em>faussé</em>, démontrant un certain nombre de mauvaises pratiques et de failles de sécurité. Nous apprendrons en examinant tous ses défauts dans les sections suivantes. Mais pour l&#39;instant, regardons ce que fait ce contrat et comment il fonctionne, ligne par ligne. Vous remarquerez rapidement que de nombreux éléments de Solidity sont similaires aux langages de programmation existants, tels que JavaScript, Java ou C++.</p>
</div>
<div class="paragraph data-line-294">
<p>La première ligne est un commentaire :</p>
</div>
<div id="comment" class="listingblock data-line-298">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Notre premier contrat est un robinet (faucet) !</code></pre>
</div>
</div>
<div class="paragraph data-line-302">
<p>Les commentaires sont destinés à être lus par des humains et ne sont pas inclus dans le code intermédiaire exécutable de l&#8217;EVM. Nous les plaçons généralement sur la ligne avant le code que nous essayons d&#39;expliquer, ou parfois sur la même ligne. Les commentaires commencent par deux barres obliques : //. Tout, depuis la première barre oblique jusqu&#39;à la fin de cette ligne, est traité comme une ligne vide et ignoré.</p>
</div>
<div class="paragraph data-line-304">
<p>La ligne suivante est l&#39;endroit où notre contrat réel commence :</p>
</div>
<div id="contract_definition" class="listingblock data-line-308">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet {</code></pre>
</div>
</div>
<div class="paragraph data-line-312">
<p>Cette ligne déclare un objet contract, similaire à une déclaration class dans d&#39;autres langages orientés objet. La définition du contrat inclut toutes les lignes entre les accolades (<code>{}</code>), qui définissent une <em>portée</em>, un peu comme la façon dont les accolades sont utilisées dans de nombreux autres langages de programmation.</p>
</div>
<div class="paragraph data-line-314">
<p>Ensuite, nous déclarons la première fonction du contrat Faucet :</p>
</div>
<div id="withdraw_function" class="listingblock data-line-318">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function withdraw(uint withdraw_amount) public {</code></pre>
</div>
</div>
<div class="paragraph data-line-322">
<p>La fonction est nommée withdraw, et elle prend un argument entier non signé (uint) nommé withdraw_amount. Elle est déclarée fonction publique, c&#39;est-à-dire qu&#39;elle peut être appelée par d&#39;autres contrats. La définition de la fonction suit, entre accolades. La première partie de la fonction retirer fixe une limite aux retraits :</p>
</div>
<div id="withdraw_limit" class="listingblock data-line-326">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(withdraw_amount &lt;= 100000000000000000);</code></pre>
</div>
</div>
<div class="paragraph data-line-330">
<p>Il utilise la fonction intégrée Solidity require pour tester une condition préalable, que le withdraw_amount est inférieur ou égal à 100 000 000 000 000 000 wei, qui est l&#39;unité de base de l&#39;ether (voir <a href="#ether_denominations">Dénominations d&#8217;ether et noms d&#39;unités</a>) et équivalent à 0,1 ether. Si la fonction withdraw est appelée avec un withdraw_amount supérieur à ce montant, la fonction require provoquera ici l&#39;arrêt et l&#39;échec de l&#39;exécution du contrat avec une <em>exception</em>. Notez que les instructions doivent se terminer par un point-virgule dans Solidity.</p>
</div>
<div class="paragraph data-line-332">
<p>Cette partie du contrat est la logique principale de notre robinet. Il contrôle le flux de fonds hors du contrat en imposant une limite aux retraits. C&#39;est un contrôle très simple mais qui peut vous donner un aperçu de la puissance d&#39;une chaîne de blocs programmable : un logiciel décentralisé contrôlant l&#39;argent.</p>
</div>
<div class="paragraph data-line-334">
<p>Vient ensuite le retrait proprement dit :</p>
</div>
<div id="withdraw_command" class="listingblock data-line-338">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-342">
<p>Quelques choses intéressantes se passent ici. L&#39;objet msg est l&#39;une des entrées auxquelles tous les contrats peuvent accéder. Il représente la transaction qui a déclenché l&#39;exécution de ce contrat. L&#39;attribut sender est l&#39;adresse de l&#39;expéditeur de la transaction. La fonction transfer est une fonction intégrée qui transfère l&#39;ether du contrat actuel à l&#39;adresse de l&#39;expéditeur. En le lisant à l&#39;envers, cela signifie transfert vers l&#39;+expéditeur+ du msg qui a déclenché l&#39;exécution de ce contrat. La fonction transfer prend un montant comme seul argument. Nous passons la valeur withdraw_amount qui était le paramètre à la fonction withdraw déclarée quelques lignes plus tôt.</p>
</div>
<div class="paragraph data-line-344">
<p>La ligne suivante est l&#39;accolade fermante, indiquant la fin de la définition de notre fonction withdraw.</p>
</div>
<div class="paragraph data-line-346">
<p>Ensuite, nous déclarons une autre fonction :</p>
</div>
<div id="fallback_function" class="listingblock data-line-350">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function () external payable {}</code></pre>
</div>
</div>
<div class="paragraph data-line-354">
<p>Cette fonction est une fonction dite de <em>secours</em> ou de <em>fallback</em> (ou <em>default</em>), qui est appelée si la transaction qui a déclenché le contrat n&#39;a nommé aucune des fonctions déclarées dans le contrat, ou aucune fonction du tout , ou ne contenait pas de données. Les contrats peuvent avoir une telle fonction par défaut (sans nom) et c&#39;est généralement celle qui reçoit l&#39;ether. C&#39;est pourquoi il est défini comme une fonction externe et payante, ce qui signifie qu&#39;il peut accepter de l&#39;ether dans le contrat. Il ne fait rien d&#39;autre que d&#39;accepter l&#39;ether, comme indiqué par la définition vide entre les accolades (<code>{}</code>). Si nous effectuons une transaction qui envoie de l&#39;ether à l&#39;adresse du contrat, comme s&#39;il s&#39;agissait d&#39;un portefeuille, cette fonction s&#39;en chargera.</p>
</div>
<div class="paragraph data-line-356">
<p>Juste en dessous de notre fonction par défaut se trouve l&#39;accolade fermante finale, qui ferme la définition du contrat Faucet. C&#39;est tout !</p>
</div>
</div>
<div class="sect2 data-line-359">
<h3 id="compile_faucet_contract">Compilation du contrat de robinet</h3>
<div class="paragraph data-line-361">
<p>Maintenant que nous avons notre premier exemple de contrat, nous devons utiliser un compilateur Solidity pour convertir le code Solidity en code intermédiaire/bytecode EVM afin qu&#39;il puisse être exécuté par l&#39;EVM sur la chaîne de blocs elle-même .</p>
</div>
<div class="paragraph data-line-363">
<p>Le compilateur Solidity se présente sous la forme d&#39;un exécutable autonome, dans le cadre de divers frameworks, et regroupé dans des environnements de développement intégrés (IDE). Pour garder les choses simples, nous utiliserons l&#39;un des IDE les plus populaires, appelé <em>Remix</em>.</p>
</div>
<div class="paragraph data-line-365">
<p>Utilisez votre navigateur Chrome (avec le portefeuille MetaMask que vous avez installé précédemment) pour accéder à l&#39;IDE Remix à l&#39;adresse <a href="https://remix.ethereum.org" class="undefined" data-href="https://remix.ethereum.org">https://remix.ethereum.org</a>.</p>
</div>
<div class="paragraph data-line-367">
<p>Lorsque vous chargez Remix pour la première fois, il démarre avec un exemple de contrat appelé <em>ballot.sol</em>. Nous n&#39;en avons pas besoin, alors fermez-le en cliquant sur le x dans le coin de l&#39;onglet, comme indiqué dans <a href="#remix_close_tab">Fermer l&#39;onglet d&#39;exemple par défaut</a>.</p>
</div>
<div id="remix_close_tab" class="imageblock data-line-371">
<div class="content">
<img src="images/remix_close_tab.png" alt="&quot;Fermer l&#39;onglet d&#39;exemple par défaut&quot;">
</div>
<div class="title">Figure 10. Fermer l&#39;onglet d&#39;exemple par défaut</div>
</div>
<div class="paragraph data-line-373">
<p>Maintenant, ajoutez un nouvel onglet en cliquant sur le signe plus circulaire dans la barre d&#39;outils en haut à gauche, comme indiqué dans <a href="#remix_toolbar">Cliquez sur le signe plus pour ouvrir un nouvel onglet</a>. Nommez le nouveau fichier <em>Faucet.sol</em>.</p>
</div>
<div id="remix_toolbar" class="imageblock data-line-377">
<div class="content">
<img src="images/remix_toolbar.png" alt="&quot;Cliquez sur le signe plus pour ouvrir un nouvel onglet&quot;">
</div>
<div class="title">Figure 11. Cliquez sur le signe plus pour ouvrir un nouvel onglet</div>
</div>
<div class="paragraph data-line-379">
<p>Une fois que vous avez ouvert le nouvel onglet, copiez et collez le code de notre exemple <em>Faucet.sol</em>, comme indiqué dans <a href="#remix_faucet_load">Copiez l&#39;exemple de code Faucet dans le nouvel onglet</a>.</p>
</div>
<div id="remix_faucet_load" class="imageblock data-line-383">
<div class="content">
<img src="images/remix_faucet_load.png" alt="&quot;Copiez l&#39;exemple de code Faucet dans le nouvel onglet&quot;">
</div>
<div class="title">Figure 12. Copiez l&#39;exemple de code Faucet dans le nouvel onglet</div>
</div>
<div class="paragraph data-line-385">
<p>Une fois que vous avez chargé le contrat <em>Faucet.sol</em> dans l&#39;IDE Remix, l&#39;IDE compilera automatiquement le code. Si tout se passe bien, vous verrez une boîte verte avec &quot;Faucet&quot; dedans apparaître à droite, sous l&#39;onglet Compiler, confirmant la compilation réussie (voir <a href="#remix_compile">Remix compile avec succès le contrat Faucet.sol</a>).</p>
</div>
<div id="remix_compile" class="imageblock data-line-389">
<div class="content">
<img src="images/remix_compile.png" alt="&quot;&quot;">
</div>
<div class="title">Figure 13. Remix compile avec succès le contrat Faucet.sol</div>
</div>
<div class="paragraph data-line-391">
<p>Si quelque chose ne va pas, le problème le plus probable est que l&#39;IDE Remix utilise une version du compilateur Solidity différente de 0.5.12. Dans ce cas, notre directive pragma empêchera <em>Faucet.sol</em> de se compiler. Pour modifier la version du compilateur, accédez à l&#39;onglet Paramètres, définissez la version sur 0.5.12 et réessayez.</p>
</div>
<div class="paragraph data-line-393">
<p>Le compilateur Solidity a maintenant compilé notre <em>Faucet.sol</em> en code intermédiaire EVM. Si vous êtes curieux, le code intermédiaire ressemble à ceci :</p>
</div>
<div id="faucet_bytecode" class="listingblock data-line-396">
<div class="content">
<pre>PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH2 0xF JUMPI PUSH1 0x0 DUP1
REVERT JUMPDEST PUSH1 0xE5 DUP1 PUSH2 0x1D PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN
STOP PUSH1 0x60 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3F JUMPI
PUSH1 0x0 CALLDATALOAD PUSH29
0x100000000000000000000000000000000000000000000000000000000
SWAP1 DIV PUSH4 0xFFFFFFFF AND DUP1 PUSH4 0x2E1A7D4D EQ PUSH1 0x41 JUMPI
JUMPDEST STOP JUMPDEST CALLVALUE ISZERO PUSH1 0x4B JUMPI PUSH1 0x0 DUP1 REVERT
JUMPDEST PUSH1 0x5F PUSH1 0x4 DUP1 DUP1 CALLDATALOAD SWAP1 PUSH1 0x20 ADD SWAP1
SWAP2 SWAP1 POP POP PUSH1 0x61 JUMP JUMPDEST STOP JUMPDEST PUSH8
0x16345785D8A0000 DUP2 GT ISZERO ISZERO ISZERO PUSH1 0x77 JUMPI PUSH1 0x0 DUP1
REVERT JUMPDEST CALLER PUSH20 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF AND
PUSH2 0x8FC DUP3 SWAP1 DUP2 ISZERO MUL SWAP1 PUSH1 0x40 MLOAD PUSH1 0x0 PUSH1
0x40 MLOAD DUP1 DUP4 SUB DUP2 DUP6 DUP9 DUP9 CALL SWAP4 POP POP POP POP ISZERO
ISZERO PUSH1 0xB6 JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP JUMP STOP LOG1 PUSH6
0x627A7A723058 KECCAK256 PUSH9 0x13D1EA839A4438EF75 GASLIMIT CALLVALUE LOG4 0x5f
PUSH24 0x7541F409787592C988A079407FB28B4AD000290000000000</pre>
</div>
</div>
<div class="paragraph data-line-415">
<p>N&#39;êtes-vous pas content d&#39;utiliser un langage de haut niveau comme Solidity au lieu de programmer directement en code intermédiaire EVM ? Moi aussi !</p>
</div>
</div>
<div class="sect2 data-line-418">
<h3 id="create_contract">Création du contrat sur la chaîne de blocs</h3>
<div class="paragraph data-line-420">
<p>Donc, nous avons un contrat. Nous l&#39;avons compilé en code intermédiaire. Maintenant, nous devons &quot;enregistrer&quot; le contrat sur la chaîne de blocs Ethereum. Nous utiliserons le testnet de Ropsten pour tester notre contrat, c&#39;est donc la chaîne de blocs à laquelle nous voulons le soumettre.</p>
</div>
<div class="paragraph data-line-422">
<p>L&#39;enregistrement d&#39;un contrat sur la chaîne de blocs implique la création d&#39;une transaction spéciale dont la destination est l&#39;adresse 0x00000000000000000000000000000000000000, également appelée <em>zero address</em> ou l'<em>adresse zéro</em>. L&#39;adresse zéro est une adresse spéciale qui indique à la chaîne de blocs Ethereum que vous souhaitez enregistrer un contrat. Heureusement, l&#39;IDE Remix s&#39;occupera de tout cela pour vous et enverra la transaction à MetaMask.</p>
</div>
<div class="paragraph data-line-424">
<p>Tout d&#39;abord, passez à l&#39;onglet Run et sélectionnez Injected Web3 dans la zone de sélection déroulante Environment. Cela connecte l&#39;IDE Remix au portefeuille MetaMask et, via MetaMask, au réseau de test Ropsten. Une fois que vous faites cela, vous pouvez voir Ropsten sous Environment. De plus, dans la zone de sélection du compte, il indique l&#39;adresse de votre portefeuille (voir <a href="#remix_run">Onglet Run du IDE Remix, avec l&#39;environnement Injected Web3 sélectionné</a>).</p>
</div>
<div id="remix_run" class="imageblock data-line-428">
<div class="content">
<img src="images/remix_run.png" alt="&quot;Onglet Run du IDE Remix" width="avec l&#39;environnement Injected Web3 sélectionné&quot;">
</div>
<div class="title">Figure 14. Onglet Run du IDE Remix, avec l&#39;environnement Injected Web3 sélectionné</div>
</div>
<div class="paragraph data-line-430">
<p>Juste en dessous des paramètres d&#39;exécution que vous venez de confirmer se trouve le contrat Faucet, prêt à être créé. Cliquez sur le bouton Deploy affiché dans <a href="#remix_run">Onglet Run du IDE Remix, avec l&#39;environnement Injected Web3 sélectionné</a>.</p>
</div>
<div class="paragraph data-line-432">
<p>Remix construira la transaction spéciale &quot;création&quot; et MetaMask vous demandera de l&#39;approuver, comme indiqué dans <a href="#remix_metamask_create">MetaMask montrant la transaction de création de contrat</a>. Vous remarquerez que la transaction de création de contrat ne contient pas d&#39;ether, mais qu&#39;elle contient 262 octets de données (le contrat compilé) et consommera 10 gwei en gaz. Cliquez sur Soumettre pour l&#39;approuver.</p>
</div>
<div id="remix_metamask_create" class="imageblock data-line-436">
<div class="content">
<img src="images/remix_metamask_create.png" alt="&quot;MetaMask montrant la transaction de création de contrat&quot;">
</div>
<div class="title">Figure 15. MetaMask montrant la transaction de création de contrat</div>
</div>
<div class="paragraph data-line-438">
<p>Maintenant, vous devez attendre. Il faudra environ 15 à 30 secondes pour que le contrat soit miné sur Ropsten. Remix ne semblera pas faire grand-chose, mais soyez patient.</p>
</div>
<div class="paragraph data-line-440">
<p>Une fois le contrat créé, il apparaît en bas de l&#39;onglet Run (voir <a href="#remix_contract_interact">Le contrat Faucet est VIVANT !</a>).</p>
</div>
<div id="remix_contract_interact" class="imageblock data-line-444">
<div class="content">
<img src="images/remix_contract_interact.png" alt="&quot;Le contrat Faucet est VIVANT !&quot;">
</div>
<div class="title">Figure 16. Le contrat Faucet est VIVANT !</div>
</div>
<div class="paragraph data-line-446">
<p>Notez que le contrat Faucet a maintenant sa propre adresse : Remix l&#39;affiche comme &quot;Faucet à 0x72e&#8230;&#8203;c7829&quot; (bien que votre adresse, les lettres et les chiffres aléatoires, soient différents). Le petit symbole de presse-papiers à droite vous permet de copier l&#39;adresse du contrat dans votre presse-papiers. Nous l&#39;utiliserons dans la section suivante.</p>
</div>
</div>
<div class="sect2 data-line-449">
<h3 id="interact_contract">Interagir avec le contrat</h3>
<div class="paragraph data-line-451">
<p>Récapitulons ce que nous avons appris jusqu&#39;à présent : les contrats Ethereum sont des programmes qui contrôler l&#39;argent, qui s&#39;exécutent à l&#39;intérieur d&#39;une machine virtuelle appelée EVM. Ils sont créés par une transaction spéciale qui soumet leur code intermédiaire à enregistrer sur la chaîne de blocs. Une fois créés sur la chaîne de blocs, ils ont une adresse Ethereum, tout comme les portefeuilles. Chaque fois que quelqu&#39;un envoie une transaction à une adresse de contrat, le contrat s&#39;exécute dans l&#39;EVM, avec la transaction en entrée. Transactions envoyées pour les adresses de  <span class="keep-together">contrat</span> peuvent contenir de l&#39;ether ou des données ou les deux. S&#39;ils contiennent de l&#39;ether, il est &quot;déposé&quot; sur le solde du contrat. S&#39;ils contiennent des données, les données peuvent spécifier une fonction nommée dans le contrat et l&#39;appeler, en transmettant des arguments à la fonction.</p>
</div>
<div class="sect3 data-line-454">
<h4 id="view_contract_address">Affichage de l&#39;adresse du contrat dans un explorateur de blocs</h4>
<div class="paragraph data-line-456">
<p>Nous avons maintenant un contrat enregistré sur la chaîne de blocs, et nous pouvons voir qu&#39;il a une adresse Ethereum. Vérifions-le dans l&#39;explorateur de blocs <em>ropsten.etherscan.io</em> et voyons à quoi ressemble un contrat. Dans l&#39;IDE Remix, copiez l&#39;adresse du contrat en cliquant sur l&#39;icône du presse-papiers à côté de son nom (voir <a href="#remix_contract_address">Copiez l&#39;adresse du contrat de Remix</a>).</p>
</div>
<div id="remix_contract_address" class="imageblock data-line-460">
<div class="content">
<img src="images/remix_contract_address.png" alt="&quot;Copier l&#39;adresse du contrat depuis Remix&quot;">
</div>
<div class="title">Figure 17. Copiez l&#39;adresse du contrat de Remix</div>
</div>
<div class="paragraph data-line-462">
<p>Gardez Remix ouvert ; nous y reviendrons plus tard. Maintenant, naviguez dans votre navigateur jusqu&#39;à <em>ropsten.etherscan.io</em> et collez l&#39;adresse dans le champ de recherche. Vous devriez voir l&#39;historique des adresses Ethereum du contrat, comme indiqué dans <a href="#etherscan_contract_address">Afficher l&#39;adresse du contrat Faucet dans l&#39;explorateur de blocs Etherscan</a>.</p>
</div>
<div id="etherscan_contract_address" class="imageblock data-line-466">
<div class="content">
<img src="images/etherscan_contract_address.png" alt="&quot;Afficher l&#39;adresse du contrat Faucet dans l&#39;explorateur de blocs etherscan&quot;">
</div>
<div class="title">Figure 18. Afficher l&#39;adresse du contrat Faucet dans l&#39;explorateur de blocs Etherscan</div>
</div>
</div>
<div class="sect3 data-line-469">
<h4 id="fund_contract">Financement du contrat</h4>
<div class="paragraph data-line-471">
<p>Pour l&#39;instant, le contrat n&#39;a qu&#39;une seule transaction dans son historique : l&#8217;opération de création de contrat. Comme vous pouvez le voir, le contrat n&#39;a pas non plus d&#39;ether (solde nul). C&#39;est parce que nous n&#39;avons pas envoyé d&#39;éther au contrat dans la transaction de création, même si nous aurions pu le faire.</p>
</div>
<div class="paragraph data-line-473">
<p>Notre robinet a besoin de fonds ! Notre premier projet sera d&#39;utiliser MetaMask pour envoyer de l&#39;ether au contrat. Vous devriez toujours avoir l&#39;adresse du contrat dans votre presse-papiers (sinon, copiez-la à nouveau depuis Remix). Ouvrez MetaMask et envoyez-lui 1 éther, exactement comme vous le feriez à n&#39;importe quelle autre adresse Ethereum (voir <a href="#metamask_send_to_contract">Envoyer 1 ether à l&#39;adresse du contrat</a>).</p>
</div>
<div id="metamask_send_to_contract" class="imageblock data-line-477">
<div class="content">
<img src="images/metamask_send_to_contract.png" alt="&quot;&quot;">
</div>
<div class="title">Figure 19. Envoyer 1 ether à l&#39;adresse du contrat</div>
</div>
<div class="paragraph data-line-479">
<p>Dans une minute, si vous rechargez l&#39;explorateur de blocs Etherscan, il affichera une autre transaction à l&#39;adresse du contrat et un solde mis à jour de 1 ether.</p>
</div>
<div class="paragraph data-line-481">
<p>Vous souvenez-vous de la fonction de paiement externe par défaut sans nom dans notre code <em>Faucet.sol</em> ? Ça ressemblait à ça :</p>
</div>
<div id="fallback_function_review" class="listingblock data-line-485">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function () external payable {}</code></pre>
</div>
</div>
<div class="paragraph data-line-489">
<p>Lorsque vous avez envoyé une transaction à l&#39;adresse du contrat, sans données spécifiant la fonction à appeler, elle a appelé cette fonction par défaut. Parce que nous l&#39;avons déclaré comme payable, il a accepté et déposé le 1 éther dans le solde du compte du contrat. Votre transaction a entraîné l&#39;exécution du contrat dans l&#39;EVM, mettant à jour son solde. Vous avez financé votre robinet !</p>
</div>
</div>
<div class="sect3 data-line-492">
<h4 id="withdraw_from_contract">Faire un retrait sur notre contrat</h4>
<div class="paragraph data-line-494">
<p>Ensuite, retirons des fonds du robinet. Pour retirer, nous devons construire une transaction qui appelle la fonction withdraw et lui passe un argument withdraw_amount. Pour garder les choses simples pour le moment, Remix construira cette transaction pour nous et MetaMask la présentera pour notre approbation.</p>
</div>
<div class="paragraph data-line-496">
<p>Revenez à l&#39;onglet Remix et consultez le contrat dans l&#39;onglet Run. Vous devriez voir une boîte orange intitulée wthdraw (retrait) avec une entrée de champ intitulée uint256 withdraw_amount (voir <a href="#remix_contract_withdraw">La fonction de retrait (withdraw) de Faucet.sol, dans Remix</a>).</p>
</div>
<div id="remix_contract_withdraw" class="imageblock data-line-500">
<div class="content">
<img src="images/remix_contract_interact.png" alt="&quot;La fonction de retrait (withdraw) de Faucet.sol" width="dans Remix&quot;">
</div>
<div class="title">Figure 20. La fonction de retrait (withdraw) de Faucet.sol, dans Remix</div>
</div>
<div class="paragraph data-line-502">
<p>Il s&#39;agit de l&#39;interface Remix du contrat. Il nous permet de construire des transactions qui appellent les fonctions définies dans le contrat. Nous entrerons un withdraw_amount et cliquerons sur le bouton de retrait pour générer la transaction.</p>
</div>
<div class="paragraph data-line-504">
<p>Tout d&#39;abord, déterminons le withdraw_amount (montant de retrait). Nous voulons essayer de retirer 0,1 éther, qui est le montant maximum autorisé par notre contrat. N&#39;oubliez pas que toutes les valeurs monétaires d&#39;Ethereum sont libellées en wei en interne, et notre fonction withdraw s&#39;attend à ce que le withdraw_amount soit également libellé en wei. La quantité que nous voulons est de 0,1 éther, soit 100 000 000 000 000 000 wei (un 1 suivi de 17 zéros).</p>
</div>
<div class="admonitionblock tip data-line-509">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-510">
<p>En raison d&#39;une limitation de JavaScript, un nombre aussi grand que 10<sup>17</sup> ne peut pas être traité par Remix. Au lieu de cela, nous l&#39;entourons de guillemets doubles, pour permettre à Remix de le recevoir sous forme de chaîne et de le manipuler comme un BigNumber. Si nous ne le mettons pas entre guillemets, l&#39;IDE Remix ne parviendra pas à le traiter et affichera &quot;Error encoding arguments: Error: Assertion failed.&quot;</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-513">
<p>Tapez &quot;100000000000000000&quot; (avec les guillemets) dans la case withdraw_amount et cliquez sur le bouton de retrait (voir <a href="#remix_withdraw">Cliquez sur &quot;withdraw&quot; dans Remix pour créer une transaction de retrait</a>).</p>
</div>
<div id="remix_withdraw" class="imageblock data-line-517">
<div class="content">
<img src="images/remix_withdraw.png" alt="&quot;&quot;">
</div>
<div class="title">Figure 21. Cliquez sur &quot;withdraw&quot; dans Remix pour créer une transaction de retrait</div>
</div>
<div class="paragraph data-line-519">
<p>MetaMask fera apparaître une fenêtre de transaction que vous devrez approuver. Cliquez sur Confirmer pour envoyer votre appel de retrait au contrat (voir <a href="#metamask_withdraw">Transaction MetaMask pour appeler la fonction de retrait</a>).</p>
</div>
<div id="metamask_withdraw" class="imageblock data-line-523">
<div class="content">
<img src="images/metamask_withdraw.png" alt="&quot;Transaction MetaMask pour appeler la fonction de retrait&quot;">
</div>
<div class="title">Figure 22. Transaction MetaMask pour appeler la fonction de retrait</div>
</div>
<div class="paragraph data-line-525">
<p>Attendez une minute, puis rechargez l&#39;explorateur de blocs Etherscan pour voir la transaction reflétée dans l&#39;historique des adresses de contrat + Faucet + (voir <a href="#etherscan_withdrawal_tx">Etherscan montre la transaction appelant la fonction de retrait</a>).</p>
</div>
<div id="etherscan_withdrawal_tx" class="imageblock data-line-529">
<div class="content">
<img src="images/etherscan_withdrawal_tx.png" alt="&quot;Etherscan affiche la transaction appelant la fonction de retrait&quot;">
</div>
<div class="title">Figure 23. Etherscan montre la transaction appelant la fonction de retrait</div>
</div>
<div class="paragraph data-line-532">
<p>Nous voyons maintenant une nouvelle transaction avec l&#39;adresse du contrat comme destination et une valeur de 0 éther. Le solde du contrat a changé et est maintenant de 0,9 éther car il nous a envoyé 0,1 éther comme demandé. Mais nous ne voyons pas de transaction &quot;OUT&quot; dans l&#39;_historique des adresses de contrat_.</p>
</div>
<div class="paragraph data-line-534">
<p>Où est le retrait sortant ? Un nouvel onglet est apparu sur la page d&#39;historique des adresses du contrat, nommé Transactions internes. Parce que le transfert d&#39;éther 0.1 provient du code de contrat, il s&#39;agit d&#39;une transaction interne (également appelée <em>message</em>). Cliquez sur cet onglet pour le voir (voir <a href="#etherscan_withdrawal_internal">Etherscan montre la transaction interne transférant l&#39;ether du contrat</a>).</p>
</div>
<div class="paragraph data-line-537">
<p>Cette &quot;transaction interne&quot; a été envoyée par le contrat dans cette ligne de code (à partir de la fonction <code><span class="keep-together">withdraw</span></code> dans <em>Faucet.sol</em>) :</p>
</div>
<div id="withdraw_command_review" class="listingblock data-line-541">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-545">
<p>Pour récapituler : vous avez envoyé une transaction depuis votre portefeuille MetaMask contenant des instructions de données pour appeler la fonction withdraw avec un argument withdraw_amount de 0,1 ether. Cette transaction a entraîné l&#39;exécution du contrat à l&#39;intérieur de l&#39;EVM. Lorsque l&#39;EVM a exécuté la fonction withdraw du contrat Faucet, il a d&#39;abord appelé la fonction require et validé que le montant demandé était inférieur ou égal au retrait maximal autorisé de 0,1 éther. Ensuite, il a appelé la fonction transfer pour vous envoyer l&#39;éther. L&#39;exécution de la fonction transfer a généré une transaction interne qui a déposé 0,1 éther dans votre adresse de portefeuille, à partir du solde du contrat. C&#39;est celui affiché sur l&#39;onglet Internal Transactions dans Etherscan. </p>
</div>
<div id="etherscan_withdrawal_internal" class="imageblock data-line-549">
<div class="content">
<img src="images/etherscan_withdrawal_internal.png" alt="&quot;Etherscan montre la transaction interne transférant l&#39;éther hors du contrat&quot;">
</div>
<div class="title">Figure 24. Etherscan montre la transaction interne transférant l&#39;ether du contrat</div>
</div>
</div>
</div>
<div class="sect2 data-line-552">
<h3 id="intro_conclusion">Conclusion</h3>
<div class="paragraph data-line-554">
<p>Dans ce chapitre, vous avez configuré un portefeuille à l&#39;aide de MetaMask et l&#39;avez financé à l&#39;aide d&#39;un robinet sur le réseau de test Ropsten. Vous avez reçu de l&#39;ether dans l&#39;adresse Ethereum de votre portefeuille, puis vous avez envoyé de l&#39;ether à l&#39;adresse du robinet Ethereum.</p>
</div>
<div class="paragraph data-line-556">
<p>Ensuite, vous avez écrit un contrat de robinet dans Solidity. Vous avez utilisé l&#39;IDE Remix pour compiler le contrat en code intermédiaire EVM, puis utilisé Remix pour former une transaction et créé le contrat Faucet sur la chaîne de blocs Ropsten. Une fois créé, le contrat Faucet avait une adresse Ethereum, et vous lui avez envoyé de l&#39;ether. Enfin, vous avez construit une transaction pour appeler la fonction withdraw et demandé avec succès 0,1 éther. Le contrat a vérifié la demande et vous a envoyé 0,1 ether avec une transaction interne.</p>
</div>
<div class="paragraph data-line-558">
<p>Cela peut ne pas sembler beaucoup, mais vous venez d&#39;interagir avec succès avec un logiciel qui contrôle l&#39;argent sur un ordinateur mondial décentralisé.</p>
</div>
<div class="paragraph data-line-7">
<p>Nous ferons beaucoup plus de programmation de contrats intelligents dans <a href="#smart_contracts_chapter">Contrats intelligents et Solidity</a> et découvrirons les meilleures pratiques et les considérations de sécurité dans <a href="#smart_contract_security">Sécurité des contrats intelligents</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="ethereum_clients_chapter">Clients Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Un client Ethereum est une application logicielle qui implémente la spécification Ethereum et communique sur le réseau pair à pair avec d&#39;autres clients Ethereum. Différents clients Ethereum <em>interopèrent</em> s&#39;ils respectent la spécification de référence et les protocoles de communication standardisés. Bien que ces différents clients soient implémentés par des équipes différentes et dans des langages de programmation différents, ils « parlent » tous le même protocole et suivent les mêmes règles. En tant que tels, ils peuvent tous être utilisés pour fonctionner et interagir avec le même réseau Ethereum.</p>
</div>
<div class="paragraph data-line-6">
<p>Ethereum est un projet à source libre, et le code source de tous les principaux clients est disponible sous des licences à source libre (par exemple, LGPL v3.0), téléchargeable et utilisable à n&#39;importe quelle fin. <em>Source libre</em> signifie cependant plus que simplement libre d&#39;utilisation. Cela signifie également qu&#39;Ethereum est développé par une communauté ouverte de volontaires et peut être modifié par n&#39;importe qui. Plus d&#39;yeux signifie un code plus fiable.</p>
</div>
<div class="paragraph data-line-8">
<p>Ethereum est défini par une spécification formelle appelée le &quot;Papier jaune&quot; (voir <a href="#references">Lectures complémentaires</a>).</p>
</div>
<div class="paragraph data-line-10">
<p>Cela contraste avec, par exemple, Bitcoin, qui n&#39;est pas défini de manière formelle. Là où la &quot;spécification&quot; de Bitcoin est l&#39;implémentation de référence de Bitcoin Core, la spécification d&#39;Ethereum est documentée dans un article qui combine une spécification anglaise et une spécification mathématique (formelle). Cette spécification formelle, en plus de diverses propositions d&#39;amélioration Ethereum, définit le comportement standard d&#39;un <span class="keep-together">client</span> Ethereum. Le livre jaune est périodiquement mis à jour au fur et à mesure que des modifications majeures sont apportées à <span class="keep-together">Ethereum</span>.</p>
</div>
<div class="paragraph data-line-12">
<p>En raison de la spécification formelle claire d&#39;Ethereum, il existe un certain nombre d&#39;implémentations logicielles développées indépendamment, mais interopérables, d&#39;un client Ethereum. Ethereum a une plus grande diversité d&#39;implémentations fonctionnant sur le réseau que toute autre blockchain, ce qui est généralement considéré comme une bonne chose. En effet, il s&#39;est avéré, par exemple, être un excellent moyen de se défendre contre les attaques sur le réseau, car l&#39;exploitation de la stratégie de mise en œuvre d&#39;un client particulier ne fait qu&#39;embêter les développeurs pendant qu&#39;ils corrigent l&#39;exploit, tandis que d&#39;autres clients maintiennent le réseau en marche presque sans être affecté.</p>
</div>
<div class="sect2 data-line-14">
<h3 id="_réseaux_ethereum">Réseaux Ethereum</h3>
<div class="paragraph data-line-16">
<p>Il existe une variété de réseaux basés sur Ethereum qui sont largement conformes à la spécification formelle définie dans le livre jaune Ethereum, mais qui peuvent ou non interagir les uns avec les autres.</p>
</div>
<div class="paragraph data-line-18">
<p>Parmi ces réseaux basés sur Ethereum figurent Ethereum, Ethereum Classic, Ella, Expanse, Ubiq, Musicoin et bien d&#39;autres. Bien qu&#39;ils soient généralement compatibles au niveau du protocole, ces réseaux ont souvent des fonctionnalités ou des attributs qui obligent les mainteneurs du logiciel client Ethereum à apporter de petites modifications afin de prendre en charge chaque réseau. Pour cette raison, toutes les versions du logiciel client Ethereum n&#39;exécutent pas toutes les chaînes de blocs basées sur Ethereum.</p>
</div>
<div class="paragraph data-line-20">
<p>Actuellement, il existe six implémentations principales du protocole Ethereum, écrites dans six langages différents :</p>
</div>
<div class="ulist data-line-22">
<ul>
<li class="data-line-22">
<p>Parity, écrite en Rust</p>
</li>
<li class="data-line-23">
<p>Geth, écrit en Go</p>
</li>
<li class="data-line-24">
<p>cpp-ethereum, écrit en C++</p>
</li>
<li class="data-line-25">
<p>pyethereum, écrit en Python</p>
</li>
<li class="data-line-26">
<p>Mantis, écrit en Scala</p>
</li>
<li class="data-line-27">
<p>Harmony, écrit en Java</p>
</li>
</ul>
</div>
<div class="paragraph data-line-29">
<p>Dans cette section, nous examinerons les deux clients les plus courants, Parity et Geth. Nous montrerons comment configurer un nœud à l&#39;aide de chaque client et explorerons certaines de leurs options de ligne de commande et interfaces de programmation d&#39;application (API).</p>
</div>
<div class="sect3 data-line-32">
<h4 id="full_node_importance">Dois-je exécuter un nœud complet ?</h4>
<div class="paragraph data-line-34">
<p>La santé, la résilience et la résistance à la censure des chaînes de blocs dépendent de leur nombre de nœuds complets exploités indépendamment et dispersés géographiquement. Chaque nœud complet peut aider d&#39;autres nouveaux nœuds à obtenir les données de bloc pour amorcer leur fonctionnement, tout en offrant à l&#39;opérateur une vérification faisant autorité et indépendante de toutes les transactions et contrats.</p>
</div>
<div class="paragraph data-line-36">
<p>Cependant, l&#39;exécution d&#39;un nœud complet entraînera un coût en ressources matérielles et en bande passante. Un nœud complet doit télécharger 80 à 300 Go de données (à compter de janvier 2020, selon la configuration du client) et les stocker sur un disque dur local. Cette charge de données augmente assez rapidement chaque jour à mesure que de nouvelles transactions et de nouveaux blocs sont ajoutés. Nous abordons ce sujet plus en détail dans <a href="#requirements">Configuration matérielle requise pour un nœud complet</a>.</p>
</div>
<div class="paragraph data-line-38">
<p>Un nœud complet fonctionnant sur un réseau <em>mainnet</em> en direct n&#39;est pas nécessaire pour le développement d&#39;Ethereum. Vous pouvez faire presque tout ce que vous devez faire avec un nœud <em>testnet</em> (qui vous connecte à l&#39;une des plus petites chaînes de blocs de test publiques), avec une chaîne de blocs privée locale comme Ganache, ou avec un client Ethereum basé sur le cloud proposé par un fournisseur de services comme Infura.</p>
</div>
<div class="paragraph data-line-40">
<p>Vous avez également la possibilité d&#39;exécuter un client distant, qui ne stocke pas de copie locale de la chaîne de blocs ni ne valide les blocs et les transactions. Ces clients offrent la fonctionnalité d&#39;un portefeuille et peuvent créer et diffuser des transactions. Les clients distants peuvent être utilisés pour se connecter à des réseaux existants, tels que votre propre nœud complet, une chaîne de blocs publique, un testnet public ou autorisé (preuve d&#39;autorité), ou une chaîne de blocs locale privée. En pratique, vous utiliserez probablement un client distant tel que MetaMask, Emerald Wallet, <span class="keep-together">MyEtherWallet</span> ou MyCrypto comme moyen pratique de basculer entre toutes les différentes options de nœud.</p>
</div>
<div class="paragraph data-line-42">
<p>Les termes &quot;client distant&quot; et &quot;portefeuille&quot; sont utilisés de manière interchangeable, bien qu&#39;il existe certains différences. Habituellement, un client distant propose une API (telle que l&#39;API web3.js) en plus de la fonctionnalité de transaction d&#39;un portefeuille.</p>
</div>
<div class="paragraph data-line-44">
<p>Ne confondez pas le concept de portefeuille distant dans Ethereum avec celui d&#39;un <em>client léger</em> (qui est analogue à un client de vérification simplifiée des paiements dans Bitcoin). Les clients légers valident les en-têtes de bloc et utilisent les preuves Merkle pour valider l&#39;inclusion des transactions dans la chaîne de blocs et déterminer leurs effets, leur donnant un niveau de sécurité similaire à un nœud complet. Inversement, les clients distants Ethereum ne valident pas les en-têtes de bloc ou les transactions. Ils font entièrement confiance à un client complet pour leur donner accès à la chaîne de blocs, et perdent ainsi d&#39;importantes garanties de sécurité et d&#39;anonymat. Vous pouvez atténuer ces problèmes en utilisant un client complet que vous exécutez vous-même.</p>
</div>
</div>
<div class="sect3 data-line-47">
<h4 id="full_node_adv_disadv">Avantages et désavantages du nœud complet</h4>
<div class="paragraph data-line-49">
<p> Choisir d&#39;exécuter un nœud complet facilite le fonctionnement des réseaux auxquels vous le connectez, mais entraîne également des coûts légers à modérés pour vous. Regardons quelques-uns des avantages et des inconvénients.</p>
</div>
<div class="paragraph data-line-51">
<p><strong>Avantages:</strong></p>
</div>
<div class="ulist data-line-53">
<ul>
<li class="data-line-53">
<p>Prend en charge la résilience et la résistance à la censure des réseaux basés sur Ethereum</p>
</li>
<li class="data-line-54">
<p>Valide avec autorité toutes les transactions</p>
</li>
<li class="data-line-55">
<p>Peut interagir avec n&#39;importe quel contrat sur la chaîne de blocs publique sans intermédiaire</p>
</li>
<li class="data-line-56">
<p>Peut déployer directement des contrats dans la chaîne de blocs publique sans intermédiaire</p>
</li>
<li class="data-line-57">
<p>Peut interroger (lecture seule) le statut de la chaîne de blocs (comptes, contrats, etc.) hors ligne</p>
</li>
<li class="data-line-58">
<p>Peut interroger la chaîne de blocs sans laisser un tiers connaître les informations que vous lisez</p>
</li>
</ul>
</div>
<div class="paragraph data-line-60">
<p><strong>Désavantages:</strong></p>
</div>
<div class="ulist data-line-62">
<ul>
<li class="data-line-62">
<p>Nécessite des ressources matérielles et de bande passante importantes et croissantes</p>
</li>
<li class="data-line-63">
<p>Peut nécessiter plusieurs jours pour une synchronisation complète lors du premier démarrage</p>
</li>
<li class="data-line-64">
<p>Doit être maintenu, mis à jour et maintenu en ligne pour rester synchronisé</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-67">
<h4 id="pub_test_adv_disadv">Avantages et désavantages du testnet public</h4>
<div class="paragraph data-line-69">
<p>Que vous choisissiez ou non d&#39;exécuter un nœud complet, vous souhaiterez probablement exécuter un nœud testnet public. Examinons quelques-uns des avantages et des inconvénients de l&#39;utilisation d&#39;un testnet public.</p>
</div>
<div class="paragraph data-line-71">
<p><strong>Avantages:</strong></p>
</div>
<div class="ulist data-line-73">
<ul>
<li class="data-line-73">
<p>Un nœud testnet doit synchroniser et stocker beaucoup moins de données - environ 45 Go selon le réseau.</p>
</li>
<li class="data-line-74">
<p>Un nœud testnet peut se synchroniser complètement en quelques heures.</p>
</li>
<li class="data-line-75">
<p>Le déploiement de contrats ou la réalisation de transactions nécessite un test d&#39;ether, qui n&#39;a aucune valeur et peut être acquis gratuitement à partir de plusieurs &quot;robinets&quot;.</p>
</li>
<li class="data-line-76">
<p>Les réseaux de test sont des chaînes de blocs publiques avec de nombreux autres utilisateurs et contrats, fonctionnant &quot;en direct&quot;.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-78">
<p><strong>Désavantages:</strong></p>
</div>
<div class="ulist data-line-80">
<ul>
<li class="data-line-80">
<p>Vous ne pouvez pas utiliser d&#39;argent &quot;réel&quot; sur un testnet ; il fonctionne sur l&#39;ether de test. Par conséquent, vous ne pouvez pas tester la sécurité contre de vrais adversaires, car il n&#39;y a rien en jeu.</p>
</li>
<li class="data-line-81">
<p>Il y a certains aspects d&#39;une chaîne de blocs publique que vous ne pouvez pas tester de manière réaliste sur un testnet. Par exemple, les frais de transaction, bien que nécessaires pour envoyer des transactions, ne sont pas pris en compte sur un testnet, car le gaz est gratuit. De plus, les réseaux de test ne connaissent pas de congestion du réseau comme le fait parfois le réseau principal public.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-84">
<h4 id="localtest_adv_dis">Avantages et désavantages de la simulation chaîne de blocs locale</h4>
<div class="paragraph data-line-86">
<p>À de nombreuses fins de test, la meilleure option consiste à lancer une chaîne de blocs privée à instance unique. Ganache (anciennement nommé testrpc) est l&#39;une des simulations de chaîne de blocs locales les plus populaires avec lesquelles vous pouvez interagir, sans aucun autre participant. Il partage de nombreux avantages et inconvénients du testnet public, mais présente également quelques différences.</p>
</div>
<div class="paragraph data-line-88">
<p><strong>Avantages:</strong></p>
</div>
<div class="ulist data-line-90">
<ul>
<li class="data-line-90">
<p>Aucune synchronisation et presque aucune donnée sur le disque ; vous minez vous-même le premier bloc</p>
</li>
<li class="data-line-91">
<p>Pas besoin d&#39;obtenir de l&#39;ether de test ; vous vous &quot;attribuez&quot; des récompenses minières que vous pouvez utiliser pour tester</p>
</li>
<li class="data-line-92">
<p>Aucun autre utilisateur, juste vous</p>
</li>
<li class="data-line-93">
<p>Aucun autre contrat, juste ceux que vous déployez après le lancement</p>
</li>
</ul>
</div>
<div class="paragraph data-line-95">
<p><strong>Désavantages:</strong></p>
</div>
<div class="ulist data-line-97">
<ul>
<li class="data-line-97">
<p>Ne pas avoir d&#39;autres utilisateurs signifie qu&#39;il ne se comporte pas de la même manière qu&#39;une chaîne de blocs publique. Il n&#39;y a pas de concurrence pour l&#39;espace de transaction ou le séquençage des <span class="keep-together">transactions</span>.</p>
</li>
<li class="data-line-98">
<p>Aucun mineur autre que vous signifie que l&#39;exploitation minière est plus prévisible ; par conséquent, vous ne pouvez pas tester certains scénarios qui se produisent sur une chaîne de blocs publique.</p>
</li>
<li class="data-line-99">
<p>L&#39;absence d&#39;autres contrats signifie que vous devez déployer tout ce que vous souhaitez tester, y compris les dépendances et les bibliothèques de contrats.</p>
</li>
<li class="data-line-100">
<p>Vous ne pouvez pas recréer certains contrats publics et leurs adresses pour tester certains scénarios (par exemple, le contrat DAO).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 data-line-104">
<h3 id="running_client">Exécuter un client Ethereum</h3>
<div class="paragraph data-line-106">
<p>Si vous avez le temps et les ressources, vous devriez essayer d&#39;exécuter un nœud complet, même si ce n&#39;est que pour en savoir plus sur le processus. Dans cette section, nous expliquons comment télécharger, compiler et exécuter les clients Ethereum Parity et Geth. Cela nécessite une certaine familiarité avec l&#39;utilisation de l&#39;interface de ligne de commande sur votre système d&#39;exploitation. Cela vaut la peine d&#39;installer ces clients, que vous choisissiez de les exécuter en tant que nœuds complets, en tant que nœuds testnet ou en tant que clients d&#39;une chaîne de blocs privée locale.</p>
</div>
<div class="sect3 data-line-109">
<h4 id="requirements">Configuration matérielle requise pour un nœud complet</h4>
<div class="paragraph data-line-111">
<p>Avant de commencer, vous devez vous assurer que vous disposez d&#39;un ordinateur doté de ressources suffisantes pour fonctionner un nœud complet Ethereum. Vous aurez besoin d&#39;au moins 300 Go d&#39;espace disque pour stocker une copie complète de la chaîne de blocs Ethereum. Si vous souhaitez également exécuter un nœud complet sur le testnet Ethereum, vous aurez besoin d&#39;au moins 45 Go supplémentaires. Le téléchargement de 345 Go de données de la chaîne de blocs peut prendre beaucoup de temps, il est donc recommandé de travailler sur une connexion Internet rapide.</p>
</div>
<div class="paragraph data-line-113">
<p>La synchronisation de la chaîne de blocs Ethereum est très intensive en entrée/sortie (E/S). Il est préférable d&#39;avoir un disque statique électronique (SSD). Si vous avez un disque dur mécanique (HDD), vous aurez besoin d&#39;au moins 8 Go de RAM à utiliser comme cache. Sinon, vous découvrirez peut-être que votre système est trop lent pour suivre et synchroniser complètement.</p>
</div>
<div class="paragraph data-line-115">
<p><strong>Exigences minimales:</strong></p>
</div>
<div class="ulist data-line-117">
<ul>
<li class="data-line-117">
<p>Processeur avec 2+ cœurs</p>
</li>
<li class="data-line-118">
<p>Au moins 300 Go d&#39;espace de stockage libre</p>
</li>
<li class="data-line-119">
<p>4 Go de RAM minimum avec un SSD, 8 Go+ si vous avez un HDD</p>
</li>
<li class="data-line-120">
<p>Service Internet de téléchargement de 8 Mbit/s</p>
</li>
</ul>
</div>
<div class="paragraph data-line-122">
<p>Ce sont les exigences minimales pour synchroniser une copie complète (mais élaguée) d&#39;une chaîne de blocs basée sur Ethereum.</p>
</div>
<div class="paragraph data-line-124">
<p>Au moment de la rédaction, la base de code Parity est plus légère sur les ressources, donc si vous utilisez un matériel limité, vous obtiendrez probablement de meilleurs résultats en utilisant Parity.</p>
</div>
<div class="paragraph data-line-126">
<p>Si vous souhaitez synchroniser dans un délai raisonnable et stocker tous les outils de développement, bibliothèques, clients et chaînes de blocs dont nous parlons dans ce livre, vous voudrez un ordinateur plus performant.</p>
</div>
<div class="paragraph data-line-128">
<p><strong>Spécifications recommandées :</strong></p>
</div>
<div class="ulist data-line-130">
<ul>
<li class="data-line-130">
<p>Processeur rapide avec 4+ cœurs</p>
</li>
<li class="data-line-131">
<p>16 Go + RAM</p>
</li>
<li class="data-line-132">
<p>SSD rapide avec au moins 500 Go d&#39;espace libre</p>
</li>
<li class="data-line-133">
<p>Service Internet de téléchargement de plus de 25 Mbit/s</p>
</li>
</ul>
</div>
<div class="paragraph data-line-135">
<p>Il est difficile de prédire à quelle vitesse la taille d&#39;une chaîne de blocs augmentera et quand plus d&#39;espace disque sera nécessaire, il est donc recommandé de vérifier la dernière taille de la chaîne de blocs avant de commencer la synchronisation.</p>
</div>
<div class="admonitionblock note data-line-138">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-139">
<p>Les exigences de taille de disque répertoriées ici supposent que vous exécuterez un nœud avec les paramètres par défaut, où la chaîne de blocs est &quot;élaguée&quot; des anciennes données d&#39;état. Si vous exécutez à la place un nœud &quot;d&#39;archivage&quot; complet, où tout l&#39;état est conservé sur le disque, il nécessitera probablement plus de 1 To d&#39;espace disque.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-142">
<p>Ces liens fournissent des estimations à jour de la taille de la chaîne de blocs :</p>
</div>
<div class="ulist data-line-144">
<ul>
<li class="data-line-144">
<p><a href="https://bitinfocharts.com/ethereum/" data-href="https://bitinfocharts.com/ethereum/">Ethereum</a></p>
</li>
<li class="data-line-146">
<p><a href="https://bitinfocharts.com/ethereum%20classic/" data-href="https://bitinfocharts.com/ethereum%20classic/">Ethereum classique</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-149">
<h4 id="sw_reqs">Configuration logicielle requise pour créer et exécuter un client (nœud)</h4>
<div class="paragraph data-line-151">
<p>Cette section couvre les logiciels clients Parity et Geth. Il suppose également que vous utilisez un environnement de ligne de commande de type Unix. Les exemples montrent les commandes et la sortie telles qu&#39;elles apparaissent sur un système d&#39;exploitation Ubuntu GNU/Linux exécutant le shell bash (environnement d&#39;exécution en ligne de commande).</p>
</div>
<div class="paragraph data-line-153">
<p>En règle générale, chaque chaîne de blocs aura sa propre version de Geth, tandis que Parity prend en charge plusieurs chaînes de blocs basées sur Ethereum (Ethereum, Ethereum Classic, <span class="keep-together">Ellaism</span>, Expanse, Musicoin) avec le même client téléchargé.</p>
</div>
<div class="admonitionblock tip data-line-156">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-157">
<p>Dans de nombreux exemples de ce chapitre , nous utiliserons l&#39;interface de ligne de commande du système d&#39;exploitation (également appelée &quot;shell&quot;), accessible via une application &quot;terminal&quot;. Le shell affichera une invite ; vous tapez une commande et le shell répond avec du texte et une nouvelle invite pour votre prochaine commande. L&#39;invite peut sembler différente sur votre système, mais dans les exemples suivants, elle est indiquée par un symbole $. Dans les exemples, lorsque vous voyez du texte après un symbole $, ne tapez pas le symbole $ mais tapez la commande qui le suit immédiatement (en gras), puis appuyez sur Entrée pour exécuter la commande. Dans les exemples, les lignes sous chaque commande sont les réponses du système d&#39;exploitation à cette commande. Lorsque vous verrez le prochain préfixe $, vous saurez qu&#39;il s&#39;agit d&#39;une nouvelle commande et vous devrez répéter le processus.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-160">
<p>Avant de commencer, vous devrez peut-être installer certains logiciels. Si vous n&#39;avez jamais fait de développement logiciel sur l&#39;ordinateur que vous utilisez actuellement, vous devrez probablement installer quelques outils de base. Pour les exemples qui suivent, vous devrez installer git, le système de gestion du code source ; golang, le langage de programmation Go et les bibliothèques standard ; et Rust, un langage de programmation système.</p>
</div>
<div class="paragraph data-line-162">
<p>Git peut être installé en suivant les instructions sur <a href="https://git-scm.com" class="undefined" data-href="https://git-scm.com">https://git-scm.com</a>.</p>
</div>
<div class="paragraph data-line-164">
<p>Go peut être installé en suivant les instructions sur <a href="https://golang.org" class="undefined" data-href="https://golang.org">https://golang.org</a>, ou <a href="https://github.com/golang/" class="undefined" data-href="https://github.com/golang/">https://github.com/golang/</a> go/wiki/Ubuntu[] si vous utilisez Ubuntu.</p>
</div>
<div class="admonitionblock note data-line-167">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-168">
<p>Les exigences de Geth varient, mais si vous vous en tenez à Go version 1.10 ou supérieure, vous devriez pouvoir compiler n&#39;importe quelle version de Geth que vous souhaitez. Bien sûr, vous devriez toujours vous référer à la documentation de la version de Geth que vous avez choisie.</p>
</div>
<div class="paragraph data-line-170">
<p>La version de golang installée sur votre système d&#39;exploitation ou disponible à partir du gestionnaire de packages de votre système peut être bien antérieure à la 1.10. Si tel est le cas, supprimez-le et installez la dernière version à partir de <a href="https://golang.org/" class="undefined" data-href="https://golang.org/">https://golang.org/</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-173">
<p>Rust peut être installé en suivant les instructions sur <a href="https://www.rustup.rs/" class="undefined" data-href="https://www.rustup.rs/">https://www.rustup.rs/</a>.</p>
</div>
<div class="admonitionblock note data-line-176">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-177">
<p>Parity nécessite Rust version 1.27 ou supérieure.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-180">
<p>Parity nécessite également certaines bibliothèques logicielles, telles que OpenSSL et libudev. Pour les installer sur un système compatible Ubuntu ou Debian GNU/Linux, utilisez la  <span class="keep-together">commande</span> suivante :</p>
</div>
<pre data-type="programlisting">
$ <strong>sudo apt-get install openssl libssl-dev libudev-dev cmake clang</strong>

</pre>
<div class="paragraph data-line-189">
<p>Pour les autres systèmes d&#39;exploitation, utilisez le gestionnaire d&#8217;applications de votre système d&#39;exploitation ou suivez les <a href="https://github.com/paritytech/parity/wiki/Setup" class="undefined" data-href="https://github.com/paritytech/parity/wiki/Setup">https://github.com/paritytech/parity/wiki/Setup</a> [instructions Wiki] pour installer les bibliothèques requises.</p>
</div>
<div class="paragraph data-line-191">
<p>Maintenant que vous avez installé git, golang, Rust et les bibliothèques nécessaires, mettons-nous au travail !</p>
</div>
</div>
<div class="sect3 data-line-194">
<h4 id="parity">Parity</h4>
<div class="paragraph data-line-196">
<p>Parity est une implémentation d&#39;un client Ethereum à nœud complet et d&#39;un navigateur DApp. Il a été écrit « à partir de zéro » en Rust, un langage de programmation système, dans le but de créer un client Ethereum modulaire, sécurisé et évolutif. Parity est développé par Parity Tech, une société britannique, et est publié sous la licence de logiciel libre GPLv3.</p>
</div>
<div class="admonitionblock note data-line-199">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-200">
<p>Divulgation: L&#39;un des auteurs de ce livre, le Dr Gavin Wood, est le fondateur de Parity Tech et a écrit une grande partie du client Parity. Parity représente environ 25% de la base des clients Ethereum installés.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-203">
<p>Pour installer Parity, vous pouvez utiliser le gestionnaire d&#8217;applications Rust cargo ou télécharger le code source depuis GitHub. Le gestionnaire d&#8217;applications télécharge également le code source, il n&#39;y a donc pas beaucoup de différence entre les deux options. Dans la section suivante, nous vous montrerons comment télécharger et compiler Parity vous-même.</p>
</div>
<div class="sect4 data-line-206">
<h5 id="install_parity">Installation de Parity</h5>
<div class="paragraph data-line-208">
<p>Le <a href="https://wiki.parity.io/Setup" data-href="https://wiki.parity.io/Setup">Parity Wiki</a> propose des instructions pour créer Parity dans différents environnements et conteneurs. Nous allons vous montrer comment créer Parity à partir de la source. Cela suppose que vous avez déjà installé Rust en utilisant rustup (voir <a href="#sw_reqs">Configuration logicielle requise pour créer et exécuter un client (nœud)</a>).</p>
</div>
<div class="paragraph data-line-210">
<p>Tout d&#39;abord, récupérez le code source sur GitHub :</p>
</div>
<pre data-type="programlisting">
$ <strong>git clone https://github.com/paritytech/parity</strong>

</pre>
<div class="paragraph data-line-219">
<p>Passez ensuite au répertoire <em>parity</em> et utilisez cargo pour créer l&#39;exécutable :</p>
</div>
<pre data-type="programlisting">
$ <strong>cd parity</strong>
$ <strong>cargo install --path .</strong>

</pre>
<div class="paragraph data-line-229">
<p>Si tout se passe bien, vous devriez voir quelque chose comme :</p>
</div>
<pre data-type="programlisting">
$ <strong>cargo install --path .</strong>
Installing parity-ethereum v2.7.0 (/root/parity)
Updating crates.io index
Updating git repository `https://github.com/paritytech/rust-ctrlc.git`
Updating git repository `https://github.com/paritytech/app-dirs-rs`   Updating git repository

[...]

Compiling parity-ethereum v2.7.0 (/root/parity)
Finished release [optimized] target(s) in 10m 16s
Installing /root/.cargo/bin/parity
Installed package `parity-ethereum v2.7.0 (/root/parity)` (executable `parity`)
$

</pre>
<div class="paragraph data-line-250">
<p>Essayez d&#39;exécuter parity pour voir s&#39;il est installé, en invoquant l&#39;option --version :</p>
</div>
<pre data-type="programlisting">
$ <strong>parity --version</strong>
Parity Ethereum Client.
  version Parity-Ethereum/v2.7.0-unstable-b69a33b3a-20200124/x86_64-unknown-linux-gnu/rustc1.40.0
Copyright 2015-2020 Parity Technologies (UK) Ltd.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

By Wood/Paronyan/Kotewicz/Drwięga/Volf/Greeff
   Habermeier/Czaban/Gotchac/Redman/Nikolsky
   Schoedon/Tang/Adolfsson/Silva/Palm/Hirsz et al.
$

</pre>
<div class="paragraph data-line-271">
<p>Génial! Maintenant que Parity est installé, vous pouvez synchroniser la chaîne de blocs et commencer avec quelques options de ligne de commande de base.</p>
</div>
</div>
</div>
<div class="sect3 data-line-274">
<h4 id="go_ethereum_geth">Go-Ethereum (Geth)</h4>
<div class="paragraph data-line-276">
<p>Geth est l&#39;implémentation avec le langage Go activement développée par la Fondation Ethereum, elle est donc considérée comme l&#39;implémentation &quot;officielle&quot; du client Ethereum. En règle générale, chaque chaîne de blocs basée sur Ethereum aura sa propre implémentation Geth. Si vous utilisez Geth, assurez-vous de récupérer la bonne version pour votre chaîne de blocs en utilisant l&#39;un des liens de référentiel suivants :</p>
</div>
<div class="ulist data-line-279">
<ul>
<li class="data-line-279">
<p><a href="https://github.com/ethereum/go-ethereum" data-href="https://github.com/ethereum/go-ethereum">Ethereum</a> (or <a href="https://geth.ethereum.org/" class="undefined" data-href="https://geth.ethereum.org/">https://geth.ethereum.org/</a>)</p>
</li>
<li class="data-line-281">
<p><a href="https://github.com/etclabscore/go-ethereum" data-href="https://github.com/etclabscore/go-ethereum">Ethereum Classic</a></p>
</li>
<li class="data-line-283">
<p><a href="https://github.com/ellaism/go-ellaism" data-href="https://github.com/ellaism/go-ellaism">Ellaism</a></p>
</li>
<li class="data-line-285">
<p><a href="https://github.com/expanse-org/go-expanse" data-href="https://github.com/expanse-org/go-expanse">Expanse</a></p>
</li>
<li class="data-line-287">
<p><a href="https://github.com/Musicoin/go-musicoin" data-href="https://github.com/Musicoin/go-musicoin">Musicoin</a></p>
</li>
<li class="data-line-289">
<p><a href="https://github.com/ubiq/go-ubiq" data-href="https://github.com/ubiq/go-ubiq">Ubiq</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-292">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-293">
<p>Vous pouvez également ignorer ces instructions et installer un binaire précompilé pour la plate-forme de votre choix. Les versions précompilées sont beaucoup plus faciles à installer et peuvent être trouvées dans la section &quot;versions&quot; de l&#39;un des référentiels répertoriés ici. Cependant, vous pouvez en apprendre davantage en téléchargeant et en compilant le logiciel vous-même.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-297">
<h5 id="cloning_repo">Cloner le référentiel</h5>
<div class="paragraph data-line-299">
<p>La première étape consiste à cloner le référentiel Git, pour obtenir une copie du code source.</p>
</div>
<div class="paragraph data-line-301">
<p>Pour créer un clone local de votre référentiel choisi, utilisez la commande git comme suit, dans votre répertoire personnel ou sous n&#39;importe quel répertoire que vous utilisez pour le développement :</p>
</div>
<pre data-type="programlisting">
$ <strong>git clone &lt;Lien vers le référentiel&gt;</strong>

</pre>
<div class="paragraph data-line-310">
<p>Vous devriez voir un rapport de progression au fur et à mesure que le référentiel est copié sur votre système local :</p>
</div>
<div id="cloning_status" class="listingblock data-line-313">
<div class="content">
<pre>Cloning into 'go-ethereum'...
remote: Enumerating objects: 86915, done.
remote: Total 86915 (delta 0), reused 0 (delta 0), pack-reused 86915
Receiving objects: 100% (86915/86915), 134.73 MiB | 29.30 MiB/s, done.
Resolving deltas: 100% (57590/57590), done.</pre>
</div>
</div>
<div class="paragraph data-line-321">
<p>Génial! Maintenant que vous avez une copie locale de Geth, vous pouvez compiler un exécutable pour votre plate-forme.</p>
</div>
</div>
<div class="sect4 data-line-324">
<h5 id="build_geth_src">Construire Geth à partir du code source</h5>
<div class="paragraph data-line-326">
<p>Pour compiler Geth, allez dans le répertoire où le code source a été téléchargé et utilisez la commande make :</p>
</div>
<pre data-type="programlisting">
$ <strong>cd go-ethereum</strong>
$ <strong>make geth</strong>

</pre>
<div class="paragraph data-line-336">
<p>Si tout se passe bien, vous verrez le compilateur Go construire chaque composant jusqu&#39;à ce qu&#39;il produise l&#39;exécutable geth :</p>
</div>
<div id="making_geth_status" class="listingblock data-line-339">
<div class="content">
<pre>build/env.sh go run build/ci.go install ./cmd/geth
&gt;&gt;&gt; /usr/local/go/bin/go install -ldflags -X main.gitCommit=58a1e13e6dd7f52a1d...
github.com/ethereum/go-ethereum/common/hexutil
github.com/ethereum/go-ethereum/common/math
github.com/ethereum/go-ethereum/crypto/sha3
github.com/ethereum/go-ethereum/rlp
github.com/ethereum/go-ethereum/crypto/secp256k1
github.com/ethereum/go-ethereum/common
[...]
github.com/ethereum/go-ethereum/cmd/utils
github.com/ethereum/go-ethereum/cmd/geth
Done building.
Exécutez &amp;quot;build/bin/geth&amp;quot; pour exécuter geth.
$</pre>
</div>
</div>
<div class="paragraph data-line-356">
<p>Assurons-nous que geth fonctionne sans l&#8217;excuter :</p>
</div>
<pre data-type="programlisting">
$ <strong>./build/bin/geth version</strong>

Geth
Version: 1.9.11-unstable
Git Commit: 0b284f6c6cfc6df452ca23f9454ee16a6330cb8e
Git Commit Date: 20200123
Architecture: amd64
Protocol Versions: [64 63]
Go Version: go1.13.4
Operating System: linux
[...]

</pre>
<div class="paragraph data-line-375">
<p>Votre commande geth version peut afficher des informations légèrement différentes, mais vous devriez voir un rapport de version similaire à celui présenté ici.</p>
</div>
<div class="paragraph data-line-377">
<p>Les sections suivantes expliquent le défi avec la synchronisation initiale de la chaîne de blocs d&#39;Ethereum.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-381">
<h3 id="first_sync">La première synchronisation des chaînes de blocs basées sur Ethereum</h3>
<div class="paragraph data-line-383">
<p>Traditionnellement, lors de la synchronisation d&#8217;une chaîne de blocs Ethereum, votre client téléchargerait et validerait chaque bloc et chaque transaction depuis le tout début, c&#39;est-à-dire depuis le bloc de genèse.</p>
</div>
<div class="paragraph data-line-385">
<p>Bien qu&#39;il soit possible de synchroniser entièrement la chaîne de blocs de cette façon, ce type de synchronisation prendra très longtemps et nécessite beaucoup de ressources (il nécessitera beaucoup plus de RAM, et prendra en effet très longtemps si vous n&#39;avez pas stockage).</p>
</div>
<div class="paragraph data-line-387">
<p>De nombreuses chaînes de blocs basées sur Ethereum ont été victimes d&#39;attaques par déni de service fin 2016. Les chaînes de blocs concernées auront tendance à se synchroniser lentement lors d&#39;une synchronisation complète.</p>
</div>
<div class="paragraph data-line-389">
<p>Par exemple, sur Ethereum, un nouveau client progressera rapidement jusqu&#39;à atteindre le bloc 2 283 397. Ce bloc a été miné le 18 septembre 2016 et marque le début des attaques DoS. De ce bloc au bloc 2 700 031 (26 novembre 2016), la validation des transactions devient extrêmement lente, gourmande en mémoire et gourmande en E/S. Cela se traduit par des temps de validation supérieurs à 1 minute par bloc. Ethereum a mis en œuvre une série de mises à niveau, à l&#39;aide d&#8217;embranchements divergents, pour remédier aux vulnérabilités sous-jacentes qui ont été exploitées dans les attaques DoS. Ces mises à niveau ont également nettoyé la chaîne de blocs en supprimant quelque 20 millions de comptes vides créés par des transactions de spam.</p>
</div>
<div class="paragraph data-line-391">
<p>Si vous synchronisez avec une validation complète, votre client ralentira et peut prendre plusieurs jours, voire plus, pour valider les blocs affectés par les attaques DoS.</p>
</div>
<div class="paragraph data-line-393">
<p>Heureusement, la plupart des clients Ethereum effectuent désormais par défaut une synchronisation &quot;rapide&quot; qui ignore la validation complète des transactions jusqu&#39;à ce qu&#39;elle soit synchronisée avec la pointe de la chaîne de blocs, puis reprend la validation complète.</p>
</div>
<div class="paragraph data-line-395">
<p>Geth effectue une synchronisation rapide par défaut pour Ethereum. Vous devrez peut-être vous référer aux instructions spécifiques pour l&#39;autre chaîne Ethereum choisie.</p>
</div>
<div class="paragraph data-line-397">
<p>Parity effectue également une synchronisation rapide par défaut.</p>
</div>
<div class="admonitionblock note data-line-400">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-401">
<p>Geth ne peut opérer une synchronisation rapide que lorsqu&#39;il démarre avec une base de données de blocs vide. Si vous avez déjà commencé la synchronisation sans mode rapide, Geth ne peut pas basculer de mode. Il est plus rapide de supprimer le répertoire de données de la chaîne de blocs et de commencer la synchronisation rapide depuis le début que de continuer la synchronisation avec une validation complète. Veillez à ne supprimer aucun portefeuille lors de la suppression des données de la chaîne de blocs !</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-404">
<h4 id="_exécuter_geth_ou_parity">Exécuter Geth ou Parity</h4>
<div class="paragraph data-line-406">
<p>Maintenant que vous comprenez les défis de la &quot;première synchronisation&quot;, vous êtes prêt à démarrer un client Ethereum et à synchroniser la chaîne de blocs. Pour Geth et Parity, vous pouvez utiliser l&#39;option --help pour voir tous les paramètres de configuration. Les paramètres par défaut sont généralement judicieux et appropriés pour la plupart des utilisations. Choisissez comment configurer les paramètres facultatifs en fonction de vos besoins, puis démarrez Geth ou Parity pour synchroniser la chaîne. Puis attendre&#8230;&#8203;</p>
</div>
<div class="admonitionblock tip data-line-409">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-410">
<p>La synchronisation de la chaîne de blocs Ethereum prendra entre une demi-journée sur un système très rapide avec beaucoup de RAM et plusieurs jours sur un système plus lent.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-414">
<h4 id="json_rpc">L&#39;interface JSON-RPC</h4>
<div class="paragraph data-line-416">
<p>Les clients Ethereum offrent une interface de programmation d&#39;application et un ensemble de commandes Remote Procedure Call (RPC), qui sont encodées en JavaScript Object Notation (JSON). Vous verrez cela appelé <em>API JSON-RPC</em>. Essentiellement, l&#39;API JSON-RPC est une interface qui nous permet d&#39;écrire des programmes qui utilisent un client Ethereum comme <em>passerelle</em> vers un réseau Ethereum et une chaîne de blocs.</p>
</div>
<div class="paragraph data-line-418">
<p>Habituellement, l&#39;interface RPC est proposée en tant que service HTTP sur le port 8545. Pour des raisons de sécurité, il est restreint, par défaut, de n&#39;accepter que les connexions de localhost (l&#39;adresse IP de votre propre ordinateur, qui est 127.0.0.1).</p>
</div>
<div class="paragraph data-line-420">
<p>Pour accéder à l&#39;API JSON-RPC, vous pouvez utiliser une bibliothèque spécialisée (écrite dans le langage de programmation de votre choix) qui fournit des appels de fonction &quot;stub&quot; correspondant à chaque commande RPC disponible, ou vous pouvez construire manuellement des requêtes HTTP et envoyer/recevoir des requêtes codées en JSON. Vous pouvez même utiliser un client HTTP de ligne de commande générique, comme curl, pour appeler l&#39;interface RPC. Essayons ça. Tout d&#39;abord, assurez-vous que Geth est opérationnel, configuré avec --rpc pour autoriser l&#39;accès HTTP à l&#39;interface RPC, puis passez à une nouvelle fenêtre de terminal (par exemple, avec Ctrl-Maj-N ou Ctrl-Maj-T dans un fenêtre de terminal) comme indiqué ici :</p>
</div>
<pre data-type="programlisting">
$ <strong>curl -X POST -H "Content-Type: application/json" --data \
  '{"jsonrpc":"2.0","method":"web3_clientVersion","params":[],"id":1}' \
  http://localhost:8545</strong>

{"jsonrpc":"2.0","id":1,
"result":"Geth/v1.9.11-unstable-0b284f6c-20200123/linux-amd64/go1.13.4"}

</pre>
<div class="paragraph data-line-434">
<p>Dans cet exemple, nous utilisons curl pour établir une connexion HTTP à l&#39;adresse <em><a href="http://localhost:8545" class="undefined" data-href="http://localhost:8545">http://localhost:8545</a></em>. Nous exécutons déjà geth, qui propose l&#39;API JSON-RPC en tant que service HTTP sur le port 8545. Nous demandons à curl d&#39;utiliser la commande HTTP POST et d&#39;identifier le contenu en tant que type application/json. Enfin, nous transmettons une requête encodée en JSON en tant que composant data de notre requête HTTP. La majeure partie de notre ligne de commande consiste simplement à configurer curl pour établir correctement la connexion HTTP. La partie intéressante est la commande JSON-RPC que nous émettons :</p>
</div>
<div id="JSON_RPC_command" class="listingblock data-line-437">
<div class="content">
<pre>{"jsonrpc":"2.0","method":"web3_clientVersion","params":[],"id":1}</pre>
</div>
</div>
<div class="paragraph data-line-441">
<p>La requête JSON-RPC est formatée conformément à la <a href="https://www.jsonrpc.org/specification" class="undefined" data-href="https://www.jsonrpc.org/specification">https://www.jsonrpc.org/specification</a> [spécification JSON-RPC 2.0]. Chaque demande contient quatre éléments :</p>
</div>
<div class="dlist data-line-443">
<dl>
<dt class="hdlist1">jsonrpc </dt>
<dd>
<p>Version du protocole JSON-RPC. Cela DOIT être exactement &amp;quot;2.0&amp;quot;.</p>
</dd>
<dt class="hdlist1">method </dt>
<dd>
<p>Le nom de la méthode à invoquer.</p>
</dd>
<dt class="hdlist1">params </dt>
<dd>
<p>Une valeur structurée qui contient les valeurs de paramètre à utiliser lors de l&#39;invocation de la méthode. Ce membre PEUT être omis.</p>
</dd>
<dt class="hdlist1">id </dt>
<dd>
<p>Un identifiant établi par le client qui DOIT contenir une valeur String, Number ou NULL si elle est incluse. Le serveur DOIT répondre avec la même valeur dans l&#39;objet de réponse s&#39;il est inclus. Ce membre est utilisé pour corréler le contexte entre les deux objets.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip data-line-452">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-453">
<p>Le paramètre id est principalement utilisé lorsque vous effectuez plusieurs requêtes dans un seul appel JSON-RPC, une pratique appelée <em>batching</em>. Le traitement par lots est utilisé pour éviter la surcharge d&#39;une nouvelle connexion HTTP et TCP pour chaque requête. Dans le contexte Ethereum, par exemple, nous utiliserions le traitement par lots si nous voulions récupérer des milliers de transactions sur une seule connexion HTTP. Lors du traitement par lots, vous définissez un id différent pour chaque demande, puis le faites correspondre au id dans chaque réponse du serveur JSON-RPC. Le moyen le plus simple d&#39;implémenter ceci est de maintenir un compteur et d&#39;incrémenter la valeur pour chaque demande.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-457">
<p>La réponse que nous recevons est :</p>
</div>
<div class="listingblock data-line-459">
<div class="content">
<pre>{"jsonrpc":"2.0","id":1,
"result":"Geth/v1.9.11-unstable-0b284f6c-20200123/linux-amd64/go1.13.4"}</pre>
</div>
</div>
<div class="paragraph data-line-464">
<p>Cela nous indique que l&#39;API JSON-RPC est servie par la version 1.13.4 du client Geth.</p>
</div>
<div class="paragraph data-line-466">
<p>Essayons quelque chose d&#39;un peu plus intéressant. Dans l&#39;exemple suivant, nous demandons à l&#39;API JSON-RPC le prix actuel du gaz en wei :</p>
</div>
<pre data-type="programlisting">
$ <strong>curl -X POST -H "Content-Type: application/json" --data \
  '{"jsonrpc":"2.0","method":"eth_gasPrice","params":[],"id":4213}' \
  http://localhost:8545</strong>

{"jsonrpc":"2.0","id":4213,"result":"0x430e23400"}

</pre>
<div class="paragraph data-line-479">
<p>La réponse, 0x430e23400, nous indique que le prix actuel du gaz est de 18 gwei (gigawei ou milliard de wei). Si, comme nous, vous ne pensez pas en hexadécimal, vous pouvez le convertir en décimal sur la ligne de commande avec un petit bash-fu :</p>
</div>
<pre data-type="programlisting">
$ <strong>echo $((0x430e23400))</strong>

18000000000

</pre>
<div class="paragraph data-line-490">
<p>L&#39;API JSON-RPC complète peut être étudiée sur le <a href="https://github.com/ethereum/wiki/wiki/JSON-RPC" data-href="https://github.com/ethereum/wiki/wiki/JSON-RPC">wiki Ethereum</a>.</p>
</div>
<div class="sect4 data-line-493">
<h5 id="parity_compatibility_mode">Mode de compatibilité Geth de Parity</h5>
<div class="paragraph data-line-495">
<p>Parity a un &quot;mode de compatibilité Geth&quot; spécial, où il offre une API JSON-RPC identique à celle offerte par Geth. Pour exécuter Parity dans ce mode, utilisez le commutateur --geth:</p>
</div>
<pre data-type="programlisting">
$ <strong>parity --geth</strong>

</pre>
</div>
</div>
</div>
<div class="sect2 data-line-505">
<h3 id="lw_eth_clients">Clients Ethereum distants</h3>
<div class="paragraph data-line-507">
<p>Les clients distants offrent un sous-ensemble des fonctionnalités d&#39;un client complet. Ils ne stockent pas la chaîne de blocs Ethereum complète, ils sont donc plus rapides à configurer et nécessitent beaucoup moins de stockage de données.</p>
</div>
<div class="paragraph pagebreak-before data-line-510">
<p>Ces clients offrent généralement la possibilité d&#39;effectuer une ou plusieurs des actions suivantes :</p>
</div>
<div class="ulist data-line-512">
<ul>
<li class="data-line-512">
<p>Gérer les clés privées et les adresses Ethereum dans un portefeuille.</p>
</li>
<li class="data-line-513">
<p>Créer, signer et diffuser des transactions.</p>
</li>
<li class="data-line-514">
<p>Interagir avec les contrats intelligents, en utilisant la charge utile des données.</p>
</li>
<li class="data-line-515">
<p>Naviguer et interagir avec les DApps.</p>
</li>
<li class="data-line-516">
<p>Offrir des liens vers des services externes tels que des explorateurs de blocs.</p>
</li>
<li class="data-line-517">
<p>Convertir les unités d&#39;ether et récupérer les taux de change à partir de sources externes.</p>
</li>
<li class="data-line-518">
<p>Injecter une instance web3 dans le navigateur Web en tant qu&#39;objet JavaScript.</p>
</li>
<li class="data-line-519">
<p>Utiliser une instance web3 fournie/injectée dans le navigateur par un autre client.</p>
</li>
<li class="data-line-520">
<p>Accéder aux services RPC sur un nœud Ethereum local ou distant.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-522">
<p>Certains clients distants, par exemple les portefeuilles mobiles (smartphones), n&#39;offrent que des fonctionnalités de portefeuille de base. Les autres clients distants sont des navigateurs DApp à part entière. Les clients distants offrent généralement certaines des fonctions d&#39;un client Ethereum à nœud complet sans synchroniser une copie locale de la chaîne de blocs Ethereum en se connectant à un nœud complet exécuté ailleurs, par exemple, par vous localement sur votre machine ou sur un serveur Web, ou par un tiers sur leurs serveurs.</p>
</div>
<div class="paragraph data-line-524">
<p>Examinons certains des clients distants les plus populaires et les fonctions qu&#39;ils offrent.</p>
</div>
<div class="sect3 data-line-527">
<h4 id="mobile_wallets">Portefeuilles mobiles (Smartphone)</h4>
<div class="paragraph data-line-529">
<p>Tous les portefeuilles mobiles sont des clients distants, car les téléphones intelligents ne disposent pas des ressources adéquates pour exécuter un client Ethereum complet. Les clients légers sont en développement et ne sont pas généralement utilisés pour Ethereum. Dans le cas de Parity, le client léger est marqué &quot;expérimental&quot; et peut être utilisé en exécutant parity avec l&#39;option --light.</p>
</div>
<div class="paragraph data-line-531">
<p>Les portefeuilles mobiles populaires incluent les éléments suivants (nous les énumérons simplement à titre d&#39;exemples ; il ne s&#39;agit pas d&#39;une approbation ou d&#39;une indication de la sécurité ou de la fonctionnalité de ces portefeuilles) :</p>
</div>
<div class="dlist data-line-533">
<dl>
<dt class="hdlist1"><a href="https://jaxx.io" data-href="https://jaxx.io">Jaxx</a></dt>
<dd>
<p>Un portefeuille mobile multidevises basé sur les valeurs mnémoniques BIP-39, avec prise en charge de Bitcoin, Litecoin, Ethereum, Ethereum Classic, ZCash, une variété de jetons ERC20 et de nombreuses autres devises. Jaxx est disponible sur Android et iOS, en tant que portefeuille de plug-in de navigateur et en tant que portefeuille de bureau pour une variété de systèmes d&#39;exploitation.</p>
</dd>
<dt class="hdlist1"><a href="https://status.im" data-href="https://status.im">Status</a></dt>
<dd>
<p>Un portefeuille mobile et un navigateur DApp, avec prise en charge d&#39;une variété de jetons et de DApps populaires. Disponible pour iOS et Android.</p>
</dd>
<dt class="hdlist1"><a href="https://trustwalletapp.com/" data-href="https://trustwalletapp.com/">Trust Wallet</a></dt>
<dd>
<p>Un portefeuille mobile multi-devises qui prend en charge Ethereum et Ethereum Classic ainsi que les jetons ERC20 et ERC223. Trust Wallet est disponible pour iOS et Android.</p>
</dd>
<dt class="hdlist1"><a href="https://www.cipherbrowser.com" data-href="https://www.cipherbrowser.com">Cipher Browser</a></dt>
<dd>
<p> Un navigateur et un portefeuille DApp mobile complet compatible avec Ethereum qui permet l&#39;intégration avec les applications et les jetons Ethereum. Disponible pour iOS et Android.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-542">
<h4 id="browser_wallets">Portefeuilles de navigateur</h4>
<div class="paragraph data-line-544">
<p>Une variété de portefeuilles et de navigateurs DApp sont disponibles en tant que plug-ins ou extensions de navigateurs Web tels que Chrome et Firefox. Ce sont des clients distants qui s&#39;exécutent dans votre navigateur.</p>
</div>
<div class="paragraph data-line-546">
<p>Certains des plus populaires sont MetaMask, Jaxx, MyEtherWallet et MyCrypto.</p>
</div>
<div class="sect4 data-line-549">
<h5 id="MetaMask">MetaMask</h5>
<div class="paragraph data-line-551">
<p><a href="https://metamask.io/" data-href="https://metamask.io/">MetaMask</a>, introduit dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, est un portefeuille polyvalent basé sur un navigateur, un client RPC et un explorateur de contrats de base. Il est disponible sur Chrome, Firefox, Opera et Brave Browser.</p>
</div>
<div class="paragraph data-line-553">
<p>Contrairement aux autres portefeuilles de navigateur, MetaMask injecte une instance web3 dans le contexte JavaScript du navigateur, agissant comme un client RPC qui se connecte à une variété de chaînes de blocs Ethereum (mainnet, Ropsten testnet, Kovan testnet, nœud RPC local, etc.). La possibilité d&#39;injecter une instance web3 et d&#39;agir comme une passerelle vers des services RPC externes fait de MetaMask un outil très puissant pour les développeurs et les utilisateurs. Il peut être combiné, par exemple, avec MyEtherWallet ou MyCrypto, agissant comme un fournisseur web3 et une passerelle RPC pour ces outils.</p>
</div>
</div>
<div class="sect4 data-line-556">
<h5 id="Jaxx">Jaxx</h5>
<div class="paragraph data-line-558">
<p><a href="https://jaxx.io" data-href="https://jaxx.io">Jaxx</a>, qui a été présenté comme un portefeuille mobile dans la section précédente, est également disponible en tant qu&#39;extension Chrome et Firefox et en tant que portefeuille de bureau.</p>
</div>
</div>
<div class="sect4 data-line-561">
<h5 id="MEW">MyEtherWallet (MEW)</h5>
<div class="paragraph data-line-563">
<p><a href="https://www.myetherwallet.com/" data-href="https://www.myetherwallet.com/">MyEtherWallet</a>  est un client distant JavaScript basé sur un navigateur qui offre :</p>
</div>
<div class="ulist data-line-565">
<ul>
<li class="data-line-565">
<p>Un pont vers les portefeuilles matériels populaires tels que Trezor et Ledger</p>
</li>
<li class="data-line-566">
<p>Une interface web3 pouvant se connecter à une instance web3 injectée par un autre client (par exemple, MetaMask)</p>
</li>
<li class="data-line-567">
<p>Un client RPC pouvant se connecter à un client complet Ethereum</p>
</li>
<li class="data-line-568">
<p>Une interface de base qui peut interagir avec des contrats intelligents, étant donné l&#39;adresse d&#39;un contrat et l&#39;interface binaire d&#39;application (ABI)</p>
</li>
<li class="data-line-569">
<p>Une application mobile, MEWConnect, qui permet d&#39;utiliser un appareil Android ou iOS compatible pour stocker des fonds, de la même manière qu&#39;un portefeuille matériel.</p>
</li>
<li class="data-line-570">
<p>Un portefeuille logiciel fonctionnant en JavaScript</p>
</li>
</ul>
</div>
<div class="admonitionblock warning data-line-573">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-574">
<p>Vous devez être très prudent lorsque vous accédez à MyEtherWallet et à d&#39;autres portefeuilles JavaScript basés sur un navigateur, car ils sont des cibles fréquentes pour le phishing. Utilisez toujours un signet et non un moteur de recherche ou un lien pour accéder à l&#39;URL Web correcte.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-578">
<h5 id="MyCrypto">MyCrypto</h5>
<div class="paragraph data-line-580">
<p>Début 2018, le  projet MyEtherWallet s&#39;est scindé en deux implémentations concurrentes, guidées par deux équipes de développement indépendantes : une &quot;fourche&quot; ou &quot;fork&quot;, comme on l&#39;appelle dans le développement à source libre. Les deux projets s&#39;appellent MyEtherWallet (la marque originale) et <a href="https://mycrypto.com/" data-href="https://mycrypto.com/">MyCrypto</a>. MyCrypto offre des fonctionnalités presque identiques à MyEtherWallet, mais au lieu d&#39;utiliser MEWConnect, il offre une connexion à l&#39;application mobile Parity Signer. Comme MEWConnect, Parity Signer stocke les clés sur le téléphone et s&#39;interface avec MyCrypto de la même manière qu&#39;un portefeuille matériel.</p>
</div>
</div>
<div class="sect4 data-line-583">
<h5 id="Mist">Mist (obsolète)</h5>
<div class="paragraph data-line-585">
<p><a href="https://github.com/ethereum/mist" data-href="https://github.com/ethereum/mist">Mist</a> était le premier navigateur compatible avec Ethereum, construit par la Fondation Ethereum. Il contenait un portefeuille basé sur un navigateur qui était la première implémentation de la norme de jeton ERC20 (Fabian Vogelsteller, auteur d&#39;ERC20, était également le principal développeur de Mist). Mist a également été le premier portefeuille à introduire la somme de contrôle camelCase (EIP-55). Depuis mars 2019, Mist est obsolète et ne doit plus être utilisé.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-587">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph data-line-9">
<p>Dans ce chapitre, nous avons exploré les clients Ethereum. Vous avez téléchargé, installé et synchronisé un client, devenant un participant au réseau Ethereum et contribuant à la santé et à la stabilité du système en répliquant la chaîne de blocs sur votre propre ordinateur.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="keys_addresses">Cryptographie</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>L&#39;une des technologies fondamentales d&#39;Ethereum est la <em>cryptographie</em>, qui est une branche des mathématiques largement utilisées en sécurité informatique. La cryptographie signifie &quot;écriture secrète&quot; en grec, mais l&#39;étude de la cryptographie englobe plus que la simple écriture secrète, appelée <em>cryptage</em>. La cryptographie peut, par exemple, également être utilisée pour prouver la connaissance d&#39;un secret sans le révéler (par exemple, avec une signature numérique), ou pour prouver l&#39;authenticité des données (par exemple, avec des empreintes digitales, également appelées &quot;hachages&quot;). Ces types de preuves cryptographiques sont des outils mathématiques essentiels au fonctionnement de la plate-forme Ethereum (et, en fait, de tous les systèmes de chaîne de blocs), et sont également largement utilisés dans les applications Ethereum. </p>
</div>
<div class="paragraph data-line-6">
<p>Notez qu&#39;au moment de la publication, aucune partie du protocole Ethereum n&#39;implique de cryptage ; c&#39;est-à-dire que toutes les communications avec la plateforme Ethereum et entre les nœuds (y compris les données de transaction) sont non cryptées et peuvent (nécessairement) être lues par n&#39;importe qui. C&#39;est ainsi que tout le monde peut vérifier l&#39;exactitude des mises à jour d&#39;état et qu&#39;un consensus peut être atteint. À l&#39;avenir, des outils cryptographiques avancés, tels que les preuves à zéro connaissance et le cryptage homomorphe, seront disponibles, ce qui permettra d&#39;enregistrer certains calculs cryptés sur la chaîne de blocs tout en permettant le consensus ; cependant, bien que des dispositions aient été prises à leur intention, elles n&#39;ont pas encore été déployées.</p>
</div>
<div class="paragraph data-line-8">
<p>Dans ce chapitre, nous présenterons une partie de la cryptographie utilisée dans Ethereum : à savoir la cryptographie à clé publique (PKC), qui est utilisée pour contrôler la propriété des fonds, sous la forme de clés privées et d&#39;adresses.</p>
</div>
<div class="sect2 data-line-11">
<h3 id="keys_addresses_intro">Clés et adresses</h3>
<div class="paragraph data-line-13">
<p>Comme nous l&#39;avons vu précédemment dans le livre, Ethereum a deux types de comptes différents : les <em>comptes détenus par des tiers ou en externe</em> (Externally Owned Accounts ou EOA) et les <em>contrats</em>. La propriété de l&#39;ether par les EOAs est établie par des <em>clés privées</em> numériques, des <em>adresses Ethereum</em> et des <em>signatures numériques</em>. Les clés privées sont au cœur de toutes les interactions des utilisateurs avec Ethereum. En fait, les adresses de compte sont directement dérivées des clés privées : une clé privée détermine de manière unique une seule adresse Ethereum, également appelée <em>compte</em>.</p>
</div>
<div class="paragraph data-line-15">
<p>Les clés privées ne sont en aucun cas utilisées directement dans le système Ethereum ; ils ne sont jamais transmis ou stockés sur Ethereum. C&#39;est-à-dire que les clés privées doivent rester privées et ne jamais apparaître dans les messages transmis au réseau, ni être stockées en chaîne ; seules les adresses de compte et les signatures numériques sont transmises et stockées sur le système Ethereum. Pour plus d&#39;informations sur la manière de conserver les clés privées en toute sécurité, consultez <a href="#control_responsibility">Contrôle et responsabilité</a> et <a href="#wallets_chapter">Portefeuilles</a>.</p>
</div>
<div class="paragraph data-line-17">
<p>L&#39;accès et le contrôle des fonds sont réalisés avec des signatures numériques, qui sont également créées à l&#39;aide de la clé privée. Les transactions Ethereum nécessitent une signature numérique valide pour être incluses dans la chaîne de blocs. Toute personne disposant d&#39;une copie d&#39;une clé privée a le contrôle du compte correspondant et de tout ether qu&#39;il détient. En supposant qu&#39;un utilisateur garde sa clé privée en sécurité, les signatures numériques dans les transactions Ethereum prouvent le véritable propriétaire des fonds, car elles prouvent la propriété de la clé privée.</p>
</div>
<div class="paragraph data-line-19">
<p> Dans les systèmes basés sur la cryptographie à clé publique, tels que ceux utilisés par Ethereum, les clés sont fournies par paires composées d&#39;une clé privée (secrète) et d&#39;une clé publique. Considérez la clé publique comme similaire à un numéro de compte bancaire et la clé privée comme similaire au code PIN secret ; c&#39;est ce dernier qui fournit le contrôle sur le compte, et le premier qui l&#39;identifie aux autres. Les clés privées elles-mêmes sont très rarement vues par les utilisateurs d&#39;Ethereum ; pour la plupart, ils sont stockés (sous forme cryptée) dans des fichiers spéciaux et gérés par le logiciel de portefeuille Ethereum.</p>
</div>
<div class="paragraph data-line-21">
<p>Dans la partie paiement d&#39;une transaction Ethereum, le destinataire prévu est représenté par une adresse Ethereum, qui est utilisée de la même manière que les détails du compte bénéficiaire d&#39;un virement bancaire. Comme nous le verrons plus en détail sous peu, une adresse Ethereum pour un EOA est générée à partir de la partie clé publique d&#39;une paire de clés. Cependant, toutes les adresses Ethereum ne représentent pas des paires de clés publiques-privées ; ils peuvent aussi représenter des contrats, qui, comme nous le verrons dans <a href="#smart_contracts_chapter">Contrats intelligents et Solidity</a>, ne sont pas soutenus par des clés privées.</p>
</div>
<div class="paragraph data-line-23">
<p>Dans le reste de ce chapitre, nous allons d&#39;abord explorer la cryptographie de base un peu plus en détail et expliquer les mathématiques utilisées dans Ethereum. Ensuite, nous verrons comment les clés sont générées, stockées et gérées. Enfin, nous passerons en revue les différents formats d&#39;encodage utilisés pour représenter les clés privées, les clés publiques et les adresses.</p>
</div>
</div>
<div class="sect2 data-line-26">
<h3 id="pkc">Cryptographie à clé publique et cryptomonnaie</h3>
<div class="paragraph data-line-28">
<p>La cryptographie à clé publique (également appelée &quot;cryptographie asymétrique&quot;) est un élément central de la sécurité de l&#39;information moderne. Le protocole d&#39;échange de clé, d&#39;abord publié dans les années 1970 par Martin Hellman, Whitfield Diffie et Ralph Merkle, a été une percée monumentale qui a suscité la première grande vague d&#39;intérêt public dans le domaine de la cryptographie. Avant les années 1970, de solides connaissances cryptographiques étaient gardées secrètes par <span class="keep-together">les gouvernements</span>.</p>
</div>
<div class="paragraph data-line-30">
<p>La cryptographie à clé publique utilise des clés uniques pour sécuriser les informations. Ces clés sont basées sur des fonctions mathématiques qui ont une propriété particulière : il est facile de les calculer, mais difficile de calculer leur inverse. Sur la base de ces fonctions, la cryptographie permet la création de secrets numériques et de signatures numériques infalsifiables, qui sont sécurisées par les lois des mathématiques.</p>
</div>
<div class="paragraph data-line-32">
<p>Par exemple, multiplier deux grands nombres premiers ensemble est trivial. Mais étant donné le produit de deux grands nombres premiers, il est très difficile de trouver les facteurs premiers (un problème appelé <em>factorisation primaire ou première</em>). Disons que nous présentons le nombre 8 018 009 et que nous vous disons qu&#39;il est le produit de deux nombres premiers. Trouver ces deux nombres premiers est beaucoup plus difficile pour vous que pour moi de les multiplier pour produire 8 018 009.</p>
</div>
<div class="paragraph data-line-34">
<p>Certaines de ces fonctions mathématiques peuvent être facilement inversées si vous connaissez des informations secrètes. Dans l&#39;exemple précédent, si je vous dis que l&#39;un des facteurs premiers est 2 003, vous pouvez trivialement trouver l&#39;autre avec une simple division : 8 018 009 ÷ 2 003 = 4 003. Ces fonctions sont souvent appelées <em>fonctions de trappe</em> car elles sont très difficiles à inverser à moins que vous ne receviez une information secrète qui peut être utilisée comme raccourci pour inverser la fonction.</p>
</div>
<div class="paragraph data-line-36">
<p>Une catégorie plus avancée de fonctions mathématiques utiles en cryptographie est basée sur des opérations arithmétiques sur une courbe elliptique. Dans l&#39;arithmétique des courbes elliptiques, la multiplication modulo d&#8217;un nombre premier est simple mais la division (l&#39;inverse) est pratiquement impossible.  C&#39;est ce qu&#39;on appelle le <em>problème de logarithme discret</em> et il n&#39;y a actuellement aucune trappe connue. La <em>cryptographie à courbe elliptique</em> est largement utilisée dans les systèmes informatiques modernes et constitue la base de l&#39;utilisation par Ethereum (et d&#39;autres cryptomonnaies) des clés privées et des signatures numériques.</p>
</div>
<div class="admonitionblock note data-line-39">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-40">
<p>Consultez les ressources suivantes si vous souhaitez en savoir plus sur la cryptographie et les fonctions mathématiques utilisées dans la cryptographie moderne :</p>
</div>
<div class="ulist data-line-42">
<ul>
<li class="data-line-42">
<p><a href="http://bit.ly/2DcwNhn" data-href="http://bit.ly/2DcwNhn">Cryptographie</a></p>
</li>
<li class="data-line-44">
<p><a href="http://bit.ly/2zeZV3c" data-href="http://bit.ly/2zeZV3c">Fonction trappe</a></p>
</li>
<li class="data-line-46">
<p><a href="http://bit.ly/2ACJjnV" data-href="http://bit.ly/2ACJjnV">Factorisation première</a></p>
</li>
<li class="data-line-48">
<p><a href="http://bit.ly/2Q7mZYI" data-href="http://bit.ly/2Q7mZYI">Logarithme discret</a></p>
</li>
<li class="data-line-50">
<p><a href="http://bit.ly/2zfeKCP" data-href="http://bit.ly/2zfeKCP">Cryptage des courbes elliptiques</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-53">
<p>Dans Ethereum, nous utilisons la cryptographie à clé publique (également connue sous le nom de cryptographie asymétrique) pour créer la paire de clés publique-privée dont nous avons parlé dans ce chapitre. Ils sont considérés comme une &quot;paire&quot; car la clé publique est dérivée de la clé privée. Ensemble, ils représentent un compte Ethereum en fournissant, respectivement, un identifiant de compte accessible au public (l&#39;adresse) et un contrôle privé sur l&#39;accès à tout ether du compte et sur toute authentification dont le compte a besoin lors de l&#39;utilisation de contrats intelligents. La clé privée contrôle l&#39;accès en étant l&#39;élément d&#39;information unique nécessaire pour créer des <em>signatures numériques</em>, qui sont nécessaires pour signer des transactions afin de dépenser des fonds sur le compte. Les signatures numériques sont également utilisées pour authentifier les propriétaires ou les utilisateurs de contrats, comme nous le verrons dans <a href="#smart_contracts_chapter">Contrats intelligents et Solidity</a>.</p>
</div>
<div class="admonitionblock tip data-line-56">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-57">
<p>Dans la plupart des implémentations de portefeuille, les clés privées et publiques sont stockées ensemble sous la forme d&#39;une <em>paire de clés</em> pour plus de commodité. Cependant, la clé publique peut être trivialement calculée à partir de la clé privée, de sorte qu&#39;il est également possible de ne stocker que la clé privée.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-60">
<p>Une signature numérique peut être créée pour signer n&#39;importe quel message. Pour les transactions Ethereum, les détails de la transaction elle-même sont utilisés comme message. Les mathématiques de la cryptographie - dans ce cas, la cryptographie à courbe elliptique - permettent de combiner le message (c&#39;est-à-dire les détails de la transaction) avec la clé privée pour créer un code qui ne peut être produit qu&#39;avec la connaissance de la clé privée. Ce
code s&#39;appelle la signature numérique. Notez qu&#39;une transaction Ethereum est essentiellement une demande d&#39;accès à un compte particulier avec une adresse Ethereum particulière. Lorsqu&#39;une transaction est envoyée au réseau Ethereum afin de déplacer des fonds ou d&#39;interagir avec des contrats intelligents, elle doit être envoyée avec une signature numérique créée avec la clé privée correspondant à l&#39;adresse Ethereum en question. Les mathématiques de la courbe elliptique signifient que <em>n&#39;importe qui</em> peut vérifier qu&#39;une transaction est valide, en vérifiant que la signature numérique correspond aux détails de la transaction <em>et</em> à l&#39;adresse Ethereum à laquelle l&#39;accès est demandé. La vérification n&#39;implique pas du tout la clé privée ; qui reste privé. Cependant, le processus de vérification détermine sans aucun doute que la transaction ne peut provenir que de quelqu&#39;un avec la clé privée qui correspond à la clé publique derrière l&#39;adresse Ethereum. C&#39;est la « magie » de la cryptographie à clé publique.</p>
</div>
<div class="admonitionblock tip data-line-65">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-66">
<p>Il n&#39;y a pas de cryptage dans le cadre du protocole Ethereum - tous les messages envoyés dans le cadre du fonctionnement du réseau Ethereum peuvent (nécessairement) être lus par tout le monde. En tant que telles, les clés privées ne sont utilisées que pour créer des signatures numériques pour l&#39;authentification des transactions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-70">
<h3 id="private_keys">Clés privées</h3>
<div class="paragraph data-line-72">
<p> Une clé privée est simplement un nombre, choisi au hasard. La propriété et le contrôle de la clé privée sont à la base du contrôle de l&#39;utilisateur sur tous les fonds associés à l&#39;adresse Ethereum correspondante, ainsi que de l&#39;accès aux contrats qui autorisent cette adresse. La clé privée est utilisée pour créer les signatures nécessaires pour dépenser de l&#39;ether en prouvant la propriété des fonds utilisés dans une transaction. La clé privée doit rester secrète à tout moment, car la révéler à des tiers équivaut à leur donner le contrôle de l&#39;ether et des contrats sécurisés par cette clé privée. La clé privée doit également être sauvegardée et protégée contre toute perte accidentelle. S&#39;il est perdu, il ne peut pas être récupéré et les fonds garantis par celui-ci sont également perdus à jamais.</p>
</div>
<div class="admonitionblock tip data-line-75">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-76">
<p>La clé privée Ethereum n&#39;est qu&#39;un chiffre. Une façon de choisir vos clés privées au hasard consiste simplement à utiliser une pièce de monnaie, un crayon et du papier : lancez une pièce 256 fois et vous obtenez les chiffres binaires d&#39;une clé privée aléatoire que vous pouvez utiliser dans un portefeuille Ethereum (probablement - voir la section suivante ). La clé publique et l&#39;adresse peuvent ensuite être générées à partir de la clé privée.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-80">
<h4 id="generating_private_key">Générer une clé privée à partir d&#39;un nombre aléatoire</h4>
<div class="paragraph data-line-82">
<p>Le premier et l&#39;étape la plus importante dans la génération de clés consiste à trouver une source sécurisée d&#39;entropie ou de caractère aléatoire. La création d&#39;une clé privée Ethereum consiste essentiellement à choisir un nombre compris entre 1 et 2<sup>256</sup>. La méthode exacte que vous utilisez pour choisir ce nombre n&#39;a pas d&#39;importance tant qu&#39;elle n&#39;est pas prévisible ou déterministe. Le logiciel Ethereum utilise le générateur de nombres aléatoires du système d&#39;exploitation sous-jacent pour produire 256 bits aléatoires. Habituellement, le générateur de nombres aléatoires du système d&#39;exploitation est initialisé par une source humaine d&#39;aléatoire, c&#39;est pourquoi il peut vous être demandé de remuer votre souris pendant quelques secondes ou d&#39;appuyer sur des touches aléatoires de votre clavier. Une alternative pourrait être le bruit de rayonnement cosmique sur le canal du microphone de l&#39;ordinateur.</p>
</div>
<div class="paragraph data-line-84">
<p>Plus précisément, une clé privée peut être n&#39;importe quel nombre différent de zéro jusqu&#39;à un très grand nombre légèrement inférieur à 2<sup>256</sup> - un énorme nombre à 78 chiffres, environ 1,158 * 10<sup>77</sup>. Le nombre exact partage les 38 premiers chiffres avec 2<sup>256</sup> et est défini comme l&#39;ordre de la courbe elliptique utilisée dans Ethereum (voir <a href="#elliptic_curve">La cryptographie à courbe elliptique expliquée</a>). Pour créer une clé privée, nous choisissons au hasard un nombre de 256 bits et vérifions qu&#39;il se trouve dans la plage valide. En termes de programmation, cela est généralement réalisé en introduisant une chaîne encore plus grande de bits aléatoires (collectés à partir d&#39;une source aléatoire sécurisée par cryptographie) dans un algorithme de hachage de 256 bits tel que Keccak-256 ou SHA-256, qui produiront commodément un nombre de 256 bits. Si le résultat est dans la plage valide, nous avons une clé privée appropriée. Sinon, nous réessayons simplement avec un autre nombre aléatoire.</p>
</div>
<div class="admonitionblock tip data-line-87">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-88">
<p>2<sup>256</sup> - la taille de l&#39;espace de clé privée d&#39;Ethereum - est un nombre insondable. Il est d&#39;environ 10<sup>77</sup> en décimal ; c&#39;est-à-dire un nombre à 77 chiffres. À titre de comparaison, on estime que l&#39;univers visible contient 10<sup>80</sup> atomes. Ainsi, il y a presque assez de clés privées pour donner à chaque atome de l&#39;univers un compte Ethereum. Si vous choisissez une clé privée au hasard, il est impossible que quelqu&#39;un la devine ou la choisisse lui-même.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-91">
<p>Notez que le processus de génération de clé privée est hors ligne ; il ne nécessite aucune communication avec le réseau Ethereum, ni même aucune communication avec qui que ce soit. En tant que tel, afin de choisir un nombre que personne d&#39;autre ne choisira jamais, il doit être vraiment aléatoire. Si vous choisissez vous-même le numéro, la probabilité que quelqu&#39;un d&#39;autre l&#39;essaie (et s&#39;enfuie ensuite avec votre ether) est trop élevée. Utiliser un mauvais générateur de nombres aléatoires (comme la fonction pseudo-aléatoire rand dans la plupart des langages de programmation) est encore pire, car il est encore plus évident et encore plus facile à reproduire. Tout comme pour les mots de passe des comptes en ligne, la clé privée doit être impossible à deviner. Heureusement, vous n&#39;avez jamais besoin de vous souvenir de votre clé privée, vous pouvez donc adopter la meilleure approche possible pour la choisir : à savoir, le vrai hasard.</p>
</div>
<div class="admonitionblock warning data-line-94">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-95">
<p>N&#39;écrivez pas votre propre code pour créer un nombre aléatoire ou n&#39;utilisez pas un &quot;simple&quot; générateur de nombres aléatoires proposé par votre langage de programmation. Il est essentiel que vous utilisiez un générateur de nombres pseudo-aléatoires cryptographiquement sécurisé (tel que CSPRNG) avec une valeur d&#8217;amorçage provenant d&#39;une source d&#39;entropie suffisante. Étudiez la documentation de la bibliothèque de générateurs de nombres aléatoires que vous choisissez pour vous assurer qu&#39;elle est cryptographiquement sécurisée. La mise en œuvre correcte de la bibliothèque CSPRNG est essentielle à la sécurité des clés.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-98">
<p>Ce qui suit est une clé privée générée aléatoirement affichée au format hexadécimal (256 bits affichés sous la forme de 64 chiffres hexadécimaux, chacun de 4 bits) :</p>
</div>
<div id="prv_key_example" class="listingblock data-line-101">
<div class="content">
<pre>f8f8a2f43c8376ccb0871305060d7b27b0554d2cc72bccf41b2705608452f315</pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-107">
<h3 id="pubkey">Clés publiques</h3>
<div class="paragraph data-line-109">
<p>Une clé publique Ethereum est un <em>point</em> sur une courbe elliptique, ce qui signifie qu&#39;il s&#39;agit d&#39;un ensemble de coordonnées <em>x</em> et <em>y</em> qui satisfont l&#39;équation de la courbe elliptique.</p>
</div>
<div class="paragraph data-line-111">
<p>En termes plus simples, une clé publique Ethereum est constituée de deux nombres réunis. Ces chiffres sont produits à partir de la clé privée par un calcul qui ne peut <em>aller que dans un sens</em>. Cela signifie qu&#39;il est trivial de calculer une clé publique si vous avez la clé privée, mais vous ne pouvez pas calculer la clé privée à partir de la clé publique.</p>
</div>
<div class="admonitionblock warning data-line-114">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-115">
<p>Des MATHÉMATIQUES sont sur le point d&#39;arriver! Ne pas paniquer. Si vous commencez à vous perdre à n&#39;importe quel moment dans les paragraphes suivants, vous pouvez ignorer les quelques sections suivantes. Il existe de nombreux outils et bibliothèques qui feront le calcul pour vous.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-118">
<p>La clé publique est calculée à partir de la clé privée en utilisant la multiplication par courbe elliptique, qui est pratiquement irréversible : <em>K</em> = <em>k</em> * <em>G</em>, où <em>k</em> est la clé privée, <em>G</em> est un point constant appelé le <em>point générateur</em>, <em>K</em> est la clé publique résultante et * est l&#39;opérateur spécial de &quot;multiplication&quot; de la courbe elliptique. Notez que la multiplication de courbe elliptique n&#39;est pas comme la multiplication normale. Il partage des attributs fonctionnels avec la multiplication normale, mais c&#39;est à peu près tout. Par exemple, l&#39;opération inverse (qui serait une division pour des nombres normaux), connue sous le nom de &quot;trouver le logarithme discret&quot; - c&#39;est-à-dire calculer <em>k</em> si vous connaissez <em>K</em> - est aussi difficile que d&#39;essayer toutes les valeurs possibles de <em>k</em> (une recherche par force brute cela prendra probablement plus de temps que cet univers ne le permettra).</p>
</div>
<div class="paragraph data-line-120">
<p>En termes plus simples : l&#39;arithmétique sur la courbe elliptique est différente de l&#39;arithmétique entière &quot;régulière&quot;. Un point (<em>G</em>) peut être multiplié par un entier (<em>k</em>) pour produire un autre point (<em>K</em>). Mais la <em>division</em> n&#39;existe pas, il n&#39;est donc pas possible de simplement &quot;diviser&quot; la clé publique <em>K</em> par le point <em>G</em> pour calculer la clé privée <em>k</em>. Il s&#39;agit de la fonction mathématique à sens unique décrite dans <a href="#pkc">Cryptographie à clé publique et cryptomonnaie</a>.</p>
</div>
<div class="admonitionblock note data-line-123">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-124">
<p>La multiplication de courbe elliptique est un type de fonction que les cryptographes appellent une fonction &quot;à sens unique&quot; : elle est facile à faire dans un sens (multiplication) et impossible à faire dans le sens inverse (division). Le propriétaire de la clé privée peut facilement créer la clé publique puis la partager avec le monde, sachant que personne ne peut inverser la fonction et calculer la clé privée à partir de la clé publique. Cette astuce mathématique devient la base de signatures numériques infalsifiables et sécurisées qui prouvent la propriété des fonds Ethereum et le contrôle des contrats.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-127">
<p>Avant de montrer comment générer une clé publique à partir d&#39;une clé privée, examinons un peu plus en détail la cryptographie à courbe elliptique.</p>
</div>
<div class="sect3 data-line-131">
<h4 id="elliptic_curve">La cryptographie à courbe elliptique expliquée</h4>
<div class="paragraph data-line-133">
<p>La courbe elliptique cryptographique est un type de cryptographie asymétrique ou cryptographie à clé publique basée sur le problème du logarithme discret exprimé par addition et multiplication sur les points d&#39;une courbe elliptique.</p>
</div>
<div class="paragraph data-line-135">
<p><a href="#ecc-curve">Une visualisation d&#39;une courbe elliptique</a> est un exemple de courbe elliptique, similaire à celle utilisée par Ethereum.</p>
</div>
<div class="admonitionblock note data-line-138">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-139">
<p>Ethereum utilise exactement la même courbe elliptique, appelée secp256k1, que Bitcoin. Cela permet de réutiliser de nombreuses bibliothèques et outils de courbes elliptiques de Bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ecc-curve" class="imageblock data-line-144">
<div class="content">
<img src="images/simple_elliptic_curve.png" alt="ecc-curve">
</div>
<div class="title">Figure 25. Une visualisation d&#39;une courbe elliptique</div>
</div>
<div class="paragraph data-line-146">
<p>Ethereum utilise une courbe elliptique spécifique et un ensemble de constantes mathématiques, telles que définies dans une norme appelée secp256k1, établie par le National Institute of Standards and Technology (NIST) des États-Unis. La courbe secp256k1 est définie par la fonction suivante, qui produit une courbe elliptique :</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mrow>
      <msup><mi>y</mi> <mn>2</mn> </msup>
      <mo>=</mo>
      <mrow>
        <mo>(</mo>
        <msup><mi>x</mi> <mn>3</mn> </msup>
        <mo>+</mo>
        <mn>7</mn>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mspace width="3.33333pt"/>
    <mtext>over</mtext>
    <mspace width="3.33333pt"/>
    <mrow>
      <mo>(</mo>
      <msub><mi>&#x1d53d;</mi> <mi>p</mi> </msub>
      <mo>)</mo>
    </mrow>
  </mrow>
</math>
</div>
<div class="paragraph data-line-176">
<p>ou alors:</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <msup><mi>y</mi> <mn>2</mn> </msup>
    <mspace width="3.33333pt"/>
    <mo form="prefix">mod</mo>
    <mspace width="0.277778em"/>
    <mi>p</mi>
    <mo>=</mo>
    <mrow>
      <mo>(</mo>
      <msup><mi>x</mi> <mn>3</mn> </msup>
      <mo>+</mo>
      <mn>7</mn>
      <mo>)</mo>
    </mrow>
    <mspace width="3.33333pt"/>
    <mo form="prefix">mod</mo>
    <mspace width="0.277778em"/>
    <mi>p</mi>
  </mrow>
</math>
</div>
<div class="paragraph data-line-204">
<p>Le <em>mod p</em> (modulo nombre premier <em>p</em>) indique que cette courbe est sur un corps fini d&#39;ordre premier <em>p</em>, également écrit comme \(\( \mathbb{F}_p \)\), où <em>p</em> = 2<sup>256</sup> – 2<sup>32</sup> – 2<sup>9</sup> – 2<sup>8</sup> – 2<sup>7</sup> – 2<sup>6</sup> – 2<sup>4</sup> – 1, qui est un très grand nombre premier.</p>
</div>
<div class="paragraph data-line-206">
<p>Parce que cette courbe est définie sur un champ fini d&#39;ordre premier au lieu de sur les nombres réels, elle ressemble à un motif de points dispersés en deux dimensions, ce qui la rend difficile à visualiser. Cependant, le calcul est identique à celui d&#39;une courbe elliptique sur des nombres réels. A titre d&#39;exemple, <a href="#ecc-over-F17-math">Cryptographie sur courbe elliptique: visualisation d&#39;une courbe elliptique sur F(p), avec p=17</a> montre la même courbe elliptique sur un champ fini beaucoup plus petit d&#39;ordre premier 17, montrant un motif de points sur une grille. La courbe elliptique secp256k1 Ethereum peut être considérée comme un motif beaucoup plus complexe de points sur une grille insondable.</p>
</div>
<div id="ecc-over-F17-math" class="imageblock smallersixty data-line-211">
<div class="content">
<img src="images/ec_over_small_prime_field.png" alt="&quot;ecc-over-F17-math&quot;">
</div>
<div class="title">Figure 26. Cryptographie sur courbe elliptique: visualisation d&#39;une courbe elliptique sur F(p), avec p=17</div>
</div>
<div class="paragraph data-line-213">
<p>Ainsi, par exemple, ce qui suit est un point <em>Q</em> avec des coordonnées (<em>x</em>,<em>y</em>) qui est un point sur la courbe secp256k1 :</p>
</div>
<div id="coordinates_example" class="listingblock data-line-216">
<div class="content">
<pre>Q =
(49790390825249384486033144355916864607616083520101638681403973749255924539515,
59574132161899900045862086493921015780032175291755807399284007721050341297360)</pre>
</div>
</div>
<div class="paragraph data-line-222">
<p><a href="#example_1">[example_1]</a> montre comment vous pouvez vérifier cela vous-même en utilisant Python. Les variables x et y sont les coordonnées du point <em>Q</em>, comme dans l&#39;exemple précédent. La variable p est l&#39;ordre premier de la courbe elliptique (le premier qui est utilisé pour toutes les opérations modulo). La dernière ligne de Python est l&#39;équation de la courbe elliptique (l&#39;opérateur % en Python est l&#39;opérateur modulo). Si x et y sont bien les coordonnées d&#39;un point sur la courbe elliptique, alors elles satisfont l&#39;équation et le résultat est zéro (0L est un entier long valant zéro). Essayez vous-même, en tapant <strong>python</strong> sur une ligne de commande et en copiant chaque ligne (après l&#39;invite + &gt;&gt;&gt; +) de la liste.</p>
</div>
<div data-type="example" id="example_1">
<h5>Utiliser Python pour confirmer que ce point est sur la courbe elliptique</h5>
<pre data-type="programlisting">
Python 3.4.0 (default, Mar 30 2014, 19:23:13)
[GCC 4.2.1 Compatible Apple LLVM 5.1 (clang-503.0.38)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> <strong>p = 115792089237316195423570985008687907853269984665640564039457584007908834 \
671663</strong>
>>> <strong>x = 49790390825249384486033144355916864607616083520101638681403973749255924539515</strong>
>>> <strong>y = 59574132161899900045862086493921015780032175291755807399284007721050341297360</strong>
>>> <strong>(x ** 3 + 7 - y**2) % p</strong>
0L

</pre>
</div>
</div>
<div class="sect3 data-line-243">
<h4 id="EC_math">Opérations arithmétiques sur les courbes elliptiques</h4>
<div class="paragraph data-line-245">
<p>Beaucoup de mathématiques sur les courbes elliptiques ressemblent beaucoup à l&#39;arithmétique des nombres entiers que nous avons apprise à l&#39;école. Plus précisément, nous pouvons définir un opérateur d&#39;addition qui, au lieu de sauter le long de la droite numérique, saute vers d&#39;autres points de la courbe. Une fois que nous avons l&#39;opérateur d&#39;addition, nous pouvons également définir la multiplication d&#39;un point et d&#39;un nombre entier, ce qui équivaut à une addition répétée.</p>
</div>
<div class="paragraph data-line-247">
<p>L&#39;addition de courbe elliptique est définie de telle sorte que, étant donné deux points <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub> sur la courbe elliptique, il existe un troisième point <em>P</em><sub>3</sub> = <em>P</em><sub>1</sub> + <em>P</em><sub>2</sub>, également sur la courbe elliptique.</p>
</div>
<div class="paragraph data-line-249">
<p>Géométriquement, ce troisième point <em>P</em><sub>3</sub> est calculé en traçant une ligne entre <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub>. Cette ligne coupera la courbe elliptique exactement à un endroit supplémentaire (étonnamment). Appelez ce point <em>P</em><sub>3</sub>&#39; = (<em>x</em>, <em>y</em>). Réfléchissez ensuite sur l&#39;axe des x pour obtenir <em>P</em><sub>3</sub> = (<em>x</em>, <em>–y</em>).</p>
</div>
<div class="paragraph data-line-251">
<p>Si <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub> sont au même point, la ligne &quot;entre&quot; <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub> devrait s&#39;étendre pour être la tangente à la courbe en ce point <em>P</em><sub>1</sub>. Cette tangente coupera la courbe exactement en un nouveau point. Vous pouvez utiliser des techniques de calcul pour déterminer la pente de la ligne tangente. Curieusement, ces techniques fonctionnent, même si nous restreignons notre intérêt aux points de la courbe à deux coordonnées entières !</p>
</div>
<div class="paragraph data-line-253">
<p>Dans les mathématiques des courbes elliptiques, il existe également un point appelé &quot;point à l&#39;infini&quot;, qui correspond à peu près au rôle du nombre zéro en addition. Sur les ordinateurs, il est parfois représenté par <em>x</em> = <em>y</em> = 0 (ce qui ne satisfait pas l&#39;équation de la courbe elliptique, mais c&#39;est un cas séparé facile qui peut être vérifié). Il y a quelques cas particuliers qui expliquent la nécessité du point à l&#39;infini.</p>
</div>
<div class="paragraph data-line-255">
<p>Dans certains cas (par exemple, si <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub> ont les mêmes valeurs <em>x</em> mais des valeurs <em>y</em> différentes), la ligne sera exactement verticale, auquel cas <em>P</em><sub>3</sub> = le point à l&#39;infini.</p>
</div>
<div class="paragraph data-line-257">
<p>Si <em>P</em><sub>1</sub> est le point à l&#39;infini, alors <em>P</em><sub>1</sub> + <em>P</em><sub>2</sub> = <em>P</em><sub>2</sub>. De même, si <em>P</em><sub>2</sub> est le point à l&#39;infini, alors <em>P</em><sub>1</sub> + <em>P</em><sub>2</sub> = <em>P</em><sub>1</sub>. Cela montre comment le point à l&#39;infini joue le rôle que joue zéro dans l&#39;arithmétique &quot;normale&quot;.</p>
</div>
<div class="paragraph data-line-259">
<p>Il s&#39;avère que + est associatif, ce qui signifie que (<em>A</em> + <em>B</em>) + <em>C</em> = <em>A</em> + (<em>B</em> + <em>C</em>). Cela signifie que nous pouvons écrire <em>A</em> + <em>B</em> + <em>C</em> (sans parenthèses) sans ambiguïté.</p>
</div>
<div class="paragraph data-line-261">
<p>Maintenant que nous avons défini l&#39;addition, nous pouvons définir la multiplication de la manière standard qui étend l&#39;addition. Pour un point <em>P</em> sur la courbe elliptique, si <em>k</em> est un nombre entier, alors <em>k</em> * <em>P</em> = <em>P</em> + <em>P</em> + <em>P</em> + &#8230;&#8203; + <em>P</em> (<em>k</em> fois). Notez que <em>k</em> est parfois (peut-être de manière déroutante) appelé un &quot;exposant&quot; dans ce cas.</p>
</div>
</div>
<div class="sect3 data-line-264">
<h4 id="public_key_derivation">Génération d&#39;une clé publique</h4>
<div class="paragraph data-line-266">
<p>Commencer avec une clé privée sous la forme d&#39;un nombre <em>k</em> généré aléatoirement, nous le multiplions par un point prédéterminé sur la courbe appelé <em>point générateur</em> <em>G</em> pour produire un autre point ailleurs sur la courbe, qui est la clé publique correspondante <em>K</em> :</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mi>K</mi>
    <mo>=</mo>
    <mi>k</mi>
    <mo>*</mo>
    <mi>G</mi>
  </mrow>
</math>
</div>
<div class="paragraph data-line-282">
<p>Le point générateur est spécifié dans le cadre de la norme secp256k1 ; c&#39;est la même chose pour toutes les implémentations de secp256k1, et toutes les clés dérivées de cette courbe utilisent le même point <em>G</em>. Comme le point générateur est toujours le même pour tous les utilisateurs d&#39;Ethereum, une clé privée <em>k</em> multipliée par <em>G</em> donnera toujours la même clé publique <em>K</em>. La relation entre <em>k</em> et <em>K</em> est fixe, mais ne peut être calculée que dans un sens, de <em>k</em> vers <em>K</em>. C&#39;est pourquoi une adresse Ethereum (dérivée de <em>K</em>) peut être partagée avec n&#39;importe qui et ne révèle pas la clé privée de l&#39;utilisateur (<em>k</em>).</p>
</div>
<div class="paragraph data-line-284">
<p>Comme nous l&#39;avons décrit dans la section précédente, la multiplication de <em>k</em> * <em>G</em> est équivalente à une addition répétée, donc <em>G</em> + <em>G</em> + <em>G</em> + &#8230;&#8203; + <em>G</em>, répété <em>k</em> fois. En résumé, pour produire une clé publique <em>K</em> à partir d&#39;une clé privée <em>k</em>, on ajoute le point générateur <em>G</em> à lui-même, <em>k</em> fois.</p>
</div>
<div class="admonitionblock tip data-line-287">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-288">
<p>Une clé privée peut être convertie en clé publique, mais une clé publique ne peut pas être reconvertie en clé privée, car le calcul ne fonctionne que dans un sens.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-291">
<p>Appliquons ce calcul pour trouver la clé publique de la clé privée spécifique que nous vous avons montrée dans <a href="#private_keys">Clés privées</a> :</p>
</div>
<div id="example_privkey" class="listingblock data-line-296">
<div class="title">Exemple de calcul de clé privée à clé publique</div>
<div class="content">
<pre>K = f8f8a2f43c8376ccb0871305060d7b27b0554d2cc72bccf41b2705608452f315 * G</pre>
</div>
</div>
<div class="paragraph data-line-300">
<p>Une bibliothèque cryptographique peut nous aider à calculer <em>K</em>, en utilisant la multiplication de courbes elliptiques. La clé publique résultante <em>K</em> est définie comme le point :</p>
</div>
<div class="listingblock data-line-302">
<div class="content">
<pre>K = (x, y)</pre>
</div>
</div>
<div class="paragraph data-line-306">
<p>où:</p>
</div>
<div class="listingblock data-line-308">
<div class="content">
<pre>x = 6e145ccef1033dea239875dd00dfb4fee6e3348b84985c92f103444683bae07b
y = 83b5c38e5e2b0c8529d7fa3f64d46daa1ece2d9ac14cab9477d042c84c32ccd0</pre>
</div>
</div>
<div class="paragraph data-line-313">
<p>Dans Ethereum, vous pouvez voir des clés publiques représentées par une sérialisation de 130 caractères hexadécimaux (65 octets ). Ceci est adopté à partir d&#39;un format de sérialisation standard proposé par le consortium industriel Standards for Efficient Cryptography Group (SECG), documenté dans <a href="http://www.secg.org/sec1-v2.pdf" class="undefined" data-href="http://www.secg.org/sec1-v2.pdf">http://www.secg.org/sec1-v2.pdf</a> [Standards for Efficient Cryptography (SEC1)]. La norme définit quatre préfixes possibles pouvant être utilisés pour identifier des points sur une courbe elliptique, répertoriés dans <a href="#EC_prefix_table">Préfixes de clé publique EC sérialisés</a>.</p>
</div>
<table id="EC_prefix_table" class="tableblock frame-all grid-all stretch data-line-318">
<caption class="title">Table 2. Préfixes de clé publique EC sérialisés</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Préfixe</th>
<th class="tableblock halign-left valign-top">Signification</th>
<th class="tableblock halign-left valign-top">Longueur (octets comptant le préfixe)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointe à l&#39;infini</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point non compressé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">65</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point compressé avec pair y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point compressé avec impair y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-326">
<p>Ethereum utilise uniquement des clés publiques non compressées ; par conséquent, le seul préfixe pertinent est (hex) 04. La sérialisation concatène les coordonnées <em>x</em> et <em>y</em> de la clé publique :</p>
</div>
<div id="concat_coordinates" class="listingblock data-line-329">
<div class="content">
<pre>04 + coordonnée x (32 octets/64 hex) + coordonnée y (32 octets/64 hex)</pre>
</div>
</div>
<div class="paragraph data-line-333">
<p>Par conséquent, la clé publique que nous avons calculée précédemment est sérialisée comme suit :</p>
</div>
<div id="serialized_pubkey" class="listingblock data-line-336">
<div class="content">
<pre>046e145ccef1033dea239875dd00dfb4fee6e3348b84985c92f103444683bae07b83b5c38e5e2b0 \
c8529d7fa3f64d46daa1ece2d9ac14cab9477d042c84c32ccd0</pre>
</div>
</div>
</div>
<div class="sect3 data-line-342">
<h4 id="EC_lib">Bibliothèques de courbes elliptiques</h4>
<div class="paragraph data-line-344">
<p>Il existe quelques implémentations de la courbe elliptique secp256k1 qui sont utilisées dans les projets liés à la cryptomonnaie :</p>
</div>
<div class="dlist data-line-346">
<dl>
<dt class="hdlist1"><a href="https://www.openssl.org/" data-href="https://www.openssl.org/">OpenSSL</a></dt>
<dd>
<p>La bibliothèque OpenSSL offre un ensemble complet de primitives cryptographiques, y compris une implémentation complète de secp256k1. Par exemple, pour dériver la clé publique, la fonction EC_POINT_mul peut être utilisée.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin-core/secp256k1" data-href="https://github.com/bitcoin-core/secp256k1">libsecp256k1</a></dt>
<dd>
<p>libsecp256k1 de Bitcoin Core est une implémentation en langage C de la courbe elliptique secp256k1 et d&#39;autres primitives cryptographiques. Il a été écrit à partir de zéro pour remplacer OpenSSL dans le logiciel Bitcoin Core et est considéré comme supérieur en termes de performances et de sécurité.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 data-line-351">
<h3 id="hash_functions">Fonctions de hachage cryptographique</h3>
<div class="paragraph data-line-353">
<p>Les fonctions de hachage cryptographiques sont utilisées dans Ethereum. En fait, les fonctions de hachage sont largement utilisées dans presque tous les systèmes cryptographiques - un fait capturé par <span class="keep-together">cryptographeur</span> <a href="http://bit.ly/2Q79qZp" data-href="http://bit.ly/2Q79qZp">Bruce Schneier</a>, qui a dit , &quot;Bien plus que des algorithmes de chiffrement, les fonctions de hachage unidirectionnelles sont les bêtes de somme de la cryptographie moderne.&quot;</p>
</div>
<div class="paragraph data-line-355">
<p>Dans cette section, nous discuterons des fonctions de hachage, explorerons leurs propriétés de base et verrons comment ces propriétés les rendent si utiles dans de nombreux domaines de la cryptographie moderne. Nous abordons ici les fonctions de hachage car elles font partie de la transformation des clés publiques Ethereum en adresses. Ils peuvent également être utilisés pour créer des <em>empreintes digitales</em>, qui facilitent la vérification des données.</p>
</div>
<div class="paragraph data-line-357">
<p>En termes simples, une <a href="http://bit.ly/2CR26gD" data-href="http://bit.ly/2CR26gD"><em>fonction de hachage</em></a> est &quot;toute fonction qui peut être utilisée pour mapper des données de taille arbitraire à des données de taille fixe. ” L&#39;entrée d&#39;une fonction de hachage est appelée une <em>pré-image</em>, le <em>message</em> ou simplement les <em>données d&#39;entrée</em>. La sortie est appelée <em>hash</em> ou <em>résultat de hachage</em> ou <em>hachage</em> en français. <a href="http://bit.ly/2Jrn3jM" data-href="http://bit.ly/2Jrn3jM"><em>Les fonctions de hachage cryptographiques</em></a> sont une sous-catégorie spéciale qui possède des propriétés spécifiques utiles pour sécuriser les plates-formes, telles qu&#39;Ethereum.</p>
</div>
<div class="paragraph data-line-359">
<p>Une fonction de hachage cryptographique est une fonction de hachage <em>unidirectionnelle</em> qui associe des données de taille arbitraire à une chaîne de bits de taille fixe. La nature &quot;unidirectionnelle&quot; signifie qu&#39;il est impossible de recréer les données d&#39;entrée si l&#39;on ne connaît que le hachage de sortie. La seule façon de déterminer une entrée possible est de mener une recherche par force brute, en vérifiant chaque candidat pour une sortie correspondante ; étant donné que l&#39;espace de recherche est virtuellement infini, il est aisé de comprendre l&#39;impossibilité pratique de la tâche. Même si vous trouvez des données d&#39;entrée qui créent un hachage correspondant, il se peut qu&#39;il ne s&#39;agisse pas des données d&#39;entrée d&#39;origine : les fonctions de hachage sont des fonctions &quot;plusieurs vers un&quot;. Trouver deux ensembles de données d&#39;entrée qui hachent la même sortie s&#39;appelle trouver une <em>collision de hachage</em>. En gros, plus la fonction de hachage est bonne, plus les collisions de hachage sont rares. Pour Ethereum, ils sont effectivement impossibles.</p>
</div>
<div class="paragraph data-line-361">
<p>Regardons de plus près les principales propriétés des fonctions de hachage cryptographiques. Ceux-ci inclus:</p>
</div>
<div class="dlist data-line-363">
<dl>
<dt class="hdlist1">Déterministe </dt>
<dd>
<p>Un message d&#39;entrée donné produit toujours la même sortie de hachage.</p>
</dd>
<dt class="hdlist1">Vérifiable </dt>
<dd>
<p>Le calcul du hachage d&#39;un message est efficace (complexité linéaire).</p>
</dd>
<dt class="hdlist1">Non-corrélationnaire</dt>
<dd>
<p>Une petite modification du message (par exemple, un changement de 1 bit) devrait modifier la sortie de hachage si largement qu&#39;elle ne peut pas être corrélée au hachage du message d&#39;origine.</p>
</dd>
<dt class="hdlist1">Irréversibile</dt>
<dd>
<p>Le calcul du message à partir de son hachage est irréalisable, ce qui équivaut à une recherche par force brute dans tous les messages possibles.</p>
</dd>
<dt class="hdlist1">Protection contre les collisions</dt>
<dd>
<p>Il devrait être impossible de calculer deux messages différents qui produisent la même sortie de hachage.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-373">
<p>La résistance aux collisions de hachage est particulièrement importante pour éviter la falsification de signature numérique dans Ethereum.</p>
</div>
<div class="paragraph data-line-375">
<p>La combinaison de ces propriétés rend les fonctions de hachage cryptographiques utiles pour un large éventail d&#39;applications de sécurité, notamment :</p>
</div>
<div class="ulist data-line-377">
<ul>
<li class="data-line-377">
<p>Empreinte des données</p>
</li>
<li class="data-line-378">
<p>Intégrité des messages (détection d&#39;erreur)</p>
</li>
<li class="data-line-379">
<p>Preuve de travail</p>
</li>
<li class="data-line-380">
<p>Authentification (hachage de mot de passe et étirement de clé)</p>
</li>
<li class="data-line-381">
<p>Générateurs de nombres pseudo-aléatoires</p>
</li>
<li class="data-line-382">
<p>Engagement de message (mécanismes de validation-révélation)</p>
</li>
<li class="data-line-383">
<p>Identifiants uniques</p>
</li>
</ul>
</div>
<div class="paragraph data-line-385">
<p>Nous en trouverons beaucoup dans Ethereum au fur et à mesure que nous progressons dans les différentes couches du système.</p>
</div>
<div class="sect3 data-line-388">
<h4 id="keccak256">Fonction de hachage cryptographique d&#39;Ethereum : Keccak-256</h4>
<div class="paragraph data-line-390">
<p>Ethereum utilise le hachage cryptographique <em>Keccak-256</em> dans de nombreux endroits. Keccak-256 a été conçu comme candidat pour le SHA-3 Cryptographic Hash Function Competition organisé en 2007 par le National Institute of Science and Technology (NIST). Keccak était l&#39;algorithme gagnant, qui a été normalisé en tant que Federal Information Processing Standard (FIPS) 202 en 2015.</p>
</div>
<div class="paragraph data-line-392">
<p>Cependant, pendant la période de développement d&#39;Ethereum, la normalisation du NIST n&#39;était pas encore finalisée. Le NIST a ajusté certains des paramètres de Keccak après l&#39;achèvement du processus de normalisation, prétendument pour améliorer son efficacité. Cela se produisait en même temps que le dénonciateur héroïque Edward Snowden a révélé des documents qui impliquent que le NIST pourrait avoir été indûment influencé par la National Security Agency (NSA) pour affaiblir intentionnellement la norme de générateur de nombres aléatoires Dual_EC_DRBG, plaçant effectivement une porte dérobée dans le générateur de nombres aléatoires standard. Le résultat de cette controverse a été une réaction violente contre les modifications proposées et un retard important dans la normalisation de SHA-3. À l&#39;époque, la Fondation Ethereum a décidé d&#39;implémenter l&#39;algorithme Keccak original, tel que proposé par ses inventeurs, plutôt que la norme SHA-3 telle que modifiée par le NIST.</p>
</div>
<div class="admonitionblock warning data-line-395">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-396">
<p>Bien que vous puissiez voir &quot;SHA-3&quot; mentionné dans les documents et le code Ethereum, beaucoup, sinon toutes, de ces instances font en fait référence à Keccak-256, et non à la norme FIPS-202 SHA-3 finalisée. Les différences d&#39;implémentation sont légères, liées aux paramètres de remplissage, mais elles sont importantes dans la mesure où Keccak-256 produit des sorties de hachage différentes de FIPS-202 SHA-3 pour la même entrée.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-400">
<h4 id="which_hash">Quelle fonction de hachage suis-je en train d&#39;utiliser ?</h4>
<div class="paragraph data-line-402">
<p>Comment pouvez-vous savoir si la bibliothèque de logiciels que vous utilisez implémente FIPS-202 SHA-3 ou Keccak-256, si les deux pouvaient s&#39;appeler &quot;SHA-3&quot; ?</p>
</div>
<div class="paragraph data-line-404">
<p>Un moyen simple de le dire est d&#39;utiliser un <em>vecteur de test</em>, une sortie attendue pour une entrée donnée. Le test le plus couramment utilisé pour une fonction de hachage est l' <em>entrée vide</em>. Si vous exécutez la fonction de hachage avec une chaîne vide en entrée, vous devriez voir les résultats suivants :</p>
</div>
<div class="listingblock data-line-406">
<div class="content">
<pre>Keccak256("") =
  c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470

SHA3("") =
  a7ffc6f8bf1ed76651c14756a061d662f580ff4de43b49fa82d80a4b80f8434a</pre>
</div>
</div>
<div class="paragraph data-line-415">
<p>Quel que soit le nom de la fonction, vous pouvez la tester pour voir s&#39;il s&#39;agit du Keccak-256 d&#39;origine ou de la norme NIST finale FIPS-202 SHA-3 en exécutant ce test simple. N&#39;oubliez pas qu&#39;Ethereum utilise Keccak-256, même s&#39;il est souvent appelé SHA-3 dans le code.</p>
</div>
<div class="admonitionblock note data-line-418">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-419">
<p>En raison de la confusion créée par la différence entre la fonction de hachage utilisée dans Ethereum (Keccak-256) et la norme finalisée (FIP-202 SHA-3), des efforts sont en cours pour renommer toutes les instances de sha3 dans tous les codes, opcodes, et des bibliothèques à keccak256. Voir <a href="https://github.com/ethereum/EIPs/issues/59" data-href="https://github.com/ethereum/EIPs/issues/59">ERC59</a> pour plus de détails.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-423">
<p>Examinons ensuite la première application de Keccak-256 dans Ethereum, qui consiste à produire des adresses Ethereum à partir de clés publiques.</p>
</div>
</div>
</div>
<div class="sect2 data-line-426">
<h3 id="eth_address">Adresses Ethereum</h3>
<div class="paragraph data-line-428">
<p>Les adresses Ethereum sont des <em>identifiants uniques</em> dérivés de clés publiques ou de contrats utilisant la fonction de hachage unidirectionnelle Keccak-256.</p>
</div>
<div class="paragraph data-line-430">
<p>Dans nos exemples précédents, nous avons commencé avec une clé privée et avons utilisé la multiplication par courbe elliptique pour dériver une clé publique :</p>
</div>
<div class="paragraph pagebreak-before data-line-433">
<p>Clé privée <em>k</em> :</p>
</div>
<div class="listingblock data-line-435">
<div class="content">
<pre>k = f8f8a2f43c8376ccb0871305060d7b27b0554d2cc72bccf41b2705608452f315</pre>
</div>
</div>
<div id="concat_pubkey" class="paragraph data-line-440">
<p>Clé publique <em>K</em> (coordonnées <em>x</em> et <em>y</em> concaténées et affichées en hexadécimal) :</p>
</div>
<div class="listingblock data-line-442">
<div class="content">
<pre>K = 6e145ccef1033dea239875dd00dfb4fee6e3348b84985c92f103444683bae07b83b5c38e5e...</pre>
</div>
</div>
<div class="admonitionblock note data-line-447">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-448">
<p>Il est à noter que la clé publique n&#39;est pas formatée avec le préfixe (hex) 04 lors du calcul de l&#39;adresse.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-451">
<p>Nous utilisons Keccak-256 pour calculer le <em>hachage</em> de cette clé publique :</p>
</div>
<div id="calculate_hash" class="listingblock data-line-454">
<div class="content">
<pre>Keccak256(K) = 2a5bc342ed616b5ba5732269001d3f1ef827552ae1114027bd3ecf1f086ba0f9</pre>
</div>
</div>
<div class="paragraph data-line-458">
<p>Ensuite, nous ne gardons que les 20 derniers octets (octets les moins significatifs), qui sont notre adresse Ethereum :</p>
</div>
<div id="keep_last_20" class="listingblock data-line-461">
<div class="content">
<pre>001d3f1ef827552ae1114027bd3ecf1f086ba0f9</pre>
</div>
</div>
<div class="paragraph data-line-465">
<p>Le plus souvent, vous verrez des adresses Ethereum avec le préfixe 0x qui indique qu&#39;elles sont codées en hexadécimal, comme ceci :</p>
</div>
<div id="hex_prefix" class="listingblock data-line-468">
<div class="content">
<pre>0x001d3f1ef827552ae1114027bd3ecf1f086ba0f9</pre>
</div>
</div>
<div class="sect3 data-line-473">
<h4 id="eth_address_format">Formats d&#39;adresse Ethereum</h4>
<div class="paragraph data-line-475">
<p>Les adresses Ethereum sont des nombres hexadécimaux, des identifiants dérivés des 20 derniers octets du hachage Keccak-256 de la clé publique.</p>
</div>
<div class="paragraph data-line-477">
<p>(&quot;somme de contrôle&quot;,&quot;dans les formats d&#8217;adresses Ethereum&quot;Contrairement aux adresses Bitcoin, qui sont encodées dans l&#39;interface utilisateur de tous les clients pour inclure une somme de contrôle intégrée pour se protéger contre les adresses mal saisies, les adresses Ethereum sont présentées sous forme hexadécimale brute sans aucune somme de contrôle.</p>
</div>
<div class="paragraph data-line-479">
<p>La justification de cette décision était que les adresses Ethereum seraient éventuellement cachées derrière des abstractions (telles que les services de noms) aux couches supérieures du système et que des sommes de contrôle devraient être ajoutées aux couches supérieures si nécessaire.</p>
</div>
<div class="paragraph data-line-481">
<p>En réalité, ces couches supérieures ont été développées trop lentement et ce choix de conception a entraîné un certain nombre de problèmes dans les premiers jours de l&#39;écosystème, notamment la perte de fonds en raison d&#39;adresses mal saisies et d&#39;erreurs de validation des entrées. De plus, comme les services de noms Ethereum ont été développés plus lentement que prévu initialement, les encodages alternatifs ont été adoptés très lentement par les développeurs de portefeuilles. Nous examinerons ensuite quelques-unes des options d&#39;encodage.</p>
</div>
</div>
<div class="sect3 data-line-484">
<h4 id="ICAP">Inter Exchange Client Address Protocol (ICAP)</h4>
<div class="paragraph data-line-486">
<p>Le client <em>Inter exchange Address Protocol</em> (ICAP) est un codage d&#39;adresse Ethereum partiellement compatible avec le International Bank Account Number (IBAN), offrant un encodage polyvalent, à somme de contrôle et interopérable pour les adresses Ethereum. Les adresses ICAP peuvent encoder des adresses Ethereum ou des noms communs enregistrés auprès d&#39;un registre de noms Ethereum. Vous pouvez en savoir plus sur ICAP sur <a href="http://bit.ly/2JsZHKu" data-href="http://bit.ly/2JsZHKu">Ethereum Wiki</a>.</p>
</div>
<div class="paragraph data-line-488">
<p>L&#39;IBAN est une norme internationale d&#39;identification des numéros de compte bancaire, principalement utilisée pour les virements électroniques. Il est largement adopté dans l&#39;espace européen unique de paiements en euros (SEPA) et au-delà. L&#39;IBAN est un service centralisé et fortement réglementé. ICAP est une implémentation décentralisée mais compatible pour les adresses Ethereum.</p>
</div>
<div class="paragraph data-line-490">
<p>Un IBAN consiste en une chaîne de 34 caractères alphanumériques au maximum (insensible à la casse) comprenant un code pays, une somme de contrôle et un identifiant de compte bancaire (qui est spécifique au pays).</p>
</div>
<div class="paragraph data-line-492">
<p>ICAP utilise la même structure en introduisant un code de pays non standard, &quot;XE&quot;, qui signifie &quot;Ethereum&quot;, suivi d&#39;une somme de contrôle à deux caractères et de trois variantes possibles d&#39;un identifiant de compte :</p>
</div>
<div class="dlist data-line-494">
<dl>
<dt class="hdlist1">Direct</dt>
<dd>
<p>Un entier gros-boutiste base-36 comprenant jusqu&#39;à 30 caractères alphanumériques, représentant les 155 bits les moins significatifs d&#39;une adresse Ethereum. Étant donné que cet encodage correspond à moins que les 160 bits complets d&#39;une adresse Ethereum générale, il ne fonctionne que pour les adresses Ethereum qui commencent par un ou plusieurs octets à zéro. L&#39;avantage est qu&#39;il est compatible avec l&#39;IBAN, en termes de longueur de champ et de somme de contrôle. Exemple : XE60HAMICDXSV5QXVJA7TJW47Q9CHWKJD (33 caractères).</p>
</dd>
<dt class="hdlist1">Basic</dt>
<dd>
<p>Identique à l&#39;encodage Direct, sauf qu&#39;il comporte 31 caractères. Cela lui permet d&#39;encoder n&#39;importe quelle adresse Ethereum, mais la rend incompatible avec la validation du champ IBAN. Exemple : XE18CHDJBPLTBCJ03FE9O2NS0BPOJVQCU2P (35 caractères).</p>
</dd>
<dt class="hdlist1">Indirect</dt>
<dd>
<p>Encode un identifiant qui se résout en une adresse Ethereum via un fournisseur de registre de noms. Il utilise 16 caractères alphanumériques, comprenant un <em>identifiant d&#39;actif</em> (par exemple, ETH), un service de nom (par exemple, XREG) et un nom lisible par l&#39;homme à 9 caractères (par exemple, KITTYCATS). Exemple : XE##ETHXREGKITTYCATS (longueur de 20 caractères), où le ## doit être remplacé par les deux caractères de la somme de contrôle calculée.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-500">
<p>Nous pouvons utiliser l&#39;outil de ligne de commande helpeth pour créer des adresses ICAP. Vous pouvez obtenir de l&#39;aide en l&#39;installant avec :</p>
</div>
<pre data-type="programlisting">
$ <strong>npm install -g helpeth</strong>

</pre>
<div class="paragraph data-line-509">
<p>Si vous n&#39;avez pas npm, vous devrez peut-être d&#39;abord installer nodeJS, ce que vous pouvez faire en suivant les instructions sur <a href="https://nodeJS.org" class="undefined" data-href="https://nodeJS.org">https://nodeJS.org</a>.</p>
</div>
<div class="paragraph data-line-511">
<p>Maintenant que nous avons helpeth, essayons de créer une adresse ICAP avec notre exemple de clé privée (préfixée par 0x et passée en paramètre à helpeth).</p>
</div>
<pre data-type="programlisting">
$ <strong>helpeth keyDetails \
  -p 0xf8f8a2f43c8376ccb0871305060d7b27b0554d2cc72bccf41b2705608452f315</strong>

Address: 0x001d3f1ef827552ae1114027bd3ecf1f086ba0f9
ICAP: XE60 HAMI CDXS V5QX VJA7 TJW4 7Q9C HWKJ D
Public key: 0x6e145ccef1033dea239875dd00dfb4fee6e3348b84985c92f103444683bae07b...

</pre>
<div class="paragraph data-line-525">
<p>La commande helpeth construit une adresse Ethereum hexadécimale ainsi qu&#39;une adresse ICAP pour nous. L&#39;adresse ICAP de notre exemple de clé est :</p>
</div>
<div id="ICAP_example" class="listingblock data-line-528">
<div class="content">
<pre>XE60HAMICDXSV5QXVJA7TJW47Q9CHWKJD</pre>
</div>
</div>
<div class="paragraph data-line-532">
<p>Étant donné que notre exemple d&#39;adresse Ethereum commence par un octet zéro, il peut être encodé à l&#39;aide de la méthode d&#39;encodage Direct ICAP qui est valide au format IBAN. Vous pouvez le dire car il comporte 33 caractères.</p>
</div>
<div class="paragraph data-line-534">
<p>Si notre adresse ne commençait pas par un zéro, elle serait encodée avec l&#39;encodage Basic, qui comporterait 35 caractères et serait invalide en tant qu&#39;IBAN.</p>
</div>
<div class="admonitionblock tip data-line-537">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-538">
<p>Les chances qu&#39;une adresse Ethereum commence par un octet zéro sont de 1 sur 256. Pour en générer une comme celle-là, il faudra en moyenne 256 tentatives avec 256 clés privées aléatoires différentes avant d&#39;en trouver une qui fonctionne comme un type &quot;Direct&quot; compatible IBAN encodé comme adresse ICAP.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-541">
<p>À l&#39;heure actuelle, ICAP n&#39;est malheureusement pris en charge que par quelques portefeuilles.</p>
</div>
</div>
<div class="sect3 data-line-544">
<h4 id="EIP55">Encodage hexadécimal avec somme de contrôle en majuscules (EIP-55)</h4>
<div class="paragraph data-line-546">
<p>En raison de la lenteur du déploiement d&#39;ICAP et des services de noms, une norme a été proposée par la <a href="https://github.com/Ethereum/EIPs/blob/master/EIPS/eip-55.md" data-href="https://github.com/Ethereum/EIPs/blob/master/EIPS/eip-55.md">Proposition d&#39;amélioration d&#39;Ethereum 55 (EIP-55)</a>. EIP-55 offre une somme de contrôle rétrocompatible pour les adresses Ethereum en modifiant la capitalisation de l&#39;adresse hexadécimale. L&#39;idée est que les adresses Ethereum sont insensibles à la casse et que tous les portefeuilles sont censés accepter les adresses Ethereum exprimées en majuscules ou en minuscules, sans aucune différence d&#39;interprétation.</p>
</div>
<div class="paragraph data-line-548">
<p>En modifiant la capitalisation des caractères alphabétiques dans l&#39;adresse, nous pouvons transmettre une somme de contrôle qui peut être utilisée pour protéger l&#39;intégrité de l&#39;adresse contre les erreurs de frappe ou de lecture. Les portefeuilles qui ne prennent pas en charge les sommes de contrôle EIP-55 ignorent simplement le fait que l&#39;adresse contient des majuscules mixtes, mais ceux qui la prennent en charge peuvent la valider et détecter les erreurs avec une précision de 99,986 %.</p>
</div>
<div class="paragraph data-line-550">
<p>L&#39;encodage en majuscules mixtes est subtil et vous ne le remarquerez peut-être pas au début. Notre exemple d&#39;adresse est :</p>
</div>
<div class="listingblock data-line-552">
<div class="content">
<pre>0x001d3f1ef827552ae1114027bd3ecf1f086ba0f9</pre>
</div>
</div>
<div class="paragraph data-line-556">
<p>Avec une somme de contrôle à capitalisation mixte EIP-55, cela devient :</p>
</div>
<div id="mixed_capitalization" class="listingblock data-line-559">
<div class="content">
<pre>0x001d3F1ef827552Ae1114027BD3ECF1f086bA0F9</pre>
</div>
</div>
<div class="paragraph data-line-563">
<p>Pouvez-vous faire la différence? Certains des caractères alphabétiques (A à F) de l&#39;alphabet de codage hexadécimal sont désormais en majuscules, tandis que d&#39;autres sont en minuscules.</p>
</div>
<div class="paragraph data-line-565">
<p>EIP-55 est assez simple à mettre en œuvre. Nous prenons le hachage Keccak-256 de l&#39;adresse hexadécimale minuscule. Ce hachage agit comme une empreinte numérique de l&#39;adresse, nous donnant une somme de contrôle pratique. Tout petit changement dans l&#39;entrée (l&#39;adresse) devrait entraîner un grand changement dans le hachage résultant (la somme de contrôle), nous permettant de détecter efficacement les erreurs. Le hachage de notre adresse est ensuite encodé dans la capitalisation de l&#39;adresse elle-même. Décomposons-le, étape par étape :</p>
</div>
<div class="olist arabic data-line-567">
<ol class="arabic">
<li class="data-line-567">
<p>Hachez l&#39;adresse en minuscules, sans le préfixe 0x :</p>
</li>
</ol>
</div>
<div id="hash_lower_case_address" class="listingblock data-line-570">
<div class="content">
<pre>Keccak256("001d3f1ef827552ae1114027bd3ecf1f086ba0f9") =
23a69c1653e4ebbb619b0b2cb8a9bad49892a8b9695d9a19d8f673ca991deae1</pre>
</div>
</div>
<div class="olist arabic data-line-576">
<ol class="arabic" start="2">
<li class="data-line-576">
<p>Mettez en majuscule chaque caractère d&#39;adresse alphabétique si le chiffre hexadécimal correspondant du hachage est supérieur ou égal à 0x8. C&#39;est plus facile à montrer si nous alignons l&#39;adresse et le hachage :</p>
</li>
</ol>
</div>
<div id="capitalize_input" class="listingblock data-line-579">
<div class="content">
<pre>Adresse : 001d3f1ef827552ae1114027bd3ecf1f086ba0f9
Hachage : 23a69c1653e4ebbb619b0b2cb8a9bad49892a8b9...</pre>
</div>
</div>
<div class="paragraph data-line-584">
<p>Notre adresse contient un caractère alphabétique d en quatrième position. Le quatrième caractère du hachage est 6, qui est inférieur à 8. Donc, nous laissons le d minuscule. Le prochain caractère alphabétique de notre adresse est f, en sixième position. Le sixième caractère du hachage hexadécimal est c, qui est supérieur à 8. Par conséquent, nous capitalisons le F dans l&#39;adresse, et ainsi de suite. Comme vous pouvez le voir, nous n&#39;utilisons que les 20 premiers octets (40 caractères hexadécimaux) du hachage comme somme de contrôle, car nous n&#39;avons que 20 octets (40 caractères hexadécimaux) dans l&#39;adresse à capitaliser de manière appropriée.</p>
</div>
<div class="paragraph data-line-586">
<p>Vérifiez vous-même l&#39;adresse en majuscules mixtes résultante et voyez si vous pouvez dire quels caractères ont été en majuscules et à quels caractères ils correspondent dans le hachage de l&#39;adresse :</p>
</div>
<div id="capitalize_output" class="listingblock data-line-589">
<div class="content">
<pre>Adresse : 001d3F1ef827552Ae1114027BD3ECF1f086bA0F9
Hachage : 23a69c1653e4ebbb619b0b2cb8a9bad49892a8b9...</pre>
</div>
</div>
<div class="sect4 data-line-595">
<h5 id="EIP55_error">Détection d&#39;une erreur dans une adresse encodée EIP-55</h5>
<div class="paragraph data-line-597">
<p>Maintenant, regardons comment les adresses EIP-55 nous aideront à trouver une erreur. Supposons que nous ayons imprimé une adresse Ethereum, qui est codée EIP-55 :</p>
</div>
<div id="correct_address" class="listingblock data-line-600">
<div class="content">
<pre>0x001d3F1ef827552Ae1114027BD3ECF1f086bA0F9</pre>
</div>
</div>
<div class="paragraph data-line-604">
<p>Faisons maintenant une erreur fondamentale en lisant cette adresse. Le caractère avant le dernier est un F majuscule. Pour cet exemple, supposons que nous interprétions cela comme un E majuscule et que nous tapions l&#39;adresse suivante (incorrecte) dans notre portefeuille :</p>
</div>
<div id="incorrect_address" class="listingblock data-line-607">
<div class="content">
<pre>0x001d3F1ef827552Ae1114027BD3ECF1f086bA0E9</pre>
</div>
</div>
<div class="paragraph data-line-611">
<p>Heureusement, notre portefeuille est conforme à la norme EIP-55 ! Il remarque les majuscules mixtes et tente de valider l&#39;adresse. Il le convertit en minuscules et calcule le hachage de la somme de contrôle :</p>
</div>
<div id="hash_demo" class="listingblock data-line-614">
<div class="content">
<pre>Keccak256("001d3f1ef827552ae1114027bd3ecf1f086ba0e9") =
5429b5d9460122fb4b11af9cb88b7bb76d8928862e0a57d46dd18dd8e08a6927</pre>
</div>
</div>
<div class="paragraph data-line-619">
<p>Comme vous pouvez le voir, même si l&#39;adresse n&#39;a changé que d&#39;un caractère (en fait, un seul bit, car e et f sont séparés d&#39;un bit), le hachage de l&#39;adresse a radicalement changé. C&#39;est la propriété des fonctions de hachage qui les rend si utiles pour les sommes de contrôle !</p>
</div>
<div class="paragraph data-line-621">
<p>Maintenant, alignons les deux et vérifions la capitalisation :</p>
</div>
<div id="incorrect_capitalization" class="listingblock data-line-624">
<div class="content">
<pre>001d3F1ef827552Ae1114027BD3ECF1f086bA0E9
5429b5d9460122fb4b11af9cb88b7bb76d892886...</pre>
</div>
</div>
<div class="paragraph data-line-629">
<p>C&#39;est tout faux! Plusieurs des caractères alphabétiques sont mal capitalisés. N&#39;oubliez pas que la capitalisation est l&#39;encodage de la somme de contrôle <em>correcte</em>.</p>
</div>
<div class="paragraph data-line-631">
<p>La casse de l&#39;adresse que nous avons saisie ne correspond pas à la somme de contrôle que nous venons de calculer, ce qui signifie que quelque chose a changé dans l&#39;adresse et qu&#39;une erreur a été <span class="keep-together">introduite</span>.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-635">
<h3 id="keys-addresses-conclusions">Conclusion</h3>
<div class="paragraph data-line-11">
<p>Dans ce chapitre, nous avons fourni un bref aperçu de la cryptographie à clé publique et nous nous sommes concentrés sur l&#39;utilisation des clés publiques et privées dans Ethereum et l&#39;utilisation d&#39;outils cryptographiques, tels que les fonctions de hachage, dans la création et la vérification des adresses Ethereum. Nous avons également examiné les signatures numériques et comment elles peuvent démontrer la propriété d&#39;une clé privée sans révéler cette clé privée. Dans <a href="#wallets_chapter">Portefeuilles</a>, nous allons rassembler ces idées et voir comment les portefeuilles peuvent être utilisés pour gérer les collections de clés.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="wallets_chapter">Portefeuilles</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Le mot &quot;portefeuille&quot; est utilisé pour décrire quelques choses différentes dans Ethereum.</p>
</div>
<div class="paragraph data-line-6">
<p>À un niveau élevé, un portefeuille est une application logicielle qui sert d&#39;interface utilisateur principale à Ethereum. Le portefeuille contrôle l&#39;accès à l&#39;argent d&#39;un utilisateur, gère les clés et les adresses, suit le solde et crée et signe des transactions. De plus, certains portefeuilles Ethereum peuvent également interagir avec des contrats, tels que les jetons ERC20.</p>
</div>
<div class="paragraph data-line-8">
<p>Plus étroitement, du point de vue d&#39;un programmeur, le mot <em>wallet</em> ou <em>portefeuille</em> fait référence au système utilisé pour stocker et gérer les clés d&#39;un utilisateur. Chaque portefeuille a un composant de gestion des clés. Pour certains portefeuilles, c&#39;est tout ce qu&#39;il y a. D&#39;autres portefeuilles font partie d&#39;une catégorie beaucoup plus large, celle des <em>navigateurs</em>, qui sont des interfaces vers des applications décentralisées basées sur Ethereum, ou <em>DApps</em>, que nous examinerons plus en détail dans <a href="#decentralized_applications_chap">Applications décentralisées (DApps)</a>. Il n&#39;y a pas de lignes de distinction claires entre les différentes catégories qui sont regroupées sous le terme portefeuille.</p>
</div>
<div class="paragraph data-line-10">
<p>Dans ce chapitre, nous examinerons les portefeuilles en tant que conteneurs de clés privées et en tant que systèmes de gestion de ces clés.</p>
</div>
<div class="sect2 data-line-13">
<h3 id="wallet_tech_overview">Présentation de la technologie de portefeuille</h3>
<div class="paragraph data-line-15">
<p> Dans cette section, nous résumons les différentes technologies utilisées pour construire des portefeuilles Ethereum conviviaux, sécurisés et flexibles.</p>
</div>
<div class="paragraph data-line-17">
<p>L&#39;une des principales considérations dans la conception des portefeuilles est l&#39;équilibre entre commodité et confidentialité. Le portefeuille Ethereum le plus pratique est celui avec une clé privée unique et une adresse que vous réutilisez pour tout. Malheureusement, une telle solution est un cauchemar pour la confidentialité, car n&#39;importe qui peut facilement suivre et corréler toutes vos transactions. L&#39;utilisation d&#39;une nouvelle clé pour chaque transaction est préférable pour la confidentialité, mais devient très difficile à gérer. Le bon équilibre est difficile à atteindre, mais c&#39;est pourquoi une bonne conception de portefeuille est primordiale.</p>
</div>
<div class="paragraph data-line-19">
<p>Une idée fausse courante à propos d&#39;Ethereum est que les portefeuilles Ethereum contiennent de l&#39;ether ou des jetons. En fait, très strictement parlant, le portefeuille ne contient que des clés. L&#39;ether ou d&#39;autres jetons sont enregistrés sur la blockchain Ethereum. Les utilisateurs contrôlent les jetons sur le réseau en signant des transactions avec les clés dans leurs portefeuilles. Dans un sens, un portefeuille Ethereum est un <em>porte-clés</em>. Cela dit, étant donné que les clés détenues par le portefeuille sont les seules choses nécessaires pour transférer de l&#39;ether ou des jetons à d&#39;autres, en pratique, cette distinction est assez peu pertinente. Là où la différence est importante, c&#39;est dans le fait de changer d&#39;état d&#39;esprit et de ne plus avoir affaire au système bancaire conventionnel centralisé (où seuls vous et la banque pouvez voir l&#39;argent sur votre compte, et vous n&#39;avez qu&#39;à convaincre la banque que vous voulez transférer des fonds pour faire une transaction) vers un système décentralisé des plates-formes chaîne de blocs (où tout le monde peut voir le solde d&#39;un compte, bien qu&#39;il ne connaisse probablement pas le propriétaire du compte, et tout le monde doit être convaincu que le propriétaire veut déplacer des fonds pour une transaction édictée). En pratique, cela signifie qu&#39;il existe un moyen indépendant de vérifier le solde d&#39;un compte, sans avoir besoin de son portefeuille. De plus, vous pouvez déplacer la gestion de votre compte de votre portefeuille actuel vers un autre portefeuille, si vous n&#39;aimez plus l&#39;application de portefeuille que vous avez commencé à utiliser.</p>
</div>
<div class="admonitionblock note data-line-22">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-23">
<p>Les portefeuilles Ethereum contiennent des clés, pas d&#39;ether ni de jetons. Les portefeuilles sont comme des porte-clés contenant des paires de clés privées et publiques. Les utilisateurs signent des transactions avec les clés privées, prouvant ainsi qu&#39;ils possèdent l&#39;ether. L&#39;ether est stocké sur la chaîne de blocs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-26">
<p>Il existe deux principaux types de portefeuilles, qui se distinguent par le fait que les clés qu&#39;ils contiennent sont liées ou non.</p>
</div>
<div class="paragraph data-line-28">
<p>Le premier type est un <em>portefeuille non déterministe</em>, où chaque clé est générée indépendamment à partir d&#39;un nombre aléatoire différent . Les clés ne sont pas liées les unes aux autres.  Ce type de portefeuille est également connu sous le nom de portefeuille JBOK, de l&#39;expression "Just a Bunch Of Keys" ou &quot;Juste un tas de clés&quot;.</p>
</div>
<div class="paragraph data-line-30">
<p>Le deuxième type de portefeuille est un <em>portefeuille déterministe</em>, où toutes les clés sont dérivées d&#39;une seule clé maîtresse, connue sous le nom de <em>seed</em> ou <em>graine</em> ou <em>valeur d&#8217;amorçage</em>. Toutes les clés de ce type de portefeuille sont liées les unes aux autres et peuvent être générées à nouveau si l&#39;on dispose de la valeur d&#8217;amorçage d&#39;origine.  Il existe un certain nombre de méthodes différentes de <em>dérivation de clé</em> utilisées dans les portefeuilles déterministes. La méthode de dérivation la plus couramment utilisée utilise une structure arborescente, comme décrit dans <a href="#hd_wallets">Portefeuilles déterministes hiérarchiques (BIP-32/BIP-44)</a>.</p>
</div>
<div class="paragraph data-line-32">
<p>Pour rendre les portefeuilles déterministes légèrement plus sûrs contre les accidents de perte de données, comme le vol de votre téléphone ou sa chute dans les toilettes, les valeurs d&#8217;amorçages sont souvent encodées sous la forme d&#39;une liste de mots (en anglais ou dans une autre langue) à noter et à utiliser en cas d&#39;accident. Ceux-ci sont connus sous le nom de <em>mots de code mnémoniques</em> du portefeuille. Bien sûr, si quelqu&#39;un met la main sur vos mots de code mnémoniques, il peut également recréer votre portefeuille et ainsi accéder à vos contrats intelligents et votre ether. En tant que tel, soyez très, très prudent avec votre liste de mots de récupération ! Ne les stockez jamais électroniquement, dans un fichier, sur votre ordinateur ou votre téléphone. Écrivez-le sur papier et rangez-le dans un endroit sûr et sécurisé.</p>
</div>
<div class="paragraph data-line-34">
<p>Les prochaines sections présentent chacune de ces technologies à un niveau élevé.</p>
</div>
<div class="sect3 data-line-38">
<h4 id="random_wallet">Portefeuilles non déterministes (aléatoires)</h4>
<div class="paragraph data-line-40">
<p>Dans le premier portefeuille Ethereum (produit pour la prévente Ethereum), chaque fichier de portefeuille stockait une seule clé privée générée aléatoirement. Ces portefeuilles sont remplacés par des portefeuilles déterministes car ces portefeuilles &quot;à l&#39;ancienne&quot; sont à bien des égards inférieurs. Par exemple, il est considéré comme une bonne pratique d&#39;éviter la réutilisation de l&#39;adresse Ethereum dans le cadre de la maximisation de votre vie privée lors de l&#39;utilisation d&#39;Ethereum, c&#39;est-à-dire d&#39;utiliser une nouvelle adresse (qui nécessite une nouvelle clé privée) chaque fois que vous recevez des fonds. Vous pouvez aller plus loin et utiliser une nouvelle adresse pour chaque transaction, bien que cela puisse coûter cher si vous traitez beaucoup de jetons. Pour suivre cette pratique, un portefeuille non déterministe devra régulièrement augmenter sa liste de clés, ce qui signifie que vous devrez effectuer des sauvegardes régulières. Si jamais vous perdez vos données (panne de disque, accident d&#8217;abus de boisson, vol de téléphone) avant d&#39;avoir réussi à sauvegarder votre portefeuille, vous perdrez l&#39;accès à vos fonds et à vos contrats intelligents. Les portefeuilles non déterministes de &quot;type 0&quot; sont les plus difficiles à gérer, car ils créent un nouveau fichier de portefeuille pour chaque nouvelle adresse de manière &quot;juste à temps&quot;.</p>
</div>
<div class="paragraph data-line-42">
<p>Néanmoins, de nombreux clients Ethereum (y compris geth) utilisent un fichier <em>keystore</em> ou <em>magasin de clés</em>, qui est un fichier codé JSON contenant une clé privée unique (générée de manière aléatoire), chiffrée par une phrase secrète pour plus de sécurité . Le contenu du fichier JSON ressemble à ceci :</p>
</div>
<div id="keystore_example" class="listingblock data-line-46">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "address": "001d3f1ef827552ae1114027bd3ecf1f086ba0f9",
    "crypto": {
        "cipher": "aes-128-ctr",
        "ciphertext":
            "233a9f4d236ed0c13394b504b6da5df02587c8bf1ad8946f6f2b58f055507ece",
        "cipherparams": {
            "iv": "d10c6ec5bae81b6cb9144de81037fa15"
        },
        "kdf": "scrypt",
        "kdfparams": {
            "dklen": 32,
            "n": 262144,
            "p": 1,
            "r": 8,
            "salt":
                "99d37a47c7c9429c66976f643f386a61b78b97f3246adca89abe4245d2788407"
        },
        "mac": "594c8df1c8ee0ded8255a50caf07e8c12061fd859f4b7c76ab704b17c957e842"
    },
    "id": "4fcb2ba4-ccdb-424f-89d5-26cce304bf9c",
    "version": 3
}</code></pre>
</div>
</div>
<div class="paragraph data-line-72">
<p>Le format de magasin de clés utilise une <em>fonction de dérivation de clé</em> (KDF ou key derivation function), également connue sous le nom d&#39;algorithme d&#39;étirement de mot de passe, qui protège contre les attaques par force, par dictionnaire et par table arc-en-ciel. En termes simples, la clé privée n&#39;est pas chiffrée directement par la phrase secrète. Au lieu de cela, la phrase secrète est <em>étirée</em>, en la hachant à plusieurs reprises. La fonction de hachage est répétée pendant 262 144 tours, ce qui peut être vu dans le magasin de clés JSON sous la forme du paramètre crypto.kdfparams.n. Un attaquant essayant de forcer brutalement la phrase secrète devrait appliquer 262 144 cycles de hachage pour chaque phrase secrète tentée, ce qui ralentit suffisamment l&#39;attaque pour la rendre impossible pour les phrases secrètes d&#39;une complexité et d&#39;une longueur suffisantes.</p>
</div>
<div class="paragraph data-line-74">
<p>Il existe un certain nombre de bibliothèques logicielles qui peuvent lire et écrire le format keystore, comme la bibliothèque JavaScript <a href="https://github.com/ethereumjs/keythereum" data-href="https://github.com/ethereumjs/keythereum">keythereum</a>.</p>
</div>
<div class="admonitionblock tip data-line-77">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-78">
<p>L&#39;utilisation de portefeuilles non déterministes est déconseillée pour autre chose que de simples tests. Ils sont trop encombrants pour être sauvegardés et utilisés pour autre chose que les situations les plus élémentaires. Utilisez plutôt un portefeuille HD standard avec une valeur d&#8217;amorçage mnémonique pour la sauvegarde.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-82">
<h4 id="deterministic_wallets">Portefeuilles déterministes (par valeur d&#8217;amorçage)</h4>
<div class="paragraph data-line-84">
<p>Les portefeuilles déterministes ou &quot;ensemencés par valeurs d&#8217;amorçages&quot; sont des portefeuilles qui contiennent des clés privées qui sont toutes dérivées d&#39;une seule clé maîtresse ou valeur d&#8217;amorçage. La valeur d&#8217;amorçage est un nombre généré aléatoirement qui est combiné avec d&#39;autres données, telles qu&#39;un numéro d&#39;index ou un &quot;code de chaîne&quot; (voir <a href="#extended_keys">Clés publiques et privées étendues</a>), pour dériver n&#39;importe quel nombre de clés privées. Dans un portefeuille déterministe, la valeur d&#8217;amorçage est suffisante pour récupérer toutes les clés dérivées, et donc une seule sauvegarde, au moment de la création, est suffisante pour sécuriser tous les fonds et contrats intelligents dans le portefeuille. La valeur d&#8217;amorçage est également suffisante pour une exportation ou une importation de portefeuille, permettant une migration facile de toutes les clés entre différentes implémentations de portefeuille.</p>
</div>
<div class="paragraph data-line-86">
<p>Cette conception rend la sécurité de la valeur d&#8217;amorçage d&#8217;une plus haute importance, car seule la valeur d&#8217;amorçage est nécessaire pour accéder à l&#39;ensemble du portefeuille. D&#39;un autre côté, le fait de pouvoir concentrer les efforts de sécurité sur une seule donnée peut être considéré comme un avantage.</p>
</div>
</div>
<div class="sect3 data-line-89">
<h4 id="hd_wallets">Portefeuilles déterministes hiérarchiques (BIP-32/BIP-44)</h4>
<div class="paragraph data-line-91">
<p>Les portefeuilles déterministes ont été développés pour faciliter la dérivation de nombreuses clés à partir d&#39;une seule valeur d&#8217;amorçage. Actuellement, la forme la plus avancée de portefeuille déterministe est le portefeuille <em>hiérarchique déterministe</em> (HD ou Hierarchical Deterministic) défini par le <a href="http://bit.ly/2B2vQWs" data-href="http://bit.ly/2B2vQWs"><em>standard BIP-32</em></a> de Bitcoin. Les portefeuilles HD contiennent des clés dérivées dans une structure arborescente, de sorte qu&#39;une clé parent peut dériver une séquence de clés enfants, chacune pouvant dériver une séquence de clés petits-enfants, et ainsi de suite. Cette arborescence est illustrée dans <a href="#hd_wallets_figure">Portefeuille HD : un arbre de clés généré à partir d&#39;une seule valeur d&#8217;amorçage</a>.</p>
</div>
<div id="hd_wallets_figure" class="imageblock data-line-95">
<div class="content">
<img src="images/hd_wallet.png" alt="&quot;Portefeuille HD&quot;">
</div>
<div class="title">Figure 27. Portefeuille HD : un arbre de clés généré à partir d&#39;une seule valeur d&#8217;amorçage</div>
</div>
<div class="paragraph data-line-97">
<p>Les portefeuilles HD offrent quelques avantages clés par rapport aux portefeuilles déterministes plus simples. Tout d&#39;abord, la structure arborescente peut être utilisée pour exprimer une signification organisationnelle supplémentaire, par exemple lorsqu&#39;une branche spécifique de sous-clés est utilisée pour recevoir des paiements entrants et qu&#39;une branche différente est utilisée pour recevoir la monnaie des paiements sortants. Les branches de clés peuvent également être utilisées dans les paramètres de l&#39;entreprise, en attribuant différentes branches à des départements, des filiales, des fonctions spécifiques ou des catégories comptables.</p>
</div>
<div class="paragraph data-line-99">
<p>Le deuxième avantage des portefeuilles HD est que les utilisateurs peuvent créer une séquence de clés publiques sans avoir accès aux clés privées correspondantes. Cela permet aux portefeuilles HD d&#39;être utilisés sur un serveur non sécurisé ou dans une capacité de surveillance ou de réception uniquement, où le portefeuille n&#39;a pas les clés privées qui peuvent dépenser les fonds.</p>
</div>
</div>
<div class="sect3 data-line-102">
<h4 id="mnemonic_codes">Valeurs d&#8217;amorçage et codes mnémoniques (BIP-39)</h4>
<div class="paragraph data-line-104">
<p>Il y a beaucoup de manières d&#39;encoder une clé privée pour une sauvegarde et une récupération sécurisées. La méthode actuellement préférée consiste à utiliser une séquence de mots qui, lorsqu&#39;ils sont pris ensemble dans le bon ordre, peuvent recréer de manière unique la clé privée. Ceci est parfois connu sous le nom de <em>mnémonique</em>, et l&#39;approche a été normalisée par <a href="http://bit.ly/2OEMjUz" data-href="http://bit.ly/2OEMjUz">BIP-39</a>. Aujourd&#39;hui, de nombreux portefeuilles Ethereum (ainsi que des portefeuilles pour d&#39;autres crypto-monnaies) utilisent cette norme et peuvent importer et exporter des valeurs d&#8217;amorçage pour la sauvegarde et la récupération à l&#39;aide de mnémoniques interopérables.</p>
</div>
<div class="paragraph data-line-106">
<p>Pour comprendre pourquoi cette approche est devenue populaire, examinons un exemple :</p>
</div>
<div id="hex_seed_example" class="listingblock data-line-110">
<div class="title">Une valeur d&#8217;amorçage pour un portefeuille déterministe, en hexadécimal</div>
<div class="content">
<pre>FCCF1AB3329FD5DA3DA9577511F8F137</pre>
</div>
</div>
<div id="mnemonic_seed_example" class="listingblock data-line-116">
<div class="title">Une valeur d&#8217;amorçage pour un portefeuille déterministe, à partir d&#39;un mnémonique de 12 mots</div>
<div class="content">
<pre>wolf juice proud gown wool unfair
wall cliff insect more detail hub</pre>
</div>
</div>
<div class="paragraph data-line-121">
<p>En termes pratiques, le risque d&#39;erreur lors de l&#39;écriture de la séquence hexadécimale est inacceptablement élevé. En revanche, la liste des mots connus est assez facile à gérer, principalement parce qu&#39;il y a une forte redondance dans l&#39;écriture des mots (surtout des mots anglais). Si « inzect » avait été enregistré par accident, il pourrait être rapidement déterminé, lors de la récupération du portefeuille, que « inzect » n&#39;est pas un mot anglais valide et que « insect » devrait être utilisé à la place. Nous parlons d&#39;écrire une représentation de la valeur d&#8217;amorçage car c&#39;est une bonne pratique lors de la gestion des portefeuilles HD : la valeur d&#8217;amorçage est nécessaire pour récupérer un portefeuille en cas de perte de données (que ce soit par accident ou par vol), il est donc très prudent de conserver une sauvegarde. Cependant, la valeur d&#8217;amorçage doit rester extrêmement privée, les sauvegardes numériques doivent donc être soigneusement évitées ; d&#39;où le conseil précédent de sauvegarder avec un stylo et du papier.</p>
</div>
<div class="paragraph data-line-123">
<p>En résumé, l&#39;utilisation d&#39;une liste de mots de récupération pour coder la valeur d&#8217;amorçage d&#39;un portefeuille HD constitue le moyen le plus simple d&#39;exporter, de transcrire, d&#39;enregistrer sur papier en toute sécurité, de lire sans erreur et d&#39;importer un ensemble de clés privées dans un autre portefeuille.</p>
</div>
</div>
</div>
<div class="sect2 data-line-127">
<h3 id="wallet_best_practices">Meilleures pratiques de portefeuille</h3>
<div class="paragraph data-line-129">
<p>Alors que la technologie des portefeuilles de cryptomonnaie a mûri, certaines normes industrielles communes ont émergé qui rendent les portefeuilles largement interopérables, faciles à utiliser, sécurisé et flexible. Ces normes permettent également aux portefeuilles de dériver des clés pour plusieurs cryptomonnaies différentes, toutes à partir d&#39;un seul mnémonique. Ces normes communes sont :</p>
</div>
<div class="ulist data-line-131">
<ul>
<li class="data-line-131">
<p>Mots de code mnémonique, basés sur BIP-39</p>
</li>
<li class="data-line-132">
<p>Portefeuilles HD, basés sur BIP-32</p>
</li>
<li class="data-line-133">
<p>Structure de portefeuille HD polyvalente, basée sur BIP-43</p>
</li>
<li class="data-line-134">
<p>Portefeuilles multidevises et multicomptes, basés sur BIP-44</p>
</li>
</ul>
</div>
<div class="paragraph data-line-136">
<p>Ces normes peuvent changer ou être obsolètes par les développements futurs, mais pour l&#39;instant, elles forment un ensemble de technologies imbriquées qui sont devenues la norme <em>de facto</em> de portefeuille pour la plupart des plateformes de chaîne de blocs et leurs cryptomonnaies.</p>
</div>
<div class="paragraph data-line-138">
<p>Les normes ont été adoptées par une large gamme de portefeuilles logiciels et matériels, rendant tous ces portefeuilles interopérables. Un utilisateur peut exporter un mnémonique généré dans l&#39;un de ces portefeuilles et l&#39;importer dans un autre portefeuille, en récupérant toutes les clés et adresses.</p>
</div>
<div class="paragraph data-line-140">
<p>Quelques exemples de portefeuilles logiciels prenant en charge ces normes incluent (classés par ordre alphabétique) Jaxx, MetaMask, MyCrypto et MyEtherWallet (MEW). Les exemples de portefeuilles matériels prenant en charge ces normes incluent Keepkey, Ledger et Trezor.</p>
</div>
<div class="paragraph data-line-142">
<p>Les sections suivantes examinent chacune de ces technologies en détail.</p>
</div>
<div class="admonitionblock tip data-line-145">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-146">
<p>Si vous implémentez un portefeuille Ethereum, il doit être construit comme un portefeuille HD, avec une valeur d&#8217;amorçage encodée sous forme de code mnémonique pour la sauvegarde, conformément aux normes BIP-32, BIP-39, BIP-43 et BIP-44, comme décrit dans les rubriques suivantes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-151">
<h4 id="mnemonic_code_words">Mots de code mnémonique (BIP-39)</h4>
<div class="paragraph data-line-153">
<p> Les mots de code mnémoniques sont des séquences de mots qui encodent un nombre aléatoire utilisé comme valeur d&#8217;amorçage pour dériver un portefeuille déterministe. La séquence de mots est suffisante pour recréer la valeur d&#8217;amorçage, et à partir de là recréer le portefeuille et toutes les clés dérivées. Une application de portefeuille qui implémente des portefeuilles déterministes avec des mots mnémoniques montrera à l&#39;utilisateur une séquence de 12 à 24 mots lors de la première création d&#39;un portefeuille. Cette séquence de mots est la sauvegarde du portefeuille et peut être utilisée pour récupérer et recréer toutes les clés dans la même application de portefeuille ou dans n&#39;importe quelle application de portefeuille compatible. Comme nous l&#39;avons expliqué précédemment, les listes de mots mnémoniques facilitent la sauvegarde des portefeuilles par les utilisateurs, car elles sont faciles à lire et correctement <span class="keep-together">transcrire</span>.</p>
</div>
<div class="admonitionblock note data-line-156">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-157">
<p> Les mots mnémoniques sont souvent confondus avec les &quot;brainwallets&quot;. Ils ne sont pas les mêmes. La principale différence est qu&#39;un brainwallet se compose de mots choisis par l&#39;utilisateur, tandis que les mots mnémoniques sont créés de manière aléatoire par le portefeuille et présentés à l&#39;utilisateur. Cette différence importante rend les mots mnémoniques beaucoup plus sûrs, car les humains sont de très mauvaises sources d&#39;aléatoire. Peut-être plus important encore, l&#39;utilisation du terme &quot;brainwallet&quot; suggère que les mots doivent être mémorisés, ce qui est une idée terrible et une recette pour ne pas avoir votre sauvegarde lorsque vous en avez besoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-160">
<p>Les codes mnémoniques sont définis dans le BIP-39. Notez que BIP-39 est une implémentation d&#39;une norme de code mnémonique. Il existe une norme différente, <em>avec un ensemble de mots différent</em>, utilisée par le portefeuille Electrum Bitcoin et antérieure à BIP-39. BIP-39 a été proposé par la société à l&#39;origine du portefeuille matériel Trezor et est incompatible avec la mise en œuvre d&#39;Electrum. Cependant, BIP-39 a maintenant obtenu un large soutien de l&#39;industrie à travers des dizaines d&#39;implémentations interopérables et devrait être considéré comme la norme <em>de facto</em> industrielle. De plus, BIP-39 peut être utilisé pour produire des portefeuilles multidevises prenant en charge Ethereum, contrairement aux valeurs d&#8217;amorçage Electrum.</p>
</div>
<div class="paragraph data-line-162">
<p>La BIP-39 définit la création d&#39;un code mnémonique et d&#39;une valeur d&#8217;amorçage, que nous décrivons ici en neuf étapes. Pour plus de clarté, le processus est divisé en deux parties : les étapes 1 à 6 sont présentées dans <a href="#generating_mnemonic_words">Génération de mots mnémoniques</a> et les étapes 7 à 9 sont illustrées dans <a href="#mnemonic_to_seed">Du mnémonique à la valeur d&#8217;amorçage</a>.</p>
</div>
<div class="sect4 data-line-165">
<h5 id="generating_mnemonic_words">Génération de mots mnémoniques</h5>
<div class="paragraph data-line-167">
<p>Les mots mnémoniques sont générés automatiquement par le portefeuille en utilisant le processus standardisé défini dans BIP-39. Le portefeuille part d&#39;une source d&#39;entropie, ajoute une somme de contrôle, puis mappe l&#39;entropie sur une liste de mots :</p>
</div>
<div class="olist arabic data-line-169">
<ol class="arabic">
<li class="data-line-169">
<p>Créer une séquence cryptographiquement aléatoire S de 128 à 256 bits.</p>
</li>
<li class="data-line-170">
<p>Créez une somme de contrôle de S en prenant la première longueur de S ÷ 32 bits du hachage SHA-256 de S.</p>
</li>
<li class="data-line-171">
<p>Ajoutez la somme de contrôle à la fin de la séquence aléatoire S.</p>
</li>
<li class="data-line-172">
<p>Divisez la concaténation de séquence et de somme de contrôle en sections de 11 bits.</p>
</li>
<li class="data-line-173">
<p>Associez chaque valeur 11 bits à un mot du dictionnaire prédéfini de 2 048 mots.</p>
</li>
<li class="data-line-174">
<p>Créez le code mnémonique à partir de la séquence de mots en respectant l&#39;ordre.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-176">
<p><a href="#generating_entropy_and_encoding">Génération d&#39;entropie et encodage sous forme de mots mnémoniques</a> montre comment l&#39;entropie est utilisée pour générer des mots mnémoniques.</p>
</div>
<div class="paragraph data-line-178">
<p><a href="#table_bip39_entropy">Codes mnémoniques : entropie et longueur des mots</a> montre la relation entre la taille des données d&#39;entropie et la longueur des codes mnémoniques en mots.</p>
</div>
<table id="table_bip39_entropy" class="tableblock frame-all grid-all stretch data-line-183">
<caption class="title">Table 3. Codes mnémoniques : entropie et longueur des mots</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entropie (bits)</th>
<th class="tableblock halign-left valign-top">Somme de contrôle (bits)</th>
<th class="tableblock halign-left valign-top">Somme de contrôle d&#39;entropie <strong>+</strong> (bits)</th>
<th class="tableblock halign-left valign-top">Longueur mnémonique (mots)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">165</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">198</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">231</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">264</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
</tbody>
</table>
<div id="generating_entropy_and_encoding" class="imageblock smallerseventy data-line-195">
<div class="content">
<img src="images/bip39-part1.png" alt="&quot;Génération d&#39;entropie et encodage sous forme de mots mnémoniques&quot;">
</div>
<div class="title">Figure 28. Génération d&#39;entropie et encodage sous forme de mots mnémoniques</div>
</div>
</div>
<div class="sect4 data-line-198">
<h5 id="mnemonic_to_seed">Du mnémonique à la valeur d&#8217;amorçage</h5>
<div class="paragraph data-line-200">
<p>Les mots mnémoniques représentent l&#39;entropie d&#39;une longueur de 128 à 256 bits . L&#39;entropie est ensuite utilisée pour dériver une valeur d&#8217;amorçage plus longue (512 bits) grâce à l&#39;utilisation de la fonction d&#39;étirement de clé PBKDF2. La valeur d&#8217;amorçage produite est utilisée pour construire un portefeuille déterministe et en dériver ses clés.</p>
</div>
<div class="paragraph data-line-202">
<p>La fonction d&#8217;étirement de clé prend deux paramètres : le mnémonique et un <em>sel</em>. Le but d&#39;un sel dans une fonction d&#39;étirement de clé est de rendre difficile la construction d&#39;une table de recherche permettant une attaque par force brute. Dans la norme BIP-39, le sel a un autre objectif : il permet l&#39;introduction d&#39;une phrase secrète qui sert de facteur de sécurité supplémentaire protégeant la valeur d&#8217;amorçage, comme nous le décrirons plus en détail dans <a href="#mnemonic_passphrase">Phrase secrète facultative dans BIP-39</a>.</p>
</div>
<div class="paragraph data-line-204">
<p>Le processus décrit aux étapes 7 à 9 continue à partir du processus décrit dans la section précédente :</p>
</div>
<div class="olist arabic data-line-207">
<ol class="arabic" start="7">
<li class="data-line-207">
<p>Le premier paramètre de la fonction d&#39;étirement de clé PBKDF2 est le <em>mnémonique</em> produit à l&#39;étape 6.</p>
</li>
<li class="data-line-208">
<p>Le deuxième paramètre de la fonction d&#39;étirement de clé PBKDF2 est un <em>sel</em>. Le sel est composé de la constante de chaîne &amp;quot;mnémonique&amp;quot; concaténée avec une phrase secrète facultative fournie par l&#39;utilisateur.</p>
</li>
<li class="data-line-209">
<p>PBKDF2 étend les paramètres mnémoniques et de sel en utilisant 2 048 cycles de hachage avec l&#39;algorithme HMAC-SHA512, produisant une valeur de 512 bits comme sortie finale. Cette valeur de 512 bits est la valeur d&#8217;amorçage.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-211">
<p><a href="#mnemonic_to_seed_figure">Du mnémonique à la valeur d&#8217;amorçage</a> montre comment un mnémonique est utilisé pour générer une valeur d&#8217;amorçage.</p>
</div>
<div id="mnemonic_to_seed_figure" class="imageblock data-line-215">
<div class="content">
<img src="images/bip39-part2.png" alt="&quot;Du mnémonique à la valeur d&#8217;amorçage&quot;">
</div>
<div class="title">Figure 29. Du mnémonique à la valeur d&#8217;amorçage</div>
</div>
<div class="admonitionblock note data-line-218">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-219">
<p>La fonction d&#39;étirement de clé, avec ses 2 048 cycles de hachage, est une protection assez efficace contre les attaques par force brute contre le mnémonique ou la phrase secrète. Cela rend coûteux (en calcul) d&#39;essayer plus de quelques milliers de combinaisons de mots de passe et de mnémoniques, alors que le nombre de valeurs d&#8217;amorçage dérivées possibles est vaste (2<sup>512</sup>, soit environ 10<sup>154</sup>) - bien plus grand que le nombre d&#39;atomes dans l&#39;univers visible (environ 10<sup>80</sup>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-222">
<p>Les tables <a data-type="xref" data-xrefstyle="select:labelnumber" href="#mnemonic_128_no_pass">#mnemonic_128_no_pass</a>, <a data-type="xref" data-xrefstyle="select:labelnumber" href="#mnemonic_128_w_pass">#mnemonic_128_w_pass</a> et <a data-type="xref" data-xrefstyle="select:labelnumber" href="#mnemonic_256_no_pass">#mnemonic_256_no_pass</a> montrent quelques exemples de codes mnémoniques et les valeurs d&#8217;amorçage qu&#39;ils produisent.</p>
</div>
<table id="mnemonic_128_no_pass" class="tableblock frame-all grid-all stretch data-line-227">
<caption class="title">Table 4. Code mnémonique d&#39;entropie 128 bits, sans phrase secrète, valeur d&#8217;amorçage résultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entrée d&#39;entropie (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnémonique (12 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secrète</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(rien)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amorçage (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">5b56c417303faa3fcba7e57400e120a0ca83ec5a4fc9ffba757fbe63fbd77a89a1a3be4c67196f57c39
a88b76373733891bfaba16ed27a813ceed498804c0570</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_128_w_pass" class="tableblock frame-all grid-all stretch data-line-238">
<caption class="title">Table 5. Code mnémonique d&#39;entropie 128 bits, avec phrase secrète, valeur d&#8217;amorçage résultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entrée d&#39;entropie (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnémonique (12 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secrète</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SuperDuperSecret</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amorçage (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3b5df16df2157104cfdd22830162a5e170c0161653e3afe6c88defeefb0818c793dbb28ab3ab091897d0
715861dc8a18358f80b79d49acf64142ae57037d1d54</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_256_no_pass" class="tableblock frame-all grid-all stretch pagebreak-before data-line-250">
<caption class="title">Table 6. Code mnémonique d&#39;entropie 256 bits, sans phrase secrète, valeur d&#8217;amorçage résultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entrée d&#39;entropie (256 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2041546864449caff939d32d574753fe684d3c947c3346713dd8423e74abcf8c</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnémonique (24 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cake apple borrow silk endorse fitness top denial coil riot stay wolf
luggage oxygen faint major edit measure invite love trap field dilemma oblige</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secrète</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(rien)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amorçage (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3269bce2674acbd188d4f120072b13b088a0ecf87c6e4cae41657a0bb78f5315b33b3a04356e53d062e5
5f1e0deaa082df8d487381379df848a6ad7e98798404</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-260">
<h5 id="mnemonic_passphrase">Phrase secrète facultative dans BIP-39</h5>
<div class="paragraph data-line-262">
<p>La norme BIP-39 permet l&#39;utilisation d&#39;une phrase secrète facultative dans la dérivation de la valeur d&#8217;amorçage. Si aucune phrase secrète n&#39;est utilisée, le mnémonique est étiré avec un sel constitué de la chaîne constante &amp;quot;mnémonique&amp;quot;, produisant une valeur d&#8217;amorçage spécifique de 512 bits à partir de n&#39;importe quel mnémonique donné. Si une phrase secrète est utilisée, la fonction d&#39;étirement produit une valeur d&#8217;amorçage <em>différente</em> à partir de ce même mnémonique. En fait, étant donné un seul mnémonique, chaque phrase secrète possible conduit à une valeur d&#8217;amorçage différente. Essentiellement, il n&#39;y a pas de &quot;mauvaise&quot; phrase secrète. Toutes les phrases secrètes sont valides et mènent toutes à des valeur d&#8217;amorçage différentes, formant un vaste ensemble de portefeuilles non initialisés possibles. L&#39;ensemble des portefeuilles possibles est si grand (2<sup>512</sup>) qu&#39;il n&#39;y a aucune possibilité pratique de forcer brutalement ou de deviner accidentellement celui qui est utilisé, tant que la phrase secrète a une complexité et une longueur suffisantes.</p>
</div>
<div class="admonitionblock tip data-line-265">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-266">
<p>Il n&#39;y a pas de &quot;mauvaises&quot; phrases secrète dans BIP-39. Chaque phrase secrète mène à un portefeuille qui, à moins qu&#39;il n&#39;ait été utilisé auparavant, sera vide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-269">
<p>La phrase secrète facultative crée deux fonctionnalités importantes :</p>
</div>
<div class="ulist data-line-271">
<ul>
<li class="data-line-271">
<p>Un deuxième facteur (quelque chose de mémorisé) qui rend un mnémonique inutile par lui-même, protégeant les sauvegardes mnémoniques de la compromission par un voleur.</p>
</li>
<li class="data-line-273">
<p>Une forme de déni plausible ou &quot;portefeuille sous contrainte&quot;, où une phrase secrète choisie mène à un portefeuille avec une petite quantité de fonds , utilisé pour distraire un attaquant du &quot;vrai&quot; portefeuille qui contient la majorité des fonds.</p>
</li>
</ul>
</div>
<div class="paragraph pagebreak-before data-line-276">
<p>Cependant, il est important de noter que l&#39;utilisation d&#39;une phrase secrète introduit également un risque de perte :</p>
</div>
<div class="ulist data-line-278">
<ul>
<li class="data-line-278">
<p>Si le propriétaire du portefeuille est incapacité ou décédé et que personne d&#39;autre ne connaît la phrase secrète, la valeur d&#8217;amorçage est inutile et tous les fonds stockés dans le portefeuille sont perdus à jamais.</p>
</li>
<li class="data-line-280">
<p>À l&#39;inverse, si le propriétaire sauvegarde la phrase secrète au même endroit que la valeur d&#8217;amorçage, cela va à l&#39;encontre de l&#39;objectif d&#39;un deuxième facteur.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-282">
<p>Bien que les phrases secrètes soient très utiles, elles ne doivent être utilisées qu&#39;en combinaison avec un processus soigneusement planifié de sauvegarde et de récupération, compte tenu de la possibilité que des héritiers survivant au propriétaire puissent récupérer la cryptomonnaie.</p>
</div>
</div>
<div class="sect4 data-line-285">
<h5 id="working_mnemonic_codes">Travailler avec des codes mnémoniques</h5>
<div class="paragraph data-line-287">
<p>BIP-39 est implémenté comme une bibliothèque dans de nombreux langages de programmation différents. Par example:</p>
</div>
<div class="dlist data-line-289">
<dl>
<dt class="hdlist1"><a href="https://github.com/trezor/python-mnemonic" data-href="https://github.com/trezor/python-mnemonic">python-mnemonic</a></dt>
<dd>
<p>L&#39;implémentation de référence de la norme par l&#39;équipe SatoshiLabs qui a proposé BIP-39, en Python</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/ConsenSys/eth-lightwallet" data-href="https://github.com/ConsenSys/eth-lightwallet">ConsenSys/eth-lightwallet</a></dt>
<dd>
<p>Portefeuille léger JS Ethereum pour nœuds et navigateur (avec BIP-39)</p>
</dd>
<dt class="hdlist1"><a href="https://www.npmjs.com/package/bip39" data-href="https://www.npmjs.com/package/bip39">npm/bip39</a></dt>
<dd>
<p>Implémentation JavaScript de Bitcoin BIP-39 : Code mnémonique pour générer des clés déterministes</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-295">
<p>Il existe également un générateur BIP-39 implémenté dans une page Web autonome (<a href="#a_bip39_generator_as_a_standalone_web_page">Un générateur BIP-39 en tant que page Web autonome</a>), ce qui est extrêmement utile pour les tests et l&#39;expérimentation. Le <a href="https://iancoleman.io/bip39/" data-href="https://iancoleman.io/bip39/">Mnemonic Code Converter</a> génère des mnémoniques, des valeurs d&#8217;amorçage et des clés privées étendues. Il peut être utilisé hors ligne dans un navigateur ou accessible en ligne.</p>
</div>
<div id="a_bip39_generator_as_a_standalone_web_page" class="imageblock data-line-299">
<div class="content">
<img src="images/bip39_web.png" alt="&quot;Page Web du générateur BIP-39&quot;">
</div>
<div class="title">Figure 30. Un générateur BIP-39 en tant que page Web autonome</div>
</div>
</div>
</div>
<div class="sect3 data-line-302">
<h4 id="create_hd_wallet">Créer un portefeuille HD à partir de la valeur d&#8217;amorçage</h4>
<div class="paragraph data-line-304">
<p>Les portefeuilles HD sont créés à partir d&#39;une seule <em>valeur d&#8217;amorçage racine</em>, qui est un nombre aléatoire de 128, 256 ou 512 bits. Le plus souvent, cette valeur d&#8217;amorçage est générée à partir d&#39;un mnémonique comme détaillé dans la section précédente.</p>
</div>
<div class="paragraph data-line-306">
<p>Chaque clé du portefeuille HD est dérivée de manière déterministe de cette valeur d&#8217;amorçage racine, ce qui permet de recréer l&#39;intégralité du portefeuille HD à partir de cette valeur d&#8217;amorçage dans n&#39;importe quel portefeuille HD compatible. Cela facilite l&#39;exportation, la sauvegarde, la restauration et l&#39;importation de portefeuilles HD contenant des milliers, voire des millions de clés en transférant uniquement le mnémonique à partir duquel la valeur d&#8217;amorçage racine est dérivée.</p>
</div>
</div>
<div class="sect3 data-line-309">
<h4 id="bip32_bip43_44">Portefeuilles HD (BIP-32) et Chemins (BIP-43/44)</h4>
<div class="paragraph data-line-311">
<p>La plupart des portefeuilles HD suivent le Standard BIP-32, qui est devenu un standard industriel <em>de facto</em> pour la génération de clé déterministe.</p>
</div>
<div class="paragraph data-line-313">
<p>Nous ne discuterons pas de tous les détails du BIP-32 ici, seulement des composants nécessaires pour comprendre comment il est utilisé dans les portefeuilles. Le principal aspect important est les relations hiérarchiques arborescentes qu&#39;il est possible que les clés dérivées aient, comme vous pouvez le voir dans <a href="#hd_wallets_figure">Portefeuille HD : un arbre de clés généré à partir d&#39;une seule valeur d&#8217;amorçage</a>. Il est également important de comprendre les notions de <em>clés étendues</em> et <em>clés renforcées</em>, qui sont expliquées dans les sections suivantes.</p>
</div>
<div class="paragraph data-line-315">
<p>Il existe des dizaines d&#39;implémentations interopérables de BIP-32 proposées dans de nombreuses bibliothèques de logiciels. Ceux-ci sont principalement conçus pour les portefeuilles Bitcoin, qui implémentent les adresses d&#39;une manière différente, mais partagent la même implémentation de dérivation de clé que les portefeuilles compatibles BIP-32 d&#39;Ethereum. Utilisez-en un <a href="https://github.com/ConsenSys/eth-lightwallet" class="undefined" data-href="https://github.com/ConsenSys/eth-lightwallet">https://github.com/ConsenSys/eth-lightwallet</a> [conçu pour Ethereum], ou adaptez-en un à partir de Bitcoin en ajoutant une bibliothèque d&#39;encodage d&#39;adresses Ethereum.</p>
</div>
<div class="paragraph data-line-317">
<p>Il existe également un générateur BIP-32 implémenté sous la forme d&#39;une <a href="http://bip32.org/" data-href="http://bip32.org/">page Web autonome</a> qui est très utile pour tester et expérimenter avec BIP-32.</p>
</div>
<div class="admonitionblock warning data-line-320">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-321">
<p>Le générateur BIP-32 autonome n&#39;est pas un site HTTPS. C&#39;est pour vous rappeler que l&#39;utilisation de cet outil n&#39;est pas sécurisée. C&#39;est uniquement pour tester. Vous ne devez pas utiliser les clés produites par ce site avec des fonds réels.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-325">
<h5 id="extended_keys">Clés publiques et privées étendues</h5>
<div class="paragraph data-line-327">
<p>Dans la terminologie BIP-32, les clés peuvent être &quot;étendues&quot;. Avec les bonnes opérations mathématiques, ces clés &quot;parentes&quot; étendues peuvent être utilisées pour dériver des clés &quot;enfant&quot;, produisant ainsi la hiérarchie des clés et des adresses décrites précédemment. Une clé parent n&#39;a pas besoin d&#39;être au sommet de l&#39;arborescence. peut être choisi n&#39;importe où dans l&#39;arborescence. L&#39;extension d&#39;une clé implique de prendre la clé elle-même et d&#39;y ajouter un <em>code de chaîne</em> spécial. Un code de chaîne est une chaîne binaire de 256 bits qui est mélangé avec chaque clé pour produire des clés enfants.</p>
</div>
<div class="paragraph data-line-329">
<p>Si la clé est une clé privée, elle devient une <em>clé privée étendue</em> qui se distingue par le <span class="keep-together">préfixe</span> xprv :</p>
</div>
<div id="xprv_example" class="listingblock data-line-332">
<div class="content">
<pre>xprv9s21ZrQH143K2JF8RafpqtKiTbsbaxEeUaMnNHsm5o6wCW3z8ySyH4UxFVSfZ8n7ESu7fgir8i...</pre>
</div>
</div>
<div class="paragraph data-line-336">
<p>Une <em>clé publique étendue</em> se distingue par le préfixe xpub :</p>
</div>
<div id="xpub_example" class="listingblock data-line-339">
<div class="content">
<pre>xpub661MyMwAqRbcEnKbXcCqD2GT1di5zQxVqoHPAgHNe8dv5JP8gWmDproS6kFHJnLZd23tWevhdn...</pre>
</div>
</div>
<div class="paragraph data-line-343">
<p>Une caractéristique très utile des portefeuilles HD est la possibilité de dériver les clés publiques enfants des clés publiques parents, <em>sans</em> avoir les clés privées. Cela nous donne deux façons de dériver une clé publique enfant : soit directement à partir de la clé privée enfant, soit à partir de la clé publique parent.</p>
</div>
<div class="paragraph data-line-345">
<p>Une clé publique étendue peut donc être utilisée pour dériver toutes les clés publiques (et uniquement les clés publiques) dans cette branche de la structure du portefeuille HD.</p>
</div>
<div class="paragraph data-line-347">
<p>Ce raccourci peut être utilisé pour créer des déploiements très sécurisés à clé publique uniquement, où un serveur ou une application possède une copie d&#39;une clé publique étendue, mais aucune clé privée. Ce type de déploiement peut produire un nombre infini de clés publiques et d&#39;adresses Ethereum, mais ne peut pas dépenser l&#39;argent envoyé à ces adresses. Pendant ce temps, sur un autre serveur plus sécurisé, la clé privée étendue peut dériver toutes les clés privées correspondantes pour signer des transactions et dépenser de l&#39;argent.</p>
</div>
<div class="paragraph data-line-349">
<p>Une application courante de cette méthode consiste à installer une clé publique étendue sur un serveur Web qui sert une application de commerce électronique. Le serveur Web peut utiliser la fonction de dérivation de clé publique pour créer une nouvelle adresse Ethereum pour chaque transaction (par exemple, pour le panier d&#39;un client) et n&#39;aura aucune clé privée vulnérable au vol. Sans les portefeuilles HD, la seule façon d&#39;y parvenir est de générer des milliers d&#39;adresses Ethereum sur un serveur sécurisé séparé, puis de les précharger sur le serveur de commerce électronique. Cette approche est lourde et nécessite une maintenance constante pour s&#39;assurer que le serveur ne manque pas de clés, d&#39;où la préférence d&#39;utiliser des clés publiques étendues à partir de portefeuilles HD.</p>
</div>
<div class="paragraph data-line-351">
<p>Une autre application courante de cette solution est pour le stockage à froid ou pour les portefeuilles matériels. Dans ce scénario, la clé privée étendue peut être stockée dans un portefeuille matériel, tandis que la clé publique étendue peut être conservée en ligne. L&#39;utilisateur peut créer des adresses &quot;de réception&quot; à volonté, tandis que les clés privées sont stockées en toute sécurité hors ligne. Pour dépenser les fonds, l&#39;utilisateur peut utiliser la clé privée étendue dans un client Ethereum de signature hors ligne ou signer des transactions sur le périphérique de portefeuille matériel.</p>
</div>
</div>
<div class="sect4 data-line-354">
<h5 id="hardened_child_key">Dérivation de clé enfant renforcée</h5>
<div class="paragraph data-line-356">
<p>La possibilité de dériver une branche de clés publiques à partir d&#39;une clé publique étendue, ou <em>xpub</em>, est très utile, mais elle comporte un risque potentiel. L&#39;accès à une xpub ne donne pas accès aux clés privées enfants. Cependant, étant donné que le xpub contient le code de chaîne (utilisé pour dériver les clés publiques enfants de la clé publique parent), si une clé privée enfant est connue ou divulguée d&#39;une manière ou d&#39;une autre, elle peut être utilisée avec le code de chaîne pour dériver tous les autres enfants privés. clés. Une seule clé privée enfant divulguée, associée à un code de chaîne parent, révèle toutes les clés privées de tous les enfants. Pire encore, la clé privée enfant associée à un code de chaîne parent peut être utilisée pour déduire la clé privée parent.</p>
</div>
<div class="paragraph data-line-358">
<p>Pour contrer ce risque, les portefeuilles HD utilisent une fonction de dérivation alternative appelée <em>dérivation renforcée</em>, qui &quot;casse&quot; la relation entre la clé publique parent et le code de chaîne enfant. La fonction de dérivation renforcée utilise la clé privée parent pour dériver le code de chaîne enfant, au lieu de la clé publique parent. Cela crée un &quot;pare-feu&quot; dans la séquence parent/enfant, avec un code de chaîne qui ne peut pas être utilisé pour compromettre une clé privée parent ou sœur.</p>
</div>
<div class="paragraph data-line-360">
<p>En termes simples, si vous souhaitez utiliser la commodité d&#39;un xpub pour dériver des branches de clés publiques sans vous exposer au risque d&#39;une fuite de code de chaîne, vous devez le dériver d&#39;un parent renforcé, plutôt que d&#39;un parent normal. La meilleure pratique consiste à toujours dériver les enfants de niveau 1 des clés principales par dérivation renforcée, afin d&#39;éviter toute compromission des clés principales.</p>
</div>
</div>
<div class="sect4 data-line-363">
<h5 id="index_number">Numéros d&#39;index pour dérivation normale et durcie</h5>
<div class="paragraph data-line-365">
<p>Il est clairement souhaitable de pouvoir dériver plus d&#39;une clé enfant à partir d&#39;une clé parent donnée. Pour gérer cela, un numéro d&#39;index est utilisé. Chaque numéro d&#39;index, lorsqu&#39;il est combiné avec une clé parent à l&#39;aide de la fonction spéciale de dérivation d&#39;enfant, donne une clé enfant différente. Le numéro d&#39;index utilisé dans la fonction de dérivation parent-enfant BIP-32 est un entier de 32 bits. Pour distinguer facilement les clés dérivées via la fonction de dérivation normale (non renforcée) des clés dérivées via la dérivation renforcée, ce numéro d&#39;index est divisé en deux plages. Les numéros d&#39;index entre 0 et 2<sup>31</sup>–1 (0x0 à 0x7FFFFFFF) sont utilisés <em>uniquement</em> pour la dérivation normale. Les numéros d&#39;index entre 2<sup>31</sup> et 2<sup>32</sup>–1 (0x80000000 à 0xFFFFFFFF) sont utilisés <em>uniquement</em> pour la dérivation renforcée. Ainsi, si l&#39;indice est inférieur à 2<sup>31</sup>, l&#39;enfant est normal, alors que si l&#39;indice est égal ou supérieur à 2<sup>31</sup>, l&#39;enfant est endurci.</p>
</div>
<div class="paragraph data-line-367">
<p>Pour faciliter la lecture et l&#39;affichage des numéros d&#39;index, les numéros d&#39;index pour les enfants endurcis sont affichés à partir de zéro, mais avec un symbole prime. La première clé enfant normale est donc affichée sous la forme 0, tandis que la première clé enfant renforcée (index 0x80000000) est affichée sous la forme 0&amp;#39;. Dans l&#39;ordre, alors, la deuxième clé renforcée aurait un index de 0x80000001 et serait affichée comme 1&amp;#39;, et ainsi de suite. Lorsque vous voyez un index de portefeuille HD i&amp;#39;, cela signifie 2<sup>31</sup> + i.</p>
</div>
</div>
<div class="sect4 data-line-370">
<h5 id="hd_wallet_path">Identifiant de clé de portefeuille HD (chemin)</h5>
<div class="paragraph data-line-372">
<p>Les clés d&#39;un portefeuille HD sont identifiées à l&#39;aide d&#39;un &quot; chemin&quot;, avec chaque niveau de l&#39;arborescence séparé par une barre oblique (/) (voir <a href="#hd_path_table">[hd_path_table]</a>). Les clés privées dérivées de la clé privée principale commencent par m. Les clés publiques dérivées de la clé publique principale commencent par M. Par conséquent, la première clé privée enfant de la clé privée principale est m/0. La première clé publique enfant est M/0. Le deuxième petit-enfant du premier enfant est m/0/1, et ainsi de suite.</p>
</div>
<div class="paragraph data-line-374">
<p>L&#39;&quot;ascendance&quot; d&#39;une clé se lit de droite à gauche, jusqu&#39;à atteindre la clé maîtresse dont elle est issue. Par exemple, l&#39;identifiant m/x/y/z décrit la clé qui est le z-ème enfant de la clé m/x/y, qui est le y-ème enfant de la clé m/x, qui est le x-ième enfant de m.</p>
</div>
<div id="hd_path_table" class="paragraph data-line-377">
<p>Exemples de chemin de portefeuille .HD</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-379">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Chemin HD</th>
<th class="tableblock halign-left valign-top">Clé décrite</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La première clé privée enfant (0) de la clé privée principale (m)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La clé privée du premier petit-enfant du premier enfant (m/0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0&amp;#39;/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le premier petit-enfant normal du premier enfant <em>renforcé</em> (m/0&amp;#39;)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/1/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La clé privée du premier petit-enfant du deuxième enfant (m/1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/23/17/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La clé publique du premier arrière-arrière-petit-enfant du premier arrière-petit-enfant du 18e petit-enfant du <span class="keep-together">24e enfant</span></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-389">
<h5 id="navigating_hd_wallet_tree">Naviguer dans l&#39;arborescence du portefeuille HD</h5>
<div class="paragraph data-line-391">
<p>La structure arborescente du portefeuille HD est extrêmement flexible. Le revers de la médaille est qu&#39;il permet également une complexité illimitée : chaque clé étendue parent peut avoir 4 milliards d&#39;enfants : 2 milliards d&#39;enfants normaux et 2 milliards d&#39;enfants renforcés. Chacun de ces enfants peut avoir 4 milliards d&#39;enfants supplémentaires, et ainsi de suite. L&#39;arbre peut être aussi profond que vous le souhaitez, avec un nombre potentiellement infini de générations. Avec tout ce potentiel, il peut devenir assez difficile de naviguer dans ces très grands arbres.</p>
</div>
<div class="paragraph data-line-393">
<p>Deux BIP offrent un moyen de gérer cette complexité potentielle en créant des normes pour la structure des arborescences de portefeuille HD. BIP-43 propose l&#39;utilisation du premier index enfant renforcé comme identifiant spécial qui signifie le &quot;but&quot; de la structure arborescente. Basé sur BIP-43, un portefeuille HD ne devrait utiliser qu&#39;une seule branche de niveau 1 de l&#39;arborescence, le numéro d&#39;index définissant l&#39;objectif du portefeuille en identifiant la structure et l&#39;espace de noms du reste de l&#39;arborescence. Plus précisément, un portefeuille HD utilisant uniquement la branche m/i&amp;#39;/... est destiné à signifier un objectif spécifique et cet objectif est identifié par le numéro d&#39;index i.</p>
</div>
<div class="paragraph data-line-395">
<p>Étendant cette spécification, BIP-44 propose une structure multicompte multidevise signifiée en définissant le numéro de &quot;but&quot; à 44&amp;#39;. Tous les portefeuilles HD suivant la structure BIP-44 sont identifiés par le fait qu&#39;ils n&#39;utilisent qu&#39;une seule branche de l&#39;arbre : m/44&amp;#39;/*.</p>
</div>
<div class="paragraph data-line-397">
<p>BIP-44 spécifie la structure comme étant composée de cinq niveaux d&#39;arborescence prédéfinis :</p>
</div>
<div id="bip44_tree" class="listingblock data-line-400">
<div class="content">
<pre>m / but&amp;#39; / type_de_monnaie&amp;#39; / compte&amp;#39; / change / index_adresse</pre>
</div>
</div>
<div class="paragraph data-line-404">
<p>Le premier niveau, but&amp;#39;, est toujours réglé sur 44&amp;#39;. Le deuxième niveau, type_de_monnaie&amp;#39;, spécifie le type de pièce de cryptomonnaie, permettant des portefeuilles HD multidevises où chaque devise a son propre sous-arbre sous le deuxième niveau. Il existe plusieurs devises définies dans un document standard appelé <a href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md" data-href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md">SLIP0044</a> ; par exemple, Ethereum vaut m/44&amp;#39;/60&amp;#39;, Ethereum Classic vaut m/44&amp;#39;/61&amp;#39;, Bitcoin vaut m/44&amp;#39;/0&amp;#39; et Testnet pour tous devises est m/44&amp;#39;/1&amp;#39;.</p>
</div>
<div class="paragraph data-line-406">
<p>Le troisième niveau de l&#39;arborescence est compte&amp;#39;, qui permet aux utilisateurs de subdiviser leurs portefeuilles en sous-comptes logiques distincts à des fins comptables ou organisationnelles. Par exemple, un portefeuille HD peut contenir deux &quot;comptes&quot; Ethereum : m/44&amp;#39;/60&amp;#39;/0&amp;#39; et m/44&amp;#39;/60&amp;#39;/1&amp;#39;. Chaque compte est la racine de sa propre sous-arborescence.</p>
</div>
<div class="paragraph data-line-408">
<p>Parce que BIP-44 a été créé à l&#39;origine pour Bitcoin, il contient une &quot;bizarrerie&quot; qui n&#39;est pas pertinente dans le monde Ethereum. Au quatrième niveau du chemin, change, un portefeuille HD a deux sous-arbres : un pour créer des adresses de réception et un pour créer des adresses de change (retour du change de la transaction). Seul le chemin &quot;réception&quot; est utilisé dans Ethereum, car il n&#39;est pas nécessaire de changer d&#39;adresse comme c&#39;est le cas dans Bitcoin. Notez qu&#39;alors que les niveaux précédents utilisaient une dérivation renforcée, ce niveau utilise une dérivation normale. Cela permet au niveau du compte de l&#39;arborescence d&#39;exporter des clés publiques étendues pour une utilisation dans un environnement non sécurisé. Les adresses utilisables sont dérivées par le portefeuille HD en tant qu&#39;enfants du quatrième niveau, faisant du cinquième niveau de l&#39;arborescence le index_adresse. Par exemple, la troisième adresse de réception des paiements Ethereum dans le compte principal serait M/44&amp;#39;/60&amp;#39;/0&amp;#39;/0/2. <a href="#bip44_path_examples">[bip44_path_examples]</a> montre quelques exemples supplémentaires.</p>
</div>
<div id="bip44_path_examples" class="paragraph data-line-411">
<p>Exemples de structure de portefeuille .BIP-44 HD</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-413">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Chemin HD</th>
<th class="tableblock halign-left valign-top">Clé décrite</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#39;/60&amp;#39;/0&amp;#39;/0/2+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La troisième clé publique de réception pour le compte Ethereum principal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#39;/0&amp;#39;/3&amp;#39;/1/14+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La 15<sup>ème</sup> clé publique d&#39;adresse de change pour le 4<sup>ème</sup> compte Bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/44&amp;#39;/2&amp;#39;/0&amp;#39;/0/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La deuxième clé privée du compte principal Litecoin, pour la signature des transactions</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-420">
<h3 id="_conclusion_2">Conclusion</h3>
<div class="paragraph data-line-13">
<p>Les portefeuilles sont la base de toute application chaîne de blocs destinée aux utilisateurs. Ils permettent aux utilisateurs de gérer des collections de clés et d&#39;adresses. Les portefeuilles permettent également aux utilisateurs de démontrer leur propriété d&#39;ether et d&#39;autoriser les transactions, en appliquant des signatures numériques, comme nous le verrons dans <a href="#tx_chapter">Transactions</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="tx_chapter">Transactions</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Les transactions sont des messages signés provenant d&#39;un compte externe, transmis par le réseau Ethereum et enregistrés sur la chaîne de blocs Ethereum. Cette définition de base cache bien des détails surprenants et fascinants. Une autre façon de voir les transactions est qu&#39;elles sont les seules choses qui peuvent déclencher un changement d&#39;état ou provoquer l&#39;exécution d&#39;un contrat dans l&#39;EVM. Ethereum est une machine à états singleton globale, et les transactions sont ce qui fait que cette machine à états &quot;fonctionner&quot;, qui change son état. Les contrats ne fonctionnent pas seuls. Ethereum ne fonctionne pas de manière autonome. Tout commence par une transaction.</p>
</div>
<div class="paragraph data-line-6">
<p>Dans ce chapitre, nous allons disséquer les transactions, montrer leur fonctionnement et examiner les détails. Notez qu&#39;une grande partie de ce chapitre s&#39;adresse à ceux qui souhaitent gérer leurs propres transactions à un niveau inférieur, peut-être parce qu&#39;ils écrivent une application de portefeuille ; vous n&#39;avez pas à vous en soucier si vous êtes satisfait des applications de portefeuille existantes, bien que vous puissiez trouver les détails intéressants !</p>
</div>
<div class="sect2 data-line-9">
<h3 id="tx_struct">La structure d&#39;une transaction</h3>
<div class="paragraph data-line-11">
<p>Regardons d&#39;abord la structure de base d&#39;une transaction, telle qu&#39;elle est sérialisée et transmise sur le réseau Ethereum. Chaque client et application qui reçoit une transaction sérialisée la stocke en mémoire en utilisant sa propre structure de données interne, éventuellement agrémentée de métadonnées qui n&#39;existent pas dans la transaction sérialisée du réseau elle-même. La sérialisation réseau est la seule forme standard d&#39;une transaction.</p>
</div>
<div class="paragraph data-line-13">
<p>Une transaction est un message binaire sérialisé qui contient les données suivantes :</p>
</div>
<div class="dlist data-line-15">
<dl>
<dt class="hdlist1">Nonce</dt>
<dd>
<p>Un numéro de séquence, émis par l&#39;EOA d&#39;origine, utilisé pour empêcher la relecture du message</p>
</dd>
<dt class="hdlist1">Prix du gaz</dt>
<dd>
<p>Le prix du gaz (en wei) que le donneur d&#39;ordre est prêt à payer</p>
</dd>
<dt class="hdlist1">Limite de gaz</dt>
<dd>
<p>La quantité maximale de gaz que l&#39;initiateur est prêt à acheter pour cette transaction</p>
</dd>
<dt class="hdlist1">Destinataire</dt>
<dd>
<p>L&#39;adresse Ethereum de destination</p>
</dd>
<dt class="hdlist1">Valeur</dt>
<dd>
<p>La quantité d&#39;éther à envoyer à la destination</p>
</dd>
<dt class="hdlist1">Données</dt>
<dd>
<p>La charge utile de données binaires de longueur variable</p>
</dd>
<dt class="hdlist1">v,r,s</dt>
<dd>
<p>Les trois composants d&#39;une signature numérique ECDSA de l&#39;EOA d&#39;origine</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-29">
<p>La structure du message de transaction est sérialisée à l&#39;aide du schéma de codage Recursive Length Prefix (RLP) (ou Préfixe de longueur récursif), qui a été créé spécifiquement pour sérialisation de données simple et parfaite dans Ethereum. Tous les nombres dans Ethereum sont codés sous forme d&#39;entiers gros-boutiste, de longueurs multiples de 8 bits.</p>
</div>
<div class="paragraph data-line-31">
<p>Notez que les étiquettes de champ (to, gas limit, etc.) sont affichées ici pour plus de clarté, mais ne font pas partie des données sérialisées de la transaction, qui contiennent les valeurs de champ codées RLP. En général, RLP ne contient aucun délimiteur de champ ou étiquette. Le préfixe de longueur de RLP est utilisé pour identifier la longueur de chaque champ. Tout ce qui dépasse la longueur définie appartient au champ suivant dans la structure.</p>
</div>
<div class="paragraph data-line-33">
<p>Bien qu&#39;il s&#39;agisse de la structure de transaction réelle transmise, la plupart des représentations internes et des visualisations d&#39;interface utilisateur l&#39;agrémentent d&#39;informations supplémentaires, dérivées de la transaction ou de la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-35">
<p>Par exemple, vous remarquerez peut-être qu&#39;il n&#39;y a pas de données &quot;from&quot; dans l&#39;adresse identifiant l&#39;EOA d&#39;origine. En effet, la clé publique de l&#39;EOA peut être dérivée des composants v,r,s de la signature ECDSA. L&#39;adresse peut, à son tour, être dérivée de la clé publique. Lorsque vous voyez une transaction affichant un champ &quot;from&quot;, qui a été ajouté par le logiciel utilisé pour visualiser la transaction. D&#39;autres métadonnées fréquemment ajoutées à la transaction par le logiciel client incluent le numéro de bloc (une fois extrait et inclus dans la chaîne de blocs) et un ID de transaction (hachage calculé). Encore une fois, ces données sont dérivées de la transaction et ne font pas partie du message de transaction lui-même.</p>
</div>
</div>
<div class="sect2 data-line-38">
<h3 id="tx_nonce">Le Nonce de transaction</h3>
<div class="paragraph data-line-40">
<p>Le nonce est l&#39;un des composants les plus importants et les moins compris d&#39;une transaction. La définition du Livre jaune (voir <a href="#references">Lectures complémentaires</a>) lit :</p>
</div>
<div class="quoteblock data-line-42">
<blockquote>
<div class="paragraph data-line-43">
<p>nonce : Une valeur scalaire égale au nombre de transactions émises depuis cette adresse ou, dans le cas de comptes avec code associé, au nombre de créations de contrats effectuées par ce compte.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-46">
<p>À proprement parler, le nonce est un attribut de l&#39;adresse d&#39;origine ; c&#39;est-à-dire qu&#39;il n&#39;a de sens que dans le contexte de l&#39;adresse d&#39;envoi. Cependant, le nonce n&#39;est pas stocké explicitement dans le cadre de l&#39;état d&#39;un compte sur la chaîne de blocs. Au lieu de cela, il est calculé dynamiquement, en comptant le nombre de transactions confirmées provenant d&#39;une adresse.</p>
</div>
<div class="paragraph data-line-48">
<p>Il existe deux scénarios dans lesquels l&#39;existence d&#39;un nonce de comptage des transactions est importante : la fonctionnalité d&#39;utilisabilité des transactions incluses dans l&#39;ordre de création et la fonctionnalité vitale de la protection contre la duplication des transactions. Regardons un exemple de scénario pour chacun d&#39;entre eux :</p>
</div>
<div class="olist arabic data-line-50">
<ol class="arabic">
<li class="data-line-50">
<p>Imaginez que vous souhaitiez effectuer deux transactions. Vous avez un paiement important à effectuer de 6 ethers, et aussi un autre paiement de 8 ethers. Vous signez et diffusez d&#39;abord la transaction à 6 ethers, car c&#39;est la plus importante, puis vous signez et diffusez la deuxième transaction à 8 ethers. Malheureusement, vous avez oublié le fait que votre compte ne contient que 10 ethers, donc le réseau ne peut pas accepter les deux transactions : l&#39;une d&#39;entre elles échouera. Parce que vous avez envoyé le 6-ether le plus important en premier, vous vous attendez naturellement à ce que celui-ci passe et que le 8-ether soit rejeté. Cependant, dans un système décentralisé comme Ethereum, les nœuds peuvent recevoir les transactions dans n&#39;importe quel ordre ; il n&#39;y a aucune garantie qu&#39;un nœud particulier aura une transaction qui lui sera propagée avant l&#39;autre. En tant que tel, il sera presque certainement le cas que certains nœuds reçoivent la transaction à 6 ethers en premier et que d&#39;autres reçoivent la transaction à 8 ethers en premier. Sans le nonce, il serait aléatoire de savoir lequel est accepté et lequel est rejeté. Cependant, avec le nonce inclus, la première transaction que vous avez envoyée aura un nonce de, disons, 3, tandis que la transaction 8-ether a la valeur de nonce suivante (c&#39;est-à-dire 4). Ainsi, cette transaction sera ignorée jusqu&#39;à ce que les transactions avec des nonces de 0 à 3 aient été traitées, même si elle est reçue en premier. Phew!</p>
</li>
<li class="data-line-53">
<p>Imaginez maintenant que vous avez un compte avec 100 ethers. Fantastique! Vous trouvez quelqu&#39;un en ligne qui acceptera le paiement en ether pour un mcguffin-widget que vous voulez vraiment acheter. Vous leur envoyez 2 ethers et ils vous envoient le widget mcguffin. Beau. Pour effectuer ce paiement à 2 ethers, vous avez signé une transaction en envoyant 2 ethers de votre compte à leur compte, puis vous les avez diffusés sur le réseau Ethereum pour qu&#39;ils soient vérifiés et inclus dans la chaîne de blocs. Maintenant, sans valeur nonce dans la transaction, une seconde transaction envoyant 2 ethers à la même adresse une seconde fois aura exactement la même apparence que la première transaction. Cela signifie que toute personne qui voit votre transaction sur le réseau Ethereum (ce qui signifie que tout le monde, y compris le destinataire ou vos ennemis) peut &quot;rejouer&quot; la transaction encore et encore et encore jusqu&#39;à ce que tout votre ether soit parti simplement en copiant et collant votre transaction d&#39;origine et le renvoyer sur le réseau. Cependant, avec la valeur nonce incluse dans les données de transaction, <em>chaque transaction est unique</em>, même lors de l&#39;envoi de la même quantité d&#39;éther à la même adresse de destinataire plusieurs fois. Ainsi, en ayant le nonce incrémenté dans le cadre de la transaction, il n&#39;est tout simplement pas possible pour quiconque de &quot;dupliquer&quot; un paiement que vous avez effectué.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-55">
<p>En résumé, il est important de noter que l&#39;utilisation du nonce est en fait vitale pour un protocole <em>basé sur le compte</em>, contrairement au mécanisme &quot;Unspent Transaction Output&quot; (UTXO) du protocole Bitcoin.</p>
</div>
<div class="sect3 data-line-58">
<h4 id="tracking_nonce">Garder une trace des Nonces</h4>
<div class="paragraph data-line-60">
<p>En termes pratiques, le nonce est un décompte à jour du nombre de transactions <em>confirmées</em> (c&#39;est-à-dire en chaîne) provenant d&#39;un compte. Pour savoir ce qu&#39;est le nonce, vous pouvez interroger la chaîne de blocs, par exemple via l&#39;interface web3. Ouvrez une console JavaScript dans Geth (ou votre interface web3 préférée) sur Ropsten testnet, puis tapez :</p>
</div>
<pre data-type="programlisting">
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f")</strong>
40

</pre>
<div class="admonitionblock tip data-line-71">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-72">
<p>Le nonce est un compteur basé sur zéro, ce qui signifie que la première transaction a le nonce 0. Dans cet exemple, nous avons un nombre de transactions de 40, ce qui signifie que les nonces 0 à 39 ont été vus. Le nonce de la prochaine transaction devra être de 40.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-75">
<p>Votre portefeuille gardera une trace des nonces pour chaque adresse qu&#39;il gère. C&#39;est assez simple à faire, tant que vous n&#39;effectuez des transactions qu&#39;à partir d&#39;un seul point. Disons que vous écrivez votre propre logiciel de portefeuille ou une autre application qui génère des transactions. Comment suivre les nonces ?</p>
</div>
<div class="paragraph data-line-77">
<p>Lorsque vous créez une nouvelle transaction, vous affectez le nonce suivant dans la séquence. Mais jusqu&#39;à ce qu&#39;il soit confirmé, il ne comptera pas dans le total getTransactionCount.</p>
</div>
<div id="get_tx_count_bug" class="admonitionblock warning data-line-81">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-82">
<p>Soyez prudent lorsque vous utilisez la fonction getTransactionCount pour compter les transactions en attente, car vous pourriez rencontrer des problèmes si vous envoyez quelques transactions à la suite.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-85">
<p>Regardons un exemple :</p>
</div>
<pre data-type="programlisting">
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f", \
"pending")</strong>
40
&gt; <strong>web3.eth.sendTransaction({from: web3.eth.accounts[0], to: \
"0xB0920c523d582040f2BCB1bD7FB1c7C1ECEbdB34", value: web3.utils.toWei(0.01, "ether")});</strong>
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f", \
"pending")</strong>
41
&gt; <strong>web3.eth.sendTransaction({from: web3.eth.accounts[0], to: \
"0xB0920c523d582040f2BCB1bD7FB1c7C1ECEbdB34", value: web3.utils.toWei(0.01, "ether")});</strong>
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f", \
"pending")</strong>
41
&gt; <strong>web3.eth.sendTransaction({from: web3.eth.accounts[0], to: \
"0xB0920c523d582040f2BCB1bD7FB1c7C1ECEbdB34", value: web3.utils.toWei(0.01, "ether")});</strong>
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f", \
"pending")</strong>
41

</pre>
<div class="admonitionblock tip data-line-111">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-112">
<p>Si vous essayez de recréer vous-même ces exemples de code dans la console javascript de Geth, vous devez utiliser web3.toWei() au lieu de web3.utils.toWei(). En effet, Geth utilise une ancienne version de la bibliothèque web3.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-115">
<p>Comme vous pouvez le voir, la première transaction que nous avons envoyée a augmenté le nombre de transactions à 41, indiquant la transaction en attente. Mais lorsque nous avons envoyé trois autres transactions en succession rapide, l&#39;appel getTransactionCount ne les a pas comptées. Il n&#39;en comptait qu&#39;un, même si vous vous attendiez à ce qu&#39;il y en ait trois en attente dans le mempool. Si nous attendons quelques secondes pour permettre aux communications réseau de s&#39;établir, l&#39;appel getTransactionCount renverra le nombre attendu. Mais dans l&#39;intervalle, bien qu&#39;il y ait plus d&#39;une transaction en attente, cela pourrait ne pas nous aider.</p>
</div>
<div class="paragraph data-line-117">
<p>Lorsque vous construisez une application qui construit des transactions, elle ne peut pas s&#39;appuyer sur <span class="keep-together"><code>getTransactionCount</code></span> pour les transactions en attente. Ce n&#39;est que lorsque les nombres en attente et confirmés sont égaux (toutes les transactions en attente sont confirmées) que vous pouvez faire confiance à la sortie de getTransactionCount pour démarrer votre compteur de nonce. Par la suite, gardez une trace du nonce dans votre application jusqu&#39;à ce que chaque transaction soit confirmée.</p>
</div>
<div class="paragraph data-line-119">
<p>L&#39;interface JSON RPC de Parity propose la fonction parity_nextNonce, qui renvoie le prochain nonce à utiliser dans une transaction. La fonction parity_nextNonce compte correctement les nonces, même si vous construisez plusieurs transactions en succession rapide sans les confirmer :</p>
</div>
<pre data-type="programlisting">
$ <strong>curl --data '{"method":"parity_nextNonce", \
  "params":["0x9e713963a92c02317a681b9bb3065a8249de124f"],\
  "id":1,"jsonrpc":"2.0"}' -H "Content-Type: application/json" -X POST \
  localhost:8545</strong>

{"jsonrpc":"2.0","result":"0x32","id":1}

</pre>
<div id="parity_curl" class="admonitionblock tip data-line-135">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-136">
<p>Parity dispose d&#39;une console Web pour accéder à l&#39;interface JSON RPC, mais ici nous utilisons un client HTTP en ligne de commande pour y accéder.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-140">
<h4 id="gaps_nonce">Lacunes dans les nonces, les nonces en double et la confirmation</h4>
<div class="paragraph data-line-142">
<p>Il est important de garder une trace des nonces si vous créez des transactions par programmation, surtout si vous le faites à partir de plusieurs processus indépendants <span class="keep-together">simultanément</span>.</p>
</div>
<div class="paragraph data-line-144">
<p>Le réseau Ethereum traite les transactions de manière séquentielle, sur la base du nonce. Cela signifie que si vous transmettez une transaction avec nonce 0, puis transmettez une transaction avec nonce 2, la deuxième transaction ne sera incluse dans aucun bloc. Il sera stocké dans le mempool, pendant que le réseau Ethereum attend que le nonce manquant apparaisse. Tous les nœuds supposeront que le nonce manquant a simplement été retardé et que la transaction avec le nonce 2 a été reçue dans le désordre.</p>
</div>
<div class="paragraph data-line-146">
<p>Si vous transmettez ensuite une transaction avec le nonce 1 manquant, les deux transactions (nonces 1 et 2) seront traitées et incluses (si elles sont valides, bien sûr). Une fois que vous avez comblé le vide, le réseau peut exploiter la transaction hors séquence qu&#39;il a conservée dans le mempool.</p>
</div>
<div class="paragraph data-line-148">
<p>Cela signifie que si vous créez plusieurs transactions en séquence et que l&#39;une d&#39;entre elles n&#39;est officiellement incluse dans aucun bloc, toutes les transactions suivantes seront &quot;bloquées&quot;, en attendant le nonce manquant. Une transaction peut créer un &quot;écart&quot; par inadvertance dans la séquence nonce car elle n&#39;est pas valide ou n&#39;a pas suffisamment de gaz. Pour que les choses bougent à nouveau, vous devez transmettre une transaction valide avec le nonce manquant. Vous devez également garder à l&#39;esprit qu&#39;une fois qu&#39;une transaction avec le nonce &quot;manquant&quot; est validée par le réseau, toutes les transactions de diffusion avec les nonces suivants deviendront progressivement valides ; il n&#39;est pas possible de &quot;rappeler&quot; une transaction !</p>
</div>
<div class="paragraph data-line-150">
<p>Si, en revanche, vous dupliquez accidentellement un nonce, par exemple en transmettant deux transactions avec le même nonce mais différents destinataires ou valeurs, l&#39;un d&#39;entre eux sera confirmé et l&#39;autre sera rejeté. Celui qui est confirmé sera déterminé par la séquence dans laquelle ils arrivent au premier nœud de validation qui les reçoit, c&#39;est-à-dire que ce sera assez aléatoire.</p>
</div>
<div class="paragraph data-line-152">
<p>Comme vous pouvez le constater, le suivi des nonces est nécessaire, et si votre application ne gère pas correctement ce processus, vous rencontrerez des problèmes. Malheureusement, les choses deviennent encore plus difficiles si vous essayez de le faire simultanément, comme nous le verrons dans la section suivante.</p>
</div>
</div>
<div class="sect3 data-line-155">
<h4 id="concurrency">Concurrence, origine des transactions et nonces</h4>
<div class="paragraph data-line-157">
<p>La concurrence est un aspect complexe de l&#39;informatique, et il apparaît parfois de manière inattendue, en particulier dans les systèmes en temps réel décentralisés et distribués comme <span class="keep-together">Ethereum</span>.</p>
</div>
<div class="paragraph data-line-159">
<p>En termes simples, la concurrence est lorsque vous avez un calcul simultané par plusieurs systèmes indépendants. Ceux-ci peuvent se trouver dans le même programme (par exemple, multithreading), sur le même processeur (par exemple, multitraitement) ou sur différents ordinateurs (c&#39;est-à-dire, <span class="keep-together">systèmes</span> distribués). Ethereum, par définition, est un système qui permet la simultanéité des opérations (nœuds, clients, DApps) mais applique un état singleton par consensus.</p>
</div>
<div class="paragraph data-line-161">
<p>Maintenant, imaginez que vous ayez plusieurs applications de portefeuille indépendantes qui génèrent des transactions à partir de la ou des mêmes adresses. Un exemple d&#39;une telle situation serait un échange traitant des retraits du portefeuille chaud de l&#39;échange (un portefeuille dont les clés sont stockées en ligne, contrairement à un portefeuille froid où les clés ne sont jamais en ligne). Idéalement, vous voudriez avoir plus d&#39;un ordinateur traitant les retraits, afin qu&#39;il ne devienne pas un goulot d&#39;étranglement ou un point de défaillance unique. Cependant, cela devient rapidement problématique, car le fait d&#39;avoir plus d&#39;un ordinateur produisant des retraits entraînera des problèmes épineux de concurrence, dont le moindre n&#39;est pas la sélection des nonces. Comment plusieurs ordinateurs générant, signant et diffusant des transactions à partir du même compte du portefeuille chaud (Hot Wallet) se coordonnent-ils ?</p>
</div>
<div class="paragraph data-line-163">
<p>Vous pouvez utiliser un seul ordinateur pour attribuer des nonces, selon le principe du premier arrivé, premier servi, aux ordinateurs signant des transactions. Cependant, cet ordinateur est maintenant un point de défaillance unique. Pire encore, si plusieurs nonces sont attribués et que l&#39;un d&#39;entre eux n&#39;est jamais utilisé (à cause d&#39;une défaillance de l&#39;ordinateur traitant la transaction avec ce nonce), toutes les transactions suivantes restent bloquées.</p>
</div>
<div class="paragraph data-line-165">
<p>Une autre approche serait de générer les transactions, mais de ne pas leur attribuer de nonce (et donc de les laisser non signées - rappelez-vous que le nonce fait partie intégrante des données de transaction et doit donc être inclus dans la signature numérique qui authentifie la transaction) . Vous pouvez ensuite les mettre en file d&#39;attente sur un seul nœud qui les signe et garde également une trace des nonces. Encore une fois, cependant, ce serait un point d&#39;étranglement dans le processus : la signature et le suivi des nonces est la partie de votre opération qui est susceptible d&#39;être encombrée sous charge, alors que la génération de la transaction non signée est la partie que vous n&#39;avez pas vraiment besoin de paralléliser. Vous auriez une certaine concurrence, mais il y aurait un manque dans une partie essentielle du processus.</p>
</div>
<div class="paragraph data-line-167">
<p>En fin de compte, ces problèmes de simultanéité, en plus de la difficulté de suivre les soldes des comptes et les confirmations de transaction dans des processus indépendants, obligent la plupart des implémentations à éviter la simultanéité et à créer des goulots d&#39;étranglement tels qu&#39;un processus unique gérant toutes les transactions de retrait dans un échange, ou la mise en place de plusieurs des portefeuilles chauds qui peuvent fonctionner de manière totalement indépendante pour les retraits et ne doivent être rééquilibrés que par intermittence.</p>
</div>
</div>
</div>
<div class="sect2 data-line-170">
<h3 id="tx_gas">Gaz de transaction</h3>
<div class="paragraph data-line-172">
<p>Nous avons un peu parlé du gaz dans les chapitres précédents, et nous en discutons plus en détail dans <a href="#gas">Gaz</a>. Cependant, couvrons quelques notions de base sur le rôle des composants gasPrice et gasLimit d&#39;une transaction.</p>
</div>
<div class="paragraph data-line-174">
<p>Le gaz est le carburant d&#39;Ethereum. Le gaz n&#39;est pas de l&#39;ether, c&#39;est une monnaie virtuelle distincte avec son propre taux de change par rapport à l&#39;ether. Ethereum utilise du gaz pour contrôler la quantité de ressources qu&#39;une transaction peut utiliser, car elle sera traitée sur des milliers d&#39;ordinateurs à travers le monde. Le modèle de calcul ouvert (Turing-complet) nécessite une certaine forme de mesure afin d&#39;éviter les attaques par déni de service ou les transactions gourmandes en ressources par inadvertance.</p>
</div>
<div class="paragraph data-line-176">
<p>Le gaz est séparé de l&#39;ether afin de protéger le système de la volatilité qui pourrait survenir avec les changements rapides de la valeur de l&#39;ether, et aussi comme moyen de gérer les rapports importants et sensibles entre les coûts des diverses ressources que le gaz paie. (à savoir, calcul, mémoire et stockage).</p>
</div>
<div class="paragraph data-line-178">
<p>Le champ gasPrice dans une transaction permet à l&#39;initiateur de la transaction de définir le prix qu&#39;il est prêt à payer en échange de gaz. Le prix est mesuré en wei par unité de gaz. Par exemple, dans l&#39;exemple de transaction dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a> votre portefeuille fixe le gasPrice à 3 gwei (3 gigawei ou 3 milliards de wei).</p>
</div>
<div class="admonitionblock tip data-line-181">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-182">
<p>Le site populaire <a href="https://ethgasstation.info/" data-href="https://ethgasstation.info/">ETH Gas Station</a> fournit des informations sur les prix actuels du gaz et d&#39;autres paramètres de gaz pertinents pour le réseau principal Ethereum.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-185">
<p>Les portefeuilles peuvent ajuster le gasPrice dans les transactions qu&#39;ils génèrent pour obtenir une confirmation plus rapide des transactions. Plus le gasPrice est élevé, plus la transaction est susceptible d&#39;être confirmée rapidement. À l&#39;inverse, les transactions moins prioritaires peuvent avoir un prix réduit, ce qui entraîne une confirmation plus lente. La valeur minimale à laquelle gasPrice peut être défini est zéro, ce qui signifie une transaction sans frais. Pendant les périodes de faible demande d&#39;espace dans un bloc, de telles transactions pourraient très bien être minées.</p>
</div>
<div class="admonitionblock note data-line-188">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-189">
<p>Le gasPrice minimum acceptable est zéro. Cela signifie que les portefeuilles peuvent générer des transactions totalement gratuites. Selon la capacité, celles-ci peuvent ne jamais être confirmées, mais rien dans le protocole n&#39;interdit les transactions gratuites. Vous pouvez trouver plusieurs exemples de telles transactions incluses avec succès sur la chaîne de blocs Ethereum.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="gas_price_suggestion" class="paragraph data-line-193">
<p>L&#39;interface web3 propose une suggestion gasPrice, en calculant un prix médian sur plusieurs blocs (nous pouvons utiliser la console truffle ou n&#39;importe quelle console web3 JavaScript pour le faire) :</p>
</div>
<pre data-type="programlisting">
> <strong>web3.eth.getGasPrice(console.log)</strong>
> null BigNumber { s: 1, e: 10, c: [ 10000000000 ] }

</pre>
<div id="calc_gas_price" class="paragraph data-line-204">
<p>Le deuxième champ important lié au gaz est gasLimit. En termes simples, gasLimit donne le nombre maximum d&#39;unités de gaz que l&#39;initiateur de la transaction est prêt à acheter pour finaliser la transaction. Pour les paiements simples, c&#39;est-à-dire les transactions qui transfèrent de l&#39;ether d&#39;un EOA à un autre EOA, la quantité de gaz nécessaire est fixée à 21 000 unités de gaz. Pour calculer combien d&#39;ether cela coûtera, vous multipliez 21 000 par le gasPrice que vous êtes prêt à payer. Par example:</p>
</div>
<pre data-type="programlisting">
> <strong>web3.eth.getGasPrice(function(err, res) {console.log(res*21000)} )</strong>
> 210000000000000

</pre>
<div class="paragraph data-line-214">
<p>Si l&#39;adresse de destination de votre transaction est un contrat, la quantité de gaz nécessaire peut être estimée mais ne peut pas être déterminée avec précision. En effet, un contrat peut évaluer différentes conditions qui conduisent à différentes voies d&#39;exécution, avec différents coûts totaux du gaz. Le contrat peut n&#39;exécuter qu&#39;un calcul simple ou un calcul plus complexe, selon des conditions indépendantes de votre volonté et imprévisibles. Pour le démontrer, regardons un exemple : nous pouvons écrire un contrat intelligent qui incrémente un compteur à chaque fois qu&#39;il est appelé et exécute une boucle particulière un nombre de fois égal au nombre d&#39;appels. Peut-être qu&#39;au 100e appel, il distribue un prix spécial, comme une loterie, mais doit faire des calculs supplémentaires pour calculer le prix. Si vous appelez le contrat 99 fois, une chose se produit, mais au 100e appel, quelque chose de très différent se produit. La quantité de gaz que vous paieriez pour cela dépend du nombre d&#39;autres transactions qui ont appelé cette fonction avant que votre transaction ne soit incluse dans un bloc. Peut-être que votre estimation est basée sur la 99e transaction, mais juste avant que votre transaction ne soit confirmée, quelqu&#39;un d&#39;autre appelle le contrat pour la 99e fois. Vous êtes maintenant la 100e transaction à appeler, et l&#39;effort de calcul (et le coût du gaz) est beaucoup plus élevé.</p>
</div>
<div class="paragraph data-line-216">
<p>Pour emprunter une analogie courante utilisée dans Ethereum, vous pouvez considérer gasLimit comme la capacité du réservoir de carburant de votre voiture (votre voiture est la transaction). Vous remplissez le réservoir avec autant d&#39;essence que vous pensez qu&#39;il en aura besoin pour le trajet (le calcul nécessaire pour valider votre transaction). Vous pouvez estimer le montant dans une certaine mesure, mais il peut y avoir des changements inattendus dans votre trajet, comme une déviation (un chemin d&#39;exécution plus complexe), qui augmentent la consommation de carburant.</p>
</div>
<div class="paragraph data-line-218">
<p>L&#39;analogie avec un réservoir de carburant est cependant quelque peu trompeuse. Il s&#39;agit en fait plus d&#39;un compte de crédit pour une entreprise de station-service, où vous payez une fois le voyage terminé, en fonction de la quantité d&#39;essence que vous avez réellement utilisée. Lorsque vous transmettez votre transaction, l&#39;une des premières étapes de validation consiste à vérifier que le compte dont elle provient dispose de suffisamment d&#39;ether pour payer la limite gasPrice * gaz. Mais le montant n&#39;est pas réellement déduit de votre compte tant que la transaction n&#39;est pas terminée. Vous n&#39;êtes facturé que pour le gaz réellement consommé par votre transaction, mais vous devez disposer d&#39;un solde suffisant pour le montant maximum que vous êtes prêt à payer avant d&#39;envoyer votre transaction.</p>
</div>
</div>
<div class="sect2 data-line-221">
<h3 id="tx_recipient">Destinataire de la transaction</h3>
<div class="paragraph data-line-223">
<p>Le destinataire d&#39;une transaction est spécifié dans le champ to. Celui-ci contient une adresse Ethereum de 20 octets. L&#39;adresse peut être une EOA ou une adresse de contrat.</p>
</div>
<div class="paragraph data-line-225">
<p>Ethereum ne valide plus ce champ. Toute valeur de 20 octets est considérée comme valide. Si la valeur de 20 octets correspond à une adresse sans clé privée correspondante, ou sans contrat correspondant, la transaction est toujours valide. Ethereum n&#39;a aucun moyen de savoir si une adresse a été correctement dérivée d&#39;une clé publique (et donc d&#39;une clé privée) existante.</p>
</div>
<div class="admonitionblock warning data-line-228">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-229">
<p>Le protocole Ethereum ne valide pas les adresses des destinataires dans les transactions. Vous pouvez envoyer à une adresse qui n&#39;a pas de clé privée ou de contrat correspondant, &quot;brûlant&quot; ainsi l&#39;ether, le rendant à jamais inutilisable. La validation doit être effectuée au niveau de l&#39;interface utilisateur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-232">
<p>L&#39;envoi d&#39;une transaction à la mauvaise adresse va probablement <em>brûler</em> l&#39;ether envoyé, le rendant à jamais inaccessible (inutilisable), puisque la plupart des adresses n&#39;ont pas de clé privée connue et donc aucune signature ne peut être générée pour le dépenser. On suppose que la validation de l&#39;adresse se produit au niveau de l&#39;interface utilisateur (voir <a href="#EIP55">Encodage hexadécimal avec somme de contrôle en majuscules (EIP-55)</a>). En fait, il existe un certain nombre de raisons valables pour brûler de l&#39;ether - par exemple, pour dissuader de tricher dans les canaux de paiement et autres contrats intelligents - et puisque la quantité d&#39;ether est finie, brûler de l&#39;ether distribue efficacement la valeur brûlée à tous les détenteurs d&#39;ether. (proportionnellement à la quantité d&#39;ether qu&#39;ils contiennent).</p>
</div>
</div>
<div class="sect2 data-line-235">
<h3 id="tx_value_data">Valeur et données de la transaction</h3>
<div class="paragraph data-line-237">
<p>La &quot;charge utile&quot; principale d&#39;une transaction est contenue dans deux champs : value et data. Les transactions peuvent avoir à la fois une valeur et des données, uniquement une valeur, uniquement des données ou ni valeur ni données. Les quatre combinaisons sont valides.</p>
</div>
<div class="paragraph data-line-239">
<p>Une transaction avec seulement une valeur est un <em>paiement</em>. Une transaction avec uniquement des données est une <em>invocation</em>. Une transaction comportant à la fois de la valeur et des données est à la fois un paiement et une invocation. Une transaction sans valeur ni données - eh bien, ce n&#39;est probablement qu&#39;un gaspillage de gaz ! Mais c&#39;est encore possible.</p>
</div>
<div class="paragraph data-line-241">
<p>Essayons toutes ces combinaisons. Nous allons d&#39;abord définir les adresses source et de destination de notre portefeuille, juste pour rendre la démo plus facile à lire :</p>
</div>
<div class="listingblock data-line-244">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">src = web3.eth.accounts[0];
dst = web3.eth.accounts[1];</code></pre>
</div>
</div>
<div class="paragraph data-line-249">
<p>Notre première transaction ne contient qu&#39;une valeur (paiement) et aucune charge de données :</p>
</div>
<div id="tx_value_nodata_src" class="listingblock data-line-253">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">web3.eth.sendTransaction({from: src, to: dst, \
  value: web3.utils.toWei(0.01, "ether"), data: ""});</code></pre>
</div>
</div>
<div class="paragraph data-line-258">
<p>Notre portefeuille affiche un écran de confirmation indiquant la valeur à envoyer, comme indiqué dans <a href="#parity_txdemo_value_nodata">Portefeuille de Parity montrant une transaction avec une valeur, mais pas de données</a>.</p>
</div>
<div id="parity_txdemo_value_nodata" class="imageblock data-line-262">
<div class="content">
<img src="images/parity_txdemo_value_nodata.png" alt="&quot;Portefeuille de Parity montrant une transaction avec valeur" width="mais pas de données&quot;">
</div>
<div class="title">Figure 31. Portefeuille de Parity montrant une transaction avec une valeur, mais pas de données</div>
</div>
<div class="paragraph data-line-265">
<p>L&#39;exemple suivant spécifie à la fois une valeur et une charge utile de données :</p>
</div>
<div id="tx_value_data_src" class="listingblock data-line-269">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">web3.eth.sendTransaction({from: src, to: dst, \
  value: web3.utils.toWei(0.01, "ether"), data: "0x1234"});</code></pre>
</div>
</div>
<div class="paragraph data-line-274">
<p>Notre portefeuille affiche un écran de confirmation indiquant la valeur à envoyer ainsi que la charge utile des données, comme indiqué dans <a href="#parity_txdemo_value_data">Portefeuille de Parity montrant une transaction avec valeur et données</a>.</p>
</div>
<div id="parity_txdemo_value_data" class="imageblock data-line-278">
<div class="content">
<img src="images/parity_txdemo_value_data.png" alt="&quot;Portefeuille de Parity montrant une transaction avec valeur et données&quot;">
</div>
<div class="title">Figure 32. Portefeuille de Parity montrant une transaction avec valeur et données</div>
</div>
<div class="paragraph data-line-280">
<p>La transaction suivante inclut une charge utile de données mais spécifie une valeur de zéro :</p>
</div>
<div id="tx_novalue_data_src" class="listingblock data-line-284">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">web3.eth.sendTransaction({from: src, to: dst, value: 0, data: "0x1234"});</code></pre>
</div>
</div>
<div class="paragraph data-line-288">
<p>Notre portefeuille affiche un écran de confirmation indiquant la valeur zéro et la charge utile des données, comme indiqué dans <a href="#parity_txdemo_novalue_data">Portefeuille de Parity montrant une transaction sans valeur, uniquement des données</a>.</p>
</div>
<div id="parity_txdemo_novalue_data" class="imageblock data-line-292">
<div class="content">
<img src="images/parity_txdemo_novalue_data.png" alt="&quot;Portefeuille de Parity montrant une transaction sans valeur" width="uniquement des données&quot;">
</div>
<div class="title">Figure 33. Portefeuille de Parity montrant une transaction sans valeur, uniquement des données</div>
</div>
<div class="paragraph pagebreak-before data-line-295">
<p>Enfin, la dernière transaction n&#39;inclut ni valeur à envoyer ni données utiles :</p>
</div>
<div id="tx_novalue_nodata_src" class="listingblock data-line-299">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">web3.eth.sendTransaction({from: src, to: dst, value: 0, data: ""}));</code></pre>
</div>
</div>
<div class="paragraph data-line-303">
<p>Notre portefeuille affiche un écran de confirmation indiquant la valeur zéro, comme indiqué dans <a href="#parity_txdemo_novalue_nodata">Portefeuille de Parity montrant une transaction sans valeur et sans données</a>.</p>
</div>
<div id="parity_txdemo_novalue_nodata" class="imageblock data-line-307">
<div class="content">
<img src="images/parity_txdemo_novalue_nodata.png" alt="&quot;Portefeuille de Parity montrant une transaction sans valeur et sans données&quot;">
</div>
<div class="title">Figure 34. Portefeuille de Parity montrant une transaction sans valeur et sans données</div>
</div>
<div class="sect3 data-line-310">
<h4 id="value_EOA_contracts">Transmettre de la valeur aux EOA et aux contrats</h4>
<div class="paragraph data-line-312">
<p>Lorsque vous construisez une transaction Ethereum qui contient une valeur, c&#39;est l&#39;équivalent d&#39;un <em>paiement</em>. Ces transactions se comportent différemment selon que l&#39;adresse de destination est un contrat ou non.</p>
</div>
<div class="paragraph data-line-314">
<p>Pour les adresses EOA, ou plutôt pour toute adresse qui n&#39;est pas signalée comme un contrat sur la chaîne de blocs, Ethereum enregistrera un changement d&#39;état, ajoutant la valeur que vous avez envoyée au solde de l&#39;adresse. Si l&#39;adresse n&#39;a pas été vue auparavant, elle sera ajoutée à la représentation interne de l&#39;état du client et son solde initialisé à la valeur de votre paiement.</p>
</div>
<div class="paragraph data-line-316">
<p>Si l&#39;adresse de destination (to) est un contrat, alors l&#39;EVM exécutera le contrat et tentera d&#39;appeler la fonction nommée dans la charge utile de données de votre transaction. S&#39;il n&#39;y a pas de données dans votre transaction, l&#39;EVM appellera une fonction <em>fallback</em> (ou fonction de repli ou par défaut) et, si cette fonction est payante, l&#39;exécutera pour déterminer ce qu&#39;il faut faire ensuite. S&#39;il n&#39;y a pas de code dans la fonction de secours, l&#39;effet de la transaction sera d&#39;augmenter le solde du contrat, exactement comme un paiement sur un portefeuille. S&#39;il n&#39;y a pas de fonction de secours ou de fonction de secours non payante, la transaction sera annulée.</p>
</div>
<div class="paragraph data-line-318">
<p>Un contrat peut rejeter les paiements entrants en levant une exception immédiatement lorsqu&#39;une fonction est appelée, ou tel que déterminé par des conditions codées dans une fonction. Si la fonction se termine avec succès (sans exception), l&#39;état du contrat est mis à jour pour refléter une augmentation du solde d&#39;ether du contrat.</p>
</div>
</div>
<div class="sect3 data-line-321">
<h4 id="data_EOA">Transmission d&#39;une charge utile de données à un EOA ou à un contrat</h4>
<div class="paragraph data-line-323">
<p>Lorsque votre transaction contient des données, elle est très probablement adressée à une adresse de contrat. Cela ne signifie pas que vous ne pouvez pas envoyer une charge utile de données à un EOA, ce qui est tout à fait valide dans le protocole Ethereum. Cependant, dans ce cas, l&#39;interprétation des données dépend du portefeuille que vous utilisez pour accéder à l&#39;EOA. Il est ignoré par le protocole Ethereum. La plupart des portefeuilles ignorent également toutes les données reçues lors d&#39;une transaction vers un EOA qu&#39;ils contrôlent. À l&#39;avenir, il est possible que des normes émergent qui permettent aux portefeuilles d&#39;interpréter les données comme le font les contrats, permettant ainsi aux transactions d&#39;invoquer des fonctions exécutées à l&#39;intérieur des portefeuilles des utilisateurs. La différence essentielle est que toute interprétation de la charge utile de données par un EOA n&#39;est pas soumise aux règles de consensus d&#39;Ethereum, contrairement à un contrat <span class="keep-together">exécution</span>.</p>
</div>
<div class="paragraph data-line-325">
<p>Pour l&#39;instant, supposons que votre transaction envoie des données à une adresse contractuelle. Dans ce cas, les données seront interprétées par l&#39;EVM comme une <em>invocation de contrat</em>.  La plupart des contrats utilisent ces données plus spécifiquement comme <em>invocation de fonction</em>, appelant la fonction nommée et transmettant tous les arguments codés à la fonction.</p>
</div>
<div class="paragraph data-line-327">
<p>La charge utile de données envoyée à un contrat compatible ABI (dont vous pouvez supposer que tous les contrats le sont) est un codage hexadécimal de :</p>
</div>
<div class="dlist data-line-329">
<dl>
<dt class="hdlist1">Un sélecteur de fonction</dt>
<dd>
<p>Les 4 premiers octets du hachage Keccak-256 du prototype de la fonction. Cela permet au contrat d&#39;identifier sans ambiguïté la fonction que vous souhaitez invoquer.</p>
</dd>
<dt class="hdlist1">Les arguments de la fonction</dt>
<dd>
<p>Les arguments de la fonction, encodés selon les règles des différents types élémentaires définies dans la spécification ABI.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-333">
<p>Dans <a href="#solidity_faucet_example">Faucet.sol: Un contrat Solidity mettant en place un robinet</a>, nous avons défini une fonction pour les retraits :</p>
</div>
<div id="withdraw_function_src" class="listingblock data-line-337">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function withdraw(uint withdraw_amount) public {</code></pre>
</div>
</div>
<div class="paragraph data-line-341">
<p>Le <em>prototype</em> d&#39;une fonction est défini comme la chaîne contenant le nom de la fonction, suivi des types de données de chacun de ses arguments, entre parenthèses et séparés par des virgules. Le nom de la fonction ici est withdraw et il prend un seul argument qui est un uint (qui est un alias pour uint256), donc le prototype de withdraw serait :</p>
</div>
<div class="listingblock data-line-344">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">withdraw(uint256)</code></pre>
</div>
</div>
<div class="paragraph data-line-348">
<p>Calculons le hachage Keccak-256 de cette chaîne :</p>
</div>
<pre data-type="programlisting">
> <strong>web3.utils.sha3("withdraw(uint256)");</strong>
'0x2e1a7d4d13322e7b96f9a57413e1525c250fb7a9021cf91d1540d5b69f16a49f'

</pre>
<div class="paragraph data-line-358">
<p>Les 4 premiers octets du hachage sont 0x2e1a7d4d. C&#39;est notre valeur &quot;sélecteur de fonction&quot;, qui indiquera au contrat quelle fonction nous voulons appeler.</p>
</div>
<div class="paragraph data-line-360">
<p>Ensuite, calculons une valeur à passer comme argument withdraw_amount. Nous voulons retirer 0,01 ether. Encodons cela en un entier 256 bits non signé gros-boutiste hexa-sérialisé, libellé en wei :</p>
</div>
<pre data-type="programlisting">
> <strong>withdraw_amount = web3.utils.toWei(0.01, "ether");</strong>
'10000000000000000'
> <strong>withdraw_amount_hex = web3.utils.toHex(withdraw_amount);</strong>
'0x2386f26fc10000'

</pre>
<div class="paragraph data-line-372">
<p>Maintenant, nous ajoutons le sélecteur de fonction au montant (rembourré à 32 octets) :</p>
</div>
<div class="listingblock data-line-374">
<div class="content">
<pre>2e1a7d4d000000000000000000000000000000000000000000000000002386f26fc10000</pre>
</div>
</div>
<div class="paragraph data-line-378">
<p>C&#39;est la charge utile de données pour notre transaction, appelant la fonction withdraw et demandant 0,01 éther comme withdraw_amount.</p>
</div>
</div>
</div>
<div class="sect2 data-line-381">
<h3 id="contract_reg">Transaction spéciale : création de contrat</h3>
<div class="paragraph data-line-383">
<p>Un cas particulier que nous devrions mentionner est une transaction qui <em>crée un nouveau contrat</em> sur la chaîne de blocs, le déployant pour une utilisation future. Les transactions de création de contrat sont envoyées à une adresse de destination spéciale appelée <em>adresse zéro</em> ; le champ to dans une transaction d&#39;enregistrement de contrat contient l&#39;adresse 0x0. Cette adresse ne représente ni un EOA (il n&#39;y a pas de paire de clés privée-publique correspondante) ni un contrat. Il ne peut jamais dépenser d&#39;ether ou initier une transaction. Il n&#39;est utilisé que comme destination, avec la signification spéciale &quot;créer ce contrat&quot;.</p>
</div>
<div class="paragraph data-line-385">
<p>Alors que l&#39;adresse zéro est destinée uniquement à la création de contrats, elle reçoit parfois des paiements de différentes adresses. Il y a deux explications à cela : soit c&#39;est par accident, entraînant la perte d&#39;éther, soit c&#39;est une <em>brûlure d&#39;ether</em> intentionnelle (détruisant délibérément l&#39;ether en l&#39;envoyant à une adresse d&#39;où il ne peut jamais être dépensé). Cependant, si vous souhaitez effectuer une brûlure intentionnelle d&#39;ether, vous devez indiquer clairement votre intention au réseau et utiliser à la place l&#39;adresse de brpulure spécialement désignée :</p>
</div>
<div id="burn_address" class="listingblock data-line-388">
<div class="content">
<pre>0x000000000000000000000000000000000000dEaD</pre>
</div>
</div>
<div class="admonitionblock warning data-line-393">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-394">
<p>Tout ether envoyé à l&#39;adresse de brûlure désignée deviendra inutilisable et sera perdu à jamais.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-397">
<p>Une transaction de création de contrat ne doit contenir qu&#39;une charge utile de données contenant le bytecode compilé qui créera le contrat. Le seul effet de cette transaction est de créer le contrat. Vous pouvez inclure un montant en ether dans le champ value si vous souhaitez configurer le nouveau contrat avec un solde de départ, mais cela est entièrement facultatif. Si vous envoyez une valeur (ether) à l&#39;adresse de création de contrat sans charge utile de données (pas de contrat), l&#39;effet est le même que l&#39;envoi à une adresse de brûlure : il n&#39;y a pas de contrat à créditer, donc l&#39;ether est perdu.</p>
</div>
<div class="paragraph data-line-399">
<p>Par exemple, nous pouvons créer le contrat <em>Faucet.sol</em> utilisé dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a> en créant manuellement une transaction à l&#39;adresse zéro avec le contrat dans la charge utile des données. Le contrat doit être compilé dans une représentation en bytecode. Cela peut être fait avec le compilateur Solidity :</p>
</div>
<pre data-type="programlisting" class="pagebreak-before">
$ <strong>solc --bin Faucet.sol</strong>

Binary:
6060604052341561000f57600080fd5b60e58061001d6000396000f30060606040526004361060...

</pre>
<div class="paragraph data-line-411">
<p>Les mêmes informations peuvent également être obtenues à partir du compilateur en ligne Remix.</p>
</div>
<div class="paragraph data-line-413">
<p>Nous pouvons maintenant créer la transaction :</p>
</div>
<pre data-type="programlisting">
> <strong>src = web3.eth.accounts[0];</strong>
> <strong>faucet_code = \
  "0x6060604052341561000f57600080fd5b60e58061001d6000396000f300606...f0029";</strong>
> <strong>web3.eth.sendTransaction({from: src, to: 0, data: faucet_code, \
  gas: 113558, gasPrice: 200000000000});</strong>

"0x7bcc327ae5d369f75b98c0d59037eec41d44dfae75447fd753d9f2db9439124b"

</pre>
<div class="paragraph data-line-428">
<p>Il est recommandé de toujours spécifier un paramètre to, même dans le cas d&#39;une création de contrat sans adresse, car le coût d&#39;envoyer accidentellement votre ether à 0x0 et de le perdre pour toujours est trop élevé. Vous devez également spécifier un gasPrice et un gasLimit.</p>
</div>
<div class="paragraph data-line-430">
<p>Une fois le contrat extrait, nous pouvons le voir sur l&#39;explorateur de blocs Etherscan, comme indiqué dans <a href="#publish_contract_from_web3">Etherscan montrant le contrat miné avec succès</a>.</p>
</div>
<div id="publish_contract_from_web3" class="imageblock data-line-434">
<div class="content">
<img src="images/contract_published.png" alt="&quot;Etherscan montrant le contrat extrait avec succès&quot;">
</div>
<div class="title">Figure 35. Etherscan montrant le contrat miné avec succès</div>
</div>
<div class="paragraph data-line-436">
<p>Nous pouvons regarder le reçu de la transaction pour obtenir des informations sur le contrat :</p>
</div>
<pre data-type="programlisting">
> <strong>web3.eth.getTransactionReceipt( \
  "0x7bcc327ae5d369f75b98c0d59037eec41d44dfae75447fd753d9f2db9439124b");</strong>

{
  blockHash: "0x6fa7d8bf982490de6246875deb2c21e5f3665b4422089c060138fc3907a95bb2",
  blockNumber: 3105256,
  contractAddress: "0xb226270965b43373e98ffc6e2c7693c17e2cf40b",
  cumulativeGasUsed: 113558,
  from: "0x2a966a87db5913c1b22a59b0d8a11cc51c167a89",
  gasUsed: 113558,
  logs: [],
  logsBloom: \
    "0x00000000000000000000000000000000000000000000000000...00000",
  status: "0x1",
  to: null,
  transactionHash: \
    "0x7bcc327ae5d369f75b98c0d59037eec41d44dfae75447fd753d9f2db9439124b",
  transactionIndex: 0
}

</pre>
<div class="paragraph data-line-463">
<p>Cela inclut l&#39;adresse du contrat, que nous pouvons utiliser pour envoyer et recevoir des fonds du contrat, comme indiqué dans la section précédente :</p>
</div>
<pre data-type="programlisting">
> <strong>contract_address = "0xb226270965b43373e98ffc6e2c7693c17e2cf40b"</strong>
> <strong>web3.eth.sendTransaction({from: src, to: contract_address, \
  value: web3.utils.toWei(0.1, "ether"), data: ""});</strong>

"0x6ebf2e1fe95cc9c1fe2e1a0dc45678ccd127d374fdf145c5c8e6cd4ea2e6ca9f"

> <strong>web3.eth.sendTransaction({from: src, to: contract_address, value: 0, data: \
  "0x2e1a7d4d000000000000000000000000000000000000000000000000002386f26fc10000"});</strong>

"0x59836029e7ce43e92daf84313816ca31420a76a9a571b69e31ec4bf4b37cd16e"

</pre>
<div class="paragraph data-line-481">
<p>Après un certain temps, les deux transactions sont visibles sur Etherscan, comme indiqué dans <a href="#publish_contract_transactions">Etherscan montrant les transactions d&#39;envoi et de réception de fonds</a>.</p>
</div>
<div id="publish_contract_transactions" class="imageblock data-line-485">
<div class="content">
<img src="images/published_contract_transactions.png" alt="&quot;Etherscan affichant les transactions d&#39;envoi et de réception de fonds&quot;">
</div>
<div class="title">Figure 36. Etherscan montrant les transactions d&#39;envoi et de réception de fonds</div>
</div>
</div>
<div class="sect2 data-line-489">
<h3 id="digital_sign">Signatures numériques</h3>
<div class="paragraph data-line-491">
<p>Jusqu&#39;à présent, nous n&#39;avons pas approfondi les détails sur les signatures numériques. Dans cette section, nous examinons le fonctionnement des signatures numériques et comment elles peuvent être utilisées pour présenter une preuve de propriété d&#39;une clé privée sans révéler cette clé privée.</p>
</div>
<div class="sect3 data-line-494">
<h4 id="ecdsa">L&#39;algorithme de signature numérique à courbe elliptique</h4>
<div class="paragraph data-line-496">
<p>L&#39;algorithme de signature numérique utilisé dans Ethereum est l&#39;_Elliptic Curve Digital Signature Algorithm_ ( ECDSA). Il est basé sur des paires de clés privées-publiques à courbe elliptique, comme décrit dans <a href="#elliptic_curve">La cryptographie à courbe elliptique expliquée</a>.</p>
</div>
<div class="paragraph data-line-498">
<p>Une signature numérique sert trois objectifs dans Ethereum (voir l&#39;encadré suivant). Premièrement, la signature prouve que le propriétaire de la clé privée, qui est implicitement le propriétaire d&#39;un compte Ethereum, a <em>autorisé</em> la dépense d&#39;ether ou l&#39;exécution d&#39;un contrat. Deuxièmement, il garantit la <em>non-répudiation</em> : la preuve de l&#39;autorisation est indéniable. Troisièmement, la signature prouve que les données de transaction n&#39;ont pas été et <em>ne peuvent pas être modifiées</em> par quiconque après la signature de la transaction.</p>
</div>
<div id="digital_signature_definition" class="sidebarblock data-line-502">
<div class="content">
<div class="title">Définition de Wikipedia d&#39;une signature numérique</div>
<div class="paragraph data-line-503">
<p>Une <em>signature numérique</em> est un schéma mathématique permettant de présenter l&#39;authenticité de messages ou de documents numériques. Une signature numérique valide donne au destinataire des raisons de croire que le message a été créé par un expéditeur connu (authentification), que l&#39;expéditeur ne peut pas nier avoir envoyé le message (non-répudiation) et que le message n&#39;a pas été altéré en transit (intégrité) .</p>
</div>
<div class="paragraph data-line-505">
<p><em>Source : <a href="https://en.wikipedia.org/wiki/Digital_signature" class="undefined" data-href="https://en.wikipedia.org/wiki/Digital_signature">https://en.wikipedia.org/wiki/Digital_signature</a></em></p>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-509">
<h4 id="digital_sign_work">Comment fonctionnent les signatures numériques</h4>
<div class="paragraph data-line-511">
<p>Une signature numérique est un schéma mathématique composé de deux parties. La première partie est un algorithme de création d&#39;une signature, à l&#39;aide d&#39;une clé privée (la clé de signature), à partir d&#39;un message (qui dans notre cas est la transaction). La deuxième partie est un algorithme qui permet à quiconque de vérifier la signature en utilisant uniquement le message et une clé publique.</p>
</div>
<div class="sect4 data-line-514">
<h5 id="digital_sign_create">Création d&#39;une signature numérique</h5>
<div class="paragraph data-line-516">
<p>Dans l&#39;implémentation ECDSA d&#39;Ethereum, le &quot;message&quot; signé est la transaction , ou plus précisément, le hachage Keccak-256 des données encodées RLP de la transaction. La clé de signature est la clé privée de l&#39;EOA. Le résultat est la signature :</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mrow>
      <mi>S</mi>
      <mi>i</mi>
      <mi>g</mi>
    </mrow>
    <mo>=</mo>
    <msub><mi>F</mi> <mrow><mi>s</mi><mi>i</mi><mi>g</mi></mrow> </msub>
    <mrow>
      <mo>(</mo>
      <msub><mi>F</mi> <mrow><mi>k</mi><mi>e</mi><mi>c</mi><mi>c</mi><mi>a</mi><mi>k</mi><mn>256</mn></mrow> </msub>
      <mrow>
        <mo>(</mo>
        <mi>m</mi>
        <mo>)</mo>
      </mrow>
      <mo>,</mo>
      <mi>k</mi>
      <mo>)</mo>
    </mrow>
  </mrow>
</math>
</div>
<div class="paragraph data-line-546">
<p>où:</p>
</div>
<div class="ulist data-line-548">
<ul>
<li class="data-line-548">
<p><em>k</em> est la clé privée de signature.</p>
</li>
<li class="data-line-549">
<p><em>m</em> est la transaction codée RLP.</p>
</li>
<li class="data-line-550">
<p><em>F</em><sub><em>keccak256</em></sub> est la fonction de hachage Keccak-256.</p>
</li>
<li class="data-line-551">
<p><em>F</em><sub><em>sig</em></sub> est l&#39;algorithme de signature.</p>
</li>
<li class="data-line-552">
<p><em>Sig</em> est la signature résultante.</p>
</li>
</ul>
</div>
<div id="sign_function" class="paragraph data-line-555">
<p>La fonction <em>F</em><sub><em>sig</em></sub> produit une signature <em>Sig</em> composée de deux valeurs, communément appelées <em>r</em> et <em>s</em> :</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mrow>
      <mi>S</mi>
      <mi>i</mi>
      <mi>g</mi>
    </mrow>
    <mo>=</mo>
    <mo>(</mo>
    <mi>r</mi>
    <mo>,</mo>
    <mi>s</mi>
    <mo>)</mo>
  </mrow>
</math>
</div>
</div>
</div>
<div class="sect3 data-line-578">
<h4 id="verify_sign">Vérification de la signature</h4>
<div class="paragraph data-line-580">
<p>Pour vérifier la signature, il faut avoir la signature (<em>r</em> et <em>s</em>), la transaction sérialisée et la clé publique qui correspond à la clé privée utilisée pour créer la signature. Essentiellement, la vérification d&#39;une signature signifie que &quot;seul le propriétaire de la clé privée qui a généré cette clé publique pourrait avoir produit cette signature sur cette transaction&quot;.</p>
</div>
<div class="paragraph data-line-582">
<p>L&#39;algorithme de vérification de signature prend le message (c&#39;est-à-dire, un hachage de la transaction pour notre usage), la clé publique du signataire et la signature (valeurs <em>r</em> et <em>s</em>), et renvoie true si la signature est valide pour ce message et la clé publique .</p>
</div>
</div>
<div class="sect3 data-line-585">
<h4 id="ecdsa_math">Mathématiques ECDSA</h4>
<div class="paragraph data-line-587">
<p>Comme mentionné précédemment, les signatures sont créées par une fonction mathématique <em>F</em><sub><em>sig</em></sub> qui produit une signature composée de deux valeurs, <em>r</em> et <em>s</em>. Dans cette section, nous examinons la fonction <em>F</em><sub><em>sig</em></sub> plus en détail.</p>
</div>
<div class="paragraph data-line-589">
<p>L&#39;algorithme de signature génère d&#39;abord une clé privée <em>éphémère</em> (temporaire) de manière cryptographiquement sécurisée. Cette clé temporaire est utilisée dans le calcul des valeurs <em>r</em> et <em>s</em> pour s&#39;assurer que la clé privée réelle de l&#39;expéditeur ne peut pas être calculée par des attaquants qui surveillent les transactions signées sur le réseau Ethereum.</p>
</div>
<div class="paragraph data-line-591">
<p>Comme nous le savons depuis <a href="#pubkey">Clés publiques</a>, la clé privée éphémère est utilisée pour dériver la clé publique (éphémère) correspondante, nous avons donc :</p>
</div>
<div class="ulist data-line-593">
<ul>
<li class="data-line-593">
<p>Un nombre aléatoire cryptographiquement sécurisé <em>q</em>, qui est utilisé comme clé privée éphémère</p>
</li>
<li class="data-line-594">
<p>La clé publique éphémère correspondante <em>Q</em>, générée à partir de <em>q</em> et du point générateur de courbe elliptique <em>G</em></p>
</li>
</ul>
</div>
<div class="paragraph data-line-596">
<p>La valeur <em>r</em> de la signature numérique est alors la coordonnée <em>x</em> de la clé publique éphémère <em>Q</em>.</p>
</div>
<div class="paragraph data-line-598">
<p>A partir de là, l&#39;algorithme calcule la valeur <em>s</em> de la signature, telle que :</p>
</div>
<ul class="simplelist">
<li><em>s</em> &#8801; <em>q</em><sup>-1</sup> (<em>Keccak256</em>(<em>m</em>) + <em>r</em> * <em>k</em>)  &nbsp;  &nbsp; (<em>mod p</em>)</li>
</ul>
<div class="paragraph data-line-606">
<p>où:</p>
</div>
<div class="ulist data-line-608">
<ul>
<li class="data-line-608">
<p><em>q</em> est la clé privée éphémère.</p>
</li>
<li class="data-line-609">
<p><em>r</em> est la coordonnée <em>x</em> de la clé publique éphémère.</p>
</li>
<li class="data-line-610">
<p><em>k</em> est la clé privée de signature (propriétaire EOA).</p>
</li>
<li class="data-line-611">
<p><em>m</em> est les données de transaction.</p>
</li>
<li class="data-line-612">
<p><em>p</em> est l&#39;ordre premier de la courbe elliptique.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-614">
<p>La vérification est l&#39;inverse de la fonction de génération de signature, utilisant les valeurs <em>r</em> et <em>s</em> et la clé publique de l&#39;expéditeur pour calculer une valeur <em>Q</em>, qui est un point sur la courbe elliptique (la clé publique éphémère utilisée dans la création de la signature). Les étapes sont les suivantes:</p>
</div>
<div class="olist arabic data-line-616">
<ol class="arabic">
<li class="data-line-616">
<p>Vérifiez que toutes les entrées sont correctement formées</p>
</li>
<li class="data-line-617">
<p>Calculez <em>w</em> = <em>s</em><sup>-1</sup> <em>mod p</em></p>
</li>
<li class="data-line-618">
<p>Calculez <em>u<sub>1</sub></em> = <em>Keccak256</em>(<em>m</em>) * <em>w</em> <em>mod p</em></p>
</li>
<li class="data-line-619">
<p>Calculez <em>u<sub>2</sub></em> = <em>r</em> * <em>w</em> <em>mod p</em></p>
</li>
<li class="data-line-620">
<p>Enfin, calculez le point sur la courbe elliptique <em>Q</em> ≡ <em>u<sub>1</sub></em> * <em>G</em> + <em>u<sub>2</sub></em> * <em>K</em> &#160; &#160; (<em>mod p</em>)</p>
</li>
</ol>
</div>
<div class="paragraph data-line-622">
<p>où:</p>
</div>
<div class="ulist data-line-624">
<ul>
<li class="data-line-624">
<p><em>r</em> et <em>s</em> sont les valeurs de signature.</p>
</li>
<li class="data-line-625">
<p><em>K</em> est la clé publique du signataire (propriétaire de l&#39;EOA).</p>
</li>
<li class="data-line-626">
<p><em>m</em> est les données de transaction qui ont été signées.</p>
</li>
<li class="data-line-627">
<p><em>G</em> est le point générateur de la courbe elliptique.</p>
</li>
<li class="data-line-628">
<p><em>p</em> est l&#39;ordre premier de la courbe elliptique.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-630">
<p>Si la coordonnée <em>x</em> du point calculé <em>Q</em> est égale à <em>r</em>, alors le vérificateur peut conclure que la signature est valide.</p>
</div>
<div class="paragraph data-line-632">
<p>Notez qu&#39;en vérifiant la signature, la clé privée n&#39;est ni connue ni révélée.</p>
</div>
<div class="admonitionblock tip data-line-635">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-636">
<p>ECDSA est nécessairement un calcul assez compliqué; une explication complète est au-delà de la portée de ce livre. Un certain nombre d&#39;excellents guides en ligne vous guident étape par étape : recherchez &quot;ECDSA expliqué&quot; ou essayez celui-ci : <a href="http://bit.ly/2r0HhGB" class="undefined" data-href="http://bit.ly/2r0HhGB">http://bit.ly/2r0HhGB</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-640">
<h4 id="tx_sign">Signature de transaction en pratique</h4>
<div class="paragraph data-line-642">
<p>Pour produire une transaction valide, l&#39;expéditeur doit signer numériquement le message, en utilisant l&#39;algorithme de signature numérique à courbe elliptique. Lorsque nous disons &quot;signer la transaction&quot;, nous entendons en fait &quot;signer le hachage Keccak-256 des données de transaction sérialisées RLP&quot;. La signature est appliquée au hachage des données de transaction, pas à la transaction elle-même.</p>
</div>
<div class="paragraph data-line-644">
<p>Pour signer une transaction dans Ethereum, l&#39;initiateur doit :</p>
</div>
<div class="olist arabic data-line-646">
<ol class="arabic">
<li class="data-line-646">
<p>Créez une structure de données de transaction contenant neuf champs : nonce, gasPrice, gasLimit, to, value, data, chainID, 0, 0.</p>
</li>
<li class="data-line-647">
<p>Produire un message sérialisé codé RLP de la structure de données de transaction.</p>
</li>
<li class="data-line-648">
<p>Calculez le hachage Keccak-256 de ce message sérialisé.</p>
</li>
<li class="data-line-649">
<p>Calculez la signature ECDSA, en signant le hachage avec la clé privée de l&#39;EOA d&#39;origine.</p>
</li>
<li class="data-line-650">
<p>Ajoutez les valeurs v, r et s calculées de la signature ECDSA à la transaction.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-652">
<p>La variable de signature spéciale v indique deux choses : l&#39;ID (identifiant) de chaîne et l&#39;identifiant de récupération pour aider la fonction ECDSArecover à vérifier la signature. Il est calculé comme l&#39;un des 27 ou 28, ou comme l&#39;ID de chaîne doublé plus 35 ou 36. Pour plus d&#39;informations sur l&#39;ID de chaîne, voir <a href="#raw_tx_eip155">Création de transactions brutes avec EIP-155</a>. L&#39;identifiant de récupération (27 ou 28 dans les signatures &quot;à l&#39;ancienne&quot;, ou 35 ou 36 dans les transactions complètes de type Spurious Dragon) est utilisé pour indiquer la parité du composant y de la clé publique (voir <a href="#sign_prefix">La valeur du préfixe de signature (v) et la récupération de la clé publique</a> pour plus de détails).</p>
</div>
<div class="admonitionblock note data-line-656">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-657">
<p> Au bloc #2 675 000, Ethereum a implémenté l&#8217;embranchement divergent &quot;Spurious Dragon&quot;, qui, entre autres changements, a introduit un nouveau schéma de signature qui inclut la protection contre la relecture des transactions (empêchant les transactions destinées à un réseau d&#39;être rejouées sur autres). Ce nouveau schéma de signature est spécifié dans EIP-155. Ce changement affecte la forme de la transaction et sa signature, il faut donc prêter attention à la première des trois variables de signature (c&#39;est-à-dire v), qui prend l&#39;une des deux formes et indique les champs de données inclus dans le message de transaction haché .</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-662">
<h4 id="raw_tx">Création et signature de transactions brutes</h4>
<div class="paragraph data-line-664">
<p>Dans cette section, nous allons créer une transaction brute et la signer, en utilisant la bibliothèque ethereumjs-tx, qui peut être installé avec npm. Cela démontre les fonctions qui seraient normalement utilisées dans un portefeuille ou une application qui signe des transactions au nom d&#39;un utilisateur. Le code source de cet exemple se trouve dans le fichier <em>raw_tx_demo.js</em> dans le <a href="http://bit.ly/2yI2GL3" data-href="http://bit.ly/2yI2GL3">référentiel GitHub</a> du livre :</p>
</div>
<div id="raw_tx_demo_source" class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Load requirements first:
//
// npm init
// npm install ethereumjs-tx
//
// Run with: $ node raw_tx_demo.js
const ethTx = require('ethereumjs-tx').Transaction;

const txData = {
  nonce: '0x0',
  gasPrice: '0x09184e72a000',
  gasLimit: '0x30000',
  to: '0xb0920c523d582040f2bcb1bd7fb1c7c1ecebdb34',
  value: '0x00',
  data: '',
  v: "0x1c", // Ethereum mainnet chainID
  r: 0,
  s: 0 
};

tx = new ethTx(txData);
console.log('RLP-Encoded Tx: 0x' + tx.serialize().toString('hex'))

txHash = tx.hash(); // This step encodes into RLP and calculates the hash
console.log('Tx Hash: 0x' + txHash.toString('hex'))

// Sign transaction
const privKey = Buffer.from(
    '91c8360c4cb4b5fac45513a7213f31d4e4a7bfcb4630e9fbf074f42a203ac0b9', 'hex');
tx.sign(privKey);

serializedTx = tx.serialize();
rawTx = 'Signed Raw Transaction: 0x' + serializedTx.toString('hex');
console.log(rawTx)</code></pre>
</div>
</div>
<div id="raw_tx_demo_run" class="paragraph data-line-673">
<p>L&#39;exécution de l&#39;exemple de code produit les résultats suivants :</p>
</div>
<pre data-type="programlisting">
$ <strong>node raw_tx_demo.js</strong>
RLP-Encoded Tx: 0xe6808609184e72a0008303000094b0920c523d582040f2bcb1bd7fb1c7c1...
Tx Hash: 0xaa7f03f9f4e52fcf69f836a6d2bbc7706580adce0a068ff6525ba337218e6992
Signed Raw Transaction: 0xf866808609184e72a0008303000094b0920c523d582040f2bcb1...

</pre>
</div>
<div class="sect3 data-line-686">
<h4 id="raw_tx_eip155">Création de transactions brutes avec EIP-155</h4>
<div class="paragraph data-line-688">
<p>La norme EIP-155 &quot;Simple Replay Attack Protection&quot; spécifie un codage de transaction protégé contre les attaques de relecture, qui inclut un <em>identifiant de chaîne</em> dans les données de transaction, avant la signature. Cela garantit que les transactions créées pour une chaîne de blocs (par exemple, le réseau principal Ethereum) sont invalides sur une autre chaîne de blocs (par exemple, Ethereum Classic ou le réseau de test Ropsten). Par conséquent, les transactions diffusées sur un réseau ne peuvent pas être <em>rejouées</em> sur un autre, d&#39;où le nom de la norme.</p>
</div>
<div class="paragraph data-line-690">
<p>EIP-155 ajoute trois champs aux six principaux champs de la structure de données de transaction, à savoir l&#39;identifiant de chaîne, 0 et 0. Ces trois champs sont ajoutés aux données de transaction <em>avant qu&#39;elles ne soient encodées et hachées</em>. Ils modifient donc le hash de la transaction, auquel la signature est ensuite appliquée. En incluant l&#39;identifiant de la chaîne dans les données à signer, la signature de la transaction empêche tout changement, car la signature est invalidée si l&#39;identifiant de la chaîne est modifié. Par conséquent, EIP-155 rend impossible la relecture d&#39;une transaction sur une autre chaîne, car la validité de la signature dépend de l&#39;identifiant de la chaîne.</p>
</div>
<div class="paragraph data-line-693">
<p>Le champ d&#39;identifiant de chaîne prend une valeur en fonction du réseau auquel la transaction est destinée, comme indiqué dans <a href="#chain_id_table">Identifiants de chaîne</a>.</p>
</div>
<table id="chain_id_table" class="tableblock frame-all grid-all stretch data-line-698">
<caption class="title">Table 7. Identifiants de chaîne</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Chaîne</th>
<th class="tableblock halign-left valign-top">ID de chaîne</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mainnet Ethereum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Morden (obsolète), Étendue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ropsten</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rinkeby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mainnet Rootstock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testnet Rootstock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kovan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">42</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mainnet Ethereum Classic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">61</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testnet Ethereum Classic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">62</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testets privés Geth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1337</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-712">
<p>La structure de transaction résultante est codée RLP, hachée et signée. L&#39;algorithme de signature est légèrement modifié pour encoder également l&#39;identifiant de la chaîne dans le préfixe v.</p>
</div>
<div class="paragraph data-line-714">
<p>Pour plus de détails, voir <a href="http://bit.ly/2CQUgne" data-href="http://bit.ly/2CQUgne">la spécification EIP-155</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-717">
<h3 id="sign_prefix">La valeur du préfixe de signature (v) et la récupération de la clé publique</h3>
<div class="paragraph data-line-719">
<p>Comme mentionné dans <a href="#tx_struct">La structure d&#39;une transaction</a>, le message de transaction n&#39;inclut pas de champ &quot;from&quot;. En effet, la clé publique de l&#39;expéditeur peut être calculée directement à partir de la signature ECDSA. Une fois que vous avez la clé publique, vous pouvez facilement calculer l&#39;adresse. Le processus de récupération de la clé publique du signataire est appelé <em>récupération de la clé publique</em>.</p>
</div>
<div class="paragraph data-line-721">
<p>Étant donné les valeurs r et s qui ont été calculées dans <a href="#ecdsa_math">Mathématiques ECDSA</a>, nous pouvons calculer deux clés publiques possibles.</p>
</div>
<div class="paragraph data-line-723">
<p>Tout d&#39;abord, nous calculons deux points de courbe elliptique, <em>R</em> et <em>R</em><sup><em>&#39;</em></sup>, à partir de la coordonnée <em>x</em> r valeur qui se trouve dans la signature. Il y a deux points parce que la courbe elliptique est symétrique sur l&#39;axe des x, de sorte que pour toute valeur x il y a deux valeurs possibles qui correspondent à la courbe, une de chaque côté de l&#39;axe des x.</p>
</div>
<div class="paragraph data-line-725">
<p>À partir de r, nous calculons également <em>r</em><sup>-1</sup>, qui est l&#39;inverse multiplicatif de r.</p>
</div>
<div class="paragraph data-line-727">
<p>Enfin, nous calculons <em>z</em>, qui correspond aux <em>n</em> bits les plus bas du hachage du message, où <em>n</em> est l&#39;ordre de la courbe elliptique.</p>
</div>
<div class="paragraph data-line-729">
<p>Les deux clés publiques possibles sont alors :</p>
</div>
<ul class="simplelist">
<li><em>K</em><sub>1</sub> = <em>r</em><sup>&#x2013;1</sup> (<em>sR</em> &#x2013; <em>zG</em>)</li>
</ul>
<div class="paragraph data-line-737">
<p>et:</p>
</div>
<ul class="simplelist">
<li><em>K</em><sub>2</sub> = <em>r</em><sup>&#x2013;1</sup> (<em>sR</em><sup>'</sup> &#x2013; <em>zG</em>)</li>
</ul>
<div class="paragraph data-line-745">
<p>où:</p>
</div>
<div class="ulist data-line-747">
<ul>
<li class="data-line-747">
<p><em>K</em><sub>1</sub> et <em>K</em><sub>2</sub> sont les deux possibilités pour la clé publique du signataire.</p>
</li>
<li class="data-line-748">
<p><em>r</em><sup>-1</sup> est l&#39;inverse multiplicatif de la valeur r de la signature.</p>
</li>
<li class="data-line-749">
<p><em>s</em> est la valeur s de la signature.</p>
</li>
<li class="data-line-750">
<p><em>R</em> et <em>R</em><sup>&#39;</sup> sont les deux possibilités pour la clé publique éphémère <em>Q</em>.</p>
</li>
<li class="data-line-751">
<p><em>z</em> correspond aux <em>n</em> bits les plus bas du hachage du message.</p>
</li>
<li class="data-line-752">
<p><em>G</em> est le point générateur de la courbe elliptique.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-754">
<p>Pour rendre les choses plus efficaces, la signature de la transaction inclut une valeur de préfixe v, qui nous indique laquelle des deux valeurs <em>R</em> possibles est la clé publique éphémère. Si v est pair, alors <em>R</em> est la valeur correcte. Si v est impair, alors c&#39;est <em>R</em><sup>&#39;</sup>. De cette façon, nous devons calculer une seule valeur pour <em>R</em> et une seule valeur pour <em>K</em>.</p>
</div>
</div>
<div class="sect2 data-line-757">
<h3 id="offline_sign">Séparer la signature et la transmission (signature hors ligne)</h3>
<div class="paragraph data-line-759">
<p>Une fois qu&#39;une transaction est signée, elle est prête à être transmise au réseau Ethereum . Les trois étapes de création, de signature et de diffusion d&#39;une transaction se déroulent normalement en une seule opération, par exemple en utilisant web3.eth.sendTransaction. Cependant, comme vous l&#39;avez vu dans <a href="#raw_tx">Création et signature de transactions brutes</a>, vous pouvez créer et signer la transaction en deux étapes distinctes. Une fois que vous avez une transaction signée, vous pouvez ensuite la transmettre à l&#39;aide de web3.eth.sendSignedTransaction, qui prend une transaction codée en hexadécimal et signée et la transmet sur le réseau Ethereum.</p>
</div>
<div class="paragraph data-line-761">
<p>Pourquoi voudriez-vous séparer la signature et la transmission des transactions ? La raison la plus courante est la sécurité. L&#39;ordinateur qui signe une transaction doit avoir des clés privées déverrouillées chargées en mémoire. L&#39;ordinateur qui effectue la transmission doit être connecté à Internet (et exécuter un client Ethereum). Si ces deux fonctions sont sur un seul ordinateur, alors vous avez des clés privées sur un système en ligne, ce qui est assez dangereux. Séparer les fonctions de signature et de transmission et les exécuter sur différentes machines (sur un appareil hors ligne et en ligne, respectivement) est appelé <em>signature hors ligne</em> et est une pratique de sécurité courante.</p>
</div>
<div class="paragraph data-line-763">
<p><a href="#offline_signing">Signature hors ligne des transactions Ethereum</a> montre le processus :</p>
</div>
<div class="olist arabic data-line-765">
<ol class="arabic">
<li class="data-line-765">
<p>Créez une transaction non signée sur l&#39;ordinateur en ligne où l&#39;état actuel du compte, notamment le nonce actuel et les fonds disponibles, peut être récupéré.</p>
</li>
<li class="data-line-766">
<p>Transférez la transaction non signée vers un appareil hors ligne « isolé » pour la signature de la transaction, par exemple via un code QR ou une clé USB.</p>
</li>
<li class="data-line-767">
<p>Transmettez (retour) la transaction signée à un appareil en ligne pour diffusion sur la chaîne de blocs Ethereum, par exemple via un code QR ou une clé USB.</p>
</li>
</ol>
</div>
<div id="offline_signing" class="imageblock data-line-771">
<div class="content">
<img src="images/offline_signing.png" alt="&quot;Signature hors ligne des transactions Ethereum&quot;">
</div>
<div class="title">Figure 37. Signature hors ligne des transactions Ethereum</div>
</div>
<div class="paragraph data-line-773">
<p>Selon le niveau de sécurité dont vous avez besoin, votre ordinateur de &quot;signature hors ligne&quot; peut avoir différents degrés de séparation de l&#39;ordinateur en ligne, allant d&#39;un sous-réseau isolé et protégé par un pare-feu (en ligne mais séparé) à un système complètement hors ligne connu sous le nom de système <em>air-gapped</em> ou <em>à espacement d&#8217;air</em> . Dans un système à espacement d&#39;air, il n&#39;y a aucune connectivité réseau - l&#39;ordinateur est séparé de l&#39;environnement en ligne par un espace &quot;d&#39;air&quot;. Pour signer des transactions, vous les transférez vers et depuis l&#39;ordinateur isolé à l&#39;aide d&#39;un support de stockage de données ou (mieux) d&#39;une webcam et d&#39;un code QR. Bien sûr, cela signifie que vous devez transférer manuellement chaque transaction que vous souhaitez signer, et cela n&#39;évolue pas.</p>
</div>
<div class="paragraph data-line-775">
<p>Bien que peu d&#39;environnements puissent utiliser un système entièrement isolé, même un faible degré d&#39;isolement présente des avantages significatifs en matière de sécurité. Par exemple, un sous-réseau isolé avec un pare-feu qui n&#39;autorise qu&#39;un protocole de file d&#39;attente de messages peut offrir une surface d&#39;attaque très réduite et une sécurité bien plus élevée que la signature sur le système en ligne. De nombreuses entreprises utilisent un protocole tel que ZeroMQ (0MQ) à cette fin. Avec une telle configuration, les transactions sont sérialisées et mises en file d&#39;attente pour signature. Le protocole de mise en file d&#39;attente transmet le message sérialisé, d&#39;une manière similaire à un socket TCP, à l&#39;ordinateur signataire. L&#39;ordinateur signataire lit les transactions sérialisées à partir de la file d&#39;attente (avec précaution), applique une signature avec la clé appropriée et les place dans une file d&#39;attente sortante. La file d&#39;attente sortante transmet les transactions signées à un ordinateur avec un client Ethereum qui les retire de la file d&#39;attente et les transmet.</p>
</div>
</div>
<div class="sect2 data-line-778">
<h3 id="tx_propagation">Propagation des transactions</h3>
<div class="paragraph data-line-780">
<p>Le réseau Ethereum utilise un protocole de &quot;routage par inondation&quot;. Chaque client Ethereum agit comme un <em>nœud</em> dans un réseau <em>pair à pair (P2P)</em>, qui (idéalement) forme un réseau de <em>toile</em>. Aucun nœud de réseau n&#39;est spécial : ils agissent tous comme des pairs égaux. Nous utiliserons le terme &quot;nœud&quot; pour désigner un client Ethereum qui est connecté et participe au réseau P2P.</p>
</div>
<div class="paragraph data-line-782">
<p>La propagation de la transaction commence par la création (ou la réception hors ligne) par le nœud Ethereum d&#39;origine d&#39;une transaction signée. La transaction est validée puis transmise à tous les autres nœuds Ethereum qui sont <em>directement</em> connectés au nœud d&#39;origine. En moyenne, chaque nœud Ethereum maintient des connexions avec au moins 13 autres nœuds, appelés ses <em>voisins</em>. Chaque nœud voisin valide la transaction dès qu&#39;il la reçoit. S&#39;ils conviennent qu&#39;il est valide, ils en stockent une copie et le propagent à tous leurs voisins (sauf celui dont il provient). En conséquence, la transaction se répercute vers l&#39;extérieur à partir du nœud d&#39;origine, <em>inondant</em> à travers le réseau, jusqu&#39;à ce que tous les nœuds du réseau aient une copie de la transaction. Les nœuds peuvent filtrer les messages qu&#39;ils propagent, mais la valeur par défaut consiste à propager tous les messages de transaction valides qu&#39;ils reçoivent.</p>
</div>
<div class="paragraph data-line-784">
<p>En quelques secondes seulement, une transaction Ethereum se propage à tous les nœuds Ethereum du monde entier. Du point de vue de chaque nœud, il n&#39;est pas possible de discerner l&#39;origine de la transaction. Le voisin qui l&#39;a envoyé au nœud peut être l&#39;initiateur de la transaction ou peut l&#39;avoir reçue de l&#39;un de ses voisins. Pour pouvoir suivre l&#39;origine des transactions ou interférer avec la propagation, un attaquant devrait contrôler un pourcentage significatif de tous les nœuds. Cela fait partie de la conception de la sécurité et de la confidentialité des réseaux P2P, en particulier lorsqu&#39;elle est appliquée aux réseaux blockchain.</p>
</div>
</div>
<div class="sect2 data-line-787">
<h3 id="chain_record">Enregistrement sur la chaîne de blocs</h3>
<div class="paragraph data-line-789">
<p>Bien que tous les nœuds d&#39;Ethereum soient des pairs égaux, certains d&#39;entre eux sont exploités par des <em>mineurs</em> et alimentent des transactions et des blocs vers des <em>fermes minières</em>, qui sont des ordinateurs dotés d&#39;unités de traitement graphique (GPU) hautes performances. Les ordinateurs de minage ajoutent des transactions à un bloc candidat et tentent de trouver une <em>preuve de travail</em> qui rend le bloc candidat valide. Nous en discuterons plus en détail dans <a href="#consensus">Consensus</a>.</p>
</div>
<div class="paragraph data-line-791">
<p>Sans entrer dans trop de détails, les transactions valides seront éventuellement incluses dans un bloc de transactions et, ainsi, enregistrées dans la chaîne de blocs Ethereum. Une fois minées dans un bloc, les transactions modifient également l&#39;état du singleton Ethereum, soit en modifiant le solde d&#39;un compte (dans le cas d&#39;un simple paiement) soit en invoquant des contrats qui changent leur état interne. Ces modifications sont enregistrées parallèlement à la transaction, sous la forme d&#39;un <em>reçu</em> de transaction, qui peut également inclure des <em>événements</em>. Nous examinerons tout cela beaucoup plus en détail dans <a href="#evm_chapter">La machine virtuelle Ethereum</a>.</p>
</div>
<div class="paragraph data-line-793">
<p>Une transaction qui a terminé son parcours depuis la création jusqu&#39;à la signature par un EOA, la propagation et enfin l&#39;exploitation minière a changé l&#39;état du singleton et laissé une marque indélébile sur la chaîne de blocs.</p>
</div>
</div>
<div class="sect2 data-line-795">
<h3 id="_transactions_à_signatures_multiples_multisig">Transactions à signatures multiples (Multisig)</h3>
<div class="paragraph data-line-797">
<p>Si vous connaissez les capacités de script de Bitcoin, vous savez qu&#39;il est possible de créer un compte multisig Bitcoin qui ne peut dépenser des fonds que lorsque plusieurs parties signent la transaction (par exemple, 2 sur 2 ou 3 sur 4 signatures). Les transactions de valeur EOA de base d&#39;Ethereum ne comportent aucune disposition pour les signatures multiples ; cependant, des restrictions de signature arbitraires peuvent être appliquées par des contrats intelligents avec toutes les conditions auxquelles vous pouvez penser, pour gérer le transfert d&#39;ether et de jetons.</p>
</div>
<div class="paragraph data-line-799">
<p>Pour tirer parti de cette capacité, l&#39;ether doit être transféré dans un &quot;contrat de portefeuille&quot; programmé avec les règles de dépenses souhaitées, telles que les exigences de multisignature ou les limites de dépenses (ou des combinaisons des deux). Le contrat de portefeuille envoie ensuite les fonds lorsqu&#39;il y est invité par un EOA autorisé une fois que les conditions de dépenses ont été remplies. Par exemple, pour protéger votre ether sous une condition multisig, transférez l&#39;ether vers un contrat multisig. Chaque fois que vous souhaitez envoyer des fonds vers un autre compte, tous les utilisateurs requis devront envoyer des transactions au contrat à l&#39;aide d&#39;une application de portefeuille standard, autorisant effectivement le contrat à effectuer en finale la <span class="keep-together">transaction</span>.</p>
</div>
<div class="paragraph data-line-801">
<p>Ces contrats peuvent également être conçus pour exiger plusieurs signatures avant d&#39;exécuter du code local ou pour déclencher d&#39;autres contrats. La sécurité du système est finalement déterminée par le code de contrat multisig.</p>
</div>
<div class="paragraph data-line-803">
<p>La possibilité de mettre en œuvre des transactions multisignatures en tant que contrat intelligent démontre la flexibilité d&#39;Ethereum. Cependant, c&#39;est une épée à double tranchant, car la flexibilité supplémentaire peut entraîner des bogues qui compromettent la sécurité des schémas multisignatures. Il existe, en fait, un certain nombre de propositions pour créer une commande multisignature dans l&#39;EVM qui supprime le besoin de contrats intelligents, du moins pour les simples schémas multisignatures M-de-N. Cela équivaudrait au système multisignature de Bitcoin, qui fait partie des règles de consensus de base et s&#39;est avéré robuste et sécurisé.</p>
</div>
</div>
<div class="sect2 data-line-805">
<h3 id="_conclusion_3">Conclusion</h3>
<div class="paragraph data-line-15">
<p>Les transactions sont le point de départ de chaque activité dans le système Ethereum. Les transactions sont les &quot;entrées&quot; qui amènent la machine virtuelle Ethereum à évaluer les contrats, à mettre à jour les soldes et, plus généralement, à modifier l&#39;état de la chaîne de blocs Ethereum. Ensuite, nous travaillerons avec des contrats intelligents de manière beaucoup plus détaillée et apprendrons à programmer dans le langage orienté contrat de Solidity.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="smart_contracts_chapter">Contrats intelligents et Solidity</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Comme nous en avons discuté dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, il existe deux types de comptes différents dans Ethereum : les comptes externes (EOA) et comptes contractuels. Les EOA sont contrôlés par les utilisateurs, souvent via un logiciel tel qu&#39;une application de portefeuille externe à la plate-forme Ethereum.  contrats ») qui est exécuté par la machine virtuelle Ethereum. En bref, les EOA sont de simples comptes sans code ni stockage de données associés, tandis que les comptes contractuels ont à la fois un code et un stockage de données associés. Les EOA sont contrôlés par des transactions créées et signées cryptographiquement avec une clé privée dans le &quot;monde réel&quot; externe et indépendant du protocole, alors que les comptes contractuels n&#39;ont pas de clés privées et &quot;se contrôlent&quot; donc de la manière prédéterminée prescrite par leur code de contrat intelligent. Les deux types de comptes sont identifiés par une adresse Ethereum. Dans ce chapitre, nous discuterons des comptes contractuels et du code de programme qui les contrôle.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="smart_contracts_definition">Qu&#39;est-ce qu&#39;un contrat intelligent ?</h3>
<div class="paragraph data-line-9">
<p>Le terme <em>contrat intelligent</em> a été utilisé au fil des ans pour décrire une grande variété de choses différentes. Dans les années 1990, le cryptographe Nick Szabo a inventé le terme et l&#39;a défini comme &quot;un ensemble de promesses, spécifiées sous forme numérique, y compris des protocoles au sein que les parties exécutent sur les autres promesses. Depuis lors, le concept de contrats intelligents a évolué, notamment après l&#39;introduction de plateformes de chaîne de blocs décentralisées avec l&#39;invention de Bitcoin en 2009. Dans le contexte d&#39;Ethereum, le terme est en fait un peu impropre, étant donné que les contrats intelligents Ethereum ne sont ni des contrats intelligents ni légaux, mais le terme est resté. Dans ce livre, nous utilisons le terme «contrats intelligents» pour désigner des programmes informatiques immuables qui s&#39;exécutent de manière déterministe dans le contexte d&#39;une machine virtuelle Ethereum dans le cadre du protocole réseau Ethereum, c&#39;est-à-dire sur l&#39;ordinateur mondial Ethereum décentralisé.</p>
</div>
<div class="paragraph data-line-11">
<p>Déballons cette définition :</p>
</div>
<div class="dlist data-line-13">
<dl>
<dt class="hdlist1">Logiciels d&#39;ordinateur</dt>
<dd>
<p>Les contrats intelligents sont simplement des programmes informatiques. Le mot « contrat » n&#39;a aucune signification juridique dans ce contexte.</p>
</dd>
<dt class="hdlist1">Immuable</dt>
<dd>
<p>Une fois déployé, le code d&#39;un contrat intelligent ne peut pas changer. Contrairement aux logiciels traditionnels, la seule façon de modifier un contrat intelligent est de déployer une nouvelle instance.</p>
</dd>
<dt class="hdlist1">Déterministe</dt>
<dd>
<p>Le résultat de l&#39;exécution d&#39;un contrat intelligent est le même pour tous ceux qui l&#39;exécutent, compte tenu du contexte de la transaction qui a initié son exécution et de l&#39;état de la chaîne de blocs Ethereum au moment de l&#39;exécution.</p>
</dd>
<dt class="hdlist1">Contexte EVM</dt>
<dd>
<p>Les contrats intelligents fonctionnent avec un contexte d&#39;exécution très limité. Ils peuvent accéder à leur propre état, au contexte de la transaction qui les a appelés et à certaines informations sur les blocs les plus récents.</p>
</dd>
<dt class="hdlist1">Ordinateur mondial décentralisé</dt>
<dd>
<p>L&#39;EVM fonctionne comme une instance locale sur chaque nœud Ethereum, mais comme toutes les instances de l&#39;EVM fonctionnent sur le même état initial et produisent le même état final, le système dans son ensemble fonctionne comme un seul &quot;ordinateur mondial&quot;.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2 data-line-29">
<h3 id="smart_contract_lifecycle">Cycle de vie d&#39;un contrat intelligent</h3>
<div class="paragraph data-line-31">
<p>Les contrats intelligents sont généralement écrits dans un langage de haut niveau, tel que Solidity. Mais pour fonctionner, ils doivent être compilés dans le code intermédiaire (bytecode) de bas niveau qui s&#39;exécute dans l&#39;EVM. Une fois compilés, ils sont déployés sur la plateforme Ethereum à l&#39;aide d&#39;une transaction spéciale de <em>création de contrat</em>, qui est identifiée comme telle en étant envoyée à l&#39;adresse spéciale de création de contrat, à savoir 0x0 (voir <a href="#contract_reg">Transaction spéciale : création de contrat</a>). Chaque contrat est identifié par une adresse Ethereum, qui est dérivée de la transaction de création de contrat en fonction du compte d&#39;origine et du nonce. L&#39;adresse Ethereum d&#39;un contrat peut être utilisée dans une transaction en tant que destinataire, envoyer des fonds au contrat ou appeler l&#39;une des fonctions du contrat. Notez que, contrairement aux EOA, il n&#39;y a pas de clés associées à un compte créé pour un nouveau contrat intelligent. En tant que créateur du contrat, vous n&#39;obtenez aucun privilège spécial au niveau du protocole (bien que vous puissiez les coder explicitement dans le contrat intelligent). Vous ne recevez certainement pas la clé privée du compte de contrat, qui en fait n&#39;existe pas - nous pouvons dire que les comptes de contrat intelligents se possèdent eux-mêmes.</p>
</div>
<div class="paragraph data-line-33">
<p>Il est important de noter que les contrats <em>ne s&#39;exécutent que s&#39;ils sont appelés par une transaction</em>. Tous les contrats intelligents dans Ethereum sont exécutés, en fin de compte, en raison d&#39;une transaction initiée à partir d&#39;un EOA. Un contrat peut appeler un autre contrat qui peut appeler un autre contrat, et ainsi de suite, mais le premier contrat d&#39;une telle chaîne d&#39;exécution aura toujours été appelé par une transaction d&#39;un EOA. Les contrats ne fonctionnent jamais &quot;seuls&quot; ou &quot;en arrière-plan&quot;. Les contrats restent effectivement inactifs jusqu&#39;à ce qu&#39;une transaction déclenche l&#39;exécution, soit directement, soit indirectement dans le cadre d&#39;une chaîne d&#39;appels de contrats. Il convient également de noter que les contrats intelligents ne sont en aucun cas exécutés &quot;en parallèle&quot; - l&#39;ordinateur mondial Ethereum peut être considéré comme une machine à un seul fil d&#8217;exécution (thread).</p>
</div>
<div class="paragraph data-line-35">
<p>Les transactions sont <em>atomique</em>, quel que soit le nombre de contrats qu&#39;elles appellent ou ce que ces contrats font lorsqu&#39;ils sont appelés. Les transactions s&#39;exécutent dans leur intégralité, avec tout changement dans l&#39;état global (contrats, comptes, etc.) enregistré uniquement si toutes les exécutions se terminent avec succès. Une fin réussie signifie que le programme s&#39;est exécuté sans erreur et a atteint la fin de l&#39;exécution. Si l&#39;exécution échoue en raison d&#39;une erreur, tous ses effets (changements d&#39;état) sont &quot;annulés&quot; comme si la transaction n&#39;avait jamais été exécutée. Une transaction échouée est toujours enregistrée comme ayant été tentée, et l&#39;ether dépensé en gaz pour l&#39;exécution est déduit du compte d&#39;origine, mais cela n&#39;a par ailleurs aucun autre effet sur le contrat ou l&#39;état du compte.</p>
</div>
<div class="paragraph data-line-37">
<p>Comme mentionné précédemment, il est important de se rappeler que le code d&#39;un contrat ne peut pas être modifié. Cependant, un contrat peut être &quot;supprimé&quot;, supprimant le code et son état interne (stockage) de son adresse, laissant un compte vide. Toutes les transactions envoyées à cette adresse de compte après la suppression du contrat n&#39;entraînent aucune exécution de code, car il n&#39;y a plus de code à exécuter. Pour supprimer un contrat, vous exécutez un opcode EVM appelé SELFDESTRUCT (précédemment appelé SUICIDE). Cette opération coûte du &quot;gaz négatif&quot;, un remboursement de gaz, incitant ainsi à libérer les ressources du client du réseau à partir de la suppression de l&#39;état stocké. La suppression d&#39;un contrat de cette manière ne supprime pas l&#39;historique des transactions (passé) du contrat, car la blockchain elle-même est immuable. Il est également important de noter que la capacité SELFDESTRUCT ne sera disponible que si l&#39;auteur du contrat a programmé le contrat intelligent pour avoir cette fonctionnalité. Si le code du contrat n&#39;a pas d&#39;opcode SELFDESTRUCT, ou s&#39;il est inaccessible, le contrat intelligent ne peut pas être supprimé.</p>
</div>
</div>
<div class="sect2 data-line-40">
<h3 id="high_level_languages">Introduction aux langages de haut niveau Ethereum</h3>
<div class="paragraph data-line-42">
<p>L&#39;EVM est une machine virtuelle qui exécute une forme spéciale de code appelé <em>code intermédiaire EVM</em> ou <em>EVM bytecode</em>, analogue au processeur de votre ordinateur, qui exécute un code machine tel que x86_64. Nous examinerons le fonctionnement et le langage de l&#39;EVM de manière beaucoup plus détaillée dans <a href="#evm_chapter">La machine virtuelle Ethereum</a>. Dans cette section, nous verrons comment les contrats intelligents sont écrits pour s&#39;exécuter sur l&#39;EVM.</p>
</div>
<div class="paragraph data-line-44">
<p>Bien qu&#39;il soit possible de programmer des contrats intelligents directement en code intermédiaire, le code intermédiaire EVM est plutôt lourd et très difficile à lire et à comprendre pour les programmeurs. Au lieu de cela, la plupart des développeurs Ethereum utilisent un langage de haut niveau pour écrire des programmes et un compilateur pour les convertir en code intermédiaire.</p>
</div>
<div class="paragraph data-line-46">
<p>Bien que n&#39;importe quel langage de haut niveau puisse être adapté pour écrire des contrats intelligents, adapter un langage arbitraire pour qu&#39;il soit compilable au code intermédiaire EVM est un exercice assez fastidieux et conduirait en général à une certaine confusion. Les contrats intelligents fonctionnent dans un environnement d&#39;exécution très contraint et minimaliste (l&#39;EVM). De plus, un ensemble spécial de variables système et de fonctions spécifiques à EVM doit être disponible. En tant que tel, il est plus facile de créer un langage de contrat intelligent à partir de zéro que de créer un langage à usage général adapté à l&#39;écriture de contrats intelligents. En conséquence, un certain nombre de langages spéciaux ont émergé pour programmer des contrats intelligents. Ethereum possède plusieurs langages de ce type, ainsi que les compilateurs nécessaires pour produire un code intermédiaire exécutable EVM.</p>
</div>
<div class="paragraph data-line-48">
<p>En général, les langages de programmation peuvent être classés en deux grands paradigmes de programmation : <em>déclaratif</em> et <em>impératif</em>, également appelés respectivement <em>fonctionnel</em> et <em>procédural</em>. En programmation déclarative, nous écrivons des fonctions qui expriment la <em>logique</em> d&#39;un programme, mais pas son <em>flux</em>. La programmation déclarative est utilisée pour créer des programmes sans <em>effets secondaires</em>, ce qui signifie qu&#39;il n&#39;y a pas de changement d&#39;état en dehors d&#39;une fonction. Les langages de programmation déclaratifs incluent Haskell et SQL. La programmation impérative, en revanche, est l&#39;endroit où un programmeur écrit un ensemble de procédures qui combinent la logique et le déroulement d&#39;un programme. Les langages de programmation impératifs incluent C++ et Java. Certains langages sont « hybrides », ce qui signifie qu&#39;ils encouragent la programmation déclarative mais peuvent également être utilisés pour exprimer un paradigme de programmation impérative. Ces hybrides incluent Lisp, JavaScript et Python. En général, n&#39;importe quel langage impératif peut être utilisé pour écrire dans un paradigme déclaratif, mais il en résulte souvent un code inélégant. Par comparaison, les langages déclaratifs purs ne peuvent pas être utilisés pour écrire dans un paradigme impératif. Dans les langages purement déclaratifs, <em>il n&#39;y a pas de &quot;variables&quot;.</em></p>
</div>
<div class="paragraph data-line-50">
<p>Bien que la programmation impérative soit plus couramment utilisée par les programmeurs, il peut être très difficile d&#39;écrire des programmes qui s&#39;exécutent <em>exactement comme prévu</em>. La capacité de n&#39;importe quelle partie du programme à modifier l&#39;état de n&#39;importe quelle autre rend difficile le raisonnement sur l&#39;exécution d&#39;un programme et introduit de nombreuses opportunités de bogues. La programmation déclarative, par comparaison, permet de comprendre plus facilement le comportement d&#39;un programme : puisqu&#39;elle n&#39;a pas d&#39;effets secondaires, n&#39;importe quelle partie d&#39;un programme peut être comprise isolément.</p>
</div>
<div class="paragraph data-line-52">
<p>Dans les contrats intelligents, les bogues coûtent littéralement de l&#39;argent. Par conséquent, il est extrêmement important de rédiger des contrats intelligents sans effets indésirables. Pour ce faire, vous devez être capable de raisonner clairement sur le comportement attendu du programme. Ainsi, les langages déclaratifs jouent un rôle beaucoup plus important dans les contrats intelligents que dans les logiciels à usage général. Néanmoins, comme vous le verrez, le langage le plus utilisé pour les contrats intelligents (Solidity) est impératif. Les programmeurs, comme la plupart des humains, résistent au changement !</p>
</div>
<div class="paragraph data-line-54">
<p>Les langages de programmation de haut niveau actuellement pris en charge pour les contrats intelligents incluent (classés par âge approximatif) :</p>
</div>
<div class="dlist data-line-56">
<dl>
<dt class="hdlist1">LLL</dt>
<dd>
<p>Un langage de programmation fonctionnel (déclaratif), avec une syntaxe de type Lisp. C&#39;était le premier langage de haut niveau pour les contrats intelligents Ethereum, mais il est rarement utilisé aujourd&#39;hui.</p>
</dd>
<dt class="hdlist1">Serpent</dt>
<dd>
<p>Un langage de programmation procédural (impératif) avec une syntaxe similaire à Python. Peut également être utilisé pour écrire du code fonctionnel (déclaratif), bien qu&#39;il ne soit pas entièrement exempt d&#39;effets secondaires.</p>
</dd>
<dt class="hdlist1">Solidity</dt>
<dd>
<p>Un langage de programmation procédural (impératif) avec une syntaxe similaire à JavaScript, C++, ou Java. Le langage le plus populaire et le plus fréquemment utilisé pour les contrats intelligents Ethereum.</p>
</dd>
<dt class="hdlist1">Vyper</dt>
<dd>
<p>Un langage développé plus récemment, similaire à Serpent et encore une fois avec une syntaxe de type Python. Destiné à se rapprocher d&#39;un langage de type Python purement fonctionnel que Serpent, mais pas à remplacer Serpent.</p>
</dd>
<dt class="hdlist1">Bamboo</dt>
<dd>
<p>Un langage nouvellement développé, influencé par Erlang, avec des transitions d&#39;état explicites et sans flux itératifs (boucles). Destiné à réduire les effets secondaires et à augmenter l&#39;auditabilité. Très nouveau et en attente d&#8217;être largement adopté.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-66">
<p>Comme vous pouvez le voir, il existe de nombreux languages parmi lesquelles choisir. Cependant, de tous, Solidity est de loin le plus populaire, au point d&#39;être le langage de haut niveau <em>de facto</em> d&#39;Ethereum et même d&#39;autres chaînes de blocs de type EVM. Nous passerons la plupart de notre temps à utiliser Solidity, mais nous explorerons également certains des exemples dans d&#39;autres langages de haut niveau pour comprendre leurs différentes philosophies.</p>
</div>
</div>
<div class="sect2 data-line-69">
<h3 id="building_a_smart_contract_sec">Construire un contrat intelligent avec Solidity</h3>
<div class="paragraph data-line-71">
<p>Solidity a été créé par Dr. Gavin Wood (co-auteur de ce livre) en tant que langage explicite pour écrire des contrats intelligents avec des fonctionnalités permettant de prendre directement en charge l&#39;exécution dans l&#39;environnement décentralisé de l&#39;ordinateur mondial Ethereum. Les attributs résultants sont assez généraux et ont donc fini par être utilisés pour coder des contrats intelligents sur plusieurs autres plateformes de chaîne de blocs. Il a été développé par Christian Reitiwessner puis également par Alex Beregszaszi, Liana Husikyan, Yoichi Hirai et plusieurs anciens contributeurs principaux d&#39;Ethereum. Solidity est maintenant développé et maintenu en tant que projet indépendant <a href="https://github.com/ethereum/solidity" data-href="https://github.com/ethereum/solidity">sur GitHub</a>.</p>
</div>
<div class="paragraph data-line-73">
<p>Le &quot;produit&quot; principal du projet Solidity est le compilateur Solidity, solc, qui convertit les programmes écrits dans le langage Solidity en bytecode EVM. Le projet gère également l&#39;importante norme d&#39;interface binaire d&#39;application (ABI) pour les contrats intelligents Ethereum, que nous explorerons en détail dans ce chapitre. Chaque version du compilateur Solidity correspond à et compile une version spécifique de <span class="keep-together">language</span> de Solidity.</p>
</div>
<div class="paragraph data-line-75">
<p>Pour commencer, nous allons télécharger un exécutable binaire du compilateur Solidity. Ensuite, nous développerons et compilerons un contrat simple, à la suite de l&#39;exemple avec lequel nous avons commencé dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>.</p>
</div>
<div class="sect3 data-line-77">
<h4 id="_sélection_dune_version_de_solidity">Sélection d&#39;une version de Solidity</h4>
<div class="paragraph data-line-79">
<p>Solidity suit un modèle de versionnage appelé <a href="https://semver.org/" data-href="https://semver.org/"><em>versionnage de sémantique</em></a> (<em>semantic versioning</em>), qui spécifie les numéros de version structurés comme trois nombres séparés par des points : <em>MAJEUR.MINEUR.CORRECTIF</em>. Le numéro &quot;majeur&quot; est incrémenté pour les modifications majeures et <em>rétro-incompatibles</em>, le numéro &quot;mineur&quot; est incrémenté lorsque des fonctionnalités rétrocompatibles sont ajoutées entre les versions majeures, et le numéro &quot;correctif&quot; est incrémenté pour les corrections de bogues rétrocompatibles.</p>
</div>
<div class="paragraph data-line-81">
<p>Au moment de la rédaction, Solidity est à la version 0.4.24. Les règles de la version majeure 0, qui concerne le développement initial d&#39;un projet, sont différentes : tout peut changer à tout moment. En pratique, Solidity traite le numéro &quot;mineur&quot; comme s&#39;il s&#39;agissait de la version majeure et le numéro de &quot;correctif&quot; comme s&#39;il s&#39;agissait de la version mineure. Par conséquent, dans la version 0.4.24, 4 est considérée comme la version majeure et 24 comme la version mineure.</p>
</div>
<div class="paragraph data-line-83">
<p>La sortie de la version majeure 0.5 de Solidity est attendue de manière imminente.</p>
</div>
<div class="paragraph data-line-85">
<p>Comme vous l&#39;avez vu dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, vos programmes Solidity peuvent contenir une directive pragma qui spécifie les versions minimale et maximale de Solidity avec lesquelles il est compatible, et peut être utilisée pour compiler votre contrat.</p>
</div>
<div class="paragraph data-line-87">
<p>Étant donné que Solidity évolue rapidement, il est souvent préférable d&#39;installer la dernière version.</p>
</div>
</div>
<div class="sect3 data-line-89">
<h4 id="_télécharger_et_installer">Télécharger et installer</h4>
<div class="paragraph data-line-91">
<p>Il existe un certain nombre de méthodes que vous pouvez utiliser pour télécharger et installer Solidity, soit sous forme de version binaire, soit en compilant à partir du code source. Vous pouvez trouver des instructions détaillées dans <a href="http://bit.ly/2RrZmup" class="undefined" data-href="http://bit.ly/2RrZmup">http://bit.ly/2RrZmup</a> [la documentation de Solidity].</p>
</div>
<div class="paragraph data-line-93">
<p>Voici comment installer la dernière version binaire de Solidity sur un système d&#39;exploitation Ubuntu/Debian, en utilisant le gestionnaire de paquets apt :</p>
</div>
<pre data-type="programlisting">
$ <strong>sudo add-apt-repository ppa:ethereum/ethereum</strong>
$ <strong>sudo apt update</strong>
$ <strong>sudo apt install solc</strong>

</pre>
<div class="paragraph data-line-104">
<p>Une fois que vous avez installé solc, vérifiez la version en exécutant :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --version</strong>
solc, the solidity compiler commandline interface
Version: 0.4.24+commit.e67f0147.Linux.g++

</pre>
<div class="paragraph data-line-115">
<p>Il existe plusieurs autres façons d&#39;installer Solidity, en fonction de votre système d&#39;exploitation et de vos exigences, y compris la compilation directe à partir du code source. Pour plus d&#39;informations, consultez <a href="https://github.com/ethereum/solidity" class="undefined" data-href="https://github.com/ethereum/solidity">https://github.com/ethereum/solidity</a>.</p>
</div>
</div>
<div class="sect3 data-line-119">
<h4 id="_environnement_de_développement">Environnement de développement</h4>
<div class="paragraph data-line-121">
<p>Pour développer dans Solidity, vous pouvez utiliser n&#39;importe quel éditeur de texte et solc sur la ligne de commande. Cependant, vous constaterez peut-être que certains éditeurs de texte conçus pour le développement, tels que Emacs, Vim et Atom, offrent des fonctionnalités supplémentaires telles que la coloration syntaxique et les macros qui facilitent le développement de Solidity.</p>
</div>
<div class="paragraph data-line-123">
<p>Il existe également des environnements de développement basés sur le Web, tels que <a href="https://remix.ethereum.org/" data-href="https://remix.ethereum.org/">Remix IDE</a> et <a href="https://ethfiddle.com/" data-href="https://ethfiddle.com/">EthFiddle</a>.</p>
</div>
<div class="paragraph data-line-125">
<p>Utilisez les outils qui vous rendent productif. En fin de compte, les programmes Solidity ne sont que des fichiers texte. Bien que des éditeurs et des environnements de développement sophistiqués puissent faciliter les choses, vous n&#39;avez besoin de rien de plus qu&#39;un simple éditeur de texte, tel que nano (Linux/Unix), TextEdit (macOS) ou même NotePad (Windows). Enregistrez simplement le code source de votre programme avec une extension <em>.sol</em> et il sera reconnu par le compilateur Solidity comme un programme Solidity.</p>
</div>
</div>
<div class="sect3 data-line-127">
<h4 id="_écrire_un_programme_solidity_simple">Écrire un programme Solidity simple</h4>
<div class="paragraph data-line-129">
<p>Dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, nous avons écrit notre premier programme Solidity. Lorsque nous avons créé le contrat Faucet pour la première fois, nous avons utilisé l&#39;IDE Remix pour compiler et déployer le contrat. Dans cette section, nous allons revisiter, améliorer et embellir Faucet.</p>
</div>
<div class="paragraph data-line-131">
<p>Notre première tentative ressemblait à <a href="#original_sol_faucet">Faucet.sol : Un contrat Solidity mettant en place un robinet</a>.</p>
</div>
<div id="original_sol_faucet" class="exampleblock data-line-135">
<div class="title">Example 2. Faucet.sol : Un contrat Solidity mettant en place un robinet</div>
<div class="content">
<div class="listingblock data-line-137">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity 0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-142">
<h4 id="_compiler_avec_le_compilateur_solidity_solc">Compiler avec le compilateur Solidity (solc)</h4>
<div class="paragraph data-line-144">
<p>Maintenant, nous allons utilisez le compilateur Solidity en ligne de commande pour compiler directement notre contrat. Le compilateur Solidity solc offre une variété d&#39;options, que vous pouvez voir en passant l&#39;argument --help.</p>
</div>
<div class="paragraph data-line-146">
<p>Nous utilisons les arguments --bin et --optimize de solc pour produire un binaire optimisé de notre exemple de contrat :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --optimize --bin Faucet.sol</strong>
======= Faucet.sol:Faucet =======
Binary:
6060604052341561000f57600080fd5b60cf8061001d6000396000f300606060405260043610603e5
763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416
632e1a7d4d81146040575b005b3415604a57600080fd5b603e60043567016345785d8a00008111156
06357600080fd5b73ffffffffffffffffffffffffffffffffffffffff331681156108fc0282604051
600060405180830381858888f19350505050151560a057600080fd5b505600a165627a7a723058203
556d79355f2da19e773a9551e95f1ca7457f2b5fbbf4eacf7748ab59d2532130029

</pre>
<div class="paragraph data-line-165">
<p>Le résultat que solc produit est un binaire sérialisé hexadécimal qui peut être soumis à la chaîne de blocs Ethereum.</p>
</div>
</div>
</div>
<div class="sect2 data-line-168">
<h3 id="eth_contract_abi_sec">L&#39;ABI du contrat Ethereum</h3>
<div class="paragraph data-line-170">
<p>Dans les logiciels informatiques, une <em>interface binaire d&#39;application</em> est une interface entre deux modules de programme ; souvent, entre le système d&#39;exploitation et les programmes utilisateur. Un ABI définit la façon dont les structures de données et les fonctions sont accessibles en <em>code machine</em> ; cela ne doit pas être confondu avec une API, qui définit cet accès dans des formats de haut niveau, souvent lisibles par l&#39;homme, en tant que <em>code source</em>. L&#39;ABI est donc le principal moyen d&#39;encoder et de décoder des données dans et hors du code machine.</p>
</div>
<div class="paragraph data-line-172">
<p>Dans Ethereum, l&#39;ABI est utilisé pour coder les appels de contrat pour l&#39;EVM et pour lire les données des transactions. Le but d&#39;un ABI est de définir les fonctions du contrat qui peuvent être invoquées et de décrire comment chaque fonction acceptera les arguments et renverra son résultat.</p>
</div>
<div class="paragraph data-line-174">
<p>L&#39;ABI d&#39;un contrat est spécifié sous la forme d&#39;un tableau JSON de descriptions de fonctions (voir <a href="#solidity_functions">Fonctions</a>) et événements (voir <a href="#solidity_events">Événements</a>). Une description de fonction est un objet JSON avec les champs <code>type</code>, <code>name</code>, <code>inputs</code>, <code>outputs</code>, <code>constant</code> et <code>payable</code>. Un objet de description d&#39;événement a des champs <code>type</code>, <code>name</code>, <code>inputs</code> et <code>anonymous</code>.</p>
</div>
<div class="paragraph data-line-176">
<p>Nous utilisons le compilateur Solidity en ligne de commande solc pour produire l&#39;ABI pour notre exemple de contrat <span class="keep-together"><em>Faucet.sol</em></span> :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --abi Faucet.sol</strong>
======= Faucet.sol:Faucet =======
Contract JSON ABI
[{"constant":false,"inputs":[{"name":"withdraw_amount","type":"uint256"}], \
"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable", \
"type":"function"},{"payable":true,"stateMutability":"payable", \
"type":"fallback"}]

</pre>
<div class="paragraph data-line-191">
<p>Comme vous pouvez le voir, le compilateur produit un tableau JSON décrivant les deux fonctions définies par <em>Faucet.sol</em>. Ce JSON peut être utilisé par toute application qui souhaite accéder au contrat Faucet une fois qu&#39;il est déployé. À l&#39;aide de l&#39;ABI, une application telle qu&#39;un portefeuille ou un navigateur DApp peut construire des transactions qui appellent les fonctions dans + Faucet + avec les arguments et types d&#39;arguments corrects. Par exemple, un portefeuille saura que pour appeler la fonction withdraw, il devra fournir un argument uint256 nommé withdraw_amount. Le portefeuille pourrait inviter l&#39;utilisateur à fournir cette valeur, puis à créer une transaction qui l&#39;encode et exécute la fonction retirer.</p>
</div>
<div class="paragraph data-line-193">
<p>Tout ce qui est nécessaire pour qu&#39;une application interagisse avec un contrat est un ABI et l&#39;adresse où le contrat a été déployé.</p>
</div>
<div class="sect3 data-line-196">
<h4 id="solidity_pragma">Sélection d&#39;un compilateur Solidity et d&#39;une version linguistique</h4>
<div class="paragraph data-line-198">
<p>Comme nous l&#39;avons vu dans le code précédent, notre contrat Faucet se compile avec succès avec Solidity version 0.4.21. Et si nous avions utilisé une version différente du compilateur Solidity ? Le language est toujours en constante évolution et les choses peuvent changer de manière inattendue. Notre contrat est assez simple, mais que se passerait-il si notre programme utilisait une fonctionnalité qui n&#39;a été ajoutée que dans la version 0.4.19 de Solidity et que nous essayions de la compiler avec la version 0.4.18 ?</p>
</div>
<div class="paragraph data-line-200">
<p>Pour résoudre ces problèmes, Solidity propose une <em>directive du compilateur</em> connue sous le nom de <em>version pragma</em> qui indique au compilateur que le programme attend un compilateur (et un langage) spécifique à une version. Regardons un exemple :</p>
</div>
<div id="compiler_version" class="listingblock data-line-203">
<div class="content">
<pre>pragma solidity ^0.4.19;</pre>
</div>
</div>
<div class="paragraph data-line-207">
<p>Le compilateur Solidity lit le pragma de version et génère une erreur si la version du compilateur est incompatible avec le pragma de version. Dans ce cas, notre pragma de version indique que ce programme peut être compilé par un compilateur Solidity avec une version minimale de 0.4.19. Le symbole ^ indique, cependant, que nous autorisons la compilation avec toute <em>révision mineure</em> au-dessus de 0.4.19 ; par exemple, 0.4.20, mais pas 0.5.0 (qui est une révision majeure, pas une révision mineure). Les directives Pragma ne sont pas compilées dans le code intermédiaire EVM. Ils ne sont utilisés par le compilateur que pour vérifier la compatibilité.</p>
</div>
<div class="paragraph data-line-209">
<p>Ajoutons une directive pragma à notre contrat Faucet. Nous nommerons le nouveau fichier <span class="keep-together"><em>Faucet2.sol</em></span>, pour garder une trace de nos modifications au fur et à mesure que nous avancerons dans ces exemples en commençant par <a href="#add_pragma_to_faucet">Faucet2.sol : Ajout du pragma de version à Faucet</a>.</p>
</div>
<div id="add_pragma_to_faucet" class="exampleblock data-line-213">
<div class="title">Example 3. Faucet2.sol : Ajout du pragma de version à Faucet</div>
<div class="content">
<div class="listingblock data-line-215">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity ^0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-220">
<p>L&#39;ajout d&#39;un pragma de version est une bonne pratique, car il évite les problèmes liés aux versions incompatibles du compilateur et du langage. Nous explorerons d&#39;autres bonnes pratiques et continuerons d&#39;améliorer le contrat Faucet tout au long de ce chapitre.</p>
</div>
</div>
</div>
<div class="sect2 data-line-222">
<h3 id="_programmation_avec_solidity">Programmation avec Solidity</h3>
<div class="paragraph data-line-224">
<p>Dans cette section, nous examinerons certaines des fonctionnalités du langage Solidity. Comme nous l&#39;avons mentionné dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, notre premier exemple de contrat était très simple et également défectueux à plusieurs égards. Nous allons l&#39;améliorer progressivement ici, tout en explorant comment utiliser Solidity. Cependant, ce ne sera pas un didacticiel complet sur Solidity, car Solidity est assez complexe et évolue rapidement. Nous couvrirons les bases et vous donnerons suffisamment de bases pour pouvoir explorer le reste par vous-même. La documentation de Solidity se trouve
<a href="https://solidity.readthedocs.io/en/latest/" data-href="https://solidity.readthedocs.io/en/latest/">sur le site du projet</a>.</p>
</div>
<div class="paragraph data-line-227">
<p>====Types de données</p>
</div>
<div class="paragraph data-line-229">
<p>D&#39;abord, examinons certains des types de données de base proposés dans Solidity :</p>
</div>
<div class="dlist data-line-231">
<dl>
<dt class="hdlist1">Boolean (bool)</dt>
<dd>
<p>valeur booléenne, true ou false, avec les opérateurs logiques ! (not), &amp;amp;&amp;amp; (and), || (or), == (equal) et != (non égal).</p>
</dd>
<dt class="hdlist1">Integer (int, uint)</dt>
<dd>
<p>Entiers signés (int) et non signés (uint), déclarés par incréments de 8 bits de int8 à uint256. Sans suffixe de taille, des quantités de 256 bits sont utilisées pour correspondre à la taille de mot de l&#39;EVM.</p>
</dd>
<dt class="hdlist1">Fixed point (fixed, ufixed)</dt>
<dd>
<p>Nombres à virgule fixe, déclarés avec ( <code>u</code>) <code>fixed <em>M</em> x <em>N</em></code> où <em>M</em> est la taille en bits (incréments de 8 jusqu&#39;à 256) et <em>N</em> est le nombre de décimales après le point (jusqu&#39;à 18) ; par exemple, ufixed32x2.</p>
</dd>
<dt class="hdlist1">Address</dt>
<dd>
<p>Une adresse Ethereum de 20 octets. L&#39;objet address a de nombreuses fonctions membres utiles, les principales étant balance (renvoie le solde du compte) et <span class="keep-together"><code>transfer</code></span> (transfère l&#39;ether au compte).</p>
</dd>
<dt class="hdlist1">Byte array (fixe)</dt>
<dd>
<p>Tableaux d&#39;octets de taille fixe, déclarés avec bytes1 jusqu&#39;à bytes32.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-241">
<p>Byte array (dynamique):: tableaux d&#39;octets de taille variable, déclarés avec bytes ou string.</p>
</div>
<div class="dlist data-line-243">
<dl>
<dt class="hdlist1">Enum</dt>
<dd>
<p>Type défini par l&#39;utilisateur pour énumérer des valeurs discrètes : enum NAME {LABEL1, LABEL 2, ...}.</p>
</dd>
<dt class="hdlist1">Arrays</dt>
<dd>
<p>Un tableau de n&#39;importe quel type, fixe ou dynamique : uint32[][5] est un tableau de taille fixe de cinq tableaux dynamiques d&#39;entiers non signés.</p>
</dd>
<dt class="hdlist1">Struct</dt>
<dd>
<p>Conteneurs de données définis par l&#39;utilisateur pour regrouper les variables : <code>struct NAME {TYPE1 <span class="keep-together">VARIABLE1</span>; TYPE2 VARIABLE2; ...}</code>.</p>
</dd>
<dt class="hdlist1">Mapping</dt>
<dd>
<p>Tables de recherche de hachage pour les paires <em>key</em> =&amp;gt; <em>value</em> : mapping(KEY_TYPE =&amp;gt; VALUE_TYPE) NAME.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-251">
<p>En plus de ces types de données, Solidity propose également une variété de valeurs littérales qui peuvent être utilisées pour calculer différentes unités :</p>
</div>
<div class="dlist data-line-253">
<dl>
<dt class="hdlist1">Unités de temps</dt>
<dd>
<p>Les unités seconds, minutes, hours et days peuvent être utilisées comme suffixes, convertis en multiples de l&#39;unité de base seconds.</p>
</dd>
<dt class="hdlist1">Unités d&#39;ether</dt>
<dd>
<p>Les unités wei, finney, szabo et ether peuvent être utilisées comme suffixes, convertis en multiples de l&#39;unité de base wei.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-257">
<p>Dans notre exemple de contrat Faucet, nous avons utilisé un uint (qui est un alias pour uint256) pour la variable withdraw_amount. Nous avons également utilisé indirectement une variable address, que nous avons définie avec msg.sender. Nous utiliserons plus de ces types de données dans nos exemples dans le reste de ce chapitre.</p>
</div>
<div class="paragraph data-line-259">
<p>Utilisons l&#39;un des multiplicateurs d&#39;unités pour améliorer la lisibilité de notre exemple de contrat. Dans la fonction withdraw nous limitons le retrait maximum, en exprimant la limite en wei, l&#39;unité de base de l&#39;ether :</p>
</div>
<div class="listingblock data-line-261">
<div class="content">
<pre>require(withdraw_amount &lt;= 100000000000000000);</pre>
</div>
</div>
<div class="paragraph data-line-265">
<p>Ce n&#39;est pas très facile à lire. Nous pouvons améliorer notre code en utilisant le multiplicateur d&#39;unité ether, pour exprimer la valeur en ether au lieu de wei :</p>
</div>
<div class="listingblock data-line-267">
<div class="content">
<pre>require(withdraw_amount &lt;= 0.1 ether);</pre>
</div>
</div>
<div class="sect3 data-line-271">
<h4 id="_variables_et_fonctions_globales_prédéfinies">Variables et fonctions globales prédéfinies</h4>
<div class="paragraph data-line-273">
<p>Lorsqu&#39;un contrat est exécuté dans l&#39;EVM, il a accès à un petit ensemble d&#39;objets globaux. Ceux-ci incluent les objets block, msg et tx. De plus, Solidity expose un certain nombre d&#39;opcodes EVM en tant que fonctions prédéfinies. Dans cette section, nous examinerons les variables et les fonctions auxquelles vous pouvez accéder à partir d&#39;un contrat intelligent dans Solidity.</p>
</div>
<div class="sect4 data-line-275">
<h5 id="_contexte_dappel_de_transactionmessage">Contexte d&#39;appel de transaction/message</h5>
<div class="paragraph data-line-277">
<p>L&#39;objet msg est l&#39;appel de transaction (origine EOA) ou l&#39;appel de message (origine contrat) qui lancé l&#39;exécution de ce contrat. Il contient un certain nombre d&#39;attributs utiles :</p>
</div>
<div class="dlist data-line-279">
<dl>
<dt class="hdlist1">msg.sender</dt>
<dd>
<p>Nous avons déjà utilisé celui-ci. Il représente l&#39;adresse qui a lancé cet appel de contrat, pas nécessairement l&#39;EOA d&#39;origine qui a envoyé la transaction. Si notre contrat a été appelé directement par une transaction EOA, alors c&#39;est l&#39;adresse qui a signé la transaction, mais sinon ce sera une adresse de contrat.</p>
</dd>
<dt class="hdlist1">msg.value</dt>
<dd>
<p>La valeur d&#39;ether envoyée avec cet appel (en wei).</p>
</dd>
<dt class="hdlist1">msg.gas</dt>
<dd>
<p>La quantité de gaz restant dans l&#39;approvisionnement en gaz de cet environnement d&#39;exécution. Cela a été déprécié dans Solidity v0.4.21 et remplacé par la fonction gasleft.</p>
</dd>
<dt class="hdlist1">msg.data</dt>
<dd>
<p>La charge utile de données de cet appel dans notre contrat.</p>
</dd>
<dt class="hdlist1">msg.sig</dt>
<dd>
<p>Les quatre premiers octets de la charge utile de données, qui est le sélecteur de fonction.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note data-line-290">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-291">
<p>Chaque fois qu&#39;un contrat appelle un autre contrat, les valeurs de tous les attributs de msg changent pour refléter les informations du nouvel appelant. La seule exception à cela est la fonction delegatecall, qui exécute le code d&#39;un autre contrat/bibliothèque dans le <span class="keep-together">contexte</span> de msg.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-294">
<h5 id="_contexte_transactionnel">Contexte transactionnel</h5>
<div class="paragraph data-line-296">
<p>L&#39;objet tx fournit un moyen d&#39;accéder aux informations relatives à la transaction :</p>
</div>
<div class="dlist data-line-298">
<dl>
<dt class="hdlist1">tx.gasprice</dt>
<dd>
<p>Le prix du gaz dans la transaction d&#39;appel.</p>
</dd>
<dt class="hdlist1">tx.origin</dt>
<dd>
<p>L&#39;adresse de l&#39;EOA d&#39;origine pour cette transaction. ATTENTION : dangereux !</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-302">
<h5 id="_contexte_de_bloc">Contexte de bloc</h5>
<div class="paragraph data-line-304">
<p>L&#39;objet block contient des informations sur le bloc courant :</p>
</div>
<div class="dlist data-line-306">
<dl>
<dt class="hdlist1">block.blockhash(__blockNumber__)</dt>
<dd>
<p>Le hachage de bloc du numéro de bloc spécifié, jusqu&#39;à 256 blocs dans le passé. Obsolète et remplacé par la fonction blockhash dans Solidity v0.4.22.</p>
</dd>
<dt class="hdlist1">block.coinbase</dt>
<dd>
<p>L&#39;adresse du destinataire des frais du bloc actuel et de la récompense du bloc.</p>
</dd>
<dt class="hdlist1">block.difficulty</dt>
<dd>
<p>La difficulté (preuve de travail) du bloc actuel.</p>
</dd>
<dt class="hdlist1">block.gaslimit</dt>
<dd>
<p>La quantité maximale de gaz pouvant être dépensée pour toutes les transactions incluses dans le bloc actuel.</p>
</dd>
<dt class="hdlist1">block.number</dt>
<dd>
<p>Le numéro de bloc actuel (hauteur de la chaîne de blocs).</p>
</dd>
<dt class="hdlist1">block.timestamp</dt>
<dd>
<p>L&#39;horodatage placé dans le bloc actuel par le mineur (nombre de secondes depuis l&#39;époque Unix).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-319">
<h5 id="solidity_address_object">objet d&#39;adresse</h5>
<div class="paragraph data-line-321">
<p>Toute adresse, transmise en tant qu&#39;entrée ou extraite d&#39;un objet de contrat, possède un certain nombre d&#39;attributs et de méthodes :</p>
</div>
<div class="dlist data-line-323">
<dl>
<dt class="hdlist1">address.balance</dt>
<dd>
<p>Le solde de l&#39;adresse, en wei. Par exemple, le solde actuel du contrat est address(this).balance.</p>
</dd>
<dt class="hdlist1">address.transfer(__amount__)</dt>
<dd>
<p>Transfère le montant (en wei) à cette adresse, en levant une exception en cas d&#39;erreur. Nous avons utilisé cette fonction dans notre exemple Faucet comme méthode sur l&#39;adresse msg.sender, comme msg.sender.transfer.</p>
</dd>
<dt class="hdlist1">address.send(__amount__)</dt>
<dd>
<p>similaire à transfer, mais au lieu de lancer une exception, il renvoie false en cas d&#39;erreur. ATTENTION : vérifiez toujours la valeur de retour de send.</p>
</dd>
<dt class="hdlist1">address.call(__payload__)</dt>
<dd>
<p>fonction CALL de bas niveau — peut construire un appel de message arbitraire avec une charge utile de données. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT : dangereux : le destinataire peut (accidentellement ou par malveillance) utiliser tout votre gaz, provoquant l&#39;arrêt de votre contrat avec une exception OOG ; vérifiez toujours la valeur de retour de call.</p>
</dd>
<dt class="hdlist1">address.callcode(__payload__)</dt>
<dd>
<p>fonction CALLCODE de bas niveau, comme address(this).call(pass :[...]) mais avec le code de ce contrat remplacé par celui de address. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT : utilisation avancée uniquement !</p>
</dd>
<dt class="hdlist1">address.delegatecall()</dt>
<dd>
<p>Fonction DELEGATECALL de bas niveau, comme callcode(...) mais avec le contexte msg complet vu par le contrat actuel. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT : utilisation avancée uniquement !</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-335">
<h5 id="_fonctions_intégrées">Fonctions intégrées</h5>
<div class="paragraph data-line-337">
<p>Les autres fonctions à noter sont :</p>
</div>
<div class="dlist data-line-339">
<dl>
<dt class="hdlist1">addmod, mulmod</dt>
<dd>
<p>Pour l&#39;addition et la multiplication modulo. Par exemple, addmod(x,y,k) calcule (x + y) % k.</p>
</dd>
<dt class="hdlist1">keccak256, sha256, sha3, ripemd160</dt>
<dd>
<p>Fonctions pour calculer les hachages avec divers algorithmes de hachage standard.</p>
</dd>
<dt class="hdlist1">ecrecover</dt>
<dd>
<p>Récupère l&#39;adresse utilisée pour signer un message à partir de la signature.</p>
</dd>
<dt class="hdlist1">selfdestruct(__recipient_address__)</dt>
<dd>
<p>Supprime le contrat actuel, en envoyant tout ether restant dans le compte à l&#39;adresse du destinataire.</p>
</dd>
<dt class="hdlist1">this</dt>
<dd>
<p>L&#39;adresse du compte de contrat en cours d&#39;exécution.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-349">
<h4 id="_définition_du_contrat">Définition du contrat</h4>
<div class="paragraph data-line-351">
<p>Le type de données principal de Solidity est contract ; notre exemple Faucet définit simplement un objet <span class="keep-together"><code>contract</code></span>. Semblable à tout objet dans un langage orienté objet, le contrat est un conteneur qui inclut des données et des méthodes.</p>
</div>
<div class="paragraph data-line-353">
<p>Solidity propose deux autres types d&#39;objets qui s&#39;apparentent à un contrat :</p>
</div>
<div class="dlist data-line-355">
<dl>
<dt class="hdlist1">interface</dt>
<dd>
<p>Une définition d&#39;interface est structurée exactement comme un contrat, sauf qu&#39;aucune des fonctions n&#39;est définie, elles sont seulement déclarées. Ce type de déclaration est souvent appelé <em>stub</em> ou <em>souche</em> ; il vous indique les arguments des fonctions et les types de retour sans aucune implémentation. Une interface précise la « forme » d&#39;un contrat ; lorsqu&#39;elle est héritée, chacune des fonctions déclarées par l&#39;interface doit être définie par l&#39;enfant.</p>
</dd>
<dt class="hdlist1">library</dt>
<dd>
<p>Un contrat de bibliothèque est un contrat destiné à être déployé une seule fois et utilisé par d&#39;autres contrats, en utilisant la méthode delegatecall (voir <a href="#solidity_address_object">objet d&#39;adresse</a>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-360">
<h4 id="solidity_functions">Fonctions</h4>
<div class="paragraph data-line-362">
<p>Au sein d&#39;un contrat, on définit des fonctions qui peuvent être appelées par une transaction EOA ou un autre contrat. Dans notre exemple Faucet, nous avons deux fonctions : withdraw et la fonction (sans nom) <em>fallback</em>.</p>
</div>
<div class="paragraph data-line-364">
<p>La syntaxe que nous utilisons pour déclarer une fonction dans Solidity est la suivante :</p>
</div>
<pre data-type="programlisting">
function FunctionName([<em>parameters</em>]) {public|private|internal|external}
[pure|constant|view|payable] [<em>modifiers</em>] [returns (<em>return types</em>)]

</pre>
<div class="paragraph data-line-375">
<p>Examinons chacun de ces composants :</p>
</div>
<div class="dlist data-line-377">
<dl>
<dt class="hdlist1">FunctionName</dt>
<dd>
<p>Le nom de la fonction, qui est utilisé pour appeler la fonction dans une transaction (à partir d&#39;un EOA), à partir d&#39;un autre contrat, ou même à partir du même contrat. Une fonction dans chaque contrat peut être définie sans nom, auquel cas c&#39;est la fonction <em>fallback</em>, qui est appelée lorsqu&#39;aucune autre fonction n&#39;est nommée. La fonction de secours ne peut pas avoir d&#39;arguments ni rien renvoyer.</p>
</dd>
<dt class="hdlist1"><em>parameters</em></dt>
<dd>
<p>Après le nom, nous spécifions les arguments qui doivent être passés à la fonction, avec leurs noms et leurs types. Dans notre exemple Faucet, nous avons défini uint remove_amount comme le seul argument de la fonction <code><span class="keep-together">withdraw</span></code>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-381">
<p>Le prochain ensemble de mots clés (public, private, internal, external) spécifie la <em>visibilité</em> de la fonction :</p>
</div>
<div class="dlist data-line-383">
<dl>
<dt class="hdlist1">public</dt>
<dd>
<p>Public est la valeur par défaut ; ces fonctions peuvent être appelées par d&#39;autres contrats ou transactions EOA, ou depuis le contrat. Dans notre exemple Faucet, les deux fonctions sont définies comme publiques.</p>
</dd>
<dt class="hdlist1">external</dt>
<dd>
<p>Les fonctions externes sont comme des fonctions publiques, sauf qu&#39;elles ne peuvent pas être appelées depuis le contrat à moins d&#39;être explicitement préfixées avec le mot-clé this.</p>
</dd>
<dt class="hdlist1">interne </dt>
<dd>
<p>Les fonctions internes ne sont accessibles qu&#39;à partir du contrat - elles ne peuvent pas être appelées par un autre contrat ou une transaction EOA. Ils peuvent être appelés par des contrats dérivés (ceux qui héritent de celui-ci).</p>
</dd>
<dt class="hdlist1">private</dt>
<dd>
<p>Les fonctions privées sont comme des fonctions internes mais ne peuvent pas être appelées par les  <span class="keep-together">contrats</span> dérivés.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-391">
<p>Gardez à l&#39;esprit que les termes <em>internal</em> et <em>private</em> sont quelque peu trompeurs. Toute fonction ou donnée à l&#39;intérieur d&#39;un contrat est toujours <em>visible</em> sur la chaîne de blocs publique, ce qui signifie que n&#39;importe qui peut voir le code ou les données. Les mots clés décrits ici n&#39;affectent que comment et quand une fonction peut être <em>appelée</em>.</p>
</div>
<div class="paragraph data-line-393">
<p>Le deuxième ensemble de mots clés (pure, constant, view, payable) affecte le comportement de la fonction :</p>
</div>
<div class="dlist data-line-395">
<dl>
<dt class="hdlist1">constant ou view </dt>
<dd>
<p>Une fonction marquée comme <em>view</em> promet de ne modifier aucun état. Le terme <em>constant</em> est un alias pour la vue qui sera obsolète dans une future version. Pour le moment, le compilateur n&#39;applique pas le modificateur view, ne produisant qu&#39;un avertissement, mais cela devrait devenir un mot-clé appliqué dans la v0.5 de Solidity.</p>
</dd>
<dt class="hdlist1">pure</dt>
<dd>
<p>Une fonction pure est une fonction qui ne lit ni écrit aucune variable dans le stockage. Il ne peut fonctionner que sur des arguments et renvoyer des données, sans référence à aucune donnée stockée. Les fonctions pures sont destinées à encourager la programmation de style déclaratif sans effets secondaires ni état.</p>
</dd>
<dt class="hdlist1">payable</dt>
<dd>
<p>Une fonction payable est une fonction qui peut accepter des paiements entrants. Les fonctions non déclarées comme payable rejetteront les paiements entrants. Il existe deux exceptions, dues à des décisions de conception dans l&#39;EVM : les paiements coinbase et l&#39;héritage SELFDESTRUCT seront payés même si la fonction de secours n&#39;est pas déclarée comme payable, mais cela a du sens car l&#39;exécution de code ne fait pas partie de ces paiements <span class="keep-together">de toute façon</span>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-401">
<p>Comme vous pouvez le voir dans notre exemple Faucet, nous avons une fonction payante (la fonction de secours), qui est la seule fonction qui peut recevoir des paiements entrants.</p>
</div>
</div>
<div class="sect3 data-line-403">
<h4 id="_constructeur_de_contrat_et_autodestruction">Constructeur de contrat et autodestruction</h4>
<div class="paragraph data-line-405">
<p>Il existe une fonction spéciale qui n&#39;est utilisée qu&#39;une seule fois . Lorsqu&#39;un contrat est créé, il exécute également la <em>fonction constructor</em> s&#39;il en existe une, pour initialiser l&#39;état du contrat. Le constructeur est exécuté dans la même transaction que la création du contrat. La fonction constructeur est facultative ; vous remarquerez que notre exemple Faucet n&#39;en a pas.</p>
</div>
<div class="paragraph data-line-407">
<p>Les constructeurs peuvent être spécifiés de deux manières. Jusqu&#39;à et y compris dans Solidity v0.4.21, le constructeur est une fonction dont le nom correspond au nom du contrat, comme vous pouvez le voir ici :</p>
</div>
<div class="listingblock data-line-410">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract MEContract {
	function MEContract() {
// C&amp;#39;est le constructeur
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-419">
<p>La difficulté avec ce format est que si le nom du contrat est modifié et que le nom de la fonction constructeur n&#39;est pas modifié, ce n&#39;est plus un constructeur. De même, s&#39;il y a une faute de frappe accidentelle dans la dénomination du contrat et/ou du constructeur, la fonction n&#39;est plus un constructeur. Cela peut provoquer des bogues assez désagréables, inattendus et difficiles à trouver. Imaginez par exemple si le constructeur met le propriétaire du contrat à des fins de contrôle. Si la fonction n&#39;est pas réellement le constructeur en raison d&#39;une erreur de nommage, non seulement le propriétaire ne sera pas défini au moment de la création du contrat, mais la fonction peut également être déployée en tant que partie permanente et &quot;appelable&quot; du contrat, comme un fonction normale, permettant à tout tiers de détourner le contrat et d&#39;en devenir le &quot;propriétaire&quot; après la création du contrat.</p>
</div>
<div class="paragraph data-line-421">
<p>Pour résoudre les problèmes potentiels avec les fonctions constructeur basées sur le fait d&#39;avoir un nom identique à celui du contrat, Solidity v0.4.22 introduit un mot-clé constructor qui fonctionne comme une fonction constructeur mais n&#39;a pas de nom. Renommer le contrat n&#39;affecte en rien le constructeur. De plus, il est plus facile d&#39;identifier quelle fonction est le constructeur. Il ressemble à ceci :</p>
</div>
<div class="listingblock data-line-424">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma ^0.4.22
contract MEContract {
	constructor () {
// C&amp;#39;est le constructeur
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-433">
<p>Pour résumer, le cycle de vie d&#39;un contrat commence par une transaction de création à partir d&#39;un compte EOA ou un contrat. S&#39;il existe un constructeur, il est exécuté dans le cadre de la création du contrat, pour initialiser l&#39;état du contrat lors de sa création, puis est supprimé.</p>
</div>
<div class="paragraph data-line-435">
<p>L&#39;autre la fin du cycle de vie du contrat est la <em>destruction du contrat</em>. Les contrats sont détruits par un opcode EVM spécial appelé SELFDESTRUCT. Il s&#39;appelait autrefois <span class="keep-together"><code>SUICIDE</code></span>, mais ce nom a été déprécié en raison des associations négatives du mot. Dans Solidity, cet opcode est exposé sous la forme d&#39;une fonction intégrée de haut niveau appelée selfdestruct, qui prend un argument : l&#39;adresse pour recevoir tout solde d&#39;éther restant dans le compte du contrat. Il ressemble à ceci :</p>
</div>
<div class="listingblock data-line-438">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">selfdestruct(address recipient);</code></pre>
</div>
</div>
<div class="paragraph data-line-442">
<p>Notez que vous devez explicitement ajouter cette commande à votre contrat si vous voulez qu&#39;il soit supprimable - c&#39;est la seule façon de supprimer un contrat, et il n&#39;est pas présent par défaut. De cette manière, les utilisateurs d&#39;un contrat qui pourraient s&#39;attendre à ce qu&#39;un contrat soit là pour toujours peuvent être certains qu&#39;un contrat ne peut pas être supprimé s&#39;il ne contient pas d&#39;opcode <span class="keep-together"><code>SELFDESTRUCT</code></span>.</p>
</div>
</div>
<div class="sect3 data-line-444">
<h4 id="_ajout_dun_constructeur_et_autodestruction_à_notre_exemple_de_robinet">Ajout d&#39;un constructeur et autodestruction à notre exemple de robinet</h4>
<div class="paragraph data-line-446">
<p>L&#39;exemple de contrat Faucet que nous avons introduit dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a> n&#39;a pas de constructeur ou de fonctions selfdestruct. C&#39;est un contrat éternel qui ne peut pas être supprimé. Changeons cela en ajoutant un constructeur et une fonction selfdestruct. Nous voulons probablement que selfdestruct soit appelable <em>uniquement</em> par l&#39;EOA qui a initialement créé le contrat. Par convention, ceci est généralement stocké dans une variable d&#39;adresse appelée owner. Notre constructeur définit la variable owner, et la fonction selfdestruct vérifiera d&#39;abord que le propriétaire l&#39;a appelée directement.</p>
</div>
<div class="paragraph data-line-448">
<p>Tout d&#39;abord, notre constructeur :</p>
</div>
<div class="listingblock data-line-451">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version du compilateur Solidity pour lequel ce programme a été écrit
pragma solidity ^0.4.22;

// Notre premier contrat est un robinet !
contract Faucet {

	address owner;

// Initialiser le contrat Faucet : définir le propriétaire
	constructor() {
		owner = msg.sender;
	}

[...]</code></pre>
</div>
</div>
<div class="paragraph data-line-468">
<p>Nous avons modifié la directive pragma pour spécifier la v0.4.22 comme version minimale pour cet exemple, car nous utilisons le nouveau mot-clé constructor introduit dans la v0.4.22 de Solidity. Notre contrat a maintenant une variable de type address nommée owner. Le nom &quot;owner&quot; n&#39;est en aucun cas spécial. Nous pourrions appeler cette variable d&#39;adresse &quot;potato&quot; et l&#39;utiliser toujours de la même manière. Le nom owner rend simplement son objectif clair.</p>
</div>
<div class="paragraph data-line-470">
<p>Ensuite, notre constructeur, qui s&#39;exécute dans le cadre de la transaction de création de contrat, attribue l&#39;adresse de msg.sender à la variable owner. Nous avons utilisé msg.sender dans la fonction remove pour identifier l&#39;initiateur de la demande de <span class="keep-together"><code>withdraw</code></span>. Dans le constructeur, cependant, le msg.sender est l&#39;EOA ou l&#39;adresse du contrat qui a initié la création du contrat. Nous savons que c&#39;est le cas <em>car</em> il s&#39;agit d&#39;une fonction constructeur : elle ne s&#39;exécute qu&#39;une seule fois, lors de la création du contrat.</p>
</div>
<div class="paragraph data-line-472">
<p>Nous pouvons maintenant ajouter une fonction pour détruire le contrat. Nous devons nous assurer que seul le propriétaire peut exécuter cette fonction, nous utiliserons donc une instruction require pour contrôler l&#39;accès. Voici à quoi cela ressemblera :</p>
</div>
<div class="listingblock data-line-475">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Destructeur de contrat
function destroy() public {
	require(msg.sender == owner);
	selfdestruct(owner);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-483">
<p>Si quelqu&#39;un appelle cette fonction destroy depuis une adresse autre que owner, elle échouera. Mais si la même adresse stockée dans owner par le constructeur l&#39;appelle, le contrat s&#39;autodétruira et enverra tout solde restant à l&#39;adresse owner. Notez que nous n&#39;avons pas utilisé le non sécurisé tx.origin pour déterminer si le propriétaire souhaitait détruire le contrat. L&#39;utilisation de tx.origin permettrait à des contrats malveillants de détruire votre contrat sans votre permission.</p>
</div>
</div>
<div class="sect3 data-line-485">
<h4 id="_modificateurs_de_fonction">Modificateurs de fonction</h4>
<div class="paragraph data-line-487">
<p>Solidity offre un type spécial de fonction appelé <em>modificateur de fonction</em>. Vous appliquez des modificateurs aux fonctions en ajoutant le nom du modificateur dans la déclaration de la fonction. Les modificateurs sont le plus souvent utilisés pour créer des conditions qui s&#39;appliquent à de nombreuses fonctions au sein d&#39;un contrat. Nous avons déjà une instruction de contrôle d&#39;accès dans notre fonction destroy. Créons un modificateur de fonction qui exprime cette condition :</p>
</div>
<div class="listingblock data-line-490">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">modifier onlyOwner {
    require(msg.sender == owner);
    _;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-498">
<p>Ce modificateur de fonction, nommé onlyOwner, définit une condition sur toute fonction qu&#39;il modifie, exigeant que l&#39;adresse stockée en tant que owner du contrat soit la même que l&#39;adresse du msg.sender de la transaction. Il s&#39;agit du modèle de conception de base pour le contrôle d&#39;accès, permettant uniquement au propriétaire d&#39;un contrat d&#39;exécuter toute fonction qui a le modificateur onlyOwner.</p>
</div>
<div class="paragraph data-line-500">
<p>Vous avez peut-être remarqué que notre modificateur de fonction contient un &quot;espace réservé&quot; syntaxique particulier, un trait de soulignement suivi d&#39;un point-virgule (_;). Cet espace réservé est remplacé par le code de la fonction en cours de modification. Essentiellement, le modificateur est &quot;enroulé autour&quot; de la fonction modifiée, plaçant son code à l&#39;emplacement identifié par le caractère de soulignement.</p>
</div>
<div class="paragraph data-line-502">
<p>Pour appliquer un modificateur, vous ajoutez son nom à la déclaration de la fonction. Plusieurs modificateurs peuvent être appliqués à une fonction ; ils sont appliqués dans l&#39;ordre dans lequel ils sont déclarés, sous forme de liste séparée par des virgules.</p>
</div>
<div class="paragraph data-line-504">
<p>Réécrivons notre fonction destroy pour utiliser le modificateur onlyOwner :</p>
</div>
<div class="listingblock data-line-507">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function destroy() public onlyOwner {
    selfdestruct(owner);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-513">
<p>Le nom du modificateur de fonction (onlyOwner) se trouve après le mot-clé public et nous indique que la fonction destroy est modifiée par le modificateur onlyOwner. Essentiellement, vous pouvez lire cela comme &quot;Seul le propriétaire peut détruire ce contrat&quot;. En pratique, le code résultant équivaut à &quot;envelopper&quot; le code de onlyOwner autour de destroy.</p>
</div>
<div class="paragraph data-line-515">
<p>Les modificateurs de fonction sont un outil extrêmement utile car ils nous permettent d&#39;écrire des conditions préalables pour les fonctions et de les appliquer de manière cohérente, ce qui rend le code plus facile à lire et, par conséquent, plus facile à auditer pour la sécurité. Ils sont le plus souvent utilisés pour le contrôle d&#39;accès, mais ils sont assez polyvalents et peuvent être utilisés à diverses autres fins.</p>
</div>
<div class="paragraph data-line-517">
<p>A l&#39;intérieur d&#39;un modificateur, vous pouvez accéder à toutes les valeurs (variables et arguments) visibles par la fonction modifiée. Dans ce cas, nous pouvons accéder à la variable owner, qui est déclarée dans le contrat. Cependant, l&#39;inverse n&#39;est pas vrai : vous ne pouvez accéder à aucune des variables du modificateur à l&#39;intérieur de la fonction modifiée.</p>
</div>
</div>
<div class="sect3 data-line-519">
<h4 id="_héritage_du_contrat">Héritage du contrat</h4>
<div class="paragraph data-line-521">
<p>L&#39;objet contract de Solidity prend en charge l'<em>héritage</em>, qui est un mécanisme permettant d&#39;étendre un contrat de base avec des fonctionnalités supplémentaires. Pour utiliser l&#39;héritage, spécifiez un contrat parent avec le mot-clé is :</p>
</div>
<div class="listingblock data-line-524">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Child is Parent {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-530">
<p>Avec cette construction, le contrat Child hérite de toutes les méthodes, fonctionnalités et variables de Parent. Solidity prend également en charge l&#39;héritage multiple, qui peut être spécifié par des noms de contrat séparés par des virgules après le mot-clé is :</p>
</div>
<div class="listingblock data-line-533">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Child is Parent1, Parent2 {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-539">
<p>L&#39;héritage de contrat nous permet d&#39;écrire nos contrats de manière à atteindre la modularité, l&#39;extensibilité et la réutilisation. Nous commençons par des contrats simples et implémentons les capacités les plus génériques, puis nous les étendons en héritant de ces capacités dans des contrats plus spécialisés.</p>
</div>
<div class="paragraph data-line-541">
<p>Dans notre contrat Faucet, nous avons introduit le constructeur et le destructeur, ainsi qu&#39;un contrôle d&#39;accès pour un propriétaire, assigné à la construction. Ces capacités sont assez génériques : de nombreux contrats en auront. Nous pouvons les définir comme des contrats génériques, puis utiliser l&#39;héritage pour les étendre au contrat Faucet.</p>
</div>
<div class="paragraph data-line-543">
<p>Nous commençons par définir un contrat de base owned, qui a une variable owner, en la définissant dans le constructeur du contrat :</p>
</div>
<div class="listingblock data-line-546">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract owned {
	address owner;

// Constructeur de contrat : définit le propriétaire
	constructor() {
		owner = msg.sender;
	}

// Modificateur de contrôle d&amp;#39;accès
	modifier onlyOwner {
	    require(msg.sender == owner);
	    _;
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-563">
<p>Ensuite, nous définissons un contrat de base mortal, qui hérite de owned :</p>
</div>
<div class="listingblock data-line-566">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract mortal is owned {
	// Contract destructor
	function destroy() public onlyOwner {
		selfdestruct(owner);
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-575">
<p>Comme vous pouvez le voir, le contrat mortal peut utiliser le modificateur de fonction onlyOwner, défini dans owned. Il utilise aussi indirectement la variable d&#39;adresse owner et le constructeur défini dans owned. L&#39;héritage rend chaque contrat plus simple et axé sur sa fonctionnalité spécifique, nous permettant de gérer les détails de manière modulaire.</p>
</div>
<div class="paragraph data-line-577">
<p>Nous pouvons maintenant étendre davantage le contrat owned, en héritant de ses capacités dans Faucet :</p>
</div>
<div class="listingblock data-line-580">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet is mortal {
// Donnez de l&amp;#39;éther à quiconque demande
    function withdraw(uint withdraw_amount) public {
// Limiter le montant du retrait
        require(withdraw_amount &lt;= 0.1 ether);
// Envoie le montant à l&amp;#39;adresse qui l&amp;#39;a demandé
        msg.sender.transfer(withdraw_amount);
    }
// Accepte tout montant entrant
    function () external payable {}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-594">
<p>En héritant de mortal, qui à son tour hérite de owned, le contrat Faucet a maintenant les fonctions constructeur et destroy, et un propriétaire défini. La fonctionnalité est la même que lorsque ces fonctions étaient dans Faucet, mais maintenant nous pouvons réutiliser ces fonctions dans d&#39;autres contrats sans les réécrire. La réutilisation et la modularité du code rendent notre code plus propre, plus facile à lire et plus facile à auditer.</p>
</div>
</div>
<div class="sect3 data-line-596">
<h4 id="_gestion_des_erreurs_assert_require_revert">Gestion des erreurs (assert, require, revert)</h4>
<div class="paragraph data-line-598">
<p>Un appel de contrat peut se terminer et renvoyer une erreur. La gestion des erreurs dans Solidity est gérée par quatre fonctions : assert, require, revert et throw (désormais obsolète).</p>
</div>
<div class="paragraph data-line-600">
<p>Lorsqu&#39;un contrat se termine avec une erreur, tous les changements d&#39;état (changements de variables, de soldes, etc.) sont annulés, tout au long de la chaîne d&#39;appels de contrat si plusieurs contrats ont été appelés. Cela garantit que les transactions sont <em>atomiques</em>, ce qui signifie qu&#39;elles se terminent avec succès ou n&#39;ont aucun effet sur l&#39;état et sont entièrement annulées.</p>
</div>
<div class="paragraph data-line-602">
<p>Les fonctions assert et require fonctionnent de la même manière, évaluant une condition et arrêtant l&#39;exécution avec une erreur si la condition c&#39;est fausse. Par convention, assert est utilisé lorsque le résultat est censé être vrai, ce qui signifie que nous utilisons assert pour tester les conditions internes. Par comparaison, require est utilisé lors du test d&#39;entrées (telles que des arguments de fonction ou des champs de transaction), définissant nos attentes pour ces <span class="keep-together">conditions</span>.</p>
</div>
<div class="paragraph data-line-604">
<p>Nous avons utilisé require dans notre modificateur de fonction onlyOwner, pour tester que l&#39;expéditeur du message est le propriétaire du contrat :</p>
</div>
<div class="listingblock data-line-607">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(msg.sender == owner);</code></pre>
</div>
</div>
<div class="paragraph data-line-611">
<p>La fonction require agit comme une <em>condition d&#8217;entrée</em>, empêchant l&#39;exécution du reste de la fonction et produisant une erreur si elle n&#39;est pas satisfaite.</p>
</div>
<div class="paragraph data-line-613">
<p>Depuis Solidity v0.4.22, require peut également inclure un message texte utile qui peut être utilisé pour indiquer la raison de l&#39;erreur. Le message d&#39;erreur est enregistré dans le journal des transactions. Ainsi, nous pouvons améliorer notre code en ajoutant un message d&#39;erreur dans notre fonction require :</p>
</div>
<div class="listingblock data-line-616">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(msg.sender == owner, &amp;quot;Seul le propriétaire du contrat peut appeler cette fonction&amp;quot;);</code></pre>
</div>
</div>
<div class="paragraph data-line-620">
<p>Les fonctions revert et throw interrompent l&#39;exécution du contrat et annulent tout changement d&#39;état. La fonction throw est obsolète et sera supprimée dans les futures versions de Solidity ; vous devriez utiliser revert à la place. La fonction revert peut également prendre un message d&#39;erreur comme seul argument, qui est enregistré dans le journal des transactions.</p>
</div>
<div class="paragraph data-line-622">
<p>Certaines conditions d&#39;un contrat généreront des erreurs, que nous les vérifiions explicitement ou non. Par exemple, dans notre contrat Faucet, nous ne vérifions pas s&#39;il y a suffisamment d&#39;éther pour satisfaire une demande de retrait. En effet, la fonction transfer échouera avec une erreur et annulera la transaction si le solde est insuffisant pour effectuer le transfert :</p>
</div>
<div class="listingblock data-line-625">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-629">
<p>Cependant, il peut être préférable de vérifier explicitement et de fournir un message d&#39;erreur clair en cas d&#39;échec. Nous pouvons le faire en ajoutant une instruction require avant le transfert :</p>
</div>
<div class="listingblock data-line-632">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(this.balance &gt;= withdraw_amount,
&amp;quot;Solde insuffisant dans le robinet pour la demande de retrait&amp;quot; );
msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-638">
<p>Un code de vérification d&#39;erreur supplémentaire comme celui-ci augmentera légèrement la consommation de gaz, mais il offre un meilleur rapport d&#39;erreur que s&#39;il est omis. Vous devrez trouver le bon équilibre entre la consommation de gaz et la vérification détaillée des erreurs en fonction de l&#39;utilisation prévue de votre contrat. Dans le cas d&#39;un contrat Faucet destiné à un testnet, nous pouvons probablement abuser du côté des rapports supplémentaires même si cela coûte plus cher en gaz. Peut-être que pour un contrat de réseau principal, nous choisirons plutôt d&#39;être économes avec notre consommation de gaz.</p>
</div>
</div>
<div class="sect3 data-line-641">
<h4 id="solidity_events">Événements</h4>
<div class="paragraph data-line-643">
<p>Lorsque une transaction se termine (avec succès ou non), elle produit une <em>réception de transaction</em>, comme nous le verrons dans <a href="#evm_chapter">La machine virtuelle Ethereum</a>. Le reçu de transaction contient des entrées <em>log</em> qui fournissent des informations sur les actions qui se sont produites lors de l&#39;exécution de la transaction. Les <em>Événements</em> ou <em>Events</em> sont les objets de haut niveau de Solidity utilisés pour construire ces journaux.</p>
</div>
<div class="paragraph data-line-645">
<p>Les événements sont particulièrement utiles pour les clients légers et les services DApp, qui peuvent &quot;surveiller&quot; des événements spécifiques et les signaler à l&#39;interface utilisateur, ou modifier l&#39;état de l&#39;application pour refléter un événement dans un contrat sous-jacent.</p>
</div>
<div class="paragraph data-line-647">
<p>Les objets d&#39;événement prennent des arguments qui sont sérialisés et enregistrés dans les journaux de transactions, dans la chaîne de blocs. Vous pouvez fournir le mot-clé indexé avant un argument, pour que la valeur fasse partie d&#39;une table indexée (table de hachage) qui peut être recherchée ou filtrée par une application.</p>
</div>
<div class="paragraph data-line-649">
<p>Nous n&#39;avons ajouté aucun événement dans notre exemple Faucet jusqu&#39;à présent, alors faisons cela. Nous ajouterons deux événements, un pour enregistrer les retraits et un pour enregistrer les dépôts. Nous appellerons ces événements Withdrawal et Deposit, respectivement. Tout d&#39;abord, nous définissons les événements dans le contrat Faucet :</p>
</div>
<div class="listingblock data-line-652">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet is mortal {
	event Withdrawal(address indexed to, uint amount);
	event Deposit(address indexed from, uint amount);

	[...]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-661">
<p>Nous avons choisi de rendre les adresses indexed, pour permettre la recherche et le filtrage dans n&#39;importe quelle interface utilisateur conçue pour accéder à notre Faucet.</p>
</div>
<div class="paragraph data-line-663">
<p>Ensuite, nous utilisons le mot-clé emit pour incorporer les données d&#39;événement dans les journaux de transactions :</p>
</div>
<div class="listingblock data-line-666">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Donnez de l&amp;#39;éther à quiconque demande
function withdraw(uint withdraw_amount) public {
    [...]
    msg.sender.transfer(withdraw_amount);
    emit Withdrawal(msg.sender, withdraw_amount);
}
// Accepte tout montant entrant
function () external payable {
    emit Deposit(msg.sender, msg.value);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-679">
<p>Le contrat <em>Faucet.sol</em> résultant ressemble à <a href="#Faucet8_sol">Faucet8.sol : contrat de robinet révisé, avec événements</a>.</p>
</div>
<div id="Faucet8_sol" class="exampleblock data-line-683">
<div class="title">Example 4. Faucet8.sol : contrat de robinet révisé, avec événements</div>
<div class="content">
<div class="listingblock data-line-685">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity ^0.6.4;

contract Owned {
    address payable owner;

    // Contract constructor: set owner
    constructor() public {
        owner = msg.sender;
    }

    // Access control modifier
    modifier onlyOwner {
        require(msg.sender == owner, "Only the contract owner can call this function");
        _;
    }
}

contract Mortal is Owned {
    // Contract destructor
    function destroy() public onlyOwner {
        selfdestruct(owner);
    }
}

contract Faucet is Mortal {
    event Withdrawal(address indexed to, uint amount);
    event Deposit(address indexed from, uint amount);

    // Accept any incoming amount
    receive() external payable {
        emit Deposit(msg.sender, msg.value);
    }

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 0.1 ether);

        require(
            address(this).balance &gt;= withdraw_amount,
            "Insufficient balance in faucet for withdrawal request"
        );

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);

        emit Withdrawal(msg.sender, withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4 data-line-690">
<h5 id="_attraper_des_événements">Attraper des événements</h5>
<div class="paragraph data-line-692">
<p>OK, nous avons donc configuré notre contrat pour émettre des événements. Comment voir les résultats d&#39;une transaction et &quot;attraper&quot; les événements ? La bibliothèque web3.js fournit une structure de données qui contient les journaux d&#39;une transaction. Dans ceux-ci, nous pouvons voir les événements générés par la transaction.</p>
</div>
<div class="paragraph data-line-694">
<p>Utilisons truffle pour exécuter une transaction de test sur le contrat Faucet révisé. Suivez les instructions dans <a href="#truffle">Truffle</a> pour configurer un répertoire de projet et compiler le code <span class="keep-together"><code>Faucet</code></span>. Le code source peut être trouvé dans <a href="https://github.com/ethereumbook/ethereumbook" data-href="https://github.com/ethereumbook/ethereumbook">le référentiel GitHub du livre</a> sous <em>code/truffle/FaucetEvents</em>.</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle develop</strong>
truffle(develop)> <strong>compile</strong>
truffle(develop)> <strong>migrate</strong>
Using network 'develop'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb77ceae7c3f5afb7fbe3a6c5974d352aa844f53f955ee7d707ef6f3f8e6b4e61
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Faucet...
  ... 0xfa850d754314c3fb83f43ca1fa6ee20bc9652d891c00a2f63fd43ab5bfb0d781
  Faucet: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

truffle(develop)> <strong>Faucet.deployed().then(i => {FaucetDeployed = i})</strong>
truffle(develop)> <strong>FaucetDeployed.send(web3.utils.toWei(1, "ether")).then(res => \
                  { console.log(res.logs[0].event, res.logs[0].args) })</strong>
Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }
truffle(develop)> <strong>FaucetDeployed.withdraw(web3.utils.toWei(0.1, "ether")).then(res => \
                  { console.log(res.logs[0].event, res.logs[0].args) })</strong>
Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }

</pre>
<div class="paragraph data-line-731">
<p>Après avoir déployé le contrat à l&#39;aide de la fonction deployed, nous exécutons deux transactions. La première transaction est un dépôt (en utilisant send), qui émet un événement Deposit dans les journaux de transactions :</p>
</div>
<div class="listingblock data-line-733">
<div class="content">
<pre>Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }</pre>
</div>
</div>
<div class="paragraph data-line-738">
<p>Ensuite, nous utilisons la fonction withdraw pour effectuer un retrait. Cela émet un événement Withdrawal :</p>
</div>
<div class="listingblock data-line-740">
<div class="content">
<pre>Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }</pre>
</div>
</div>
<div class="paragraph data-line-745">
<p>Pour obtenir ces événements, nous avons examiné le tableau logs renvoyé comme résultat (res) des transactions. La première entrée de journal (logs[0]) contient un nom d&#39;événement dans logs[0].event et les arguments d&#39;événement dans logs[0].args. En les affichant sur la console, nous pouvons voir le nom de l&#39;événement émis et les arguments de l&#39;événement.</p>
</div>
<div class="paragraph data-line-747">
<p>Les événements sont un mécanisme très utile, non seulement pour la communication intra-contrat, mais aussi pour le débogage pendant le développement.</p>
</div>
</div>
</div>
<div class="sect3 data-line-749">
<h4 id="_appel_dautres_contrats_send_call_callcode_delegatecall">Appel d&#39;autres contrats (send, call, callcode, delegatecall)</h4>
<div class="paragraph data-line-751">
<p>Appeler d&#39;autres contrats depuis votre contrat est une opération très utile mais potentiellement dangereuse. Nous examinerons les différentes façons d&#39;y parvenir et évaluerons les risques de chaque méthode. En bref, les risques découlent du fait que vous ne savez peut-être pas grand-chose sur un contrat auquel vous faites appel ou qui fait appel à votre contrat. Lors de la rédaction de contrats intelligents, vous devez garder à l&#39;esprit que même si vous vous attendez principalement à traiter avec des EOA, rien n&#39;empêche des contrats arbitrairement complexes et peut-être malveillants d&#39;appeler et d&#39;être appelés par votre code.</p>
</div>
<div class="sect4 data-line-753">
<h5 id="_création_dune_nouvelle_instance">Création d&#39;une nouvelle instance</h5>
<div class="paragraph data-line-755">
<p>Le moyen le plus sûr d&#39;appeler un autre contrat est de créer vous-même cet autre contrat. De cette façon, vous êtes certain de ses interfaces et de son comportement. Pour ce faire, vous pouvez simplement l&#39;instancier, en utilisant le mot-clé new, comme dans d&#39;autres langages orientés objet. Dans Solidity, le mot-clé new créera le contrat sur la chaîne de blocs et renverra un objet que vous pourrez utiliser pour le référencer. Supposons que vous souhaitiez créer et appeler un contrat Faucet à partir d&#39;un autre contrat appelé Token :</p>
</div>
<div class="listingblock pagebreak-before data-line-759">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-769">
<p>Ce mécanisme de construction de contrat garantit que vous connaissez le type exact du contrat et son interface. Le contrat Faucet doit être défini dans la portée de Token, ce que vous pouvez faire avec une instruction import si la définition se trouve dans un autre fichier :</p>
</div>
<div class="listingblock data-line-772">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-784">
<p>Vous pouvez éventuellement spécifier la value du transfert d&#39;ether lors de la création et passer des arguments au constructeur du nouveau contrat :</p>
</div>
<div class="listingblock data-line-787">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-799">
<p>Vous pouvez également appeler ensuite les fonctions Faucet. Dans cet exemple, nous appelons la fonction destroy de Faucet depuis la fonction destroy de Token :</p>
</div>
<div class="listingblock data-line-802">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}

	function destroy() ownerOnly {
		_faucet.destroy();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-818">
<p>Notez que tant que vous êtes le propriétaire du contrat Token, le contrat Token lui-même possède le nouveau contrat Faucet, donc seul le contrat Token peut le détruire.</p>
</div>
</div>
<div class="sect4 data-line-820">
<h5 id="_adressage_dune_instance_existante">Adressage d&#39;une instance existante</h5>
<div class="paragraph data-line-822">
<p>Une autre façon d&#39;appeler un contrat consiste à convertir l&#39;adresse d&#39;une instance existante du contrat. Avec cette méthode, vous appliquez une interface connue à une instance existante. Il est donc extrêmement important que vous sachiez avec certitude que l&#39;instance à laquelle vous vous adressez est en fait du type que vous supposez. Regardons un exemple :</p>
</div>
<div class="listingblock data-line-825">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {

	Faucet _faucet;

	constructor(address _f) {
		_faucet = Faucet(_f);
		_faucet.withdraw(0.1 ether)
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-839">
<p>Ici, nous prenons une adresse fournie comme argument au constructeur, _f, et nous la transformons en un objet Faucet. C&#39;est beaucoup plus risqué que le mécanisme précédent, car nous ne savons pas avec certitude si cette adresse est réellement un objet Faucet. Lorsque nous appelons withdraw, nous supposons qu&#39;il accepte les mêmes arguments et exécute le même code que notre déclaration Faucet, mais nous ne pouvons pas en être sûrs. Pour autant que nous sachions, la fonction withdraw à cette adresse pourrait exécuter quelque chose de complètement différent de ce que nous attendons, même si elle porte le même nom. Utiliser des adresses passées en entrée et les intégrer dans des objets spécifiques est donc beaucoup plus dangereux que de créer soi-même le contrat.</p>
</div>
</div>
<div class="sect4 data-line-841">
<h5 id="_appel_brut_call_et_delegatecall">Appel brut call et delegatecall</h5>
<div class="paragraph data-line-843">
<p>Solidity propose des fonctions encore plus &quot;de bas niveau&quot; pour appeler d&#39;autres contrats. Ceux-ci correspondent directement aux opcodes EVM du même nom et nous permettent de construire manuellement un appel de contrat à contrat. En tant que tels, ils représentent les mécanismes les plus flexibles <em>et</em> les plus dangereux pour appeler d&#39;autres contrats.</p>
</div>
<div class="paragraph data-line-845">
<p>Voici le même exemple, en utilisant une méthode call :</p>
</div>
<div class="listingblock data-line-848">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	constructor(address _faucet) {
		_faucet.call("withdraw", 0.1 ether);
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-856">
<p>Comme vous pouvez le voir, ce type de call est un appel <em>aveugle</em> dans une fonction, un peu comme la construction d&#39;une transaction brute, uniquement à partir du contexte d&#39;un contrat. Cela peut exposer votre contrat à un certain nombre de risques de sécurité, le plus important étant la <em>réentrance</em>, dont nous discuterons plus en détail dans <a href="#reentrancy_security">Réentrance</a>. La fonction call renverra false s&#39;il y a un problème, vous pouvez donc évaluer la valeur de retour pour la gestion des erreurs :</p>
</div>
<div class="listingblock data-line-859">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	constructor(address _faucet) {
		if !(_faucet.call("withdraw", 0.1 ether)) {
			revert("Withdrawal from faucet failed");
		}
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-869">
<p>Une autre variante de call est delegatecall, qui a remplacé le plus dangereux callcode. La méthode <code><span class="keep-together">callcode</span></code> sera bientôt obsolète, elle ne doit donc pas être utilisée.</p>
</div>
<div class="paragraph data-line-871">
<p>Comme mentionné dans <a href="#solidity_address_object">objet d&#39;adresse</a>, un delegatecall est différent d&#39;un call en ce que le contexte msg ne change pas. Par exemple, alors qu&#39;un call change la valeur de msg.sender pour être le contrat d&#39;appel, un delegatecall conserve le même msg.sender que dans le contrat d&#39;appel. Essentiellement, delegatecall exécute le code d&#39;un autre contrat dans le contexte de l&#39;exécution du contrat en cours. Il est le plus souvent utilisé pour invoquer du code à partir d&#39;une bibliothèque. Cela vous permet également de dessiner sur le modèle d&#39;utilisation des fonctions de bibliothèque stockées ailleurs, mais de faire fonctionner ce code avec les données de stockage de votre contrat.</p>
</div>
<div class="paragraph data-line-873">
<p>L&#39;appel delegatecall doit être utilisé avec beaucoup de prudence. Cela peut avoir des effets inattendus, surtout si le contrat que vous appelez n&#39;a pas été conçu comme une bibliothèque.</p>
</div>
<div class="paragraph data-line-875">
<p>Utilisons un exemple de contrat pour démontrer les différentes sémantiques d&#39;appel utilisées par call et delegatecall pour appeler des bibliothèques et des contrats. Dans <a href="#call_examples_code">CallExamples.sol : un exemple de différentes sémantiques d&#39;appel</a>, nous utilisons un événement pour enregistrer les détails de chaque appel et voir comment le contexte d&#39;appel change en fonction du type d&#39;appel.</p>
</div>
<div id="call_examples_code" class="exampleblock data-line-879">
<div class="title">Example 5. CallExamples.sol : un exemple de différentes sémantiques d&#39;appel</div>
<div class="content">
<div class="listingblock data-line-881">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.22;

contract calledContract {
    event callEvent(address sender, address origin, address from);
    function calledFunction() public {
        emit callEvent(msg.sender, tx.origin, this);
    }
}

library calledLibrary {
    event callEvent(address sender, address origin,  address from);
    function calledFunction() public {
        emit callEvent(msg.sender, tx.origin, this);
    }
}

contract caller {

    function make_calls(calledContract _calledContract) public {

    // Calling calledContract and calledLibrary directly
    _calledContract.calledFunction();
    calledLibrary.calledFunction();

    // Low-level calls using the address object for calledContract
    require(address(_calledContract).
            call(bytes4(keccak256("calledFunction()"))));
    require(address(_calledContract).
            delegatecall(bytes4(keccak256("calledFunction()"))));



	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-886">
<p>Comme vous pouvez le voir dans cet exemple, notre contrat principal est caller, qui appelle une bibliothèque calledLibrary et un contrat calledContract. La bibliothèque appelée et le contrat ont des fonctions calledFunction identiques, qui émettent un événement calledEvent. L&#39;événement calledEvent enregistre trois éléments de données : msg.sender, tx.origin et this. Chaque fois que calledFunction est appelé, il peut avoir un contexte d&#39;exécution différent (avec des valeurs différentes pour potentiellement toutes les variables de contexte), selon qu&#39;il est appelé directement ou via delegatecall.</p>
</div>
<div class="paragraph data-line-888">
<p>Dans caller, nous appelons d&#39;abord le contrat et la bibliothèque directement, en invoquant calledFunction dans chacun. Ensuite, nous utilisons explicitement les fonctions de bas niveau call et delegatecall pour appeler calledContract.calledFunction. De cette façon, nous pouvons voir comment les différents mécanismes d&#39;appel se comportent.</p>
</div>
<div class="paragraph data-line-890">
<p>Exécutons ceci dans un environnement de développement Truffle et capturons les événements, pour voir à quoi cela ressemble :</p>
</div>
<pre data-type="programlisting">
truffle(develop)> <strong>migrate</strong>
Using network 'develop'.
[...]
Saving artifacts...
truffle(develop)> <strong>web3.eth.accounts[0]</strong>
'0x627306090abab3a6e1400e9345bc60c78a8bef57'
truffle(develop)> <strong>caller.address</strong>
'0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'
truffle(develop)> <strong>calledContract.address</strong>
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'
truffle(develop)> <strong>calledLibrary.address</strong>
'0xf25186b5081ff5ce73482ad761db0eb0d25abfbf'
truffle(develop)> <strong>caller.deployed().then( i => { callerDeployed = i })</strong>

truffle(develop)> <strong>callerDeployed.make_calls(calledContract.address).then(res => \
                  { res.logs.forEach( log => { console.log(log.args) })})</strong>
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }

</pre>
<div class="paragraph data-line-926">
<p>Voyons ce qui s&#39;est passé ici. Nous avons appelé la fonction make_calls et passé l&#39;adresse de calledContract, puis avons intercepté les quatre événements émis par chacun des différents appels. Examinons la fonction make_calls et passons en revue chaque étape.</p>
</div>
<div class="paragraph data-line-928">
<p>Le premier appel est :</p>
</div>
<div class="listingblock data-line-930">
<div class="content">
<pre>_calledContract.calledFunction();</pre>
</div>
</div>
<div class="paragraph data-line-934">
<p>Ici, nous appelons calledContract.calledFunction directement, en utilisant l&#39;ABI de haut niveau pour calledFunction. L&#39;événement émis est :</p>
</div>
<div class="listingblock data-line-936">
<div class="content">
<pre>sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10'</pre>
</div>
</div>
<div class="paragraph data-line-942">
<p>Comme vous pouvez le voir, msg.sender est l&#39;adresse du contrat caller. Le tx.origin est l&#39;adresse de notre compte, web3.eth.accounts[0], qui a envoyé la transaction à caller. L&#39;événement a été émis par calledContract, comme nous pouvons le voir sur le dernier argument de l&#39;événement.</p>
</div>
<div class="paragraph data-line-944">
<p>Le prochain appel dans make_calls est vers la bibliothèque :</p>
</div>
<div class="listingblock data-line-946">
<div class="content">
<pre>calledLibrary.calledFunction();</pre>
</div>
</div>
<div class="paragraph data-line-950">
<p>Il semble identique à la façon dont nous avons appelé le contrat, mais se comporte très différemment. Regardons le second événement émis :</p>
</div>
<div class="listingblock data-line-952">
<div class="content">
<pre>sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'</pre>
</div>
</div>
<div class="paragraph data-line-958">
<p>Cette fois, le msg.sender n&#39;est pas l&#39;adresse de caller. Au lieu de cela, c&#39;est l&#39;adresse de notre compte, et c&#39;est la même que l&#39;origine de la transaction. En effet, lorsque vous appelez une bibliothèque, l&#39;appel est toujours delegatecall et s&#39;exécute dans le contexte de l&#39;appelant. Ainsi, lorsque le code calledLibrary s&#39;exécutait, il héritait du contexte d&#39;exécution de caller, comme si son code s&#39;exécutait à l&#39;intérieur de caller. La variable this (affichée comme from dans l&#39;événement émis) est l&#39;adresse de caller, même si elle est accessible depuis <span class="keep-together"><code>calledLibrary</code></span>.</p>
</div>
<div class="paragraph data-line-960">
<p>Les deux appels suivants, utilisant les appels call et delegatecall de bas niveau, vérifient nos attentes, émettant des événements qui reflètent ce que nous venons de faire</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-963">
<h3 id="gas_sec">Considérations sur le gaz</h3>
<div class="paragraph data-line-965">
<p>Le gaz, décrit dans plus de détails dans <a href="#gas">Gaz</a>, est une considération extrêmement importante dans la programmation de contrats intelligents. Le gaz est une ressource limitant la quantité maximale de calculs qu&#39;Ethereum permettra à une transaction de consommer. Si la limite de gaz est dépassée pendant le calcul, la série d&#39;événements suivante se produit :</p>
</div>
<div class="ulist data-line-967">
<ul>
<li class="data-line-967">
<p>Une exception &quot;out of gas&quot; est levée.</p>
</li>
<li class="data-line-968">
<p>L&#39;état du contrat avant l&#39;exécution est restauré (inversé).</p>
</li>
<li class="data-line-969">
<p>Tout l&#39;éther utilisé pour payer le gaz est considéré comme des frais de transaction ; il n&#39;est <em>pas</em> remboursé.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-971">
<p>Étant donné que le gaz est payé par l&#39;utilisateur qui initie la transaction, les utilisateurs sont découragés d&#39;appeler des fonctions qui ont un coût de gaz élevé. Il est donc dans l&#39;intérêt du programmeur de minimiser le coût en gaz des fonctions d&#39;un contrat. À cette fin, certaines pratiques sont recommandées lors de la construction de contrats intelligents, afin de minimiser le coût en gaz d&#39;un appel de fonction.</p>
</div>
<div class="sect3 data-line-973">
<h4 id="_évitez_les_tableaux_dimensionnés_dynamiquement">Évitez les tableaux dimensionnés dynamiquement</h4>
<div class="paragraph data-line-975">
<p>Toute boucle à travers un tableau de taille dynamique où une fonction effectue des opérations sur chaque élément ou recherche un élément particulier introduit le risque d&#39;utiliser trop de gaz. En effet, le contrat peut s&#39;essouffler avant d&#39;avoir trouvé le résultat souhaité, ou avant d&#39;agir sur chaque élément, perdant ainsi du temps et de l&#39;éther sans donner le moindre résultat.</p>
</div>
</div>
<div class="sect3 data-line-977">
<h4 id="_évitez_les_appels_vers_dautres_contrats">Évitez les appels vers d&#39;autres contrats</h4>
<div class="paragraph data-line-979">
<p>Appeler d&#39;autres contrats, surtout lorsque le coût en gaz de leurs fonctions n&#39;est pas connu, introduit le risque de manquer de gaz. Évitez d&#39;utiliser des bibliothèques qui ne sont pas bien testées et largement utilisées. Moins une bibliothèque a été examinée par d&#39;autres programmeurs, plus le risque de l&#39;utiliser est grand.</p>
</div>
</div>
<div class="sect3 data-line-981">
<h4 id="_estimation_du_coût_du_gaz">Estimation du coût du gaz</h4>
<div class="paragraph data-line-983">
<p>Si vous avez besoin d&#39;estimer le gaz nécessaire pour exécuter une certaine méthode d&#39;un contrat en tenant compte ses arguments, vous pouvez utiliser la procédure suivante :</p>
</div>
<div class="listingblock data-line-986">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var contract = web3.eth.contract(abi).at(address);
var gasEstimate = contract.myAweSomeMethod.estimateGas(arg1, arg2,
    {from: account});</code></pre>
</div>
</div>
<div class="paragraph data-line-990">
<p>gasEstimate vous indiquera le nombre d&#39;unités de gaz nécessaires à son exécution. Il s&#39;agit d&#39;une estimation en raison de l&#39;exhaustivité de Turing de l&#39;EVM - il est relativement trivial de créer une fonction qui prendra des quantités de gaz très différentes pour exécuter différents appels. Même le code de production peut modifier les chemins d&#39;exécution de manière subtile, ce qui entraîne des coûts de gaz extrêmement différents d&#39;un appel à l&#39;autre. Cependant, la plupart des fonctions sont sensibles et estimateGas donnera une bonne estimation la plupart du temps.</p>
</div>
<div class="paragraph data-line-992">
<p>Pour obtenir le prix du gaz du réseau, vous pouvez utiliser :</p>
</div>
<div class="listingblock data-line-995">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var gasPrice = web3.eth.getGasPrice();</code></pre>
</div>
</div>
<div class="paragraph data-line-997">
<p>Et à partir de là, vous pouvez estimer le coût du gaz :</p>
</div>
<div class="listingblock data-line-1000">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var gasCostInEther = web3.utils.fromWei((gasEstimate * gasPrice), 'ether');</code></pre>
</div>
</div>
<div class="paragraph data-line-1002">
<p>Appliquons nos fonctions d&#39;estimation de gaz pour estimer le coût du gaz de notre exemple Faucet, en utilisant le code <a href="http://bit.ly/2zf0SIO" data-href="http://bit.ly/2zf0SIO">du référentiel du livre</a>.</p>
</div>
<div class="paragraph data-line-1004">
<p>Démarrez Truffle en mode développement et exécutez le fichier JavaScript dans <a href="#estimateGas_function">gas_estimates.js : Utilisation de la fonction estimateGas</a>, <em>gas_estimates.js</em>.</p>
</div>
<div id="estimateGas_function" class="exampleblock data-line-1009">
<div class="title">Example 6. gas_estimates.js : Utilisation de la fonction estimateGas</div>
<div class="content">
<div class="listingblock data-line-1011">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var FaucetContract = artifacts.require("./Faucet.sol");

FaucetContract.web3.eth.getGasPrice(function(error, result) {
    var gasPrice = Number(result);
    console.log("Gas Price is " + gasPrice + " wei"); // "10000000000000"

// Récupère l&amp;#39;instance de contrat
    FaucetContract.deployed().then(function(FaucetContractInstance) {

// Utilisez le mot clé &amp;#39;estimateGas&amp;#39; après le nom de la fonction pour obtenir le gaz
// estimation pour cette fonction particulière (aprove)
		FaucetContractInstance.send(web3.utils.toWei(1, "ether"));
        return FaucetContractInstance.withdraw.estimateGas(web3.utils.toWei(0.1, "ether"));

    }).then(function(result) {
        var gas = Number(result);

        console.log("gas estimation = " + gas + " units");
        console.log("gas cost estimation = " + (gas * gasPrice) + " wei");
        console.log("gas cost estimation = " +
                FaucetContract.web3.utils.fromWei((gas * gasPrice), 'ether') + " ether");
    });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1038">
<p>Voici à quoi cela ressemble dans la console de développement Truffle :</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle develop</strong>

truffle(develop)> <strong>exec gas_estimates.js</strong>
Using network 'develop'.

Gas Price is 20000000000 wei
gas estimation = 31397 units
gas cost estimation = 627940000000000 wei
gas cost estimation = 0.00062794 ether

</pre>
<div class="paragraph data-line-1055">
<p>Il est recommandé d&#39;évaluer le coût en gaz des fonctions dans le cadre de votre workflow de développement, afin d&#39;éviter toute surprise lors du déploiement de contrats sur le réseau principal.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1057">
<h3 id="_conclusion_4">Conclusion</h3>
<div class="paragraph data-line-17">
<p>Dans ce chapitre, nous avons commencé à travailler en détail avec les contrats intelligents et exploré le langage de programmation de contrats Solidity. Nous avons pris un exemple de contrat simple, <em>Faucet.sol</em>, et l&#39;avons progressivement amélioré et rendu plus complexe, en l&#39;utilisant pour explorer divers aspects du langage Solidity. Dans <a href="#vyper_chap">Contrats intelligents et Vyper</a> nous travaillerons avec Vyper, un autre langage de programmation orienté contrat. Nous comparerons Vyper à Solidity, montrant certaines des différences dans la conception de ces deux langages et approfondirons notre compréhension de la programmation de contrats intelligents.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="vyper_chap">Contrats intelligents et Vyper</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Vyper est un langage de programmation expérimental orienté contrat pour la machine virtuelle Ethereum qui s&#39;efforce de fournir une auditabilité supérieure, en permettant aux développeurs de produire plus facilement du code intelligible. En fait, l&#39;un des principes de Vyper est de rendre pratiquement impossible pour les développeurs d&#39;écrire du code trompeur.</p>
</div>
<div class="paragraph data-line-6">
<p>Dans ce chapitre, nous examinerons les problèmes courants liés aux contrats intelligents, présenterons le langage de programmation de contrats Vyper et le comparerons à Solidity, en démontrant les différences.</p>
</div>
<div class="sect2 data-line-8">
<h3 id="_vulnérabilités_et_vyper">Vulnérabilités et Vyper</h3>
<div class="paragraph data-line-10">
<p><a href="https://arxiv.org/pdf/1802.06038.pdf" data-href="https://arxiv.org/pdf/1802.06038.pdf">Une étude récente</a>  a analysé près d&#39;un million de contrats intelligents Ethereum déployés et a constaté que nombre de ces contrats contenaient de graves vulnérabilités. Au cours de leur analyse, les chercheurs ont défini trois catégories de base de vulnérabilités en trace:</p>
</div>
<div class="dlist data-line-12">
<dl>
<dt class="hdlist1">Contrats suicidaires</dt>
<dd>
<p>Contrats intelligents qui peuvent être tués par des adresses arbitraires</p>
</dd>
<dt class="hdlist1">Contrats cupides</dt>
<dd>
<p>Contrats intelligents pouvant atteindre un état dans lequel ils ne peuvent pas libérer d&#39;ether</p>
</dd>
<dt class="hdlist1">Contrats prodigues</dt>
<dd>
<p>Contrats intelligents pouvant être conclus pour libérer de l&#39;ether à des adresses arbitraires</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-18">
<p>Les vulnérabilités sont introduites dans les contrats intelligents via le code. Il peut être fortement soutenu que ces vulnérabilités et d&#39;autres ne sont pas introduites intentionnellement, mais quoi qu&#39;il en soit, un code de contrat intelligent indésirable entraîne évidemment une perte de fonds inattendue pour les utilisateurs d&#39;Ethereum, et ce n&#39;est pas idéal. Vyper est conçu pour faciliter l&#39;écriture de code sécurisé, ou également pour rendre plus difficile l&#39;écriture accidentelle de code trompeur ou vulnérable.</p>
</div>
</div>
<div class="sect2 data-line-21">
<h3 id="comparison_to_solidity_sec">Comparaison avec Solidity</h3>
<div class="paragraph data-line-23">
<p>L&#39;une des façons dont Vyper essaie de rendre le code dangereux plus difficile à écrire est en <em>omettant</em> délibérément certaines fonctionnalités de Solidity. Il est important pour ceux qui envisagent de développer des contrats intelligents dans Vyper de comprendre quelles fonctionnalités Vyper n&#39;a <em>pas</em>, et pourquoi. Par conséquent, dans cette section, nous allons explorer ces fonctionnalités et expliquer pourquoi elles ont été omises.</p>
</div>
<div class="sect3 data-line-25">
<h4 id="_modificateurs">Modificateurs</h4>
<div class="paragraph data-line-27">
<p>Comme nous l&#39;avons vu dans le chapitre précédent, dans Solidity vous pouvez écrire une fonction à l&#39;aide de modificateurs (modifiers). Par exemple, la fonction suivante, <code>changeOwner</code>, exécutera le code dans un modificateur appelé <code>onlyBy</code> dans le cadre de son exécution :</p>
</div>
<div class="listingblock data-line-30">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">function changeOwner(address _newOwner)
    public
    onlyBy(owner)
{
    owner = _newOwner;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-39">
<p>Ce modificateur applique une règle relative à la propriété. Comme vous pouvez le voir, ce modificateur particulier agit comme un mécanisme pour effectuer une pré-vérification au nom de la fonction <code>changeOwner</code> :</p>
</div>
<div class="listingblock data-line-42">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">modifier onlyBy(address _account)
{
    require(msg.sender == _account);
    _;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-50">
<p>Mais les modificateurs ne sont pas là uniquement pour effectuer des vérifications, comme illustré ici. En fait, en tant que modificateurs, ils peuvent modifier considérablement l&#39;environnement d&#39;un contrat intelligent, dans le contexte de la fonction appelante. En termes simples, les modificateurs sont <em>omniprésents</em>.</p>
</div>
<div class="paragraph data-line-52">
<p>Regardons un autre exemple de style Solidity :</p>
</div>
<div class="listingblock data-line-55">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">enum Stages {
    SafeStage,
    DangerStage,
    FinalStage
}

uint public creationTime = now;
Stages public stage = Stages.SafeStage;

function nextStage() internal {
    stage = Stages(uint(stage) + 1);
}

modifier stageTimeConfirmation() {
    if (stage == Stages.SafeStage &amp;&amp;
                now &gt;= creationTime + 10 days)
        nextStage();
    _;
}

function a()
    public
    stageTimeConfirmation
// Plus de code va ici
{
}</code></pre>
</div>
</div>
<div class="paragraph data-line-84">
<p>D&#39;une part, les développeurs doivent toujours vérifier tout autre code que leur propre code appelle. Cependant, il est possible que dans certaines situations (comme lorsque les contraintes de temps ou l&#39;épuisement entraînent un manque de concentration), un développeur oublie une seule ligne de code. Cela est encore plus probable si le développeur doit se déplacer dans un fichier volumineux tout en gardant mentalement une trace de la hiérarchie des appels de fonction et en mémorisant l&#39;état des variables de contrat intelligent.</p>
</div>
<div class="paragraph data-line-86">
<p>Regardons l&#39;exemple précédent un peu plus en profondeur. Imaginez qu&#39;un développeur écrive une fonction publique appelée &quot;a&quot;. Le développeur est nouveau dans ce contrat et utilise un modificateur écrit par quelqu&#39;un d&#39;autre. En un coup d&#39;œil, il semble que le modificateur <code>stageTimeConfirmation</code> effectue simplement quelques vérifications concernant l&#39;âge du contrat par rapport à la fonction appelante. Ce que le développeur peut <em>ne pas</em> réaliser, c&#39;est que le modificateur appelle également une autre fonction, <code>nextStage</code>. Dans ce scénario de démonstration simpliste, le simple fait d&#39;appeler la fonction publique &quot;a&quot; entraîne le déplacement de la variable &quot;stage&quot; du contrat intelligent de &quot;SafeStage&quot; à &quot;DangerStage&quot;.</p>
</div>
<div class="paragraph data-line-88">
<p>Vyper a complètement supprimé les modificateurs. Les recommandations de Vyper sont les suivantes : si vous n&#39;exécutez que des assertions avec des modificateurs, utilisez simplement des vérifications et des assertions en ligne dans le cadre de la fonction ; si vous modifiez l&#39;état du contrat intelligent, etc., intégrez à nouveau ces modifications explicitement à la fonction. Cela améliore l&#39;auditabilité et la lisibilité, car le lecteur n&#39;a pas à &quot;envelopper&quot; mentalement (ou manuellement) le code du modificateur autour de la fonction pour voir ce qu&#39;elle fait.</p>
</div>
</div>
<div class="sect3 data-line-90">
<h4 id="_héritage_de_classe">Héritage de classe</h4>
<div class="paragraph data-line-92">
<p>L&#39;héritage permet aux programmeurs pour exploiter la puissance du code pré-écrit en acquérant des fonctionnalités, des propriétés et des comportements préexistants à partir de bibliothèques de logiciels existantes. L&#39;héritage est puissant et favorise la réutilisation du code. Solidity prend en charge l&#39;héritage multiple ainsi que le polymorphisme, mais bien que ce soient des fonctionnalités clés de la programmation orientée objet, Vyper ne les prend pas en charge. Vyper soutient que la mise en œuvre de l&#39;héritage nécessite que les codeurs et les auditeurs sautent entre plusieurs fichiers afin de comprendre ce que fait le programme. Vyper considère également que l&#39;héritage multiple peut rendre le code trop compliqué à comprendre - un point de vue tacitement admis par la <a href="http://bit.ly/2Q6Azvo" data-href="http://bit.ly/2Q6Azvo">documentation</a> Solidity, qui donne un exemple de la façon dont l&#39;héritage multiple peut être problématique.</p>
</div>
</div>
<div class="sect3 data-line-94">
<h4 id="_assemblage_en_ligne">Assemblage en ligne</h4>
<div class="paragraph data-line-96">
<p>L&#39;assemblage en ligne donne aux développeurs un accès de bas niveau à Ethereum Virtual Machine, permettant aux programmes Solidity d&#39;effectuer des opérations en accédant directement aux instructions EVM. Par exemple, le code assembleur en ligne suivant ajoute 3 à l&#39;emplacement mémoire 0x80 :</p>
</div>
<div class="listingblock data-line-98">
<div class="content">
<pre>3 0x80 mload add 0x80 mstore</pre>
</div>
</div>
<div class="paragraph data-line-102">
<p>Vyper considère que la perte de lisibilité est un prix trop élevé à payer pour la puissance supplémentaire et ne prend donc pas en charge l&#39;assemblage en ligne.</p>
</div>
</div>
<div class="sect3 data-line-104">
<h4 id="_surcharge_de_fonction">Surcharge de fonction</h4>
<div class="paragraph data-line-106">
<p>La surcharge de fonction permet aux développeurs d&#39;écrire plusieurs fonctions du même nom. La fonction utilisée à une occasion donnée dépend des types d&#39;arguments fournis. Prenons par exemple les deux fonctions suivantes :</p>
</div>
<div class="listingblock data-line-109">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">function f(uint _in) public pure returns (uint out) {
    out = 1;
}

function f(uint _in, bytes32 _key) public pure returns (uint out) {
    out = 2;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-119">
<p>La première fonction (nommée f) accepte un argument d&#39;entrée de type uint ; la deuxième fonction (également nommée f) accepte deux arguments, un de type uint et un de type bytes32. Avoir plusieurs définitions de fonction avec le même nom prenant des arguments différents peut être déroutant, donc Vyper ne prend pas en charge la surcharge de fonction.</p>
</div>
</div>
<div class="sect3 data-line-121">
<h4 id="_conversion_de_type_variable">Conversion de type variable</h4>
<div class="paragraph data-line-123">
<p>Il existe deux types de typage : <em>implicit</em> et <em>explicit</em></p>
</div>
<div class="paragraph data-line-125">
<p>Le transtypage implicite est souvent effectué au moment de la compilation. Par exemple, si une conversion de type est sémantiquement correcte et qu&#39;aucune information n&#39;est susceptible d&#39;être perdue, le compilateur peut effectuer une conversion implicite, telle que la conversion d&#39;une variable de type uint8 en uint16. Les premières versions de Vyper autorisaient le transtypage implicite des variables, mais pas les versions récentes.</p>
</div>
<div class="paragraph data-line-127">
<p>Les transtypages explicites peuvent être insérés dans Solidity. Malheureusement, ils peuvent entraîner des comportements inattendus. Par exemple, convertir un uint32 en un type plus petit uint16 supprime simplement les bits d&#39;ordre supérieur, comme illustré ici :</p>
</div>
<div class="listingblock data-line-130">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">uint32 a = 0x12345678;
uint16 b = uint16(a);
// La variable b est 0x5678 maintenant</code></pre>
</div>
</div>
<div class="paragraph data-line-136">
<p>Vyper a à la place une fonction convert pour effectuer des transtypages explicites. La fonction convert (trouvée à la ligne 82 de <a href="http://bit.ly/2P36ZKT" data-href="http://bit.ly/2P36ZKT"><em>convert.py</em></a>) :</p>
</div>
<div class="listingblock data-line-139">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def convert(expr, context):
    output_type = expr.args[1].s
    if output_type in conversion_table:
        return conversion_table[output_type](expr, context)
    else:
        raise Exception("Conversion to {} is invalid.".format(output_type))</code></pre>
</div>
</div>
<div class="paragraph data-line-148">
<p>Notez l&#39;utilisation de conversion_table (trouvé à la ligne 90 du même fichier), qui ressemble à ceci :</p>
</div>
<div class="listingblock data-line-151">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">conversion_table = {
    'int128': to_int128,
    'uint256': to_unint256,
    'decimal': to_decimal,
    'bytes32': to_bytes32,
}</code></pre>
</div>
</div>
<div class="paragraph data-line-160">
<p>Lorsqu&#39;un développeur appelle convert, il fait référence à conversion_table, ce qui garantit que la conversion appropriée est effectuée. Par exemple, si un développeur passe un int128 à la fonction convert, la fonction to_int128 à la ligne 26 du même fichier (<em>convert.py</em>) sera exécutée. La fonction to_int128 est la suivante :</p>
</div>
<div class="listingblock data-line-163">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@signature(('int128', 'uint256', 'bytes32', 'bytes'), 'str_literal')
def to_int128(expr, args, kwargs, context):
    in_node = args[0]
    typ, len = get_type(in_node)
    if typ in ('int128', 'uint256', 'bytes32'):
        if in_node.typ.is_literal
            and not SizeLimits.MINNUM &lt;= in_node.value &lt;= SizeLimits.MAXNUM:
            raise InvalidLiteralException(
                "Number out of range: {}".format(in_node.value), expr
            )
        return LLLnode.from_list(
            ['clamp', ['mload', MemoryPositions.MINNUM], in_node,
            ['mload', MemoryPositions.MAXNUM]], typ=BaseType('int128'),
            pos=getpos(expr)
        )
    else:
        return byte_array_to_num(in_node, expr, 'int128')</code></pre>
</div>
</div>
<div class="paragraph data-line-183">
<p>Comme vous pouvez le constater, le processus de conversion garantit qu&#39;aucune information ne peut être perdue. si c&#39;est possible, une exception est levée. Le code de conversion empêche la troncation ainsi que d&#39;autres anomalies qui seraient normalement autorisées par un transtypage implicite.</p>
</div>
<div class="paragraph data-line-185">
<p>Choisir un transtypage explicite plutôt qu&#39;implicite signifie que le développeur est responsable de l&#39;exécution de tous les transtypages. Bien que cette approche produise un code plus détaillé, elle améliore également la sécurité et la vérifiabilité des contrats intelligents.</p>
</div>
</div>
<div class="sect3 data-line-188">
<h4 id="_préconditions_et_postconditions">Préconditions et Postconditions</h4>
<div class="paragraph data-line-190">
<p>Vyper gère explicitement les préconditions, les postconditions et les changements d&#39;état. Bien que cela produise un code redondant, cela permet également une lisibilité et une sécurité maximales. Lors de la rédaction d&#39;un contrat intelligent dans Vyper, un développeur doit observer les trois points suivants :</p>
</div>
<div class="dlist data-line-192">
<dl>
<dt class="hdlist1">Condition</dt>
<dd>
<p>Quel est l&#39;état/condition actuel des variables d&#39;état Ethereum ?</p>
</dd>
<dt class="hdlist1">Effets</dt>
<dd>
<p>Quels effets ce code de contrat intelligent aura-t-il sur la condition des variables d&#39;état lors de l&#39;exécution ? Autrement dit, qu&#39;est-ce qui sera affecté et qu&#39;est-ce qui ne sera pas affecté ? Ces effets sont-ils conformes aux intentions du contrat intelligent ?</p>
</dd>
<dt class="hdlist1">Interaction</dt>
<dd>
<p>Une fois que les deux premières considérations ont été traitées de manière exhaustive, il est temps d&#39;exécuter le code. Avant le déploiement, parcourez logiquement le code et examinez tous les résultats permanents possibles, les conséquences et les scénarios d&#39;exécution du code, y compris les interactions avec d&#39;autres contrats.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-199">
<p>Idéalement, chacun de ces points devrait être soigneusement examiné puis documenté de manière approfondie dans le code. Cela améliorera la conception du code, le rendant finalement plus lisible et auditable.</p>
</div>
</div>
</div>
<div class="sect2 data-line-202">
<h3 id="decorators_sec">Décorateurs</h3>
<div class="paragraph data-line-203">
<p>Les décorateurs suivants peuvent être utilisés au début de chaque fonction :</p>
</div>
<div class="dlist data-line-205">
<dl>
<dt class="hdlist1">@private </dt>
<dd>
<p>Le décorateur <code>@private</code> rend la fonction inaccessible depuis l&#39;extérieur du contrat.</p>
</dd>
<dt class="hdlist1">@public </dt>
<dd>
<p>Le décorateur <code>@public</code> rend la fonction à la fois visible et exécutable publiquement. Par exemple, même le portefeuille Ethereum affichera de telles fonctions lors de la visualisation du contrat.</p>
</dd>
<dt class="hdlist1">@constant </dt>
<dd>
<p>Les fonctions avec le décorateur <code>@constant</code> ne sont pas autorisées à modifier les variables d&#39;état. En fait, le compilateur rejettera le programme entier (avec une erreur appropriée) si la fonction essaie de changer une variable d&#39;état.</p>
</dd>
<dt class="hdlist1">@payable </dt>
<dd>
<p>Seules les fonctions avec le décorateur <code>@payable</code> sont autorisées à transférer de la valeur.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-213">
<p>Vyper implémente explicitement <a href="http://bit.ly/2P14RDq" data-href="http://bit.ly/2P14RDq">la logique des décorateurs</a>. Par exemple, le processus de compilation de Vyper échouera si une fonction a à la fois un décorateur <code>@payable</code> et un décorateur <code>@constant</code>. Cela a du sens car une fonction qui transfère une valeur a par définition mis à jour l&#39;état, elle ne peut donc pas être <code>@constant</code>. Chaque fonction Vyper doit être décorée avec <code>@public</code> ou <code>@private</code> (mais pas les deux !).</p>
</div>
</div>
<div class="sect2 data-line-216">
<h3 id="order_of_functions_sec">Ordre des fonctions et des variables</h3>
<div class="paragraph data-line-218">
<p>Chaque contrat intelligent Vyper individuel se compose d&#39;un seul fichier Vyper uniquement. En d&#39;autres termes, tout le code d&#39;un contrat intelligent Vyper donné, y compris toutes les fonctions, variables, etc., existe au même endroit. Vyper exige que la fonction et les déclarations de variables de chaque contrat intelligent soient écrites physiquement dans un ordre particulier. Solidity n&#39;a pas du tout cette exigence. Jetons un coup d&#39;œil à un exemple Solidity :</p>
</div>
<div class="listingblock data-line-221">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">pragma solidity ^0.4.0;

contract ordering {

    function topFunction()
    external
    returns (bool) {
        initiatizedBelowTopFunction = this.lowerFunction();
        return initiatizedBelowTopFunction;
    }

    bool initiatizedBelowTopFunction;
    bool lowerFunctionVar;

    function lowerFunction()
    external
    returns (bool) {
        lowerFunctionVar = true;
        return lowerFunctionVar;
    }

}</code></pre>
</div>
</div>
<div class="paragraph data-line-246">
<p>Dans cet exemple, la fonction appelée topFunction appelle une autre fonction, lowerFunction. topFunction attribue également une valeur à une variable appelée initiatizedBelowTopFunction. Comme vous pouvez le voir, Solidity n&#39;exige pas que ces fonctions et variables soient physiquement déclarées avant d&#39;être appelées par le code d&#39;exécution. Il s&#39;agit d&#39;un code Solidity valide qui se compilera avec succès.</p>
</div>
<div class="paragraph data-line-248">
<p>Les exigences de commande de Vyper ne sont pas une nouveauté ; en fait, ces exigences de commande ont toujours été présentes dans la programmation Python. La commande requise par Vyper est simple et logique, comme illustré dans cet exemple suivant :</p>
</div>
<div class="listingblock data-line-251">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># Déclarez une variable appelée theBool
theBool: public(bool)

# Déclarez une fonction appelée topFunction
@public
def topFunction() -&gt; bool:
# Attribuez une valeur à la fonction déjà déclarée appelée theBool
    self.theBool = True
    return self.theBool

# Déclarez une fonction appelée lowerFunction
@public
def lowerFunction():
# Appelez la fonction déjà déclarée appelée topFunction
    assert self.topFunction()</code></pre>
</div>
</div>
<div class="paragraph data-line-269">
<p>Cela montre le bon ordre des fonctions et des variables dans un contrat intelligent Vyper. Notez comment la variable theBool et la fonction topFunction sont déclarées avant qu&#39;elles ne reçoivent une valeur et ne soient appelées, respectivement. Si theBool était déclaré sous topFunction ou si topFunction était déclaré sous lowerFunction, ce contrat ne serait pas compilé.</p>
</div>
</div>
<div class="sect2 data-line-272">
<h3 id="online_code_editor_and_compiler_sec">Compilation</h3>
<div class="paragraph data-line-273">
<p>Vyper a son propre <a href="https://vyper.online" data-href="https://vyper.online">éditeur de code et compilateur en ligne</a>, qui vous permet d&#39;écrire puis compilez vos contrats intelligents en bytecode, ABI et LLL en utilisant uniquement votre navigateur Web. Le compilateur en ligne Vyper propose une variété de contrats intelligents pré-écrits pour votre commodité, y compris des contrats pour une simple enchère ouverte, des achats à distance sécurisés, des jetons ERC20, etc. Cet outil, propose une seule version du logiciel de compilation. Il est mis à jour régulièrement mais ne garantit pas toujours la dernière version. Etherscan a un <a href="https://etherscan.io/vyper" data-href="https://etherscan.io/vyper">compilateur Vyper en ligne</a> qui vous permet de sélectionner la version du compilateur. De plus, <a href="https://remix.ethereum.org" data-href="https://remix.ethereum.org">Remix</a>, conçu à l&#39;origine pour les contrats intelligents Solidity, dispose désormais d&#39;un plug-in Vyper disponible dans l&#39;onglet Paramètres.</p>
</div>
<div class="admonitionblock note data-line-276">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-277">
<p>Vyper implémente ERC20 en tant que contrat précompilé, ce qui permet d&#39;utiliser facilement ces contrats intelligents prêts à l&#39;emploi. Les contrats dans Vyper doivent être déclarés en tant que variables globales. Un exemple de déclaration de la variable ERC20 est le suivant :</p>
</div>
<div class="listingblock data-line-280">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">token: address(ERC20)</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-285">
<p>Vous pouvez également compiler un contrat à l&#39;aide de la ligne de commande. Chaque contrat Vyper est enregistré dans un seul fichier avec l&#39;extension <em>.vy</em>.
Une fois installé, vous pouvez compiler un contrat avec Vyper en exécutant la commande suivante :</p>
</div>
<div class="listingblock data-line-288">
<div class="content">
<pre>vyper ~/hello_world.vy</pre>
</div>
</div>
<div class="paragraph data-line-292">
<p>La description ABI lisible par l&#39;homme (au format JSON) peut ensuite être obtenue en exécutant la commande suivante :</p>
</div>
<div class="listingblock data-line-294">
<div class="content">
<pre>vyper -f json ~/hello_world.v.py</pre>
</div>
</div>
</div>
<div class="sect2 data-line-299">
<h3 id="protecting_against_overflows_sec">Protection contre les erreurs de débordement au niveau du compilateur</h3>
<div class="paragraph data-line-301">
<p>Les erreurs de débordement dans le logiciel peut être catastrophique lorsqu&#39;il s&#39;agit de valeur réelle. Par exemple, une <a href="http://bit.ly/2yHfvoF" data-href="http://bit.ly/2yHfvoF">transaction de la mi-avril 2018</a> montre le <span class="keep-together">transfert malveillant de plus de 57 896 044 618 658 100 000 000 000 000 000 000 000 000,</span>000 000 000 000 000 000 tokens ou jetons BEC. Cette transaction était le résultat d&#39;un problème de débordement d&#39;entier dans le contrat de jeton ERC20 de BeautyChain (<em>BecToken.sol</em>). Les développeurs de Solidity ont accès à des bibliothèques comme <a href="http://bit.ly/2ABhb4l" data-href="http://bit.ly/2ABhb4l">SafeMath</a> ainsi qu&#39;à des outils d&#39;analyse de la sécurité des contrats intelligents Ethereum comme <a href="http://bit.ly/2CQRoGU" data-href="http://bit.ly/2CQRoGU">Mythril OSS</a>. Cependant, les développeurs ne sont pas obligés d&#39;utiliser les outils de sécurité. En termes simples, si la sécurité n&#39;est pas appliquée par le langage, les développeurs peuvent écrire du code non sécurisé qui se compilera avec succès et s&#39;exécutera plus tard &quot;avec succès&quot;.</p>
</div>
<div class="paragraph data-line-303">
<p>Vyper dispose d&#39;une protection intégrée contre les débordements, mise en œuvre selon une approche à deux volets. Tout d&#39;abord, Vyper fournit <a href="http://bit.ly/2PuDfpB" data-href="http://bit.ly/2PuDfpB">un SafeMath équivalent</a> qui inclut les cas d&#39;exception nécessaires pour l&#39;arithmétique entière. Deuxièmement, Vyper utilise des pinces chaque fois qu&#39;une constante littérale est chargée, qu&#39;une valeur est transmise à une fonction ou qu&#39;une variable est affectée. Les pinces sont implémentées via des fonctions personnalisées dans le compilateur LLL (Low-level Lisp-like Language) et ne peuvent pas être désactivées. (Le compilateur Vyper génère LLL plutôt que le bytecode EVM ; cela simplifie le développement de Vyper lui-même.)</p>
</div>
</div>
<div class="sect2 data-line-307">
<h3 id="reading_and_writing_data_sec">Lecture et écriture de données</h3>
<div class="paragraph data-line-308">
<p>Bien qu&#39;il soit coûteux de stocker, lire et modifier des données, ces opérations de stockage sont une composante nécessaire de la plupart des contrats intelligents. Les contrats intelligents peuvent écrire des données à deux endroits :</p>
</div>
<div class="dlist data-line-310">
<dl>
<dt class="hdlist1">État global</dt>
<dd>
<p> Les variables d&#39;état d&#39;un contrat intelligent donné sont stockées dans le trie d&#39;état global d&#39;Ethereum ; un contrat intelligent ne peut stocker, lire et modifier que des données relatives à l&#39;adresse de ce contrat particulier (c&#39;est-à-dire que les contrats intelligents ne peuvent pas lire ou écrire dans d&#39;autres contrats intelligents).</p>
</dd>
<dt class="hdlist1">Journaux</dt>
<dd>
<p>Un contrat intelligent peut également écrire dans les données de la chaîne d&#39;Ethereum via des événements de journal. Alors que Vyper utilisait initialement la syntaxe <code>__log__</code> pour déclarer ces événements, une mise à jour a été effectuée pour aligner davantage sa déclaration d&#39;événement sur la syntaxe d&#39;origine de Solidity. Par exemple, la déclaration par Vyper d&#39;un événement appelé <code>MyLog</code> était à l&#39;origine <code>MyLog: __log__({arg1: indexed(bytes[3])})</code>. La syntaxe est maintenant devenue <code>MyLog: event({arg1: indexed(bytes[3])})</code>. Il est important de noter que l&#39;exécution de l&#39;événement de journalisation dans Vyper était, et est toujours, comme suit : <code>log.MyLog(&quot;123&quot;)</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-314">
<p>Bien que les contrats intelligents puissent écrire dans les données de la chaîne d&#39;Ethereum (via des événements de journal), ils ne peuvent pas lire les événements de journal en chaîne qu&#39;ils ont créés. Néanmoins, l&#39;un des avantages de l&#39;écriture dans les données de la chaîne d&#39;Ethereum via des événements de journal est que les journaux peuvent être découverts et lus, sur la chaîne publique, par des clients légers. Par exemple, la valeur logsBloom dans un bloc extrait peut indiquer si un événement de journal est présent ou non. Une fois que l&#39;existence d&#39;événements de journal a été établie, les données de journal peuvent être obtenues à partir d&#39;un reçu de transaction donné.</p>
</div>
</div>
<div class="sect2 data-line-317">
<h3 id="_conclusion_5">Conclusion</h3>
<div class="paragraph data-line-19">
<p>Vyper est un nouveau langage de programmation orienté contrat puissant et intéressant. Sa conception est biaisée vers &quot;l&#39;exactitude&quot;, au détriment d&#39;une certaine flexibilité. Cela peut permettre aux programmeurs de rédiger de meilleurs contrats intelligents et d&#39;éviter certains pièges qui provoquent l&#39;apparition de graves vulnérabilités. Ensuite, nous examinerons plus en détail la sécurité des contrats intelligents. Certaines des nuances de la conception de Vyper peuvent devenir plus apparentes une fois que vous avez lu tous les problèmes de sécurité possibles qui peuvent survenir dans les contrats intelligents.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="smart_contract_security">Sécurité des contrats intelligents</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>La sécurité est l&#8217;une des considérations les plus importantes lors de la rédaction de contrats intelligents. Dans le domaine de la programmation de contrats intelligents, les erreurs sont coûteuses et facilement exploitables. Dans ce chapitre, nous examinerons les meilleures pratiques de sécurité et les modèles de conception, ainsi que les «anti-modèles de sécurité», qui sont des pratiques et des modèles qui peuvent introduire des vulnérabilités dans nos contrats intelligents.</p>
</div>
<div class="paragraph data-line-6">
<p>Comme avec d&#8217;autres programmes, un contrat intelligent exécutera exactement ce qui est écrit, ce qui n&#8217;est pas toujours ce que le programmeur avait prévu. De plus, tous les contrats intelligents sont publics et tout utilisateur peut interagir avec eux simplement en créant une transaction. Toute vulnérabilité peut être exploitée et les pertes sont presque toujours impossibles à récupérer. Il est donc essentiel de suivre les meilleures pratiques et d&#8217;utiliser des modèles de conception éprouvés.</p>
</div>
<div class="sect2 data-line-8">
<h3 id="_meilleures_pratiques_de_sécurité">Meilleures pratiques de sécurité</h3>
<div class="paragraph data-line-10">
<p><em>La programmation défensive</em> est un style de programmation particulièrement bien adapté aux contrats intelligents. Il met l&#8217;accent sur les éléments suivants, qui sont tous des pratiques exemplaires :</p>
</div>
<div class="dlist data-line-12">
<dl>
<dt class="hdlist1">Minimalisme/simplicité</dt>
<dd>
<p>La complexité est l&#8217;ennemie de la sécurité. Plus le code est simple et moins il en fait, moins il y a de chances qu&#8217;un bogue ou un effet imprévu se produise. Lorsqu&#8217;ils s&#8217;engagent pour la première fois dans la programmation de contrats intelligents, les développeurs sont souvent tentés d&#8217;essayer d&#8217;écrire beaucoup de code. Au lieu de cela, vous devriez parcourir votre code de contrat intelligent et essayer de trouver des moyens d&#8217;en faire moins, avec moins de lignes de code, moins de complexité et moins de "fonctionnalités". Si quelqu&#8217;un vous dit que son projet a produit "des milliers de lignes de code" pour ses contrats intelligents, vous devez vous interroger sur la sécurité de ce projet. Plus simple est plus sûr.</p>
</dd>
<dt class="hdlist1">Réutilisation du code</dt>
<dd>
<p>Essayez de ne pas réinventer la roue. S&#8217;il existe déjà une bibliothèque ou un contrat qui fait la plupart de ce dont vous avez besoin, réutilisez-le. Dans votre propre code, suivez le principe DRY (Don&#8217;t Repeat Yourself) : ne vous répétez pas. Si vous voyez un extrait de code répété plus d&#8217;une fois, demandez-vous s&#8217;il pourrait être écrit en tant que fonction ou bibliothèque et réutilisé. Le code qui a été largement utilisé et testé est probablement plus sécurisé que tout nouveau code que vous écrivez. Méfiez-vous du syndrome "Pas inventé ici", où vous êtes tenté d'"améliorer" une fonctionnalité ou un composant en le construisant à partir de zéro. Le risque de sécurité est souvent supérieur à la valeur d&#8217;amélioration.</p>
</dd>
<dt class="hdlist1">Qualité du code</dt>
<dd>
<p>Le code de contrat intelligent est impitoyable. Chaque bogue peut entraîner une perte monétaire. Vous ne devez pas traiter la programmation de contrats intelligents de la même manière que la programmation à usage général. Écrire des DApps dans Solidity n&#8217;est pas comme créer un widget Web en JavaScript. Vous devez plutôt appliquer des méthodologies d&#8217;ingénierie et de développement de logiciels rigoureuses, comme vous le feriez dans l&#8217;ingénierie aérospatiale ou dans toute discipline similairement impitoyable. Une fois que vous avez "lancé" votre code, vous ne pouvez pas faire grand-chose pour résoudre les problèmes.</p>
</dd>
<dt class="hdlist1">Lisibilité/auditabilité</dt>
<dd>
<p>Votre code doit être clair et facile à comprendre. Plus c&#8217;est facile à lire, plus c&#8217;est facile à auditer. Les contrats intelligents sont publics, car tout le monde peut lire le bytecode et tout le monde peut le désosser. Par conséquent, il est avantageux de développer votre travail en public, en utilisant des méthodologies collaboratives et à source libre, pour tirer parti de la sagesse collective de la communauté des développeurs et bénéficier du plus grand dénominateur commun du développement à source libre. Vous devez écrire un code bien documenté et facile à lire, en suivant les conventions de style et de nommage qui font partie de la communauté Ethereum.</p>
</dd>
<dt class="hdlist1">Couverture de test</dt>
<dd>
<p>Testez tout ce que vous pouvez. Les contrats intelligents s&#8217;exécutent dans un environnement d&#8217;exécution public, où n&#8217;importe qui peut les exécuter avec la contribution de son choix. Vous ne devez jamais supposer que l&#8217;entrée, telle que les arguments de fonction, est bien formée, correctement délimitée ou a un objectif bénin. Testez tous les arguments pour vous assurer qu&#8217;ils se situent dans les plages attendues et qu&#8217;ils sont correctement formatés avant d&#8217;autoriser la poursuite de l&#8217;exécution de votre code.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2 data-line-22">
<h3 id="_risques_de_sécurité_et_anti_modèles">Risques de sécurité et anti-modèles</h3>
<div class="paragraph data-line-24">
<p>En tant que programmeur de contrats intelligents, vous devez être familiarisé avec les risques de sécurité les plus courants, afin de pouvoir détecter et éviter les modèles de programmation qui exposent vos contrats à ces risques. Dans les sections suivantes, nous examinerons différents risques de sécurité, des exemples de la façon dont les vulnérabilités peuvent survenir et des contre-mesures ou des solutions préventives qui peuvent être utilisées pour y faire face.</p>
</div>
</div>
<div class="sect2 data-line-27">
<h3 id="reentrancy_security">Réentrance</h3>
<div class="paragraph data-line-29">
<p>L&#8217;une des caractéristiques des contrats intelligents Ethereum est leur capacité à appeler et à utiliser le code d&#8217;autres contrats externes. Les contrats gèrent également généralement l&#8217;ether et, en tant que tels, envoient souvent de l&#8217;ether à diverses adresses d&#8217;utilisateurs externes. Ces opérations nécessitent que les contrats soumettent des appels externes. Ces appels externes peuvent être détournés par des attaquants, qui peuvent forcer les contrats à exécuter du code supplémentaire (via une fonction de secours ), y compris des rappels vers eux-mêmes. Des attaques de ce type ont été utilisées dans le tristement célèbre <a href="http://bit.ly/2DamSZT" data-href="http://bit.ly/2DamSZT">piratage DAO</a> .</p>
</div>
<div class="paragraph data-line-31">
<p>Pour en savoir plus sur les attaques par réentrance , voir <a href="http://bit.ly/2zaqSEY" data-href="http://bit.ly/2zaqSEY">l&#8217;article de blog</a> de Gus Guimareas sur le sujet et les <a href="http://bit.ly/2ERDMxV" data-href="http://bit.ly/2ERDMxV">meilleures pratiques pour les contrats intelligents Ethereum</a>.</p>
</div>
<div class="sect3 notoc data-line-34">
<h4 id="_la_vulnérabilité">La vulnérabilité</h4>
<div class="paragraph data-line-36">
<p>Ce type d&#8217;attaque peut se produire lorsqu&#8217;un contrat envoie de l&#8217;ether à une adresse inconnue. Un attaquant peut soigneusement construire un contrat à une adresse externe qui contient du code malveillant dans la fonction de secours. Ainsi, lorsqu&#8217;un contrat envoie de l&#8217;ether à cette adresse, il invoquera le code malveillant. Généralement , le code malveillant exécute une fonction sur le contrat vulnérable, effectuant des opérations non prévues par le développeur. Le terme « réentrance » vient du fait que le contrat externe malveillant appelle une fonction sur le contrat vulnérable et que le chemin d&#8217;exécution du code le « <em>réintègre</em> ». Pour clarifier cela, considérons le simple contrat vulnérable dans <a href="#etherstore_vulnerable">EtherStore.sol</a> , qui agit comme un coffre-fort Ethereum qui permet aux déposants de retirer seulement 1 ether par semaine.</p>
</div>
<div id="etherstore_vulnerable" class="exampleblock data-line-40">
<div class="title">Example 7. EtherStore.sol</div>
<div class="content">
<div class="listingblock data-line-42">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract EtherStore {

    uint256 public withdrawalLimit = 1 ether;
    mapping(address =&gt; uint256) public lastWithdrawTime;
    mapping(address =&gt; uint256) public balances;

    function depositFunds() external payable {
        balances[msg.sender] += msg.value;
    }

    function withdrawFunds (uint256 _weiToWithdraw) public {
        require(balances[msg.sender] &gt;= _weiToWithdraw);
        // limite le retrait
        require(_weiToWithdraw &lt;= withdrawalLimit);
        // limite le temps accordé pour se rétracter
        require(now &gt;= lastWithdrawTime[msg.sender] + 1 weeks);
        require(msg.sender.call.value(_weiToWithdraw)());
        balances[msg.sender] -= _weiToWithdraw;
        lastWithdrawTime[msg.sender] = now;
    }
 }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-67">
<p>Ce contrat a deux fonctions publiques, <code>depositFunds</code> et <code>removeFunds</code>. La fonction de dépôt de fonds incrémente simplement le solde de l&#8217;expéditeur. La fonction de retrait de fonds permet à l&#8217;expéditeur de spécifier le montant de wei à retirer. Cette fonction est destinée à réussir uniquement si le montant demandé à retirer est inférieur à 1 ether et qu&#8217;aucun retrait n&#8217;a eu lieu la semaine dernière.</p>
</div>
<div class="paragraph data-line-69">
<p>La vulnérabilité se trouve à la ligne 17, où le contrat envoie à l&#8217;utilisateur la quantité d&#8217;ether demandée. Considérez un attaquant qui a créé le contrat dans <a href="#etherstore_attack">Attack.sol</a> .</p>
</div>
<div id="etherstore_attack" class="exampleblock data-line-73">
<div class="title">Example 8. Attack.sol</div>
<div class="content">
<div class="listingblock data-line-75">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "EtherStore.sol";

contract Attack {
  EtherStore public etherStore;

  // initialise la variable etherStore avec l'adresse du contrat
  constructor(address _etherStoreAddress) {
      etherStore = EtherStore(_etherStoreAddress);
  }

  function attackEtherStore() external payable {
      // attaque à l'ether le plus proche
      require(msg.value &gt;= 1 ether);
      // envoie eth à la fonction depositFunds()
      etherStore.depositFunds.value(1 ether)();
      // début de magie
      etherStore.withdrawFunds(1 ether);
  }

  function collectEther() public {
      msg.sender.transfer(this.balance);
  }

  // fonction de secours - où la magie opère
  function () payable {
      if (etherStore.balance &gt; 1 ether) {
          etherStore.withdrawFunds(1 ether);
      }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-109">
<p>Comment l&#8217;exploit peut-il se produire ? Tout d&#8217;abord, l&#8217;attaquant créerait le contrat malveillant (disons à l&#8217;adresse <code>0x0&#8230;&#8203;123</code>) avec l' adresse de contrat de l' <code>EtherStore</code> comme seul paramètre constructeur. Cela initialiserait et pointerait la variable publique <code>etherStore</code> vers le contrat à attaquer.</p>
</div>
<div class="paragraph data-line-111">
<p>L&#8217;attaquant appellerait alors la fonction <code>attackEtherStore</code> , avec une certaine quantité d&#8217;ether supérieure ou égale à 1 - supposons <code>1 ether</code> pour le moment. Dans cet exemple, nous supposerons également qu&#8217;un certain nombre d&#8217;autres utilisateurs ont déposé de l&#8217;ether dans ce contrat, de sorte que son solde actuel est de <code>10 ether</code>. La suite sera alors ainsi :</p>
</div>
<div class="olist arabic data-line-113">
<ol class="arabic">
<li class="data-line-113">
<p><em>Attack.sol</em> , ligne 15 : La fonction <code>DepositFunds</code> du contrat <code>EtherStore</code> sera appelée avec un <code>msg.value</code> de <code>1 ether</code> (et beaucoup de gaz). L&#8217;expéditeur (<code>msg.sender</code>) sera le contrat malveillant ( <code>0x0&#8230;&#8203;​123</code> ). Ainsi , <code>balances[0x0&#8230;&#8203;123] = 1 ether</code>.</p>
</li>
<li class="data-line-115">
<p><em>Attack.sol</em> , ligne 17 : Le contrat malveillant va alors appeler la fonction <code>withdrawFunds</code> du contrat <code>EtherStore</code> avec un paramètre de <code>1 ether</code> . Cela satisfera à toutes les exigences (lignes 12 à 16 du contrat <code>EtherStore</code> ) car aucun retrait précédent n&#8217;a été effectué.</p>
</li>
<li class="data-line-117">
<p><em>EtherStore.sol</em> , ligne 17 : Le contrat renverra <code>1 ether</code> au <span class="keep-together">contrat</span> malveillant.</p>
</li>
<li class="data-line-119">
<p><em>Attack.sol</em> , ligne 25 : Le paiement au contrat malveillant exécutera alors la fonction de secours.</p>
</li>
<li class="data-line-121">
<p><em>Attack.sol</em> , ligne 26 : Le solde total du contrat EtherStore était de <code>10 ether</code> et est maintenant de <code>9 ether</code> , donc cette instruction if passe.</p>
</li>
<li class="data-line-123">
<p><em>Attack.sol</em> , ligne 27 : La fonction de secours appelle de l' <code>EtherStore</code> la fonction <code>withdrawFunds</code> à nouveau et « réintègre » le contrat <code>EtherStore</code> .</p>
</li>
<li class="data-line-125">
<p><em>EtherStore.sol</em> , ligne 11 : Dans ce deuxième appel à <code>withdrawFunds</code> , le solde du contrat attaquant est toujours de <code>1 ether</code> car la ligne 18 n&#8217;a pas encore été exécutée. Ainsi, nous avons toujours <code>balances[0x0&#8230;&#8203;123] = 1 ether</code> . C&#8217;est également le cas pour la variable <code>lastWithdrawTime</code> . Encore une fois , nous passons toutes les exigences .</p>
</li>
<li class="data-line-127">
<p><em>EtherStore.sol</em> , ligne 17 : Le contrat attaquant retire un autre <code>1 ether</code> .</p>
</li>
<li class="data-line-129">
<p>Répétez les étapes 4 à 8 jusqu&#8217;à ce qu&#8217;il ne soit plus le cas que <code>EtherStore.balance &gt; 1</code> , comme dicté par la ligne 26 dans <em>Attack.sol</em> .</p>
</li>
<li class="data-line-131">
<p><em>Attack.sol</em> , ligne 26 : Une fois qu&#8217;il reste 1 (ou moins) d&#8217;ether dans le contrat <code>EtherStore</code> , cette instruction <code>if</code> échouera. Cela permettra alors d&#8217;exécuter les lignes 18 et 19 du contrat <code>EtherStore</code> (pour chaque appel à la fonction <code>withdrawFunds</code>).</p>
</li>
<li class="data-line-133">
<p><em>EtherStore.sol</em> , lignes 18 et 19 : Les mappages <code>balances</code> et <code>lastWithdrawTime</code> seront définis et l&#8217;exécution se terminera.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-135">
<p>Le résultat final est que l&#8217;attaquant a retiré tous les ethers sauf 1 du contrat <code>EtherStore</code> en une seule transaction.</p>
</div>
</div>
<div class="sect3 notoc data-line-138">
<h4 id="_techniques_préventives">Techniques préventives</h4>
<div class="paragraph data-line-140">
<p>Il existe un certain nombre de techniques courantes qui permettent d&#8217;éviter les vulnérabilités potentielles de réentrance dans les contrats intelligents. La première consiste à (dans la mesure du possible) utiliser la fonction de <a href="http://bit.ly/2Ogvnng" data-href="http://bit.ly/2Ogvnng">transfert</a> intégrée lors de l&#8217;envoi d&#8217;ether à des contrats externes. La fonction de transfert n&#8217;envoie que 2300 gaz avec l&#8217;appel externe, ce qui n&#8217;est pas suffisant pour que l&#8217;adresse/le contrat de destination appelle un autre contrat (c&#8217;est-à-dire qu&#8217;il ressaisisse le contrat d&#8217;envoi).</p>
</div>
<div class="paragraph data-line-142">
<p>La deuxième technique consiste à s&#8217;assurer que toute la logique qui modifie les variables d&#8217;état se produit avant que l&#8217;ether ne soit envoyé hors du contrat (ou de tout appel externe). Dans l' exemple <code>EtherStore</code>, les lignes 18 et 19 de <em>EtherStore.sol</em> doivent être placées avant la ligne 17. Il est recommandé que tout code effectuant des appels externes à des adresses inconnues soit la dernière opération d&#8217;une fonction localisée ou d&#8217;un morceau de code exécuté. C&#8217;est ce qu&#8217;on appelle le <a href="http://bit.ly/2EVo70v" data-href="http://bit.ly/2EVo70v">modèle vérifications-effets-interactions</a> .</p>
</div>
<div class="paragraph data-line-144">
<p>Une troisième technique consiste à introduire un mutex, c&#8217;est-à-dire à ajouter une variable d&#8217;état qui verrouille le contrat pendant l&#8217;exécution du code, empêchant les appels réentrants .</p>
</div>
<div class="paragraph data-line-146">
<p>L&#8217;application de toutes ces techniques (l&#8217;utilisation des trois n&#8217;est pas nécessaire, mais nous le faisons à des fins de démonstration) à <em>EtherStore.sol</em> donne le contrat sans réentrance :</p>
</div>
<div class="listingblock data-line-149">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract EtherStore {

    // initialise le mutex
    bool reEntrancyMutex = false;
    uint256 public withdrawalLimit = 1 ether;
    mapping(address =&gt; uint256) public lastWithdrawTime;
    mapping(address =&gt; uint256) public balances;

    function depositFunds() external payable {
        balances[msg.sender] += msg.value;
    }

    function withdrawFunds (uint256 _weiToWithdraw) public {
        require(!reEntrancyMutex);
        require(balances[msg.sender] &gt;= _weiToWithdraw);
        // limite le retrait
        require(_weiToWithdraw &lt;= withdrawalLimit);
        // limite le temps accordé pour se rétracter
        require(now &gt;= lastWithdrawTime[msg.sender] + 1 weeks);
        balances[msg.sender] -= _weiToWithdraw;
        lastWithdrawTime[msg.sender] = now;
        // définit le mutex de réentrance avant l'appel externe
        reEntrancyMutex = true;
        msg.sender.transfer(_weiToWithdraw);
        // libère le mutex après l'appel externe
        reEntrancyMutex = false;
    }
 }</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-181">
<h4 id="real_world_example_the_dao">Exemple concret : le DAO</h4>
<div class="paragraph data-line-183">
<p>L&#8217;attaque DAO (Decentralized Autonomous Organization) a été l&#8217;un des principaux piratages survenus au début du développement d&#8217;Ethereum. À l&#8217;époque, le contrat détenait plus de 150 millions de dollars. La réentrance a joué un rôle majeur dans l&#8217;attaque, qui a finalement conduit à l&#8217;embranchement divergent (hard fork) qui a créé Ethereum Classic (ETC). Pour une bonne analyse de l&#8217;exploit DAO, voir <a href="http://bit.ly/2EQaLCI" data-href="http://bit.ly/2EQaLCI">http://bit.ly/2EQaLCI</a> . Plus d&#8217;informations sur l&#8217;historique des embranchements d&#8217;Ethereum, la chronologie du piratage DAO et la naissance d&#8217;ETC dans un embranchement divergent peuvent être trouvées dans <a href="#ethereum_standards">Normes Ethereum</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-185">
<h3 id="_dépassement_et_soupassement_arithmétique">Dépassement et soupassement arithmétique</h3>
<div class="paragraph data-line-187">
<p>La machine virtuelle Ethereum spécifie des types de données de taille fixe pour les entiers. Cela signifie qu&#8217;une variable entière ne peut représenter qu&#8217;une certaine plage de nombres. Un uint8 , par exemple, ne peut stocker que des nombres dans la plage [0,255]. Essayer de stocker 256 dans un uint8 donnera 0 . Si l&#8217;on n&#8217;y prend pas garde, les variables de Solidity peuvent être exploitées si la saisie de l&#8217;utilisateur n&#8217;est pas cochée et si des calculs sont effectués qui aboutissent à des nombres qui se situent en dehors de la plage du type de données qui les stocke.</p>
</div>
<div class="paragraph data-line-189">
<p>Pour en savoir plus sur les débordements arithmétiques, voir <a href="https://bit.ly/2nNLuOr" data-href="https://bit.ly/2nNLuOr">"Comment sécuriser vos contrats intelligents"</a> , <a href="https://bit.ly/2MOfBPv" data-href="https://bit.ly/2MOfBPv">Ethereum Smart Contract Best Practices</a> et <a href="https://bit.ly/2xvbx1M" data-href="https://bit.ly/2xvbx1M">"Ethereum, Solidity and integer overflows: Programming blockchains like 1970"</a> .</p>
</div>
<div class="sect3 notoc data-line-192">
<h4 id="_la_vulnérabilité_2">La vulnérabilité</h4>
<div class="paragraph data-line-194">
<p>Un dépassement/soupassement se produit lorsqu&#8217;une opération effectuée nécessite une variable de taille fixe pour stocker un nombre (ou un élément de données) qui est en dehors de la plage du type de données de la variable.</p>
</div>
<div class="paragraph data-line-196">
<p>Par exemple, soustraire <code>1</code> d&#8217;une variable <code>uint8</code> (entier non signé de 8 bits, c&#8217;est-à-dire non négatif) dont la valeur est <code>0</code> donnera le nombre <code>255</code> . Il s&#8217;agit d&#8217;un <em>soupassement</em> . Nous avons attribué un nombre en dessous de la plage de <code>uint8</code> , de sorte que le résultat <em>est une boucle</em> et donne le plus grand nombre qu&#8217;un <code>uint8</code> puisse stocker. De même, ajouter <code>2^8=256</code> à un <code>uint8</code> laissera la variable inchangée, car nous avons enroulé autour de toute la longueur du <code>uint</code> . Deux analogies simples de ce comportement sont les odomètres dans les voitures, qui mesurent la distance parcourue (ils se réinitialisent à 000000, après que le plus grand nombre, c&#8217;est-à-dire 999999, est dépassé) et les fonctions mathématiques périodiques (l&#8217;ajout de 2 π à l&#8217;argument de sin laisse la valeur inchangée ).</p>
</div>
<div class="paragraph data-line-198">
<p>L&#8217;ajout de nombres supérieurs à la plage du type de données est appelé un <em>dépassement</em> . Pour plus de clarté, ajouter <code>257</code> à un <code>uint8</code> qui a actuellement une valeur de <code>0</code> se traduira par le nombre <code>1</code> . Il est parfois instructif de considérer les variables de taille fixe comme étant cycliques, où nous recommençons à partir de zéro si nous ajoutons des nombres au-dessus du plus grand nombre stocké possible, et commençons à compter à partir du plus grand nombre si nous soustrayons de zéro. Dans le cas des types <code>int</code> signés , qui <em>peuvent</em> représenter des nombres négatifs, nous recommençons une fois que nous atteignons la plus grande valeur négative; par exemple, si nous essayons de soustraire <code>1</code> à un <code>int8</code> dont la valeur est <code>-128</code> , nous obtiendrons <code>127</code> .</p>
</div>
<div class="paragraph data-line-200">
<p>Ces types de pièges numériques permettent aux attaquants de mal utiliser le code et de créer des flux logiques inattendus. Par exemple, considérez le contrat TimeLock dans  <a href="#timelock_sol_security">TimeLock.sol</a>.</p>
</div>
<div id="timelock_sol_security" class="exampleblock data-line-204">
<div class="title">Example 9. TimeLock.sol</div>
<div class="content">
<div class="listingblock data-line-206">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract TimeLock {

    mapping(address =&gt; uint) public balances;
    mapping(address =&gt; uint) public lockTime;

    function deposit() external payable {
        balances[msg.sender] += msg.value;
        lockTime[msg.sender] = now + 1 weeks;
    }

    function increaseLockTime(uint _secondsToIncrease) public {
        lockTime[msg.sender] += _secondsToIncrease;
    }

    function withdraw() public {
        require(balances[msg.sender] &gt; 0);
        require(now &gt; lockTime[msg.sender]);
        balances[msg.sender] = 0;
        msg.sender.transfer(balance);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-231">
<p>Ce contrat est conçu pour agir comme un coffre-fort temporel : les utilisateurs peuvent déposer de l&#8217;ether dans le contrat et il y sera verrouillé pendant au moins une semaine. L&#8217;utilisateur peut prolonger le temps d&#8217;attente à plus d&#8217;une semaine s&#8217;il le souhaite, mais une fois déposé, l&#8217;utilisateur peut être sûr que son ether est verrouillé en toute sécurité pendant au moins une semaine, du moins c&#8217;est ce que prévoit ce contrat.</p>
</div>
<div class="paragraph data-line-233">
<p>Dans le cas où un utilisateur est obligé de remettre sa clé privée, un contrat comme celui-ci peut être utile pour s&#8217;assurer que son ether est introuvable pendant une courte période. Mais si un utilisateur avait verrouillé <code>100 ether</code> dans ce contrat et remis ses clés à un attaquant, l&#8217;attaquant pourrait utiliser un débordement pour recevoir l&#8217;ether, quel que soit le <code>lockTime</code>.</p>
</div>
<div class="paragraph data-line-235">
<p>L&#8217;attaquant pourrait déterminer le <code>lockTime</code> actuel pour l&#8217;adresse pour laquelle il détient maintenant la clé (c&#8217;est une variable publique). Appelons le <code>userLockTime</code> . Ils pourraient alors appeler la fonction <code>increaseLockTime</code> et passer en argument le nombre <code>2^256 - userLockTime</code> . Ce nombre serait ajouté à l' <code>userLockTime</code> actuel et provoquerait un dépassement, réinitialisant <code>lockTime[msg.sender]</code> à <code>0</code>. L&#8217;attaquant pourrait alors simplement appeler la fonction <code>withdraw</code> pour obtenir sa récompense.</p>
</div>
<div class="paragraph data-line-237">
<p>Regardons un autre exemple (<a href="#underflow_vulnerability_example_from_ethernaut_challenge">Underflow vulnerability example from Ethernaut challenge</a>), celui des <a href="https://github.com/OpenZeppelin/ethernaut" data-href="https://github.com/OpenZeppelin/ethernaut">défis Ethernaut</a>.</p>
</div>
<div class="paragraph data-line-239">
<p><strong>ALERTE DIVULGATION:</strong> <em>Si vous n&#8217;avez pas encore fait les défis Ethernaut, cela donne une solution à l&#8217;un des niveaux</em> .</p>
</div>
<div id="underflow_vulnerability_example_from_ethernaut_challenge" class="exampleblock data-line-243">
<div class="title">Example 10. Underflow vulnerability example from Ethernaut challenge</div>
<div class="content">
<div class="listingblock data-line-245">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.18;

contract Token {

  mapping(address =&gt; uint) balances;
  uint public totalSupply;

  function Token(uint _initialSupply) {
    balances[msg.sender] = totalSupply = _initialSupply;
  }

  function transfer(address _to, uint _value) public returns (bool) {
    require(balances[msg.sender] - _value &gt;= 0);
    balances[msg.sender] -= _value;
    balances[_to] += _value;
    return true;
  }

  function balanceOf(address _owner) public constant returns (uint balance) {
    return balances[_owner];
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-271">
<p>Il s&#8217;agit d&#8217;un simple contrat de jeton qui utilise une fonction de <code>transfer</code> , permettant aux participants de déplacer leurs jetons. Pouvez-vous voir l&#8217;erreur dans ce contrat ?</p>
</div>
<div class="paragraph data-line-273">
<p>La faille vient de la fonction <code>transfer</code>. L&#8217;instruction require de la ligne 13 peut être contournée à l&#8217;aide d&#8217;un soupassement. Considérez un utilisateur avec un solde nul. Il pourrait appeler la fonction <code>transfer</code> avec n&#8217;importe quelle <code>_value</code> différente de zéro et passer l&#8217;instruction require à la ligne 13. En effet, <code>balances[msg.sender]</code> est égal à 0 (et un <code>uint256</code> ), donc la soustraction de tout montant positif (à l&#8217;exception de <code>2^256</code> ) entraînera un nombre positif, comme décrit précédemment. Ceci est également vrai pour la ligne 14, où le solde sera crédité d&#8217;un nombre positif. Ainsi, dans cet exemple, un attaquant peut obtenir des jetons gratuits en raison d&#8217;une vulnérabilité de soupassement.</p>
</div>
</div>
<div class="sect3 notoc data-line-276">
<h4 id="_techniques_préventives_2">Techniques préventives</h4>
<div class="paragraph data-line-278">
<p>La technique conventionnelle actuelle pour se prémunir contre les vulnérabilités de soupassement/dépassement consiste à utiliser ou à créer des bibliothèques mathématiques qui remplacent les opérateurs mathématiques standard d' addition, de soustraction et de multiplication (la division est exclue car elle ne provoque pas de soupassement/dépassement et l&#8217;EVM revient à la division par 0 ).</p>
</div>
<div class="paragraph data-line-280">
<p><a href="https://github.com/OpenZeppelin/openzeppelin-solidity" data-href="https://github.com/OpenZeppelin/openzeppelin-solidity">OpenZeppelin</a> a fait un excellent travail de création et d&#8217;audit de bibliothèques sécurisées pour la communauté Ethereum. En particulier, la <a href="http://bit.ly/2ABhb4l" data-href="http://bit.ly/2ABhb4l">bibliothèque SafeMath</a> peut être utilisée pour éviter les vulnérabilités de soupassement/dépassement.</p>
</div>
<div class="paragraph data-line-282">
<p>Pour montrer comment ces bibliothèques sont utilisées dans Solidity, corrigeons le contrat <code>TimeLock</code> à l&#8217;aide de la bibliothèque <code>SafeMath</code>. La version sans débordement du contrat est :</p>
</div>
<div class="listingblock data-line-285">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">library SafeMath {

  function mul(uint256 a, uint256 b) internal pure returns (uint256) {
    if (a == 0) {
      return 0;
    }
    uint256 c = a * b;
    assert(c / a == b);
    return c;
  }

  function div(uint256 a, uint256 b) internal pure returns (uint256) {
    // assert( b &gt; 0); // Solidity relance automatiquement lors de la division par 0
    uint256 c = a / b;
    // assert( a == b * c + a % b); // Cela vaut dans tous les cas
    return c;
  }

  function sub(uint256 a, uint256 b) internal pure returns (uint256) {
    assert(b &lt;= a);
    return a - b;
  }

  function add(uint256 a, uint256 b) internal pure returns (uint256) {
    uint256 c = a + b;
    assert(c &gt;= a);
    return c;
  }
}

contract TimeLock {
    using SafeMath for uint; // utiliser la bibliothèque pour le type uint
    mapping(address =&gt; uint256) public balances;
    mapping(address =&gt; uint256) public lockTime;

    function deposit() external payable {
        balances[msg.sender] = balances[msg.sender].add(msg.value);
        lockTime[msg.sender] = now.add(1 weeks);
    }

    function increaseLockTime(uint256 _secondsToIncrease) public {
        lockTime[msg.sender] = lockTime[msg.sender].add(_secondsToIncrease);
    }

    function withdraw() public {
        require(balances[msg.sender] &gt; 0);
        require(now &gt; lockTime[msg.sender]);
        balances[msg.sender] = 0;
        msg.sender.transfer(balance);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-339">
<p>Notez que toutes les opérations mathématiques standard ont été remplacées par celles définies dans la bibliothèque <code>SafeMath</code>. Le contrat <code>TimeLock</code> n&#8217;effectue plus aucune opération capable de soupassement/dépassement.</p>
</div>
</div>
<div class="sect3 data-line-341">
<h4 id="_exemples_concrets_powhc_et_débordement_de_transfert_par_lots_cve_201810299">Exemples concrets : PoWHC et débordement de transfert par lots (CVE-2018–10299)</h4>
<div class="paragraph data-line-343">
<p>Proof of Weak Hands Coin ( PoWHC ), conçu à l&#8217;origine comme une sorte de blague, était un stratagème de Ponzi écrit par un collectif Internet. Malheureusement , il semble que l&#8217;auteur ou les auteurs du contrat n&#8217;avaient pas vu de soupassement/dépassement auparavant, et par conséquent 866 ethers ont été libérés de son contrat. Eric Banisadr donne un bon aperçu de la façon dont le débordement s&#8217;est produit (ce qui n&#8217;est pas trop différent du défi Ethernaut décrit précédemment) dans son <a href="https://bit.ly/2wrxIFJ" data-href="https://bit.ly/2wrxIFJ">article de blog</a> sur l&#8217;événement.</p>
</div>
<div class="paragraph data-line-345">
<p><a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">Un autre exemple</a> provient de l&#8217;implémentation d&#8217;une fonction <code>batchTransfer()</code> dans un groupe de contrats de jetons ERC20. L&#8217;implémentation contenait une vulnérabilité de dépassement; vous pouvez lire les détails dans le <a href="https://bit.ly/2HDlIs8" data-href="https://bit.ly/2HDlIs8">compte rendu de PeckShield</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-347">
<h3 id="_ether_inattendu">Ether inattendu</h3>
<div class="paragraph data-line-349">
<p>En règle générale, lorsque de l&#8217;ether est envoyé à un contrat, il doit exécuter soit la fonction de secours, soit une autre fonction définie dans le contrat. Il y a deux exceptions à cela, où l&#8217;ether peut exister dans un contrat sans avoir exécuté de code. Les contrats qui reposent sur l&#8217;exécution de code pour tout l&#8217;ether qui leur est envoyé peuvent être vulnérables aux attaques où l&#8217;ether est envoyé de force.</p>
</div>
<div class="paragraph data-line-351">
<p>Pour en savoir plus à ce sujet, consultez <a href="https://bit.ly/2MR8Gp0" data-href="https://bit.ly/2MR8Gp0">« Comment sécuriser vos contrats intelligents »</a> et <a href="http://bit.ly/2RjXmUWl" data-href="http://bit.ly/2RjXmUWl">« Modèles de sécurité solides – Forcer Ether à un contrat »</a> .</p>
</div>
<div class="sect3 notoc data-line-354">
<h4 id="_la_vulnérabilité_3">La vulnérabilité</h4>
<div class="paragraph data-line-356">
<p>Une technique de programmation défensive courante qui est utile pour appliquer des transitions d&#8217;état correctes ou valider des opérations est <em>la vérification invariante</em> . Cette technique consiste à définir un ensemble d&#8217;invariants (métriques ou paramètres qui ne doivent pas changer) et à vérifier qu&#8217;ils restent inchangés après une (ou plusieurs) opération(s). C&#8217;est généralement une bonne conception, à condition que les invariants vérifiés soient en fait des invariants. Un exemple d&#8217;invariant est <code>totalSupply</code> d&#8217;une émission fixe de <a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">Jeton ERC20</a> . Comme aucune fonction ne doit modifier cet invariant, on pourrait ajouter une vérification à la fonction <code>transfer</code> qui s&#8217;assure que le <code>totalSupply</code> reste inchangé, pour garantir que la fonction fonctionne comme prévu.</p>
</div>
<div class="paragraph data-line-358">
<p>En particulier, il existe un invariant apparent qu&#8217;il peut être tentant d&#8217;utiliser mais qui peut en fait être manipulé par des utilisateurs externes (quelles que soient les règles mises en place dans le contrat intelligent). Il s&#8217;agit de l&#8217;ether actuel stocké dans le contrat. Souvent, lorsque les développeurs apprennent Solidity pour la première fois , ils ont l&#8217;idée fausse qu&#8217;un contrat ne peut accepter ou obtenir de l&#8217;ether que via des fonctions payantes. Cette idée fausse peut conduire à des contrats qui contiennent de fausses hypothèses sur l&#8217;équilibre de l&#8217;ether, ce qui peut entraîner une série de vulnérabilités. La preuve irréfutable de cette vulnérabilité est l&#8217;utilisation (incorrecte) de <code>this.balance</code>.</p>
</div>
<div class="paragraph data-line-360">
<p>Il existe deux manières d&#8217;envoyer (de force) de l&#8217;ether à un contrat sans utiliser de fonction payante ni exécuter de code sur le contrat :</p>
</div>
<div class="dlist data-line-362">
<dl>
<dt class="hdlist1">Autodestruction/suicide</dt>
<dd>
<p>Tout contrat est capable d' implémenter la <a href="http://bit.ly/2RovrDf" data-href="http://bit.ly/2RovrDf">fonction</a> <code>selfdestruct</code> , qui supprime tout le bytecode de l&#8217;adresse du contrat et envoie tout l&#8217;ether qui y est stocké à l&#8217;adresse spécifiée par le paramètre. Si cette adresse spécifiée est également un contrat, aucune fonction (y compris la fonction de secours) n&#8217;est appelée. Par conséquent, la fonction <code>selfdestruct</code> peut être utilisée pour envoyer de force de l&#8217;ether à n&#8217;importe quel contrat, quel que soit le code pouvant exister dans le contrat, même les contrats sans fonctions payantes. Cela signifie que tout attaquant peut créer un contrat avec une fonction <code>selfdestruct</code> , lui envoyer de l&#8217;ether, appeler <code>selfdestruct(target)</code> et forcer l&#8217;ether à être envoyé à un contrat <code>target</code> . Martin Swende a un excellent <a href="http://bit.ly/2OfLukM" data-href="http://bit.ly/2OfLukM">article de blog</a> décrivant certaines bizarreries de l&#8217;opcode d&#8217;autodestruction (Quirk # 2) ainsi qu&#8217;un compte rendu de la façon dont les nœuds clients vérifiaient des invariants incorrects, ce qui aurait pu conduire à un crash plutôt catastrophique du réseau Ethereum.</p>
</dd>
<dt class="hdlist1">Ether pré-envoyé</dt>
<dd>
<p>Une autre façon d&#8217;intégrer de l&#8217;ether dans un contrat consiste à précharger l&#8217;adresse du contrat avec de l&#8217;ether. Les adresses de contrat sont déterministes - en fait, l&#8217;adresse est calculée à partir du hachage Keccak-256 (généralement synonyme de SHA-3) de l&#8217;adresse créant le contrat et du nonce de transaction qui crée le contrat. Plus précisément, il se présente sous la forme <code>address = sha3(rlp.encode([ account_address,transaction_nonce ]))</code> (voir la discussion d&#8217;Adrian Manning sur <a href="http://bit.ly/2EPj5Tq" data-href="http://bit.ly/2EPj5Tq">"Keyless Ether"</a> pour quelques cas d&#8217;utilisation amusants). Cela signifie que n&#8217;importe qui peut calculer quelle sera l&#8217;adresse d&#8217;un contrat avant sa création et envoyer de l&#8217;ether à cette adresse. Lorsque le contrat est créé, il aura un solde d&#8217;ether non nul.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-366">
<p>Explorons quelques pièges qui peuvent survenir compte tenu de ces connaissances. Considérez le contrat trop simple dans <a href="#etherGame_security">EtherGame.sol</a>.</p>
</div>
<div id="etherGame_security" class="exampleblock data-line-370">
<div class="title">Example 11. EtherGame.sol</div>
<div class="content">
<div class="listingblock data-line-372">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract EtherGame {

    uint public payoutMileStone1 = 3 ether;
    uint public mileStone1Reward = 2 ether;
    uint public payoutMileStone2 = 5 ether;
    uint public mileStone2Reward = 3 ether;
    uint public finalMileStone = 10 ether;
    uint public finalReward = 5 ether;

    mapping(address =&gt; uint) redeemableEther;
    // Les utilisateurs paient 0,5 ether. À des étapes spécifiques, créditez leurs comptes.
    function play() external payable {
        require(msg.value == 0.5 ether); // each play is 0.5 ether
        uint currentBalance = this.balance + msg.value;
        // s'assure qu'il n'y a plus de joueurs après la fin du jeu
        require(currentBalance &lt;= finalMileStone);
        // si à un jalon, créditer le compte du joueur
        if (currentBalance == payoutMileStone1) {
            redeemableEther[msg.sender] += mileStone1Reward;
        }
        else if (currentBalance == payoutMileStone2) {
            redeemableEther[msg.sender] += mileStone2Reward;
        }
        else if (currentBalance == finalMileStone ) {
            redeemableEther[msg.sender] += finalReward;
        }
        return;
    }

    function claimReward() public {
        // s'assure que le jeu est terminé
        require(this.balance == finalMileStone);
        // s'assure qu'il y a une récompense à donner
        require(redeemableEther[msg.sender] &gt; 0);
        redeemableEther[msg.sender] = 0;
        msg.sender.transfer(transferValue);
    }
 }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-414">
<p>Ce contrat représente un jeu simple (qui impliquerait naturellement des conditions de course) où les joueurs envoient 0,5 ether au contrat dans l&#8217;espoir d&#8217;être le joueur qui atteint l&#8217;un des trois jalons en premier. Les jalons sont libellés en ether. Le premier à atteindre le jalon peut réclamer une partie de l&#8217;ether à la fin de la partie. Le jeu se termine lorsque le dernier jalon (10 ether) est atteint; les utilisateurs peuvent ensuite réclamer leurs récompenses.</p>
</div>
<div class="paragraph data-line-416">
<p>Les problèmes avec le contrat <code>EtherGame</code> proviennent de la mauvaise utilisation de <code>this.balance</code> dans les deux lignes 14 (et par association 16) et 32. Un attaquant malicieux pourrait envoyer de force une petite quantité d&#8217;ether, disons 0,1 ether, via la fonction <code>selfdestruct</code> ( discuté plus tôt) pour empêcher tout futur joueur d&#8217;atteindre un jalon. <code>this.balance</code> ne sera jamais un multiple de 0,5 ether grâce à cette contribution de 0,1 ether, car tous les joueurs légitimes ne peuvent envoyer que des incréments de 0,5 ether. Cela empêche toutes les conditions if des lignes 18, 21 et 24 d&#8217;être vraies.</p>
</div>
<div class="paragraph data-line-418">
<p>Pire encore, un attaquant vengeur qui a raté un jalon pourrait envoyer de force 10 ethers (ou une quantité équivalente d&#8217;ethers qui pousse le solde du contrat au-dessus du <code>finalMileStone</code> ), ce qui verrouillerait toutes les récompenses dans le contrat pour toujours. En effet, la fonction <code>claimReward</code> sera toujours rétablie, en raison de l&#8217;exigence à la ligne 32 (c&#8217;est-à-dire parce que <code>this.balance</code> est supérieur à <code>finalMileStone</code> ).</p>
</div>
</div>
<div class="sect3 notoc data-line-421">
<h4 id="_techniques_préventives_3">Techniques préventives</h4>
<div class="paragraph data-line-423">
<p>Ce type de vulnérabilité provient généralement d&#8217;une mauvaise utilisation de <code>this.balance</code>. La logique contractuelle, dans la mesure du possible, doit éviter de dépendre des valeurs exactes du solde du contrat, car elle peut être artificiellement manipulée. Si vous appliquez une logique basée sur <code>this.balance</code> , vous devez faire face à des soldes inattendus.</p>
</div>
<div class="paragraph data-line-425">
<p>Si des valeurs exactes d&#8217;ether déposé sont requises, une variable auto-définie doit être utilisée qui est incrémentée dans les fonctions payables, pour suivre en toute sécurité l&#8217;ether déposé. Cette variable ne sera pas influencée par l&#8217;ether forcé envoyé via un appel <code>selfdestruct</code>.</p>
</div>
<div class="listingblock data-line-428">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract EtherGame {

    uint public payoutMileStone1 = 3 ether;
    uint public mileStone1Reward = 2 ether;
    uint public payoutMileStone2 = 5 ether;
    uint public mileStone2Reward = 3 ether;
    uint public finalMileStone = 10 ether;
    uint public finalReward = 5 ether;
    uint public depositedWei;

    mapping (address =&gt; uint) redeemableEther;

    function play() external payable {
        require(msg.value == 0.5 ether);
        uint currentBalance = depositedWei + msg.value;
        // s'assure qu'il n'y a plus de joueurs après la fin du jeu
        require(currentBalance &lt;= finalMileStone);
        if (currentBalance == payoutMileStone1) {
            redeemableEther[msg.sender] += mileStone1Reward;
        }
        else if (currentBalance == payoutMileStone2) {
            redeemableEther[msg.sender] += mileStone2Reward;
        }
        else if (currentBalance == finalMileStone ) {
            redeemableEther[msg.sender] += finalReward;
        }
        depositedWei += msg.value;
        return;
    }

    function claimReward() public {
        // s'assure que le jeu est terminé
        require(depositedWei == finalMileStone);
        // s'assure qu'il y a une récompense à donner
        require(redeemableEther[msg.sender] &gt; 0);
        redeemableEther[msg.sender] = 0;
        msg.sender.transfer(transferValue);
    }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-470">
<p>Ici, nous avons créé une nouvelle variable, <code>depositWei</code> , qui garde la trace de l&#8217;ether connu déposé, et c&#8217;est cette variable que nous utilisons pour nos tests. Notez que nous n&#8217;avons plus aucune référence à <code>this.balance</code>.</p>
</div>
</div>
<div class="sect3 data-line-472">
<h4 id="_autres_exemples">Autres exemples</h4>
<div class="paragraph data-line-474">
<p>Quelques exemples de contrats exploitables ont été donnés dans le <a href="https://github.com/Arachnid/uscc/tree/master/submissions-2017/" data-href="https://github.com/Arachnid/uscc/tree/master/submissions-2017/">Underhanded Solidity Coding Contest</a> , qui fournit également des exemples détaillés d&#8217;un certain nombre de pièges soulevés dans cette section.</p>
</div>
</div>
</div>
<div class="sect2 data-line-476">
<h3 id="_delegatecall_appel_délégué">DELEGATECALL (Appel délégué)</h3>
<div class="paragraph data-line-478">
<p>Les opcodes <code>CALL</code> et <code>DELEGATECALL</code> sont utiles pour permettre aux développeurs Ethereum de modulariser leur code. Les appels de messages externes standard aux contrats sont gérés par l' opcode <code>CALL</code>, le code étant exécuté dans le contexte du contrat/de la fonction externe. L' opcode <code>DELEGATECALL</code> est presque identique, sauf que le code exécuté à l&#8217;adresse ciblée est exécuté dans le contexte du contrat appelant, et <code>msg.sender</code> et <code>msg.value</code> restent inchangés. Cette fonctionnalité permet la mise en œuvre de <em>bibliothèques</em> , permettant aux développeurs de déployer du code réutilisable une seule fois et de l&#8217;appeler à partir de futurs contrats.</p>
</div>
<div class="paragraph data-line-480">
<p>Bien que les différences entre ces deux opcodes soient simples et intuitives, l&#8217;utilisation de <code>DELEGATECALL</code> peut conduire à l&#8217;exécution de code inattendu.</p>
</div>
<div class="paragraph data-line-482">
<p>Pour plus de lecture, voir  http://bit.ly/2AAElb8[Question Ethereum Stack Exchange sur ce sujet] de Loi.Luu et la <a href="http://bit.ly/2Oi7UlH" data-href="http://bit.ly/2Oi7UlH">documentation Solidity</a> .</p>
</div>
<div class="sect3 notoc data-line-485">
<h4 id="_la_vulnérabilité_4">La vulnérabilité</h4>
<div class="paragraph data-line-487">
<p>En raison de la nature de préservation du contexte de <code>DELEGATECALL</code> , la création de bibliothèques personnalisées sans vulnérabilité n&#8217;est pas aussi simple qu&#8217;on pourrait le penser. Le code des bibliothèques elles-mêmes peut être sécurisé et sans vulnérabilité ; cependant, lorsqu&#8217;il est exécuté dans le contexte d&#8217;une autre application, de nouvelles vulnérabilités peuvent survenir. Voyons un exemple assez complexe de cela, en utilisant des nombres de Fibonacci.</p>
</div>
<div class="paragraph data-line-489">
<p>Considérez la bibliothèque dans <a href="#fibonacci_security">FibonacciLib.sol</a>, qui peut générer la séquence de Fibonacci et des séquences de forme similaire. (Remarque : ce code a été modifié à partir de <a href="https://bit.ly/2MReuii" data-href="https://bit.ly/2MReuii">https://bit.ly/2MReuii</a> .)</p>
</div>
<div id="fibonacci_security" class="exampleblock data-line-493">
<div class="title">Example 12. FibonacciLib.sol</div>
<div class="content">
<div class="listingblock data-line-495">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// contrat de bibliothèque - calcule les nombres de type Fibonacci
contract FibonacciLib {
    // initialisation de la suite standard de Fibonacci
    uint public start;
    uint public calculatedFibNumber;

    // modifie le numéro zéro de la séquence
    function setStart(uint _start) public {
        start = _start;
    }

    function setFibonacci(uint n) public {
        calculatedFibNumber = fibonacci(n);
    }

    function fibonacci(uint n) internal returns (uint) {
        if (n == 0) return start;
        else if (n == 1) return start + 1;
        else return fibonacci(n - 1) + fibonacci(n - 2);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-520">
<p>Cette bibliothèque fournit une fonction qui peut générer le <em>n</em>-ème nombre de Fibonacci dans la séquence. Il permet aux utilisateurs de changer le numéro de départ de la séquence (<code>start</code>) et de calculer les <em>n</em>-èmes nombres de type Fibonacci dans cette nouvelle séquence.</p>
</div>
<div class="paragraph data-line-522">
<p>Considérons maintenant un contrat qui utilise cette bibliothèque, montré dans <a href="#fib_balance_security">FibonacciBalance.sol</a>.</p>
</div>
<div id="fib_balance_security" class="exampleblock data-line-526">
<div class="title">Example 13. FibonacciBalance.sol</div>
<div class="content">
<div class="listingblock data-line-528">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract FibonacciBalance {

    address public fibonacciLibrary;
    // le nombre de Fibonacci actuel à retirer
    uint public calculatedFibNumber;
    // le numéro de séquence de Fibonacci de départ
    uint public start = 3;
    uint public withdrawalCounter;
    // le sélecteur de fonction de Fibonancci
    bytes4 constant fibSig = bytes4(sha3("setFibonacci(uint256)"));

    // constructeur - charge le contrat avec ether
    constructor(address _fibonacciLibrary) external payable {
        fibonacciLibrary = _fibonacciLibrary;
    }

    function withdraw() {
        withdrawalCounter += 1;
        // calcule le nombre de Fibonacci pour l'utilisateur de retrait actuel-
        // ceci définit le nombreFibcalculé
        require(fibonacciLibrary.delegatecall(fibSig, withdrawalCounter));
        msg.sender.transfer(calculatedFibNumber * 1 ether);
    }

    // permet aux utilisateurs d'appeler les fonctions de la bibliothèque Fibonacci
    function() public {
        require(fibonacciLibrary.delegatecall(msg.data));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-561">
<p>Ce contrat permet à un participant de retirer des ethers du contrat, la quantité d&#8217;ethers étant égale au nombre de Fibonacci correspondant à l&#8217;ordre de retrait du participant ; c&#8217;est-à-dire que le premier participant obtient 1 ether, le second obtient également 1, le troisième obtient 2, le quatrième obtient 3, le cinquième 5, et ainsi de suite (jusqu&#8217;à ce que le solde du contrat soit inférieur au nombre de Fibonacci retiré).</p>
</div>
<div class="paragraph data-line-563">
<p>Il y a un certain nombre d' éléments dans ce contrat qui peuvent nécessiter quelques explications. Tout d&#8217;abord, il existe une variable intéressante, <code>fibSig</code>. Cela contient les 4 premiers octets du hachage Keccak-256 (SHA-3) de la chaîne <code>'setFibonacci (uint256)'</code>. Ceci est connu sous le nom de <a href="http://bit.ly/2RmueMP" data-href="http://bit.ly/2RmueMP">sélecteur de fonction</a> et est placé dans <code>calldata</code> pour spécifier quelle fonction d&#8217;un contrat intelligent sera appelée. Il est utilisé dans la fonction d&#8217;appel délégué à la ligne 21 pour spécifier que nous souhaitons exécuter la fonction <code>fibonacci(uint256)</code>. Le deuxième argument est <code>delegatecall</code> le paramètre que nous passons à la fonction. Deuxièmement, nous supposons que l&#8217;adresse de la bibliothèque <code>FibonacciLib</code> est correctement référencée dans le constructeur (<a href="#external_contract_referencing">Référencement des contrats externes</a> traite de certaines vulnérabilités potentielles liées à ce type d&#8217;initialisation de référence de contrat).</p>
</div>
<div class="paragraph data-line-565">
<p>Pouvez-vous repérer des erreurs dans ce contrat ? Si l&#8217;on déployait ce contrat, le remplissait d&#8217;ether et appelait <code>withdraw</code>, il reviendrait probablement.</p>
</div>
<div class="paragraph data-line-567">
<p>Vous avez peut-être remarqué que la variable d&#8217;état <code>start</code> est utilisée à la fois dans la bibliothèque et dans le contrat d&#8217;appel principal. Dans le contrat de bibliothèque, <code>start</code> est utilisé pour spécifier le début de la séquence de Fibonacci et est défini sur 0 , alors qu&#8217;il est défini sur <code>3</code> dans le contrat appelant. Vous avez peut-être également remarqué que la fonction de secours dans le contrat <code>FibonacciBalance</code> permet de transmettre tous les appels au contrat de bibliothèque, ce qui permet d&#8217;appeler la fonction <code>setStart</code> du contrat de bibliothèque. En rappelant que nous préservons l&#8217;état du contrat, il peut sembler que cette fonction permettrait de changer l&#8217;état de la variable <code>start</code> dans le contrat local <code>FibonnacciBalance</code>. Si c&#8217;est le cas, cela permettrait de retirer plus d&#8217;ether, car le <code>calculatedFibNumber</code> résultant dépend de la variable <code>start</code> (comme indiqué dans le contrat de bibliothèque). En réalité , la fonction <code>setStart</code> ne modifie pas (et ne peut pas modifier) la variable <code>start</code> dans le contrat <code>FibonacciBalance</code>. La vulnérabilité sous-jacente de ce contrat est bien pire que la simple modification de la variable <code>start</code>.</p>
</div>
<div class="paragraph data-line-569">
<p>Avant de discuter du problème réel, faisons un petit détour pour comprendre comment les variables d&#8217;état sont réellement stockées dans les contrats. Les variables d&#8217;état ou de stockage (variables qui persistent sur des transactions individuelles) sont placées dans des <em>emplacements</em> de manière séquentielle au fur et à mesure qu&#8217;elles sont introduites dans le contrat. (Il y a quelques complexités ici ; consultez la documentation de <a href="http://bit.ly/2JslDWf" data-href="http://bit.ly/2JslDWf">Solidity</a> pour une compréhension plus approfondie.)</p>
</div>
<div class="paragraph data-line-571">
<p>Prenons l&#8217;exemple du contrat de bibliothèque. Il a deux variables d&#8217;état, <code>start</code> et <code>calculatedFibNumber</code> . La première variable, <code>start</code>, est stockée dans le stockage du contrat à <code>slot[0]</code> (c&#8217;est-à-dire le premier slot (fente ou espace)). La deuxième variable, <code>calculatedFibNumber</code>, est placée dans le prochain emplacement de stockage disponible, <code>slot[1]</code>. La fonction <code>setStart</code> prend une entrée et définit start quelle que soit l&#8217;entrée. Cette fonction définit donc <code>slot[0]</code> sur l&#8217;entrée que nous fournissons dans la fonction <code>setStart</code>. De la même manière, la fonction <code>setFibonacci</code> définit la fonction <code>calculatedFibNumber</code> sur le résultat de <code>fibonacci(n)</code>. Encore une fois, il s&#8217;agit simplement de définir storage <code>slot[1]</code> sur la valeur de <code>fibonacci(n)</code>.</p>
</div>
<div class="paragraph data-line-573">
<p>Regardons maintenant le contrat <code>FibonacciBalance</code>. Storage <code>slot[0]</code> correspond maintenant à l' adresse <code>fibonacciLibrary</code> , et <code>slot[1]</code> correspond à <code>calculatedFibNumber</code> . C&#8217;est dans ce mappage incorrect que la vulnérabilité se produit. <code>delegatecall</code> <em>préserve le contexte du contrat</em> . Cela signifie que le code exécuté via l&#8217;appel délégué <code>delegatecall</code> agira sur l&#8217;état (c&#8217;est-à-dire le stockage) du contrat appelant.</p>
</div>
<div class="paragraph data-line-575">
<p>Notez maintenant que <code>withdraw</code> à la ligne 21, nous exécutons <code>fibonacciLibrary.delegatecall(fibSig,withdrawalCounter)</code>. Cela appelle la fonction <code>setFibonacci</code>, qui, comme nous l&#8217;avons vu, modifie l&#8217;espace de stockage <code>slot[1]</code> , qui dans notre contexte actuel est <code>calculatedFibNumber</code> . C&#8217;est comme prévu (c&#8217;est-à-dire qu&#8217;après l&#8217;exécution, le <code>calculatedFibNumber</code> est modifié). Cependant, rappelez-vous que la variable de début dans le contrat <code>FibonacciLib</code> est située dans l&#8217;espace de stockage <code>slot[0]</code>, qui est l' adresse <code>fibonacciLibrary</code> dans le contrat actuel. Cela signifie que la fonction <code>fibonacci</code> donnera un résultat inattendu. En effet, il fait référence à <code>start</code> ( <code>slot[0]</code> ), qui dans le contexte d&#8217;appel actuel est l' adresse <code>fibonacciLibrary</code> (qui sera souvent assez grande, lorsqu&#8217;elle est interprétée comme un <code>uint</code>). Ainsi , il est probable que la fonction de retrait <code>withdraw</code> reviendra, car elle ne contiendra pas la quantité <code>uint(fibonacciLibrary)</code> d&#8217;ether, ce qui est ce que <code>calculatedFibNumber</code> renverra.</p>
</div>
<div class="paragraph data-line-577">
<p>Pire encore, le contrat <code>FibonacciBalance</code> permet aux utilisateurs d&#8217;appeler toutes les fonctions <code>fibonacciLibrary</code> via la fonction de secours à la ligne 26. Comme nous l&#8217;avons vu précédemment, cela inclut la fonction <code>setStart</code>. Nous avons expliqué que cette fonction permet à quiconque de modifier ou de définir l' emplacement de stockage <code>slot[0]</code>. Dans ce cas, emplacement de stockage <code>slot[0]</code> est l' adresse <code>fibonacciLibrary</code>. Par conséquent, un attaquant pourrait créer un contrat malveillant, convertir l&#8217;adresse en <code>uint</code> (cela peut être fait facilement en Python en utilisant <code>int('&lt;address&gt;',16)</code> ), puis appeler <code>setStart</code> (<a href="#attack_contract_address_as_uint">[attack_contract_address_as_uint]</a>) . Cela changera <code>fibonacciLibrary</code> à l&#8217;adresse du contrat d&#8217;attaque. Ensuite, chaque fois qu&#8217;un utilisateur appelle <code>withdraw</code> ou la fonction de secours, le contrat malveillant s&#8217;exécutera (ce qui peut voler la totalité du solde du contrat) car nous avons modifié l&#8217;adresse réelle de <code>fibonacciLibrary</code>. Un exemple d&#8217;un tel contrat d&#8217;attaque serait :</p>
</div>
<div class="listingblock data-line-580">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Attack {
    uint storageSlot0; // correspond à fibonacciLibrary
    uint storageSlot1; // correspond à calculatedFibNumber

    // défaut - cela s'exécutera si une fonction spécifiée n'est pas trouvée
    function() public {
        storageSlot1 = 0; // we set calculatedFibNumber to 0, so if withdraw
        // s'appelle nous n'envoyons pas d'ether
        &lt;attacker_address&gt;.transfer(this.balance); // we take all the ether
    }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-594">
<p>Notez que ce contrat d&#8217;attaque modifie le <code>calculatedFibNumber</code> en changeant l&#8217;espace de stockage <code>slot[1]</code>. En principe, un attaquant pourrait modifier n&#8217;importe quel autre emplacement de stockage de son choix, pour effectuer toutes sortes d&#8217;attaques sur ce contrat. Nous vous encourageons à mettre ces contrats dans <a href="https://remix.ethereum.org" data-href="https://remix.ethereum.org">Remix</a> et à expérimenter différents contrats d&#8217;attaque et changements d&#8217;état via ces fonctions d&#8217;appel délégué <code>delegatecall</code>.</p>
</div>
<div class="paragraph data-line-596">
<p>Il est également important de noter que lorsque nous disons que l&#8217;appel <code>delegatecall</code> préserve l&#8217;état, nous ne parlons pas des noms de variables du contrat, mais plutôt des emplacements de stockage réels vers lesquels ces noms pointent. Comme vous pouvez le voir dans cet exemple, une simple erreur peut conduire un attaquant à détourner l&#8217;intégralité du contrat et de son ether.</p>
</div>
</div>
<div class="sect3 notoc data-line-599">
<h4 id="_techniques_préventives_4">Techniques préventives</h4>
<div class="paragraph data-line-601">
<p>Solidity fournit le mot-clé de <code>library</code> (bibliothèque) pour la mise en œuvre des contrats de bibliothèque (voir la <a href="http://bit.ly/2zjD8TI" data-href="http://bit.ly/2zjD8TI">documentation</a> pour plus de détails). Cela garantit que le contrat de bibliothèque est sans état et non autodestructible. Forcer les bibliothèques à être sans état atténue les complexités du contexte de stockage démontrées dans cette section. Les bibliothèques sans état empêchent également les attaques dans lesquelles les attaquants modifient directement l&#8217;état de la bibliothèque afin d' affecter les contrats qui dépendent du code de la bibliothèque. En règle générale, lorsque vous utilisez <code>DELEGATECALL</code>, faites très attention au contexte d&#8217;appel possible du contrat de bibliothèque et du contrat d&#8217;appel, et chaque fois que possible, créez des <span class="keep-together">bibliothèques</span>. sans état.</p>
</div>
</div>
<div class="sect3 data-line-604">
<h4 id="multisig_secondhack">Exemple concret : Parity Multisig Wallet (Second Hack)</h4>
<div class="paragraph data-line-606">
<p>Le deuxième hack de Parity Multisig Wallet est un exemple de la façon dont un code de bibliothèque bien écrit peut être exploité s&#8217;il est exécuté en dehors de son contexte prévu. Il existe un certain nombre de bonnes explications de ce hack, telles que <a href="http://bit.ly/2Dg7GtW" data-href="http://bit.ly/2Dg7GtW">"Parity Multisig Hacked. Encore une fois »</a> et <a href="http://bit.ly/2Of06B9" data-href="http://bit.ly/2Of06B9">« Un examen approfondi du bogue multisig de parity »</a>.</p>
</div>
<div class="paragraph data-line-608">
<p>Pour compléter ces références, explorons les contrats qui ont été exploités. Les contrats de bibliothèque et de portefeuille peuvent être trouvés <a href="http://bit.ly/2OgnXQC" data-href="http://bit.ly/2OgnXQC">sur GitHub</a> .</p>
</div>
<div class="paragraph data-line-610">
<p>Le contrat de bibliothèque est le suivant :</p>
</div>
<div class="listingblock data-line-614">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract WalletLibrary is WalletEvents {

  ...

  // lancer sauf si le contrat n'est pas encore initialisé.
  modifier only_uninitialized { if (m_numOwners &gt; 0) throw; _; }

  // constructeur - il suffit de transmettre le tableau propriétaire à multipropriété et
  // la limite à daylimit
  function initWallet(address[] _owners, uint _required, uint _daylimit)
      only_uninitialized {
    initDaylimit(_daylimit);
    initMultiowned(_owners, _required);
  }

  // tue le contrat en envoyant tout à `_to`.
  function kill(address _to) onlymanyowners(sha3(msg.data)) external {
    suicide(_to);
  }

  ...

}</code></pre>
</div>
</div>
<div class="paragraph data-line-640">
<p>Et voici le contrat de portefeuille :</p>
</div>
<div class="listingblock data-line-643">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Wallet is WalletEvents {

  ...
  // MÉTHODES

  // est appelé lorsqu'aucune autre fonction ne correspond
  function() payable {
    // juste envoyer de l' argent ?
    if (msg.value &gt; 0)
      Deposit(msg.sender, msg.value);
    else if (msg.data.length &gt; 0)
      _walletLibrary.delegatecall(msg.data);
  }

  ...

  // DES CHAMPS
  address constant _walletLibrary =
    0xcafecafecafecafecafecafecafecafecafecafe;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-666">
<p>Notez que le contrat <code>Wallet</code> transmet essentiellement tous les appels au contrat <code>WalletLibrary</code> via un appel délégué. L&#8217;adresse constante <code>_walletLibrary</code> dans cet extrait de code agit comme un espace réservé pour le déploiement réel de contrat <code>WalletLibrary</code> (qui était à 0x863DF6BFa4469f3ead0bE8f9F2AAE51c91A907b4 ).</p>
</div>
<div class="paragraph data-line-668">
<p>L&#8217;opération voulue de ces contrats est d&#8217;avoir un portefeuille <code>Wallet</code> déployable à faible coût dont la base de code et les principales fonctionnalités se trouvaient dans le contrat <code>WalletLibrary</code>. Malheureusement, le contrat <code>WalletLibrary</code> est lui-même un contrat et conserve son propre état. Pouvez-vous voir pourquoi cela pourrait être un problème?</p>
</div>
<div class="paragraph data-line-670">
<p>Il est possible d&#8217;envoyer des appels au contrat <code><span class="keep-together">WalletLibrary</span></code> lui-même. Plus précisément, le contrat <code><span class="keep-together">WalletLibrary</span></code> pourrait être initialisé et devenir propriétaire. En fait, un utilisateur a fait cela, appelant la fonction <code>initWallet</code> sur le contrat <code>WalletLibrary</code> et devenant propriétaire du contrat de bibliothèque. Le même utilisateur a ensuite appelé la fonction <code>kill</code> . Étant donné que l&#8217;utilisateur était propriétaire du contrat de bibliothèque, le modificateur a été adopté et le contrat de bibliothèque s&#8217;est auto-détruit. Comme tous les contrats <code>Wallet</code> existants se réfèrent à ce contrat de bibliothèque et ne contiennent aucune méthode pour modifier cette référence, toutes leurs fonctionnalités, y compris la possibilité de retirer de l&#8217;ether, ont été perdues avec le contrat <code>WalletLibrary</code> . En conséquence, tout l&#8217;ether de tous les portefeuilles multisig Parity de ce type a été instantanément perdu ou définitivement irrécupérable..</p>
</div>
</div>
</div>
<div class="sect2 data-line-672">
<h3 id="_visibilités_par_défaut">Visibilités par défaut</h3>
<div class="paragraph data-line-674">
<p>Les fonctions dans Solidity ont des spécificateurs de visibilité qui dictent comment elles peuvent être appelées. La visibilité détermine si une fonction peut être appelée en externe par les utilisateurs, par d&#8217;autres contrats dérivés, uniquement en interne ou uniquement en externe. Il existe quatre spécificateurs de visibilité, qui sont décrits en détail dans la <a href="http://bit.ly/2ABiv7j" data-href="http://bit.ly/2ABiv7j">documentation Solidity</a>. Les fonctions sont par défaut à <code>public</code> , permettant aux utilisateurs de les appeler de l&#8217;extérieur. Nous allons maintenant voir comment une utilisation incorrecte des spécificateurs de visibilité peut entraîner des vulnérabilités dévastatrices dans les contrats intelligents.</p>
</div>
<div class="sect3 notoc data-line-677">
<h4 id="_la_vulnérabilité_5">La vulnérabilité</h4>
<div class="paragraph data-line-679">
<p>La visibilité par défaut des fonctions est <code>public</code> , donc les fonctions qui ne spécifient pas leur visibilité pourront être appelées par des utilisateurs externes. Le problème survient lorsque les développeurs omettent par erreur les spécificateurs de visibilité sur les fonctions qui devraient être privées (ou uniquement appelables dans le contrat lui-même).</p>
</div>
<div class="paragraph data-line-681">
<p>Explorons rapidement un exemple trivial :</p>
</div>
<div class="listingblock data-line-684">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract HashForEther {

    function withdrawWinnings() {
        // Gagnant si les 8 derniers caractères hexadécimaux de l'adresse sont 0
        require(uint32(msg.sender) == 0);
        _sendWinnings();
     }

     function _sendWinnings() {
         msg.sender.transfer(this.balance);
     }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-700">
<p>Ce contrat simple est conçu pour agir comme un jeu de prime de devinette d&#8217;adresse. Pour remporter le solde du contrat, un utilisateur doit générer une adresse Ethereum dont les 8 derniers caractères hexadécimaux sont 0. Une fois atteint, il peut appeler la fonction <code>withdrawWinnings</code> pour obtenir sa prime.</p>
</div>
<div class="paragraph data-line-702">
<p>Malheureusement, la visibilité des fonctions n&#8217;a pas été précisée. En particulier, la fonction <code>_sendWinnings</code> est <code>public</code> (par défaut), et donc n&#8217;importe quelle adresse peut appeler cette fonction pour voler la prime.</p>
</div>
</div>
<div class="sect3 notoc data-line-705">
<h4 id="_techniques_préventives_5">Techniques préventives</h4>
<div class="paragraph data-line-707">
<p>Il est de bonne pratique de toujours spécifier la visibilité de toutes les fonctions dans un contrat, même si elles sont intentionnellement <code>public</code>. Les versions récentes de solc affichent un avertissement pour les fonctions qui n&#8217;ont pas de visibilité explicite définie, pour encourager cette pratique.</p>
</div>
</div>
<div class="sect3 data-line-709">
<h4 id="_exemple_concret_parity_multisig_wallet_premier_hack">Exemple concret : Parity Multisig Wallet (premier hack)</h4>
<div class="paragraph data-line-711">
<p> Dans le premier multisig hack de Parity, environ 31 millions de dollars d&#8217;ether ont été volés, principalement dans trois portefeuilles. Un bon récapitulatif de la façon exacte dont cela a été fait est donné par <a href="https://bit.ly/2vHiuJQ" data-href="https://bit.ly/2vHiuJQ">Haseeb Qureshi</a>.</p>
</div>
<div class="paragraph data-line-713">
<p>Essentiellement, le portefeuille multisig est construit à partir d&#8217;un contrat <code>Wallet</code> de base, qui appelle un contrat de bibliothèque contenant la fonctionnalité de base (comme décrit dans <a href="#multisig_secondhack">Exemple concret : Parity Multisig Wallet (Second Hack)</a>). Le contrat de bibliothèque contient le code pour initialiser le portefeuille, comme le montre l&#8217;extrait suivant :</p>
</div>
<div class="listingblock data-line-717">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract WalletLibrary is WalletEvents {

  ...

  // MÉTHODES

  ...

  // le constructeur reçoit le nombre de sigs requis pour faire des
  // transactions protégés "seulement pour ces propriétaires" ainsi que
  //  la sélection des adresses capable de les confirmer
  function initMultiowned(address[] _owners, uint _required) {
    m_numOwners = _owners.length + 1;
    m_owners[1] = uint(msg.sender);
    m_ownerIndex[uint(msg.sender)] = 1;
    for (uint i = 0; i &lt; _owners.length; ++i)
    {
      m_owners[2 + i] = uint(_owners[i]);
      m_ownerIndex[uint(_owners[i])] = 2 + i;
    }
    m_required = _required;
  }

  ...

  // constructeur - il suffit de transmettre le tableau propriétaire à multipropriété et
  // la limite à daylimit
  function initWallet(address[] _owners, uint _required, uint _daylimit) {
    initDaylimit(_daylimit);
    initMultiowned(_owners, _required);
  }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-752">
<p>Notez qu&#8217;aucune des fonctions ne spécifie leur visibilité, donc les deux sont par défaut <code>public</code> . La fonction <code>initWallet</code> est appelée dans le constructeur du portefeuille et définit les propriétaires du portefeuille multisig comme on peut le voir dans la fonction <code>initMultiowned</code> . Étant donné que ces fonctions ont été accidentellement laissées publiques , un attaquant a pu appeler ces fonctions sur des contrats déployés, réinitialisant la propriété à l&#8217;adresse de l&#8217;attaquant. En tant que propriétaire, l&#8217;attaquant a ensuite vidé les portefeuilles de tout leur ether.</p>
</div>
</div>
</div>
<div class="sect2 data-line-756">
<h3 id="entropyillusion_security">Illusion d&#8217;entropie</h3>
<div class="paragraph data-line-758">
<p>Toutes les transactions sur la chaîne de blocs Ethereum sont des opérations de transition d&#8217;état déterministes. Cela signifie que chaque transaction modifie l&#8217;état global de l' écosystème Ethereum de manière calculable, sans incertitude. Cela a pour implication fondamentale qu&#8217;il n&#8217;y a pas de source d&#8217;entropie ou d&#8217;aléatoire dans Ethereum. Atteindre une entropie décentralisée (aléatoire) est un problème bien connu pour lequel de nombreuses solutions ont été proposées, y compris <a href="https://github.com/randao/randao" data-href="https://github.com/randao/randao">RANDAO</a> , ou en utilisant une chaîne de hachages, comme décrit par Vitalik Buterin dans le billet de blog <a href="https://vitalik.ca/files/randomness.html" data-href="https://vitalik.ca/files/randomness.html">« Validator Ordering and Randomness in PoS »</a>.</p>
</div>
<div class="sect3 notoc data-line-761">
<h4 id="_la_vulnérabilité_6">La vulnérabilité</h4>
<div class="paragraph data-line-763">
<p>Certains des premiers contrats construits sur la plate-forme Ethereum étaient basés sur le jeu. Fondamentalement, le jeu nécessite de l&#8217;incertitude (quelque chose sur lequel parier), ce qui rend la construction d&#8217;un système de jeu sur la chaîne de blocs (un système déterministe) plutôt difficile. Il est clair que l' incertitude doit provenir d&#8217;une source extérieure à la chaîne de blocs. C&#8217;est possible pour les paris entre joueurs (voir par exemple la <a href="http://bit.ly/2CUh2KS" data-href="http://bit.ly/2CUh2KS">technique commit–reveal</a>); cependant, c&#8217;est beaucoup plus difficile si vous voulez mettre en place un contrat pour agir en tant que "croupier" (comme au blackjack ou à la roulette). Un écueil courant consiste à utiliser des variables de bloc futures, c&#8217;est-à-dire des variables contenant des informations sur le bloc de transaction dont les valeurs ne sont pas encore connues, telles que des hachages, des horodatages, des numéros de bloc ou des limites de gaz. Le problème avec ceux-ci est qu&#8217;ils sont contrôlés par le mineur qui exploite le bloc et, en tant que tels, ne sont pas vraiment aléatoires. Considérez, par exemple, un contrat intelligent de roulette avec une logique qui renvoie un nombre noir si le hachage du bloc suivant se termine par un nombre pair. Un mineur (ou pool de mineurs) pourrait parier 1 million de dollars sur le noir. S&#8217;ils résolvent le bloc suivant et trouvent que le hachage se termine par un nombre impair, ils pourraient heureusement ne pas publier leur bloc et en exploiter un autre, jusqu&#8217;à ce qu&#8217;ils trouvent une solution avec le hachage du bloc étant un nombre pair (en supposant que la récompense du bloc et les frais sont inférieurs à 1 M$). L&#8217;utilisation de variables passées ou présentes peut être encore plus dévastatrice, comme le démontre Martin Swende dans son excellent <a href="http://martin.swende.se/blog/Breaking_the_house.html" data-href="http://martin.swende.se/blog/Breaking_the_house.html">article de blog</a>. De plus, utiliser uniquement des variables de bloc signifie que le nombre pseudo-aléatoire sera le même pour toutes les transactions d&#8217;un bloc, de sorte qu&#8217;un attaquant peut multiplier ses gains en effectuant de nombreuses transactions dans un bloc (si il devait y avoir une mise maximale).</p>
</div>
</div>
<div class="sect3 notoc data-line-766">
<h4 id="_techniques_préventives_6">Techniques préventives</h4>
<div class="paragraph data-line-768">
<p>La source d&#8217;entropie (aléatoire) doit être externe à la chaîne de blocs. Cela peut être fait entre pairs avec des systèmes tels que <a href="http://bit.ly/2CUh2KS" data-href="http://bit.ly/2CUh2KS">commit–reveal</a>, ou en changeant le modèle de confiance en un groupe de participants (comme dans <a href="https://github.com/randao/randao" data-href="https://github.com/randao/randao">RandDAO</a>). Cela peut également être fait via une entité centralisée qui agit comme un oracle aléatoire. Les variables de bloc (en général, il y a quelques exceptions) ne doivent pas être utilisées pour générer de l&#8217;entropie, car elles peuvent être manipulées par les mineurs.</p>
</div>
</div>
<div class="sect3 data-line-770">
<h4 id="_exemple_concret_contrats_prng">Exemple concret : contrats PRNG</h4>
<div class="paragraph data-line-772">
<p>En février 2018 Arseny Reutov <a href="http://bit.ly/2Q589lx" data-href="http://bit.ly/2Q589lx">a blogué</a> sur son analyse de 3 649 contrats intelligents en direct qui utilisaient une sorte de générateur de nombres pseudo-aléatoires (PRNG) ; il a trouvé 43 contrats qui pourraient être exploités.</p>
</div>
</div>
</div>
<div class="sect2 data-line-775">
<h3 id="external_contract_referencing">Référencement des contrats externes</h3>
<div class="paragraph data-line-777">
<p>L&#8217;un des avantages de "l&#8217;ordinateur mondial" Ethereum est la possibilité de réutiliser du code et d&#8217;interagir avec des contrats déjà déployés sur le réseau. En conséquence, un grand nombre de contrats font référence à des contrats externes, généralement via des appels de messages externes. Ces appels de messages externes peuvent masquer les intentions des acteurs malveillants de certaines manières non évidentes, que nous allons maintenant examiner.</p>
</div>
<div class="sect3 notoc data-line-780">
<h4 id="_la_vulnérabilité_7">La vulnérabilité</h4>
<div class="paragraph data-line-782">
<p>Dans Solidity, n&#8217;importe quelle adresse peut être convertie en contrat, que le code à l&#8217;adresse représente ou non le type de contrat en cours de conversion. Cela peut causer des problèmes, en particulier lorsque l&#8217;auteur du contrat tente de dissimuler un code malveillant. Illustrons cela par un exemple.</p>
</div>
<div class="paragraph data-line-784">
<p>Considérez un morceau de code comme <a href="#rot13_security">Rot13Encryption.sol</a>, qui implémente rudimentairement le <a href="https://en.wikipedia.org/wiki/ROT13" data-href="https://en.wikipedia.org/wiki/ROT13">chiffrement ROT13</a> .</p>
</div>
<div id="rot13_security" class="exampleblock data-line-788">
<div class="title">Example 14. Rot13Encryption.sol</div>
<div class="content">
<div class="listingblock data-line-790">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// contrat de chiffrement
contract Rot13Encryption {

   event Result(string convertedString);

    // rot13-chiffre une chaîne
    function rot13Encrypt (string text) public {
        uint256 length = bytes(text).length;
        for (var i = 0; i &lt; length; i++) {
            byte char = bytes(text)[i];
            // assemblage en ligne pour modifier la chaîne
            assembly {
                // récupère le premier octet
                char := byte(0,char)
                // si le caractère est dans [ n,z ], c'est-à-dire l'enveloppant
                if and(gt(char,0x6D), lt(char,0x7B))
                // soustraire du nombre ASCII 'a',
                // la différence entre le caractère &lt;char&gt; et 'z'
                { char:= sub(0x60, sub(0x7A,char)) }
                if iszero(eq(char, 0x20)) // ignore spaces
                // ajoute 13 au caractère
                {mstore8(add(add(text,0x20), mul(i,1)), add(char,13))}
            }
        }
        emit Result(text);
    }

    // rot13-déchiffre une chaîne
    function rot13Decrypt (string text) public {
        uint256 length = bytes(text).length;
        for (var i = 0; i &lt; length; i++) {
            byte char = bytes(text)[i];
            assembly {
                char := byte(0,char)
                if and(gt(char,0x60), lt(char,0x6E))
                { char:= add(0x7B, sub(char,0x61)) }
                if iszero(eq(char, 0x20))
                {mstore8(add(add(text,0x20), mul(i,1)), sub(char,13))}
            }
        }
        emit Result(text);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-837">
<p>Ce code prend simplement une chaîne (lettres a à z, sans validation) et l'<em>encrypte</em> en décalant chaque caractère de 13 positions vers la droite (en s&#8217;enroulant autour de <code>z</code>); c&#8217;est-à-dire <code>a</code> passe à <code>n</code> et <code>x</code> passe à <code>k</code>. L&#8217;assemblage dans le contrat précédent n&#8217;a pas besoin d&#8217;être compris pour apprécier le problème discuté, de sorte que les lecteurs non familiarisés avec l&#8217;assemblage peuvent l&#8217;ignorer en toute sécurité.</p>
</div>
<div class="paragraph data-line-839">
<p>Considérons maintenant le contrat suivant, qui utilise ce code pour son chiffrement :</p>
</div>
<div class="listingblock data-line-842">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Rot13Encryption.sol";

// crypte vos informations top-secrètes
contract EncryptionContract {
    // bibliothèque pour le chiffrement
    Rot13Encryption encryptionLibrary;

    // constructeur - initialise la bibliothèque
    constructor(Rot13Encryption _encryptionLibrary) {
        encryptionLibrary = _encryptionLibrary;
    }

    function encryptPrivateData(string privateInfo) {
        // faire potentiellement quelques opérations ici
        encryptionLibrary.rot13Encrypt(privateInfo);
     }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-863">
<p>Le problème avec ce contrat est que l&#8217;adresse de <code>encryptionLibrary</code> n&#8217;est pas publique ou constante. Ainsi, le déployeur du contrat pourrait donner une adresse dans le constructeur qui pointe vers ce contrat :</p>
</div>
<div class="listingblock data-line-867">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// contrat de chiffrement
contract Rot26Encryption {

   event Result(string convertedString);

    // rot13-encrypte une chaîne
    function rot13Encrypt (string text) public {
        uint256 length = bytes(text).length;
        for (var i = 0; i &lt; length; i++) {
            byte char = bytes(text)[i];
            // assemblage en ligne pour modifier la chaîne
            assembly {
                // récupère le premier octet
                char := byte(0,char)
                // si le caractère est dans [ n,z ], c'est-à-dire l'enveloppant
                if and(gt(char,0x6D), lt(char,0x7B))
                // soustraire du nombre ASCII 'a',
                // la différence entre le caractère &lt;char&gt; et 'z'
                { char:= sub(0x60, sub(0x7A,char)) }
                // ignore les espaces
                if iszero(eq(char, 0x20))
                // ajoute 26 au caractère !
                {mstore8(add(add(text,0x20), mul(i,1)), add(char,26))}
            }
        }
        emit Result(text);
    }

    // rot13-décrypte une chaîne
    function rot13Decrypt (string text) public {
        uint256 length = bytes(text).length;
        for (var i = 0; i &lt; length; i++) {
            byte char = bytes(text)[i];
            assembly {
                char := byte(0,char)
                if and(gt(char,0x60), lt(char,0x6E))
                { char:= add(0x7B, sub(char,0x61)) }
                if iszero(eq(char, 0x20))
                {mstore8(add(add(text,0x20), mul(i,1)), sub(char,26))}
            }
        }
        emit Result(text);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-914">
<p>Ce contrat implémente le chiffrement ROT26, qui décale chaque caractère de 26 places (c&#8217;est-à-dire, ne fait rien). Encore une fois, il n&#8217;est pas nécessaire de comprendre l&#8217;assemblage dans ce contrat. Plus simplement, l&#8217;attaquant aurait pu lier le contrat suivant au même effet :</p>
</div>
<div class="listingblock data-line-917">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Print{
    event Print(string text);

    function rot13Encrypt(string text) public {
        emit Print(text);
    }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-927">
<p>Si l&#8217;adresse de l&#8217;un de ces contrats était donnée dans le constructeur, la fonction <code>encryptPrivateData</code> produirait simplement un événement qui imprime les données privées non chiffrées.</p>
</div>
<div class="paragraph data-line-929">
<p>Bien que dans cet exemple, un contrat de type bibliothèque ait été défini dans le constructeur, il arrive souvent qu&#8217;un utilisateur privilégié (tel qu&#8217;un propriétaire) puisse modifier les adresses de contrat de bibliothèque. Si un contrat lié ne contient pas la fonction appelée, la fonction de secours s&#8217;exécutera. Par exemple, avec la ligne <code>encryptionLibrary.rot13&#x200b;Encrypt()</code>, si le contrat spécifié par <code>encryptionLibrary</code> était :</p>
</div>
<div class="listingblock data-line-932">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity"> contract Blank {
     event Print(string text);
     function () {
         emit Print("Here");
         // placez le code malveillant ici et il s'exécutera
     }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-942">
<p>alors un événement avec le texte <code>Here</code> serait émis. Ainsi, si les utilisateurs peuvent modifier les bibliothèques de contrats, ils peuvent en principe amener d&#8217;autres utilisateurs à exécuter du code arbitraire sans le savoir.</p>
</div>
<div class="admonitionblock warning data-line-945">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-946">
<p>Les contrats représentés ici sont uniquement à des fins de démonstration et ne représentent pas un cryptage approprié. Ils ne devrait pas être utilisé pour le cryptage .</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 notoc data-line-950">
<h4 id="_techniques_préventives_7">Techniques préventives</h4>
<div class="paragraph data-line-952">
<p>Comme démontré précédemment, les contrats sûrs peuvent (dans certains cas) être déployés de telle manière qu&#8217;ils se comportent de manière malveillante. Un auditeur pourrait vérifier publiquement un contrat et demander à son propriétaire de le déployer de manière malveillante, ce qui entraînerait un contrat audité publiquement présentant des vulnérabilités ou une intention malveillante.</p>
</div>
<div class="paragraph data-line-954">
<p>Il existe un certain nombre de techniques qui empêchent ces scénarios.</p>
</div>
<div class="paragraph data-line-956">
<p>Une technique consiste à utiliser le mot-clé <code>new</code> pour créer des contrats. Dans l&#8217;exemple précédent, le constructeur pourrait s&#8217;écrire :</p>
</div>
<div class="listingblock data-line-959">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">constructor() {
    encryptionLibrary = new Rot13Encryption();
}</code></pre>
</div>
</div>
<div class="paragraph data-line-965">
<p>de cette manière, une instance du contrat référencé est créée au moment du déploiement et le déployeur ne peut pas remplacer le contrat <code>Rot13Encryption</code> sans le modifier.</p>
</div>
<div class="paragraph data-line-967">
<p>Une autre solution consiste à coder en dur les adresses de contrat externes.</p>
</div>
<div class="paragraph data-line-969">
<p>En général, le code qui appelle des contrats externes doit toujours être audité avec soin. En tant que développeur, lors de la définition de contrats externes, il peut être judicieux de rendre publiques les adresses des contrats (ce qui n&#8217;est pas le cas dans l&#8217;exemple du pot de miel de la section suivante) pour permettre aux utilisateurs d&#8217;examiner facilement le code référencé par le contrat. Inversement, si un contrat a une adresse de contrat en variable privée, cela peut être le signe d&#8217;un comportement malveillant (comme le montre l&#8217;exemple du monde réel). Si un utilisateur peut modifier une adresse de contrat utilisée pour appeler des fonctions externes, il peut être important (dans un contexte de système décentralisé) d&#8217;implémenter un mécanisme de verrouillage du temps et/ou de vote pour permettre aux utilisateurs de voir quel code est modifié, ou pour donner aux participants la possibilité de s&#8217;inscrire ou s&#8217;abstenir avec la nouvelle adresse contractuelle.</p>
</div>
</div>
<div class="sect3 data-line-971">
<h4 id="_exemple_concret_pot_de_miel_de_réentrance">Exemple concret : pot de miel de réentrance</h4>
<div class="paragraph data-line-973">
<p>Un certain nombre de pots de miel récents ont été publiés sur le réseau principal. Ces contrats tentent de déjouer les pirates Ethereum qui tentent d&#8217;exploiter les contrats, mais qui finissent par perdre de l&#8217;ether au profit du contrat qu&#8217;ils s&#8217;attendent à exploiter. Un exemple utilise cette attaque en remplaçant un contrat attendu par un contrat malveillant dans le constructeur. Le code se trouve <a href="http://bit.ly/2JtdqRi" data-href="http://bit.ly/2JtdqRi">ici</a> :</p>
</div>
<div class="listingblock data-line-976">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.19;

contract Private_Bank
{
    mapping (address =&gt; uint) public balances;
    uint public MinDeposit = 1 ether;
    Log TransferLog;

    function Private_Bank(address _log)
    {
        TransferLog = Log(_log);
    }

    function Deposit()
    public
    payable
    {
        if(msg.value &gt;= MinDeposit)
        {
            balances[msg.sender]+=msg.value;
            TransferLog.AddMessage(msg.sender,msg.value,"Deposit");
        }
    }

    function CashOut(uint _am)
    {
        if(_am&lt;=balances[msg.sender])
        {
            if(msg.sender.call.value(_am)())
            {
                balances[msg.sender]-=_am;
                TransferLog.AddMessage(msg.sender,_am,"CashOut");
            }
        }
    }

    function() external payable{}

}

contract Log
{
    struct Message
    {
        address Sender;
        string  Data;
        uint Val;
        uint  Time;
    }

    Message[] public History;
    Message LastMsg;

    function AddMessage(address _adr,uint _val,string _data)
    public
    {
        LastMsg.Sender = _adr;
        LastMsg.Time = now;
        LastMsg.Val = _val;
        LastMsg.Data = _data;
        History.push(LastMsg);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1042">
<p>Ce <a href="http://bit.ly/2Q58VyX" data-href="http://bit.ly/2Q58VyX">message</a> d&#8217;un utilisateur de reddit explique comment il a perdu 1 ether à cause de ce contrat en essayant d&#8217;exploiter le bogue de réentrance qu&#8217;il s&#8217;attendait à trouver dans le contrat..</p>
</div>
</div>
</div>
<div class="sect2 data-line-1044">
<h3 id="_attaque_par_adresse_courteparamètre">Attaque par adresse courte/paramètre</h3>
<div class="paragraph data-line-1046">
<p>Cette attaque n&#8217;est pas effectuée sur les contrats Solidity eux-mêmes, mais sur des applications tierces susceptibles d&#8217;interagir avec eux. Cette section est ajoutée par souci d&#8217;exhaustivité et pour donner au lecteur une idée de la façon dont les paramètres peuvent être manipulés dans les contrats.</p>
</div>
<div class="paragraph data-line-1048">
<p>Pour en savoir plus, consultez <a href="http://bit.ly/2yKme14" data-href="http://bit.ly/2yKme14">« The ERC20 Short Address Attack Explained »</a> , <a href="http://bit.ly/2yFOGRQ" data-href="http://bit.ly/2yFOGRQ">« ICO Smart Contract Vulnerability : Short Address Attack »</a> , ou ce <a href="http://bit.ly/2CQjBhc" data-href="http://bit.ly/2CQjBhc">post Reddit</a> .</p>
</div>
<div class="sect3 notoc data-line-1051">
<h4 id="_la_vulnérabilité_8">La vulnérabilité</h4>
<div class="paragraph data-line-1053">
<p>Lors de la transmission de paramètres à un contrat intelligent, les paramètres sont codés conformément à la <a href="http://bit.ly/2Q5VIG9" data-href="http://bit.ly/2Q5VIG9">spécification ABI</a> . Il est possible d&#8217;envoyer des paramètres codés plus courts que la longueur de paramètre attendue (par exemple, envoyer une adresse qui ne contient que 38 caractères hexadécimaux (19 octets) au lieu des 40 caractères hexadécimaux standard (20 octets)). Dans un tel scénario, l&#8217;EVM ajoutera des zéros à la fin des paramètres codés pour compenser la longueur attendue.</p>
</div>
<div class="paragraph data-line-1055">
<p>Cela devient un problème lorsque les applications tierces ne valident pas les entrées. L&#8217;exemple le plus clair est un échange qui ne vérifie pas l&#8217;adresse d&#8217;un jeton ERC20 lorsqu&#8217;un utilisateur demande un retrait. Cet exemple est traité plus en détail dans l&#8217;article de Peter Vessenes , <a href="http://bit.ly/2Q1ybpQ" data-href="http://bit.ly/2Q1ybpQ">"The ERC20 Short Address Attack Explained"</a> .</p>
</div>
<div class="paragraph data-line-1057">
<p>Considérez l&#8217;interface de fonction de transfert standard <a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">ERC20</a> , en notant l&#8217;ordre des paramètres :</p>
</div>
<div class="listingblock data-line-1060">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function transfer(address to, uint tokens) public returns (bool success);</code></pre>
</div>
</div>
<div class="paragraph data-line-1064">
<p>Considérons maintenant un échange détenant une grande quantité d&#8217;un jeton (disons <code>REP</code>) et un utilisateur qui souhaite retirer sa part de 100 jetons. L&#8217;utilisateur soumettrait son adresse, <code>0xdeaddeaddeaddeaddeaddeaddeaddeaddeaddead</code> , et le nombre de jetons, <code>100</code>. L&#8217;échange coderait ces paramètres dans l&#8217;ordre spécifié par la fonction <code><span class="keep-together">transfer</span></code>; c&#8217;est-à-dire <code>address</code> puis <code>tokens</code> . Le résultat encodé serait :</p>
</div>
<div class="listingblock data-line-1066">
<div class="content">
<pre>a9059cbb000000000000000000000000deaddeaddea \
ddeaddeaddeaddeaddeaddeaddead0000000000000
000000000000000000000000000000000056bc75e2d63100000</pre>
</div>
</div>
<div class="paragraph data-line-1072">
<p>Les 4 premiers octets ( <code>a9059cbb</code> ) sont <a href="http://bit.ly/2RmueMP" data-href="http://bit.ly/2RmueMP">la signature ou le sélecteur de fonction</a> de <code>transfer</code>, les 32 octets suivants sont l&#8217;adresse et les 32 derniers octets représentent le nombre <code>uint256</code> de jetons. Notez que l&#8217;hex <code>56bc75e2d63100000</code> à la fin correspond à 100 jetons (avec 18 décimales, comme spécifié par le contrat de jeton REP ).</p>
</div>
<div class="paragraph data-line-1074">
<p>Voyons maintenant ce qui se passerait si l&#8217;on envoyait une adresse à laquelle il manquait 1 octet (2 chiffres hexadécimaux). Plus précisément, disons qu&#8217;un attaquant envoie <code>0xdeaddeaddeaddeaddeaddeaddeaddeadde</code> comme adresse (il manque les deux derniers chiffres) et les mêmes 100 jetons à retirer. Si l&#8217;échange ne valide pas cette entrée, elle sera encodée comme :</p>
</div>
<div class="listingblock data-line-1076">
<div class="content">
<pre>a9059cbb000000000000000000000000deaddeaddea \
ddeaddeaddeaddeaddeaddeadde00000000000000
00000000000000000000000000000000056bc75e2d6310000000</pre>
</div>
</div>
<div class="paragraph data-line-1082">
<p>La différence est subtile. Notez que <code>00</code> a été ajouté à la fin de l&#8217;encodage, pour compenser l&#8217;adresse courte qui a été envoyée. Lorsque cela est envoyé au contrat intelligent, les paramètres de <code>address</code> seront lus comme <code>0xdeaddeaddeaddeaddeaddeaddeaddeadde00</code> et la valeur sera lue comme <code>56bc75e2d6310000000</code> (notez les deux 0 supplémentaires). Cette valeur est maintenant de <code>25600</code> jetons (la valeur a été multipliée par <code>256</code>). Dans cet exemple, si l&#8217;échange contenait autant de jetons, l&#8217;utilisateur retirerait <code>25600</code> jetons (alors que l&#8217;échange pense que l&#8217;utilisateur n&#8217;en retire que <code>100</code>) à l&#8217;adresse modifiée. Évidemment , l&#8217;attaquant ne possédera pas l&#8217;adresse modifiée dans cet exemple, mais si l&#8217;attaquant devait générer une adresse qui se terminait par des 0 (qui peut être facilement forcée brutalement) et utilisait cette adresse générée, il pourrait voler des jetons à l&#8217;échange sans méfiance.</p>
</div>
</div>
<div class="sect3 notoc data-line-1085">
<h4 id="_techniques_préventives_8">Techniques préventives</h4>
<div class="paragraph data-line-1087">
<p>Tous les paramètres d&#8217;entrée dans les applications externes doivent être validés avant de les envoyer à la chaîne de blocs. Il convient également de noter que l&#8217;ordre des paramètres joue ici un rôle important. Comme le rembourrage ne se produit qu&#8217;à la fin, un ordre minutieux des paramètres dans le contrat intelligent peut atténuer certaines formes de cette attaque.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1089">
<h3 id="_valeurs_de_retour_call_non_vérifiés">Valeurs de retour CALL non vérifiés</h3>
<div class="paragraph data-line-1091">
<p>Il existe plusieurs façons d&#8217;effectuer des appels externes dans Solidity. L&#8217;envoi d&#8217;ether à des comptes externes est généralement effectué via la méthode <code>transfer</code> . Cependant, la fonction d&#8217;envoi <code>send</code> peut également être utilisée, et pour des appels externes plus polyvalents, l' opcode <code>CALL</code> peut être directement utilisé dans Solidity. Les fonctions d&#8217;appel <code>call</code> et d&#8217;envoi <code>send</code> renvoient un booléen indiquant si l&#8217;appel a réussi ou échoué. Ainsi, ces fonctions ont une simple mise en garde, en ce sens que la transaction qui exécute ces fonctions ne reviendra pas si l&#8217;appel externe ( initialisé par <code>call</code> ou <code>send</code> ) échoue; à la place, les fonctions renverront simplement <code>false</code>. Une erreur courante est que le développeur s&#8217;attend à ce qu&#8217;un retour se produise si l&#8217;appel externe échoue et ne vérifie pas la valeur de retour.</p>
</div>
<div class="paragraph data-line-1093">
<p>Pour en savoir plus, consultez le numéro 4 du <a href="http://www.dasp.co/#item-4" data-href="http://www.dasp.co/#item-4">Top 10 DASP de 2018</a> et <a href="http://bit.ly/2RnS1vA" data-href="http://bit.ly/2RnS1vA">"Scanning Live Ethereum Contracts for the 'Unchecked-Send' Bug"</a>.</p>
</div>
<div class="sect3 notoc data-line-1096">
<h4 id="_la_vulnérabilité_9">La vulnérabilité</h4>
<div class="paragraph data-line-1098">
<p>Considérez l&#8217;exemple suivant :</p>
</div>
<div class="listingblock data-line-1101">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Lotto {

    bool public payedOut = false;
    address public winner;
    uint public winAmount;

    // ... fonctionnalité supplémentaire ici

    function sendToWinner() public {
        require(!payedOut);
        winner.send(winAmount);
        payedOut = true;
    }

    function withdrawLeftOver() public {
        require(payedOut);
        msg.sender.send(this.balance);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1123">
<p>Cela représente un contrat de type Lotto, où un gagnant <code>winner</code> reçoit une quantité d&#8217;ether (<code>winAmount</code>), ce qui laisse généralement un peu de reste à retirer.</p>
</div>
<div class="paragraph data-line-1125">
<p>La vulnérabilité existe sur la ligne 11, où un envoi <code>send</code> est utilisé sans vérifier la réponse. Dans cet exemple trivial, un gagnant <code>winner</code> dont la transaction échoue (soit parce qu&#8217;il est à court d&#8217;essence, soit parce qu&#8217;il s&#8217;agit d&#8217;un contrat qui lance intentionnellement la fonction de secours) permet à <code>payedOut</code> d&#8217;être défini sur <code>true</code>, que l&#8217;ether ait été envoyé ou non. Dans ce cas, n&#8217;importe qui peut retirer les gains du gagnant <code>winner</code> via la fonction <code>withdrawLeftOver</code>.</p>
</div>
</div>
<div class="sect3 notoc data-line-1128">
<h4 id="_techniques_préventives_9">Techniques préventives</h4>
<div class="paragraph data-line-1130">
<p>Dans la mesure du possible, utilisez la fonction <code>transfer</code> plutôt que <code>send</code>, car le transfert sera annulé si la transaction externe est annulée. Si un envoi <code>send</code> est requis, vérifiez toujours la valeur de retour.</p>
</div>
<div class="paragraph data-line-1132">
<p>Une <a href="http://bit.ly/2CSdF7y" data-href="http://bit.ly/2CSdF7y">recommandation</a> plus robuste est d&#8217;adopter un <em>modèle de retrait</em> . Dans cette solution, chaque utilisateur doit appeler une fonction de retrait isolée qui gère l&#8217;envoi d&#8217;ether hors du contrat et traite les conséquences des transactions d&#8217;envoi échouées. L&#8217;idée est d&#8217;isoler logiquement la fonctionnalité d&#8217;envoi externe du reste de la base de code et de placer le fardeau d&#8217;une transaction potentiellement échouée sur l&#8217;utilisateur final appelant la fonction de retrait.</p>
</div>
</div>
<div class="sect3 data-line-1134">
<h4 id="_exemple_concret_etherpot_et_king_of_the_ether">Exemple concret : Etherpot et King of the Ether</h4>
<div class="paragraph data-line-1136">
<p><a href="http://bit.ly/2OfHalK" data-href="http://bit.ly/2OfHalK">Etherpot</a> était une loterie de contrats intelligents, pas trop différente de l&#8217;exemple de contrat mentionné précédemment. La chute de ce contrat était principalement due à une utilisation incorrecte des hachages de bloc (seuls les 256 derniers hachages de bloc sont utilisables ; voir le <a href="http://bit.ly/2Jpzf4x" data-href="http://bit.ly/2Jpzf4x">post d&#8217;Aakil Fernandes</a> sur la manière dont Etherpot n&#8217;a pas réussi à en tenir compte correctement). Cependant, ce contrat a également souffert d&#8217;une valeur d&#8217;appel non contrôlée. Considérez la fonction <code>cash</code> dans <a href="#lotto_security">lotto.sol: Code snippet</a>.</p>
</div>
<div id="lotto_security" class="exampleblock data-line-1140">
<div class="title">Example 15. lotto.sol: Code snippet</div>
<div class="content">
<div class="listingblock data-line-1142">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">...
  function cash(uint roundIndex, uint subpotIndex){

        var subpotsCount = getSubpotsCount(roundIndex);

        if(subpotIndex&gt;=subpotsCount)
            return;

        var decisionBlockNumber = getDecisionBlockNumber(roundIndex,subpotIndex);

        if(decisionBlockNumber&gt;block.number)
            return;

        if(rounds[roundIndex].isCashed[subpotIndex])
            return;
        // Les sous-cagnottes ne peuvent être encaissés qu'une seule fois. C'est pour éviter les doubles paiements
        var winner = calculateWinner(roundIndex,subpotIndex);
        var subpot = getSubpot(roundIndex);

        winner.send(subpot);

        rounds[roundIndex].isCashed[subpotIndex] = true;
        // Marquer le tour comme encaissé
}
...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1171">
<p>Notez qu&#8217;à la ligne 21, la valeur de retour de la fonction <code>send</code> n&#8217;est pas vérifiée, et la ligne suivante définit alors un booléen indiquant que le gagnant a reçu ses fonds. Ce bogue peut autoriser un état où le gagnant ne reçoit pas son ether, mais l&#8217;état du contrat peut indiquer que le gagnant a déjà été payé.</p>
</div>
<div class="paragraph data-line-1173">
<p>Une version plus sérieuse de ce bogue s&#8217;est produite dans le <a href="http://bit.ly/2ACsfi1" data-href="http://bit.ly/2ACsfi1">King of the Ether</a>. Un excellent <a href="http://bit.ly/2ESoaub" data-href="http://bit.ly/2ESoaub">post-mortem</a> de ce contrat a été écrit qui détaille comment un envoi échoué non contrôlé pourrait être utilisé pour attaquer le <span class="keep-together">contrat</span>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1176">
<h3 id="frontrunning_security">Conditions de course/devancement</h3>
<div class="paragraph data-line-1178">
<p>La combinaison d&#8217;appels externes à d&#8217;autres contrats et la nature multi-utilisateurs de la chaîne de blocs sous-jacente donnent lieu à une variété de pièges potentiels de Solidity dans lesquels les utilisateurs font la <em>course</em> à l&#8217;exécution du code pour obtenir des états inattendus. La réentrance (discutée plus haut dans ce chapitre) est un exemple d&#8217;une telle condition de concurrence. Dans cette section, nous discuterons d&#8217;autres types de conditions de concurrence pouvant survenir sur la chaîne de blocs Ethereum. Il existe une variété de bons articles sur ce sujet, y compris "Race Conditions" sur le <a href="http://bit.ly/2yFesFF" data-href="http://bit.ly/2yFesFF">Wiki Ethereum</a> , <a href="http://www.dasp.co/#item-7" data-href="http://www.dasp.co/#item-7">#7 sur le DASP Top10 de 2018</a> , et les <a href="http://bit.ly/2Q6E4lP" data-href="http://bit.ly/2Q6E4lP">meilleures pratiques pour les contrats intelligents Ethereum</a> .</p>
</div>
<div class="sect3 notoc data-line-1181">
<h4 id="_la_vulnérabilité_10">La vulnérabilité</h4>
<div class="paragraph data-line-1183">
<p>Comme avec la plupart des chaînes de blocs, les nœuds Ethereum regroupent les transactions et les forment en blocs. Les transactions ne sont considérées comme valides qu&#8217;une fois qu&#8217;un mineur a résolu un mécanisme de consensus (actuellement <a href="http://bit.ly/2yI5Dv7" data-href="http://bit.ly/2yI5Dv7">Ethash</a> PoW (preuve de travail) pour Ethereum). Le mineur qui résout le bloc choisit également les transactions du bassin qui seront incluses dans le bloc, généralement classées par le <code>gasPrice</code> de chaque transaction. Voici un vecteur d&#8217;attaque potentiel. Un attaquant peut surveiller le bassin de transactions à la recherche de transactions susceptibles de contenir des solutions à des problèmes, et modifier ou révoquer les autorisations du solveur ou changer l&#8217;état d&#8217;un contrat au détriment du solveur. L&#8217;attaquant peut alors obtenir les données de cette transaction et créer sa propre transaction avec un <code>gasPrice</code> plus élevé afin que sa transaction soit incluse dans un bloc avant l&#8217;original.</p>
</div>
<div class="paragraph data-line-1185">
<p>Voyons comment cela pourrait fonctionner avec un exemple simple. Considérez le contrat affiché dans <a href="#findthishash_security">FindThisHash.sol</a>.</p>
</div>
<div id="findthishash_security" class="exampleblock data-line-1189">
<div class="title">Example 16. FindThisHash.sol</div>
<div class="content">
<div class="listingblock data-line-1191">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract FindThisHash {
    bytes32 constant public hash =
      0xb5b5b97fafd9855eec9b41f74dfb6c38f5951141f9a3ecd7f44d5479b630ee0a;

    constructor() external payable {} // load with ether

    function solve(string solution) public {
        // Si vous pouvez trouver la pré-image du hachage, recevez 1000 ether
        require(hash == sha3(solution));
        msg.sender.transfer(1000 ether);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1207">
<p>Supposons que ce contrat contienne 1 000 ether . L&#8217;utilisateur qui peut trouver la préimage du hachage SHA-3 suivant :</p>
</div>
<div class="listingblock data-line-1209">
<div class="content">
<pre>0xb5b5b97fafd9855eec9b41f74dfb6c38f5951141f9a3ecd7f44d5479b630ee0a</pre>
</div>
</div>
<div class="paragraph data-line-1213">
<p>peut soumettre la solution et récupérer les 1 000 ethers . Disons qu&#8217;un utilisateur découvre que la solution est <code>Ethereum!</code>. Ils appellent <code>resolve</code> (résoudre) avec <code>Ethereum!</code> comme paramètre. Malheureusement, un attaquant a été assez intelligent pour surveiller le bassin de transactions pour toute personne soumettant une solution. Ils voient cette solution, vérifient sa validité, puis soumettent une transaction équivalente avec un <code>gasPrice</code> beaucoup plus élevé que la transaction d&#8217;origine. Le mineur qui résout le bloc donnera probablement la préférence à l&#8217;attaquant en raison du <code>gasPrice</code> plus élevé et exploitera sa transaction avant celle du solveur d&#8217;origine. L&#8217;attaquant prendra les 1 000 ethers et l&#8217;utilisateur qui a résolu le problème n&#8217;obtiendra rien. Gardez à l&#8217;esprit que dans ce type de vulnérabilité de "devancement", les mineurs sont particulièrement incités à exécuter les attaques eux-mêmes (ou peuvent être soudoyés pour exécuter ces attaques avec des frais extravagants). La possibilité que l&#8217;attaquant soit lui-même un mineur ne doit pas être sous-estimée.</p>
</div>
</div>
<div class="sect3 notoc data-line-1216">
<h4 id="_techniques_préventives_10">Techniques préventives</h4>
<div class="paragraph data-line-1218">
<p>Il existe deux classes d&#8217;acteurs qui peuvent effectuer ce type d&#8217;attaques de devancement: les utilisateurs (qui modifient la valeur du <code>gasPrice</code> de leurs transactions) et les mineurs eux-mêmes (qui peuvent réorganiser les transactions dans un bloc comme ils l&#8217;entendent). Un contrat vulnérable à la première classe (utilisateurs) est nettement moins bien loti qu&#8217;un contrat vulnérable à la seconde (mineurs), car les mineurs ne peuvent effectuer l&#8217;attaque que lorsqu&#8217;ils résolvent un bloc, ce qui est peu probable pour un mineur individuel ciblant un bloc spécifique. Nous énumérerons ici quelques mesures d&#8217;atténuation relatives aux deux classes d&#8217;attaquants.</p>
</div>
<div class="paragraph data-line-1220">
<p>Une méthode consiste à placer une limite supérieure sur le <code>gasPrice</code>. Cela empêche les utilisateurs d&#8217;augmenter le <code>gasPrice</code> et d&#8217;obtenir un ordre de transaction préférentiel au-delà de la limite supérieure. Cette mesure protège uniquement contre la première classe d&#8217;attaquants (utilisateurs arbitraires). Les mineurs dans ce scénario peuvent toujours attaquer le contrat, car ils peuvent commander les transactions dans leur bloc comme ils le souhaitent, quel que soit le prix du gaz.</p>
</div>
<div class="paragraph data-line-1222">
<p>Une méthode plus robuste consiste à utiliser un schéma de <a href="http://bit.ly/2CUh2KS" data-href="http://bit.ly/2CUh2KS">validation-révélation</a>. Un tel système dicte que les utilisateurs envoient des transactions avec des informations cachées (généralement un hachage). Une fois la transaction incluse dans un bloc, l&#8217;utilisateur envoie une transaction révélant les données qui ont été envoyées (la phase de révélation). Cette méthode empêche les mineurs et les utilisateurs d&#8217;exécuter des transactions en amont, car ils ne peuvent pas déterminer le contenu de la transaction. Cette méthode, cependant, ne peut pas dissimuler la valeur de la transaction (qui, dans certains cas, est l&#8217;information précieuse qui doit être cachée). Le contrat intelligent <a href="https://ens.domains/" data-href="https://ens.domains/">ENS</a> permettait aux utilisateurs d&#8217;envoyer des transactions dont les données engagées comprenaient la quantité d&#8217;ether qu&#8217;ils étaient prêts à dépenser. Les utilisateurs pourraient alors envoyer des transactions de valeur arbitraire. Au cours de la phase de révélation, les utilisateurs ont été remboursés de la différence entre le montant envoyé lors de la transaction et le montant qu&#8217;ils étaient prêts à dépenser.</p>
</div>
<div class="paragraph data-line-1224">
<p>Une autre suggestion de Lorenz Breidenbach, Phil Daian , Ari Juels et Florian Tramèr est d&#8217;utiliser des <a href="http://bit.ly/2SygqQx" data-href="http://bit.ly/2SygqQx">"envois sous-marins"</a>. Une implémentation efficace de cette idée nécessite l' opcode <code>CREATE2</code>, qui n&#8217;a actuellement pas été adopté mais semble susceptible de l&#8217;être dans les embranchements à venir.</p>
</div>
</div>
<div class="sect3 data-line-1226">
<h4 id="_exemples_concrets_erc20_et_bancor">Exemples concrets : ERC20 et Bancor</h4>
<div class="paragraph data-line-1228">
<p>La <a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">norme ERC20</a> est assez connue pour la construction de jetons sur Ethereum. Cette norme présente une vulnérabilité de devancement potentielle due à la fonction d&#8217;approbation <code>approve</code>. <a href="http://bit.ly/2DbvQpJ" data-href="http://bit.ly/2DbvQpJ">Mikhail Vladimirov et Dmitry Khovratovich</a> ont écrit une bonne explication de cette vulnérabilité (et des moyens d&#8217;atténuer l&#8217;attaque).</p>
</div>
<div class="paragraph data-line-1230">
<p>La norme spécifie la fonction d' approbation <code>approve</code> comme suit :</p>
</div>
<div class="listingblock data-line-1233">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function approve(address _spender, uint256 _value) returns (bool success)</code></pre>
</div>
</div>
<div class="paragraph data-line-1237">
<p>Cette fonction permet à un utilisateur d&#8217;autoriser d&#8217;autres utilisateurs à transférer des jetons en son nom. La vulnérabilité de devancement se produit dans le scénario où une utilisatrice Alice <em>autorise</em> son ami Bob à dépenser 100 jetons. Alice décide plus tard qu&#8217;elle veut révoquer l&#8217;autorisation de Bob de dépenser, disons, 100 jetons, alors elle crée une transaction qui fixe l&#8217;allocation de Bob à 50 jetons. Bob, qui a observé attentivement la chaîne, voit cette transaction et construit sa propre transaction en dépensant les 100 jetons. Il met un <code>gasPrice</code> plus élevé sur sa transaction que celle d&#8217;Alice, donc sa transaction est prioritaire sur la sienne. Certaines implémentations d' approbation <code>approve</code> permettraient à Bob de transférer ses 100 jetons, puis, lorsque la transaction d&#8217;Alice est validée, réinitialiserait l&#8217;approbation de Bob à 50 jetons, donnant ainsi à Bob l&#8217;accès à 150 jetons.</p>
</div>
<div class="paragraph data-line-1239">
<p><a href="https://www.bancor.network/" data-href="https://www.bancor.network/">Bancor</a> est un autre exemple important dans le monde réel. Ivan Bogatyy et son équipe ont documenté une attaque rentable sur la mise en œuvre initiale de Bancor. Son <a href="http://bit.ly/2EUlLzb" data-href="http://bit.ly/2EUlLzb">article de blog</a> et <a href="http://bit.ly/2yHgkhs" data-href="http://bit.ly/2yHgkhs">sa conférence DevCon3 expliquent</a> en détail comment cela a été fait. Essentiellement, les prix des jetons sont déterminés en fonction de la valeur de la transaction ; les utilisateurs peuvent surveiller le bassin de transactions pour les transactions Bancor et les exécuter en amont pour profiter des différences de prix. Cette attaque a été traitée par l&#8217;équipe de Bancor.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1241">
<h3 id="_déni_de_service_dos">Déni de service (DoS)</h3>
<div class="paragraph data-line-1243">
<p>Cette catégorie est très large, mais se compose essentiellement d&#8217;attaques où les utilisateurs peuvent rendre un contrat inopérant pendant une période de temps, ou dans certains cas de façon permanente. Cela peut piéger l&#8217;ether dans ces contrats pour toujours, comme ce fut le cas dans <a href="#multisig_secondhack">Exemple concret : Parity Multisig Wallet (Second Hack)</a>.</p>
</div>
<div class="sect3 notoc data-line-1246">
<h4 id="_la_vulnérabilité_11">La vulnérabilité</h4>
<div class="paragraph data-line-1248">
<p>Un contrat peut devenir inopérant de différentes manières. Ici, nous mettons en évidence quelques modèles de codage Solidity moins évidents qui peuvent conduire à des vulnérabilités DoS :</p>
</div>
<div class="dlist data-line-1250">
<dl>
<dt class="hdlist1">Boucle à travers des mappages ou des tableaux manipulés en externe</dt>
<dd>
<p>Ce modèle apparaît généralement lorsqu&#8217;un propriétaire souhaite distribuer des jetons aux investisseurs avec une fonction de type distribution <code>distribute</code>, comme dans cet exemple de contrat :</p>
</dd>
</dl>
</div>
<div class="exampleblock data-line-1252">
<div class="content">
<div class="listingblock data-line-1254">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract DistributeTokens {
    address public owner; // est défini ailleurs
    address[] investors; // tableau d'investisseurs
    uint[] investorTokens; // quantité de jeton que reçoivent les investisseurs

    // ... fonctionnalité supplémentaire, y compris transfertoken()

    function invest() external payable {
        investors.push(msg.sender);
        investorTokens.push(msg.value * 5); // 5 times the wei sent
        }

    function distribute() public {
        require(msg.sender == owner); // only owner
        for(uint i = 0; i &lt; investors.length; i++) {
            // ici transferToken(to,amount) transfère le "montant" de
            // jetons à l'adresse "to"
            transferToken(investors[i],investorTokens[i]);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1279">
<p>Notez que la boucle de ce contrat s&#8217;exécute sur un tableau qui peut être gonflé artificiellement. Un attaquant peut créer de nombreux comptes d&#8217;utilisateurs, ce qui agrandit le tableau des investisseurs <code>investor</code>. En principe, cela peut être fait de telle sorte que le gaz requis pour exécuter la boucle for dépasse la limite de gaz du bloc, rendant essentiellement la fonction de distribution <code>distribute</code> inopérante.</p>
</div>
<div class="dlist data-line-1281">
<dl>
<dt class="hdlist1">Opérations du propriétaire</dt>
<dd>
<p>Un autre modèle courant est celui où les propriétaires ont des privilèges spécifiques dans les contrats et doivent effectuer certaines tâches pour que le contrat passe à l&#8217;état suivant. Un exemple serait un contrat d&#8217;offre initiale de pièces (ICO) qui oblige le propriétaire à finaliser (<code>finalize</code>) le contrat, ce qui permet ensuite aux jetons d&#8217;être transférables. Par example:</p>
</dd>
</dl>
</div>
<div class="exampleblock data-line-1283">
<div class="content">
<div class="listingblock data-line-1285">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">bool public isFinalized = false;
address public owner; // est défini quelque part

function finalize() public {
    require(msg.sender == owner);
    isFinalized == true;
}

// ... fonctionnalité ICO supplémentaire

// fonction de transfert surchargée
function transfer(address _to, uint _value) returns (bool) {
    require(isFinalized);
    super.transfer(_to,_value)
}

...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1306">
<p>Dans de tels cas, si l&#8217;utilisateur privilégié perd ses clés privées ou devient inactif, l&#8217;ensemble du contrat de jeton devient inopérant. Dans ce cas, si le propriétaire ne peut pas appeler <span class="keep-together"><code>finalize</code></span>, aucun jeton ne peut être transféré ; l&#8217;ensemble du fonctionnement de l&#8217;écosystème de jetons repose sur une seule adresse.</p>
</div>
<div class="dlist data-line-1308">
<dl>
<dt class="hdlist1">État de progression basé sur les appels externes</dt>
<dd>
<p>Les contrats sont parfois rédigés de telle sorte que la progression vers un nouvel état nécessite l&#8217;envoi d&#8217;ether à une adresse ou l&#8217;attente d&#8217;une entrée d&#8217;une source externe. Ces modèles peuvent conduire à des attaques DoS lorsque l&#8217;appel externe échoue ou est empêché pour des raisons externes. Dans l&#8217;exemple de l&#8217;envoi d&#8217;ether, un utilisateur peut créer un contrat qui n&#8217;accepte pas l&#8217;ether. Si un contrat exige que l&#8217;ether soit retiré afin de passer à un nouvel état (considérez un contrat à verrouillage temporel qui exige que tout l&#8217;ether soit retiré avant d&#8217;être à nouveau utilisable), le contrat n&#8217;atteindra jamais le nouvel état, car l&#8217;ether ne peut jamais être envoyé au contrat de l&#8217;utilisateur qui n&#8217;accepte pas l&#8217;ether.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 notoc data-line-1311">
<h4 id="_techniques_préventives_11">Techniques préventives</h4>
<div class="paragraph data-line-1313">
<p>Dans le premier exemple, les contrats ne doivent pas boucler sur des structures de données pouvant être artificiellement manipulées par des utilisateurs externes. Un modèle de retrait est recommandé, dans lequel chacun des investisseurs appelle une fonction de retrait pour réclamer des jetons de manière indépendante.</p>
</div>
<div class="paragraph data-line-1315">
<p>Dans le deuxième exemple, un utilisateur privilégié devait modifier l&#8217;état du contrat. Dans de tels exemples, une sécurité intégrée peut être utilisée dans le cas où le propriétaire deviendrait incapable. Une solution consiste à faire du propriétaire un contrat multisig. Une autre solution consiste à utiliser un verrouillage temporel: dans l&#8217;exemple donné, le require à la ligne 5 pourrait inclure un mécanisme basé sur le temps, tel que <code>require(msg.sender == owner || now &gt; unlockTime)</code> , qui permet à tout utilisateur de finaliser après une période de temps spécifiée par <code>unlockTime</code>. Ce type de technique d&#8217;atténuation peut également être utilisé dans le troisième exemple. Si les appels externes doivent progresser vers un nouvel état, tenez compte de leur échec possible et ajoutez éventuellement une progression d&#8217;état basée sur le temps dans le cas où l&#8217;appel souhaité n&#8217;arrive jamais.</p>
</div>
<div class="admonitionblock note data-line-1318">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1319">
<p>Bien sûr, il existe des alternatives centralisées à ces suggestions : on peut ajouter un <code>maintenanceUser</code> qui peut intervenir et résoudre les problèmes avec les vecteurs d&#8217;attaque basés sur DoS si besoin est. Généralement, ces types de contrats posent des problèmes de confiance, en raison du pouvoir d&#8217;une telle entité.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-1322">
<h4 id="_exemples_concrets_gouvernmental">Exemples concrets : GouvernMental</h4>
<div class="paragraph data-line-1324">
<p><a href="http://governmental.github.io/GovernMental/" data-href="http://governmental.github.io/GovernMental/">GovernMental</a> était un ancien schéma de Ponzi qui accumulait une assez grande quantité d&#8217;ether (1 100 ether, à un moment donné). Malheureusement, il était sensible aux vulnérabilités DoS mentionnées dans cette section. Un <a href="http://bit.ly/2DcgvFc" data-href="http://bit.ly/2DcgvFc">post Reddit</a> par etherik décrit comment le contrat exigeait la suppression d&#8217;un grand mappage afin de retirer l&#8217;ether. La suppression de cette cartographie avait un coût en gaz qui dépassait la limite de gaz du bloc à l&#8217;époque, et il n&#8217;était donc pas possible de retirer les 1 100 ethers . L&#8217;adresse du contrat est <a href="http://bit.ly/2Oh8j7R" data-href="http://bit.ly/2Oh8j7R">0xF45717552f12Ef7cb65e95476F217Ea008167Ae3</a>, et vous pouvez voir dans la transaction <a href="http://bit.ly/2Ogzrnn" data-href="http://bit.ly/2Ogzrnn">0x0d80d67202bd9cb6773df8dd2020e719&thinsp;0a1b0793e8ec4fc105257e8128f0506b</a> que les 1 100 ether ont finalement été obtenus via 2.5M en frais de gaz (et ce quand la limite du gaz fût augmenté).</p>
</div>
</div>
</div>
<div class="sect2 data-line-1326">
<h3 id="_blocage_de_la_manipulation_de_lhorodatage">Blocage de la manipulation de l&#8217;horodatage</h3>
<div class="paragraph data-line-1328">
<p>Les horodatages de bloc ont historiquement été utilisés pour une variété d&#8217;applications, telles que l&#8217;entropie pour les nombres aléatoires (voir l'<a href="#entropyillusion_security">Illusion d&#8217;entropie</a> pour plus de détails), le verrouillage des fonds pendant des périodes de temps et diverses instructions conditionnelles de changement d&#8217;état qui dépendent du temps. Les mineurs ont la possibilité d' ajuster légèrement les horodatages, ce qui peut s&#8217;avérer dangereux si les horodatages de bloc sont utilisés de manière incorrecte dans les contrats intelligents.</p>
</div>
<div class="paragraph data-line-1330">
<p>Les références utiles pour cela incluent <a href="http://bit.ly/2OdUC9C" data-href="http://bit.ly/2OdUC9C">la documentation Solidity</a> et <a href="http://bit.ly/2CQ8gh4" data-href="http://bit.ly/2CQ8gh4">la question Ethereum sur Stack Exchange de Joris Bontje</a> sur le sujet.</p>
</div>
<div class="sect3 notoc data-line-1333">
<h4 id="_la_vulnérabilité_12">La vulnérabilité</h4>
<div class="paragraph data-line-1335">
<p><code>block.timestamp</code> et son alias <code>now</code> peuvent désormais être manipulés par les mineurs s&#8217;ils sont incités à le faire. Construisons un jeu simple, montré dans <a href="#roulette_security">roulette.sol</a>, qui serait vulnérable à l&#8217;exploitation des mineurs.</p>
</div>
<div id="roulette_security" class="exampleblock data-line-1339">
<div class="title">Example 17. roulette.sol</div>
<div class="content">
<div class="listingblock data-line-1341">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Roulette {
    uint public pastBlockTime; // force un pari par bloc

    constructor() external payable {} // initialise le financement du contrat

    // fonction de repli utilisée pour faire un pari
    function () external payable {
        require(msg.value == 10 ether); // doit envoyer 10 ether pour jouer
        require(now != pastBlockTime); // seulement 1 transaction par bloc
        pastBlockTime = now;
        if(now % 15 == 0) { // winner
            msg.sender.transfer(this.balance);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1360">
<p>Ce contrat se comporte comme une simple loterie. Une transaction par bloc peut parier 10 ethers pour avoir une chance de gagner le solde du contrat. L&#8217;hypothèse ici est que les deux derniers chiffres de <code>block.timestamp</code> sont uniformément distribués. Si tel était le cas, il y aurait 1 chance sur 15 de gagner à cette loterie.</p>
</div>
<div class="paragraph data-line-1362">
<p>Cependant, comme nous le savons, les mineurs peuvent ajuster l&#8217;horodatage s&#8217;ils en ont besoin. Dans ce cas particulier, s&#8217;il y a suffisamment d&#8217;ether dans le contrat, un mineur qui résout un bloc est incité à choisir un horodatage tel que <code>block.timestamp</code> ou <code>now</code> modulo 15 est <code>0</code>. Ce faisant, ils peuvent gagner l&#8217;ether verrouillé dans ce contrat avec la récompense globale. Comme il n&#8217;y a qu&#8217;une seule personne autorisée à parier par bloc, cela est également vulnérable aux attaques de dépassement (voir <a href="#frontrunning_security">Conditions de course/devancement</a> pour plus de détails).</p>
</div>
<div class="paragraph data-line-1364">
<p>En pratique, les horodatages de bloc augmentent de manière monotone et les mineurs ne peuvent donc pas choisir des horodatages de bloc arbitraires (ils doivent être postérieurs à leurs prédécesseurs). Ils sont également limités à définir des heures de bloc pas trop éloignées dans le futur, car ces blocs seront probablement rejetés par le réseau (les nœuds ne valideront pas les blocs dont les horodatages sont dans le futur).</p>
</div>
</div>
<div class="sect3 notoc data-line-1367">
<h4 id="_techniques_préventives_12">Techniques préventives</h4>
<div class="paragraph data-line-1369">
<p>Les horodatages de bloc ne doivent pas être utilisés pour l&#8217;entropie ou la génération de nombres aléatoires, c&#8217;est-à-dire qu&#8217;ils ne doivent pas être le facteur décisif (directement ou par dérivation) pour gagner un jeu ou changer un état important.</p>
</div>
<div class="paragraph data-line-1371">
<p>Une logique sensible au temps est parfois nécessaire ; par exemple, pour débloquer des contrats (verrou temporel), remplir une ICO après quelques semaines ou faire respecter des dates d&#8217;expiration. Il est parfois recommandé d&#8217;utiliser <a href="http://bit.ly/2OdUC9C" data-href="http://bit.ly/2OdUC9C"><code>block.number</code></a> et un temps de bloc moyen pour estimer les temps; avec un temps de bloc de <code>10 secondes</code>, <code>1 semaine</code> équivaut à environ <code>60 480 blocs</code>. Ainsi, spécifier un numéro de bloc auquel changer un état de contrat peut être plus sûr, car les mineurs sont incapables de manipuler facilement le numéro de bloc. Le contrat <a href="http://bit.ly/2AAebFr" data-href="http://bit.ly/2AAebFr">BAT ICO</a> a employé cette stratégie.</p>
</div>
<div class="paragraph data-line-1373">
<p>Cela peut être inutile si les contrats ne sont pas particulièrement concernés par les manipulations des mineurs de l&#8217;horodatage du bloc, mais c&#8217;est quelque chose dont il faut être conscient lors de l&#8217;élaboration des contrats.</p>
</div>
</div>
<div class="sect3 data-line-1375">
<h4 id="_exemple_concret_governmental">Exemple concret : GovernMental</h4>
<div class="paragraph data-line-1377">
<p><a href="http://governmental.github.io/GovernMental/" data-href="http://governmental.github.io/GovernMental/">GovernMental</a>, l&#8217;ancien schéma de Ponzi mentionné ci-dessus, était également vulnérable à une attaque basée sur l&#8217;horodatage. Le contrat est payé au joueur qui a été le dernier joueur à rejoindre (pendant au moins une minute) un tour. Ainsi, un mineur qui était un joueur pouvait ajuster l&#8217;horodatage (à une heure future, pour donner l&#8217;impression qu&#8217;une minute s&#8217;était écoulée) pour faire apparaître qu&#8217;il était le dernier joueur à rejoindre pendant plus d&#8217;une minute (même si ce n&#8217;était pas vrai dans la réalité). Plus de détails à ce sujet peuvent être trouvés dans le <a href="http://bit.ly/2Q1AMA6" data-href="http://bit.ly/2Q1AMA6">post "Historique des vulnérabilités de sécurité d&#8217;Ethereum, des piratages et de leurs correctifs"</a> par Tanya <span class="keep-together">Bahrynovska</span>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1379">
<h3 id="_constructeurs_avec_soin">Constructeurs avec soin</h3>
<div class="paragraph data-line-1381">
<p>Les constructeurs sont des fonctions spéciales qui effectuent souvent des tâches critiques et privilégiées lors de l&#8217;initialisation des contrats. Avant Solidity v0.4.22, les constructeurs étaient définis comme des fonctions portant le même nom que le contrat qui les contenait. Dans de tels cas, lorsque le nom du contrat est modifié au cours du développement, si le nom du constructeur n&#8217;est pas également modifié, il devient une fonction appelable normale. Comme vous pouvez l&#8217;imaginer, cela peut conduire (et a conduit) à des hacks de contrats intéressants.</p>
</div>
<div class="paragraph data-line-1383">
<p>Pour plus d&#8217;informations, le lecteur peut être intéressé à tenter les <a href="https://github.com/OpenZeppelin/ethernaut" data-href="https://github.com/OpenZeppelin/ethernaut">défis Ethernaut</a> (en particulier le niveau Fallout).</p>
</div>
<div class="sect3 notoc data-line-1386">
<h4 id="_la_vulnérabilité_13">La vulnérabilité</h4>
<div class="paragraph data-line-1388">
<p>Si le nom du contrat est modifié, ou s&#8217;il y a une faute de frappe dans le nom du constructeur qui ne correspond pas au nom du contrat, le constructeur se comportera comme une fonction normale. Cela peut avoir des conséquences désastreuses, surtout si le constructeur effectue des opérations privilégiées. Considérez le contrat suivant :</p>
</div>
<div class="exampleblock data-line-1390">
<div class="content">
<div class="listingblock data-line-1392">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract OwnerWallet {
    address public owner;
    // constructeur
    function ownerWallet(address _owner) public {
        owner = _owner;
    }

    // Par défaut. Récupérer de l'ether.
    function () payable {}

    function withdraw() public {
        require(msg.sender == owner);
        msg.sender.transfer(this.balance);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1411">
<p>Ce contrat collecte de l&#8217;ether et permet uniquement au propriétaire de le retirer, en appelant la fonction de retrait <code>withdraw</code>. Le problème se pose car le constructeur ne porte pas exactement le même nom que le contrat : la première lettre est différente ! Ainsi, n&#8217;importe quel utilisateur peut appeler la fonction <code>ownerWallet</code>, se définir comme propriétaire, puis prendre tout l&#8217;ether du contrat en appelant <code>withdraw</code>.</p>
</div>
</div>
<div class="sect3 notoc data-line-1414">
<h4 id="_techniques_préventives_13">Techniques préventives</h4>
<div class="paragraph data-line-1416">
<p>Ce problème a été résolu dans la version 0.4.22 du compilateur Solidity. Cette version a introduit un mot clé <code>constructor</code> qui spécifie le constructeur, plutôt que d&#8217;exiger que le nom de la fonction corresponde au nom du contrat. L&#8217;utilisation de ce mot-clé pour spécifier les constructeurs est recommandée pour éviter les problèmes de nommage.</p>
</div>
</div>
<div class="sect3 data-line-1418">
<h4 id="_exemple_concret_rubixi">Exemple concret : Rubixi</h4>
<div class="paragraph data-line-1420">
<p><a href="http://bit.ly/2ESWG7t" data-href="http://bit.ly/2ESWG7t">Rubixi</a> était un autre système pyramidal qui présentait ce type de vulnérabilité. Il s&#8217;appelait à l&#8217;origine <code>DynamicPyramid</code> , mais le nom du contrat a été modifié avant le déploiement sur <code>Rubixi</code>. Le nom du constructeur n&#8217;a pas été modifié, permettant à n&#8217;importe quel utilisateur de devenir le créateur. Des discussions intéressantes liées à ce bogue peuvent être trouvées sur <a href="http://bit.ly/2P0TRWw" data-href="http://bit.ly/2P0TRWw">Bitcointalk</a>. En fin de compte, cela a permis aux utilisateurs de se battre pour le statut de créateur afin de réclamer les frais du système pyramidal. Plus de détails sur ce bogue particulier peuvent être trouvés dans <a href="http://bit.ly/2Q1AMA6" data-href="http://bit.ly/2Q1AMA6">"Historique des vulnérabilités de sécurité d&#8217;Ethereum, des piratages et de leurs correctifs"</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1422">
<h3 id="_pointeurs_de_stockage_non_initialisés">Pointeurs de stockage non initialisés</h3>
<div class="paragraph data-line-1424">
<p>L&#8217;EVM stocke les données sous forme de stockage (disque, par exemple) ou de mémoire. Il est fortement recommandé de comprendre exactement comment cela se fait et les types par défaut des variables locales des fonctions lors du développement de contrats. En effet, il est possible de produire des contrats vulnérables en initialisant de manière inappropriée des variables.</p>
</div>
<div class="paragraph data-line-1426">
<p>Pour en savoir plus sur le stockage et la mémoire dans l&#8217;EVM, consultez la documentation de Solidity sur <a href="http://bit.ly/2OdUU0l" data-href="http://bit.ly/2OdUU0l">l&#8217;emplacement des données</a> , la <a href="http://bit.ly/2JslDWf" data-href="http://bit.ly/2JslDWf">disposition des variables d&#8217;état dans le stockage</a> et <a href="http://bit.ly/2Dch2Hc" data-href="http://bit.ly/2Dch2Hc">la disposition dans la mémoire</a>.</p>
</div>
<div class="admonitionblock note data-line-1429">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1430">
<p>Cette section est basée sur un excellent <a href="http://bit.ly/2ERI0pb" data-href="http://bit.ly/2ERI0pb">article de Stefan Beyer</a>. D&#8217;autres lectures sur ce sujet, inspirées par Stefan, peuvent être trouvées dans ce <a href="http://bit.ly/2OgxPtG" data-href="http://bit.ly/2OgxPtG">fil Reddit</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 notoc data-line-1434">
<h4 id="_la_vulnérabilité_14">La vulnérabilité</h4>
<div class="paragraph data-line-1436">
<p>Les variables locales dans les fonctions sont par défaut le stockage ou la mémoire en fonction de leur type. Les variables de stockage local non initialisées peuvent contenir la valeur d&#8217;autres variables de stockage dans le contrat ; ce fait peut provoquer des vulnérabilités involontaires ou être exploité délibérément.</p>
</div>
<div class="paragraph data-line-1438">
<p>Considérons le contrat de bureau d&#8217;enregistrement de noms relativement simple dans <a href="#nameregistrar_security">NameRegistrar.sol</a>.</p>
</div>
<div id="nameregistrar_security" class="exampleblock data-line-1442">
<div class="title">Example 18. NameRegistrar.sol</div>
<div class="content">
<div class="listingblock data-line-1444">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Un bureau d'enregistrement de noms verrouillé
contract NameRegistrar {

    bool public unlocked = false;  // bureau d'enregistrement verrouillé, pas de mises à jour de nom

    struct NameRecord { // mappe les hachages aux adresses
        bytes32 name;
        address mappedAddress;
    }

    // enregistre les noms
    mapping(address =&gt; NameRecord) public registeredNameRecord;
    // résout les hachages en adresses
    mapping(bytes32 =&gt; address) public resolve;

    function register(bytes32 _name, address _mappedAddress) public {
        // configure le nouveau NameRecord
        NameRecord newRecord;
        newRecord.name = _name;
        newRecord.mappedAddress = _mappedAddress;

        resolve[_name] = _mappedAddress;
        registeredNameRecord[msg.sender] = newRecord;

        require(unlocked); // n'autorise les inscriptions que si le contrat est déverrouillé
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1475">
<p>Ce simple registraire de noms n&#8217;a qu&#8217;une seule fonction. Lorsque le contrat est <code>unlocked</code> (déverrouillé), il permet à quiconque d&#8217;enregistrer un nom (sous forme de hachage <code>bytes32</code>) et de mapper ce nom à une adresse. Le bureau d&#8217;enregistrement est initialement verrouillé et l' exigence <code>require</code> à la ligne 25 empêche le registre d&#8217;ajouter des enregistrements de nom avec <code>register</code>. Il semble que le contrat soit inutilisable, car il n&#8217;y a aucun moyen de déverrouiller le registre ! Il existe cependant une vulnérabilité qui permet l&#8217;enregistrement du nom quelle que soit la variable <code>unlocked</code>.</p>
</div>
<div class="paragraph data-line-1477">
<p>Pour discuter de cette vulnérabilité, nous devons d&#8217;abord comprendre comment fonctionne le stockage dans Solidity. En tant qu&#8217;aperçu de haut niveau (sans aucun détail technique approprié - nous vous suggérons de lire les documents Solidity pour un examen approprié), les variables d&#8217;état sont stockées séquentiellement dans les <em>emplacements</em> (ou <em>slots</em>) tels qu&#8217;ils apparaissent dans le contrat (ils peuvent être regroupés mais ne sont pas dans ce exemple, donc nous ne nous en préoccuperons pas). Ainsi, <code>unlocked</code> existe dans <code>slot[0]</code>, <code>registerNameRecord</code> dans <code>slot[1]</code> , et <code>resolve</code> dans <code>slot[2]</code>, etc. Chacun de ces emplacements a une taille de 32 octets (il y a des complexités supplémentaires avec les mappages, que nous ignorerons pour à présent). Le booléen <code>unlocked</code> ressemblera à <code>0x000&#8230;&#8203;0</code> (64 0s, à l&#8217;exclusion du <code>0x</code>) pour <code>false</code> ou <code>0x000&#8230;&#8203;1</code> (63 0s) pour <code>true</code>. Comme vous pouvez le voir, il y a un important gaspillage de stockage dans cet exemple particulier .</p>
</div>
<div class="paragraph data-line-1479">
<p>La pièce suivante du puzzle est que Solidity place par défaut des types de données complexes, tels que des structures structs, en stockage lors de leur initialisation en tant que variables locales. Par conséquent, <span class="keep-together"><code>newRecord</code></span> à la ligne 18 utilise par défaut le stockage. La vulnérabilité est causée par le fait que <span class="keep-together"><code>newRecord</code></span> n&#8217;est pas initialisé. Comme il s&#8217;agit par défaut du stockage, il est mappé sur l&#8217;emplacement de stockage slot[0], qui contient actuellement un pointeur vers <code>unlocked</code>. Notez qu&#8217;aux lignes 19 et 20, nous définissons ensuite <code>newRecord.name</code> sur <code>_name</code> et <code>newRecord.mappedAddress</code> sur <span class="keep-together"><code>_mappedAddress</code></span>; cela met à jour les emplacements de stockage de slot[0] et slot[1], ce qui modifie à la fois <code>unlocked</code> et l&#8217;emplacement de stockage associé à <code>registerNameRecord</code>.</p>
</div>
<div class="paragraph data-line-1481">
<p>Cela signifie que <code>unlocked</code> peut être modifié directement, simplement par le paramètre <code>bytes32 _name</code> de la fonction <code>register</code>. Par conséquent, si le dernier octet de <code>_name</code> est différent de zéro, il modifiera le dernier octet de storage <code>slot[0]</code> et changera directement <code>unlocked</code> en true . De telles valeurs <code>_name</code> entraîneront la réussite de l&#8217;appel <code>require</code> sur la ligne 25, car nous avons défini <code>unlocked</code> sur true . Essayez ceci dans Remix. Notez que la fonction passera si vous utilisez un <code>_name</code> du formulaire :</p>
</div>
<div class="listingblock data-line-1483">
<div class="content">
<pre>0x0000000000000000000000000000000000000000000000000000000000000001</pre>
</div>
</div>
</div>
<div class="sect3 notoc data-line-1488">
<h4 id="_techniques_préventives_14">Techniques préventives</h4>
<div class="paragraph data-line-1490">
<p>Solidity affiche un avertissement pour les variables de stockage non initialisées ; les développeurs doivent prêter une attention particulière à ces avertissements lors de la création de contrats intelligents. La version actuelle de Mist (0.10) ne permet pas de compiler ces contrats. Il est souvent recommandé d&#8217;utiliser explicitement les spécificateurs de mémoire <code>memory</code> ou de stockage <code>storage</code> lorsqu&#8217;il s&#8217;agit de types complexes, pour s&#8217;assurer qu&#8217;ils se comportent comme prévu.</p>
</div>
</div>
<div class="sect3 data-line-1492">
<h4 id="_exemples_concrets_pots_de_miel_openaddresslottery_et_cryptoroulette">Exemples concrets : Pots de miel OpenAddressLottery et CryptoRoulette</h4>
<div class="paragraph data-line-1494">
<p>Un pot de miel nommé <a href="http://bit.ly/2AAVnWD" data-href="http://bit.ly/2AAVnWD">OpenAddressLottery</a> a été déployé qui a utilisé cette bizarrerie de variable de stockage non initialisée pour collecter de l&#8217;ether auprès de certains pirates potentiels. Le contrat est plutôt impliqué, nous laisserons donc l&#8217;analyse au <a href="http://bit.ly/2OgxPtG" data-href="http://bit.ly/2OgxPtG">fil Reddit</a> où l&#8217;attaque est assez clairement expliquée.</p>
</div>
<div class="paragraph data-line-1496">
<p>Un autre pot de miel, <a href="http://bit.ly/2OfNGJ2" data-href="http://bit.ly/2OfNGJ2">CryptoRoulette</a>, a également utilisé cette astuce pour essayer de collecter de l&#8217;ether. Si vous ne pouvez pas comprendre comment fonctionne l&#8217;attaque, consultez <a href="http://bit.ly/2OVkSL4" data-href="http://bit.ly/2OVkSL4">« Une analyse de quelques contrats de pot de miel Ethereum »</a> pour un aperçu de ce contrat et d&#8217;autres.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1498">
<h3 id="_virgule_flottante_et_de_précision">Virgule flottante et de précision</h3>
<div class="paragraph data-line-1500">
<p>Au moment d&#8217;écrire ces lignes (v0.4.24), Solidity ne prend pas en charge les nombres à virgule fixe et à virgule flottante. Cela signifie que les représentations en virgule flottante doivent être construites avec des types entiers dans Solidity. Cela peut entraîner des erreurs et des vulnérabilités s&#8217;il n&#8217;est pas mis en œuvre correctement.</p>
</div>
<div class="admonitionblock note data-line-1503">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1504">
<p>Pour en savoir plus, consultez le <a href="http://bit.ly/2Ogp2Ia" data-href="http://bit.ly/2Ogp2Ia">wiki Ethereum Contract Security Techniques and Tips</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 notoc data-line-1508">
<h4 id="_la_vulnérabilité_15">La vulnérabilité</h4>
<div class="paragraph data-line-1510">
<p>Comme il n&#8217;y a pas de type à virgule fixe dans Solidity, les développeurs doivent implémenter le leur en utilisant les types de données entiers standard. Il existe un certain nombre de pièges que les développeurs peuvent rencontrer au cours de ce processus. Nous allons essayer d&#8217;en souligner quelques-uns dans cette section.</p>
</div>
<div class="paragraph data-line-1512">
<p>Commençons par un exemple de code (nous ignorerons les problèmes de soupassement/dépassement, abordés plus haut dans ce chapitre, pour plus de simplicité) :</p>
</div>
<div class="exampleblock data-line-1514">
<div class="content">
<div class="listingblock data-line-1516">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract FunWithNumbers {
    uint constant public tokensPerEth = 10;
    uint constant public weiPerEth = 1e18;
    mapping(address =&gt; uint) public balances;

    function buyTokens() external payable {
        // convertit wei en eth, puis multiplie par le taux de jeton
        uint tokens = msg.value/weiPerEth*tokensPerEth;
        balances[msg.sender] += tokens;
    }

    function sellTokens(uint tokens) public {
        require(balances[msg.sender] &gt;= tokens);
        uint eth = tokens/tokensPerEth;
        balances[msg.sender] -= tokens;
        msg.sender.transfer(eth*weiPerEth);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1538">
<p>Ce simple contrat d&#8217;achat/vente de jetons présente des problèmes évidents. Bien que les calculs mathématiques pour l&#8217;achat et la vente de jetons soient corrects, l&#8217;absence de nombres à virgule flottante donnera des résultats erronés. Par exemple, lors de l&#8217;achat de jetons sur la ligne 8, si la valeur est inférieure à <code>1 ether</code>, la division initiale donnera <code>0</code>, laissant le résultat de la multiplication finale à <code>0</code> (par exemple, <code>200 wei</code> divisé par <code>1e18</code> <code>weiPerEth</code> est égal à <code>0</code>). De même, lors de la vente de jetons, tout nombre de jetons inférieur à <code>10</code> entraînera également <code>0 ether</code>. En fait, l&#8217;arrondi ici est toujours inférieur, donc la vente de <code>29 jetons</code> se traduira par <code>2 ether</code>.</p>
</div>
<div class="paragraph data-line-1540">
<p>Le problème avec ce contrat est que la précision n&#8217;est qu&#8217;à l&#8217;ether le plus proche (c&#8217;est-à-dire 1e18 wei ). Cela peut devenir délicat lorsqu&#8217;il s&#8217;agit de décimales dans les jetons <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md" data-href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md">ERC20</a> lorsque vous avez besoin d&#8217;une plus grande précision.</p>
</div>
</div>
<div class="sect3 notoc data-line-1543">
<h4 id="_techniques_préventives_15">Techniques préventives</h4>
<div class="paragraph data-line-1545">
<p>Garder la bonne précision dans vos contrats intelligents est très important, en particulier lorsqu&#8217;il s&#8217;agit de ratios et de taux qui reflètent des décisions économiques.</p>
</div>
<div class="paragraph data-line-1547">
<p>Vous devez vous assurer que tous les ratios ou taux que vous utilisez permettent de grands numérateurs dans les fractions. Par exemple, nous avons utilisé le taux <code>tokensPerEth</code> dans notre exemple. Il aurait été préférable d&#8217;utiliser <code>weiPerTokens</code>, qui serait un grand nombre. Pour calculer le nombre correspondant de jetons, nous pourrions faire <code>msg.value/weiPerTokens</code>. Cela donnerait un résultat plus précis.</p>
</div>
<div class="paragraph data-line-1549">
<p>Une autre tactique à garder à l&#8217;esprit est l&#8217;ordre des opérations. Dans notre exemple, le calcul pour acheter des jetons était <code>msg.value/weiPerEth*tokenPerEth</code>. Notez que la division se produit avant la multiplication. (Solidity, contrairement à certains langages, garantit d&#8217;effectuer les opérations dans l&#8217;ordre dans lequel elles sont écrites.) Cet exemple aurait atteint une plus grande précision si le calcul effectuait d&#8217;abord la multiplication puis la division; c&#8217;est-à-dire <code>msg.value*tokenPerEth/weiPerEth</code>.</p>
</div>
<div class="paragraph data-line-1551">
<p>Enfin, lors de la définition d&#8217;une précision arbitraire pour les nombres, il peut être judicieux de convertir les valeurs en une précision supérieure, d&#8217;effectuer toutes les opérations mathématiques, puis de les reconvertir finalement à la précision requise pour la sortie. Généralement, les <code>uint256</code> sont utilisés (car ils sont optimaux pour l&#8217;utilisation du gaz); ceux-ci donnent environ 60 ordres de grandeur dans leur gamme, dont certains peuvent être dédiés à la précision des opérations mathématiques. Il se peut qu&#8217;il soit préférable de conserver toutes les variables en haute précision dans Solidity et de les reconvertir en précisions inférieures dans les applications externes (c&#8217;est essentiellement ainsi que fonctionne la variable décimale dans les contrats de jeton ERC20). Pour voir un exemple de la façon dont cela peut être fait, nous vous recommandons de regarder <a href="https://github.com/dapphub/ds-math" data-href="https://github.com/dapphub/ds-math">DS-Math</a>. Il utilise des noms funky ("wads" et "rays"), mais le concept est utile.</p>
</div>
</div>
<div class="sect3 data-line-1553">
<h4 id="_exemple_concret_ethstick">Exemple concret : Ethstick</h4>
<div class="paragraph data-line-1555">
<p>Le <a href="http://bit.ly/2Qb7PSB" data-href="http://bit.ly/2Qb7PSB">contrat Ethstick</a> n&#8217;utilise pas la précision étendue; cependant, il traite de wei. Donc, ce contrat aura des problèmes d&#8217;arrondi, mais seulement au niveau de précision wei. Il a quelques défauts plus graves, mais ceux-ci sont liés à la difficulté d&#8217;obtenir de l&#8217;entropie sur la chaîne de blocs (voir <a href="#entropyillusion_security">Illusion d&#8217;entropie</a>). Pour une discussion plus approfondie du contrat Ethstick, nous vous renverrons à un autre article de Peter Vessenes, <a href="http://bit.ly/2SwDnE0" data-href="http://bit.ly/2SwDnE0">"Les contrats Ethereum vont être des bonbons pour les pirates"</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1557">
<h3 id="_authentification_tx_origin">Authentification Tx.Origin</h3>
<div class="paragraph data-line-1559">
<p>Solidity a une variable globale, <code>tx.origin</code>, qui parcourt toute la pile d&#8217;appels et contient l&#8217;adresse du compte qui a initialement envoyé l&#8217;appel (ou la transaction). L&#8217;utilisation de cette variable pour l&#8217;authentification dans un contrat intelligent rend le contrat vulnérable à une attaque de type hameçonnage.</p>
</div>
<div class="admonitionblock note data-line-1562">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1563">
<p>Pour en savoir plus, consultez la question Ethereum sur <a href="http://bit.ly/2PxU1UM" data-href="http://bit.ly/2PxU1UM">Stack Exchange de dbryson</a> , <a href="http://bit.ly/2qm7ocJ" data-href="http://bit.ly/2qm7ocJ">"Tx.Origin and Ethereum Oh My!"</a> de Peter Vessenes et <a href="http://bit.ly/2P3KVA4" data-href="http://bit.ly/2P3KVA4">"Solidity : Tx Origin Attacks"</a> de Chris Coverdale.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 notoc data-line-1567">
<h4 id="_la_vulnérabilité_16">La vulnérabilité</h4>
<div class="paragraph data-line-1569">
<p>Les contrats qui autorisent les utilisateurs à utiliser la variable <code>tx.origin</code> sont généralement vulnérables aux attaques de phishing qui peuvent inciter les utilisateurs à effectuer des actions authentifiées sur le contrat vulnérable. Considérez le contrat simple dans <a href="#phishable_security">Phishable.sol</a>.</p>
</div>
<div id="phishable_security" class="exampleblock data-line-1573">
<div class="title">Example 19. Phishable.sol</div>
<div class="content">
<div class="listingblock data-line-1575">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Phishable {
    address public owner;

    constructor (address _owner) {
        owner = _owner;
    }

    function () external payable {} // recevoir ether

    function withdrawAll(address _recipient) public {
        require(tx.origin == owner);
        _recipient.transfer(this.balance);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1593">
<p>Notez qu&#8217;à la ligne 11 le contrat autorise la fonction <code>withdrawAll</code> en utilisant <code>tx.origin</code>. Ce contrat permet à un attaquant de créer un contrat d&#8217;attaque de la forme :</p>
</div>
<div class="listingblock data-line-1596">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Phishable.sol";

contract AttackContract {

    Phishable phishableContract;
    address attacker; // L'adresse de l'attaquant pour recevoir les fonds

    constructor (Phishable _phishableContract, address _attackerAddress) {
        phishableContract = _phishableContract;
        attacker = _attackerAddress;
    }

    function () payable {
        phishableContract.withdrawAll(attacker);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1615">
<p>L&#8217;attaquant pourrait déguiser ce contrat en sa propre adresse privée et organiser socialement la victime (le propriétaire du contrat Phishable ) pour envoyer une forme de transaction à l&#8217;adresse, peut-être en envoyant ce contrat une certaine quantité d&#8217;ether. La victime, à moins d&#8217;être prudente, peut ne pas remarquer qu&#8217;il y a du code à l&#8217;adresse de l&#8217;attaquant, ou l&#8217;attaquant peut le faire passer pour un portefeuille multisignature ou un portefeuille de stockage avancé (rappelez-vous que le code source des contrats publics n&#8217;est pas disponible par défaut) .</p>
</div>
<div class="paragraph data-line-1617">
<p>Dans tous les cas, si la victime envoie une transaction avec suffisamment de gaz à l' adresse <code>AttackContract</code>, elle invoquera la fonction de secours, qui à son tour appellera la fonction <code>withdrawAll</code> du contrat <code>Phishable</code> avec le paramètre <code>attacker</code>. Cela entraînera le retrait de tous les fonds du contrat <code>Phishable</code> à l&#8217;adresse de l' attaquant <code>attacker</code>. C&#8217;est parce que l&#8217;adresse qui a initialement initialisé l&#8217;appel était la victime (c&#8217;est-à-dire le propriétaire du contrat <code>Phishable</code>). Par conséquent, <code>tx.origin</code> sera égal à <code>owner</code> et l' exigence <code>require</code> à la ligne 11 du contrat <code>Phishable</code> passera.</p>
</div>
</div>
<div class="sect3 notoc data-line-1620">
<h4 id="_techniques_préventives_16">Techniques préventives</h4>
<div class="paragraph data-line-1622">
<p><code>tx.origin</code> ne doit pas être utilisé pour l&#8217;autorisation dans les contrats intelligents. Cela ne veut pas dire que la variable <code>tx.origin</code> ne doit jamais être utilisée. Il existe des cas d&#8217;utilisation légitimes dans les contrats intelligents. Par exemple, si l&#8217;on voulait empêcher les contrats externes d&#8217;appeler le contrat actuel, on pourrait implémenter un <code>require</code> de la forme <code>require(tx.origin==msg.sender)</code>. Cela empêche l&#8217;utilisation de contrats intermédiaires pour appeler le contrat en cours, limitant le contrat à des adresses sans code régulier.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1625">
<h3 id="contract_libraries_sec">Contrats de bibliothèques</h3>
<div class="paragraph data-line-1627">
<p>De nombreux codes existants sont disponibles pour être réutilisés, à la fois déployés en chaîne en tant que bibliothèques appelables et hors chaîne en tant que bibliothèques de modèles de code. Les bibliothèques sur plate-forme, ayant été déployées, existent sous forme de contrats intelligents en code intermédiaire (bytecode), il faut donc faire très attention avant de les utiliser en production. Cependant, l&#8217;utilisation de bibliothèques sur plate-forme existantes bien établies présente de nombreux avantages, tels que la possibilité de bénéficier des dernières mises à jour, et vous permet d&#8217;économiser de l&#8217;argent et profite à l&#8217;écosystème Ethereum en réduisant le nombre total de contrats en direct dans Ethereum.</p>
</div>
<div class="paragraph data-line-1629">
<p>Dans Ethereum, la ressource la plus largement utilisée est la <a href="https://openzeppelin.org/" data-href="https://openzeppelin.org/">suite OpenZeppelin</a>, une vaste bibliothèque de contrats allant des implémentations de jetons ERC20 et ERC721, à de nombreuses variantes de modèles de crowdsale , en passant par des comportements simples couramment trouvés dans les contrats, tels que <code>Ownable</code>, <code>Pausable</code> ou <code>LimitBalance</code>. Les contrats de ce référentiel ont été largement testés et, dans certains cas, fonctionnent même comme des implémentations standard <em>de facto .</em> Ils sont libres d' utilisation et sont construits et maintenus par <a href="https://zeppelin.solutions" data-href="https://zeppelin.solutions">Zeppelin</a> avec une liste sans cesse croissante de contributeurs externes.</p>
</div>
<div class="paragraph data-line-1631">
<p>Également de Zeppelin est <a href="https://zeppelinos.org/" data-href="https://zeppelinos.org/">ZeppelinOS</a>, une plate-forme à source libre de services et d&#8217;outils pour développer et gérer en toute sécurité des applications de contrat intelligent. ZeppelinOS fournit une couche au-dessus de l&#8217;EVM qui permet aux développeurs de lancer facilement des DApps évolutives liées à une bibliothèque en chaîne de contrats bien testés qui sont eux-mêmes évolutifs. Différentes versions de ces bibliothèques peuvent coexister sur la plate-forme Ethereum, et un système de caution permet aux utilisateurs de proposer ou de pousser des améliorations dans différentes directions. Un ensemble d&#8217;outils hors chaîne pour déboguer, tester, déployer et surveiller les applications décentralisées est également fourni par la plate-forme.</p>
</div>
<div class="paragraph data-line-1633">
<p>Le projet ethpm vise à organiser les différentes ressources qui se développent dans l&#8217;écosystème en proposant un système de gestion de packages. En tant que tel, leur registre fournit plus d&#8217;exemples à parcourir :</p>
</div>
<div class="ulist data-line-1635">
<ul>
<li class="data-line-1635">
<p>Site Web : <a href="https://www.ethpm.com/" data-href="https://www.ethpm.com/">https://www.ethpm.com/</a></p>
</li>
<li class="data-line-1636">
<p>Lien vers le référentiel : <a href="https://www.ethpm.com/registry" data-href="https://www.ethpm.com/registry">https://www.ethpm.com/registry</a></p>
</li>
<li class="data-line-1637">
<p>Lien GitHub : <a href="https://github.com/ethpm" data-href="https://github.com/ethpm">https://github.com/ethpm</a></p>
</li>
<li class="data-line-1638">
<p>Documentation : <a href="https://www.ethpm.com/docs/integration-guide" data-href="https://www.ethpm.com/docs/integration-guide">https://www.ethpm.com/docs/integration-guide</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-1640">
<h3 id="_conclusion_6">Conclusion</h3>
<div class="paragraph data-line-1642">
<p>Tout développeur travaillant dans le domaine des contrats intelligents a beaucoup à savoir et à comprendre. En suivant les meilleures pratiques dans la conception de votre contrat intelligent et la rédaction de votre code, vous éviterez de nombreux pièges et attrappes.</p>
</div>
<div class="paragraph data-line-21">
<p>Le principe de sécurité logicielle le plus fondamental est peut-être de maximiser la réutilisation du code de confiance. En cryptographie, c&#8217;est si important qu&#8217;il a été condensé en un adage : "Ne lancez pas votre propre crypto." Dans le cas des contrats intelligents, cela revient à tirer le meilleur parti possible des bibliothèques librement disponibles qui ont été soigneusement contrôlées par la communauté.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="tokens_chapter">Jetons</h2>
<div class="sectionbody">
<div class="paragraph data-line-5">
<p>Le mot &quot;token&quot; (jeton) dérive du vieil anglais &quot;tācen&quot;, signifiant un signe ou un symbole. Il est couramment utilisé pour désigner des objets de type pièce de monnaie à usage spécial émis par des particuliers et ayant une valeur intrinsèque insignifiante, tels que des token ou jetons de transport, des jetons de blanchisserie et des jetons de jeux d&#39;arcade.</p>
</div>
<div class="paragraph data-line-7">
<p>De nos jours, les &quot;tokens&quot; ou &quot;jetons&quot; (nous utiliserons le terme français "jeton" pour le restant du chapitre) administrés sur les chaînes de blocs redéfinissent le mot pour désigner des abstractions basées sur la chaîne de blocs qui peuvent être possédées et qui représentent des actifs, des devises ou des droits d&#39;accès.</p>
</div>
<div class="paragraph data-line-9">
<p>L&#39;association entre le mot &quot;jeton&quot; et la valeur insignifiante a beaucoup à voir avec l&#39;utilisation limitée des versions physiques des jetons. Souvent limités à des entreprises, des organisations ou des emplacements spécifiques, les jetons physiques ne sont pas facilement échangeables et n&#39;ont généralement qu&#39;une seule fonction. Avec les jetons de chaîne de blocs, ces restrictions sont levées ou, plus précisément, complètement redéfinissables. De nombreux jetons de chaîne de blocs ont plusieurs objectifs à l&#39;échelle mondiale et peuvent être échangés les uns contre les autres ou contre d&#39;autres devises sur les marchés liquides mondiaux. Avec la disparition des restrictions d&#39;utilisation et de propriété, l&#39;attente d&#39;une &quot;valeur insignifiante&quot; appartient également au passé.</p>
</div>
<div class="paragraph data-line-11">
<p>Dans ce chapitre, nous examinons les différentes utilisations des jetons et comment ils sont créés. Nous discutons également des attributs des jetons tels que la fongibilité et l&#39;intrinsèque. Enfin, nous examinons les normes et les technologies sur lesquelles ils sont basés et expérimentons en créant nos propres jetons.</p>
</div>
<div class="sect2 data-line-14">
<h3 id="tokens_use">Comment les jetons sont utilisés</h3>
<div class="paragraph data-line-16">
<p>L&#39;utilisation la plus évidente des jetons est celle des monnaies privées numériques. Cependant, ce n&#39;est qu&#39;une utilisation possible. Les jetons peuvent être programmés pour remplir de nombreuses fonctions différentes, qui se chevauchent souvent. Par exemple, un jeton peut simultanément transmettre un droit de vote, un droit d&#39;accès et la propriété d&#39;une ressource. Comme le montre la liste suivante, la devise n&#39;est que la première &quot;application&quot; :</p>
</div>
<div class="dlist data-line-18">
<dl>
<dt class="hdlist1">Monnaie</dt>
<dd>
<p>Un jeton peut servir de forme de monnaie, avec une valeur déterminée par le commerce privé.</p>
</dd>
<dt class="hdlist1">Ressource</dt>
<dd>
<p>Un jeton peut représenter une ressource gagnée ou produite dans une économie de partage ou un environnement de partage de ressources ; par exemple, un jeton de stockage ou de processeur représentant des ressources qui peuvent être partagées sur un réseau.</p>
</dd>
<dt class="hdlist1">Actif</dt>
<dd>
<p>un jeton peut représenter la propriété d&#39;un actif intrinsèque ou extrinsèque, tangible ou intangible ; par exemple, de l&#39;or, de l&#39;immobilier, une voiture, du pétrole, de l&#39;énergie, des objets MMOG, etc.</p>
</dd>
<dt class="hdlist1">Accès</dt>
<dd>
<p>un jeton peut représenter des droits d&#39;accès et accorder l&#39;accès à une propriété numérique ou physique, telle qu&#39;un forum de discussion, un site Web exclusif, une chambre d&#39;hôtel ou une voiture de location.</p>
</dd>
<dt class="hdlist1">Équité</dt>
<dd>
<p>Un jeton peut représenter l&#39;équité des actionnaires dans une organisation numérique (par exemple, un DAO) ou une entité juridique (par exemple, une société).</p>
</dd>
<dt class="hdlist1">Vote</dt>
<dd>
<p>Un jeton peut représenter des droits de vote dans un système numérique ou juridique.</p>
</dd>
<dt class="hdlist1">Objet de collection</dt>
<dd>
<p>Un jeton peut représenter un objet de collection numérique (par exemple, CryptoPunks) ou un objet de collection physique (par exemple, une peinture).</p>
</dd>
<dt class="hdlist1">Identité</dt>
<dd>
<p>Un jeton peut représenter une identité numérique (par exemple, un avatar) ou une identité légale (par exemple, une carte d&#39;identité nationale).</p>
</dd>
<dt class="hdlist1">Attestation</dt>
<dd>
<p>Un jeton peut représenter une certification ou une attestation de fait par une autorité ou par un système de réputation décentralisé (par exemple, acte de mariage, certificat de naissance, diplôme universitaire).</p>
</dd>
<dt class="hdlist1">Utilitaire</dt>
<dd>
<p>Un jeton peut être utilisé pour accéder ou payer un service.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-38">
<p>Souvent, un seul jeton englobe plusieurs de ces fonctions. Parfois, il est difficile de les distinguer, car les équivalents physiques ont toujours été inextricablement liés. Par exemple, dans le monde physique, un permis de conduire (attestation) est aussi un document d&#39;identité (identité) et les deux ne peuvent pas être séparés. Dans le domaine numérique, les fonctions précédemment mélangées peuvent être séparées et développées indépendamment (par exemple, une attestation anonyme).</p>
</div>
</div>
<div class="sect2 data-line-41">
<h3 id="tokens_fungibility">Jetons et fongibilité</h3>
<div class="paragraph data-line-43">
<p><a href="https://en.wikipedia.org/wiki/Fungibility" data-href="https://en.wikipedia.org/wiki/Fungibility">Wikipedia</a> dit : &quot; En économie, la fongibilité est la propriété d&#39;un bien ou d&#39;une marchandise dont les unités individuelles sont essentiellement interchangeables.&quot;</p>
</div>
<div class="paragraph data-line-45">
<p>Les jetons sont fongibles lorsque nous pouvons remplacer n&#39;importe quelle unité du jeton par une autre sans aucune différence dans sa valeur ou sa fonction.</p>
</div>
<div class="paragraph data-line-47">
<p>À proprement parler, si la provenance historique d&#39;un jeton peut être suivie, il n&#39;est pas entièrement fongible. La possibilité de suivre la provenance peut conduire à la mise sur liste noire et à la liste blanche, réduisant ou éliminant la fongibilité.</p>
</div>
<div class="paragraph data-line-49">
<p>Les jetons non fongibles sont des jetons qui représentent chacun un élément tangible ou intangible unique et ne sont donc pas interchangeables. Par exemple, un jeton qui représente la propriété d&#39;un tableau <em>spécifique</em> de Van Gogh n&#39;est pas équivalent à un autre jeton qui représente un Picasso, même s&#39;ils peuvent faire partie du même système de &quot;jeton de propriété d&#39;art&quot;. De même, un jeton représentant un objet de collection numérique <em>spécifique</em> tel qu&#39;un CryptoKitty spécifique n&#39;est pas interchangeable avec un autre CryptoKitty. Chaque jeton non fongible est associé à un identifiant unique, tel qu&#39;un numéro de série.</p>
</div>
<div class="paragraph data-line-51">
<p>Nous verrons des exemples de jetons fongibles et non fongibles plus loin dans ce chapitre.</p>
</div>
<div class="admonitionblock note data-line-54">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-55">
<p>Notez que &quot;fongible&quot; est souvent utilisé pour signifier &quot;directement échangeable contre de l&#39;argent&quot; (par exemple, un jeton de casino peut être &quot;encaissé&quot;, contrairement aux jetons de blanchisserie). Ce n&#39;est <em>pas</em> le sens dans lequel nous utilisons le mot ici.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-59">
<h3 id="counterparty_risk">Risque de contrepartie</h3>
<div class="paragraph data-line-61">
<p>Le risque de contrepartie est le risque que l&#39;_autre_ partie à une transaction ne respecte pas ses obligations. Certains types de transactions présentent un risque de contrepartie supplémentaire car il y a plus de deux parties impliquées. Par exemple, si vous détenez un certificat de dépôt pour un métal précieux et que vous le vendez à quelqu&#39;un, il y a au moins trois parties dans cette transaction : le vendeur, l&#39;acheteur et le dépositaire du métal précieux. Quelqu&#39;un détient l&#39;actif physique ; par nécessité, ils deviennent partie à l&#39;exécution de la transaction et ajoutent un risque de contrepartie à toute transaction impliquant cet actif. En général, lorsqu&#39;un actif est négocié indirectement via l&#39;échange d&#39;un jeton de propriété, il existe un risque de contrepartie supplémentaire de la part du dépositaire de l&#39;actif. En ont-ils l&#39;atout ? Reconnaîtront-ils (ou autoriseront-ils) le transfert de propriété basé sur le transfert d&#39;un jeton (tel qu&#39;un certificat, un acte, un titre ou un jeton numérique) ? Dans le monde des jetons numériques représentant des actifs, comme dans le monde non numérique, il est important de comprendre qui détient l&#39;actif représenté par le jeton et quelles règles s&#39;appliquent à cet actif sous-jacent.</p>
</div>
</div>
<div class="sect2 data-line-64">
<h3 id="tokens_intrinsicality">Tokens et Intrinsicité</h3>
<div class="paragraph data-line-66">
<p>Le mot &quot;intrinsèque&quot; dérive du latin &quot;intra&quot;, qui signifie &quot;de l&#39;intérieur&quot;.</p>
</div>
<div class="paragraph data-line-68">
<p>Certains jetons représentent des éléments numériques intrinsèques à la chaîne de blocs. Ces actifs numériques sont régis par des règles consensuelles, tout comme les jetons eux-mêmes. Cela a une implication importante : les jetons qui représentent des actifs intrinsèques ne comportent pas de risque de contrepartie supplémentaire. Si vous détenez les clés d&#39;un CryptoKitty, aucune autre partie ne détient ce CryptoKitty pour vous - vous le possédez directement. Les règles de consensus de la chaîne de blocs s&#39;appliquent et votre propriété (c&#39;est-à-dire votre contrôle) des clés privées équivaut à la propriété de l&#39;actif, sans aucun intermédiaire.</p>
</div>
<div class="paragraph data-line-70">
<p>À l&#39;inverse, de nombreux jetons sont utilisés pour représenter des choses <em>extrinsèques</em>, telles que l&#39;immobilier, les actions avec droit de vote des entreprises, les marques et les lingots d&#39;or. La propriété de ces éléments, qui ne sont pas &quot;dans&quot; la chaîne de blocs, est régie par la loi, la coutume et la politique, distinctes des règles consensuelles qui régissent le jeton. En d&#39;autres termes, les émetteurs et propriétaires de jetons peuvent toujours dépendre de contrats réels non intelligents. En conséquence, ces actifs extrinsèques comportent un risque de contrepartie supplémentaire car ils sont détenus par des dépositaires, enregistrés dans des registres externes ou contrôlés par des lois et des politiques en dehors de l&#39;environnement de la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-72">
<p>L&#39;une des ramifications les plus importantes des jetons basés sur la chaîne de blocs est la capacité de convertir des actifs extrinsèques en actifs intrinsèques et ainsi de supprimer le risque de contrepartie. Un bon exemple est le passage de l&#39;équité dans une société (extrinsèque) à une équité ou à un jeton de vote dans un <em>DAO</em> ou une organisation similaire (intrinsèque).</p>
</div>
</div>
<div class="sect2 data-line-75">
<h3 id="using_tokens">Utilisation de jetons : utilité ou équité</h3>
<div class="paragraph data-line-77">
<p>Presque tous les projets d&#39;Ethereum sont lancés aujourd&#39;hui avec une sorte de jeton. Mais est-ce que tous ces projets ont vraiment besoin de jetons ? Y a-t-il des inconvénients à utiliser un jeton, ou verrons-nous le slogan &quot;tokéniser toutes les choses&quot; se concrétiser ? En principe, l&#39;utilisation de jetons peut être considérée comme l&#39;ultime outil de gestion ou d&#39;organisation. Dans la pratique, l&#39;intégration des plateformes de chaîne de blocs, y compris Ethereum, dans les structures existantes de la société signifie que, jusqu&#39;à présent, il existe de nombreuses limites à leur applicabilité.</p>
</div>
<div class="paragraph data-line-79">
<p>Commençons par clarifier le rôle d&#39;un jeton dans un nouveau projet. La majorité des projets utilisent des jetons de deux manières : soit en tant que « jetons utilitaires », soit en tant que « jetons d&#39;équité ». Très souvent, ces deux rôles sont confondus.</p>
</div>
<div class="paragraph data-line-81">
<p>Les jetons utilitaires sont ceux où l&#39;utilisation du jeton est nécessaire pour accéder à un service, une application ou une ressource. Des exemples de jetons utilitaires incluent des jetons qui représentent des ressources telles que le stockage partagé ou l&#39;accès à des services tels que les réseaux de médias sociaux.</p>
</div>
<div class="paragraph data-line-83">
<p>Les jetons d&#8217;équité sont ceux qui représentent des parts dans le contrôle ou la propriété de quelque chose, comme une startup. Les jetons d&#39;équité peuvent être aussi limités que les actions sans droit de vote pour la distribution des dividendes et des bénéfices, ou aussi expansifs que les actions avec droit de vote dans une organisation autonome décentralisée, où la gestion de la plate-forme se fait par un système de gouvernance complexe basé sur les votes des détenteurs de jetons.</p>
</div>
<div class="sect3 data-line-86">
<h4 id="its_not_duck">C&#39;est un canard !</h4>
<div class="paragraph data-line-88">
<p>De nombreuses startups sont confrontées à un problème difficile : les jetons sont un excellent mécanisme de collecte de fonds, mais offrir des titres (actions) au public est une activité réglementée dans la plupart des juridictions. En déguisant les jetons d&#8217;équité en jetons utilitaires, de nombreuses startups espèrent contourner ces restrictions réglementaires et lever des fonds à partir d&#8217;une offre publique tout en la présentant comme une prévente de "bons d&#8217;accès au service" ou, comme nous les appelons, de jetons utilitaires. Reste à savoir si ces offres d&#8217;actions à peine déguisées pourront contourner les régulateurs.</p>
</div>
<div class="paragraph data-line-90">
<p>Comme le dit le dicton populaire : &quot;Si ça marche comme un canard et cancane comme un canard, c&#39;est un canard.&quot; Les régulateurs ne risquent pas d&#39;être distraits par ces contorsions sémantiques ; bien au contraire, ils sont plus susceptibles de considérer ce sophisme juridique comme une tentative de tromper le public.</p>
</div>
</div>
<div class="sect3 data-line-93">
<h4 id="who_needs_utility_tokens">Jetons utilitaires : qui en a besoin ?</h4>
<div class="paragraph data-line-95">
<p>Le vrai problème est que les jetons utilitaires introduisent des risques importants et des obstacles à l&#39;adoption pour les startups. Peut-être que dans un avenir lointain, &quot;tokéniser toutes les choses&quot; deviendra réalité, mais à l&#39;heure actuelle, l&#39;ensemble des personnes qui comprennent et souhaitent utiliser un jeton est un sous-ensemble du marché déjà petit de la crypto-monnaie.</p>
</div>
<div class="paragraph data-line-97">
<p>Pour une startup, chaque innovation représente un risque et un filtre de marché. L&#39;innovation, c&#39;est emprunter le chemin le moins fréquenté, s&#39;éloigner du chemin de la tradition. C&#39;est déjà une promenade solitaire. Si une startup essaie d&#39;innover dans un nouveau domaine technologique, tel que le partage de stockage sur des réseaux P2P, c&#39;est une voie assez solitaire. L&#39;ajout d&#39;un jeton utilitaire à cette innovation et l&#39;obligation pour les utilisateurs d&#39;adopter des jetons afin d&#39;utiliser le service aggravent le risque et augmentent les obstacles à l&#39;adoption. C&#39;est sortir de la piste déjà solitaire de l&#39;innovation de stockage P2P et dans le désert.</p>
</div>
<div class="paragraph data-line-99">
<p>Considérez chaque innovation comme un filtre. Cela limite l&#39;adoption au sous-ensemble du marché qui peut devenir les premiers à adopter cette innovation. L&#39;ajout d&#39;un deuxième filtre aggrave cet effet, limitant davantage le marché adressable. Vous demandez à vos premiers utilisateurs d&#39;adopter non pas une mais deux technologies entièrement nouvelles : la nouvelle application/plate-forme/service que vous avez créée et l&#39;économie des jetons.</p>
</div>
<div class="paragraph data-line-101">
<p>Pour une startup, chaque innovation introduit des risques qui augmentent les chances d&#39;échec de la startup. Si vous prenez votre idée de démarrage déjà risquée et ajoutez un jeton utilitaire, vous ajoutez tous les risques de la plate-forme sous-jacente (Ethereum), de l&#39;économie plus large (échanges, liquidité), de l&#39;environnement réglementaire (régulateurs des actions/matières premières) et de la technologie (contrats intelligents , normes symboliques). C&#39;est beaucoup de risques pour une startup.</p>
</div>
<div class="paragraph data-line-103">
<p>Les partisans de la &quot;tokénisation de toutes les choses&quot; rétorqueront probablement qu&#39;en adoptant des jetons, ils héritent également de l&#39;enthousiasme du marché, des premiers utilisateurs, de la technologie, de l&#39;innovation et de la liquidité de l&#39;ensemble de l&#39;économie des jetons. C&#39;est vrai aussi. La question est de savoir si les avantages et l&#39;enthousiasme l&#39;emportent sur les risques et les incertitudes.</p>
</div>
<div class="paragraph data-line-105">
<p>Néanmoins, certaines des idées commerciales les plus innovantes se déroulent effectivement dans le domaine de la cryptographie. Si les régulateurs ne sont pas assez rapides pour adopter des lois et soutenir de nouveaux modèles commerciaux, les entrepreneurs et les talents associés chercheront à opérer dans d&#39;autres juridictions plus favorables à la cryptographie. Cela se produit déjà.</p>
</div>
<div class="paragraph data-line-107">
<p>Enfin, au début de ce chapitre, lors de l&#39;introduction des jetons, nous avons discuté de la signification familière du « jeton » comme « quelque chose de valeur insignifiante ». La raison sous-jacente de la valeur insignifiante de la plupart des jetons est qu&#39;ils ne peuvent être utilisés que dans un contexte très étroit : une compagnie d&#8217;autobus, une buanderie automatique, une arcade, un hôtel ou un magasin d&#39;entreprise. Une liquidité limitée, une applicabilité limitée et des coûts de conversion élevés réduisent la valeur des jetons jusqu&#39;à ce qu&#39;ils n&#39;aient plus qu&#39;une valeur « symbolique ». Ainsi, lorsque vous ajoutez un jeton utilitaire à votre plateforme, mais que le jeton ne peut être utilisé que sur votre seule plateforme avec un petit marché, vous recréez les conditions qui ont rendu les jetons physiques sans valeur. Cela peut en effet être la bonne façon d&#39;intégrer la tokenisation dans votre projet. Cependant, si pour utiliser votre plate-forme, un utilisateur doit convertir quelque chose en votre jeton utilitaire, l&#39;utiliser, puis reconvertir le reste en quelque chose de plus généralement utile, vous avez créé un certificat d&#39;entreprise. Les coûts de commutation d&#39;un jeton numérique sont des ordres de grandeur inférieurs à ceux d&#39;un jeton physique sans marché, mais ils ne sont pas nuls. Les jetons utilitaires qui fonctionnent dans tout un secteur industriel seront très intéressants et probablement très précieux. Mais si vous configurez votre startup pour qu&#39;elle doive amorcer une norme industrielle entière pour réussir, vous avez peut-être déjà échoué.</p>
</div>
<div class="admonitionblock note data-line-110">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-111">
<p>L&#39;un des avantages du déploiement de services sur des plates-formes à usage général comme Ethereum est de pouvoir connecter des contrats intelligents (et donc l&#39;utilité des jetons) à travers les projets, augmentant ainsi le potentiel de liquidité et l&#39;utilité des jetons.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-114">
<p>Prenez cette décision pour les bonnes raisons. Adoptez un jeton car votre application <em>ne peut pas fonctionner sans jeton</em>. Adoptez-le car le jeton lève une barrière fondamentale du marché ou résout un problème d&#39;accès. N&#39;introduisez pas de jeton utilitaire car c&#39;est le seul moyen de collecter des fonds rapidement et vous devez prétendre qu&#39;il ne s&#39;agit pas d&#39;une offre publique de titres .</p>
</div>
</div>
</div>
<div class="sect2 data-line-117">
<h3 id="token_std">Jetons sur Ethereum</h3>
<div class="paragraph data-line-119">
<p>Les jetons de chaîne de blocs existaient avant Ethereum. D&#39;une certaine manière, la première monnaie chaîne de blocs, Bitcoin, est un jeton lui-même. De nombreuses plateformes de jetons ont également été développées sur Bitcoin et d&#39;autres crypto-monnaies avant Ethereum. Cependant, l&#39;introduction de la première norme de jeton sur Ethereum a conduit à une explosion de jetons.</p>
</div>
<div class="paragraph data-line-121">
<p>Vitalik Buterin a suggéré les jetons comme l&#39;une des applications les plus évidentes et les plus utiles d&#39;une chaîne de blocs programmable généralisée telle qu&#39;Ethereum. En fait, au cours de la première année d&#39;Ethereum, il était courant de voir Vitalik et d&#39;autres porter des T-shirts arborant le logo Ethereum et un échantillon de contrat intelligent au dos. Il y avait plusieurs variantes de ce T-shirt, mais la plus courante montrait une implémentation d&#39;un jeton.</p>
</div>
<div class="paragraph data-line-123">
<p>Avant de nous plonger dans les détails de la création de jetons sur Ethereum, il est important d&#39;avoir un aperçu du fonctionnement des jetons sur Ethereum. Les jetons sont différents de l&#39;ether car le protocole Ethereum ne sait rien d&#39;eux. L&#39;envoi d&#39;éther est une action intrinsèque de la plateforme Ethereum, mais l&#39;envoi ou même la possession de jetons ne l&#39;est pas. Le solde d&#39;ether des comptes Ethereum est géré au niveau du protocole, tandis que le solde de jetons des comptes Ethereum est géré au niveau du contrat intelligent. Afin de créer un nouveau jeton sur Ethereum, vous devez créer un nouveau contrat intelligent. Une fois déployé, le contrat intelligent gère tout, y compris la propriété, les transferts et les droits d&#39;accès. Vous pouvez rédiger votre contrat intelligent pour effectuer toutes les actions nécessaires comme vous le souhaitez, mais il est probablement plus sage de suivre une norme existante. Nous examinerons ensuite ces normes. Nous discutons des avantages et des inconvénients des normes suivantes à la fin du chapitre.</p>
</div>
<div class="sect3 data-line-127">
<h4 id="ERC20_std">La norme de jeton ERC20</h4>
<div class="paragraph data-line-129">
<p>La première norme a été introduite en novembre 2015 par Fabian Vogelsteller en tant que demande de commentaires Ethereum (ERC). Il s&#39;est automatiquement vu attribuer le numéro de problème GitHub 20, donnant lieu au nom de &quot;jeton ERC20&quot;. La grande majorité des jetons sont actuellement basés sur la norme ERC20. La demande de commentaires ERC20 est finalement devenue la proposition d&#39;amélioration Ethereum 20 (EIP-20), mais elle est encore principalement désignée par le nom d&#39;origine, ERC20.</p>
</div>
<div class="paragraph data-line-131">
<p>ERC20 est une norme pour les <em>jetons fongibles</em>, ce qui signifie que différentes unités d&#39;un token ERC20 sont interchangeables et n&#39;ont pas de propriétés uniques.</p>
</div>
<div class="paragraph data-line-133">
<p><a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">La norme ERC20</a> définit une interface commune pour les contrats mettant en œuvre un jeton, de sorte que tout jeton compatible est accessible et utilisable de la même manière. L&#39;interface se compose d&#39;un certain nombre de fonctions qui doivent être présentes dans chaque implémentation de la norme, ainsi que de certaines fonctions et attributs facultatifs qui peuvent être ajoutés par les développeurs.</p>
</div>
<div class="sect4 data-line-136">
<h5 id="ERC20_reqd_func">Fonctions et événements requis par ERC20</h5>
<div class="paragraph data-line-138">
<p>Un contrat de jeton conforme à ERC20 doit fournir au moins les fonctions et événements suivants :</p>
</div>
<div class="dlist data-line-140">
<dl>
<dt class="hdlist1">totalSupply</dt>
<dd>
<p>Renvoie le nombre total d&#39;unités de ce jeton qui existent actuellement. Les jetons ERC20 peuvent avoir une offre fixe ou variable.</p>
</dd>
<dt class="hdlist1">balanceOf</dt>
<dd>
<p>Étant donné une adresse, renvoie le solde du jeton de cette adresse.</p>
</dd>
<dt class="hdlist1">transfer</dt>
<dd>
<p>Étant donné une adresse et un montant, transfère ce montant de jetons à cette adresse, à partir du solde de l&#39;adresse qui a exécuté le transfert.</p>
</dd>
<dt class="hdlist1">transferFrom</dt>
<dd>
<p>Étant donné un expéditeur, un destinataire et un montant, transfère des jetons d&#39;un compte à un autre. Utilisé en combinaison avec approve.</p>
</dd>
<dt class="hdlist1">approve</dt>
<dd>
<p>Étant donné une adresse et un montant de destinataire, autorise cette adresse à exécuter plusieurs virements jusqu&#39;à ce montant, à partir du compte qui a émis l&#39;approbation.</p>
</dd>
<dt class="hdlist1">allowance</dt>
<dd>
<p>Étant donné une adresse de propriétaire et une adresse de dépensier, renvoie le montant restant que le dépensier est autorisé à retirer au propriétaire.</p>
</dd>
<dt class="hdlist1">Transfer</dt>
<dd>
<p>Evénement déclenché lors d&#39;un transfert réussi (appel à transfer ou transferFrom) (même pour les transferts de valeur nulle).</p>
</dd>
<dt class="hdlist1">Approval</dt>
<dd>
<p>Événement enregistré lors d&#39;un appel réussi à approve.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-157">
<h5 id="ERC20_optional_func">Fonctions optionnelles ERC20</h5>
<div class="paragraph data-line-159">
<p>En plus des fonctions requises listées dans la section précédente, les fonctions optionnelles suivantes sont également définies par la norme :</p>
</div>
<div class="dlist data-line-161">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>Renvoie le nom lisible par l&#39;homme (par exemple, &quot;US Dollars&quot;) du jeton.</p>
</dd>
<dt class="hdlist1">symbol</dt>
<dd>
<p>Renvoie un symbole lisible par l&#39;homme (par exemple, &quot;USD&quot;) pour le jeton.</p>
</dd>
<dt class="hdlist1">decimals</dt>
<dd>
<p>Renvoie le nombre de décimales utilisées pour diviser les quantités de jetons. Par exemple, si decimals vaut 2, alors le montant du jeton est divisé par 100 pour obtenir sa <span class="keep-together">représentation</span> d&#8217;usage.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-168">
<h5 id="ERC20_interface">L&#39;interface ERC20 définie dans Solidity</h5>
<div class="paragraph data-line-170">
<p>Voici à quoi ressemble une spécification d&#39;interface ERC20 dans Solidity :</p>
</div>
<div id="ERC20_interface_example" class="listingblock data-line-174">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract ERC20 {
   function totalSupply() constant returns (uint theTotalSupply);
   function balanceOf(address _owner) constant returns (uint balance);
   function transfer(address _to, uint _value) returns (bool success);
   function transferFrom(address _from, address _to, uint _value) returns
      (bool success);
   function approve(address _spender, uint _value) returns (bool success);
   function allowance(address _owner, address _spender) constant returns
      (uint remaining);
   event Transfer(address indexed _from, address indexed _to, uint _value);
   event Approval(address indexed _owner, address indexed _spender, uint _value);
}</code></pre>
</div>
</div>
</div>
<div class="sect4 data-line-190">
<h5 id="ERC20_data_struct">Structures de données ERC20</h5>
<div class="paragraph data-line-192">
<p>Si vous examinez une implémentation ERC20, vous verrez qu&#39;elle contient deux structures de données, une pour suivre les soldes et une pour suivre indemnités. Dans Solidity, ils sont implémentés avec un <em>data mapping</em> ou <em>mappage de données</em>.</p>
</div>
<div class="paragraph data-line-194">
<p>Le premier mappage de données implémente une table interne des soldes de jetons, par propriétaire. Cela permet au contrat de jeton de garder une trace de qui possède les jetons. Chaque transfert est une déduction d&#39;un solde et un ajout à un autre solde :</p>
</div>
<div id="balance_mapping" class="listingblock data-line-198">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">mapping(address =&gt; uint256) balances;</code></pre>
</div>
</div>
<div class="paragraph data-line-202">
<p>La deuxième structure de données est un mappage de données d&#39;allocations. Comme nous le verrons dans la section suivante, avec les jetons ERC20, le propriétaire d&#39;un jeton peut déléguer l&#39;autorité à un dépensier, lui permettant de dépenser un montant spécifique (allocation) à partir du solde du propriétaire. Le contrat ERC20 assure le suivi des allocations avec un mappage bidimensionnel, la clé primaire étant l&#39;adresse du propriétaire du jeton, mappée à une adresse de dépense et un montant d&#39;allocation :</p>
</div>
<div id="allowance_mapping" class="listingblock data-line-206">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">mapping (address =&gt; mapping (address =&gt; uint256)) public allowed;</code></pre>
</div>
</div>
</div>
<div class="sect4 data-line-212">
<h5 id="transfer_workflows">Flux de travail ERC20 : &quot;transfer&quot; et &quot;approve et transferFrom&quot;</h5>
<div class="paragraph data-line-214">
<p>La norme de jeton ERC20 a deux fonctions de transfert. Vous vous demandez peut-être pourquoi.</p>
</div>
<div class="paragraph data-line-216">
<p>ERC20 permet deux flux de travail différents. Le premier est un flux de travail simple et à transaction unique utilisant la fonction transfer. Ce flux de travail est celui utilisé par les portefeuilles pour envoyer des jetons à d&#39;autres portefeuilles. La grande majorité des transactions de jetons se produisent avec le flux de travail transfer.</p>
</div>
<div class="paragraph data-line-218">
<p>L&#39;exécution du contrat de transfert est très simple. Si Alice veut envoyer 10 jetons à Bob, son portefeuille envoie une transaction à l&#39;adresse du contrat de jeton, en appelant la fonction <span class="keep-together"><code>transfer</code></span> avec l&#39;adresse de Bob et 10 comme arguments. Le contrat de jeton ajuste le solde d&#39;Alice (–10) et le solde de Bob (+10) et émet un événement Transfer.</p>
</div>
<div class="paragraph data-line-220">
<p>Le deuxième flux de travail est un processus à deux transactions qui utilise approve suivi de transferFrom. Ce workflow permet à un propriétaire de jeton de déléguer son contrôle à une autre adresse. Il est le plus souvent utilisé pour déléguer le contrôle à un contrat de distribution de jetons, mais il peut également être utilisé par les échanges.</p>
</div>
<div class="paragraph data-line-222">
<p>Par exemple, si une entreprise vend des tokens pour une ICO (Initial Coin Offerings ou "offres initiales de pièces"), elle peut approve (approuver) une adresse de contrat de crowdsale pour distribuer une certaine quantité de jetons. Le contrat de crowdsale peut alors transferFrom le solde du propriétaire du contrat de jeton à chaque acheteur du jeton, comme illustré dans <a href="#approve_transferFrom_workflow">Le flux de travail d&#39;approbation et de transfert en deux étapes des jetons ERC20</a>.</p>
</div>
<div class="admonitionblock note data-line-225">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-226">
<p>(&quot;Initial Coin Offerings (ICOs)&quot;,&quot;défini&quot;Une <em>Initial Coin Offering</em> (ICO) ou <em>Offres initiales de pièces</em> est un mécanisme de financement participatif utilisé par les entreprises et les organisations pour collecter des fonds en vendant des jetons. Le terme est dérivé de l&#39;offre publique initiale (IPO), qui est le processus par lequel une société publique propose des actions à vendre aux investisseurs en bourse. Contrairement aux marchés des introductions en bourse hautement réglementés, les ICO sont ouverts, mondiaux et désordonnés. Les exemples et les explications des ICO dans ce livre ne constituent pas une approbation de ce type de collecte de fonds.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="approve_transferFrom_workflow" class="imageblock data-line-231">
<div class="content">
<img src="images/approve_transferFrom_workflow.png" alt="&quot;Le flux de travail d&#39;approbation et de transfert en deux étapes des jetons ERC20&quot;">
</div>
<div class="title">Figure 38. Le flux de travail d&#39;approbation et de transfert en deux étapes des jetons ERC20</div>
</div>
<div class="paragraph data-line-233">
<p>Pour le flux de travail approve et transferFrom, deux transactions sont nécessaires. Disons qu&#39;Alice veut autoriser le contrat AliceICO à vendre 50 % de tous les jetons AliceCoin à des acheteurs comme Bob et Charlie. Tout d&#39;abord, Alice lance le contrat AliceCoin ERC20, émettant tous les AliceCoin à sa propre adresse. Ensuite, Alice lance le contrat AliceICO qui peut vendre des jetons contre de l&#39;ether. Ensuite, Alice lance le flux de travail approve et transferFrom. Elle envoie une transaction au contrat AliceCoin, en appelant approve avec l&#39;adresse du contrat AliceICO et 50 % du totalSupply comme arguments. Cela déclenchera l&#39;événement Approbation. Désormais, le contrat AliceICO peut vendre AliceCoin.</p>
</div>
<div class="paragraph data-line-235">
<p>Lorsque le contrat AliceICO reçoit de l&#39;ether de Bob, il doit envoyer des AliceCoin à Bob en retour. Dans le contrat AliceICO se trouve un taux de change entre AliceCoin et de l&#8217;Ether. Le taux de change qu&#39;Alice a fixé lors de la création du contrat AliceICO détermine le nombre de jetons que Bob recevra pour la quantité d&#39;ether envoyé au contrat AliceICO. Lorsque le contrat AliceICO appelle la fonction AliceCoin transferFrom, il définit l&#39;adresse d&#39;Alice comme expéditeur et l&#39;adresse de Bob comme destinataire, et utilise le taux de change pour déterminer le nombre de jetons AliceCoin qui seront transférés à Bob dans le champ value. Le contrat AliceCoin transfère le solde de l&#39;adresse d&#39;Alice à l&#39;adresse de Bob et déclenche un événement Transfer. Le contrat AliceICO peut appeler transferFrom un nombre illimité de fois, tant qu&#39;il ne dépasse pas la limite d&#39;approbation définie par Alice. Le contrat AliceICO peut suivre le nombre de jetons AliceCoin qu&#39;il peut vendre en appelant la fonction allowance.</p>
</div>
</div>
<div class="sect4 data-line-238">
<h5 id="ERC20_implémentation">Implémentations ERC20</h5>
<div class="paragraph data-line-240">
<p>Bien qu&#39;il soit possible d&#39;implémenter un jeton compatible ERC20 dans environ 30 lignes de code Solidity, la plupart des implémentations sont plus complexes. Ceci pour tenir compte des vulnérabilités de sécurité potentielles. Deux implémentations sont mentionnées dans la norme EIP-20 :</p>
</div>
<div class="dlist data-line-242">
<dl>
<dt class="hdlist1"><a href="http://bit.ly/2EUYCMR" data-href="http://bit.ly/2EUYCMR">Consensys EIP20</a></dt>
<dd>
<p>Une implémentation simple et facile à lire d&#39;un jeton compatible ERC20.</p>
</dd>
<dt class="hdlist1"><a href="https://bit.ly/2xPYck6" data-href="https://bit.ly/2xPYck6">OpenZeppelin StandardToken</a></dt>
<dd>
<p>Cette implémentation est compatible ERC20, avec des précautions de sécurité supplémentaires. Il constitue la base des bibliothèques OpenZeppelin implémentant des jetons compatibles ERC20 plus complexes avec des plafonds de collecte de fonds, des enchères, des calendriers d&#39;acquisition et d&#39;autres fonctionnalités.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-247">
<h4 id="METoken_example">Lancement de notre propre jeton ERC20</h4>
<div class="paragraph data-line-249">
<p> Créons et lançons notre propre jeton. Pour cet exemple, nous utiliserons le cadre de développement (framework) Truffle. L&#39;exemple suppose que vous avez déjà installé truffle et que vous l&#39;avez configuré, et que vous êtes familiarisé avec son fonctionnement de base (pour plus de détails, voir <a href="#truffle">Truffle</a>).</p>
</div>
<div class="paragraph data-line-251">
<p>Nous appellerons notre jeton &quot;Mastering Ethereum Token&quot;, avec le symbole &quot;MET&quot;.</p>
</div>
<div class="admonitionblock note data-line-254">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-255">
<p>Vous pouvez trouver cet exemple <a href="https://github.com/ethereumbook/ethereumbook/blob/develop/code/truffle/METoken" data-href="https://github.com/ethereumbook/ethereumbook/blob/develop/code/truffle/METoken">dans le référentiel GitHub du livre</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-258">
<p>Commençons par créer et initialiser un répertoire de projet Truffle. Exécutez ces quatre commandes et acceptez les réponses par défaut à toutes les questions :</p>
</div>
<pre data-type="programlist">
$ <strong>mkdir METoken</strong>
$ <strong>cd METoken</strong>
METoken $ <strong>truffle init</strong>
METoken $ <strong>npm init</strong>

</pre>
<div class="paragraph data-line-270">
<p>Vous devriez maintenant avoir la structure de répertoires suivante :</p>
</div>
<div id="truffle_directory" class="listingblock data-line-273">
<div class="content">
<pre>METoken/
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- package.json
+---- test
+---- truffle-config.js
`---- truffle.js</pre>
</div>
</div>
<div class="paragraph data-line-285">
<p>Modifiez le fichier de configuration <em>truffle.js</em> ou <em>truffle-config.js</em> pour configurer votre environnement Truffle, ou copiez ce dernier depuis <a href="http://bit.ly/2DdP2mz" data-href="http://bit.ly/2DdP2mz">le référentiel</a>.</p>
</div>
<div class="paragraph data-line-287">
<p>Si vous utilisez l&#39;exemple <em>truffle-config.js</em>, pensez à créer un fichier <em>.env</em> dans le dossier <em>METoken</em> contenant vos clés privées de test pour le test et le déploiement sur les réseaux publics de test Ethereum, tels que Ropsten ou Kovan. Vous pouvez exporter votre clé privée de réseau de test à partir de MetaMask.</p>
</div>
<div class="paragraph data-line-289">
<p>Après cela, votre répertoire devrait ressembler à :</p>
</div>
<div id="truffle_directory_metoken" class="listingblock data-line-292">
<div class="content">
<pre>METoken/
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- package.json
+---- test
+---- truffle-config.js
+---- truffle.js
`---- .env *new file*</pre>
</div>
</div>
<div class="admonitionblock warning data-line-306">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-307">
<p>N&#39;utilisez que des clés de test ou des mnémoniques de test qui ne sont <em>pas</em> utilisés pour détenir des fonds sur le réseau Ethereum principal. <em>Ne jamais</em> utiliser des clés contenant de l&#39;argent réel pour les tests.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-310">
<p>Pour notre exemple, nous allons importer la bibliothèque OpenZeppelin, qui implémente des contrôles de sécurité importants et est facile à étendre :</p>
</div>
<pre data-type="programlist">
$ <strong>npm install openzeppelin-solidity@1.12.0</strong>

+ openzeppelin-solidity@1.12.0
added 1 package from 1 contributor and audited 2381 packages in 4.074s

</pre>
<div class="paragraph data-line-322">
<p>Le module de dévelopement openzeppelin-solidity ajoutera environ 250 fichiers sous le répertoire <em>node_modules</em>. La bibliothèque OpenZeppelin comprend bien plus que le jeton ERC20, mais nous n&#39;en utiliserons qu&#39;une petite partie.</p>
</div>
<div class="paragraph data-line-324">
<p>Ensuite, écrivons notre contrat de jeton. Créez un nouveau fichier, <em>METoken.sol</em>, et copiez l&#39;exemple de code depuis <a href="http://bit.ly/2qfIFH0" data-href="http://bit.ly/2qfIFH0">GitHub</a>.</p>
</div>
<div class="paragraph data-line-326">
<p>Notre contrat, illustré en <a href="#solidity_token_example">METoken.sol : Un contrat Solidity implémentant un token ERC20</a>, est très simple, car il hérite toutes ses fonctionnalités de la bibliothèque OpenZeppelin.</p>
</div>
<div id="solidity_token_example" class="exampleblock data-line-330">
<div class="title">Example 20. METoken.sol : Un contrat Solidity implémentant un token ERC20</div>
<div class="content">
<div class="listingblock data-line-332">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.21;

import 'openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol';

contract METoken is StandardToken {
    string public constant name = 'Mastering Ethereum Token';
    string public constant symbol = 'MET';
    uint8 public constant decimals = 2;
    uint constant _initial_supply = 2100000000;

    function METoken() public {
        totalSupply_ = _initial_supply;
        balances[msg.sender] = _initial_supply;
        emit Transfer(address(0), msg.sender, _initial_supply);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-337">
<p>Ici, nous définissons les variables optionnelles name, symbol et decimals. Nous définissons également une variable _initial_supply, définie sur 21 millions de jetons ; avec deux décimales de subdivision qui donne 2,1 milliards d&#39;unités au total. Dans la fonction d&#39;initialisation (constructeur) du contrat, nous définissons le totalSupply égal à _initial_supply et allouons tout le _initial_supply au solde du compte (msg.sender) qui crée le contrat METoken.</p>
</div>
<div class="paragraph data-line-339">
<p>Nous utilisons maintenant truffe pour compiler le code METoken :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle compile</strong>
Compiling ./contracts/METoken.sol...
Compiling ./contracts/Migrations.sol...
Compiling openzeppelin-solidity/contracts/math/SafeMath.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/BasicToken.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/ERC20.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/ERC20Basic.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol...

</pre>
<div class="paragraph data-line-355">
<p>Comme vous pouvez le voir, truffle intègre les dépendances nécessaires des bibliothèques OpenZeppelin et compile également ces contrats.</p>
</div>
<div class="paragraph data-line-357">
<p>Configurons un script de migration pour déployer le contrat METoken. Créez un nouveau fichier appelé <em>2_deploy_contracts.js</em>, dans le dossier <em>METoken/migrations</em>. Copiez le contenu de l&#39;exemple <a href="http://bit.ly/2P0rHLl" data-href="http://bit.ly/2P0rHLl">dans le référentiel GitHub</a> :</p>
</div>
<div id="METoken_migration" class="listingblock data-line-0">
<div class="title">2_deploy_contracts : Migration pour déployer METoken</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var METoken = artifacts.require("METoken");

module.exports = function(deployer) {
  // Deploy the METoken contract as our only task
  deployer.deploy(METoken);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-367">
<p>Avant de déployer sur l&#39;un des réseaux de test Ethereum, démarrons une chaîne de blocs locale pour tout tester. Démarrez la chaîne de blocs ganache, soit depuis la ligne de commande avec ganache-cli, soit depuis l&#39;interface utilisateur graphique.</p>
</div>
<div class="paragraph data-line-369">
<p>Une fois ganache lancé, nous pouvons déployer notre contrat METoken et voir si tout fonctionne comme prévu :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle migrate --network ganache</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb2e90a056dc6ad8e654683921fc613c796a03b89df6760ec1db1084ea4a084eb
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying METoken...
  ... 0xbe9290d59678b412e60ed6aefedb17364f4ad2977cfb2076b9b8ad415c5dc9f0
  METoken: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

</pre>
<div class="paragraph data-line-394">
<p>Sur la console ganache, nous devrions voir que notre déploiement a créé quatre nouvelles transactions, comme illustré dans <a href="#ganache_METoken">Déploiement METoken sur ganache</a>.</p>
</div>
<div id="ganache_METoken" class="imageblock data-line-398">
<div class="content">
<img src="images/ganache_metoken.png" alt="&quot;Déploiement de METoken sur Ganache&quot;">
</div>
<div class="title">Figure 39. Déploiement METoken sur ganache</div>
</div>
<div class="sect4 data-line-401">
<h5 id="truffle_console">Interagir avec METoken à l&#39;aide de la console Truffle</h5>
<div class="paragraph data-line-403">
<p> Nous pouvons interagir avec notre contrat sur la chaîne de blocs ganache en utilisant la console Truffle. Il s&#39;agit d&#39;un environnement JavaScript interactif qui donne accès à l&#39;environnement Truffle et, via web3, à la chaîne de blocs. Dans ce cas, nous allons connecter la console Truffle à la chaîne de blocs ganache :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt;

</pre>
<div class="paragraph data-line-413">
<p>L&#39;invite truffe(ganache)&amp;gt; indique que nous sommes connectés à la chaîne de blocs ganache et que nous sommes prêts à taper nos commandes. La console Truffle prend en charge toutes les commandes truffle, nous pourrions donc compiler et migrer depuis la console. Nous avons déjà exécuté ces commandes, allons donc directement au contrat lui-même. Le contrat METoken existe en tant qu&#39;objet JavaScript dans l&#39;environnement Truffle. Tapez METoken** à l&#39;invite et il affichera l&#39;intégralité de la définition du contrat :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken</strong>
{ [Function: TruffleContract]
  _static_methods:

[...]

currentProvider:
 HttpProvider {
   host: 'http://localhost:7545',
   timeout: 0,
   user: undefined,
   password: undefined,
   headers: undefined,
   send: [Function],
   sendAsync: [Function],
   _alreadyWrapped: true },
network_id: '5777' }

</pre>
<div class="paragraph data-line-438">
<p>L&#39;objet METoken expose également plusieurs attributs, tels que l&#39;adresse du contrat (telle que déployée par la commande migrate) :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.address</strong>
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'

</pre>
<div class="paragraph data-line-448">
<p>Si nous voulons interagir avec le contrat déployé, nous devons utiliser un appel asynchrone, sous la forme d&#39;une &quot;promesse&quot; JavaScript. Nous utilisons la fonction deployed pour obtenir l&#39;instance de contrat, puis appelons la fonction totalSupply :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance => instance.totalSupply())</strong>
BigNumber { s: 1, e: 9, c: [ 2100000000 ] }

</pre>
<div class="paragraph data-line-458">
<p>Ensuite, utilisons les comptes créés par ganache pour vérifier notre solde de METoken et envoyer des METoken à une autre adresse. Commençons par obtenir les adresses de compte :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>let accounts</strong>
undefined
truffle(ganache)&gt; <strong>web3.eth.getAccounts((err,res) => { accounts = res })</strong>
undefined
truffle(ganache)&gt; <strong>accounts[0]</strong>
'0x627306090abab3a6e1400e9345bc60c78a8bef57'

</pre>
<div class="paragraph data-line-472">
<p>La liste accounts contient maintenant tous les comptes créés par ganache, et account[0] est le compte qui a déployé le contrat METoken. Il devrait avoir un solde de <span class="keep-together">METoken</span>, car notre constructeur METoken donne l&#39;intégralité de l&#39;offre de jetons à l&#39;adresse qui l&#39;a créé. Allons vérifier:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =></strong>
                  <strong>{ instance.balanceOf(accounts[0]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 9, c: [ 2100000000 ] }</strong>

</pre>
<div class="paragraph data-line-484">
<p>Enfin, transférons 1000.00 METoken de account[0] vers account[1], en appelant la fonction transfer du contrat :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.transfer(accounts[1], 100000) })</strong>
undefined
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(accounts[0]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 9, c: [ 2099900000 ] }</strong>
undefined
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(accounts[1]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 5, c: [ 100000 ] }</strong>

</pre>
<div class="admonitionblock tip data-line-505">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-506">
<p>METoken a 2 décimales de précision, ce qui signifie que 1 METoken correspond à 100 unités dans le contrat. Lorsque nous transférons 1 000 METoken, nous spécifions la valeur comme 100000 dans l&#39;appel à la fonction transfer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-509">
<p>Comme vous pouvez le voir, dans la console, account[0] a maintenant 20 999 000 MET, et account[1] a 1 000 MET.</p>
</div>
<div class="paragraph data-line-511">
<p>Si vous passez à l&#39;interface utilisateur graphique ganache, comme indiqué dans <a href="#ganache_METoken_transfer">Transfert METoken sur ganache</a>, vous verrez la transaction qui a appelé la fonction transfer.</p>
</div>
<div id="ganache_METoken_transfer" class="imageblock data-line-515">
<div class="content">
<img src="images/ganache_metoken_transfer.png" alt="&quot;Transfert METoken sur Ganache&quot;">
</div>
<div class="title">Figure 40. Transfert METoken sur ganache</div>
</div>
</div>
<div class="sect4 data-line-518">
<h5 id="sending_erc20_tokens_contracts">Envoi de jetons ERC20 aux adresses contractuelles</h5>
<div class="paragraph data-line-520">
<p> Jusqu&#39;à présent, nous avons configuré un jeton ERC20 et transféré certains jetons d&#39;un compte à un autre. Tous les comptes que nous avons utilisés pour ces démonstrations sont des comptes externes, ce qui signifie qu&#39;ils sont contrôlés par une clé privée et non par un contrat. Que se passe-t-il si nous envoyons MET à une adresse contractuelle ? Découvrons-le!</p>
</div>
<div class="paragraph data-line-522">
<p>Tout d&#39;abord, déployons un autre contrat dans notre environnement de test. Pour cet exemple, nous utiliserons notre premier contrat, <em>Faucet.sol</em>. Ajoutons-le au projet METoken en le copiant dans le répertoire <em>contracts</em>. Notre répertoire devrait ressembler à ceci :</p>
</div>
<div id="METoken_directory" class="listingblock data-line-525">
<div class="content">
<pre>METoken/
+---- contracts
|   +---- Faucet.sol
|   +---- METoken.sol
|   `---- Migrations.sol</pre>
</div>
</div>
<div class="paragraph data-line-533">
<p>Nous ajouterons également une migration, pour déployer Faucet séparément de METoken :</p>
</div>
<div id="faucet_migration" class="listingblock data-line-537">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var Faucet = artifacts.require("Faucet");

module.exports = function(deployer) {
  // Déployer le contrat Faucet comme seule tâche
  deployer.deploy(Faucet);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-546">
<p>Compilons et migrons les contrats depuis la console Truffle :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt; <strong>compile</strong>
Compiling ./contracts/Faucet.sol...
Writing artifacts to ./build/contracts

truffle(ganache)&gt; <strong>migrate</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x89f6a7bd2a596829c60a483ec99665c7af71e68c77a417fab503c394fcd7a0c9
  Migrations: 0xa1ccce36fb823810e729dce293b75f40fb6ea9c9
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing METoken...
  ... 0x28d0da26f48765f67e133e99dd275fac6a25fdfec6594060fd1a0e09a99b44ba
  METoken: 0x7d6bf9d5914d37bcba9d46df7107e71c59f3791f
Saving artifacts...
Running migration: 3_deploy_faucet.js
  Deploying Faucet...
  ... 0x6fbf283bcc97d7c52d92fd91f6ac02d565f5fded483a6a0f824f66edc6fa90c3
  Faucet: 0xb18a42e9468f7f1342fa3c329ec339f254bc7524
Saving artifacts...

</pre>
<div class="paragraph data-line-577">
<p>Génial. Envoyons maintenant du MET au contrat Faucet :</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.transfer(Faucet.address, 100000) })</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(Faucet.address).then(console.log)})</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 5, c: [ 100000 ] }</strong>

</pre>
<div class="paragraph data-line-590">
<p>D&#39;accord, nous avons transféré 1 000 MET au contrat Faucet. Maintenant, comment retirer ces jetons ?</p>
</div>
<div class="paragraph data-line-592">
<p>N&#39;oubliez pas que <em>Faucet.sol</em> est un contrat assez simple. Il n&#39;a qu&#39;une seule fonction, <span class="keep-together"><code>withdraw</code></span>, qui sert à retirer de l'<em>ether</em>. Il n&#39;a pas de fonction pour retirer le MET, ou tout autre jeton ERC20. Si nous utilisons withdraw, il essaiera d&#39;envoyer de l&#39;ether, mais comme Faucet n&#39;a pas encore de solde d&#39;ether, il échouera.</p>
</div>
<div class="paragraph data-line-594">
<p>Le contrat METoken sait que Faucet a un solde, mais le seul moyen de transférer ce solde est de recevoir un appel transfer de l&#39;adresse du contrat. D&#39;une manière ou d&#39;une autre, nous devons faire en sorte que le contrat Faucet appelle la fonction transfer dans <span class="keep-together"><code>METoken</code></span>.</p>
</div>
<div class="paragraph data-line-596">
<p>Si vous vous demandez quoi faire ensuite, ne le faites pas. Il n&#39;y a pas de solution à ce problème. Le MET envoyé à Faucet est bloqué, pour toujours. Seul le contrat Faucet peut le transférer, et le contrat Faucet n&#39;a pas de code pour appeler la fonction transfer d&#39;un contrat de jeton ERC20.</p>
</div>
<div class="paragraph data-line-598">
<p>Peut-être avez-vous anticipé ce problème. Très probablement, vous ne l&#39;avez pas fait. En fait, des centaines d&#39;utilisateurs d&#39;Ethereum qui ont accidentellement transféré divers jetons vers des contrats qui n&#39;avaient aucune capacité ERC20 n&#39;en ont pas non plus fait. Selon certaines estimations, des jetons d&#39;une valeur de plus d&#39;environ 2,5 millions de dollars (au moment de la rédaction) sont restés &quot;bloqués&quot; comme ça et sont perdus à jamais.</p>
</div>
<div class="paragraph data-line-600">
<p>L&#39;une des façons dont les utilisateurs de jetons ERC20 peuvent perdre par inadvertance leurs jetons lors d&#39;un transfert, c&#39;est lorsqu&#39;ils tentent de transférer vers un échange ou un autre service. Ils copient une adresse Ethereum à partir du site Web d&#39;un échange, pensant qu&#39;ils peuvent simplement lui envoyer des jetons. Cependant, de nombreux échanges publient des adresses de réception qui sont en fait des contrats ! Ces contrats sont uniquement destinés à recevoir de l&#39;éther, pas des jetons ERC20, balayant le plus souvent tous les fonds qui leur sont envoyés vers un « stockage à froid » ou un autre portefeuille centralisé. Malgré les nombreux avertissements indiquant &quot;n&#39;envoyez pas de jetons à cette adresse&quot;, de nombreux jetons sont perdus de cette façon.</p>
</div>
</div>
<div class="sect4 data-line-603">
<h5 id="transfer_workflow_demo">Démonstration du flux de travail &quot;approuver et transférer de&quot;</h5>
<div class="paragraph data-line-605">
<p>Notre contrat Faucet ne pouvait pas gérer les jetons ERC20. L&#39;envoi de jetons à l&#39;aide de la fonction + transfer + a entraîné la perte de ces jetons. Réécrivons maintenant le contrat et faisons en sorte qu&#39;il gère les jetons ERC20. Plus précisément, nous allons le transformer en un robinet qui donne du MET à quiconque le demande.</p>
</div>
<div class="paragraph data-line-607">
<p>Pour cet exemple, nous allons faire une copie du répertoire du projet <em>truffle</em> (nous l&#39;appellerons <em>METoken_METFaucet</em>), initialiser truffle et npm, installer les dépendances OpenZeppelin et copier le contrat <em>METoken.sol</em>. Voir notre premier exemple, dans <a href="#METoken_example">Lancement de notre propre jeton ERC20</a>, pour les instructions détaillées.</p>
</div>
<div class="paragraph data-line-609">
<p>Notre nouveau contrat de robinetterie, <em>METFaucet.sol</em>, ressemblera à <a href="#METFaucet">METFaucet.sol : Un robinet pour METoken</a>.</p>
</div>
<div id="METFaucet" class="exampleblock data-line-613">
<div class="title">Example 21. METFaucet.sol : Un robinet pour METoken</div>
<div class="content">
<div class="listingblock data-line-615">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version of Solidity compiler this program was written for
pragma solidity ^0.4.19;

import 'openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol';


// A faucet for ERC20 token MET
contract METFaucet {

	StandardToken public METoken;
	address public METOwner;

	// METFaucet constructor, provide the address of METoken contract and
	// the owner address we will be approved to transferFrom
	function METFaucet(address _METoken, address _METOwner) public {

		// Initialize the METoken from the address provided
		METoken = StandardToken(_METoken);
		METOwner = _METOwner;
	}

	function withdraw(uint withdraw_amount) public {

    	// Limit withdrawal amount to 10 MET
    	require(withdraw_amount &lt;= 1000);

		// Use the transferFrom function of METoken
		METoken.transferFrom(METOwner, msg.sender, withdraw_amount);
    }

	// REJECT any incoming ether
	function () external payable { revert(); }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-620">
<p>Nous avons apporté quelques modifications à l&#39;exemple de base de Faucet. Puisque METFaucet utilisera la fonction transferFrom dans METoken, il aura besoin de deux variables supplémentaires. L&#39;un contiendra l&#39;adresse du contrat METoken déployé. L&#39;autre détiendra l&#39;adresse du propriétaire du MET, qui approuvera les retraits du robinet. Le contrat METFaucet appellera METoken.transferFrom et lui demandera de déplacer le MET du propriétaire vers l&#39;adresse d&#39;où provient la demande de retrait du robinet.</p>
</div>
<div class="paragraph data-line-623">
<p>Nous déclarons ici ces deux variables :</p>
</div>
<div class="listingblock data-line-626">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">StandardToken public METoken;
address public METOwner;</code></pre>
</div>
</div>
<div class="paragraph data-line-631">
<p>Étant donné que notre robinet doit être initialisé avec les adresses correctes pour METoken et METOwner, nous devons déclarer un constructeur personnalisé :</p>
</div>
<div id="custom_constructor" class="listingblock data-line-635">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Constructeur METFaucet - fournir l&amp;#39;adresse du contrat METoken et
// l&amp;#39;adresse du propriétaire que nous serons autorisés à transférer avec transferFrom
function METFaucet(address _METoken, address _METOwner) public {

	// Initialise le METoken à partir de l&amp;#39;adresse fournie
	METoken = StandardToken(_METoken);
	METOwner = _METOwner;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-646">
<p>Le prochain changement concerne la fonction withdraw. Au lieu d&#39;appeler transfer, METFaucet utilise la fonction transferFrom dans METoken et demande à METoken de transférer MET au destinataire du robinet :</p>
</div>
<div id="transfer_met" class="listingblock data-line-650">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Utiliser la fonction transferFrom de METoken
METoken.transferFrom(METOwner, msg.sender, withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-655">
<p>Enfin, puisque notre robinet n&#39;envoie plus d&#39;ether, nous devrions probablement empêcher quiconque d&#39;envoyer de l&#39;ether à METFaucet, car nous ne voudrions pas qu&#39;il reste bloqué. Nous modifions la fonction de paiement de secours pour rejeter l&#39;ether entrant, en utilisant la fonction revert pour annuler tout paiement entrant :</p>
</div>
<div id="reject_incoming_eth" class="listingblock data-line-659">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// REJETER tout ether entrant
function () external payable { revert(); }</code></pre>
</div>
</div>
<div class="paragraph data-line-664">
<p>Maintenant que notre code <em>METFaucet.sol</em> est prêt, nous devons modifier le script de migration pour le déployer. Ce script de migration sera un peu plus complexe, car METFaucet dépend de l&#39;adresse de METoken. Nous utiliserons une promesse JavaScript pour déployer les deux contrats en séquence. Créez <em>2_deploy_contracts.js</em> comme suit :</p>
</div>
<div class="listingblock data-line-667">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var METoken = artifacts.require("METoken");
var METFaucet = artifacts.require("METFaucet");
var owner = web3.eth.accounts[0];

module.exports = function(deployer) {

	// Déployer d&amp;#39;abord le contrat METoken
	deployer.deploy(METoken, {from: owner}).then(function() {
		// Ensuite, déployer METFaucet et passez l&amp;#39;adresse de METoken et
		// l'adresse du propriétaire de tous les MET qui agréera METFaucet
		return deployer.deploy(METFaucet, METoken.address, owner);
  	});
}</code></pre>
</div>
</div>
<div class="paragraph data-line-683">
<p>Maintenant, nous pouvons tout tester dans la console Truffle. Tout d&#39;abord, nous utilisons migrate pour déployer les contrats. Lorsque METoken est déployé, il alloue tout le MET au compte qui l&#39;a créé, web3.eth.accounts[0]. Ensuite, nous appelons la fonction approve dans <code><span class="keep-together">METoken</span></code> pour approuver METFaucet afin d&#39;envoyer jusqu&#39;à 1 000 MET au nom de web3.eth.accounts[0]. Enfin, pour tester notre faucet, nous appelons METFaucet.withdraw depuis web3.eth.accounts[1] et essayons de retirer 10 MET. Voici les commandes de la console :</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt; <strong>migrate</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x79352b43e18cc46b023a779e9a0d16b30f127bfa40266c02f9871d63c26542c7
  Migrations: 0xaa588d3737b611bafd7bd713445b314bd453a5c8
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing METoken...
  ... 0xc42a57f22cddf95f6f8c19d794c8af3b2491f568b38b96fef15b13b6e8bfff21
  METoken: 0xf204a4ef082f5c04bb89f7d5e6568b796096735a
  Replacing METFaucet...
  ... 0xd9615cae2fa4f1e8a377de87f86162832cf4d31098779e6e00df1ae7f1b7f864
  METFaucet: 0x75c35c980c0d37ef46df04d31a140b65503c0eed
Saving artifacts...
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.approve(METFaucet.address, 100000) })</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(web3.eth.accounts[1]).then(console.log) })</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 0, c: [ 0 ] }</strong>
truffle(ganache)&gt; <strong>METFaucet.deployed().then(instance =>
                  { instance.withdraw(1000, {from:web3.eth.accounts[1]}) } )</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(web3.eth.accounts[1]).then(console.log) })</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 3, c: [ 1000 ] }</strong>

</pre>
<div class="paragraph data-line-718">
<p>Comme vous pouvez le voir sur les résultats, nous pouvons utiliser le flux de travail approve et transferFrom pour autoriser un contrat à transférer des jetons définis dans un autre jeton. S&#39;ils sont correctement utilisés, les jetons ERC20 peuvent être utilisés par les EOA et d&#39;autres contrats.</p>
</div>
<div class="paragraph data-line-720">
<p>Cependant, la charge de gérer correctement les jetons ERC20 est transmise à l&#39;interface utilisateur. Si un utilisateur tente à tort de transférer des jetons ERC20 vers une adresse de contrat et que ce contrat n&#39;est pas équipé pour recevoir des jetons ERC20, les jetons seront perdus.</p>
</div>
</div>
</div>
<div class="sect3 data-line-723">
<h4 id="ERC20_issues">Problèmes avec les jetons ERC20</h4>
<div class="paragraph data-line-725">
<p>L&#39;adoption de la norme de jeton ERC20 a été vraiment explosive. Des milliers de jetons ont été lancés, à la fois pour expérimenter de nouvelles capacités et pour lever des fonds dans diverses enchères et &quot;financements participatifs&quot; ICO. Cependant, il existe des pièges potentiels, comme nous l&#39;avons vu avec la question du transfert de jetons vers des adresses contractuelles.</p>
</div>
<div class="paragraph data-line-727">
<p>L&#39;un des problèmes les moins évidents avec les jetons ERC20 est qu&#39;ils exposent des différences subtiles entre les jetons et l&#39;ether lui-même. Lorsque l&#39;ether est transféré par une transaction qui a une adresse de destinataire comme destination, les transferts de jeton se produisent dans l&#39;_état spécifique du contrat de jeton_ et ont le contrat de jeton comme destination, et non l&#39;adresse du destinataire. Le contrat de jeton suit les soldes et émet des événements. Dans un transfert de jeton, aucune transaction n&#39;est réellement envoyée au destinataire du jeton. Au lieu de cela, l&#39;adresse du destinataire est ajoutée à un tableau dans le contrat de jeton lui-même. Une transaction envoyant de l&#39;ether à une adresse modifie l&#39;état d&#39;une adresse. Une transaction transférant un jeton à une adresse ne modifie que l&#39;état du contrat de jeton, pas l&#39;état de l&#39;adresse du destinataire. Même un portefeuille prenant en charge les jetons ERC20 ne prend pas connaissance d&#39;un solde de jetons à moins que l&#39;utilisateur n&#39;ajoute explicitement un contrat de jeton spécifique à « surveiller ». Certains portefeuilles surveillent les contrats de jetons les plus populaires pour détecter les soldes détenus par les adresses qu&#39;ils contrôlent, mais cela est limité à une petite fraction des <span class="keep-together">contrats</span> ERC20 existants.</p>
</div>
<div class="paragraph data-line-729">
<p>En fait, il est peu probable qu&#39;un utilisateur veuille suivre tous les soldes de tous les contrats de jetons ERC20 possibles. De nombreux jetons ERC20 ressemblent plus à du courrier indésirable qu&#39;à des jetons utilisables. Ils créent automatiquement des soldes pour les comptes qui ont une activité ether, afin d&#39;attirer les utilisateurs. Si vous avez une adresse Ethereum avec une longue histoire d&#39;activité, surtout si elle a été créée lors de la prévente, vous la trouverez pleine de jetons &quot;indésirables&quot; qui sont apparus de nulle part. Bien sûr, l&#39;adresse n&#39;est pas vraiment pleine de jetons ; ce sont les contrats symboliques qui contiennent votre adresse. Vous ne voyez ces soldes que si ces contrats de jetons sont surveillés par l&#39;explorateur de blocs ou le portefeuille que vous utilisez pour afficher votre adresse.</p>
</div>
<div class="paragraph data-line-731">
<p>Les jetons ne se comportent pas de la même manière que l&#39;ether. L&#8217;ether est envoyé avec la fonction send et accepté par toute fonction payante dans un contrat ou toute adresse détenue en externe. Les jetons sont envoyés à l&#39;aide des fonctions transfer ou approve et transferFrom qui n&#39;existent que dans le contrat ERC20, et ne déclenchent (du moins dans ERC20) aucune fonction payante dans un contrat destinataire. Les jetons sont censés fonctionner comme une cryptomonnaie telle que l&#39;ether, mais ils présentent certaines différences qui brisent cette illusion.</p>
</div>
<div class="paragraph data-line-733">
<p>Envisagez un autre problème. Pour envoyer de l&#39;ether ou utiliser un contrat Ethereum, vous avez besoin d&#39;ether pour payer le gaz. Pour envoyer des jetons, vous avez <em>également besoin d&#39;ether</em>. Vous ne pouvez pas payer le gaz d&#39;une transaction avec un jeton et le contrat de jeton ne peut pas payer le gaz pour vous. Cela peut changer à un moment donné dans un avenir lointain, mais entre-temps, cela peut entraîner des expériences utilisateur plutôt étranges. Par exemple, supposons que vous utilisiez un échange ou ShapeShift pour convertir du bitcoin en jeton. Vous &quot;recevez&quot; le jeton dans un portefeuille qui suit le contrat de ce jeton et affiche votre solde. Il ressemble à toutes les autres crypto-monnaies que vous avez dans votre portefeuille. Essayez d&#39;envoyer le jeton et votre portefeuille vous informera que vous avez besoin d&#39;ether pour le faire. Vous pourriez être confus - après tout, vous n&#39;aviez pas besoin d&#39;ether pour recevoir le jeton. Peut-être que vous n&#39;avez pas d&#39;ether. Peut-être ne saviez-vous même pas que le jeton était un jeton ERC20 sur Ethereum; peut-être pensiez-vous qu&#39;il s&#39;agissait d&#39;une cryptomonnaie avec sa propre chaîne de blocs. L&#39;illusion vient de se briser.</p>
</div>
<div class="paragraph data-line-735">
<p>Certains de ces problèmes sont spécifiques aux jetons ERC20. D&#39;autres sont des problèmes plus généraux liés à l&#39;abstraction et aux limites d&#39;interface au sein d&#39;Ethereum. Certains peuvent être résolus en modifiant l&#39;interface du jeton, tandis que d&#39;autres peuvent nécessiter des modifications des structures fondamentales au sein d&#39;Ethereum (comme la distinction entre EOA et contrats, et entre transactions et messages). Certains peuvent ne pas être exactement &quot;solvable&quot; et peuvent nécessiter une conception d&#39;interface utilisateur pour masquer les nuances et rendre l&#39;expérience utilisateur cohérente, quelles que soient les distinctions sous-jacentes.</p>
</div>
<div class="paragraph data-line-737">
<p>Dans les prochaines sections, nous examinerons diverses propositions qui tentent de résoudre certains de ces problèmes.</p>
</div>
</div>
<div class="sect3 data-line-740">
<h4 id="ERC223_std">ERC223 : une norme d&#39;interface de contrat de jeton proposée</h4>
<div class="paragraph data-line-742">
<p>La proposition ERC223 tente de résoudre le problème du transfert par inadvertance de jetons vers un contrat (qui peut ou non prendre en charge jetons) en détectant si l&#39;adresse de destination est un contrat ou non. ERC223 exige que les contrats conçus pour accepter des jetons implémentent une fonction nommée tokenFallback. Si la destination d&#39;un transfert est un contrat et que le contrat ne prend pas en charge les jetons (c&#39;est-à-dire qu&#39;il n&#39;implémente pas tokenFallback), le transfert échoue.</p>
</div>
<div id="is_contract" class="paragraph data-line-745">
<p>Pour détecter si l&#39;adresse de destination est un contrat, l&#39;implémentation de référence ERC223 utilise un petit segment de bytecode en ligne d&#39;une manière plutôt créative :</p>
</div>
<div class="listingblock data-line-748">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function isContract(address _addr) private view returns (bool is_contract) {
  uint length;
    assembly {
       // récupère la taille du code sur l&amp;#39;adresse cible ; cela nécessite un assemblage
       length := extcodesize(_addr)
    }
    return (length&gt;0);
}</code></pre>
</div>
</div>
<div id="ERC223_interface" class="paragraph data-line-760">
<p>La spécification de l&#39;interface de contrat ERC223 est :</p>
</div>
<div class="listingblock data-line-763">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC223Token {
  uint public totalSupply;
  function balanceOf(address who) public view returns (uint);

  function name() public view returns (string _name);
  function symbol() public view returns (string _symbol);
  function decimals() public view returns (uint8 _decimals);
  function totalSupply() public view returns (uint256 _supply);

  function transfer(address to, uint value) public returns (bool ok);
  function transfer(address to, uint value, bytes data) public returns (bool ok);
  function transfer(address to, uint value, bytes data, string custom_fallback)
      public returns (bool ok);

  event Transfer(address indexed from, address indexed to, uint value,
                 bytes indexed data);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-783">
<p>ERC223 n&#39;est pas largement mis en œuvre, et il y a un débat dans le fil <a href="https://github.com/ethereum/EIPs/issues/223" data-href="https://github.com/ethereum/EIPs/issues/223">de discussion ERC</a> sur la rétrocompatibilité et les compromis entre la mise en œuvre des changements au niveau de l&#39;interface du contrat par rapport à l&#8217;interface utilisateur. Le débat continue.</p>
</div>
</div>
<div class="sect3 data-line-785">
<h4 id="_erc777_une_norme_dinterface_de_contrat_de_jeton_proposée">ERC777 : une norme d&#39;interface de contrat de jeton proposée</h4>
<div class="paragraph data-line-787">
<p>Une autre proposition pour une norme de contrat de jeton améliorée est <a href="https://eips.ethereum.org/EIPS/eip-777" data-href="https://eips.ethereum.org/EIPS/eip-777">ERC777</a>. Cette proposition a plusieurs objectifs, notamment :</p>
</div>
<div class="ulist data-line-789">
<ul>
<li class="data-line-789">
<p>Offrir une interface compatible ERC20</p>
</li>
<li class="data-line-790">
<p>Pour transférer des jetons à l&#39;aide d&#39;une fonction send, similaire aux transferts d&#39;ether</p>
</li>
<li class="data-line-791">
<p>Pour être compatible avec ERC820 pour l&#39;enregistrement de contrat de jeton</p>
</li>
<li class="data-line-792">
<p>Pour permettre aux contrats et aux adresses de contrôler les jetons qu&#39;ils envoient via une fonction <code>tokensToSend</code> qui est appelée avant l&#39;envoi</p>
</li>
<li class="data-line-793">
<p>Pour permettre aux contrats et aux adresses d&#39;être informés de la réception des jetons en appelant une fonction <code>tokensReceived</code> dans le destinataire, et pour réduire la probabilité que les jetons soient verrouillés dans des contrats en exigeant que les contrats fournissent une fonction <span class="keep-together"><code>tokensReceived</code></span></p>
</li>
<li class="data-line-794">
<p>Pour permettre aux contrats existants d&#39;utiliser des contrats par procuration pour les fonctions tokensToSend et tokensReceived</p>
</li>
<li class="data-line-795">
<p>Pour fonctionner de la même manière que vous envoyiez vers un contrat ou un EOA</p>
</li>
<li class="data-line-796">
<p>Pour fournir des événements spécifiques pour la frappe et la gravure de jetons</p>
</li>
<li class="data-line-797">
<p>Pour permettre aux opérateurs (tiers de confiance, destinés à être des contrats vérifiés) de déplacer des jetons pour le compte d&#39;un détenteur de jetons</p>
</li>
<li class="data-line-798">
<p>Pour fournir des métadonnées sur les transactions de transfert de jetons dans les champs userData et operatorData</p>
</li>
</ul>
</div>
<div class="paragraph data-line-800">
<p>La discussion en cours sur ERC777 peut être trouvée <a href="https://github.com/ethereum/EIPs/issues/777" data-href="https://github.com/ethereum/EIPs/issues/777">sur GitHub</a>.</p>
</div>
<div id="ERC777_interface" class="paragraph data-line-803">
<p>La spécification de l&#39;interface de contrat ERC777 est :</p>
</div>
<div class="listingblock data-line-806">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777Token {
    function name() public constant returns (string);
    function symbol() public constant returns (string);
    function totalSupply() public constant returns (uint256);
    function granularity() public constant returns (uint256);
    function balanceOf(address owner) public constant returns (uint256);

    function send(address to, uint256 amount, bytes userData) public;

    function authorizeOperator(address operator) public;
    function revokeOperator(address operator) public;
    function isOperatorFor(address operator, address tokenHolder)
        public constant returns (bool);
    function operatorSend(address from, address to, uint256 amount,
                          bytes userData,bytes operatorData) public;

    event Sent(address indexed operator, address indexed from,
               address indexed to, uint256 amount, bytes userData,
               bytes operatorData);
    event Minted(address indexed operator, address indexed to,
                 uint256 amount, bytes operatorData);
    event Burned(address indexed operator, address indexed from,
                 uint256 amount, bytes userData, bytes operatorData);
    event AuthorizedOperator(address indexed operator,
                             address indexed tokenHolder);
    event RevokedOperator(address indexed operator, address indexed tokenHolder);
}</code></pre>
</div>
</div>
<div class="sect4 data-line-837">
<h5 id="ERC777_hooks">Crochets ERC777</h5>
<div id="ERC777TokensSender_interface" class="paragraph data-line-840">
<p>La spécification de crochet d&#39;expéditeur de jetons ERC777 est :</p>
</div>
<div class="listingblock data-line-843">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777TokensSender {
    function tokensToSend(address operator, address from, address to,
                          uint value, bytes userData, bytes operatorData) public;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-850">
<p>La mise en place de cette interface est nécessaire pour toute adresse souhaitant être notifiée, gérer ou empêcher le débit de jetons. L&#39;adresse pour laquelle le contrat implémente cette interface doit être enregistrée via ERC820, que le contrat implémente l&#39;interface pour lui-même ou pour une autre adresse.</p>
</div>
<div id="ERC777TokensRecipient_interface" class="paragraph data-line-853">
<p>La spécification du crochet du destinataire des jetons ERC777 est :</p>
</div>
<div class="listingblock data-line-856">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777TokensRecipient {
  function tokensReceived(
     address operator, address from, address to,
    uint amount, bytes userData, bytes operatorData
  ) public;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-865">
<p>La mise en place de cette interface est nécessaire pour toute adresse souhaitant être notifiée, traiter ou rejeter la réception de jetons. La même logique et les mêmes exigences s&#39;appliquent au destinataire des jetons qu&#39;à l&#39;interface de l&#39;expéditeur des jetons, avec la contrainte supplémentaire que les contrats destinataires doivent implémenter cette interface pour empêcher le verrouillage des jetons. Si le contrat destinataire n&#39;enregistre pas d&#39;adresse implémentant cette interface, le transfert des jetons échouera.</p>
</div>
<div class="paragraph data-line-867">
<p>Un aspect important est qu&#39;un seul expéditeur de jeton et un seul destinataire de jeton peuvent être enregistrés par adresse. Par conséquent, pour chaque transfert de jeton ERC777, les mêmes fonctions de crochet sont appelées lors du débit et de la réception de chaque transfert de jeton ERC777. Un jeton spécifique peut être identifié dans ces fonctions à l&#39;aide de l&#39;expéditeur du message, qui est l&#39;adresse de contrat de jeton spécifique, pour gérer un cas d&#39;utilisation particulier.</p>
</div>
<div class="paragraph data-line-869">
<p>D&#39;autre part, les mêmes hooks d&#39;expéditeur et de destinataire de jeton peuvent être enregistrés pour plusieurs adresses et les hooks peuvent distinguer qui sont l&#39;expéditeur et le destinataire prévu à l&#39;aide des paramètres &quot;from&quot; et &quot;to&quot;.</p>
</div>
<div class="paragraph data-line-871">
<p>Une <a href="http://bit.ly/2qkAKba" data-href="http://bit.ly/2qkAKba">implémentation de référence</a> d&#39;ERC777 est liée dans la proposition. ERC777 dépend d&#39;une proposition parallèle de contrat de registre, spécifiée dans ERC820. Une partie du débat sur ERC777 porte sur la complexité de l&#39;adoption simultanée de deux grands changements : une nouvelle norme de jeton et une norme de registre. La discussion continue.</p>
</div>
</div>
</div>
<div class="sect3 data-line-874">
<h4 id="erc721">ERC721 : norme de jeton non fongible (acte)</h4>
<div class="paragraph data-line-876">
<p>Toutes les normes de jeton que nous avons examinées jusqu&#39;à présent concernent les jetons <em>fungible</em>, ce qui signifie que les unités de un jeton sont interchangeables. La norme de jeton ERC20 ne suit que le solde final de chaque compte et ne suit pas (explicitement) la provenance d&#39;un jeton.</p>
</div>
<div class="paragraph data-line-878">
<p> La <a href="http://bit.ly/2Ogs7Im" data-href="http://bit.ly/2Ogs7Im">proposition ERC721</a> concerne une norme pour les jetons <em>non fongibles</em>, également appelés <em>actes</em>.</p>
</div>
<div class="paragraph data-line-880">
<p>Extrait du dictionnaire Oxford :</p>
</div>
<div class="quoteblock data-line-882">
<blockquote>
<div class="paragraph data-line-883">
<p><em>acte</em> : un document juridique qui est signé et remis, en particulier un document concernant la propriété d&#39;un bien ou des droits légaux.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-886">
<p>L&#39;utilisation du mot &quot;acte&quot; est destinée à refléter la partie &quot;propriété d&#39;un bien&quot;, même si ceux-ci ne sont pas reconnus comme des &quot;documents juridiques&quot; dans aucune juridiction - pour le moment. Il est probable qu&#39;à un moment donné dans le futur, la propriété légale basée sur des signatures numériques sur une plate-forme chaîne de blocs sera légalement reconnue.</p>
</div>
<div class="paragraph data-line-888">
<p>Les jetons non fongibles suivent la propriété d&#39;une chose unique. L&#39;objet possédé peut être un objet numérique, tel qu&#39;un objet de jeu ou un objet de collection numérique ; ou la chose peut être un objet physique dont la propriété est suivie par un jeton, comme une maison, une voiture ou une œuvre d&#39;art. Les actes peuvent également représenter des choses de valeur négative, telles que des prêts (dettes), des privilèges, des servitudes, etc. La norme ERC721 n&#39;impose aucune limitation ou attente sur la nature de la chose dont la propriété est suivie par un acte et exige seulement qu&#39;elle puisse être identifié de manière unique, ce qui, dans le cas de cette norme, est obtenu par un <span class="keep-together">identifiant</span> de 256 bits .</p>
</div>
<div class="paragraph data-line-890">
<p>Les détails de la norme et de la discussion sont suivis sur deux <span class="keep-together">fils</span> GitHub différents:</p>
</div>
<div class="ulist data-line-892">
<ul>
<li class="data-line-892">
<p><a href="https://github.com/ethereum/EIPs/issues/721" data-href="https://github.com/ethereum/EIPs/issues/721">Proposition initiale</a></p>
</li>
<li class="data-line-894">
<p><a href="https://github.com/ethereum/EIPs/pull/841" data-href="https://github.com/ethereum/EIPs/pull/841">Discussion continue</a></p>
</li>
</ul>
</div>
<div id="map_deed_owner" class="paragraph data-line-897">
<p>Pour saisir la différence fondamentale entre ERC20 et ERC721, il suffit de regarder la structure de données interne utilisée dans ERC721 :</p>
</div>
<div class="listingblock data-line-900">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Mappage de l&amp;#39;ID de l&amp;#39;acte au propriétaire
mapping (uint256 =&gt; address) private deedOwner;</code></pre>
</div>
</div>
<div class="paragraph data-line-905">
<p>Alors que l&#39;ERC20 suit les soldes appartenant à chaque propriétaire, le propriétaire étant la clé primaire du mappage, l&#39;ERC721 suit chaque ID d&#39;acte et son propriétaire, l&#39;ID d&#39;acte étant la clé primaire du mappage. De cette différence fondamentale découlent toutes les propriétés d&#39;un jeton non fongible.</p>
</div>
<div id="ERC721_interface" class="paragraph data-line-908">
<p>La spécification de l&#39;interface de contrat ERC721 est :</p>
</div>
<div class="listingblock data-line-911">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721 /* is ERC165 */ {
    event Transfer(address indexed _from, address indexed _to, uint256 _deedId);
    event Approval(address indexed _owner, address indexed _approved,
                   uint256 _deedId);
    event ApprovalForAll(address indexed _owner, address indexed _operator,
                         bool _approved);

    function balanceOf(address _owner) external view returns (uint256 _balance);
    function ownerOf(uint256 _deedId) external view returns (address _owner);
    function transfer(address _to, uint256 _deedId) external payable;
    function transferFrom(address _from, address _to, uint256 _deedId)
        external payable;
    function approve(address _approved, uint256 _deedId) external payable;
    function setApprovalForAll(address _operateor, boolean _approved) payable;
    function supportsInterface(bytes4 interfaceID) external view returns (bool);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-930">
<p>ERC721 prend également en charge deux interfaces <em>optionnelles</em>, une pour les métadonnées et une pour l&#39;énumération des actes et des propriétaires.</p>
</div>
<div id="ERC721_metadata" class="paragraph data-line-933">
<p>L&#39;interface optionnelle ERC721 pour les métadonnées est :</p>
</div>
<div class="listingblock data-line-936">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721Metadata /* is ERC721 */ {
    function name() external pure returns (string _name);
    function symbol() external pure returns (string _symbol);
    function deedUri(uint256 _deedId) external view returns (string _deedUri);
}</code></pre>
</div>
</div>
<div id="ERC721_enum" class="paragraph data-line-945">
<p>L&#39;interface optionnelle ERC721 pour l&#39;énumération est :</p>
</div>
<div class="listingblock data-line-948">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721Enumerable /* is ERC721 */ {
    function totalSupply() external view returns (uint256 _count);
    function deedByIndex(uint256 _index) external view returns (uint256 _deedId);
    function countOfOwners() external view returns (uint256 _count);
    function ownerByIndex(uint256 _index) external view returns (address _owner);
    function deedOfOwnerByIndex(address _owner, uint256 _index) external view
        returns (uint256 _deedId);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-960">
<h3 id="token_std_review">Utilisation des normes de jeton</h3>
<div class="paragraph data-line-962">
<p>Dans la section précédente, nous avons examiné plusieurs normes proposées et quelques normes largement déployées pour les contrats de jetons. A quoi servent exactement ces normes ? Devez-vous utiliser ces normes ? Comment devriez-vous les utiliser? Devriez-vous ajouter des fonctionnalités au-delà de ces normes ? Quelles normes devez-vous utiliser ? Nous examinerons ensuite certaines de ces questions.</p>
</div>
<div class="sect3 data-line-965">
<h4 id="token_std_purpose">Que sont les normes de jeton ? Quel est leur but ?</h4>
<div class="paragraph data-line-967">
<p>Les normes de jetons sont les spécifications <em>minimales</em> pour une implémentation. Cela signifie que pour être conforme, par exemple, à ERC20, vous devez au minimum implémenter les fonctions et le comportement spécifiés par la norme ERC20. Vous êtes également libre d&#39;_ajouter_ à la fonctionnalité en implémentant des fonctions qui ne font pas partie de la norme.</p>
</div>
<div class="paragraph data-line-969">
<p>L&#39;objectif principal de ces normes est d&#39;encourager l&#39;_interopérabilité_ entre les contrats. Ainsi, tous les portefeuilles, échanges, interfaces utilisateur et autres composants d&#39;infrastructure peuvent <em>s&#39;interfacer</em> de manière prévisible avec tout contrat qui suit la spécification. En d&#39;autres termes, si vous déployez un contrat qui suit la norme ERC20, tous les utilisateurs de portefeuille existants peuvent commencer à échanger votre jeton de manière transparente sans aucune mise à niveau de portefeuille ni effort de votre part.</p>
</div>
<div class="paragraph data-line-971">
<p>Les normes sont censées être <em>descriptives</em> plutôt que <em>prescriptives</em>. La façon dont vous choisissez de mettre en œuvre ces fonctions dépend de vous - le fonctionnement interne du contrat n&#39;est pas pertinent pour la norme. Ils ont des exigences fonctionnelles, qui régissent le comportement dans des circonstances spécifiques, mais ils ne prescrivent pas de mise en œuvre. Un exemple de ceci est le comportement d&#39;une fonction transfer si la valeur est définie sur zéro.</p>
</div>
</div>
<div class="sect3 data-line-974">
<h4 id="should_use_std">Devriez-vous utiliser ces normes ?</h4>
<div class="paragraph data-line-976">
<p>Compte tenu de tous ces standards, chaque développeur est confronté à un dilemme : utiliser les standards existants ou innover au-delà des contraintes qu&#39;ils imposent ?</p>
</div>
<div class="paragraph data-line-978">
<p>Ce dilemme n&#39;est pas facile à résoudre. Les normes restreignent nécessairement votre capacité à innover, en créant une &quot;ornière&quot; étroite que vous devez suivre. D&#39;autre part, les normes de base ont émergé de l&#39;expérience de centaines d&#39;applications et s&#39;adaptent souvent bien à la grande majorité des cas d&#39;utilisation.</p>
</div>
<div class="paragraph data-line-980">
<p>Dans le cadre de cette considération, il y a un problème encore plus important : la valeur de l&#39;interopérabilité et de l&#39;adoption à grande échelle. Si vous choisissez d&#39;utiliser une norme existante, vous gagnez la valeur de tous les systèmes conçus pour fonctionner avec cette norme. Si vous choisissez de vous écarter de la norme, vous devez prendre en compte le coût de la construction de toute l&#39;infrastructure de support par vous-même ou persuader les autres de prendre en charge votre mise en œuvre en tant que nouvelle norme. La tendance à forger votre propre chemin et à ignorer les normes existantes est connue sous le nom de syndrome &quot;Not Invented Here&quot; (Non inventé ici) et est contraire à la culture open source. D&#39;autre part, le progrès et l&#39;innovation dépendent parfois de l&#39;abandon de la tradition. C&#39;est un choix délicat, alors réfléchissez bien !</p>
</div>
<div class="admonitionblock note data-line-983">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-984">
<p>Selon Wikipedia, <a href="https://en.wikipedia.org/wiki/Not_invented_here" data-href="https://en.wikipedia.org/wiki/Not_invented_here">&quot;Not Invented Here&quot;</a> est une position adoptée par les cultures sociales, d&#39;entreprise ou institutionnelles qui évitent d&#39;utiliser ou d&#39;acheter des produits, des recherches, des normes ou des connaissances déjà existants en raison de leurs origines externes et de leurs coûts, tels que les redevances.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-989">
<h4 id="sécurité_maturité">Sécurité par maturité</h4>
<div class="paragraph data-line-991">
<p>Au-delà du choix de la norme, il y a le choix parallèle de <em>la mise en oeuvre</em>. Lorsque vous décidez d&#39;utiliser une norme telle que ERC20, vous devez ensuite décider comment mettre en œuvre une conception compatible. Il existe un certain nombre d&#39;implémentations &quot;de référence&quot; existantes qui sont largement utilisées dans l&#39;écosystème Ethereum, ou vous pouvez écrire la vôtre à partir de zéro. Encore une fois, ce choix représente un dilemme qui peut avoir de graves implications en matière de sécurité.</p>
</div>
<div class="paragraph data-line-993">
<p>Les implémentations existantes sont &quot;testées au combat&quot;. Bien qu&#39;il soit impossible de prouver qu&#39;ils sont sécurisés, beaucoup d&#39;entre eux sous-tendent des millions de dollars de jetons. Ils ont été attaqués, à plusieurs reprises et vigoureusement. Jusqu&#39;à présent, aucune vulnérabilité significative n&#39;a été découverte. Rédiger le vôtre n&#39;est pas facile - il existe de nombreuses façons subtiles de compromettre un contrat. Il est beaucoup plus sûr d&#39;utiliser une implémentation largement testée et largement utilisée. Dans nos exemples, nous avons utilisé l&#39;implémentation OpenZeppelin de la norme ERC20, car cette implémentation est entièrement axée sur la sécurité.</p>
</div>
<div class="paragraph data-line-995">
<p>Si vous utilisez une implémentation existante, vous pouvez également l&#39;étendre. Encore une fois, cependant, soyez prudent avec cette impulsion. La complexité est l&#39;ennemie de la sécurité. Chaque ligne de code que vous ajoutez étend la <em>surface d&#39;attaque</em> de votre contrat et pourrait représenter une vulnérabilité en attente. Vous ne remarquerez peut-être pas un problème jusqu&#39;à ce que vous accordiez beaucoup de valeur au contrat et que quelqu&#39;un le rompe.</p>
</div>
<div class="admonitionblock tip data-line-998">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-999">
<p>Les normes et les choix de mise en œuvre sont des éléments importants de la conception globale des contrats intelligents sécurisés, mais ce ne sont pas les seules considérations. Voir <a href="#smart_contract_security">Sécurité des contrats intelligents</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-1004">
<h3 id="extend_token_interface">Extensions aux normes d&#39;interface de jeton</h3>
<div class="paragraph data-line-1006">
<p>Les normes de jetons abordées dans ce chapitre fournissent une interface très minimale, avec des fonctionnalités limitées. De nombreux projets ont créé des implémentations étendues pour prendre en charge les fonctionnalités dont ils ont besoin pour leurs applications. Certaines de ces fonctionnalités incluent :</p>
</div>
<div class="dlist data-line-1008">
<dl>
<dt class="hdlist1">Contrôle du propriétaire</dt>
<dd>
<p>La possibilité de donner des adresses spécifiques ou des ensembles d&#39;adresses (c&#39;est-à-dire des schémas multisignatures), des capacités spéciales, telles que la liste noire, la liste blanche, la frappe, la récupération, etc.</p>
</dd>
<dt class="hdlist1">Brûlure</dt>
<dd>
<p>La capacité de détruire délibérément (&quot;brûler&quot;) des jetons en les transférant à une adresse inutilisable ou en effaçant un solde et en réduisant l&#39;approvisionnement.</p>
</dd>
<dt class="hdlist1">Frappe</dt>
<dd>
<p>La possibilité d&#39;ajouter à l&#39;offre totale de jetons, à un rythme prévisible ou par &quot;fiat&quot; du créateur du jeton.</p>
</dd>
<dt class="hdlist1">Financement participatif</dt>
<dd>
<p>La possibilité de proposer des jetons à la vente, par exemple par le biais d&#39;une vente aux enchères, d&#39;une vente sur le marché, d&#39;une vente aux enchères inversée, etc.</p>
</dd>
<dt class="hdlist1">Limites</dt>
<dd>
<p>La possibilité de fixer des limites prédéfinies et immuables sur l&#39;offre totale (à l&#39;opposé de la fonction &quot;frappe&quot;).</p>
</dd>
<dt class="hdlist1">Portes dérobées de récupération</dt>
<dd>
<p>Fonctions pour récupérer des fonds, annuler des transferts ou démanteler le jeton qui peuvent être activés par une adresse désignée ou un ensemble d&#39;adresses.</p>
</dd>
<dt class="hdlist1">Liste blanche</dt>
<dd>
<p>La possibilité de restreindre les actions (telles que les transferts de jetons) à des adresses spécifiques. Le plus souvent utilisé pour offrir des jetons à des &quot;investisseurs accrédités&quot; après vérification par les règles de différentes juridictions. Il existe généralement un mécanisme de mise à jour de la liste blanche.</p>
</dd>
<dt class="hdlist1">Liste noire</dt>
<dd>
<p>La possibilité de restreindre les transferts de jetons en interdisant des adresses spécifiques. Il existe généralement une fonction de mise à jour de la liste noire.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1024">
<p>Il existe des implémentations de référence pour bon nombre de ces fonctions, par exemple dans la bibliothèque OpenZeppelin. Certains d&#39;entre eux sont spécifiques à un cas d&#39;utilisation et ne sont implémentés que dans quelques jetons. Il n&#39;existe pas, à l&#39;heure actuelle, de normes largement acceptées pour les interfaces avec ces fonctions.</p>
</div>
<div class="paragraph data-line-1026">
<p>Comme indiqué précédemment, la décision d&#39;étendre une norme de jeton avec des fonctionnalités supplémentaires représente un compromis entre innovation/risque et interopérabilité/sécurité.</p>
</div>
</div>
<div class="sect2 data-line-1029">
<h3 id="tokens_ico">Jetons et ICO</h3>
<div class="paragraph data-line-1031">
<p>Les jetons ont connu un développement explosif dans l&#39;écosystème Ethereum. Il est probable qu&#39;ils deviendront un élément très important de toutes les plateformes de contrats intelligents comme Ethereum.</p>
</div>
<div class="paragraph data-line-1033">
<p>Néanmoins, l&#39;importance et l&#39;impact futur de ces normes ne doivent pas être confondus avec une approbation des offres de jetons actuelles. Comme dans toute technologie à un stade précoce, la première vague de produits et d&#39;entreprises échouera presque toutes, et certaines échoueront de manière spectaculaire. La plupart des jetons proposés dans Ethereum aujourd&#39;hui sont des escroqueries à peine déguisées, des systèmes pyramidaux et des prises d&#39;argent.</p>
</div>
<div class="paragraph data-line-1035">
<p>L&#39;astuce consiste à séparer la vision et l&#39;impact à long terme de cette technologie, qui risque d&#39;être énorme, de la bulle à court terme des ICO symboliques, qui sont en proie à la fraude. Les normes de jetons et la plate-forme survivront à la manie actuelle des jetons, puis ils changeront probablement le monde.</p>
</div>
</div>
<div class="sect2 data-line-1037">
<h3 id="_conclusion_7">Conclusion</h3>
<div class="paragraph data-line-23">
<p>Les jetons sont un concept très puissant dans Ethereum et peuvent constituer la base de nombreuses applications décentralisées importantes. Dans ce chapitre, nous avons examiné les différents types de jetons et les normes de jeton, et vous avez construit votre premier jeton et l&#39;application associée. Nous reviendrons à nouveau sur les jetons dans <a href="#decentralized_applications_chap">Applications décentralisées (DApps)</a>, où vous utiliserez un jeton non fongible comme base pour un DApp d&#39;enchères.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="oracles_chap">Oracles</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Dans ce chapitre, nous discutons des <em>oracles</em>, qui sont des systèmes qui peuvent fournir des sources de données externes aux contrats intelligents Ethereum. Le terme « oracle » vient de la mythologie grecque, où il faisait référence à une personne en communication avec les dieux qui pouvait avoir des visions du futur. Dans le contexte des chaînes de blocs, un oracle est un système qui peut répondre à des questions externes à Ethereum. Idéalement, les oracles sont des systèmes <em>sans confiance</em>, ce qui signifie qu&#39;ils n&#39;ont pas besoin d&#39;être fiables car ils fonctionnent selon des principes décentralisés.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="why_oracles">Pourquoi les oracles sont nécessaires</h3>
<div class="paragraph data-line-9">
<p>Un composant clé de la plate-forme Ethereum est la machine virtuelle Ethereum, avec sa capacité à exécuter des programmes et à mettre à jour l&#39;état d&#39;Ethereum, contraint par des règles de consensus, sur n&#39;importe quel nœud du réseau décentralisé. Afin de maintenir le consensus, l&#39;exécution d&#39;EVM doit être totalement déterministe et basée uniquement sur le contexte partagé de l&#39;état Ethereum et des transactions signées. Cela a deux conséquences particulièrement importantes : la première est qu&#39;il ne peut y avoir de source intrinsèque d&#39;aléatoire avec laquelle l&#39;EVM et les contrats intelligents peuvent fonctionner ; la seconde est que les données extrinsèques ne peuvent être introduites que comme données utiles d&#39;une transaction.</p>
</div>
<div class="paragraph data-line-11">
<p>Déballons ces deux conséquences plus loin. Pour comprendre l&#39;interdiction d&#39;une véritable fonction aléatoire dans l&#39;EVM pour fournir un caractère aléatoire aux contrats intelligents, considérez l&#39;effet sur les tentatives de parvenir à un consensus après l&#39;exécution d&#39;une telle fonction : le nœud A exécuterait la commande et stockerait 3 au nom du contrat intelligent dans son stockage, tandis que le nœud B, exécutant le même contrat intelligent, stockerait 7 à la place. Ainsi, les nœuds A et B arriveraient à des conclusions différentes sur ce que devrait être l&#39;état résultant, bien qu&#39;ils aient exécuté exactement le même code dans le même contexte. En effet, il se pourrait qu&#39;un état résultant différent soit atteint à chaque fois que le contrat intelligent est évalué. En tant que tel, il n&#39;y aurait aucun moyen pour le réseau, avec sa multitude de nœuds fonctionnant indépendamment dans le monde, de parvenir à un consensus décentralisé sur ce que devrait être l&#39;état résultant. En pratique, cela deviendrait bien pire que cet exemple très rapidement, car les effets d&#39;entraînement, y compris les transferts d&#39;ether, s&#39;accumuleraient de façon exponentielle.</p>
</div>
<div class="paragraph data-line-13">
<p>Notez que les fonctions pseudo-aléatoires, telles que les fonctions de hachage cryptographiquement sécurisées (qui sont déterministes et peuvent donc faire, et font en effet, partie de l&#39;EVM), ne suffisent pas pour de nombreuses applications. Prenez un jeu de hasard qui simule des lancers de pièces pour résoudre les paiements de pari, qui doivent randomiser pile ou face – un mineur peut obtenir un avantage en jouant au jeu et en n&#39;incluant ses transactions que dans les blocs pour lesquels il gagnera. Alors comment contourner ce problème ? Eh bien, tous les nœuds peuvent s&#39;entendre sur le contenu des transactions signées, de sorte que les informations extrinsèques, y compris les sources aléatoires, les informations sur les prix, les prévisions météorologiques, etc., peuvent être introduites en tant que partie des données des transactions envoyées au réseau. Cependant, ces données ne sont tout simplement pas fiables, car elles proviennent de sources invérifiables. En tant que tel, nous venons de reporter le problème. Nous utilisons des oracles pour tenter de résoudre ces problèmes, dont nous parlerons en détail dans la suite de ce chapitre.</p>
</div>
</div>
<div class="sect2 data-line-16">
<h3 id="oracle_use_cases">Cas d&#39;utilisation Oracle et exemples</h3>
<div class="paragraph data-line-18">
<p>Les oracles, idéalement, fournissent un moyen sans confiance (ou du moins presque sans confiance) d&#39;obtenir des informations extrinsèques (c&#39;est-à-dire &quot;du monde réel&quot; ou hors chaîne), tels que les résultats des matchs de football, le prix de l&#39;or ou des nombres vraiment aléatoires, sur la plate-forme Ethereum pour les contrats intelligents à utiliser. Ils peuvent également être utilisés pour relayer directement les données en toute sécurité vers les interfaces DApp. Les oracles peuvent donc être considérés comme un mécanisme permettant de combler le fossé entre le monde hors chaîne et les contrats intelligents. Permettre aux contrats intelligents d&#39;appliquer des relations contractuelles basées sur des événements et des données du monde réel élargit considérablement leur portée. Cependant, cela peut également introduire des risques externes pour le modèle de sécurité d&#39;Ethereum. Considérez un contrat « testamentaire intelligent » qui distribue les actifs lorsqu&#39;une personne décède. C&#39;est quelque chose de fréquemment discuté dans l&#39;espace des contrats intelligents, et met en évidence les risques d&#39;un oracle de confiance. Si le montant de l&#39;héritage contrôlé par un tel contrat est suffisamment élevé, l&#39;incitation à pirater l&#39;oracle et à déclencher la distribution des actifs <em>avant</em> le décès du propriétaire est très élevée.</p>
</div>
<div class="paragraph data-line-20">
<p>Notez que certains oracles fournissent des données propres à une source de données privée spécifique, telles que des certificats universitaires ou des identifiants gouvernementaux. La source de ces données, comme une université ou un département gouvernemental, est entièrement fiable et la vérité des données est subjective (la vérité n&#39;est déterminée qu&#39;en faisant appel à l&#39;autorité de la source). De telles données ne peuvent donc pas être fournies sans confiance, c&#39;est-à-dire sans faire confiance à une source, car il n&#39;y a pas de vérité objective vérifiable de manière indépendante. En tant que tels, nous incluons ces sources de données dans notre définition de ce qui compte comme des &quot;oracles&quot;, car elles fournissent également un pont de données pour les contrats intelligents. Les données qu&#39;ils fournissent prennent généralement la forme d&#39;attestations, telles que des passeports ou des certificats de réussite. Les attestations deviendront une grande partie du succès des plates-formes de chaîne de blocs à l&#39;avenir, en particulier en ce qui concerne les problèmes connexes de vérification de l&#39;identité ou de la réputation, il est donc important d&#39;explorer comment elles peuvent être servies par les plates-formes de chaîne de blocs.</p>
</div>
<div class="paragraph data-line-22">
<p>Voici d&#39;autres exemples de données pouvant être fournies par les oracles :</p>
</div>
<div class="ulist data-line-24">
<ul>
<li class="data-line-24">
<p>Nombres aléatoires/entropie provenant de sources physiques telles que les processus quantiques/thermiques : par exemple, pour sélectionner équitablement un gagnant dans un contrat intelligent de loterie</p>
</li>
<li class="data-line-25">
<p>Déclencheurs paramétriques indexés sur les aléas naturels : par exemple, déclenchement de contrats intelligents d&#39;obligation catastrophe, tels que les mesures à l&#39;échelle de Richter pour une obligation tremblement de terre</p>
</li>
<li class="data-line-26">
<p>Données de taux de change : par exemple, pour un rattachement précis des cryptomonnaies à la monnaie fiduciaire</p>
</li>
<li class="data-line-27">
<p>Données sur les marchés des capitaux : par exemple, prix des paniers d&#39;actifs/titres symboliques</p>
</li>
<li class="data-line-28">
<p>Données de référence de tests de performance : par exemple, intégration des taux d&#39;intérêt dans les dérivés financiers intelligents</p>
</li>
<li class="data-line-29">
<p>Données statiques/pseudostatiques : identifiants de sécurité, codes pays, codes devises, etc.</p>
</li>
<li class="data-line-30">
<p>Données de temps et d&#39;intervalle : pour les déclencheurs d&#39;événements fondés sur des mesures de temps précises</p>
</li>
<li class="data-line-31">
<p>Données météorologiques : par exemple, calculs de primes d&#39;assurance basés sur les prévisions météorologiques</p>
</li>
<li class="data-line-32">
<p>Événements politiques : pour la résolution du marché de prédiction</p>
</li>
<li class="data-line-33">
<p>Événements sportifs : pour la résolution du marché de la prédiction et les contrats de sports fantastiques</p>
</li>
<li class="data-line-34">
<p>Données de géolocalisation : par exemple, telles qu&#39;elles sont utilisées dans le suivi de la chaîne d&#39;approvisionnement</p>
</li>
<li class="data-line-35">
<p>Vérification des dommages : pour les contrats d&#39;assurance</p>
</li>
<li class="data-line-36">
<p>Événements survenant sur d&#39;autres blockchains : fonctions d&#39;interopérabilité</p>
</li>
<li class="data-line-37">
<p>Prix du marché de l&#39;ether : par exemple, oracles pour le prix du gaz en fiat</p>
</li>
<li class="data-line-38">
<p>Statistiques de vol : par exemple, telles qu&#39;elles sont utilisées par les groupes et les clubs pour la mise en commun des billets d&#39;avion</p>
</li>
</ul>
</div>
<div class="paragraph data-line-41">
<p>Dans les sections suivantes, nous examinerons certaines des façons dont les oracles peuvent être implémentés, y compris les modèles d&#39;oracle de base, les oracles de calcul, les oracles décentralisés et les implémentations de client oracle dans Solidity.</p>
</div>
</div>
<div class="sect2 data-line-44">
<h3 id="oracle_design_patterns">Modèles de conception Oracle</h3>
<div class="paragraph data-line-46">
<p>Tous les oracles fournissent quelques fonctions clés, par définition. Ceux-ci incluent la capacité de :</p>
</div>
<div class="ulist data-line-48">
<ul>
<li class="data-line-48">
<p>Recueillir des données à partir d&#39;une source hors chaîne.</p>
</li>
<li class="data-line-49">
<p>Transférez les données en chaîne avec un message signé.</p>
</li>
<li class="data-line-50">
<p>Rendre les données disponibles en les plaçant dans le stockage d&#39;un contrat intelligent.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-52">
<p>Une fois que les données sont disponibles dans le stockage d&#39;un contrat intelligent, elles peuvent être consultées par d&#39;autres contrats intelligents via des appels de message qui invoquent une fonction &quot;retrieve&quot; (récupérer) du contrat intelligent de l&#39;oracle ; il est également accessible directement aux nœuds Ethereum ou aux clients activés par le réseau en &quot;recherchant&quot; le stockage de l&#39;oracle.</p>
</div>
<div class="paragraph data-line-54">
<p>Les trois principales façons de configurer un oracle peuvent être classées comme <em>request–response</em> (requête-réponse), <span class="keep-together"><em>publish-subscribe</em></span> (publication-abonnement) et <em>immediate-read</em> (immédiat-lecture).</p>
</div>
<div class="paragraph data-line-56">
<p> En commençant par le plus simple, les oracles à lecture immédiate sont ceux qui fournissent des données qui ne sont nécessaires que pour une décision immédiate, comme &quot;Quelle est l&#39;adresse de <em>ethereumbook.info</em>?&quot; ou &quot;Cette personne a-t-elle plus de 18 ans ?&quot; Ceux qui souhaitent interroger ce type de données ont tendance à le faire sur une base « juste à temps » ; la recherche est effectuée lorsque l&#39;information est nécessaire et peut-être plus jamais après. Des exemples de tels oracles incluent ceux qui contiennent des données sur ou émises par des organisations, telles que des certificats académiques, des codes de numérotation, des adhésions institutionnelles, des identifiants d&#39;aéroport, des identifiants auto-souverains, etc. Ce type d&#39;oracle stocke les données une fois dans son stockage contractuel, d&#39;où tout un autre contrat intelligent peut le rechercher à l&#39;aide d&#39;un appel de demande au contrat oracle. Il peut être mis à jour. Les données dans le stockage de l&#39;oracle sont également disponibles pour une recherche directe par des applications compatibles avec la chaîne de blocs (c&#39;est-à-dire, Ethereum <span class="keep-together">connecté au client</span>) sans avoir à passer par la palabre et à encourir les coûts de gaz liés à l&#39;émission d&#39;une transaction. Un magasin voulant vérifier l&#39;âge d&#39;un client souhaitant acheter de l&#39;alcool pourrait utiliser un oracle de cette manière. Ce type d&#39;oracle est attrayant pour une organisation ou une entreprise qui pourrait autrement avoir à exécuter et à entretenir des serveurs pour répondre à de telles demandes de données. Notez que les données stockées par l&#39;oracle ne sont probablement pas les données brutes que l&#39;oracle sert, par exemple, pour des raisons d&#39;efficacité ou de confidentialité. Une université peut mettre en place un oracle pour les certificats de réussite scolaire des anciens étudiants. Cependant, stocker tous les détails des certificats (qui pourraient s&#39;étendre sur des pages de cours suivis et de notes obtenues) serait excessif. Au lieu de cela, un hachage du certificat est suffisant. De même, un gouvernement pourrait souhaiter mettre les identifiants des citoyens sur la plate-forme Ethereum, où il est clair que les détails inclus doivent rester confidentiels. Encore une fois, hacher les données (plus soigneusement, dans les arbres Merkle avec des sels) et ne stocker que le hachage racine dans le stockage du contrat intelligent serait un moyen efficace d&#39;organiser un tel service.</p>
</div>
<div class="paragraph data-line-58">
<p>La configuration suivante est <em>publication-abonnement</em> (<em>publish–subscribe</em>), où un oracle qui fournit effectivement un service de diffusion pour les données qui devraient changer de valeurs (peut-être à la fois régulièrement et fréquemment) est soit interrogé par un contrat intelligent sur la chaîne, soit surveillé par un processus hors chaîne pour les mises à jour. Cette catégorie a un modèle similaire aux flux RSS, WebSub, etc., où l&#39;oracle est mis à jour avec de nouvelles informations et un indicateur signale que de nouvelles données sont disponibles pour ceux qui se considèrent comme &quot;abonnés&quot;. Les parties intéressées doivent soit interroger l&#39;oracle pour vérifier si les dernières informations ont changé, soit écouter les mises à jour des contrats oracle et agir lorsqu&#39;elles se produisent. Les exemples incluent les flux de prix, les informations météorologiques, les statistiques économiques ou sociales, les données de trafic, etc. Le sondage est très inefficace dans le monde des serveurs Web, mais pas dans le contexte pair à pair des plateformes en chaîne de blocs : les clients Ethereum doivent suivre avec tous les changements d&#39;état, y compris les changements de stockage de contrat, de sorte que l&#39;interrogation des changements de données est un appel local à un client synchronisé. Les journaux d&#39;événements Ethereum permettent aux applications de rechercher particulièrement, et ce facilement, les mises à jour d&#39;un oracle, et donc ce modèle peut même être considéré à certains égards comme un service &quot;push&quot; (d&#8217;envoi). Cependant, si l&#39;interrogation est effectuée à partir d&#39;un contrat intelligent, ce qui peut être nécessaire pour certaines applications décentralisées (par exemple, lorsque les incitations à l&#39;activation ne sont pas possibles), des dépenses importantes en gaz peuvent être engagées.</p>
</div>
<div class="paragraph data-line-60">
<p>La catégorie <em>request–response</em> (<em>requête-réponse</em>) est la plus compliquée : c&#39;est lorsque la quantité de données est trop grande pour être stocké dans un contrat intelligent et les utilisateurs ne devraient avoir besoin que d&#39;une petite partie de l&#39;ensemble de données globale à la fois. C&#39;est également un modèle applicable pour les entreprises de fournisseurs de données. Concrètement, un tel oracle pourrait être mis en œuvre comme un système de contrats intelligents en chaîne et une infrastructure hors chaîne utilisée pour surveiller les demandes et récupérer et renvoyer des données. Une demande de données à partir d&#39;une application décentralisée serait généralement un processus asynchrone impliquant un certain nombre d&#39;étapes. Dans ce modèle, premièrement, un EOA traite avec une application décentralisée, ce qui entraîne une interaction avec une fonction définie dans le contrat intelligent de l&#8217;oracle. Cette fonction initie la demande à l&#39;oracle, avec les arguments associés détaillant les données demandées en plus d&#39;informations supplémentaires pouvant inclure des fonctions de rappel et des paramètres de planification. Une fois cette transaction validée, la requête oracle peut être observée comme un événement EVM émis par le contrat oracle, ou comme un changement d&#39;état ; les arguments peuvent être récupérés et utilisés pour effectuer la requête réelle de la source de données hors chaîne. L&#39;oracle peut également exiger un paiement pour le traitement de la demande, c&#8217;est à dire le paiement du gaz pour le rappel et les autorisations d&#39;accès aux données demandées. Enfin, les données résultantes sont signées par le propriétaire de l&#39;oracle, attestant de la validité des données à un moment donné, et livrées dans une transaction à l&#39;application décentralisée qui a fait la demande, soit directement, soit via le contrat de l&#8217;oracle. En fonction des paramètres de planification, l&#39;oracle peut diffuser d&#39;autres transactions mettant à jour les données à intervalles régulières (par exemple, des informations de tarification en fin de journée).</p>
</div>
<div class="paragraph data-line-62">
<p>Les étapes d&#39;un oracle de requête-réponse peuvent être résumées comme suit :</p>
</div>
<div class="olist arabic data-line-64">
<ol class="arabic">
<li class="data-line-64">
<p>Recevez une requête d&#39;un DApp.</p>
</li>
<li class="data-line-65">
<p>Analysez la requête.</p>
</li>
<li class="data-line-66">
<p>Vérifiez que les autorisations de paiement et d&#39;accès aux données sont fournies.</p>
</li>
<li class="data-line-67">
<p>Récupérez les données pertinentes d&#39;une source hors chaîne (et cryptez-les si nécessaire).</p>
</li>
<li class="data-line-68">
<p>Signez la ou les transactions avec les données incluses.</p>
</li>
<li class="data-line-69">
<p>Diffusez la ou les transactions sur le réseau.</p>
</li>
<li class="data-line-70">
<p>Planifiez toutes les autres transactions nécessaires, telles que les notifications, etc.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-72">
<p>Une gamme d&#39;autres régimes sont également possibles; par exemple, les données peuvent être demandées et renvoyées directement par un EOA, supprimant ainsi le besoin d&#39;un contrat intelligent d&#8217;oracle. De même, la demande et la réponse pourraient être faites vers et depuis un capteur matériel compatible avec l&#39;Internet des objets. Par conséquent, les oracles peuvent être humains, logiciels ou matériels.</p>
</div>
<div class="paragraph data-line-74">
<p>Le modèle requête-réponse décrit ici est couramment observé dans les architectures client-serveur. Bien qu&#39;il s&#39;agisse d&#39;un modèle de messagerie utile qui permet aux applications d&#39;avoir une conversation bidirectionnelle, il est peut-être inapproprié dans certaines conditions. Par exemple, une obligation intelligente nécessitant un taux d&#39;intérêt auprès d&#39;un oracle pourrait devoir demander les données quotidiennement selon un modèle demande-réponse afin de s&#39;assurer que le taux est toujours correct. Étant donné que les taux d&#39;intérêt changent rarement, un modèle de publication-abonnement peut être plus approprié ici, en particulier si l&#39;on tient compte de la bande passante limitée d&#39;Ethereum.</p>
</div>
<div class="paragraph data-line-76">
<p>La publication-abonnement est un modèle dans lequel les éditeurs (dans ce contexte, les oracles) n&#39;envoient pas de messages directement aux destinataires, mais classent plutôt les messages publiés dans des classes distinctes. Les abonnés peuvent exprimer leur intérêt pour une ou plusieurs classes et récupérer uniquement les messages qui les intéressent. Dans un tel modèle, un oracle pourrait écrire le taux d&#39;intérêt dans sa propre mémoire interne à chaque fois qu&#39;il change. Plusieurs DApps abonnés peuvent simplement le lire à partir du contrat oracle, réduisant ainsi l&#39;impact sur la bande passante du réseau tout en minimisant les coûts de stockage.</p>
</div>
<div class="paragraph data-line-78">
<p>Dans un modèle de diffusion ou de multidiffusion, un oracle publierait tous les messages sur un canal et les contrats d&#39;abonnement écouteraient le canal sous une variété de modes d&#39;abonnement. Par exemple, un oracle peut publier des messages sur un canal de taux de change de cryptomonnaie. Un contrat intelligent d&#39;abonnement pourrait demander le contenu complet de la chaîne s&#39;il avait besoin de la série chronologique pour, par exemple, un calcul de moyenne mobile ; un autre peut n&#39;exiger que le dernier taux pour un calcul du prix au comptant. Un modèle de diffusion est approprié lorsque l&#39;oracle n&#39;a pas besoin de connaître l&#39;identité du <span class="keep-together">contrat</span> d&#39;abonnement.</p>
</div>
</div>
<div class="sect2 data-line-81">
<h3 id="data_authentication_sec">Authentification des données</h3>
<div class="paragraph data-line-83">
<p>Si nous supposons que la source de les données interrogées par une DApp font à la fois autorité et sont dignes de confiance (une hypothèse non négligeable), une question reste en suspens : étant donné que l&#39;oracle et le mécanisme de requête-réponse peuvent être exploités par des entités distinctes, comment pouvons-nous faire confiance à ce mécanisme ? Il existe une réelle possibilité que les données soient altérées en transit, il est donc essentiel que les méthodes hors chaîne soient en mesure d&#39;attester de l&#39;intégrité des données renvoyées. Deux approches courantes de l&#39;authentification des données sont les <em>preuves d&#39;authenticité</em> et les <em>environnements d&#39;exécution de confiance</em> (TEE).</p>
</div>
<div class="paragraph data-line-85">
<p>Les preuves d&#39;authenticité sont des garanties cryptographiques que les données n&#39;ont pas été falsifiées. Basées sur une variété de techniques d&#39;attestation (par exemple, des preuves signées numériquement), elles transfèrent efficacement la confiance du support de données vers l&#39;attestateur (c&#39;est-à-dire le fournisseur de l&#39;attestation). En vérifiant la preuve d&#39;authenticité en chaîne, les contrats intelligents sont en mesure de vérifier l&#39;intégrité des données avant de les exploiter. <a href="http://www.oraclize.it/" data-href="http://www.oraclize.it/">Oraclize</a> est un exemple de service oracle exploitant une variété de preuves d&#39;authenticité. Une de ces preuves qui est actuellement disponible pour les requêtes de données à partir du réseau principal Ethereum est la preuve TLSNotary. Les preuves TLSNotary permettent à un client de fournir la preuve à un tiers que le trafic Web HTTPS s&#39;est produit entre le client et un serveur. Bien que HTTPS soit lui-même sécurisé, il ne prend pas en charge la signature des données. Par conséquent, les preuves TLSNotary reposent sur les signatures TLSNotary (via PageSigner). Les preuves TLSNotary s&#39;appuient sur le protocole Transport Layer Security (TLS), permettant à la clé principale TLS, qui signe les données après leur accès, d&#39;être répartie entre trois parties : le serveur (l&#39;oracle), un audité (Oraclize) et un Auditeur. Oraclize utilise une instance de machine virtuelle Amazon Web Services (AWS) comme auditeur, qui peut être vérifiée comme n&#39;ayant pas été modifiée depuis l&#39;instanciation. Cette instance AWS stocke le secret TLSNotary, lui permettant de fournir des preuves d&#39;honnêteté. Bien qu&#39;elle offre des garanties plus élevées contre la falsification des données qu&#39;un simple mécanisme de requête-réponse, cette approche nécessite l&#39;hypothèse qu&#39;Amazon lui-même ne falsifiera pas l&#39;instance de VM.</p>
</div>
<div class="paragraph data-line-87">
<p><a href="http://www.town-crier.org/" data-href="http://www.town-crier.org/">Town Crier</a> est un système oracle de flux de données authentifié basé sur l&#39;approche TEE ; ces méthodes utilisent des enclaves sécurisées basées sur le matériel pour garantir l&#39;intégrité des données. Town Crier utilise Intel Software Guard eXtensions (SGX) pour s&#39;assurer que les réponses des requêtes HTTPS peuvent être vérifiées comme authentiques . SGX offre des garanties d&#39;intégrité, garantissant que les applications s&#39;exécutant dans une enclave sont protégées par le CPU contre toute altération par tout autre processus. Il assure également la confidentialité, garantissant que l&#39;état d&#39;une application est opaque pour les autres processus lors de son exécution dans l&#39;enclave. Et enfin, SGX permet l&#39;attestation, en générant une preuve signée numériquement qu&#39;une application, identifiée de manière sécurisée par un hachage de sa version, s&#39;exécute réellement dans une enclave. En vérifiant cette signature numérique, il est possible pour une application décentralisée de prouver qu&#39;une instance Town Crier fonctionne en toute sécurité dans une enclave SGX. Ceci, à son tour, prouve que l&#39;instance n&#39;a pas été falsifiée et que les données émises par Town Crier sont donc authentiques. La propriété de confidentialité permet en outre à Town Crier de gérer des données privées en autorisant le chiffrement des requêtes de données à l&#39;aide de la clé publique de l&#39;instance Town Crier. L&#39;utilisation du mécanisme de requête-réponse d&#39;un oracle dans une enclave telle que SGX nous permet de penser qu&#39;il s&#39;exécute en toute sécurité sur du matériel tiers de confiance, garantissant que les données demandées sont renvoyées sans altération (en supposant que nous faisons confiance à Intel/SGX).</p>
</div>
</div>
<div class="sect2 data-line-90">
<h3 id="computation_oracles_sec">Oracles de calcul</h3>
<div class="paragraph data-line-92">
<p>Jusqu&#39;à présent, nous n&#39;avons discuté des oracles que dans le contexte de la demande et de la livraison de données. Cependant, les oracles peuvent également être utilisés pour effectuer des calculs arbitraires, une fonction qui peut être particulièrement utile compte tenu de la limite de gaz de bloc inhérente à Ethereum et des coûts de calcul relativement élevés. Plutôt que de simplement relayer les résultats d&#39;une requête, les oracles de calcul peuvent être utilisés pour effectuer des calculs sur un ensemble d&#39;entrées et renvoyer un résultat calculé qu&#39;il aurait peut-être été impossible de calculer en chaîne. Par exemple, on peut utiliser un oracle pour effectuer un calcul de régression intensif afin d&#39;estimer le rendement d&#39;un contrat obligataire.</p>
</div>
<div class="paragraph data-line-94">
<p>Si vous êtes prêt à faire confiance à un service centralisé mais auditable, vous pouvez revenir à Oraclize. Ils fournissent un service qui permet aux applications décentralisées de demander la sortie d&#39;un calcul effectué dans une machine virtuelle AWS en bac à sable. L&#39;instance AWS crée un conteneur exécutable à partir d&#39;un fichier Dockerfile configuré par l&#39;utilisateur, compressé dans une archive qui est téléchargée sur le système de fichiers décentralisé (IPFS ; voir <a href="#data_storage_sec">Stockage de données</a>). Sur demande, Oraclize récupère cette archive à l&#39;aide de son hachage, puis initialise et exécute le conteneur Docker sur AWS, en transmettant tous les arguments fournis à l&#39;application en tant que variables d&#39;environnement. L&#39;application conteneurisée effectue le calcul, soumis à une contrainte de temps, et écrit le résultat sur la sortie standard, où il peut être récupéré par Oraclize et renvoyé à l&#39;application décentralisée. Oraclize propose actuellement ce service sur une instance AWS t2.micro auditable, donc si le calcul a une valeur non triviale, il est possible de vérifier que le bon conteneur Docker a été exécuté. Néanmoins, ce n&#39;est pas une solution véritablement décentralisée.</p>
</div>
<div class="paragraph data-line-96">
<p>Le concept de &quot;cryptlet&quot; en tant que norme pour les vérités d&#39;oracle vérifiables a été formalisé dans le cadre plus large de l&#39;ESC Framework de Microsoft. Les cryptlets s&#39;exécutent dans une capsule chiffrée qui fait abstraction de l&#39;infrastructure, telle que les Entrées/Sorties, et auquel le CryptoDelegate est attaché afin que les messages entrants et sortants soient signés, validés et prouvés automatiquement. Les cryptlets prennent en charge les transactions distribuées afin que la logique de contrat puisse prendre en charge des transactions complexes à plusieurs étapes, à plusieurs chaînes de blocs et de systèmes externes de manière ACID. Cela permet aux développeurs de créer des résolutions portables, isolées et privées de la vérité à utiliser dans les contrats intelligents. Les cryptlets suivent le format indiqué ici :</p>
</div>
<div class="listingblock data-line-99">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">public class SampleContractCryptlet : Cryptlet
  {
        public SampleContractCryptlet(Guid id, Guid bindingId, string name,
            string address, IContainerServices hostContainer, bool contract)
            : base(id, bindingId, name, address, hostContainer, contract)
        {
            MessageApi = new CryptletMessageApi(GetType().FullName,
                new SampleContractConstructor())</code></pre>
</div>
</div>
<div class="paragraph data-line-110">
<p>Pour une solution plus décentralisée, nous pouvons nous tourner vers <a href="https://truebit.io/" data-href="https://truebit.io/">TrueBit</a>, qui offre une solution de calcul hors chaîne évolutive et vérifiable. Ils utilisent un système de solveurs et de vérificateurs qui sont incités à effectuer des calculs et à vérifier ces calculs, respectivement. Si une solution est contestée, un processus de vérification itératif sur des sous-ensembles du calcul est effectué en chaîne, une sorte de « jeu de vérification ». Le jeu se déroule à travers une série de tours, chacun vérifiant de manière récursive un sous-ensemble de plus en plus petit du calcul. Le jeu atteint finalement un tour final, où le défi est suffisamment trivial pour que les juges - les mineurs d&#39;Ethereum - puissent rendre une décision finale sur la question de savoir si le défi a été relevé, en chaîne. En effet, TrueBit est une implémentation d&#39;un marché de calcul, permettant aux applications décentralisées de payer pour un calcul vérifiable à effectuer en dehors du réseau, mais s&#39;appuyant sur Ethereum pour faire respecter les règles du jeu de vérification. En théorie, cela permet aux contrats intelligents sans confiance d&#39;effectuer en toute sécurité n&#39;importe quelle tâche de calcul.</p>
</div>
<div class="paragraph data-line-112">
<p>Un large éventail d&#39;applications existe pour des systèmes comme TrueBit, allant de l&#39;apprentissage automatique à la vérification de la preuve de travail. Un exemple de ce dernier est le pont Doge-Ethereum, qui utilise TrueBit pour vérifier la preuve de travail de Dogecoin (Scrypt), qui est une fonction gourmande en mémoire et en calcul qui ne peut pas être calculée dans la limite de gaz du bloc Ethereum. En effectuant cette vérification sur TrueBit, il a été possible de vérifier en toute sécurité les transactions Dogecoin dans un contrat intelligent sur le testnet Rinkeby d&#39;Ethereum.</p>
</div>
</div>
<div class="sect2 data-line-115">
<h3 id="decentralized_orackes_sec">Oracles décentralisés</h3>
<div class="paragraph data-line-117">
<p>Alors que les données centralisées ou les oracles de calcul suffisent pour de nombreuses applications, ils représentent des points de défaillance uniques dans le réseau Ethereum. Un certain nombre de schémas ont été proposés autour de l&#39;idée d&#39;oracles décentralisés comme moyen d&#39;assurer la disponibilité des données et la création d&#39;un réseau de fournisseurs de données individuels avec un système d&#39;agrégation de données en chaîne.</p>
</div>
<div class="paragraph data-line-119">
<p><a href="https://www.smartcontract.com/link" data-href="https://www.smartcontract.com/link">ChainLink</a> a proposé un réseau oracle décentralisé composé de trois contrats intelligents clés : un contrat de réputation, un contrat de correspondance des commandes et un contrat d&#39;agrégation — et un registre hors chaîne des fournisseurs de données. Le contrat de réputation est utilisé pour suivre les performances des fournisseurs de données. Les scores du contrat de réputation sont utilisés pour remplir le registre hors chaîne. Le contrat d&#39;appariement des commandes sélectionne les offres des oracles à l&#39;aide du contrat de réputation. Il finalise ensuite un accord de niveau de service, qui inclut les paramètres de requête et le nombre d&#39;oracles requis. Cela signifie que l&#39;acheteur n&#39;a pas besoin de traiter directement avec les oracles individuels. Le contrat d&#39;agrégation collecte les réponses (soumises à l&#39;aide d&#39;un schéma de validation-révélation) de plusieurs oracles, calcule le résultat collectif final de la requête et réinjecte finalement les résultats dans le contrat de réputation.</p>
</div>
<div class="paragraph data-line-121">
<p>L&#39;un des principaux défis d&#39;une telle approche décentralisée est la formulation de la fonction d&#39;agrégation. ChainLink propose de calculer une réponse pondérée, permettant de rapporter un score de validité pour chaque réponse oracle. La détection d&#39;un score «invalide» ici n&#39;est pas triviale, car elle repose sur la prémisse que les points de données aberrants, mesurés par les écarts par rapport aux réponses fournies par les pairs, sont incorrects. Le calcul d&#39;un score de validité basé sur l&#39;emplacement d&#39;une réponse oracle parmi une distribution de réponses risque de pénaliser les réponses correctes par rapport aux réponses moyennes. Par conséquent, ChainLink propose un ensemble standard de contrats d&#39;agrégation, mais permet également de spécifier des contrats d&#39;agrégation personnalisés.</p>
</div>
<div class="paragraph data-line-123">
<p>Une idée connexe est le protocole SchellingCoin. Ici, plusieurs participants rapportent des valeurs et la médiane est considérée comme la « bonne » réponse. Les déclarants sont tenus de fournir un acompte qui est redistribué en faveur de valeurs plus proches de la médiane, incitant ainsi à déclarer des valeurs similaires aux autres. Une valeur commune, également connue sous le nom de point de Schelling, que les répondants pourraient considérer comme la cible naturelle et évidente autour de laquelle se coordonner devrait être proche de la valeur réelle.</p>
</div>
<div class="paragraph data-line-125">
<p>Jason Teutsch de TrueBit a récemment proposé une nouvelle conception pour un oracle décentralisé de disponibilité des données hors chaîne. Cette conception s&#39;appuie sur une chaîne de blocs de preuve de travail dédiée qui est capable de signaler correctement si les données enregistrées sont disponibles ou non à une époque donnée. Les mineurs tentent de télécharger, stocker et propager toutes les données actuellement enregistrées, garantissant ainsi que les données sont disponibles localement. Bien qu&#39;un tel système soit coûteux dans le sens où chaque nœud de minage stocke et propage toutes les données enregistrées, le système permet de réutiliser le stockage en libérant les données après la fin de la période d&#39;enregistrement.</p>
</div>
</div>
<div class="sect2 data-line-128">
<h3 id="oracle_client_interfaces_in_solidity_sec">Interfaces clients Oracle en solidité</h3>
<div class="paragraph data-line-130">
<p><a href="#using_oraclize_to_update_the_eth_usd">Utilisation d&#39;Oraclize pour mettre à jour le taux de change ETH/USD à partir d&#39;une source externe</a> est un exemple Solidity démontrant comment Oraclize peut être utilisé pour interroger en continu le prix ETH/USD à partir d&#39;une API et stocker le résultat de manière utilisable.</p>
</div>
<div id="using_oraclize_to_update_the_eth_usd" class="exampleblock data-line-134">
<div class="title">Example 22. Utilisation d&#39;Oraclize pour mettre à jour le taux de change ETH/USD à partir d&#39;une source externe</div>
<div class="content">
<div class="listingblock data-line-136">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">/*
Défileur de prix ETH/USD tirant parti de l&amp;#39;API CryptoCompare

Ce contrat garde en mémoire un prix ETH/USD mis à jour,
qui est mis à jour toutes les 10 minutes.
*/

pragma solidity ^0.4.1;
import "github.com/oraclize/ethereum-api/oraclizeAPI.sol";

/*
   "oraclize_" prepended methods indicate inheritance from "usingOraclize"
*/
contract EthUsdPriceTicker is usingOraclize {

    uint public ethUsd;

    event newOraclizeQuery(string description);
    event newCallbackResult(string result);

    function EthUsdPriceTicker() payable {
        // signals TLSN proof generation and storage on IPFS
        oraclize_setProof(proofType_TLSNotary | proofStorage_IPFS);

        // requests query
        queryTicker();
    }

    function __callback(bytes32 _queryId, string _result, bytes _proof) public {
        if (msg.sender != oraclize_cbAddress()) throw;
        newCallbackResult(_result);

        /*
        * Analyse la chaîne de résultat en un entier non signé pour une utilisation en chaîne.
        * Utilise l&amp;#39;assistant &amp;quot;parseInt&amp;quot; hérité de &amp;quot;usingOraclize&amp;quot;, permettant
        * un résultat de chaîne tel que &amp;quot;123.45&amp;quot; à convertir en uint 12345.
        */
        ethUsd = parseInt(_result, 2);

        // appelé depuis le rappel puisque nous interrogeons le prix
        queryTicker();
    }

    function queryTicker() external payable {
        if (oraclize_getPrice("URL") &gt; this.balance) {
            newOraclizeQuery("Oraclize query was NOT sent, please add some ETH
                to cover for the query fee");
        } else {
            newOraclizeQuery("Oraclize query was sent, standing by for the
                answer...");

            // les paramètres de la requête sont (délai en secondes, type de source de données,
            // argument de source de données)
            // spécifie JSONPath, pour récupérer une partie spécifique du résultat de l&amp;#39;API JSON
            oraclize_query(60 * 10, "URL",
                "json(https://min-api.cryptocompare.com/data/price?\
                fsym=ETH&amp;tsyms=USD,EUR,GBP).USD");
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-200">
<p>Pour s&#39;intégrer à Oraclize, le contrat EthUsdPriceTicker doit être un enfant de <span class="keep-together"><code>usingOraclize</code></span>; le contrat usingOraclize est défini dans le fichier <em>oraclizeAPI</em>. La demande de données est effectuée à l&#39;aide de la fonction oraclize_query, qui est héritée du contrat usingOraclize. Il s&#39;agit d&#39;une fonction surchargée qui attend au moins deux arguments :</p>
</div>
<div class="ulist data-line-202">
<ul>
<li class="data-line-202">
<p>La source de données prise en charge à utiliser, telle que URL, WolframAlpha, IPFS ou calculation</p>
</li>
<li class="data-line-203">
<p>L&#39;argument de la source de données donnée, qui peut inclure l&#39;utilisation d&#39;assistants d&#39;analyse JSON ou XML</p>
</li>
</ul>
</div>
<div class="paragraph data-line-205">
<p>La requête de prix est effectuée dans la fonction queryTicker. Afin d&#39;effectuer la requête, Oraclize exige le paiement d&#39;une somme modique en ether, couvrant le coût du gaz pour traiter le résultat et le transmettre à la fonction __callback et un supplément d&#39;accompagnement pour le service. Ce montant dépend de la source de données et, le cas échéant, du type de preuve d&#39;authenticité requis. Une fois les données récupérées, la fonction __callback est appelée par un compte contrôlé par Oraclize autorisé à effectuer le rappel ; il transmet la valeur de réponse et un argument queryId unique, qui, par exemple, peut être utilisé pour gérer et suivre plusieurs rappels en attente d&#39;Oraclize.</p>
</div>
<div class="paragraph data-line-207">
<p>Le fournisseur de données financières Thomson Reuters fournit également un service oracle pour Ethereum, appelé BlockOne IQ, permettant de demander des données de marché et de référence par des contrats intelligents exécutés sur des réseaux privés ou autorisés. <a href="#contract_calling_the_blockone_iq_service_for_market_data">Contrat faisant appel au service BlockOne IQ pour les données de marché</a> montre l&#39;interface pour l&#39;oracle, et un contrat client qui fera la demande.</p>
</div>
<div id="contract_calling_the_blockone_iq_service_for_market_data" class="exampleblock data-line-211">
<div class="title">Example 23. Contrat faisant appel au service BlockOne IQ pour les données de marché</div>
<div class="content">
<div class="listingblock data-line-213">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.11;

contract Oracle {
    uint256 public divisor;
    function initRequest(
       uint256 queryType, function(uint256) external onSuccess,
       function(uint256
    ) external onFailure) public returns (uint256 id);
    function addArgumentToRequestUint(uint256 id, bytes32 name, uint256 arg) public;
    function addArgumentToRequestString(uint256 id, bytes32 name, bytes32 arg)
        public;
    function executeRequest(uint256 id) public;
    function getResponseUint(uint256 id, bytes32 name) public constant
        returns(uint256);
    function getResponseString(uint256 id, bytes32 name) public constant
        returns(bytes32);
    function getResponseError(uint256 id) public constant returns(bytes32);
    function deleteResponse(uint256 id) public constant;
}

contract OracleB1IQClient {

    Oracle private oracle;
    event LogError(bytes32 description);

    function OracleB1IQClient(address addr) external payable {
        oracle = Oracle(addr);
        getIntraday("IBM", now);
    }

    function getIntraday(bytes32 ric, uint256 timestamp) public {
        uint256 id = oracle.initRequest(0, this.handleSuccess, this.handleFailure);
        oracle.addArgumentToRequestString(id, "symbol", ric);
        oracle.addArgumentToRequestUint(id, "timestamp", timestamp);
        oracle.executeRequest(id);
    }

    function handleSuccess(uint256 id) public {
        assert(msg.sender == address(oracle));
        bytes32 ric = oracle.getResponseString(id, "symbol");
        uint256 open = oracle.getResponseUint(id, "open");
        uint256 high = oracle.getResponseUint(id, "high");
        uint256 low = oracle.getResponseUint(id, "low");
        uint256 close = oracle.getResponseUint(id, "close");
        uint256 bid = oracle.getResponseUint(id, "bid");
        uint256 ask = oracle.getResponseUint(id, "ask");
        uint256 timestamp = oracle.getResponseUint(id, "timestamp");
        oracle.deleteResponse(id);
// Faire quelque chose avec les données de prix
    }

    function handleFailure(uint256 id) public {
        assert(msg.sender == address(oracle));
        bytes32 error = oracle.getResponseError(id);
        oracle.deleteResponse(id);
        emit LogError(error);
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-276">
<p>La demande de données est initiée à l&#39;aide de la fonction initRequest, qui permet de spécifier le type de requête (dans cet exemple, une demande de prix infrajournalier), en plus de deux fonctions de rappel.
Cela renvoie un identifiant uint256 qui peut ensuite être utilisé pour fournir des arguments supplémentaires. La fonction addArgumentToRequestString permet de spécifier le Reuters Instrument Code (RIC), ici pour le stock IBM, et <span class="keep-together"><code>addArgumentToRequestUint</code></span> permet de spécifier l&#39;horodatage. Maintenant, passer un alias pour block.timestamp récupérera le prix actuel pour IBM. La requête est alors exécutée par la fonction executeRequest. Une fois la requête traitée, le contrat oracle appellera la fonction callback onSuccess avec l&#39;identifiant de la requête, permettant de récupérer les données résultantes ; en cas d&#39;échec de la récupération, le rappel <span class="keep-together"><code>onFailure</code></span> renverra un code d&#39;erreur à la place. Les champs disponibles qui peuvent être récupérés en cas de succès incluent les prix open, high, low, close (OHLC) et bid/ask.</p>
</div>
</div>
<div class="sect2 data-line-280">
<h3 id="_conclusion_8">Conclusion</h3>
<div class="paragraph data-line-282">
<p>Comme vous pouvez le constater, les oracles fournissent un service crucial aux contrats intelligents : ils apportent des faits externes à l&#39;exécution du contrat. Avec cela, bien sûr, les oracles présentent également un risque important - s&#39;ils sont des sources fiables et peuvent être compromis, ils peuvent entraîner une exécution compromise des contrats intelligents qu&#39;ils alimentent.</p>
</div>
<div class="paragraph data-line-284">
<p>Généralement, lorsque vous envisagez l&#39;utilisation d&#39;un oracle, faites très attention au <em>modèle de confiance</em>. Si vous supposez que l&#39;oracle est digne de confiance, vous risquez de compromettre la sécurité de votre contrat intelligent en l&#39;exposant à des entrées potentiellement fausses. Cela dit, les oracles peuvent être très utiles si les hypothèses de sécurité sont soigneusement prises en compte.</p>
</div>
<div class="paragraph data-line-25">
<p>Les oracles décentralisés peuvent résoudre certains de ces problèmes et proposer des contrats intelligents Ethereum sans confiance en données externes. Choisissez avec soin et vous pourrez commencer à explorer le pont entre Ethereum et le &quot;monde réel&quot; qu&#39;offrent les oracles.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="decentralized_applications_chap">Applications décentralisées (DApps)</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Dans ce chapitre, nous allons explorer le monde des <em>applications décentralisées</em>, ou <em>DApps</em>. Dès les premiers jours d&#39;Ethereum, la vision des fondateurs était bien plus large que les &quot;contrats intelligents&quot; :  rien de moins que de réinventer le web et de créer un nouveau monde de DApps, appelé à juste titre <em>web3</em>. Les contrats intelligents sont un moyen de décentraliser la logique de contrôle et les fonctions de paiement des applications. Les DApps Web3 consistent à décentraliser tous les autres aspects d&#39;une application : stockage, messagerie, nommage, etc. (voir <a href="#image_web3_suite">Web3 : Un web décentralisé utilisant des contrats intelligents et des technologies P2P</a>).</p>
</div>
<div id="image_web3_suite" class="imageblock data-line-8">
<div class="content">
<img src="images/web3suite.png" alt="&quot;Web3 : un Web décentralisé utilisant des contrats intelligents et les technologies P2P&quot;">
</div>
<div class="title">Figure 41. Web3 : Un web décentralisé utilisant des contrats intelligents et des technologies P2P</div>
</div>
<div class="admonitionblock warning data-line-11">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-12">
<p>Alors que les &quot;applications décentralisées&quot; sont une vision audacieuse de l&#39;avenir, le terme &quot;DApp&quot; est souvent appliqué à tout contrat intelligent avec une interface Web. Certaines de ces soi-disant DApps sont des applications hautement centralisées (CApps ?). Méfiez-vous des faux DApps !</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-15">
<p>Dans ce chapitre, nous allons développer et déployer un exemple de DApp : une plateforme d&#39;enchères. Vous pouvez trouver le code source dans le référentiel du livre sous <a href="http://bit.ly/2DcmjyA" data-href="http://bit.ly/2DcmjyA"><em>code/auction_dapp</em></a>. Nous examinerons chaque aspect d&#39;une application d&#39;enchères et verrons comment nous pouvons décentraliser l&#39;application autant que possible. Cependant, examinons d&#39;abord de plus près les caractéristiques et les avantages déterminants des DApps.</p>
</div>
<div class="sect2 data-line-18">
<h3 id="what_is_a_dapp_sec">Qu&#39;est-ce qu&#39;un DApp ?</h3>
<div class="paragraph data-line-20">
<p>Une DApp est une application qui est principalement ou entièrement décentralisée.</p>
</div>
<div class="paragraph data-line-22">
<p>Considérez tous les aspects possibles d&#39;une application qui peut être décentralisée :</p>
</div>
<div class="ulist data-line-24">
<ul>
<li class="data-line-24">
<p>Logiciel dorsale (logique d&#39;application)</p>
</li>
<li class="data-line-25">
<p>Logiciel frontal</p>
</li>
<li class="data-line-26">
<p>Stockage de données</p>
</li>
<li class="data-line-27">
<p>Communications par messages</p>
</li>
<li class="data-line-28">
<p>Résolution de nom</p>
</li>
</ul>
</div>
<div class="paragraph data-line-30">
<p>Chacun d&#39;eux peut être quelque peu centralisé ou quelque peu décentralisé. Par exemple, une interface peut être développée comme une application Web qui s&#39;exécute sur un serveur centralisé ou comme une application mobile qui s&#39;exécute sur votre appareil. Le backend et le stockage peuvent être sur des serveurs privés et des bases de données propriétaires, ou vous pouvez utiliser un contrat intelligent et un stockage P2P.</p>
</div>
<div class="paragraph data-line-32">
<p>La création d&#39;une DApp présente de nombreux avantages qu&#39;une architecture centralisée typique ne peut pas offrir :</p>
</div>
<div class="dlist data-line-34">
<dl>
<dt class="hdlist1">Élasticité</dt>
<dd>
<p>Parce que la logique d&#8217;affaire est contrôlée par un contrat intelligent, une DApp dorsale sera entièrement distribué et géré sur une plateforme chaîne de blocs. Contrairement à une application déployée sur un serveur centralisé, une DApp n&#39;aura pas de temps d&#39;arrêt et restera disponible tant que la plateforme fonctionnera.</p>
</dd>
<dt class="hdlist1">Transparence</dt>
<dd>
<p>La nature en chaîne d&#39;une DApp permet à chacun d&#39;inspecter le code et d&#39;être plus sûr de sa fonction. Toute interaction avec la DApp sera stockée pour toujours dans la chaîne de blocs.</p>
</dd>
<dt class="hdlist1">Résistance à la censure</dt>
<dd>
<p>Tant qu&#39;un utilisateur a accès à un nœud Ethereum (en exécutant un si nécessaire), l&#39;utilisateur pourra toujours interagir avec une DApp sans interférence de tout contrôle centralisé. Aucun fournisseur de services, ni même le propriétaire du contrat intelligent, ne peut modifier le code une fois qu&#39;il est déployé sur le réseau.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-43">
<p>Dans l&#39;écosystème Ethereum tel qu&#39;il se présente aujourd&#39;hui, il existe très peu d&#39;applications véritablement décentralisées, la plupart reposant encore sur des services et des serveurs centralisés pour une partie de leur fonctionnement. À l&#39;avenir, nous prévoyons qu&#39;il sera possible pour chaque partie de n&#39;importe quelle DApp d&#39;être exploitée de manière entièrement décentralisée.</p>
</div>
<div class="sect3 data-line-46">
<h4 id="blockchain_smart_contracts_sec">Environnement dorsale (contrat intelligent)</h4>
<div class="paragraph data-line-48">
<p>Dans une DApp, les contrats intelligents sont utilisés pour stocker la logique applicative (code de programme) et l&#39;état correspondant de votre application. Vous pouvez penser à un contrat intelligent remplaçant un composant côté serveur (alias &quot;backend&quot; ou "environnement dorsale") dans une application standard. C&#39;est une simplification excessive, bien sûr. L&#39;une des principales différences est que tout calcul exécuté dans un contrat intelligent est très coûteux et doit donc être réduit au minimum. Il est donc important d&#39;identifier les aspects de l&#39;application qui nécessitent une plateforme d&#39;exécution fiable et décentralisée.</p>
</div>
<div class="paragraph data-line-50">
<p>Les contrats intelligents Ethereum vous permettent de créer des architectures dans lesquelles un réseau de contrats intelligents appellent et transmettent des données entre eux, lisant et écrivant leurs propres variables d&#39;état au fur et à mesure, leur complexité n&#39;étant limitée que par la limite de gaz de bloc. Après avoir déployé votre contrat intelligent, votre logique applicative pourrait bien être utilisée par de nombreux autres développeurs à l&#39;avenir.</p>
</div>
<div class="paragraph data-line-52">
<p>L&#39;une des principales considérations de la conception d&#39;une architecture de contrat intelligent est l&#39;impossibilité de modifier le code d&#39;un contrat intelligent une fois qu&#39;il est déployé. Il peut être supprimé s&#39;il est programmé avec un opcode SELFDESTRUCT accessible, mais à part une suppression complète, le code ne peut en aucun cas être modifié.</p>
</div>
<div class="paragraph data-line-54">
<p>La deuxième considération majeure de la conception de l&#39;architecture des contrats intelligents est la taille du DApp. Un très gros contrat intelligent monolithique peut coûter beaucoup de gaz à déployer et à utiliser. Par conséquent, certaines applications peuvent choisir d&#39;avoir un calcul hors chaîne et une source de données externe. Gardez à l&#39;esprit, cependant, que le fait que la logique applicative de base de la DApp dépende de données externes (par exemple, à partir d&#39;un serveur centralisé) signifie que vos utilisateurs devront faire confiance à ces ressources externes.</p>
</div>
</div>
<div class="sect3 data-line-57">
<h4 id="front_end_web_ui_cec">Environnement frontale (interface utilisateur Web)</h4>
<div class="paragraph data-line-59">
<p>Contrairement à la logique applicative de la DApp, qui nécessite qu&#39;un développeur comprenne l&#39;EVM et de nouveaux langages comme Solidity, l&#39;interface côté client d&#39;une DApp peut utiliser des technologies web standards (HTML, CSS, JavaScript, etc.). Cela permet à un développeur Web traditionnel d&#39;utiliser des outils, des bibliothèques et des frameworks familiers. Les interactions avec Ethereum, telles que la signature de messages, l&#39;envoi de transactions et la gestion de clés, sont souvent effectuées via le navigateur Web, via une extension telle que MetaMask (voir <a href="#intro_chapter">Les bases d&#39;Ethereum</a>).</p>
</div>
<div class="paragraph data-line-61">
<p>Bien qu&#39;il soit également possible de créer un DApp mobile, il existe actuellement peu de ressources pour aider à créer des interfaces DApp mobiles, principalement en raison du manque de clients mobiles pouvant servir de client léger avec une fonctionnalité de gestion des clés.</p>
</div>
<div class="paragraph data-line-63">
<p>L&#39;interface est généralement liée à Ethereum via la bibliothèque JavaScript <em>web3.js</em>, qui est fournie avec les ressources de l&#39;interface et servie à un navigateur par un serveur Web.</p>
</div>
</div>
<div class="sect3 data-line-66">
<h4 id="data_storage_sec">Stockage de données</h4>
<div class="paragraph data-line-68">
<p>En raison des coûts élevés du gaz et de la limite de gaz actuellement faible, les contrats intelligents ne sont pas bien adapté au stockage ou au traitement de grandes quantités de données. Par conséquent, la plupart des DApps utilisent des services de stockage de données hors chaîne, ce qui signifie qu&#39;ils stockent les données volumineuses de la chaîne Ethereum, sur une plate-forme de stockage de données. Cette plate-forme de stockage de données peut être centralisée (par exemple, une base de données cloud typique), ou les données peuvent être décentralisées, stockées sur une plate-forme P2P telle que l&#39;IPFS ou la propre plate-forme Swarm d&#39;Ethereum.</p>
</div>
<div class="paragraph data-line-70">
<p>Le stockage P2P décentralisé est idéal pour stocker et distribuer de gros actifs statiques tels que des images, des vidéos et les ressources de l&#39;interface Web frontale de l&#39;application (HTML, CSS, JavaScript, etc.). Nous examinerons ensuite quelques-unes des options.</p>
</div>
<div class="sect4 data-line-73">
<h5 id="ipfs_sec">IPFS</h5>
<div class="paragraph data-line-75">
<p>Le <em>Inter-Planetary File System</em> (IPFS) est un système de stockage décentralisé adressable par le contenu qui distribue les objets stockés entre pairs dans un réseau P2P. &quot;Contenu adressable&quot; signifie que chaque élément de contenu (fichier) est haché et que le hachage est utilisé pour identifier ce fichier. Vous pouvez ensuite récupérer n&#39;importe quel fichier de n&#39;importe quel nœud IPFS en le demandant par son hachage.</p>
</div>
<div class="paragraph data-line-77">
<p>IPFS vise à remplacer HTTP comme protocole de choix pour la livraison d&#39;applications Web. Au lieu de stocker une application Web sur un seul serveur, les fichiers sont stockés sur IPFS et peuvent être récupérés à partir de n&#39;importe quel nœud IPFS.</p>
</div>
<div class="paragraph data-line-79">
<p>Plus d&#39;informations sur IPFS peuvent être trouvées sur <a href="https://ipfs.io" class="undefined" data-href="https://ipfs.io">https://ipfs.io</a>.</p>
</div>
</div>
<div class="sect4 data-line-83">
<h5 id="swarm_sec">Swarm</h5>
<div class="paragraph data-line-85">
<p>Swarm est un autre système de stockage P2P adressable par le contenu , similaire à IPFS. Swarm a été créé par la Fondation Ethereum, dans le cadre de la suite d&#39;outils Go-Ethereum. Comme IPFS, il vous permet de stocker des fichiers qui sont diffusés et répliqués par les nœuds Swarm. Vous pouvez accéder à n&#39;importe quel fichier Swarm en y faisant référence par un hachage. Swarm vous permet d&#39;accéder à un site Web à partir d&#39;un système P2P décentralisé, au lieu d&#39;un serveur Web central.</p>
</div>
<div class="paragraph data-line-87">
<p>La page d&#39;accueil de Swarm est elle-même stockée sur Swarm et accessible sur votre nœud Swarm ou une passerelle :
<a href="https://swarm-gateways.net/bzz:/theswarm.eth/" class="undefined" data-href="https://swarm-gateways.net/bzz:/theswarm.eth/">https://swarm-gateways.net/bzz:/theswarm.eth/</a>.</p>
</div>
</div>
</div>
<div class="sect3 data-line-92">
<h4 id="interdapp_coammunications_protocol_sec">Protocoles de communication de messages décentralisés</h4>
<div class="paragraph data-line-94">
<p>Un autre composant majeur de toute application est la communication inter-processus. Cela signifie pouvoir échanger des messages entre applications, entre différentes instances de l&#39;application ou entre utilisateurs de l&#39;application. Traditionnellement, cela est réalisé en s&#39;appuyant sur un serveur centralisé. Cependant, il existe une variété d&#39;alternatives décentralisées aux protocoles basés sur serveur, offrant une messagerie sur un réseau P2P. Le protocole de messagerie P2P le plus notable pour les DApps est <a href="http://bit.ly/2CSls5h" data-href="http://bit.ly/2CSls5h"><em>Whisper</em></a>, qui fait partie de la suite d&#39;outils Go-Ethereum de la Fondation Ethereum.</p>
</div>
<div class="paragraph data-line-96">
<p>Le dernier aspect d&#39;une application qui peut être décentralisée est la résolution de noms. Nous examinerons de près le service de noms d&#39;Ethereum plus loin dans ce chapitre ; maintenant, cependant, montrons un exemple.</p>
</div>
</div>
</div>
<div class="sect2 data-line-99">
<h3 id="auction_dapp_intro">Un exemple de DApp de base : DApp d&#39;enchères</h3>
<div class="paragraph data-line-101">
<p>Dans cette section, nous allons commencer à construire un exemple de DApp, pour explorer les différents outils de décentralisation. Notre DApp mettra en place une enchère décentralisée.</p>
</div>
<div class="paragraph data-line-103">
<p>La DApp d&#39;enchères permet à un utilisateur d&#39;enregistrer un jeton &quot;acte&quot;, qui représente un actif unique, comme une maison, une voiture, une marque, etc. Une fois qu&#39;un jeton a été enregistré, la propriété du jeton est transférée à la DApp d&#39;enchères, ce qui lui permet d&#39;être mis en vente. Le DApp d&#39;enchères répertorie chacun des jetons enregistrés, permettant aux autres utilisateurs de placer des offres. Au cours de chaque enchère, les utilisateurs peuvent rejoindre une salle de discussion créée spécifiquement pour cette enchère. Une fois qu&#39;une enchère est finalisée, la propriété du jeton d&#39;acte est transférée au gagnant de l&#39;enchère.</p>
</div>
<div class="paragraph data-line-105">
<p>Le processus global d&#39;enchères peut être vu dans <a href="#auction_dapp_overview">Auction DApp : un exemple simple de DApp d&#39;enchères</a>.</p>
</div>
<div class="paragraph data-line-107">
<p>Les principaux composants de notre DApp d&#8217;enchères sont :</p>
</div>
<div class="ulist data-line-109">
<ul>
<li class="data-line-109">
<p>Un contrat intelligent implémentant des jetons &quot;acte&quot; non fongibles ERC721 (<code><span class="keep-together">DeedRepository</span></code>)</p>
</li>
<li class="data-line-110">
<p>Un contrat intelligent mettant en place une enchère (AuctionRepository) pour vendre les actes</p>
</li>
<li class="data-line-111">
<p>Une interface web utilisant le cadre de développement JavaScript Vue/Vuetify</p>
</li>
<li class="data-line-112">
<p>La bibliothèque <em>web3.js</em> pour se connecter aux chaînes Ethereum (via MetaMask ou d&#39;autres clients)</p>
</li>
<li class="data-line-113">
<p>Un client Swarm, pour stocker des ressources telles que des images</p>
</li>
<li class="data-line-114">
<p>Un client Whisper, pour créer des salons de discussion par enchère pour tous les participants</p>
</li>
</ul>
</div>
<div id="auction_dapp_overview" class="imageblock data-line-118">
<div class="content">
<img src="images/auction_diagram.png" alt="&quot;DApp d&#39;enchères : un exemple simple de DApp d&#39;enchères&quot;">
</div>
<div class="title">Figure 42. Auction DApp : un exemple simple de DApp d&#39;enchères</div>
</div>
<div class="paragraph data-line-120">
<p>Vous pouvez trouver le code source de la DApp d&#39;enchères <a href="http://bit.ly/2DcmjyA" data-href="http://bit.ly/2DcmjyA">dans le référentiel du livre</a>.</p>
</div>
<div class="sect3 data-line-123">
<h4 id="_dapp_denchères_contrats_intelligents_dorsaux">DApp d&#39;enchères : contrats intelligents dorsaux</h4>
<div class="paragraph data-line-125">
<p> Notre exemple Auction DApp est pris en charge par deux contrats intelligents que nous devons déployer sur une chaîne de blocs Ethereum afin de prendre en charge l&#39;application : <code><span class="keep-together">AuctionRepository</span></code> et DeedRepository.</p>
</div>
<div class="paragraph data-line-127">
<p>Commençons par regarder DeedRepository, montré dans <a href="#deed_repository_code">DeedRepository.sol : un jeton d&#39;acte ERC721 à utiliser dans une vente aux enchères</a>. Ce contrat est un jeton non fongible compatible ERC721 (voir <a href="#erc721">ERC721 : norme de jeton non fongible (acte)</a>).</p>
</div>
<div id="deed_repository_code" class="exampleblock data-line-131">
<div class="title">Example 24. DeedRepository.sol : un jeton d&#39;acte ERC721 à utiliser dans une vente aux enchères</div>
<div class="content">
<div class="listingblock data-line-133">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.5.16;
import "./ERC721/ERC721Token.sol";

/**
 * @title Repository of ERC721 Deeds
 * This contract contains the list of deeds registered by users.
 * This is a demo to show how tokens (deeds) can be minted and added 
 * to the repository.
 */
contract DeedRepository is ERC721Token {


    /**
    * @dev Created a DeedRepository with a name and symbol
    * @param _name string represents the name of the repository
    * @param _symbol string represents the symbol of the repository
    */
    constructor(string memory _name, string memory _symbol) 
        public ERC721Token(_name, _symbol) {}
    
    /**
    * @dev Public function to register a new deed
    * @dev Call the ERC721Token minter
    * @param _tokenId uint256 represents a specific deed
    * @param _uri string containing metadata/uri
    */
    function registerDeed(uint256 _tokenId, string memory _uri) public {
        _mint(msg.sender, _tokenId);
        addDeedMetadata(_tokenId, _uri);
        emit DeedRegistered(msg.sender, _tokenId);
    }

    /**
    * @dev Public function to add metadata to a deed
    * @param _tokenId represents a specific deed
    * @param _uri text which describes the characteristics of a given deed
    * @return whether the deed metadata was added to the repository
    */
    function addDeedMetadata(uint256 _tokenId, string memory _uri) public returns(bool){
        _setTokenURI(_tokenId, _uri);
        return true;
    }

    /**
    * @dev Event is triggered if deed/token is registered
    * @param _by address of the registrar
    * @param _tokenId uint256 represents a specific deed
    */
    event DeedRegistered(address _by, uint256 _tokenId);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-138">
<p>Comme vous pouvez le constater, le contrat DeedRepository est une implémentation simple d&#39;un jeton compatible ERC721.</p>
</div>
<div class="paragraph data-line-140">
<p>Notre DApp d&#8217;enchères utilise le contrat DeedRepository pour émettre et suivre les jetons pour chaque enchère. L&#39;enchère elle-même est orchestrée par le contrat AuctionRepository. Ce contrat est trop long pour être inclus ici dans son intégralité, mais <a href="#auction_repository_code">AuctionRepository.sol : le principal contrat intelligent Auction DApp</a> montre la définition principale du contrat et des structures de données. L&#39;intégralité du contrat est disponible dans le <a href="https://bit.ly/2IaOo9i" data-href="https://bit.ly/2IaOo9i">référentiel GitHub</a> du livre.</p>
</div>
<div id="auction_repository_code" class="exampleblock data-line-144">
<div class="title">Example 25. AuctionRepository.sol : le principal contrat intelligent Auction DApp</div>
<div class="content">
<div class="listingblock data-line-146">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract AuctionRepository {

    // Tableau avec toutes les enchères
    Auction[] public auctions;

    // Mappage de l&amp;#39;index d&amp;#39;enchères aux offres des utilisateurs
    mapping(uint256 =&gt; Bid[]) public auctionBids;

    // Mappage du propriétaire à une liste d&amp;#39;enchères détenues
    mapping(address =&gt; uint[]) public auctionOwner;

    // Structure d&amp;#39;enchère pour retenir l&amp;#39;enchérisseur et le montant
    struct Bid {
        address from;
        uint256 amount;
    }

    // Structure d&amp;#39;enchère contenant toutes les informations requises
    struct Auction {
        string name;
        uint256 blockDeadline;
        uint256 startPrice;
        string metadata;
        uint256 deedId;
        address deedRepositoryAddress;
        address owner;
        bool active;
        bool finalized;
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-179">
<p>Le contrat AuctionRepository gère toutes les enchères avec les fonctions suivantes :</p>
</div>
<div class="listingblock data-line-182">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">getCount()
getBidsCount(uint _auctionId)
getAuctionsOf(address _owner)
getCurrentBid(uint _auctionId)
getAuctionsCountOfOwner(address _owner)
getAuctionById(uint _auctionId)
createAuction(address _deedRepositoryAddress, uint256 _deedId,
              string _auctionTitle, string _metadata, uint256 _startPrice,
              uint _blockDeadline)
approveAndTransfer(address _from, address _to, address _deedRepositoryAddress,
                   uint256 _deedId)
cancelAuction(uint _auctionId)
finalizeAuction(uint _auctionId)
bidOnAuction(uint _auctionId)</code></pre>
</div>
</div>
<div class="paragraph data-line-199">
<p>Vous pouvez déployer ces contrats sur la chaîne de blocs Ethereum de votre choix (par exemple, Ropsten) en utilisant truffle dans le référentiel du livre :</p>
</div>
<pre data-type="programlisting">
$ <strong>cd code/auction_dapp/backend</strong>
$ <strong>truffle init</strong>
$ <strong>truffle compile</strong>
$ <strong>truffle migrate --network ropsten</strong>

</pre>
<div class="sect4 data-line-211">
<h5 id="_dapp_de_gouvernance">DApp de gouvernance</h5>
<div class="paragraph data-line-213">
<p>Si vous lisez les deux contrats intelligents de la DApp d&#39;enchères, vous remarquerez quelque chose d&#39;important : il n&#39;y a pas de compte ou de rôle spécial qui dispose de privilèges spéciaux sur la DApp. Chaque enchère a un propriétaire avec des capacités spéciales, mais la DApp d&#39;enchères elle-même n&#39;a pas d&#39;utilisateur privilégié.</p>
</div>
<div class="paragraph data-line-215">
<p>Il s&#39;agit d&#39;un choix délibéré de décentraliser la gouvernance de la DApp et de renoncer à tout contrôle une fois celle-ci déployée. Certains DApp, en comparaison, ont un ou plusieurs comptes privilégiés avec des capacités spéciales, telles que la possibilité de résilier le contrat DApp, de remplacer ou de modifier sa configuration, ou d&#39;opposer son veto à certaines opérations. Habituellement, ces fonctions de gouvernance sont introduites dans la DApp afin d&#39;éviter des problèmes inconnus qui pourraient survenir en raison d&#39;un bogue.</p>
</div>
<div class="paragraph data-line-217">
<p>La question de la gouvernance est particulièrement difficile à résoudre car elle représente une arme à double tranchant. D&#39;un côté, les comptes privilégiés sont dangereux ; s&#39;ils sont compromis, ils peuvent compromettre la sécurité du DApp. De l&#39;autre côté, sans compte privilégié, il n&#39;y a pas d&#39;options de récupération si un bogue est trouvé. Nous avons vu ces deux risques se manifester dans les DApp Ethereum. Dans le cas de The DAO (<a href="#real_world_example_the_dao">Exemple concret : le DAO</a> et <a href="#ethereum_fork_history">Historique de la fourche Ethereum</a>), il y avait des comptes privilégiés appelés les &quot;conservateurs&quot;, mais ils étaient très limités dans leurs capacités. Ces comptes n&#39;ont pas pu annuler le retrait des fonds par l&#39;attaquant DAO. Dans un cas plus récent, l&#39;échange décentralisé Bancor a subi un vol massif parce qu&#39;un compte de gestion privilégié a été compromis. Il s&#39;avère que Bancor n&#39;était pas aussi décentralisé qu&#39;on le supposait initialement.</p>
</div>
<div class="paragraph data-line-219">
<p>Lors de la construction d&#39;une DApp, vous devez décider si vous voulez rendre les contrats intelligents vraiment indépendants, les lancer et n&#39;avoir ensuite aucun contrôle, ou créer des comptes privilégiés et courir le risque que ceux-ci soient compromis. L&#39;un ou l&#39;autre choix comporte des risques, mais à long terme, les vraies DApps ne peuvent pas avoir un accès spécialisé pour les comptes privilégiés - ce n&#39;est pas décentralisé.</p>
</div>
</div>
</div>
<div class="sect3 data-line-221">
<h4 id="_dapp_denchères_interface_utilisateur_frontale">DApp d&#39;enchères : interface utilisateur frontale</h4>
<div class="paragraph data-line-223">
<p>Une fois les contrats de la DApp d&#39;enchères déployés, vous pouvez interagir avec eux à l&#39;aide de votre console JavaScript préférée et de web3.js, ou d&#39;une autre bibliothèque web3. Cependant, la plupart des utilisateurs auront besoin d&#39;une interface facile à utiliser. Notre interface utilisateur de la DApp d&#8217;enchères est construite à l&#39;aide du cadre de développement (framework) JavaScript Vue2/Vuetify de Google.</p>
</div>
<div class="paragraph data-line-225">
<p>Vous pouvez trouver le code de l&#39;interface utilisateur dans le dossier <em>code/auction_dapp/frontend</em> dans <a href="https://github.com/ethereumbook/ethereumbook" class="undefined" data-href="https://github.com/ethereumbook/ethereumbook">https://github.com/ethereumbook/ethereumbook</a> [le référentiel du livre]. Le répertoire a la structure et le contenu suivants :</p>
</div>
<div class="listingblock data-line-227">
<div class="content">
<pre>frontend/
|-- build
|   |-- build.js
|   |-- check-versions.js
|   |-- logo.png
|   |-- utils.js
|   |-- vue-loader.conf.js
|   |-- webpack.base.conf.js
|   |-- webpack.dev.conf.js
|   `-- webpack.prod.conf.js
|-- config
|   |-- dev.env.js
|   |-- index.js
|   `-- prod.env.js
|-- index.html
|-- package.json
|-- package-lock.json
|-- README.md
|-- src
|   |-- App.vue
|   |-- components
|   |   |-- Auction.vue
|   |   `-- Home.vue
|   |-- config.js
|   |-- contracts
|   |   |-- AuctionRepository.json
|   |   `-- DeedRepository.json
|   |-- main.js
|   |-- models
|   |   |-- AuctionRepository.js
|   |   |-- ChatRoom.js
|   |   `-- DeedRepository.js
|   `-- router
|       `-- index.js</pre>
</div>
</div>
<div class="paragraph data-line-264">
<p>Une fois que vous avez déployé les contrats, modifiez la configuration du frontend dans <em>frontend/src/config.js</em> et entrez les adresses des contrats DeedRepository et AuctionRepository, tels que déployés. L&#39;application frontale a également besoin d&#39;accéder à un nœud Ethereum offrant une interface JSON-RPC et WebSockets. Une fois que vous avez configuré l&#39;interface, lancez-la avec un serveur Web sur votre machine locale :</p>
</div>
<pre data-type="programlisting">
$ <strong>npm install</strong>
$ <strong>npm run dev</strong>

</pre>
<div class="paragraph data-line-274">
<p>L&#39;interface Auction DApp sera lancée et sera accessible via n&#39;importe quel navigateur Web à l&#39;adresse <a href="http://localhost:8080" class="undefined" data-href="http://localhost:8080">http://localhost:8080</a>.</p>
</div>
<div class="paragraph data-line-276">
<p>Si tout se passe bien, vous devriez voir l&#39;écran affiché dans <a href="#auction_dapp_screen">Interface utilisateur de la DApp d&#8217;enchères</a>, qui illustre l&#39;exécution de la DApp d&#39;enchères dans un navigateur Web.</p>
</div>
<div id="auction_dapp_screen" class="imageblock data-line-280">
<div class="content">
<img src="images/auction_dapp_home_screen.png" alt="&quot;Interface utilisateur de la DApp d&#39;enchères&quot;">
</div>
<div class="title">Figure 43. Interface utilisateur de la DApp d&#8217;enchères</div>
</div>
</div>
</div>
<div class="sect2 data-line-282">
<h3 id="_décentraliser_davantage_la_dapp_denchères">Décentraliser davantage la DApp d&#39;enchères</h3>
<div class="paragraph data-line-284">
<p>Notre DApp est déjà assez décentralisé, mais nous pouvons améliorer les choses.</p>
</div>
<div class="paragraph data-line-286">
<p>Le contrat AuctionRepository fonctionne indépendamment de tout contrôle, ouvert à tous. Une fois déployé, il ne peut pas être arrêté, et aucune enchère ne peut être contrôlée. Chaque enchère a une salle de chat séparée qui permet à quiconque de communiquer sur l&#39;enchère sans censure ni identification. Les différents actifs d&#39;enchères, tels que la description et l&#39;image associée, sont stockés sur Swarm, ce qui les rend difficiles à censurer ou à bloquer.</p>
</div>
<div class="paragraph data-line-288">
<p>N&#39;importe qui peut interagir avec la DApp en créant des transactions manuellement ou en exécutant l&#39;interface Vue sur sa machine locale. Le code de la DApp lui-même est à source libre et développé en collaboration sur un référentiel public.</p>
</div>
<div class="paragraph data-line-290">
<p>Il y a deux choses que nous pouvons faire pour rendre cette DApp décentralisée et résiliente :</p>
</div>
<div class="ulist data-line-292">
<ul>
<li class="data-line-292">
<p>Stockez tout le code d&#39;application sur Swarm ou IPFS.</p>
</li>
<li class="data-line-293">
<p>Accédez au DApp par référence à un nom, en utilisant le service de nom Ethereum.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-295">
<p>Nous explorerons la première option dans la section suivante, et nous approfondirons la seconde dans <a href="#ethereum_naming_system_ens">Le service de noms Ethereum (ENS)</a>.</p>
</div>
</div>
<div class="sect2 data-line-297">
<h3 id="_stockage_de_la_dapp_denchères_sur_swarm">Stockage de la DApp d&#39;enchères sur Swarm</h3>
<div class="paragraph data-line-299">
<p>Nous avons introduit Swarm dans <a href="#swarm_sec">Swarm</a>, plus haut dans ce chapitre. Notre DApp d&#8217;enchères utilise déjà Swarm pour stocker l&#39;image de l&#39;icône pour chaque enchère. C&#39;est une solution beaucoup plus efficace que de tenter de stocker des données sur Ethereum, ce qui coûte cher. Il est également beaucoup plus résistant que si ces images étaient stockées dans un service centralisé comme un serveur Web ou un serveur de fichiers.</p>
</div>
<div class="paragraph data-line-301">
<p>Mais on peut aller plus loin. Nous pouvons stocker l&#39;intégralité de l&#39;interface du DApp lui-même dans Swarm et l&#39;exécuter directement à partir d&#39;un nœud Swarm, au lieu d&#39;exécuter un serveur Web.</p>
</div>
<div class="sect3 data-line-303">
<h4 id="_préparation_de_swarm">Préparation de Swarm</h4>
<div class="paragraph data-line-305">
<p>Pour commencer, vous devez installer Swarm et initialiser votre nœud Swarm. Swarm fait partie de la suite d&#39;outils Go-Ethereum de la Fondation Ethereum. Reportez-vous aux instructions d&#39;installation de Go-Ethereum dans <a href="#go_ethereum_geth">Go-Ethereum (Geth)</a>, ou pour installer une version binaire Swarm, suivez les instructions de la <a href="http://bit.ly/2Q75KXw" data-href="http://bit.ly/2Q75KXw">documentation Swarm</a>.</p>
</div>
<div class="paragraph data-line-307">
<p>Une fois que vous avez installé Swarm, vous pouvez vérifier qu&#39;il fonctionne correctement en le lançant avec la commande version :</p>
</div>
<pre data-type="programlisting">
$ <strong>swarm version</strong>
Version: 0.3
Git Commit: 37685930d953bcbe023f9bc65b135a8d8b8f1488
Go Version: go1.10.1
OS: linux

</pre>
<div class="paragraph data-line-320">
<p>Pour commencer à exécuter Swarm, vous devez lui dire comment se connecter à une instance de Geth, pour accéder à l&#39;API JSON-RPC. Commencez en suivant les instructions du <a href="https://swarm-guide.readthedocs.io/en/latest/gettingstarted.html" data-href="https://swarm-guide.readthedocs.io/en/latest/gettingstarted.html">Guide de démarrage</a>.</p>
</div>
<div class="paragraph data-line-322">
<p>Lorsque vous démarrez Swarm, vous devriez voir quelque chose comme ceci :</p>
</div>
<div class="listingblock data-line-324">
<div class="content">
<pre>Maximum peer count                       ETH=25 LES=0 total=25
Starting peer-to-peer node               instance=swarm/v0.3.1-225171a4/linux...
connecting to ENS API                    url=http://127.0.0.1:8545
swarm[5955]: [189B blob data]
Starting P2P networking
UDP listener up                          self=enode://f50c8e19ff841bcd5ce7d2d...
Updated bzz local addr                   oaddr=9c40be8b83e648d50f40ad3... uaddr=e
Starting Swarm service
9c40be8b hive starting
detected an existing store. trying to load peers
hive 9c40be8b: peers loaded
Swarm network started on bzz address: 9c40be8b83e648d50f40ad3d35f...
Pss started
Streamer started
IPC endpoint opened                      url=/home/ubuntu/.ethereum/bzzd.ipc
RLPx listener up                         self=enode://f50c8e19ff841bcd5ce7d2d...</pre>
</div>
</div>
<div class="paragraph data-line-343">
<p>Vous pouvez vérifier que votre nœud Swarm fonctionne correctement en vous connectant à l&#39;interface Web de la passerelle Swarm locale :
<a href="http://localhost:8500" class="undefined" data-href="http://localhost:8500">http://localhost:8500</a>.</p>
</div>
<div class="paragraph data-line-346">
<p>Vous devriez voir un écran comme celui de <a href="#image_swarm_gateway">Passerelle Swarm sur localhost</a> et pouvoir interroger n&#39;importe quel hachage Swarm ou nom ENS.</p>
</div>
<div id="image_swarm_gateway" class="imageblock data-line-350">
<div class="content">
<img src="images/swarm-gateway.png" alt="&quot;Passerelle Swarm sur localhost&quot;">
</div>
<div class="title">Figure 44. Passerelle Swarm sur localhost</div>
</div>
</div>
<div class="sect3 data-line-352">
<h4 id="_télécharger_des_fichiers_sur_swarm">Télécharger des fichiers sur Swarm</h4>
<div class="paragraph data-line-354">
<p>Une fois que votre nœud et votre passerelle Swarm locaux sont en cours d&#39;exécution, vous pouvez télécharger vers Swarm et les fichiers seront accessible sur n&#39;importe quel nœud Swarm, simplement par référence au hachage du fichier.</p>
</div>
<div class="paragraph data-line-356">
<p>Testons cela en téléchargeant un fichier :</p>
</div>
<pre data-type="programlisting">
$ <strong>swarm up code/auction_dapp/README.md</strong>
ec13042c83ffc2fb5cb0aa8c53f770d36c9b3b35d0468a0c0a77c97016bb8d7c

</pre>
<div class="paragraph data-line-366">
<p>Swarm a téléchargé le fichier <em>README.md</em> et renvoyé un hachage que vous pouvez utiliser pour accéder au fichier à partir de n&#39;importe quel nœud Swarm. Par exemple, vous pouvez utiliser la <a href="https://bit.ly/2znWUP9" class="undefined" data-href="https://bit.ly/2znWUP9">https://bit.ly/2znWUP9</a> [passerelle Swarm publique].</p>
</div>
<div class="paragraph data-line-368">
<p>Bien que le téléchargement d&#39;un fichier soit relativement simple, il est un peu plus complexe de télécharger une interface DApp entière. En effet, les différentes ressources DApp (HTML, CSS, JavaScript, bibliothèques, etc.) ont des références intégrées les unes aux autres. Normalement, un serveur Web traduit les URL en fichiers locaux et fournit les bonnes ressources. Nous pouvons obtenir la même chose pour Swarm en empaquetant notre DApp.</p>
</div>
<div class="paragraph data-line-370">
<p>Dans la DApp d&#8217;enchères, il existe un script pour regrouper toutes les ressources :</p>
</div>
<pre data-type="programlisting">
$ <strong>cd code/auction_dapp/frontend</strong>
$ <strong>npm run build</strong>

> <strong>frontend@1.0.0 build /home/aantonop/Dev/ethereumbook/code/auction_dapp/frontend</strong>
> <strong>node build/build.js</strong>

Hash: 9ee134d8db3c44dd574d
Version: webpack 3.10.0
Time: 25665ms
Asset     Size
static/js/vendor.77913f316aaf102cec11.js  1.25 MB
static/js/app.5396ead17892922422d4.js   502 kB
static/js/manifest.87447dd4f5e60a5f9652.js  1.54 kB
static/css/app.0e50d6a1d2b1ed4daa03d306ced779cc.css  1.13 kB
static/css/app.0e50d6a1d2b1ed4daa03d306ced779cc.css.map  2.54 kB
static/js/vendor.77913f316aaf102cec11.js.map  4.74 MB
static/js/app.5396ead17892922422d4.js.map   893 kB
static/js/manifest.87447dd4f5e60a5f9652.js.map  7.86 kB
index.html  1.15 kB

Build complete.

</pre>
<div class="paragraph data-line-399">
<p>Le résultat de cette commande sera un nouveau répertoire, <em>code/auction_dapp/frontend/dist</em>, qui contient l&#39;intégralité de l&#39;interface Auction DApp, regroupée :</p>
</div>
<div class="listingblock data-line-401">
<div class="content">
<pre>dist/
|-- index.html
`-- static
    |-- css
    |   |-- app.0e50d6a1d2b1ed4daa03d306ced779cc.css
    |   `-- app.0e50d6a1d2b1ed4daa03d306ced779cc.css.map
    `-- js
        |-- app.5396ead17892922422d4.js
        |-- app.5396ead17892922422d4.js.map
        |-- manifest.87447dd4f5e60a5f9652.js
        |-- manifest.87447dd4f5e60a5f9652.js.map
        |-- vendor.77913f316aaf102cec11.js
        `-- vendor.77913f316aaf102cec11.js.map</pre>
</div>
</div>
<div class="paragraph data-line-418">
<p>Vous pouvez maintenant télécharger l&#39;intégralité du DApp sur Swarm, en utilisant la commande up et l&#39;option --recursive. Ici, nous disons également à Swarm que index.html est le defaultpath pour charger cette DApp :</p>
</div>
<pre data-type="programlisting">
$ <strong>swarm --bzzapi http://localhost:8500 --recursive \
  --defaultpath dist/index.html up dist/</strong>

ab164cf37dc10647e43a233486cdeffa8334b026e32a480dd9cbd020c12d4581

</pre>
<div class="paragraph data-line-430">
<p>Désormais, l&#39;intégralité de notre DApp d&#8217;enchères est hébergée sur Swarm et accessible par l&#39;URL Swarm :</p>
</div>
<ul class="simplelist">
<li><em>bzz://ab164cf37dc10647e43a233486cdeffa8334b026e32a480dd9cbd020c12d4581</em></li>
</ul>
<div class="paragraph data-line-438">
<p>Nous avons fait quelques progrès dans la décentralisation de notre DApp, mais nous l&#39;avons rendu plus difficile à utiliser. Une URL comme celle-là est beaucoup moins conviviale qu&#39;un joli nom comme <em>auction_dapp.com</em>. Sommes-nous obligés de sacrifier l&#39;utilisabilité pour gagner en décentralisation ? Pas nécessairement. Dans la section suivante, nous examinerons le service de noms d&#39;Ethereum, qui nous permet d&#39;utiliser des noms faciles à lire tout en préservant la nature décentralisée de notre application.(range=&quot;endofrange&quot;, startref=&quot;ix_12dapps-asciidoc7&quot; )</p>
</div>
</div>
</div>
<div class="sect2 data-line-441">
<h3 id="ethereum_naming_system_ens">Le service de noms Ethereum (ENS)</h3>
<div class="paragraph data-line-443">
<p>Vous pouvez concevoir le meilleur contrat intelligent au monde , mais si vous ne fournissez pas une bonne interface aux utilisateurs, ils ne pourront pas y accéder.</p>
</div>
<div class="paragraph data-line-445">
<p>Sur Internet traditionnel, le système de noms de domaine (DNS) nous permet d&#39;utiliser des noms lisibles par l&#39;homme dans le navigateur tout en résolvant ces noms en adresses IP ou autres identifiants dans les coulisses. Sur la blockchain Ethereum, le <em>Ethereum Naming System</em> (ENS) résout le même problème, mais de manière décentralisée.</p>
</div>
<div class="paragraph data-line-447">
<p>Par exemple, l&#39;adresse de don de la Fondation Ethereum est 0xfB6916095ca1df60bB79Ce92cE3Ea74c37c5d359 ; dans un portefeuille qui prend en charge ENS, c&#39;est simplement ethereum.eth.</p>
</div>
<div class="paragraph data-line-449">
<p>ENS est plus qu&#39;un contrat intelligent ; c&#39;est une DApp fondamentale en elle-même, offrant un service de noms décentralisé. En outre, ENS est pris en charge par un certain nombre de DApps pour l&#39;enregistrement, la gestion et les enchères de noms enregistrés. ENS démontre comment les DApps peuvent fonctionner ensemble : c&#39;est une DApp conçue pour servir d&#39;autres DApps, prise en charge par un écosystème de DApps, intégrée dans d&#39;autres DApps, etc.</p>
</div>
<div class="paragraph data-line-451">
<p>Dans cette section, nous verrons comment fonctionne ENS. Nous montrerons comment vous pouvez configurer votre propre nom et le lier à un portefeuille ou à une adresse Ethereum, comment vous pouvez intégrer ENS dans un autre DApp et comment vous pouvez utiliser ENS pour nommer vos ressources DApp afin de les rendre plus faciles à utiliser.</p>
</div>
<div class="sect3 data-line-453">
<h4 id="_histoire_des_services_de_noms_ethereum">Histoire des services de noms Ethereum</h4>
<div class="paragraph data-line-455">
<p> L&#39;enregistrement de noms a été la première application non monétaire des chaînes de blocs, lancée par Namecoin. L&#39;Ethereum <a href="http://bit.ly/2Of1gfZ" class="undefined" data-href="http://bit.ly/2Of1gfZ">http://bit.ly/2Of1gfZ</a> [White Paper] a donné un système d&#39;enregistrement de type Namecoin à deux lignes comme l&#39;un de ses exemples d&#39;applications.</p>
</div>
<div class="paragraph data-line-457">
<p>Les premières versions de Geth et du client C++ Ethereum avaient un contrat namereg intégré (qui n&#39;est plus utilisé), et de nombreuses propositions et ERC pour les services de noms ont été faites, mais ce n&#39;est que lorsque Nick Johnson a commencé à travailler pour la Fondation Ethereum en 2016. et a pris le projet sous son aile que le travail sérieux sur un registraire a commencé.</p>
</div>
<div class="paragraph data-line-459">
<p>ENS a été lancé le Star Wars Day, le 4 mai 2017 (après une tentative infructueuse de le lancer le Pi Day, le 15 mars).</p>
</div>
</div>
<div class="sect3 data-line-461">
<h4 id="_la_spécification_ens">La spécification ENS</h4>
<div class="paragraph data-line-463">
<p>ENS est spécifié principalement dans trois propositions d&#39;amélioration d&#39;Ethereum : EIP-137, qui spécifie les fonctions de base d&#39;ENS ; EIP-162, qui décrit le système d&#39;enchères pour la racine .eth ; et EIP-181, qui spécifie la résolution inverse des adresses.</p>
</div>
<div class="paragraph data-line-465">
<p>ENS suit une philosophie de conception &quot;sandwich&quot;: une couche très simple en bas, suivie de couches de code plus complexes mais remplaçables, avec une couche supérieure très simple qui conserve tous les fonds dans des comptes séparés.</p>
</div>
</div>
<div class="sect3 data-line-467">
<h4 id="_couche_inférieure_nommez_les_propriétaires_et_les_résolveurs">Couche inférieure : nommez les propriétaires et les résolveurs</h4>
<div class="paragraph data-line-469">
<p>L&#39;ENS fonctionne sur des &quot;nœuds&quot; au lieu de noms lisibles par l&#39;homme : un nom lisible par l&#39;homme est converti en nœud à l&#39;aide de l&#39;algorithme &quot;Namehash&quot;.</p>
</div>
<div class="paragraph data-line-471">
<p>La couche de base d&#39;ENS est un contrat astucieusement simple (moins de 50 lignes de code) défini par ERC137 qui permet uniquement aux propriétaires de nœuds de définir des informations sur leurs noms et de créer des sous-nœuds (l&#39;équivalent ENS des sous-domaines DNS).</p>
</div>
<div class="paragraph data-line-473">
<p>Les seules fonctions sur la couche de base sont celles qui permettent à un propriétaire de nœud de définir des informations sur son propre nœud (en particulier le résolveur, la durée de vie ou le transfert de propriété) et de créer des propriétaires de nouveaux sous-nœuds.</p>
</div>
<div class="sect4 data-line-475">
<h5 id="_lalgorithme_namehash">L&#39;algorithme Namehash</h5>
<div class="paragraph data-line-477">
<p>Namehash est un algorithme récursif qui peut convertir n&#39;importe quel nom en un hachage qui identifie le nom.</p>
</div>
<div class="paragraph data-line-479">
<p>&quot;Récursif&quot; signifie que nous résolvons le problème en résolvant un sous-problème qui est un problème plus petit du même type, puis utilisons la solution du sous-problème pour résoudre le problème d&#39;origine.</p>
</div>
<div class="paragraph data-line-481">
<p>Namehash hache de manière récursive les composants du nom, produisant une chaîne unique de longueur fixe (ou &quot;nœud&quot;) pour tout domaine d&#39;entrée valide. Par exemple, le nœud Namehash de subdomain.example.eth est `keccak(&#39;&lt;example.eth&gt; &#39; nœud) + keccak(&#39;&lt;subdomain&gt;&#39;)&#39;. Le sous-problème que nous devons résoudre est de calculer le nœud pour example.eth, qui est `keccak(&#39;&lt;.eth&gt;&#39; node) + keccak(&#39;&lt;example&gt;&#39;)&#39;. Pour commencer, nous devons calculer le nœud pour eth, qui est `keccak(&lt;root node&gt;) + keccak(&#39;&lt;eth&gt;&#39;)&#39;.</p>
</div>
<div class="paragraph data-line-483">
<p>Le nœud racine est ce que nous appelons le &quot;cas de base&quot; de notre récursivité, et nous ne pouvons évidemment pas le définir de manière récursive, sinon l&#39;algorithme ne se terminera jamais ! Le nœud racine est défini comme <code>0x00000000000000000000000000000000000000000000000000000000000</code> (32 zéro octets).</p>
</div>
<div class="paragraph data-line-485">
<p>En mettant tout cela ensemble, le nœud de subdomain.example.eth est donc <code><span class="keep-together">keccak</span>(keccak(keccak(0x0...0 + keccak(&#39;eth&#39;)) + keccak(&#39;example&#39;)) + keccak(&#39;subdomain&#39;))</code>.</p>
</div>
<div class="paragraph data-line-487">
<p>En généralisant, nous pouvons définir la fonction Namehash comme suit (le cas de base pour le nœud racine, ou nom vide, suivi de l&#39;étape récursive) :</p>
</div>
<div class="literalblock data-line-489">
<div class="content">
<pre>namehash([]) = 0x0000000000000000000000000000000000000000000000000000000000000000
namehash([label, ...]) = keccak256(namehash(...) + keccak256(label))</pre>
</div>
</div>
<div class="paragraph data-line-494">
<p>En Python cela devient :</p>
</div>
<div class="literalblock data-line-496">
<div class="content">
<pre>def namehash(name):
  if name == '':
    return '\0' * 32
  else:
    label, _, remainder = name.partition('.')
    return sha3(namehash(remainder) + sha3(label))</pre>
</div>
</div>
<div class="paragraph data-line-505">
<p>Thus, mastering-ethereum.eth will be processed as follows:</p>
</div>
<div class="literalblock data-line-507">
<div class="content">
<pre>namehash('mastering-ethereum.eth')
⇒ sha3(namehash('eth') + sha3('mastering-ethereum'))
⇒ sha3(sha3(namehash('') + sha3('eth')) + sha3('mastering-ethereum'))
⇒ sha3(sha3(('\0' * 32) + sha3('eth')) + sha3('mastering-ethereum'))</pre>
</div>
</div>
<div class="paragraph data-line-514">
<p>Bien sûr, les sous-domaines peuvent eux-mêmes avoir des sous-domaines : il peut y avoir un sub.subdomain.example.eth après subdomain.example.eth, puis un sub.sub.subdomain.example.eth, et ainsi de suite. Pour éviter un recalcul coûteux, puisque Namehash ne dépend que du nom lui-même, le nœud d&#39;un nom donné peut être précalculé et inséré dans un contrat, éliminant ainsi le besoin de manipulation de chaîne et permettant une recherche immédiate des enregistrements ENS quel que soit le nombre de composants dans le nom brut.</p>
</div>
</div>
<div class="sect4 data-line-516">
<h5 id="_comment_choisir_un_nom_valide">Comment choisir un nom valide</h5>
<div class="paragraph data-line-517">
<p>Les noms consistent en une série d&#39;étiquettes séparées par des points. Bien que les lettres majuscules et minuscules soient autorisées, toutes les étiquettes doivent suivre un processus de normalisation UTS #46 qui plie les étiquettes avant de les hacher, de sorte que les noms avec une casse différente mais une orthographe identique se retrouveront avec le même Namehash.</p>
</div>
<div class="paragraph data-line-519">
<p>Vous pouvez utiliser des étiquettes et des domaines de n&#39;importe quelle longueur, mais pour des raisons de compatibilité avec l&#39;ancien DNS, les règles suivantes sont recommandées :</p>
</div>
<div class="ulist data-line-521">
<ul>
<li class="data-line-521">
<p>Les libellés ne doivent pas comporter plus de 64 caractères chacun.</p>
</li>
<li class="data-line-522">
<p>Les noms ENS complets ne doivent pas dépasser 255 caractères.</p>
</li>
<li class="data-line-523">
<p>Les étiquettes (labels) ne doivent pas commencer ou se terminer par des traits d&#39;union, ni commencer par des chiffres.</p>
</li>
</ul>
</div>
</div>
<div class="sect4 data-line-525">
<h5 id="_propriété_du_nœud_racine">Propriété du nœud racine</h5>
<div class="paragraph data-line-527">
<p>L&#39;un des résultats de ce système hiérarchique est qu&#39;il s&#39;appuie sur les propriétaires du nœud racine, qui sont capables de créer des domaines de premier niveau (TLD).</p>
</div>
<div class="paragraph data-line-529">
<p>Alors que l&#39;objectif final est d&#39;adopter un processus décisionnel décentralisé pour les nouveaux TLD, au moment de la rédaction, le nœud racine est contrôlé par un multisig 4 sur 7, détenu par des personnes de différents pays (construit comme un reflet des 7 détenteurs de clés du système DNS).
En conséquence, une majorité d&#39;au moins 4 des 7 détenteurs de clés est requise pour effectuer tout changement.</p>
</div>
<div class="paragraph data-line-532">
<p>Actuellement, le but et l&#39;objectif de ces détenteurs de clés est de travailler en consensus avec la communauté pour :</p>
</div>
<div class="ulist data-line-534">
<ul>
<li class="data-line-534">
<p>Migrer et mettre à niveau la propriété temporaire du TLD .eth vers un contrat plus permanent une fois le système évalué.</p>
</li>
<li class="data-line-535">
<p>Autoriser l&#39;ajout de nouveaux TLD, si la communauté convient qu&#39;ils sont nécessaires.</p>
</li>
<li class="data-line-536">
<p>Migrer la propriété du multisig racine vers un contrat plus décentralisé, lorsqu&#39;un tel système est convenu, testé et mis en œuvre.</p>
</li>
<li class="data-line-537">
<p>Servir de moyen de dernier recours pour traiter les bogues ou les vulnérabilités dans les registres de niveau supérieur.</p>
</li>
</ul>
</div>
</div>
<div class="sect4 data-line-539">
<h5 id="_résolveurs">Résolveurs</h5>
<div class="paragraph data-line-541">
<p>Le contrat ENS de base ne peut pas ajouter de métadonnées aux noms ; c&#39;est le travail des soi-disant « contrats de résolveur ». Ce sont des contrats créés par l&#39;utilisateur qui peuvent répondre à des questions sur le nom, telles que l&#39;adresse Swarm associée à l&#39;application, l&#39;adresse qui reçoit les paiements à l&#39;application (en éther ou en jetons) ou le hachage de l&#39;application (pour vérifier son intégrité).</p>
</div>
</div>
</div>
<div class="sect3 data-line-543">
<h4 id="_couche_intermédiaire_les_nœuds_eth">Couche intermédiaire : les nœuds .eth</h4>
<div class="paragraph data-line-545">
<p>Au moment de la rédaction, le seul domaine de premier niveau pouvant être enregistré de manière unique dans un contrat intelligent est .eth.</p>
</div>
<div class="admonitionblock note data-line-548">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-549">
<p>Des travaux sont en cours pour permettre aux propriétaires de domaines DNS traditionnels de revendiquer la propriété ENS.
Bien qu&#39;en théorie cela puisse fonctionner pour .com, le seul domaine pour lequel cela a été implémenté jusqu&#39;à présent est <a href="http://bit.ly/2SwUuFC" data-href="http://bit.ly/2SwUuFC">.xyz, et uniquement sur le testnet de Ropsten</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-553">
<p>Les domaines .eth sont distribués via un système d&#39;enchères. Il n&#39;y a pas de liste réservée ni de priorité, et la seule façon d&#39;acquérir un nom est d&#39;utiliser le système. Le système d&#39;enchères est un morceau de code complexe (plus de 500 lignes) ; la plupart des premiers efforts de développement (et des bugs !) dans ENS concernaient cette partie du système. Cependant, il est également remplaçable et évolutif, sans risque pour les fonds - nous en reparlerons plus tard.</p>
</div>
<div class="sect4 data-line-556">
<h5 id="vickrey_auction">Enchères Vickrey</h5>
<div class="paragraph data-line-558">
<p>Les noms sont distribués via une enchère Vickrey modifiée. Dans une enchère Vickrey traditionnelle, chaque enchérisseur soumet une offre scellée, et tous sont révélés simultanément, auquel cas le plus offrant remporte l&#39;enchère mais ne paie que la deuxième offre la plus élevée. Par conséquent, les enchérisseurs sont incités à ne pas enchérir moins que la valeur réelle du nom pour eux, car enchérir sur leur valeur réelle augmente les chances qu&#39;ils gagnent mais n&#39;affecte pas le prix qu&#39;ils paieront finalement.</p>
</div>
<div class="paragraph data-line-560">
<p>Sur une chaîne de blocs, certains changements sont nécessaires :</p>
</div>
<div class="ulist data-line-562">
<ul>
<li class="data-line-562">
<p>Pour s&#39;assurer que les enchérisseurs ne soumettent pas d&#39;enchères qu&#39;ils n&#39;ont pas l&#39;intention de payer, ils doivent verrouiller au préalable une valeur égale ou supérieure à leur enchère, afin de garantir la validité de l&#39;enchère.</p>
</li>
<li class="data-line-563">
<p>Étant donné que vous ne pouvez pas cacher de secrets sur une chaîne de blocs, les enchérisseurs doivent exécuter au moins deux transactions (un processus de validation-révélation) afin de masquer la valeur et le nom d&#39;origine sur lesquels ils ont enchéri.</p>
</li>
<li class="data-line-564">
<p>Étant donné que vous ne pouvez pas révéler toutes les offres simultanément dans un système décentralisé, les enchérisseurs doivent révéler eux-mêmes leurs propres offres ; s&#39;ils ne le font pas, ils perdent leurs fonds bloqués. Sans ce forfait, on pourrait faire de nombreuses offres et choisir de n&#39;en révéler qu&#39;une ou deux, transformant une enchère à offre scellée en une <span class="keep-together">enchère</span> de prix croissant traditionnelle.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-566">
<p>Par conséquent, l&#39;enchère est un processus en quatre étapes :</p>
</div>
<div class="olist arabic data-line-568">
<ol class="arabic">
<li class="data-line-568">
<p>Lancez l&#39;enchère. Ceci est nécessaire pour diffuser l&#39;intention d&#39;enregistrer un nom.
Cela crée toutes les dates limites d&#39;enchères. Les noms sont hachés, de sorte que seuls ceux qui ont le nom dans leur dictionnaire sauront quelle enchère a été ouverte. Cela permet une certaine confidentialité, ce qui est utile si vous créez un nouveau projet et que vous ne souhaitez pas partager de détails à son sujet.
Vous pouvez ouvrir plusieurs enchères fictives en même temps, donc si quelqu&#39;un vous suit, il ne peut pas simplement enchérir sur toutes les enchères que vous ouvrez.</p>
</li>
<li class="data-line-572">
<p>Faites une offre scellée. Vous devez le faire avant la date limite d&#39;enchère, en liant une quantité donnée d&#39;ether au hachage d&#39;un message secret (contenant, entre autres, le hachage du nom, le montant réel de l&#39;enchère et un sel).
Vous pouvez verrouiller plus d&#39;ether que vous n&#39;enchérissez réellement afin de masquer votre véritable évaluation.</p>
</li>
<li class="data-line-575">
<p>Révélez l&#39;enchère. Pendant la période de révélation, vous devez effectuer une transaction qui révèle l&#39;enchère, qui calculera ensuite l&#39;enchère la plus élevée et la deuxième enchère la plus élevée et renverra l&#39;ether aux enchérisseurs non retenus.
Chaque fois que l&#39;enchère est révélée, le gagnant actuel est recalculé ; par conséquent, le dernier à être défini avant l&#39;expiration du délai de révélation devient le grand gagnant.</p>
</li>
<li class="data-line-578">
<p>Nettoyer après. Si vous êtes le gagnant, vous pouvez finaliser l&#39;enchère afin de récupérer la différence entre votre enchère et la deuxième enchère la plus élevée.
Si vous avez oublié de révéler, vous pouvez faire une révélation tardive et récupérer une partie de votre enchère.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3 data-line-581">
<h4 id="_couche_supérieure_les_actes">Couche supérieure : les actes</h4>
<div class="paragraph data-line-583">
<p>La couche supérieure d&#39;ENS est encore un autre contrat super simple avec un seul but : détenir les fonds.</p>
</div>
<div class="paragraph data-line-585">
<p>Lorsque vous gagnez un nom, les fonds ne sont en fait envoyés nulle part, mais sont simplement bloqués pendant la période pendant laquelle vous souhaitez conserver le nom (au moins un an).
Cela fonctionne comme un rachat garanti : si le propriétaire ne veut plus du nom, il peut le revendre au système et récupérer son ether (ainsi, le coût de détention du nom est le coût d&#39;opportunité de faire quelque chose avec un rendement supérieur à zéro ).</p>
</div>
<div class="paragraph data-line-588">
<p>Bien sûr, avoir un seul contrat détenant des millions de dollars en ether s&#39;est avéré très risqué, donc à la place, ENS crée un contrat d&#39;acte pour chaque nouveau nom.
Le contrat d&#39;acte est très simple (environ 50 lignes de code), et il ne permet que les fonds d&#39;être transférés vers un seul compte (le propriétaire de l&#39;acte) et d&#39;être appelés par une seule entité (le contrat du registraire).
Cette approche réduit considérablement la surface d&#39;attaque où les bogues peuvent mettre les fonds en danger.</p>
</div>
</div>
<div class="sect3 data-line-592">
<h4 id="_enregistrer_un_nom">Enregistrer un nom</h4>
<div class="paragraph data-line-594">
<p>L&#39;enregistrement d&#39;un nom dans ENS est un processus en quatre étapes, comme nous l&#39;avons vu dans <a href="#vickrey_auction">Enchères Vickrey</a>. Nous plaçons d&#39;abord une enchère pour n&#39;importe quel nom disponible, puis nous révélons notre enchère après 48 heures pour sécuriser le nom. <a href="#ens_registration_timeline">Calendrier ENS pour l&#39;enregistrement</a> est un schéma montrant le calendrier d&#39;enregistrement.</p>
</div>
<div class="paragraph data-line-596">
<p>Enregistrons notre premier nom !</p>
</div>
<div class="paragraph data-line-598">
<p>Nous utiliserons l&#39;une des nombreuses interfaces conviviales disponibles pour rechercher les noms disponibles, placer une enchère sur le nom ethereumbook.eth, révéler l&#39;enchère et sécuriser le nom.</p>
</div>
<div class="paragraph data-line-600">
<p>Il existe un certain nombre d&#39;interfaces Web vers ENS qui nous permettent d&#39;interagir avec l&#39;ENS DApp. Pour cet exemple, nous utiliserons l&#39;interface <a href="https://mycrypto.com/" data-href="https://mycrypto.com/">MyCrypto</a>, en conjonction avec MetaMask comme portefeuille.</p>
</div>
<div id="ens_registration_timeline" class="imageblock data-line-604">
<div class="content">
<img src="images/ens-flow.png" alt="ens flow">
</div>
<div class="title">Figure 45. Calendrier ENS pour l&#39;enregistrement</div>
</div>
<div class="paragraph data-line-608">
<p>Tout d&#39;abord, nous devons nous assurer que le nom que nous voulons est disponible. En écrivant ce livre, nous voulions vraiment enregistrer le nom mastering.eth, mais hélas, <a href="#ens-name-search">Recherche de noms ENS sur MyCrypto.com</a> a révélé qu&#39;il était déjà pris ! Comme les inscriptions à l&#39;ENS ne durent qu&#39;un an, il pourrait devenir possible d&#39;obtenir ce nom à l&#39;avenir. En attendant, recherchons ethereumbook.eth (<a href="#ens-name-search">Recherche de noms ENS sur MyCrypto.com</a>).</p>
</div>
<div id="ens-name-search" class="imageblock data-line-612">
<div class="content">
<img src="images/ens-checkname.png" alt="&quot;Recherche de noms ENS sur MyCrypto.com&quot;">
</div>
<div class="title">Figure 46. Recherche de noms ENS sur MyCrypto.com</div>
</div>
<div class="paragraph data-line-614">
<p>Génial! Le nom est disponible. Pour l&#39;enregistrer, nous devons avancer avec <a href="#ens-auction">Démarrer une offre d&#8217;enchère pour un nom ENS</a>. Débloquons MetaMask et commençons notre enregistrement pour ethereumbook.eth.</p>
</div>
<div id="ens-auction" class="imageblock data-line-619">
<div class="content">
<img src="images/ens-auction.png" alt="&quot;Démarrer une offre d&#8217;enchère pour un nom ENS&quot;">
</div>
<div class="title">Figure 47. Démarrer une offre d&#8217;enchère pour un nom ENS</div>
</div>
<div class="paragraph data-line-622">
<p>Faisons notre offre. Pour ce faire, nous devons suivre les étapes de <a href="#ens-bid">Placer une offre pour un nom ENS</a>.</p>
</div>
<div id="ens-bid" class="imageblock data-line-627">
<div class="content">
<img src="images/ens-bid.png" alt="&quot;Placer une offre d&#8217;enchère pour un nom ENS&quot;">
</div>
<div class="title">Figure 48. Placer une offre pour un nom ENS</div>
</div>
<div class="admonitionblock warning data-line-630">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-631">
<p>Comme mentionné dans <a href="#vickrey_auction">Enchères Vickrey</a>, vous devez révéler votre enchère dans les 48 heures suivant la fin de l&#39;enchère, sinon vous <em>perdez les fonds de votre enchère</em>. Avons-nous oublié de le faire et avons-nous perdu 0,01 ETH nous-mêmes ? Vous pariez que nous l&#39;avons fait.</p>
</div>
<div class="paragraph data-line-633">
<p>Prenez une capture d&#39;écran, enregistrez votre phrase secrète (comme sauvegarde pour votre enchère) et ajoutez un rappel dans votre calendrier pour la date et l&#39;heure de révélation, afin de ne pas oublier et de ne pas perdre vos fonds.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-636">
<p>Enfin, nous confirmons la transaction en cliquant sur le gros bouton vert de soumission affiché dans <a href="#ens-metamask-bid">[ens-metamask-bid]</a>.</p>
</div>
<div id="ens-metamask-enchère" class="imageblock data-line-640">
<div class="content">
<img src="images/ens-metamask-bid.png" alt="&quot;Transaction MetaMask contenant votre enchère&quot;">
</div>
<div class="title">Figure 49. Transaction MetaMask contenant votre enchère</div>
</div>
<div class="paragraph data-line-642">
<p>Si tout se passe bien, après avoir soumis une transaction de cette manière, vous pouvez revenir et révéler l&#39;offre dans les 48 heures, et le nom que vous avez demandé sera enregistré sur votre adresse Ethereum.</p>
</div>
</div>
<div class="sect3 data-line-644">
<h4 id="_gérer_votre_nom_ens">Gérer votre nom ENS</h4>
<div class="paragraph data-line-646">
<p> Une fois que vous avez enregistré un nom ENS, vous pouvez le gérer à l&#39;aide d&#39;une autre interface conviviale : <a href="https://manager.ens.domains/" data-href="https://manager.ens.domains/">ENS Manager</a>.</p>
</div>
<div class="paragraph data-line-649">
<p>Une fois là-bas, saisissez le nom que vous souhaitez gérer dans la zone de recherche (voir <a href="#ens-manager">L&#39;interface web ENS Manager</a>). Vous devez avoir votre portefeuille Ethereum (par exemple, MetaMask) déverrouillé, afin que le DApp ENS Manager puisse gérer l&#8217;enregistrement en votre nom.</p>
</div>
<div id="ens-manager" class="imageblock data-line-653">
<div class="content">
<img src="images/ens-manager.png" alt="&quot;L&#39;interface web de l&#39;ENS Manager&quot;">
</div>
<div class="title">Figure 50. L&#39;interface web ENS Manager</div>
</div>
<div class="paragraph data-line-655">
<p>À partir de cette interface, nous pouvons créer des sous-domaines, définir un contrat de résolution (nous en reparlerons plus tard) et connecter chaque nom à la ressource appropriée, telle que l&#39;adresse Swarm d&#39;une interface DApp.</p>
</div>
<div class="sect4 data-line-657">
<h5 id="_création_dun_sous_domaine_ens">Création d&#39;un sous-domaine ENS</h5>
<div class="paragraph data-line-659">
<p>Commençons par créer un sous-domaine pour notre exemple de DApp d&#8217;enchères (voir <a href="#ens-manager-add-subdomain">[ens-manager-add-subdomain]</a>). Nous nommerons le sous-domaine auction, donc le nom complet sera auction.ethereumbook.eth.</p>
</div>
<div id="ens-manager-ajouter-sous-domaine" class="imageblock data-line-663">
<div class="content">
<img src="images/ens_manager_add_subdomain.png" alt="&quot;Ajout du sous-domaine auction.ethereumbook.eth&quot;">
</div>
<div class="title">Figure 51. Ajout du sous-domaine auction.ethereumbook.eth</div>
</div>
<div class="paragraph data-line-665">
<p>Une fois que nous avons créé le sous-domaine, nous pouvons saisir auction.ethereumbook.eth dans la zone de recherche et le gérer, tout comme nous avons géré le domaine ethereumbook.eth <span class="keep-together">précédemment</span>.</p>
</div>
</div>
</div>
<div class="sect3 pagebreak-before data-line-668">
<h4 id="_résolveurs_ens">Résolveurs ENS</h4>
<div class="paragraph data-line-670">
<p>Dans ENS, la résolution d&#39;un nom est un processus en deux étapes :</p>
</div>
<div class="olist arabic data-line-672">
<ol class="arabic">
<li class="data-line-672">
<p>Le registre ENS est appelé avec le nom à résoudre après l&#39;avoir haché.
Si l&#39;enregistrement existe, le registre renvoie l&#39;adresse de son résolveur.</p>
</li>
<li class="data-line-675">
<p>Le résolveur est appelé, en utilisant la méthode appropriée à la ressource demandée. Le résolveur renvoie le résultat souhaité.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-677">
<p>Ce processus en deux étapes présente plusieurs avantages. Séparer la fonctionnalité des résolveurs du système de nommage lui-même nous donne beaucoup plus de flexibilité. Les propriétaires de noms peuvent utiliser des résolveurs personnalisés pour résoudre n&#39;importe quel type ou ressource, étendant ainsi les fonctionnalités d&#39;ENS. Par exemple, si à l&#39;avenir vous vouliez lier une ressource de géolocalisation (longitude/lattitude) à un nom ENS, vous pourriez créer un nouveau résolveur qui répond à une requête de <span class="keep-together"><code>géolocalisation</code></span>. Qui sait quelles applications pourraient être utiles à l&#39;avenir ? Avec les résolveurs personnalisés, la seule limite est votre imagination.</p>
</div>
<div class="paragraph data-line-679">
<p>Pour plus de commodité, il existe un résolveur public par défaut qui peut résoudre une variété de ressources, y compris l&#39;adresse (pour les portefeuilles ou les contrats) et le contenu (un hachage Swarm pour les DApps ou le code source du contrat).</p>
</div>
<div class="paragraph data-line-681">
<p>Puisque nous voulons lier notre DApp d&#8217;enchères à un hachage Swarm, nous pouvons utiliser le résolveur public, qui prend en charge la résolution de contenu, comme indiqué dans <a href="#ens-manager-set-default-resolver">Définition du résolveur public par défaut pour auction.ethereumbook.eth</a> ; nous n&#39;avons pas besoin de coder ou de déployer un résolveur personnalisé.</p>
</div>
<div id="ens-manager-set-default-resolver" class="imageblock data-line-685">
<div class="content">
<img src="images/ens-manager-set-default-resolver.png" alt="&quot;Définir le résolveur public par défaut pour auction.ethereumbook.eth&quot;">
</div>
<div class="title">Figure 52. Définition du résolveur public par défaut pour auction.ethereumbook.eth</div>
</div>
</div>
<div class="sect3 data-line-687">
<h4 id="_résolution_dun_nom_en_un_hachage_swarm_contenu">Résolution d&#39;un nom en un hachage Swarm (contenu)</h4>
<div class="paragraph data-line-689">
<p>Une fois que le résolveur pour auction.ethereumbook.eth est défini pour être le résolveur public, nous pouvons le configurer pour qu&#39;il renvoie le hachage Swarm comme contenu de notre nom (voir <a href="#ens-set-content">Définition du &#39;contenu&#39; à retourner pour auction.ethereumbook.eth</a>).</p>
</div>
<div id="ens-set-content" class="imageblock data-line-693">
<div class="content">
<img src="images/ens-manager-set-content.png" alt="&quot;Définir le retour &#39;contenu&#39; pour auction.ethereumbook.eth&quot;">
</div>
<div class="title">Figure 53. Définition du &#39;contenu&#39; à retourner pour auction.ethereumbook.eth</div>
</div>
<div class="paragraph data-line-695">
<p>Après avoir attendu un peu de temps pour que notre transaction soit confirmée, nous devrions être en mesure de résoudre correctement le nom. Avant de définir un nom, notre DApp d&#8217;enchères pouvait être trouvée sur une passerelle Swarm par son hachage :</p>
</div>
<ul class="simplelist">
<li><em>https://swarm-gateways.net/bzz:/ab164cf37dc10647e43a233486cdeffa8334b026e32a480dd9cbd020c12d4581</em></li>
</ul>
<div class="paragraph data-line-703">
<p>ou en recherchant dans un navigateur DApp ou une passerelle Swarm pour l&#39;URL Swarm :</p>
</div>
<ul class="simplelist">
<li><em>bzz://ab164cf37dc10647e43a233486cdeffa8334b026e32a480dd9cbd020c12d4581</em></li>
</ul>
<div class="paragraph pagebreak-before data-line-712">
<p>Maintenant que nous l&#39;avons attaché à un nom, c&#39;est beaucoup plus simple :</p>
</div>
<ul class="simplelist">
<li><em>http://swarm-gateways.net/bzz:/auction.ethereumbook.eth/</em></li>
</ul>
<div class="paragraph data-line-720">
<p>Nous pouvons également le trouver en recherchant &quot;auction.ethereumbook.eth&quot; dans n&#39;importe quel portefeuille compatible ENS ou navigateur DApp (par exemple, Mist).</p>
</div>
</div>
</div>
<div class="sect2 data-line-722">
<h3 id="_de_lapplication_à_la_dapp">De l&#39;application à la DApp</h3>
<div class="paragraph data-line-724">
<p>Au cours des dernières sections, nous avons progressivement construit une application décentralisée. Nous avons commencé avec une paire de contrats intelligents pour organiser une vente aux enchères d&#39;actes ERC721. Ces contrats ont été conçus pour ne pas avoir de compte gouvernant ou privilégié, de sorte que leur fonctionnement est véritablement décentralisé. Nous avons ajouté une interface, implémentée en JavaScript, qui offre une interface pratique et conviviale à notre DApp. La DApp d&#39;enchères utilise le système de stockage décentralisé Swarm pour stocker les ressources d&#39;application telles que les images. La DApp utilise également le protocole de communication décentralisé Whisper pour offrir une salle de chat cryptée pour chaque enchère, sans aucun serveur central.</p>
</div>
<div class="paragraph data-line-726">
<p>Nous avons téléchargé l&#39;intégralité de l&#39;interface sur Swarm, afin que notre DApp ne s&#39;appuie sur aucun serveur Web pour servir les fichiers. Enfin, nous avons attribué un nom à notre DApp en utilisant ENS, en le connectant au hachage Swarm de l&#39;interface, afin que les utilisateurs puissent y accéder avec un nom simple et facile à retenir, lisible par l&#39;homme.</p>
</div>
<div class="paragraph data-line-728">
<p>A chacune de ces étapes, nous avons augmenté la décentralisation de notre application. Le résultat final est une DApp qui n&#39;a pas de point central d&#39;autorité, pas de point central de défaillance, et exprime la vision &quot;web3&quot;.</p>
</div>
<div class="paragraph data-line-730">
<p><a href="#auction_dapp_final_architecture">Architecture DApp d&#39;enchères</a> montre l&#39;architecture complète de la DApp d&#8217;enchères.</p>
</div>
<div id="auction_dapp_final_architecture" class="imageblock data-line-734">
<div class="content">
<img src="images/auction_dapp_final_architecture.png" alt="&quot;Architecture DApp d&#39;enchères&quot;">
</div>
<div class="title">Figure 54. Architecture DApp d&#39;enchères</div>
</div>
</div>
<div class="sect2 data-line-736">
<h3 id="_conclusion_9">Conclusion</h3>
<div class="paragraph data-line-27">
<p>Les applications décentralisées sont l&#39;aboutissement de la vision d&#39;Ethereum, telle qu&#39;exprimée par les fondateurs dès les premières conceptions. Alors que de nombreuses applications s&#39;appellent aujourd&#39;hui &quot;DApps&quot;, la plupart ne sont pas entièrement décentralisées. Cependant, il est déjà possible de construire des applications presque totalement décentralisées. Au fil du temps, à mesure que la technologie mûrit, de plus en plus de nos applications peuvent être décentralisées, ce qui se traduit par un Web plus résilient, résistant à la censure et libre.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="evm_chapter">La machine virtuelle Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Au cœur du protocole et du fonctionnement Ethereum se trouve la machine virtuelle Ethereum, ou EVM en abrégé. Comme vous pouvez le deviner d&#39;après son nom, il s&#39;agit d&#39;un moteur de calcul, pas très différent des machines virtuelles du cadre de développement .NET de Microsoft, ou des interprètes d&#39;autres langages de programmation compilés par bytecode tels que Java. Dans ce chapitre, nous examinons en détail l&#39;EVM, y compris son jeu d&#39;instructions, sa structure et son fonctionnement, dans le contexte des mises à jour d&#39;état d&#39;Ethereum.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="evm_description">Qu&#39;est-ce que l&#39;EVM ?</h3>
<div class="paragraph data-line-8">
<p>L&#39;EVM est la partie d&#39;Ethereum qui gère le déploiement et l&#39;exécution des contrats intelligents. Les transactions simples de transfert de valeur d&#39;un EOA à un autre n&#39;ont pas besoin de l&#39;impliquer, pratiquement, mais tout le reste impliquera une mise à jour d&#39;état calculée par l&#39;EVM. À un niveau élevé, l&#39;EVM fonctionnant sur la chaîne de blocs Ethereum peut être considéré comme un ordinateur mondial décentralisé contenant des millions d&#39;objets exécutables, chacun avec son propre magasin de données permanent.</p>
</div>
<div class="paragraph data-line-10">
<p>L&#39;EVM est une machine d&#39;état quasi–Turing-complète ; &quot;quasi&quot; car tous les processus d&#39;exécution sont limités à un nombre fini d&#39;étapes de calcul par la quantité de gaz disponible pour toute exécution de contrat intelligent donnée. En tant que tel, le problème d&#39;arrêt est &quot;résolu&quot; (toutes les exécutions de programme s&#39;arrêteront) et la situation où l&#39;exécution pourrait (accidentellement ou par malveillance) s&#39;exécuter indéfiniment, amenant ainsi la plate-forme Ethereum à s&#39;arrêter dans son intégralité, est évitée.</p>
</div>
<div class="paragraph data-line-12">
<p>L&#39;EVM a une architecture basée sur la pile, stockant toutes les valeurs en mémoire sur une pile. Il fonctionne avec une taille de mot de 256 bits (principalement pour faciliter les opérations de hachage natif et de courbe elliptique) et possède plusieurs composants de données adressables :</p>
</div>
<div class="ulist pagebreak-before data-line-15">
<ul>
<li class="data-line-15">
<p>Un <em>code de programme ROM</em> immuable, chargé avec le bytecode du smart contract à exécuter</p>
</li>
<li class="data-line-16">
<p>Une <em>mémoire</em> volatile, avec chaque emplacement explicitement initialisé à zéro</p>
</li>
<li class="data-line-17">
<p>Un <em>stockage</em> permanent qui fait partie de l&#39;état Ethereum, également initialisé à zéro</p>
</li>
</ul>
</div>
<div class="paragraph data-line-19">
<p>Il existe également un ensemble de variables d&#39;environnement et de données disponibles pendant l&#39;exécution. Nous les détaillerons plus loin dans ce chapitre.</p>
</div>
<div class="paragraph data-line-21">
<p><a href="#evm_architecture">L&#39;architecture et le contexte d&#39;exécution de la machine virtuelle Ethereum (EVM)</a> montre l&#39;architecture EVM et le contexte d&#39;exécution.</p>
</div>
<div id="evm_architecture" class="imageblock data-line-25">
<div class="content">
<img src="images/evm-architecture.png" alt="&quot;L&#39;architecture de la machine virtuelle Ethereum (EVM) et son contexte d&#39;exécution&quot;">
</div>
<div class="title">Figure 55. L&#39;architecture et le contexte d&#39;exécution de la machine virtuelle Ethereum (EVM)</div>
</div>
<div class="sect3 data-line-28">
<h4 id="evm_comparison">Comparaison avec la technologie existante</h4>
<div class="paragraph data-line-30">
<p>Le terme &quot;machine virtuelle&quot; est souvent appliqué à la virtualisation d&#39;un ordinateur réel, typiquement par un &quot;hyperviseur&quot; tel que VirtualBox ou QEMU, ou d&#39;une instance entière du système d&#39;exploitation, comme le KVM de Linux. Ceux-ci doivent fournir une abstraction logicielle, respectivement, du matériel réel, des appels système et des autres fonctionnalités du noyau.</p>
</div>
<div class="paragraph data-line-32">
<p>L&#39;EVM fonctionne dans un domaine beaucoup plus limité : c&#39;est juste un moteur de calcul, et en tant que tel fournit une abstraction du calcul et du stockage, similaire à la spécification Java Virtual Machine (JVM), par exemple. D&#39;un point de vue de haut niveau, la JVM est conçue pour fournir un environnement d&#39;exécution indépendant du système d&#39;exploitation ou du matériel hôte sous-jacent, permettant la compatibilité entre une grande variété de systèmes. Les langages de programmation de haut niveau tels que Java ou Scala (qui utilisent la JVM) ou C# (qui utilise .NET) sont compilés dans le jeu d&#39;instructions bytecode de leur machine virtuelle respective. De la même manière, l&#39;EVM exécute son propre jeu d&#39;instructions de bytecode (décrit dans la section suivante), dans lequel sont compilés des langages de programmation de contrats intelligents de niveau supérieur tels que LLL, Serpent, Mutan ou Solidity.</p>
</div>
<div class="paragraph data-line-34">
<p>L&#39;EVM n&#39;a donc aucune capacité de planification, car l&#39;ordre d&#39;exécution est organisé en externe - les clients Ethereum exécutent des transactions de bloc vérifiées pour déterminer quels contrats intelligents doivent être exécutés et dans quel ordre. En ce sens, l&#39;ordinateur mondial Ethereum est mono-fil (d&#8217;exécution), comme JavaScript. L&#39;EVM n&#39;a pas non plus de gestion &quot;d&#39;interface système&quot; ou de &quot;support matériel&quot; - il n&#39;y a pas de machine physique avec laquelle s&#39;interfacer. L&#39;ordinateur mondial Ethereum est entièrement virtuel.</p>
</div>
</div>
<div class="sect3 data-line-37">
<h4 id="evm_bytecode_overview">Le jeu d&#39;instructions EVM (opérations de bytecode)</h4>
<div class="paragraph data-line-39">
<p>Le jeu d&#39;instructions EVM offre la plupart des opérations que l&#8217;on peut s&#39;attendre, y compris :</p>
</div>
<div class="ulist data-line-41">
<ul>
<li class="data-line-41">
<p>Opérations arithmétiques et logiques au niveau du bit</p>
</li>
<li class="data-line-42">
<p>Enquêtes sur le contexte d&#39;exécution</p>
</li>
<li class="data-line-43">
<p>Accès à la pile, à la mémoire et au stockage</p>
</li>
<li class="data-line-44">
<p>Contrôler les opérations de flux</p>
</li>
<li class="data-line-45">
<p>Journalisation, appels et autres opérateurs</p>
</li>
</ul>
</div>
<div class="paragraph data-line-47">
<p>En plus des opérations de code intermédiaire typiques, l&#39;EVM a également accès aux informations de compte (par exemple, l&#39;adresse et le solde) et aux informations de bloc (par exemple, le numéro de bloc et le prix actuel du gaz).</p>
</div>
<div class="paragraph data-line-49">
<p>Commençons notre exploration de l&#39;EVM plus en détail en examinant les opcodes disponibles et ce qu&#39;ils font. Comme vous pouvez vous y attendre, tous les opérandes sont extraits de la pile et le résultat (le cas échéant) est souvent
remis sur le dessus de la pile.</p>
</div>
<div class="admonitionblock note data-line-53">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-54">
<p>Une liste complète des opcodes et leur coût de gaz correspondant peut être trouvée dans <a href="#evm_opcodes">Opcodes Ethereum EVM et consommation de gaz</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-57">
<p>Les opcodes disponibles peuvent être divisés dans les catégories suivantes :</p>
</div>
<div id="arithmetic_opcodes" class="dlist data-line-60">
<dl>
<dt class="hdlist1">Opérations arithmétiques</dt>
<dd>
<p>Instructions d&#39;opcode arithmétique :</p>
<div class="listingblock data-line-62">
<div class="content">
<pre>ADD        // Ajouter les deux premiers éléments de la pile
MUL        // Multiplier les deux premiers éléments de la pile
SUB        // Soustraire les deux premiers éléments de la pile
DIV        // Division entière
SDIV       // Division d&amp;#39;entier signé
MOD        // Opération modulo (reste)
SMOD       // Opération modulo signée
ADDMOD     // Addition modulo n&amp;#39;importe quel nombre
MULMOD     // Multiplication modulo n&amp;#39;importe quel nombre
EXP        // Opération exponentielle
SIGNEXTEND // Étend la longueur d&amp;#39;un entier signé complément à deux
SHA3       // Calcule le hachage Keccak-256 d&amp;#39;un bloc de mémoire</pre>
</div>
</div>
<div class="paragraph data-line-77">
<p>Notez que toute l&#39;arithmétique est effectuée modulo 2<sup>256</sup> (sauf indication contraire) et que la puissance zéro de zéro, 0<sup>0</sup>, est considérée comme égale à 1.</p>
</div>
</dd>
</dl>
</div>
<div id="stack_opcodes" class="dlist data-line-81">
<dl>
<dt class="hdlist1">Opérations de pile </dt>
<dd>
<p>Instructions de gestion de la pile, de la mémoire et du stockage :</p>
<div class="listingblock data-line-83">
<div class="content">
<pre>POP        // Supprime l&amp;#39;élément du haut de la pile
MLOAD      // Charger un mot machine de la mémoire
MSTORE     // Enregistre un mot machine en mémoire
MSTORE8    // Enregistre un octet en mémoire
SLOAD      // Charger un mot machine depuis le stockage
SSTORE     // Enregistrer un mot machine dans le stockage
MSIZE      // Récupère la taille de la mémoire active en octets
PUSHx      // Place l&amp;#39;élément x octet sur la pile, où x peut être n&amp;#39;importe quel entier de
           // 1 à 32 (mot machine complet) inclus
DUPx       // Dupliquer le x-ième élément de la pile, où x peut être n&amp;#39;importe quel entier de
           // 1 à 16 inclus
SWAPx      // Échangez les 1er et (x+1)-ème éléments de la pile, où x peut être n&amp;#39;importe quel
           // entier de 1 à 16 inclus</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="flow_opcodes" class="dlist data-line-101">
<dl>
<dt class="hdlist1">Opérations de flux de processus </dt>
<dd>
<p>Instructions pour le flux de contrôle :</p>
<div class="listingblock data-line-103">
<div class="content">
<pre>STOP     // Arrête l&amp;#39;exécution
JUMP     // Mettre le compteur de programme à n&amp;#39;importe quelle valeur
JUMPI    // Modifier conditionnellement le compteur de programme
PC       // Récupérer la valeur du compteur de programme (avant l&amp;#39;incrément
         // correspondant à cette instruction)
JUMPDEST // Marquer une destination valide pour les sauts</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="system_opcodes" class="dlist data-line-113">
<dl>
<dt class="hdlist1">Opérations système </dt>
<dd>
<p>Opcodes pour le système exécutant le programme :</p>
<div class="listingblock data-line-115">
<div class="content">
<pre>LOGx         // Ajouter un enregistrement de journal avec x sujets, où x est n&amp;#39;importe quel entier
             // de 0 à 4 inclus
CREATE       // Créer un nouveau compte avec le code associé
CALL         // Message-appel dans un autre compte, c&amp;#39;est-à-dire exécuter un autre
             // code du compte
CALLCODE     // Message-appel dans ce compte avec un autre
             // code du compte
RETURN       // Arrête l&amp;#39;exécution et renvoie les données de sortie
DELEGATECALL // Message-appel dans ce compte avec une alternative
             // code du compte, mais en conservant les valeurs actuelles pour
             // sender et value
STATICCALL   // Message-appel statique dans un compte
REVERT       // Arrête l&amp;#39;exécution, annule les changements d&amp;#39;état mais retourne
             // des données et le gaz restant
INVALID      // L&amp;#39;instruction invalide désignée
SELFDESTRUCT // Arrête l&amp;#39;exécution et enregistre le compte pour suppression</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="logic_opcides" class="dlist data-line-135">
<dl>
<dt class="hdlist1">Opérations logiques </dt>
<dd>
<p>Opcodes pour les comparaisons et la logique au niveau du bit :</p>
<div class="listingblock data-line-137">
<div class="content">
<pre>LT     // Comparaison inférieure à
GT     // Comparaison supérieure à
SLT    // Comparaison inférieure signée
SGT    // Comparaison supérieure signée
EQ     // Comparaison d&amp;#39;égalité
ISZERO // Opérateur NOT simple
AND    // Opération AND au niveau du bit
OR     // Opération OR au niveau du bit
XOR    // Opération XOR au niveau du bit
NOT    // Opération NOT au niveau du bit
BYTE   // Récupérer un seul octet d&amp;#39;un mot pleine largeur de 256 bits</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="environment_opcodes" class="dlist data-line-152">
<dl>
<dt class="hdlist1">Opérations environnementales </dt>
<dd>
<p>Opcodes traitant des informations sur l&#39;environnement d&#39;exécution :</p>
<div class="listingblock data-line-154">
<div class="content">
<pre>GAZ            // Obtenir la quantité de gaz disponible (après la réduction pour
               // cette instruction)
ADRESSE        // Obtenir l&amp;#39;adresse du compte en cours d&amp;#39;exécution
SOLDE          // Obtenir le solde du compte d&amp;#39;un compte donné
ORIGIN         // Obtenir l&amp;#39;adresse de l&amp;#39;EOA qui a lancé cette
               // éxecution EVM
APPELANT       // Obtenir l&amp;#39;adresse de l&amp;#39;appelant immédiatement responsable
               // pour cette exécution
CALLVALUE      // Obtenir le montant en ether déposé par l&amp;#39;appelant responsable
               // pour cette exécution
CALLDATALOAD   // Récupère les données d&amp;#39;entrée envoyées par l&amp;#39;appelant responsable de
               // cette exécution
CALLDATASIZE   // Récupère la taille des données d&amp;#39;entrée
CALLDATACOPY   // Copie les données d&amp;#39;entrée dans la mémoire
CODESIZE       // Récupère la taille du code en cours d&amp;#39;exécution dans l&amp;#39;environnement actuel
CODECOPY       // Copiez le code en cours d&amp;#39;exécution dans l&amp;#39;environnement actuel vers
               // la mémoire
GASPRICE       // Obtenir le prix du gaz spécifié par la
               // transaction d&amp;#39;origine
EXTCODESIZE    // Récupère la taille du code de n&amp;#39;importe quel compte
EXTCODECOPY    // Copie le code de n&amp;#39;importe quel compte en mémoire
RETURNDATASIZE // Récupère la taille des données de sortie de l&amp;#39;appel précédent
               // dans l&amp;#39;environnement actuel
RETURNDATACOPY // Copie la sortie des données de l&amp;#39;appel précédent dans la mémoire</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="block_opcodes" class="dlist data-line-182">
<dl>
<dt class="hdlist1">Opérations sur les blocs</dt>
<dd>
<p>Opcodes pour accéder aux informations sur le bloc actuel :</p>
<div class="listingblock data-line-184">
<div class="content">
<pre>BLOCKHASH  // Obtenir le hachage de l&amp;#39;un des 256 derniers
           // blocs complétés
COINBASE   // Obtenir l&amp;#39;adresse du bénéficiaire du bloc pour la récompense du bloc
TIMESTAMP  // Récupère l&amp;#39;horodatage du bloc
NUMBER     // Récupère le numéro du bloc
DIFFICULTY // Obtenir la difficulté du bloc
GASLIMIT   // Récupère la limite de gaz du bloc</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-195">
<h4 id="evm_state_descriptions">État Ethereum</h4>
<div class="paragraph data-line-197">
<p>Le travail de l&#39;EVM consiste à mettre à jour l&#39;état Ethereum en calculant des transitions d&#39;état valides à la suite de l&#39;exécution du code de contrat intelligent, tel que défini par le protocole Ethereum. Cet aspect conduit à la description d&#39;Ethereum comme une <em>machine à états basée sur les transactions</em>, qui reflète le fait que des acteurs externes (c&#39;est-à-dire les titulaires de compte et les mineurs) initient des transitions d&#39;état en créant, acceptant et ordonnant des transactions. Il est utile à ce stade de considérer ce qui constitue l&#39;état Ethereum.</p>
</div>
<div class="paragraph data-line-199">
<p>Au niveau supérieur, nous avons l&#39;état <em>mondial</em> d&#39;Ethereum. L&#39;état mondial est un mappage des adresses Ethereum (valeurs 160 bits) vers des <em>comptes</em>. Au niveau inférieur, chaque adresse Ethereum représente un compte comprenant un <em>solde</em> d&#8217;ether (stocké comme le nombre de wei détenu par le compte), un <em>nonce</em> (représentant le nombre de transactions envoyées avec succès depuis ce compte s&#39;il s&#39;agit d&#39;un EOA, ou le nombre de contrats créés par celui-ci s&#39;il s&#39;agit d&#39;un compte contractuel), le <em>stockage</em> du compte (qui est une donnée permanente store, utilisé uniquement par les contrats intelligents) et le <em>code programme</em> du compte (encore une fois, uniquement si le compte est un compte de contrat intelligent). Un EOA n&#39;aura toujours aucun code et un stockage vide.</p>
</div>
<div class="paragraph data-line-205">
<p>Lorsqu&#39;une transaction entraîne l&#39;exécution d&#39;un code de contrat intelligent, une EVM est instanciée avec toutes les informations requises par rapport au bloc en cours de création et à la transaction spécifique en cours de traitement. En particulier, la ROM de code de programme de l&#39;EVM est chargée avec le code du compte de contrat appelé, le compteur de programme est mis à zéro, la mémoire est chargée à partir de la mémoire du compte de contrat, la mémoire est mise à zéro, et tout le bloc et les variables d&#39;environnement sont définies. Une variable clé est l&#39;approvisionnement en gaz pour cette exécution, qui est fixé à la quantité de gaz payée par l&#39;expéditeur au début de la transaction (voir <a href="#gas">Gaz</a> pour plus de détails). Au fur et à mesure de l&#39;exécution du code, l&#39;alimentation en gaz est réduite en fonction du coût en gaz des opérations exécutées. Si, à un moment quelconque, l&#39;alimentation en gaz est réduite à zéro, nous obtenons une exception &quot;Out of Gas&quot; (OOG) ; l&#39;exécution s&#39;arrête immédiatement et la transaction est abandonnée. Aucune modification de l&#39;état d&#39;Ethereum n&#39;est appliquée, à l&#39;exception du nonce de l&#39;expéditeur qui est incrémenté et de son solde d&#39;ether qui diminue pour payer le bénéficiaire du bloc pour les ressources utilisées pour exécuter le code jusqu&#39;au point d&#39;arrêt. À ce stade, vous pouvez penser à l&#39;EVM s&#39;exécutant sur une copie en bac à sable de l&#39;état mondial d&#39;Ethereum, cette version en bac à sable étant complètement supprimée si l&#39;exécution ne peut pas se terminer pour une raison quelconque. Cependant, si l&#39;exécution réussit, l&#39;état réel est mis à jour pour correspondre à la version en bac à sable, y compris toute modification des données de stockage du contrat appelé, tout nouveau contrat créé et tout transfert de solde d&#39;ether initié.</p>
</div>
<div class="paragraph data-line-207">
<p>Notez que, comme un contrat intelligent peut lui-même initier efficacement des transactions, l&#39;exécution de code est un processus récursif. Un contrat peut appeler d&#39;autres contrats, chaque appel entraînant l&#39;instanciation d&#39;un autre EVM autour de la nouvelle cible de l&#39;appel. Chaque instanciation a son état mondial de bac à sable initialisé à partir du bac à sable de l&#39;EVM au niveau supérieur. Chaque instanciation reçoit également une quantité spécifiée de gaz pour son alimentation en gaz (n&#39;excédant pas la quantité de gaz restant dans le niveau supérieur, bien sûr), et peut donc elle-même s&#39;arrêter à une exception près en raison du manque de gaz pour terminer son exécution . Encore une fois, dans de tels cas, l&#39;état du bac à sable est ignoré et l&#39;exécution revient à l&#39;EVM au niveau supérieur.</p>
</div>
</div>
<div class="sect3 data-line-210">
<h4 id="compiling_solidity_to_evm">Compilation de Solidity en code intermédiaire EVM</h4>
<div id="solc_help" class="paragraph data-line-213">
<p>La compilation un fichier source Solidity en code intermédiaire EVM peut être réalisé via plusieurs méthodes. Dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a> nous avons utilisé le compilateur Remix en ligne. Dans ce chapitre, nous utiliserons l&#39;exécutable solc en ligne de commande. Pour une liste d&#39;options, exécutez la <span class="keep-together">commande</span> suivante :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --help</strong>

</pre>
<div id="solc_opcodes_option" class="paragraph data-line-223">
<p>La génération du flux d&#39;opcode brut d&#39;un fichier source Solidity est facilement réalisée avec l&#39;option de ligne de commande --opcodes. Ce flux d&#39;opcode laisse de côté certaines informations (l&#39;option --asm produit les informations complètes), mais c&#39;est suffisant pour cette discussion. Par exemple, la compilation d&#39;un exemple de fichier Solidity, <em>Example.sol</em>, et l&#39;envoi de la sortie de l&#39;opcode dans un répertoire nommé <em>BytecodeDir</em> s&#39;effectuent avec la commande suivante :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --opcodes Example.sol</strong>

</pre>
<div class="paragraph data-line-232">
<p>ou alors:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --asm Example.sol</strong>

</pre>
<div id="solc_bin_option" class="paragraph data-line-242">
<p>La commande suivante produira le code intermédiaire binaire pour notre exemple de programme :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --bin Example.sol</strong>

</pre>
<div class="paragraph data-line-251">
<p>Les fichiers d&#39;opcode de sortie générés dépendront des contrats spécifiques contenus dans le fichier source Solidity. Notre fichier Solidity simple <em>Example.sol</em> n&#39;a qu&#39;un seul contrat, nommé example :</p>
</div>
<div id="simple_solidity_example" class="listingblock data-line-255">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.19;

contract example {

  address contractOwner;

  function example() {
    contractOwner = msg.sender;
  }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-268">
<p>Comme vous pouvez le voir, ce contrat ne contient qu&#39;une seule variable d&#39;état persistante, qui est définie comme l&#39;adresse du dernier compte pour exécuter ce contrat.</p>
</div>
<div class="paragraph data-line-270">
<p>Si vous regardez dans le répertoire <em>BytecodeDir</em>, vous verrez le fichier d&#39;opcode <em>example.opcode</em>, qui contient les instructions d&#39;opcode EVM du contrat example. L&#39;ouverture du fichier <em>example.opcode</em> dans un éditeur de texte affichera ce qui suit :</p>
</div>
<div id="opcode_output" class="listingblock data-line-273">
<div class="content">
<pre>PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH1 0xE JUMPI PUSH1 0x0 DUP1
REVERT JUMPDEST CALLER PUSH1 0x0 DUP1 PUSH2 0x100 EXP DUP2 SLOAD DUP2 PUSH20
0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF MUL NOT AND SWAP1 DUP4 PUSH20
0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF AND MUL OR SWAP1 SSTORE POP PUSH1
0x35 DUP1 PUSH1 0x5B PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x60 PUSH1
0x40 MSTORE PUSH1 0x0 DUP1 REVERT STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 JUMP
0xb9 SWAP14 0xcb 0x1e 0xdd RETURNDATACOPY 0xec 0xe0 0x1f 0x27 0xc9 PUSH5
0x9C5ABCC14A NUMBER 0x5e INVALID EXTCODESIZE 0xdb 0xcf EXTCODESIZE 0x27
EXTCODESIZE 0xe2 0xb8 SWAP10 0xed 0x</pre>
</div>
</div>
<div class="paragraph data-line-285">
<p>Compiler l&#39;exemple avec l&#39;option --asm produit un fichier nommé <em>example.evm</em> dans notre répertoire <em>BytecodeDir</em>. Celui-ci contient une description de niveau légèrement supérieur des instructions du bytecode EVM, ainsi que quelques annotations utiles :</p>
</div>
<div id="asm_output" class="listingblock data-line-289">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">/* "Example.sol":26:132  contract example {... */
  mstore(0x40, 0x60)
    /* "Example.sol":74:130  function example() {... */
  jumpi(tag_1, iszero(callvalue))
  0x0
  dup1
  revert
tag_1:
    /* "Example.sol":115:125  msg.sender */
  caller
    /* "Example.sol":99:112  contractOwner */
  0x0
  dup1
    /* "Example.sol":99:125  contractOwner = msg.sender */
  0x100
  exp
  dup2
  sload
  dup2
  0xffffffffffffffffffffffffffffffffffffffff
  mul
  not
  and
  swap1
  dup4
  0xffffffffffffffffffffffffffffffffffffffff
  and
  mul
  or
  swap1
  sstore
  pop
    /* "Example.sol":26:132  contract example {... */
  dataSize(sub_0)
  dup1
  dataOffset(sub_0)
  0x0
  codecopy
  0x0
  return
stop

sub_0: assembly {
        /* "Example.sol":26:132  contract example {... */
      mstore(0x40, 0x60)
      0x0
      dup1
      revert

    auxdata: 0xa165627a7a7230582056b99dcb1edd3eece01f27c9649c5abcc14a435efe3b...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-343">
<p>The --bin-runtime option produces the machine-readable hexadecimal bytecode:</p>
</div>
<div id="bin_output" class="listingblock data-line-346">
<div class="content">
<pre>60606040523415600e57600080fd5b336000806101000a81548173
ffffffffffffffffffffffffffffffffffffffff
021916908373
ffffffffffffffffffffffffffffffffffffffff
160217905550603580605b6000396000f3006060604052600080fd00a165627a7a7230582056b...</pre>
</div>
</div>
<div class="paragraph data-line-354">
<p>Vous pouvez enquêter sur ce qui se passe ici en détail en utilisant la liste des opcodes donnée dans <a href="#evm_bytecode_overview">Le jeu d&#39;instructions EVM (opérations de bytecode)</a>. Cependant, c&#39;est toute une tâche, alors commençons par examiner les quatre premières instructions :</p>
</div>
<div id="opcode_analysis_1" class="listingblock data-line-357">
<div class="content">
<pre>PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE</pre>
</div>
</div>
<div class="paragraph data-line-361">
<p>Ici, nous avons PUSH1 suivi d&#39;un octet brut de valeur 0x60. Cette instruction EVM prend l&#39;octet unique suivant l&#39;opcode dans le code du programme (en tant que valeur littérale) et le pousse sur la pile. Il est possible de pousser des valeurs de taille jusqu&#39;à 32 octets sur la pile, comme dans :</p>
</div>
<div class="listingblock data-line-363">
<div class="content">
<pre>PUSH32 0x436f6e67726174756c6174696f6e732120536f6f6e20746f206d617374657221</pre>
</div>
</div>
<div class="paragraph data-line-367">
<p>Le deuxième opcode PUSH1 de <em>example.opcode</em> stocke 0x40 en haut de la pile (en poussant le 0x60 déjà présent d&#39;un emplacement vers le bas).</p>
</div>
<div class="paragraph data-line-369">
<p>Vient ensuite MSTORE, qui est une opération de stockage en mémoire qui enregistre une valeur dans la mémoire de l&#39;EVM. Il prend deux arguments et, comme la plupart des opérations EVM, les obtient de la pile. Pour chaque argument, la pile est “poppée” (popped) c&#39;est-à-dire que la valeur supérieure de la pile est retirée et toutes les autres valeurs de la pile sont décalées d&#39;une position. Le premier argument de MSTORE est l&#39;adresse du mot en mémoire où sera mise la valeur à sauvegarder. Pour ce programme, nous avons 0x40 en haut de la pile, de sorte qu&#39;il est retiré de la pile et utilisé comme adresse mémoire. Le deuxième argument est la valeur à sauvegarder, qui est 0x60 ici. Après l&#39;exécution de l&#39;opération MSTORE, notre pile est à nouveau vide, mais nous avons la valeur 0x60 (96 en décimal) à l&#39;emplacement mémoire 0x40.</p>
</div>
<div class="paragraph data-line-371">
<p>L&#39;opcode suivant est CALLVALUE, qui est un opcode environnemental qui pousse vers le haut de la pile la quantité d&#39;ether (mesurée en wei) envoyée avec l&#39;appel de message qui a initié cette exécution.</p>
</div>
<div class="paragraph data-line-373">
<p>Nous pourrions continuer à parcourir ce programme de cette manière jusqu&#39;à ce que nous ayons une compréhension complète des changements d&#39;état de bas niveau que ce code effectue, mais cela ne nous aiderait pas à ce stade. Nous y reviendrons plus tard dans le chapitre. </p>
</div>
</div>
<div class="sect3 data-line-376">
<h4 id="contract_deployment_code">Code de déploiement du contrat</h4>
<div class="paragraph data-line-378">
<p>Il existe une différence importante mais subtile entre le code utilisé lors de la création et du déploiement d&#39;un nouveau contrat sur la plateforme Ethereum et le code du contrat lui-même. Afin de créer un nouveau contrat, une transaction spéciale est nécessaire dont le champ to est défini sur l&#39;adresse spéciale 0x0 et son champ data défini sur le <em>code d&#39;initiation</em> du contrat. Lorsqu&#39;une telle transaction de création de contrat est traitée, le code du nouveau compte de contrat n&#39;est <em>pas</em> le code du champ données de la transaction. Au lieu de cela, un EVM est instancié avec le code dans le champ data de la transaction chargée dans sa ROM de code de programme, puis la sortie de l&#39;exécution de ce code de déploiement est prise comme code pour le nouveau compte de contrat. C&#39;est ainsi que de nouveaux contrats peuvent être initialisés par programme en utilisant l&#39;état mondial Ethereum au moment du déploiement, en définissant des valeurs dans le stockage du contrat et même en envoyant de l&#39;ether ou en créant de nouveaux contrats.</p>
</div>
<div class="paragraph data-line-380">
<p>Lors de la compilation d&#39;un contrat hors ligne, par exemple, en utilisant solc sur la ligne de commande, vous pouvez soit obtenir le <em>code intermédiaire de déploiement</em> ou le <em>code intermédiaire d&#8217;exécution</em>.</p>
</div>
<div class="paragraph data-line-382">
<p>Le code intermédiaire de déploiement est utilisé pour chaque aspect de l&#39;initialisation d&#39;un nouveau compte de contrat, y compris le code intermédiaire qui finira par être exécuté lorsque les transactions appelleront ce nouveau contrat (c&#39;est-à-dire le code intermédiaire d&#39;exécution) et le code pour tout initialiser en fonction du constructeur du contrat.</p>
</div>
<div class="paragraph data-line-384">
<p>Le code intermédiaire d&#8217;exécution, en revanche, est exactement le bytecode qui finit par être exécuté lorsque le nouveau contrat est appelé, et rien de plus ; il n&#39;inclut pas le code intermédiaire nécessaire pour initialiser le contrat lors du déploiement.</p>
</div>
<div class="paragraph data-line-386">
<p>Prenons comme exemple le simple contrat <em>Faucet.sol</em> que nous avons créé précédemment :</p>
</div>
<div id="faucet_example" class="listingblock data-line-390">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version du compilateur Solidity pour lequel ce programme a été écrit
pragma solidity ^0.4.19;

// Notre premier contrat est un robinet !
contract Faucet {

  // Donnez de l&amp;#39;éther à quiconque demande
  function withdraw(uint withdraw_amount) public {

      // Limiter le montant du retrait
      require(withdraw_amount &lt;= 100000000000000000);

      // Envoie le montant à l&amp;#39;adresse qui l&amp;#39;a demandé
      msg.sender.transfer(withdraw_amount);
    }

  // Accepte tout montant entrant
  function () external payable {}

}</code></pre>
</div>
</div>
<div class="paragraph data-line-413">
<p>Pour obtenir le code intermédiaire de déploiement, nous exécuterions <code>solc --bin Faucet.sol</code>. Si nous voulions plutôt uniquement le code intermédiaire d&#39;exécution, nous exécuterions <code>solc --bin-runtime <span class="keep-together">Faucet.sol</span></code>.</p>
</div>
<div class="paragraph data-line-415">
<p>Si vous comparez la sortie de ces commandes, vous verrez que le code intermédiaire d&#39;exécution est un sous-ensemble du code intermédiaire de déploiement. En d&#39;autres termes, le code intermédiaire d&#39;exécution est entièrement contenu dans le code intermédiaire de déploiement.</p>
</div>
</div>
<div class="sect3 data-line-418">
<h4 id="disassembling_the_bytecode">Désassemblage du code intermédiaire</h4>
<div class="paragraph data-line-420">
<p>Le désassemblage du code intermédiaire EVM est un excellent moyen de comprendre comment le haut niveau de Solidity agit dans l&#39;EVM. Il existe quelques désassembleurs que vous pouvez utiliser pour cela :</p>
</div>
<div class="ulist data-line-422">
<ul>
<li class="data-line-422">
<p><a href="https://github.com/comaeio/porosity" data-href="https://github.com/comaeio/porosity"><em>Porosity</em></a> est un décompilateur à source libre populaire.</p>
</li>
<li class="data-line-423">
<p><a href="https://github.com/trailofbits/ethersplay" data-href="https://github.com/trailofbits/ethersplay"><em>Ethersplay</em></a> est un plug-in EVM pour Binary Ninja, un désassembleur.</p>
</li>
<li class="data-line-424">
<p><a href="https://github.com/trailofbits/ida-evm" data-href="https://github.com/trailofbits/ida-evm"><em>IDA-Evm</em></a> est un plugin EVM pour IDA, un autre désassembleur.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-426">
<p>Dans cette section, nous utiliserons le plug-in Ethersplay pour Binary Ninja et pour commencer <a href="#Faucet_disassembled">Démontage du code intermédiaire d&#39;exécution du robinet</a>. Après avoir obtenu le code intermédiaire d&#39;exécution de <em>Faucet.sol</em>, nous pouvons l&#39;introduire dans Binary Ninja (après avoir chargé le plug-in Ethersplay) pour voir à quoi ressemblent les instructions EVM.</p>
</div>
<div id="Faucet_disassembled" class="imageblock data-line-430">
<div class="content">
<img src="images/Faucet_disassembled.png" alt="&quot;Le code intermédiaire d&#39;exécution de Faucet.sol a été désassemblé&quot;">
</div>
<div class="title">Figure 56. Démontage du code intermédiaire d&#39;exécution du robinet</div>
</div>
<div class="paragraph data-line-432">
<p>Lorsque vous envoyez une transaction à un contrat intelligent compatible ABI (ce que vous pouvez supposer que tous les contrats le sont), la transaction interagit d&#39;abord avec le <em>répartiteur</em> de ce contrat intelligent. Le répartiteur lit le champ data de la transaction et envoie la partie pertinente à la fonction appropriée. Nous pouvons voir un exemple de répartiteur au début de notre code intermédiaire d&#39;exécution <em>Faucet.sol</em> désassemblé. Après l&#39;instruction familière MSTORE, nous voyons les instructions suivantes :</p>
</div>
<div id="faucet_instructions" class="listingblock data-line-435">
<div class="content">
<pre>PUSH1 0x4
CALLDATASIZE
LT
PUSH1 0x3f
JUMPI</pre>
</div>
</div>
<div class="paragraph data-line-443">
<p>Comme nous l&#39;avons vu, PUSH1 0x4 place 0x4 en haut de la pile, qui est autrement vide. CALLDATASIZE obtient la taille en octets des données envoyées avec la transaction (appelée <em>calldata</em>) et pousse ce nombre sur la pile. Une fois ces opérations exécutées, la pile ressemble à ceci :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-446" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;length of calldata from tx&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-452">
<p>Cette instruction suivante est LT, abréviation de &quot;plus petit que&quot;. L&#39;instruction LT vérifie si l&#39;élément du haut de la pile est inférieur à l&#39;élément suivant de la pile. Dans notre cas, il vérifie si le résultat de CALLDATASIZE est inférieur à 4 octets.</p>
</div>
<div class="paragraph data-line-454">
<p>Pourquoi l&#39;EVM vérifie-t-il que les données d&#39;appel de la transaction font au moins 4 octets ? En raison du fonctionnement des identificateurs de fonction. Chaque fonction est identifiée par les 4 premiers octets de son hachage Keccak-256. En plaçant le nom de la fonction et les arguments qu&#39;elle prend dans une fonction de hachage keccak256, nous pouvons déduire son identifiant de fonction. Dans notre cas, nous avons :</p>
</div>
<div id="faucet_function_identifier" class="listingblock data-line-457">
<div class="content">
<pre class="highlight"><code>keccak256("withdraw(uint256)") = 0x2e1a7d4d...</code></pre>
</div>
</div>
<div class="paragraph data-line-461">
<p>Ainsi, l&#39;identifiant de fonction pour la fonction withdraw(uint256) est 0x2e1a7d4d, puisqu&#39;il s&#39;agit des 4 premiers octets du hachage résultant. Un identifiant de fonction a toujours une longueur de 4 octets, donc si le champ entier data de la transaction envoyée au contrat est inférieur à 4 octets, alors il n&#39;y a pas de fonction avec laquelle la transaction pourrait éventuellement communiquer, à moins qu&#39;une <em>fonction de secours</em> ne soit définie. Parce que nous avons implémenté une telle fonction de secours dans <em>Faucet.sol</em>, l&#39;EVM saute à cette fonction lorsque la longueur des données d&#39;appel est inférieure à 4 octets.</p>
</div>
<div class="paragraph data-line-463">
<p>LT retire les deux premières valeurs de la pile et, si le champ data de la transaction est inférieur à 4 octets, il y pousse un 1. Sinon, il pousse un 0. Dans notre exemple, supposons que le champ data de la transaction envoyée à notre contrat <em>était</em> inférieur à 4 octets.</p>
</div>
<div class="paragraph data-line-465">
<p>L&#39;instruction PUSH1 0x3f pousse l&#39;octet 0x3f sur la pile. Après cette instruction, la pile ressemble à ceci :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-468" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3f</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-474">
<p>L&#39;instruction suivante est JUMPI, qui signifie &quot;sauter si&quot;. Cela fonctionne comme ceci :</p>
</div>
<div id="faucet_jump_instruction_text" class="listingblock data-line-477">
<div class="content">
<pre>jumpi(label, cond) // Aller à &amp;quot;label&amp;quot; si &amp;quot;cond&amp;quot; est vrai</pre>
</div>
</div>
<div class="paragraph data-line-481">
<p>Dans notre cas, label est 0x3f, où réside notre fonction de secours dans notre contrat intelligent. L&#39;argument cond est 1, qui était le résultat de l&#39;instruction LT précédente. Pour mettre toute cette séquence en mots, le contrat passe à la fonction de repli si les données de transaction sont inférieures à 4 octets.</p>
</div>
<div class="paragraph data-line-483">
<p>À 0x3f, seule une instruction STOP suit, car bien que nous ayons déclaré une fonction de repli, nous l&#39;avons laissée vide. Comme vous pouvez le voir dans <a href="#Faucet_jumpi_instruction">Instruction JUMPI menant à la fonction de repli</a>, si nous n&#39;avions pas implémenté une fonction de secours, le contrat lèverait une exception à la place.</p>
</div>
<div id="Faucet_jumpi_instruction" class="imageblock data-line-487">
<div class="content">
<img src="images/Faucet_jumpi_instruction.png" alt="&quot;Instruction JUMPI menant à la fonction de repli&quot;">
</div>
<div class="title">Figure 57. Instruction JUMPI menant à la fonction de repli</div>
</div>
<div class="paragraph data-line-489">
<p>Examinons le bloc central du répartiteur. En supposant que nous recevions des données d&#39;appel d&#39;une longueur supérieure à 4 octets, l&#39;instruction JUMPI ne passerait pas à la fonction de repli. Au lieu de cela, l&#39;exécution du code procéderait aux instructions suivantes :</p>
</div>
<div id="faucet_instructions2" class="listingblock data-line-492">
<div class="content">
<pre>PUSH1 0x0
CALLDATALOAD
PUSH29 0x1000000...
SWAP1
DIV
PUSH4 0xffffffff
AND
DUP1
PUSH4 0x2e1a7d4d
EQ
PUSH1 0x41
JUMPI</pre>
</div>
</div>
<div class="paragraph data-line-507">
<p>PUSH1 0x0 pousse 0 sur la pile, qui est maintenant à nouveau vide. CALLDATALOAD accepte comme argument un index dans les données d&#39;appel envoyées au contrat intelligent et lit 32 octets à partir de cet index, comme ceci :</p>
</div>
<div id="faucet_calldataload_instruction_text" class="listingblock data-line-510">
<div class="content">
<pre>calldataload(p) //charge 32 octets de données d&amp;#39;appel à partir de la position d&amp;#39;octet p</pre>
</div>
</div>
<div class="paragraph data-line-514">
<p>Puisque 0 était l&#39;index qui lui a été transmis par la commande PUSH1 0x0, CALLDATALOAD lit 32 octets de données d&#39;appel à partir de l&#39;octet 0, puis le pousse vers le haut de la pile (après avoir extrait le 0x0 d&#39;origine). Après l&#39;instruction PUSH29 0x1000000&#8230;&#8203;, la pile est alors :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-517" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000000&#8230;&#8203; (longueur de 29 octets)</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;32 bytes of calldata starting at byte 0&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-523">
<p>SWAP1 commute l&#39;élément supérieur sur la pile avec le <em>i</em>-ème élément après lui. Dans ce cas, il échange 0x1000000&#8230;&#8203; avec le calldata. La nouvelle pile est :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-526" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;32 bytes of calldata starting at byte 0&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000000&#8230;&#8203; (longueur de 29 octets)</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-532">
<p>L&#39;instruction suivante est DIV, qui fonctionne comme suit :</p>
</div>
<div id="faucet_div_instruction_text" class="listingblock data-line-535">
<div class="content">
<pre>div(x, y) // division entière x / y</pre>
</div>
</div>
<div class="paragraph data-line-539">
<p>Dans ce cas, x = 32 octets de calldata commençant à l&#39;octet 0, et y = 0x100000000&#8230;&#8203; (29 octets au total). Pouvez-vous penser à la raison pour laquelle le répartiteur fait la division ? Voici un indice : nous avons lu 32 octets de calldata plus tôt, en commençant à l&#39;index 0. Les 4 premiers octets de cette calldata sont l&#39;identifiant de la fonction.</p>
</div>
<div class="paragraph data-line-542">
<p>Le 0x100000000&#8230;&#8203; que nous avons poussé plus tôt fait 29 octets de long, composé d&#39;un 1 au début, suivi de tous les 0. Diviser nos 32 octets de données d&#39;appel par cette valeur ne nous laissera que les <em>4 octets les plus élevés</em> de notre charge de données d&#39;appel, à partir de l&#39;index 0. Ces 4 octets - les 4 premiers octets des données d&#39;appel commençant à l&#39;index 0 - sont l&#39;identifiant de la fonction, et cela est la façon dont l&#39;EVM extrait ce champ.</p>
</div>
<div class="paragraph data-line-544">
<p>Si cette partie n&#39;est pas claire pour vous, pensez-y comme ceci : en base 10, 1234000 / 1000 = 1234. En base 16, ce n&#39;est pas différent. Au lieu que chaque lieu soit un multiple de 10, c&#39;est un multiple de 16. Tout comme la division par 10<sup>3</sup> (1000) dans notre petit exemple ne conservait que les chiffres les plus élevés, divisant notre valeur de base 16 de 32 octets par 16<sup>29</sup> fait de même.</p>
</div>
<div class="paragraph data-line-546">
<p>Le résultat du DIV (l&#39;identifiant de la fonction) est poussé sur la pile, et notre pile est maintenant :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-549" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-554">
<p>Étant donné que les instructions PUSH4 0xffffffff et AND sont redondantes, nous pouvons les ignorer complètement, car la pile restera la même après leur exécution. L&#39;instruction DUP1 duplique le premier élément de la pile, qui est l&#39;identificateur de la fonction. L&#39;instruction suivante, PUSH4 0x2e1a7d4d, pousse l&#39;identificateur de fonction précalculé de la fonction <code><span class="keep-together">withdraw</span> (uint256)</code> sur la pile. La pile est maintenant :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-557" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2e1a7d4d</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-564">
<p>L&#39;instruction suivante, EQ, extrait les deux premiers éléments de la pile et les compare. C&#39;est là que le répartiteur fait son travail principal : il compare si l&#39;identifiant de la fonction envoyé dans le champ msg.data de la transaction correspond à celui de <code><span class="keep-together">withdraw</span> (uint256)</code>. S&#39;ils sont égaux, EQ pousse 1 sur la pile, qui sera finalement utilisé pour passer à la fonction de retrait. Sinon, EQ pousse 0 sur la pile.</p>
</div>
<div class="paragraph data-line-566">
<p>En supposant que la transaction envoyée à notre contrat a bien commencé avec l&#39;identifiant de fonction pour withdraw(uint256), notre pile est devenue :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-569" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt; (maintenant connu pour être 0x2e1a7d4d)</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-575">
<p>Ensuite, nous avons PUSH1 0x41, qui est l&#39;adresse à laquelle la fonction withdraw(uint256) vit dans le contrat. Après cette instruction, la pile ressemble à ceci :</p>
</div>
<table class="tableblock frame-ends grid-all data-line-578" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x41</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identifiant de la fonction envoyé dans msg.data</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-585">
<p>L&#39;instruction JUMPI est la suivante, et elle accepte à nouveau les deux premiers éléments de la pile comme arguments. Dans ce cas, nous avons jumpi(0x41, 1), qui indique à l&#39;EVM d&#39;exécuter le saut vers l&#39;emplacement de la fonction withdraw(uint256), et l&#39;exécution du code de cette fonction peut continuer.</p>
</div>
</div>
</div>
<div class="sect2 data-line-588">
<h3 id="turing_completeness_and_gas">Complétude de Turing et Gaz</h3>
<div class="paragraph data-line-590">
<p>Comme nous l&#39;avons déjà évoqué, en termes simples, un système ou langage de programmation est <em>Turing complet</em> s&#39;il peut exécuter n&#39;importe quel programme. Cette capacité, cependant, s&#39;accompagne d&#39;une mise en garde très importante : certains programmes prennent une éternité à s&#39;exécuter. Un aspect important de ceci est que nous ne pouvons pas dire, juste en regardant un programme, s&#39;il prendra une éternité ou non à s&#39;exécuter. Nous devons en fait suivre l&#39;exécution du programme et attendre qu&#39;il se termine pour le savoir. Bien sûr, si l&#39;exécution prend une éternité, nous devrons attendre une éternité pour le savoir. C&#39;est ce qu&#39;on appelle le <em>problème d&#39;arrêt</em> et ce serait un énorme problème pour Ethereum s&#39;il n&#39;était pas résolu.</p>
</div>
<div class="paragraph data-line-592">
<p>En raison du problème d&#39;arrêt, l&#39;ordinateur du monde Ethereum risque de se voir demander d&#39;exécuter un programme qui ne s&#39;arrête jamais. Cela pourrait être par accident ou par malveillance. Nous avons discuté du fait qu&#39;Ethereum agit comme une machine à un seul fil d&#8217;exécution, sans aucun planificateur, et donc s&#39;il était bloqué dans une boucle infinie, cela signifierait qu&#39;il deviendrait inutilisable.</p>
</div>
<div class="paragraph data-line-594">
<p>Cependant, avec le gaz, il existe une solution : si après qu&#39;une quantité maximale de calculs a été effectuée, l&#39;exécution n&#39;est pas terminée, l&#39;exécution du programme est stoppée par l&#39;EVM. Cela fait de l&#39;EVM une machine <em>quasi</em>–Turing-complète : elle peut exécuter n&#39;importe quel programme que vous lui introduisez, mais seulement si le programme se termine dans un certain nombre de calculs. Cette limite n&#39;est pas fixée dans Ethereum - vous pouvez payer pour l&#39;augmenter jusqu&#39;à un maximum (appelé &quot;limite de gaz de bloc&quot;), et tout le monde peut accepter d&#39;augmenter ce maximum au fil du temps. Néanmoins, à tout moment, il y a une limite en place, et les transactions qui consomment trop de gaz lors de l&#39;exécution sont <span class="keep-together">stoppées</span>.</p>
</div>
<div class="paragraph data-line-596">
<p>Dans les sections suivantes, nous examinerons le gaz et examinerons en détail son fonctionnement.</p>
</div>
</div>
<div class="sect2 data-line-599">
<h3 id="gas">Gaz</h3>
<div class="paragraph data-line-601">
<p>Le <em>gaz</em> est l&#39;unité d&#39;Ethereum pour mesurer les ressources de calcul et de stockage nécessaires pour effectuer des actions sur la chaîne de blocs Ethereum. Contrairement à Bitcoin, dont les frais de transaction ne tiennent compte que de la taille d&#39;une transaction en kilo-octets, Ethereum doit tenir compte de chaque étape de calcul effectuée par les transactions et l&#39;exécution du code de contrat intelligent.</p>
</div>
<div class="paragraph data-line-603">
<p>Chaque opération effectuée par une transaction ou un contrat coûte une quantité fixe de gaz. Quelques exemples, tirés du Ethereum Yellow Paper :</p>
</div>
<div class="ulist data-line-605">
<ul>
<li class="data-line-605">
<p>L&#39;ajout de deux nombres coûte 3 gaz</p>
</li>
<li class="data-line-606">
<p>Le calcul d&#39;un hachage Keccak-256 coûte 30 gaz + 6 gaz pour chaque 256 bits de données hachés</p>
</li>
<li class="data-line-607">
<p>L&#39;envoi d&#39;une transaction coûte 21 000 gaz</p>
</li>
</ul>
</div>
<div class="paragraph data-line-609">
<p>Le gaz est un composant crucial d&#39;Ethereum et joue un double rôle : comme tampon entre le prix (volatile) d&#39;Ethereum et la récompense des mineurs pour le travail qu&#39;ils font, et comme défense contre les attaques par déni de service. Pour éviter les boucles infinies accidentelles ou malveillantes ou tout autre gaspillage de calcul dans le réseau, l&#39;initiateur de chaque transaction est tenu de fixer une limite à la quantité de calcul qu&#39;il est prêt à payer. Le système de gaz décourage ainsi les attaquants d&#39;envoyer des transactions de &quot;spam&quot;, car ils doivent payer proportionnellement pour les ressources de calcul, de bande passante et de stockage qu&#39;ils consomment.</p>
</div>
<div class="sect3 data-line-612">
<h4 id="gas_accounting_execution">Comptabilisation du gaz pendant l&#39;exécution</h4>
<div class="paragraph data-line-613">
<p>Lorsqu&#39;une EVM est nécessaire pour effectuer une transaction, en premier lieu il reçoit un approvisionnement en gaz égal au montant spécifié par la limite de gaz dans la transaction. Chaque opcode exécuté a un coût en gaz, et donc l&#39;approvisionnement en gaz de l&#39;EVM est réduit au fur et à mesure que l&#39;EVM avance dans le programme. Avant chaque opération, l&#39;EVM vérifie qu&#39;il y a suffisamment de gaz pour payer l&#39;exécution de l&#39;opération. S&#39;il n&#39;y a pas assez de gaz, l&#39;exécution est interrompue et la transaction est annulée.</p>
</div>
<div class="paragraph data-line-615">
<p>Si l&#39;EVM atteint la fin de l&#39;exécution avec succès, sans manquer de gaz, le coût du gaz utilisé est payé au mineur sous forme de frais de transaction, converti en ether sur la base du prix du gaz spécifié dans la transaction :</p>
</div>
<div class="listingblock data-line-617">
<div class="content">
<pre>frais de mineur = coût du gaz * prix du gaz</pre>
</div>
</div>
<div class="paragraph data-line-622">
<p>Le gaz restant dans l&#39;approvisionnement en gaz est remboursé à l&#39;expéditeur, à nouveau converti en ether sur la base du prix du gaz spécifié dans la transaction :</p>
</div>
<div class="listingblock data-line-624">
<div class="content">
<pre>gaz restant = limite de gaz - coût du gaz
ether remboursé = gaz restant * prix du gaz</pre>
</div>
</div>
<div class="paragraph data-line-629">
<p>Si la transaction « manque de gaz » pendant l&#39;exécution, l&#39;opération est immédiatement terminée, ce qui déclenche une exception « à court de gaz » (OOG). La transaction est annulée et toutes les modifications apportées à l&#39;état sont annulées.</p>
</div>
<div class="paragraph data-line-631">
<p>Bien que la transaction ait échoué, l&#39;expéditeur se verra facturer des frais de transaction, car les mineurs ont déjà effectué le travail de calcul jusqu&#39;à ce point et doivent être indemnisés pour cela.</p>
</div>
</div>
<div class="sect3 data-line-633">
<h4 id="_considérations_sur_la_comptabilisation_du_gaz">Considérations sur la comptabilisation du gaz</h4>
<div class="paragraph data-line-635">
<p>Les coûts relatifs du gaz des différentes opérations pouvant être effectuées par l&#39;EVM ont ont été soigneusement choisis pour protéger au mieux la chaîne de blocs Ethereum contre les attaques. Vous pouvez voir un tableau détaillé des coûts de gaz pour différents opcodes EVM dans <a href="#evm_opcodes_table">EVM opcodes and gas cost</a>.</p>
</div>
<div class="paragraph data-line-637">
<p>Les opérations plus intensives en calcul coûtent plus de gaz. Par exemple, l&#39;exécution de la fonction SHA3 est 10 fois plus coûteuse (30 gaz) que l&#39;opération ADD (3 gaz). Plus important encore, certaines opérations, telles que EXP, nécessitent un paiement supplémentaire en fonction de la taille de l&#39;opérande. L&#39;utilisation de la mémoire EVM et le stockage des données dans le stockage en chaîne d&#39;un contrat entraînent également un coût en gaz.</p>
</div>
<div class="paragraph data-line-639">
<p>L&#39;importance de faire correspondre le coût du gaz au coût réel des ressources a été démontrée en 2016 lorsqu&#39;un attaquant a découvert et exploité une inadéquation des coûts. L&#39;attaque a généré des transactions très coûteuses en calcul et a presque paralysé le réseau principal Ethereum. Cette inadéquation a été résolue par un hard fork (nom de code &quot;Tangerine Whistle&quot;) qui a modifié les coûts relatifs du gaz.</p>
</div>
</div>
<div class="sect3 data-line-641">
<h4 id="_coût_du_gaz_versus_prix_du_gaz">Coût du gaz versus prix du gaz</h4>
<div class="paragraph data-line-642">
<p>Alors que le <em>coût</em> du gaz est une mesure de calcul et de stockage utilisée dans l&#39;EVM, le gaz lui-même a également un <em>prix</em> mesuré en ether. Lors d&#39;une transaction, l&#39;expéditeur spécifie le prix du gaz qu&#39;il est prêt à payer (en ether) pour chaque unité de gaz, permettant au marché de décider de la relation entre le prix de l&#39;ether et le coût des opérations informatiques (mesuré en gaz) :</p>
</div>
<div class="listingblock data-line-644">
<div class="content">
<pre>frais de transaction = total de gaz utilisé * prix du gaz payé (en ether)</pre>
</div>
</div>
<div class="paragraph data-line-648">
<p>Lors de la construction d&#39;un nouveau bloc, les mineurs du réseau Ethereum peuvent choisir parmi les transactions en attente en sélectionnant celles qui proposent de payer un prix du gaz plus élevé. Offrir un prix du gaz plus élevé incitera donc les mineurs à inclure votre transaction et à la faire confirmer plus rapidement.</p>
</div>
<div class="paragraph data-line-650">
<p>En pratique, l&#39;expéditeur d&#39;une transaction fixera une limite de gaz supérieure ou égale à la quantité de gaz qu&#39;il s&#39;attend à utiliser. Si la limite de gaz est fixée à une valeur supérieure à la quantité de gaz consommée, l&#39;expéditeur recevra un remboursement du montant excédentaire, car les mineurs ne sont indemnisés que pour le travail qu&#39;ils effectuent réellement.</p>
</div>
<div class="paragraph data-line-652">
<p>Il est important d&#39;être clair sur la distinction entre le <em>coût du gaz</em> et le <em>prix du gaz</em>. Récapituler:</p>
</div>
<div class="ulist data-line-654">
<ul>
<li class="data-line-654">
<p>Le coût du gaz est le nombre d&#39;unités de gaz nécessaires pour effectuer une opération particulière.</p>
</li>
<li class="data-line-656">
<p>Le prix du gaz est la quantité d&#39;ether que vous êtes prêt à payer par unité de gaz lorsque vous envoyez votre transaction au réseau Ethereum.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip data-line-659">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-660">
<p>Alors que le gaz a un prix, il ne peut pas être &quot;possédé&quot; ni &quot;dépensé&quot;. Le gaz n&#39;existe qu&#39;à l&#39;intérieur de l&#39;EVM, en tant que décompte de la quantité de travail de calcul effectué. L&#39;expéditeur se voit facturer des frais de transaction en ether, qui sont ensuite convertis en gaz pour la comptabilité EVM, puis de nouveau en ether en tant que frais de transaction payés aux mineurs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-664">
<h5 id="_coûts_de_gaz_négatifs">Coûts de gaz négatifs</h5>
<div class="paragraph data-line-666">
<p>Ethereum encourage la suppression des variables et des comptes de stockage utilisés en remboursant une partie du gaz utilisé lors de l&#39;exécution du contrat.</p>
</div>
<div class="paragraph data-line-668">
<p>Il y a deux opérations dans l&#39;EVM avec des coûts de gaz négatifs :</p>
</div>
<div class="ulist data-line-670">
<ul>
<li class="data-line-670">
<p>La suppression d&#39;un contrat (SELFDESTRUCT) vaut un remboursement de 24 000 gaz.</p>
</li>
<li class="data-line-671">
<p>Changer une adresse de stockage d&#39;une valeur différente de zéro à zéro (SSTORE[x] = 0) vaut un remboursement de 15 000 gaz.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-673">
<p>Pour éviter l&#39;exploitation du mécanisme de remboursement, le remboursement maximum pour une transaction est fixé à la moitié de la quantité totale de gaz consommée (arrondie à l&#39;inférieur).</p>
</div>
</div>
</div>
<div class="sect3 data-line-675">
<h4 id="_limite_de_gaz_du_bloc">Limite de gaz du bloc</h4>
<div class="paragraph data-line-677">
<p>La limite de gaz de bloc est la quantité maximale de gaz pouvant être consommée par toutes les transactions d&#39;un bloc et limite le nombre de transactions pouvant tenir dans un bloc.</p>
</div>
<div class="paragraph data-line-679">
<p>Par exemple, supposons que nous ayons 5 transactions dont les limites de gaz ont été fixées à 30 000, 30 000, 40 000, 50 000 et 50 000. Si la limite de gaz du bloc est de 180 000, alors quatre de ces transactions peuvent tenir dans un bloc, tandis que la cinquième devra attendre un futur bloc. Comme indiqué précédemment, les mineurs décident des transactions à inclure dans un bloc. Différents mineurs sont susceptibles de sélectionner différentes combinaisons, principalement parce qu&#39;ils reçoivent des transactions du réseau dans un ordre différent.</p>
</div>
<div class="paragraph data-line-681">
<p>Si un mineur essaie d&#39;inclure une transaction qui nécessite plus de gaz que la limite actuelle de gaz du bloc, le bloc sera rejeté par le réseau. La plupart des clients Ethereum vous empêcheront d&#39;émettre une telle transaction en donnant un avertissement du type &quot;la transaction dépasse la limite de gaz du bloc&quot;. La limite de gaz de bloc sur le réseau principal Ethereum est de 8 millions de gaz au moment de la rédaction selon <a href="https://etherscan.io" class="undefined" data-href="https://etherscan.io">https://etherscan.io</a>, ce qui signifie qu&#39;environ 380 transactions de base (chacune consommant 21 000 gaz) pourraient tenir dans un bloc.</p>
</div>
<div class="sect4 data-line-683">
<h5 id="_qui_décide_de_la_limite_de_gaz_du_bloc">Qui décide de la limite de gaz du bloc ?</h5>
<div class="paragraph data-line-685">
<p>Les mineurs du réseau décident collectivement de la limite de gaz du bloc. Les personnes qui souhaitent exploiter sur le réseau Ethereum utilisent un programme de minage, tel qu&#39;Ethminer, qui se connecte à un client Geth ou Parity Ethereum. Le protocole Ethereum a un mécanisme intégré où les mineurs peuvent voter sur la limite de gaz afin que la capacité puisse être augmentée ou diminuée dans les blocs suivants. Le mineur d&#39;un bloc peut voter pour ajuster la limite de gaz du bloc d&#39;un facteur de 1/1 024 (0,0976 %) dans les deux sens. Le résultat est une taille de bloc ajustable en fonction des besoins du réseau à ce moment-là. Ce mécanisme est couplé à une stratégie minière par défaut où les mineurs votent sur une limite de gaz d&#39;au moins 4,7 millions de gaz, mais qui cible une valeur de 150 % de la moyenne de la consommation totale récente de gaz par bloc (en utilisant un déplacement exponentiel de 1 024 blocs en moyenne).</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-687">
<h3 id="_conclusion_10">Conclusion</h3>
<div class="paragraph data-line-29">
<p>Dans ce chapitre, nous avons exploré la machine virtuelle Ethereum, en retraçant l&#39;exécution de divers contrats intelligents et en examinant comment l&#39;EVM exécute le bytecode. Nous avons également examiné le gaz, le mécanisme de comptabilité de l&#39;EVM, et avons vu comment il résout le problème d&#39;arrêt et protège Ethereum des attaques par déni de service. Ensuite, dans <a href="#consensus">Consensus</a>, nous examinerons le mécanisme utilisé par Ethereum pour parvenir à un consensus décentralisé.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="consensus">Consensus</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Tout au long de ce livre, nous avons parlé de &quot;règles de consensus&quot; - les règles que tout le monde doit accepter pour que le système fonctionne dans un environnement décentralisé. En informatique, le terme <em>consensus</em> est antérieur aux chaînes de blocs et est lié au problème plus large de la synchronisation de l&#39;état dans les systèmes distribués, de sorte que les différents participants d&#39;un système distribué s&#39;accordent tous (éventuellement) sur un seul état à l&#39;échelle du système. C&#39;est ce qu&#39;on appelle « parvenir à un consensus ».</p>
</div>
<div class="paragraph data-line-6">
<p>En ce qui concerne la fonction principale de tenue et de vérification décentralisées des dossiers, il peut devenir problématique de se fier uniquement à la confiance pour s&#39;assurer que les informations dérivées des mises à jour de l&#39;État sont correctes. Ce défi assez général est particulièrement prononcé dans les réseaux décentralisés car il n&#39;y a pas d&#39;entité centrale pour décider de ce qui est vrai. L&#39;absence d&#39;une entité décisionnelle centrale est l&#39;un des principaux attraits des plateformes chaîne de blocs, en raison de la capacité qui en résulte à résister à la censure et au manque de dépendance vis-à-vis de l&#39;autorité pour obtenir l&#39;autorisation d&#39;accéder aux informations. Cependant, ces avantages ont un coût : sans arbitre de confiance, tout désaccord, tromperie ou différence doit être concilié par d&#39;autres moyens. Les algorithmes de consensus sont le mécanisme utilisé pour concilier sécurité et décentralisation.</p>
</div>
<div class="paragraph data-line-8">
<p>Dans les chaînes de blocs, le consensus est une propriété essentielle du système. Bref, il y a de l&#39;argent en jeu ! Ainsi, dans le contexte des chaînes de blocs, le <em>consensus</em> consiste à pouvoir arriver à un état commun, tout en maintenant la décentralisation. En d&#39;autres termes, le consensus vise à produire un système de <em>règles strictes sans dirigeants</em>. Il n&#39;y a pas une personne, une organisation ou un groupe &quot;en charge&quot; ; plutôt, le pouvoir et le contrôle sont répartis sur un vaste réseau de participants, dont l&#39;intérêt personnel est servi en suivant les règles et en se comportant honnêtement.</p>
</div>
<div class="paragraph data-line-10">
<p>La capacité de parvenir à un consensus sur un réseau distribué, dans des conditions contradictoires, sans centraliser le contrôle est le principe fondamental de toutes les chaînes de blocs publiques ouvertes. Pour relever ce défi et maintenir la propriété précieuse de la décentralisation, la communauté continue d&#39;expérimenter différents modèles de consensus. Ce chapitre explore ces modèles de consensus et leur impact attendu sur les chaînes de blocs de contrats intelligents tels qu&#39;Ethereum.</p>
</div>
<div class="admonitionblock note data-line-13">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-14">
<p>Alors que les algorithmes de consensus sont une partie importante du fonctionnement des chaînes de blocs, ils fonctionnent à une couche fondamentale, bien en deçà de l&#39;abstraction des contrats intelligents. En d&#39;autres termes, la plupart des détails du consensus sont cachés aux auteurs de contrats intelligents. Vous n&#39;avez pas besoin de savoir comment ils fonctionnent pour utiliser Ethereum, pas plus que vous n&#39;avez besoin de savoir comment fonctionne le routage pour utiliser Internet.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2 data-line-17">
<h3 id="_consensus_via_une_preuve_de_travail">Consensus via une preuve de travail</h3>
<div class="paragraph data-line-19">
<p>Le créateur de la chaîne de blocs originale, Bitcoin, a inventé un <em>algorithme de consensus</em> appelé <em>Proof-of-Work</em> (PoW) ou <em>preuve de travail</em>. On peut dire que PoW est l&#39;invention la plus importante qui sous-tend Bitcoin. Le terme familier pour PoW est &quot;minage&quot;, ce qui crée un malentendu sur l&#39;objectif principal du consensus. Souvent, les gens supposent que le but de l&#39;exploitation minière est la création d&#39;une nouvelle monnaie, puisque le but de l&#39;exploitation minière dans le monde réel est l&#39;extraction de métaux précieux ou d&#39;autres ressources. Au contraire, le véritable objectif de l&#39;exploitation minière (et de tous les autres modèles de consensus) est de <em>sécuriser la chaîne de blocs</em>, tout en gardant le contrôle du système décentralisé et diffusé entre autant de participants que possible. La récompense de la monnaie nouvellement frappée est une incitation pour ceux qui contribuent à la sécurité du système : un moyen pour une fin. En ce sens, la récompense est le moyen et la sécurité décentralisée est la fin. Dans le consensus PoW, il existe également une &quot;punition&quot; correspondante, qui est le coût de l&#39;énergie nécessaire pour participer à l&#39;exploitation minière. Si les participants ne suivent pas les règles et ne gagnent pas la récompense, ils risquent les fonds qu&#39;ils ont déjà dépensés en électricité pour miner. Ainsi, le consensus PoW est un équilibre prudent entre risque et récompense qui pousse les participants à se comporter honnêtement par intérêt personnel.</p>
</div>
<div class="paragraph data-line-21">
<p>Ethereum est actuellement une chaîne de blocs PoW, en ce sens qu&#39;elle utilise un algorithme PoW avec le même système d&#39;incitation de base pour le même objectif de base : sécuriser la chaîne de blocs tout en décentralisant le contrôle. L&#39;algorithme PoW d&#39;Ethereum est légèrement différent de celui de Bitcoin et s&#39;appelle <em>Ethash</em>. Nous examinerons la fonction et les caractéristiques de conception de l&#39;algorithme dans <a href="#ethash">Ethash : l&#39;algorithme de preuve de travail d&#39;Ethereum</a>.</p>
</div>
</div>
<div class="sect2 data-line-23">
<h3 id="_consensus_via_preuve_denjeu_pos">Consensus via preuve d&#8217;enjeu (PoS)</h3>
<div class="paragraph data-line-25">
<p>Historiquement, la preuve de travail n&#39;était pas le premier algorithme de consensus proposé. Avant l&#39;introduction de la preuve de travail, de nombreux chercheurs avaient proposé des variantes d&#39;algorithmes de consensus basés sur l&#39;enjeu financier, désormais appelés <em>preuve d&#39;enjeu</em> (PoS). À certains égards, la preuve de travail a été inventée comme une alternative à la preuve d&#39;enjeu. Suite au succès de Bitcoin, de nombreuses chaînes de blocs ont émulé la preuve de travail. Pourtant, l&#39;explosion de la recherche sur les algorithmes de consensus a également ressuscité la preuve d&#39;enjeu, faisant progresser considérablement l&#39;état de la technologie. Dès le début, les fondateurs d&#39;Ethereum espéraient éventuellement migrer son algorithme de consensus vers la preuve d&#39;enjeu. En fait, il existe un handicap délibéré sur la preuve de travail d&#39;Ethereum appelée la <em>bombe de difficulté</em>, destinée à rendre progressivement de plus en plus difficile le minage de preuve de travail d&#39;Ethereum, forçant ainsi le passage à la preuve d&#39;enjeu.</p>
</div>
<div class="paragraph data-line-27">
<p>Au moment de la publication de ce livre, Ethereum utilise toujours la preuve de travail, mais la recherche en cours vers une alternative de preuve d&#8217;enjeu touche à sa fin. L&#39;algorithme PoS prévu par Ethereum s&#39;appelle <em>Casper</em>. L&#39;introduction de Casper en remplacement d&#39;Ethash a été repoussée à plusieurs reprises au cours des deux dernières années, nécessitant des interventions pour désamorcer la bombe de difficulté et repousser l&#8217;obsolescence forcée de la preuve de travail.</p>
</div>
<div class="paragraph data-line-29">
<p>En général, un algorithme PoS fonctionne comme suit. La chaîne de blocs garde la trace d&#39;un ensemble de validateurs, et toute personne qui détient la cryptomonnaie de base de la chaîne de blocs (dans le cas d&#39;Ethereum, l&#39;ether) peut devenir un validateur en envoyant un type spécial de transaction qui verrouille son ether dans un dépôt. Les validateurs proposent et votent à tour de rôle sur le prochain bloc valide, et le poids du vote de chaque validateur dépend de la taille de son dépôt (c&#39;est-à-dire de sa mise). Il est important de noter qu&#39;un validateur risque de perdre son dépôt si le bloc sur lequel il l&#39;a misé est rejeté par la majorité des validateurs. Inversement, les validateurs gagnent une petite récompense, proportionnelle à leur mise déposée, pour chaque bloc accepté par la majorité. Ainsi, le PoS oblige les validateurs à agir honnêtement et à suivre les règles du consensus, par un système de récompense et de punition. La principale différence entre PoS et PoW est que la punition dans PoS est intrinsèque à la chaîne de blocs (par exemple, perte d&#39;ether en enjeu), alors que dans PoW, la punition est extrinsèque (par exemple, perte de fonds dépensés en <span class="keep-together">électricité</span>).</p>
</div>
</div>
<div class="sect2 data-line-32">
<h3 id="ethash">Ethash : l&#39;algorithme de preuve de travail d&#39;Ethereum</h3>
<div class="paragraph data-line-34">
<p>Ethash est l&#39;algorithme Ethereum PoW. Il utilise une évolution de l&#39;algorithme Dagger-Hashimoto, qui est une combinaison de l&#39;algorithme Dagger de Vitalik Buterin et de l&#39;algorithme Hashimoto de Thaddeus Dryja. Ethash dépend de la génération et de l&#39;analyse d&#39;un grand ensemble de données, connu sous le nom de <em>graphe acyclique dirigé</em> (ou, plus simplement, « le DAG »). Le DAG avait une taille initiale d&#39;environ 1 Go et continuera à croître lentement et linéairement, étant mis à jour une fois par époque (30 000 blocs, soit environ 125 heures).</p>
</div>
<div class="paragraph data-line-36">
<p>Le but du DAG est de rendre l&#39;algorithme Ethash PoW dépendant du maintien d&#39;une grande structure de données fréquemment consultée. Cette dernière à son tour est destiné à rendre Ethash &quot;résistant aux ASIC&quot;, ce qui signifie qu&#39;il est plus difficile de fabriquer des équipements d&#39;exploitation de <em>circuits intégrés spécifiques à l&#39;application</em> (ASIC) qui sont des ordres de grandeur plus rapides qu&#39;une <em>unité de traitement graphique</em> (GPU) rapide. Les fondateurs d&#39;Ethereum voulaient éviter la centralisation dans l&#39;exploitation minière PoW, où ceux qui avaient accès à des usines de fabrication de silicium spécialisées et à de gros budgets pourraient dominer l&#39;infrastructure minière et compromettre la sécurité de l&#39;algorithme de consensus.</p>
</div>
<div class="paragraph data-line-38">
<p>L&#39;utilisation de GPU grand public pour effectuer le PoW sur le réseau Ethereum signifie que davantage de personnes dans le monde peuvent participer au processus de minage. Plus il y a de mineurs indépendants, plus la puissance minière est décentralisée, ce qui signifie que nous pouvons éviter une situation comme dans Bitcoin, où une grande partie de la puissance minière est concentrée entre les mains de quelques grandes exploitations minières industrielles. L&#39;inconvénient de l&#39;utilisation des GPU pour l&#39;exploitation minière est qu&#39;elle a précipité une pénurie mondiale de GPU en 2017, provoquant une montée en flèche de leur prix et un tollé des joueurs. Cela a conduit à des restrictions d&#39;achat chez les détaillants, limitant les acheteurs à un ou deux GPU par client.</p>
</div>
<div class="paragraph data-line-40">
<p>Jusqu&#39;à récemment, la menace des mineurs ASIC sur le réseau Ethereum était largement inexistante. L&#39;utilisation d&#39;ASIC pour Ethereum nécessite la conception, la fabrication et la distribution de matériel hautement personnalisé. Leur production nécessite un investissement considérable en temps et en argent. Les plans exprimés de longue date par les développeurs d&#39;Ethereum de passer à un algorithme de consensus PoS ont probablement empêché les fournisseurs d&#39;ASIC de cibler le réseau Ethereum pendant longtemps. Dès qu&#39;Ethereum passera au PoS, les ASIC conçus pour l&#39;algorithme PoW seront rendus inutiles, c&#39;est-à-dire à moins que les mineurs ne puissent les utiliser pour exploiter d&#39;autres crypto-monnaies à la place. Cette dernière possibilité est désormais une réalité avec une gamme d&#39;autres pièces de consensus basées sur Ethash disponibles, telles que PIRL et Ubiq, et Ethereum Classic s&#39;est engagé à rester une chaîne de blocs PoW dans un avenir prévisible. Cela signifie que nous verrons probablement l&#39;exploitation minière ASIC commencer à devenir une force sur le réseau Ethereum alors qu&#39;il fonctionne toujours sur le consensus PoW.</p>
</div>
</div>
<div class="sect2 data-line-42">
<h3 id="_casper_lalgorithme_de_preuve_de_participation_dethereum">Casper : l&#39;algorithme de preuve de participation d&#39;Ethereum</h3>
<div class="paragraph data-line-44">
<p>Casper est le nom proposé pour l&#39;algorithme de consensus PoS d&#39;Ethereum. Il est toujours en recherche et développement actif et n&#39;est pas implémenté sur la chaîne de blocs Ethereum au moment de la publication de ce livre. Casper est développé en deux &quot;saveurs&quot; concurrentes :</p>
</div>
<div class="ulist data-line-46">
<ul>
<li class="data-line-46">
<p>Casper FFG: "The Friendly Finality Gadget"</p>
</li>
<li class="data-line-47">
<p>Casper CBC: "The Friendly GHOST/Correct-by-Construction"</p>
</li>
</ul>
</div>
<div class="paragraph data-line-49">
<p>Initialement, Casper FFG a été proposé comme un algorithme hybride PoW/PoS à implémenter comme une transition vers un algorithme &quot;pur PoS&quot; plus permanent. Mais en juin 2018, Vitalik Buterin, qui dirigeait les travaux de recherche sur Casper FFG, a décidé de &quot;mettre fin&quot; au modèle hybride au profit d&#39;un algorithme PoS pur. Désormais, Casper FFG et Casper CBC sont développés en parallèle. Comme l&#39;explique Vitalik :</p>
</div>
<div class="quoteblock data-line-51">
<blockquote>
<div class="paragraph data-line-52">
<p>Le principal compromis entre FFG et CBC est que CBC semble avoir de meilleures propriétés théoriques, mais FFG semble être plus facile à mettre en œuvre.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-55">
<p>Plus d&#39;informations sur l&#39;histoire de Casper, les recherches en cours et les plans futurs peuvent être trouvées sur les liens suivants :</p>
</div>
<div class="ulist data-line-57">
<ul>
<li class="data-line-57">
<p><a href="http://bit.ly/2RO5HAl" data-href="http://bit.ly/2RO5HAl">Ethereum Casper (preuve d&#8217;enjeu)</a></p>
</li>
<li class="data-line-58">
<p><a href="http://bit.ly/2FlBojb" data-href="http://bit.ly/2FlBojb">Histoire de Casper, partie 1</a></p>
</li>
<li class="data-line-59">
<p><a href="http://bit.ly/2QyHiic" data-href="http://bit.ly/2QyHiic">Histoire de Casper, partie 2</a></p>
</li>
<li class="data-line-60">
<p><a href="http://bit.ly/2JWWFyt" data-href="http://bit.ly/2JWWFyt">Histoire de Casper, partie 3</a></p>
</li>
<li class="data-line-61">
<p><a href="http://bit.ly/2FsaExI" data-href="http://bit.ly/2FsaExI">Histoire de Casper, partie 4</a></p>
</li>
<li class="data-line-62">
<p><a href="http://bit.ly/2PPhhOv" data-href="http://bit.ly/2PPhhOv">Histoire de Casper, partie 5</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-64">
<h3 id="_principes_de_consensus">Principes de Consensus</h3>
<div class="paragraph data-line-66">
<p>Les principes et hypothèses des algorithmes de consensus peuvent être mieux compris en posant quelques questions clés :</p>
</div>
<div class="ulist data-line-68">
<ul>
<li class="data-line-68">
<p>Qui peut changer le passé, et comment ? (Ceci est également connu sous le nom d&#39;_immutabilité_.)</p>
</li>
<li class="data-line-69">
<p>Qui peut changer le futur, et comment ? (Ceci est également connu sous le nom de <em>finalité</em>.)</p>
</li>
<li class="data-line-70">
<p>Quel est le coût pour effectuer de tels changements ?</p>
</li>
<li class="data-line-71">
<p>Dans quelle mesure le pouvoir d&#39;apporter de tels changements est-il décentralisé ?</p>
</li>
<li class="data-line-72">
<p>Qui saura si quelque chose a changé, et comment le saura-t-il ?</p>
</li>
</ul>
</div>
<div class="paragraph data-line-74">
<p>Les algorithmes de consensus évoluent rapidement, tentant de répondre à ces questions de manière de plus en plus innovante.</p>
</div>
</div>
<div class="sect2 data-line-76">
<h3 id="_controverse_et_compétition">Controverse et Compétition</h3>
<div class="paragraph data-line-78">
<p>À ce stade, vous vous demandez peut-être : pourquoi avons-nous besoin d&#39;autant d&#39;algorithmes de consensus différents ? Laquelle fonctionne mieux ? La réponse à cette dernière question est au centre du domaine de recherche le plus passionnant sur les systèmes distribués de la dernière décennie. Tout se résume à ce que vous considérez comme &quot;meilleur&quot; - ce qui, dans le contexte de l&#39;informatique, concerne les hypothèses, les objectifs et les compromis inévitables.</p>
</div>
<div class="paragraph data-line-80">
<p>Il est probable qu&#39;aucun algorithme ne puisse optimiser toutes les dimensions du problème du consensus décentralisé. Lorsque quelqu&#39;un suggère qu&#39;un algorithme de consensus est &quot;meilleur&quot; que les autres, vous devriez commencer à poser des questions qui clarifient : mieux en quoi ? Immutabilité, finalité, décentralisation, coût ? Il n&#39;y a pas de réponse claire à ces questions, du moins pas encore. De plus, la conception d&#39;algorithmes de consensus est au centre d&#39;une industrie de plusieurs milliards de dollars et génère d&#39;énormes controverses et des arguments passionnés. En fin de compte, il se peut qu&#39;il n&#39;y ait pas de réponse &quot;correcte&quot;, tout comme il peut y avoir des réponses différentes pour différentes applications.</p>
</div>
<div class="paragraph data-line-82">
<p>L&#39;ensemble de l&#39;industrie de la chaîne de blocs est une expérience géante où ces questions seront testées dans des conditions contradictoires, avec une énorme valeur monétaire en jeu. En fin de compte, l&#39;histoire répondra à la controverse.</p>
</div>
</div>
<div class="sect2 data-line-84">
<h3 id="_conclusion_11">Conclusion</h3>
<div class="paragraph data-line-31">
<p>L&#39;algorithme de consensus d&#39;Ethereum est toujours en évolution au moment de l&#39;achèvement de ce livre. Dans une future édition, nous ajouterons probablement plus de détails sur Casper et d&#39;autres technologies connexes à mesure qu&#39;elles mûriront et seront déployées sur Ethereum. Ce chapitre représente la fin de notre voyage, complétant <em>Maîtriser Ethereum</em>. Des documents de référence supplémentaires suivent dans les annexes. Merci d&#39;avoir lu ce livre et félicitations pour avoir atteint la fin !</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="ethereum_fork_history">Appendix A: Historique de la fourche Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Most hard forks are planned as part of an upgrade roadmap and consist of updates that the community generally agrees to (i.e., there is social consensus). However, some hard forks lack consensus, which leads to multiple distinct blockchains. The events that led to the Ethereum/Ethereum Classic split are one such case, and are discussed in this appendix.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="etc_origin">Ethereum Classic (ETC)</h3>
<div class="paragraph data-line-8">
<p>Ethereum Classic came to be after members of the Ethereum community implemented a time-sensitive hard fork (codenamed &#x201c;DAO&#x201d;). On July 20, 2016, at a block height of 1.92 million, Ethereum introduced an irregular state change via a hard fork in an effort to return approximately 3.6 million ether that had been taken from a smart contract known as The DAO. Almost everyone agreed that the ether taken had been stolen and that leaving it all in the hands of the thief would be of significant detriment to the development of the Ethereum ecosystem as well as the platform itself.</p>
</div>
<div class="paragraph data-line-10">
<p>Returning the ether to its respective owners as though The DAO had never even existed was technically easy, if rather politically controversial. A number of people in the ecosystem disagreed with this change, believing immutability should be a fundamental principle of the Ethereum blockchain without exception; they elected to continue the original chain under the moniker of Ethereum Classic. While the split itself was initially ideological, the two chains have since evolved into separate entities.</p>
</div>
</div>
<div class="sect2 data-line-13">
<h3 id="dao_origin">The Decentralized Autonomous Organization (The DAO)</h3>
<div class="paragraph data-line-15">
<p>The DAO was created by Slock.it, with the aim of providing community-based funding and governance for projects. The core idea was that proposals would be submitted, curators would manage proposals, funds would be raised from investors within the Ethereum community, and, if the projects proved successful, investors would receive a share of the profits.</p>
</div>
<div class="paragraph data-line-17">
<p>The DAO was also one of the first experiments in an Ethereum token. Rather than funding projects directly with ether, participants would trade their ether for DAO tokens, use them to vote on project funding, and later be able to trade them back for ether.</p>
</div>
<div class="paragraph data-line-19">
<p>DAO tokens were available to purchase in a crowdsale that ran from April 5 through April 30, 2016, amassing <a href="https://econ.st/2qfJO1g" data-href="https://econ.st/2qfJO1g">nearly 14%</a> of the total ether in existence, which was worth ~$150 million at the time.</p>
</div>
</div>
<div class="sect2 data-line-22">
<h3 id="dao_reentrancy_bug">The Reentrancy Bug</h3>
<div class="paragraph data-line-24">
<p>On June 9, 2016, developers Peter Vessenes and Chriseth reported that most Ethereum-based contracts that managed funds were potentially <a href="http://bit.ly/2AAaDmA" data-href="http://bit.ly/2AAaDmA">vulnerable to an exploit</a> that could empty contract funds. A few days later, on June 12, Stephen Tual (cofounder of Slock.it) reported that <a href="http://bit.ly/2qmo3g1" data-href="http://bit.ly/2qmo3g1">The DAO&#8217;s code was not vulnerable</a> to the bug described by Peter and Chriseth. Worried DAO contributors breathed a sigh of relief&#x2014;until five days later, when an unknown attacker started <a href="http://bit.ly/2Q7zR1h" data-href="http://bit.ly/2Q7zR1h">draining The DAO</a> using an exploit similar to the one for which the warning had been issued. Ultimately, the DAO attacker siphoned ~3.6 million ether out of The DAO.</p>
</div>
<div class="paragraph data-line-26">
<p>Simultaneously, an assemblage of volunteers calling themselves the Robin Hood Group (RHG) started using the same exploit to withdraw the remaining funds in order to save them from being stolen by the DAO attacker. On June 21, <a href="http://bit.ly/2PtX4xl" data-href="http://bit.ly/2PtX4xl">the RHG announced</a> that they had secured about 70% of The DAO&#8217;s funds (roughly 7.2 million ether), with plans to return it to the community (which they successfully did on the ETC network, and didn&#8217;t need to do on the Ethereum network after the fork). Many thanks and commendations were given to the RHG for their quick thinking and fast actions that helped secure the bulk of the community&#8217;s ether.</p>
</div>
<div class="sect3 data-line-29">
<h4 id="dao_reentrancy_bug_technicals">Technical Details</h4>
<div class="paragraph data-line-30">
<p>While a more detailed and thorough explanation of the bug is given by <a href="http://bit.ly/2EQaLCI" data-href="http://bit.ly/2EQaLCI">Phil Daian</a>, the short explanation is that a crucial function in the DAO had two lines of code in the wrong order, meaning that the attacker could have requests to withdraw ether acted upon repeatedly, before the check of whether the attacker was entitled to the withdrawal was completed. This type of vulnerability is described in <a href="#reentrancy_security">Réentrance</a>.</p>
</div>
</div>
<div class="sect3 data-line-33">
<h4 id="dao_reentrancy_bug_attack_flow">Attack Flow</h4>
<div class="paragraph data-line-34">
<p>Imagine you had $100 in your bank account and you could bring your bank teller any number of withdrawal slips. The teller would give you money for each slip in order, and only after processing all the slips would they record your withdrawal. What if you brought them three slips, each requesting withdraw $100? What if you brought them three thousand?</p>
</div>
<div class="paragraph data-line-36">
<p>The DAO attack worked like this:</p>
</div>
<div class="olist arabic data-line-38">
<ol class="arabic">
<li class="data-line-38">
<p>The DAO attacker asks the DAO contract to withdraw DAO tokens (DAO).</p>
</li>
<li class="data-line-39">
<p>The attacker asks the contract to withdraw DAO <em>again</em>, before the contract updates its records to show that DAO was withdrawn.</p>
</li>
<li class="data-line-40">
<p>The attacker repeats step 2 as many times as possible.</p>
</li>
<li class="data-line-41">
<p>The contract finally logs a single DAO withdrawal, losing track of the withdrawals that happened in the interim.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2 data-line-44">
<h3 id="dao_hard_fork">The DAO Hard Fork</h3>
<div class="paragraph data-line-45">
<p>Fortunately, there were several safeguards built into The DAO: notably, all withdrawal requests were subject to a 28-day delay. This gave the community a little while to discuss what to do about the exploit, because from roughly June 17&#x2013;July 20 the DAO attacker would be unable to convert their DAO tokens into ether.</p>
</div>
<div class="paragraph data-line-47">
<p>Several developers focused on finding a viable solution, and multiple avenues were explored in this short space of time. Among them were a <a href="http://bit.ly/2qhruEK" data-href="http://bit.ly/2qhruEK"><em>DAO soft fork</em></a>, announced on June 24, to delay DAO withdrawals until consensus was reached, and a <a href="http://bit.ly/2AAGjIu" data-href="http://bit.ly/2AAGjIu"><em>DAO hard fork</em></a>, announced on July 15, to reverse the effects of the DAO attack with an exceptional state change.</p>
</div>
<div class="paragraph data-line-49">
<p>On June 28, developers discovered <a href="http://bit.ly/2zgOxUn" data-href="http://bit.ly/2zgOxUn">a DoS exploit in the DAO soft fork</a>  and concluded that the DAO hard fork would be the only viable option to fully resolve the situation. The DAO hard fork would transfer all ether that had been invested in The DAO into a new refund smart contract, allowing the original owners of the ether to claim full refunds. This provided a solution for returning the hacked funds, but also meant interfering with the balances of specific addresses on the network, however isolated they were. There would also be some leftover ether in portions of The DAO known as <em>childDAOs</em>. A group of trustees would manually authorize the leftover ether, worth <a href="http://bit.ly/2RuUrJh" data-href="http://bit.ly/2RuUrJh">~$6–7 million</a> at the time.</p>
</div>
<div class="paragraph data-line-51">
<p>With time running out, multiple Ethereum development teams created clients that allowed a user to decide whether they wanted to enable this fork. However, the client creators wanted to decide whether to make this choice opt-in (don&#8217;t fork by default) or opt-out (fork by default). On July 15, a vote was opened on <a href="http://bit.ly/2ABkTuV" data-href="http://bit.ly/2ABkTuV"><em>carbonvote.com</em></a>. The next day, at block height <a href="http://bit.ly/2yHb7Gl" data-href="http://bit.ly/2yHb7Gl">1,894,000</a>, it was closed. Of the <a href="http://bit.ly/2RuUrJh" data-href="http://bit.ly/2RuUrJh">5.5% of the total ether supply</a> that voted, &#x7e;80% of the votes (&#x7e;4.5% of the total ether supply) voted for opt-out. One-quarter of the opt-out vote came from a single address.</p>
</div>
<div class="paragraph data-line-53">
<p>Ultimately the decision became opt-out, so those who opposed the DAO hard fork would need to explicitly state their opposition by changing a configuration option in the software they were running.</p>
</div>
<div class="paragraph data-line-55">
<p>On July 20, at block height <a href="http://bit.ly/2zfaIKB" data-href="http://bit.ly/2zfaIKB">1,920,000</a>, Ethereum <a href="http://bit.ly/2yJxZ83" data-href="http://bit.ly/2yJxZ83">implemented the DAO hard fork</a> and thus two Ethereum networks were created: one including the state change, and the other ignoring it.</p>
</div>
<div class="paragraph data-line-57">
<p>When the DAO hard-forked Ethereum (present-day Ethereum) gained a majority of the mining power, many assumed that consensus was achieved and the minority chain would fade away, as in previous forks. Despite this, a sizable portion of the Ethereum community (roughly 10% by value and mining power) started supporting the non-forked chain, which came to be known as Ethereum Classic.</p>
</div>
<div class="paragraph data-line-59">
<p>Within days of the fork, several exchanges began to list both Ethereum ("ETH") and Ethereum Classic ("ETC"). Due to the nature of hard forks, all Ethereum users holding ether at the time of the split then held funds on both of the chains, and a market value for ETC was soon established with <a href="http://bit.ly/2qhuNvP" data-href="http://bit.ly/2qhuNvP">Poloniex</a> listing ETC on July 24.</p>
</div>
<div class="sect3 data-line-62">
<h4 id="dao_hard_fork_timeline">Timeline of the DAO Hard Fork</h4>
<div class="ulist data-line-64">
<ul>
<li class="data-line-64">
<p>April 5, 2016: Slock.it <a href="http://bit.ly/2Db4boE" data-href="http://bit.ly/2Db4boE">releases a security review</a> of the generic DAO framework smart contracts by Deja Vu Security.</p>
</li>
<li class="data-line-65">
<p>April 30, 2016: The DAO crowdsale <a href="http://bit.ly/2qhwhpI" data-href="http://bit.ly/2qhwhpI">launches</a>.</p>
</li>
<li class="data-line-66">
<p>May 27, 2016: The DAO crowdsale ends.</p>
</li>
<li class="data-line-67">
<p>June 9, 2016: A generic <a href="http://bit.ly/2AAaDmA" data-href="http://bit.ly/2AAaDmA">recursive call bug</a> is discovered and believed to affect many Solidity contracts that track users' balances.</p>
</li>
<li class="data-line-68">
<p>June 12, 2016: Stephen Tual <a href="http://bit.ly/2qmo3g1" data-href="http://bit.ly/2qmo3g1">declares</a> that The DAO&#8217;s funds are not at risk.</p>
</li>
<li class="data-line-69">
<p>June 17, 2016: <a href="http://bit.ly/2EQaLCI" data-href="http://bit.ly/2EQaLCI">The DAO is exploited</a> and a variant of the discovered bug (termed the "reentrancy bug") is used to start draining the funds, eventually nabbing ~30% of the ether.</p>
</li>
<li class="data-line-70">
<p>June 21, 2016: The RHG <a href="http://bit.ly/2zgl3Gk" data-href="http://bit.ly/2zgl3Gk">announces</a> it has secured the other ~70% of the ether stored within The DAO.</p>
</li>
<li class="data-line-71">
<p>June 24, 2016: A <a href="http://bit.ly/2qhruEK" data-href="http://bit.ly/2qhruEK">soft fork vote</a> is announced via opt-in signaling through Geth and Parity clients, designed to temporarily withhold funds until the community can better decide what to do.</p>
</li>
<li class="data-line-72">
<p>June 28, 2016: A <a href="http://bit.ly/2zgOxUn" data-href="http://bit.ly/2zgOxUn">vulnerability</a> is discovered in the soft fork and it&#8217;s abandoned.</p>
</li>
<li class="data-line-73">
<p>June 28, 2016 to July 15: Users debate whether or not to hard fork; most of the vocal public debate occurs on the <em>/r/ethereum</em> subreddit.</p>
</li>
<li class="data-line-74">
<p>July 15, 2016: The <a href="http://bit.ly/2qmo3g1" data-href="http://bit.ly/2qmo3g1">DAO hard fork</a> is proposed, to return the funds taken in the DAO attack.</p>
</li>
<li class="data-line-75">
<p>July 15, 2016: A <a href="http://bit.ly/2ABkTuV" data-href="http://bit.ly/2ABkTuV">vote is held</a> on CarbonVote to decide if the DAO hard fork will be opt-in (don&#8217;t fork by default) or opt-out (fork by default).</p>
</li>
<li class="data-line-76">
<p>July 16, 2016: <a href="http://bit.ly/2RuUrJh" data-href="http://bit.ly/2RuUrJh">5.5% of the total ether supply votes</a>; ~80% of the votes (~4.5% of the total supply) are pro the opt-out hard fork, with one-quarter of the pro-vote coming from a single address.</p>
</li>
<li class="data-line-77">
<p>July 20, 2016: The <a href="http://bit.ly/2yJxZ83" data-href="http://bit.ly/2yJxZ83">hard fork</a> occurs at block 1,920,000.</p>
</li>
<li class="data-line-78">
<p>July 20, 2016: Those against the DAO hard fork continue running the old client software; this leads to issues with <a href="http://bit.ly/2qjJm27" data-href="http://bit.ly/2qjJm27">transactions being replayed on both chains</a>.</p>
</li>
<li class="data-line-79">
<p>July 24, 2016: <a href="http://bit.ly/2qhuNvP" data-href="http://bit.ly/2qhuNvP">Poloniex lists</a> the original Ethereum chain under the ticker symbol ETC; it&#8217;s the first exchange to do so.</p>
</li>
<li class="data-line-80">
<p>August 10, 2016: The RHG <a href="http://bit.ly/2JrLpK2" data-href="http://bit.ly/2JrLpK2">transfers 2.9</a> million of the recovered ETC to Poloniex in order to convert it to ETH on the advice of Bity SA; 14% of the total RHG holdings are converted from ETC to ETH and other cryptocurrencies, and <a href="http://bit.ly/2ETDdUc" data-href="http://bit.ly/2ETDdUc">Poloniex freezes</a> the other 86% of deposited ETH.</p>
</li>
<li class="data-line-81">
<p>August 30, 2016: The frozen funds are sent by Poloniex back to the RHG, which then sets up a refund contract on the ETC chain.</p>
</li>
<li class="data-line-82">
<p>December 11, 2016: IOHK&#8217;s ETC development team forms, led by Ethereum founding member Charles Hoskinson.</p>
</li>
<li class="data-line-83">
<p>January 13, 2017: The ETC network is updated to resolve transaction replay issues; the chains are now functionally separate.</p>
</li>
<li class="data-line-84">
<p>February 20, 2017: The ETCDEVTeam forms, led by early ETC developer Igor Artamonov (splix).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 data-line-87">
<h3 id="eth_etc_differences">Ethereum and Ethereum Classic</h3>
<div class="paragraph data-line-89">
<p>While the initial split was centered around The DAO, the two networks, Ethereum and Ethereum Classic, are now separate projects, although most development is still done by the Ethereum community and simply ported to Ethereum Classic codebases. Nevertheless, the full set of differences is constantly evolving and too extensive to cover in this appendix. However, it is worth noting that the chains do differ significantly in their core development and community structure. A few of the technical differences are discussed next.</p>
</div>
<div class="sect3 data-line-93">
<h4 id="eth_etc_differences_evm">The EVM</h4>
<div class="paragraph data-line-94">
<p>For the most part (at the time of writing), the two networks remain highly compatible: contract code produced for one chain runs as expected on the other; but there are some small differences in EVM OPCODES (see EIPs <a href="http://bit.ly/2yIajkF" data-href="http://bit.ly/2yIajkF">140</a>, <a href="http://bit.ly/2qhKz9Y" data-href="http://bit.ly/2qhKz9Y">145</a>, and <a href="http://bit.ly/2SxsrFR" data-href="http://bit.ly/2SxsrFR">214</a>).</p>
</div>
</div>
<div class="sect3 data-line-97">
<h4 id="eth_etc_differences_core_development">Core Network Development</h4>
<div class="paragraph data-line-98">
<p>Being open projects, blockchain platforms often have many users and contributors. However, the core network development (i.e., of the code that runs the network) is often done by small groups due to the expertise and knowledge required to develop this type of software. On Ethereum, this work is done by the Ethereum Foundation and volunteers. On Ethereum Classic, it&#8217;s done by ETCDEV, IOHK, and volunteers.</p>
</div>
</div>
</div>
<div class="sect2 data-line-101">
<h3 id="ethereum_forks">Other Notable Ethereum Forks</h3>
<div class="paragraph data-line-103">
<p><a href="https://ellaism.org/about/" data-href="https://ellaism.org/about/">Ellaism</a> is an Ethereum-based network that intends to use PoW exclusively to secure the blockchain. It has no pre-mine and no mandatory developer fees, with all support and development donated freely by the community. Its developers believe this makes theirs &#x201c;one of the most honest pure Ethereum projects,&#x201d; and one that is &#x201c;uniquely interesting as a platform for serious developers, educators, and enthusiasts. Ellaism is a pure smart contract platform. Its goal is to create a smart contract platform that is both fair and trustworthy.&#x201d; The principles of the platform are as follows:</p>
</div>
<div class="quoteblock data-line-105">
<blockquote>
<div class="ulist data-line-106">
<ul>
<li class="data-line-106">
<p>All changes and upgrades to the protocol should strive to maintain and reinforce these Principles of Ellaism.</p>
</li>
<li class="data-line-107">
<p>Monetary Policy: 280 million coins.</p>
</li>
<li class="data-line-108">
<p>No Censorship: Nobody should be able to prevent valid txs from being confirmed.</p>
</li>
<li class="data-line-109">
<p>Open-Source: Ellaism source code should always be open for anyone to read, modify, copy, share.</p>
</li>
<li class="data-line-110">
<p>Permissionless: No arbitrary gatekeepers should ever prevent anybody from being part of the network (user, node, miner, etc).</p>
</li>
<li class="data-line-111">
<p>Pseudonymous: No ID should be required to own, use Ellaism.</p>
</li>
<li class="data-line-112">
<p>Fungible: All coins are equal and should be equally spendable.</p>
</li>
<li class="data-line-113">
<p>Irreversible Transactions: Confirmed blocks should be set in stone. Blockchain History should be immutable.</p>
</li>
<li class="data-line-114">
<p>No Contentious Hard Forks: Never hard fork without consensus from the whole community. Only break the existing consensus when necessary.</p>
</li>
<li class="data-line-115">
<p>Many feature upgrades can be carried out without a hard fork, such as improving the performance of the EVM.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph data-line-118">
<p>Several other forks have occurred on Ethereum as well. Some of these are hard forks, in the sense that they split directly off of the preexisting Ethereum network. Others are software forks: they use Ethereum&#8217;s client/node software but run entirely separate networks without any history shared with Ethereum. There will likely be more forks over the life of Ethereum.</p>
</div>
<div class="paragraph data-line-120">
<p>There are also several other projects that claim to be Ethereum forks but are actually based on ERC20 tokens and run on the Ethereum network. Two examples of these are EtherBTC (ETHB) and Ethereum Modification (EMOD). These are not forks in the traditional sense, and may sometimes be called &#x201c;airdrops.&#x201d;</p>
</div>
<div class="paragraph data-line-122">
<p>Here&#8217;s a brief rundown of some of the more notable forks that have occurred:</p>
</div>
<div class="ulist data-line-124">
<ul>
<li class="data-line-124">
<p><em>Expanse</em> was the first fork of the Ethereum blockchain to gain traction. It was announced via the Bitcoin Talk forum on September 7, 2015. The actual fork occurred a week later on September 14, 2015, at a block height of 800,000. It was originally founded by Christopher Franko and James Clayton. Their stated vision was to create an advanced chain for: "identity, governance, charity, commerce, and equity".</p>
</li>
<li class="data-line-125">
<p><em>EthereumFog</em> (ETF) was launched on December 14, 2017, and forked at a block height of 4,730,660. The project&#8217;s stated aim is to develop "world decentralized fog computing" by focusing on fog computing and decentralized storage. There is still little information on what this will actually entail.</p>
</li>
<li class="data-line-126">
<p><em>EtherZero</em> (ETZ) was launched on January 19, 2018, at a block height of 4,936,270. Its notable innovations were the introduction of a masternode architecture and the removal of transaction fees for smart contracts to enable a wider diversity of DApps. There has been some criticism from some prominent members of the Ethereum community, MyEtherWallet, and MetaMask, due to the lack of clarity surrounding development and some accusations of possible phishing.</p>
</li>
<li class="data-line-127">
<p><em>EtherInc</em> (ETI) was launched on February 13, 2018, at a block height of 5,078,585, with a focus on building decentralized organizations. Stated goals include the reduction of block times, increased miner rewards, the removal of uncle rewards, and setting a cap on mineable coins. EtherInc uses the same private keys as Ethereum and has implemented replay protection to protect ether on the original non-forked chain.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="ethereum_standards">Appendix B: Normes Ethereum</h2>
<div class="sectionbody">
<div class="sect2 data-line-6">
<h3 id="eips">Ethereum Improvement Proposals (EIPs)</h3>
<div class="paragraph data-line-8">
<p>The Ethereum Improvement Proposal repository is located at <a href="https://github.com/ethereum/EIPs/" class="undefined" data-href="https://github.com/ethereum/EIPs/">https://github.com/ethereum/EIPs/</a>. The workflow is illustrated in <a href="#eip_workflow">Ethereum Improvement Proposal workflow</a>.</p>
</div>
<div class="paragraph data-line-10">
<p>From <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1.md" data-href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1.md">EIP-1</a>:</p>
</div>
<div class="quoteblock data-line-12">
<blockquote>
<div class="paragraph data-line-13">
<p>EIP stands for Ethereum Improvement Proposal. An EIP is a design document providing information to the Ethereum community, or describing a new feature for Ethereum or its processes or environment. The EIP should provide a concise technical specification of the feature and a rationale for the feature. The EIP author is responsible for building consensus within the community and documenting dissenting opinions.</p>
</div>
</blockquote>
</div>
<div id="eip_workflow" class="imageblock data-line-18">
<div class="content">
<img src="images/eip_workflow.png" alt="Ethereum Improvement Proposal Workflow">
</div>
<div class="title">Figure 58. Ethereum Improvement Proposal workflow</div>
</div>
</div>
<div class="sect2 data-line-21">
<h3 id="eip_table">Table of Most Important EIPs and ERCs</h3>
<table class="tableblock frame-all grid-all stretch data-line-25">
<caption class="title">Table 8. Important EIPs and ERCs</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">EIP/ERC #</th>
<th class="tableblock halign-left valign-top">Title/Description</th>
<th class="tableblock halign-left valign-top">Author</th>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Created</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OVq6qa" data-href="http://bit.ly/2OVq6qa">EIP-1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIP Purpose and Guidelines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Martin Becze, Hudson Jameson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Meta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yJtTNa" data-href="http://bit.ly/2yJtTNa">EIP-2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Homestead Hard-fork Changes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Jrx93V" data-href="http://bit.ly/2Jrx93V">EIP-5</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gas Usage for <code>RETURN</code> and <code>CALL*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OYbc2t" data-href="http://bit.ly/2OYbc2t">EIP-6</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renaming SUICIDE Opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hudson Jameson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2JxdBeN" data-href="http://bit.ly/2JxdBeN">EIP-7</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELEGATECALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Q6Oly6" data-href="http://bit.ly/2Q6Oly6">EIP-8</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">devp2p Forward Compatibility Requirements for Homestead</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Felix Lange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Networking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">EIP-20</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC-20 Token Standard. Describes standard functions a token contract may implement to allow DApps and wallets to handle tokens across multiple interfaces/DApps. Methods include: <code>totalSupply</code>, balanceOf(address), <code>transfer</code>, <code>transferFrom</code>, <code>approve</code>, <code>allowance</code>. Events include: <code>Transfer</code> (triggered when tokens are transferred), <span class="keep-together"><code>Approval</code></span> (triggered when <code>approve</code> is called).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fabian Vogelsteller, Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frontier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Q6R4YB" data-href="http://bit.ly/2Q6R4YB">EIP-55</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mixed-case checksum address encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OgE5la" data-href="http://bit.ly/2OgE5la">EIP-86</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstraction of transaction origin and signature. Sets the stage for "abstracting out" account security and allowing users to create "account contracts," moving toward a model where in the long term all accounts are contracts that can pay for gas, and users are free to define their own security models that perform any desired signature verification and nonce checks (instead of using the in-protocol mechanism where ECDSA and the default nonce scheme are the only "standard" way to secure an account, which is currently hardcoded into transaction processing).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deferred (to be replaced)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constantinople</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2QedSFC" data-href="http://bit.ly/2QedSFC">EIP-96</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blockhash and state root changes. Stores blockhashes in the state to reduce protocol complexity and need for complex client implementations to process the <code>BLOCKHASH</code> opcode. Extends range of how far back blockhash checking may go, with the side effect of creating direct links between blocks with very distant block numbers to facilitate much more efficient initial light client syncing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deferred</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constantinople</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2AC05DM" data-href="http://bit.ly/2AC05DM">EIP-100</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change difficulty adjustment to target mean block time and including uncles.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Jr1zDv" data-href="http://bit.ly/2Jr1zDv">EIP-101</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity Currency and Crypto Abstraction. Abstracts ether up a level with the benefit of allowing ether and subtokens to be treated similarly by contracts, reduces the level of indirection required for custom-policy accounts such as multisigs, and purifies the underlying Ethereum protocol by reducing the minimal consensus implementation complexity.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity feature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity Casper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Q5sdEv" data-href="http://bit.ly/2Q5sdEv">EIP-105</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary sharding plus contract calling semantics. "Sharding scaffolding" EIP to allow Ethereum transactions to be parallelized using a binary tree sharding mechanism, and to set the stage for a later sharding scheme. Research in progress; see <a href="https://github.com/ethereum/sharding" class="undefined" data-href="https://github.com/ethereum/sharding">https://github.com/ethereum/sharding</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity feature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity Casper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yG2Dzi" data-href="http://bit.ly/2yG2Dzi">EIP-137</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethereum Domain Name Service - Specification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nick Johnson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yJtWZm" data-href="http://bit.ly/2yJtWZm">EIP-140</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New Opcode: REVERT. Adds <code>REVERT</code> opcode instruction, which stops execution and rolls back the EVM execution state changes without consuming all provided gas (instead the contract only has to pay for memory) or losing logs, and returns to the caller a pointer to the memory location with the error code or message.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Beregszaszi, Nikolai Mushegian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CQMXfe" data-href="http://bit.ly/2CQMXfe">EIP-141</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated invalid EVM instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Beregszaszi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qhKz9Y" data-href="http://bit.ly/2qhKz9Y">EIP-145</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise shifting instructions in EVM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Beregszaszi, Paweł Bylica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deferred</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qhxflQ" data-href="http://bit.ly/2qhxflQ">EIP-150</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gas cost changes for IO-heavy operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CQUgne" data-href="http://bit.ly/2CQUgne">EIP-155</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple replay attack protection. Replay Attack allows any transaction using a pre-EIP-155 Ethereum node or client to become signed so it is valid and executed on both the Ethereum and Ethereum Classic chains.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Homestead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2JryBmT" data-href="http://bit.ly/2JryBmT">EIP-158</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State clearing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superseded</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR6VGY" data-href="http://bit.ly/2CR6VGY">EIP-160</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXP cost increase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OfU96M" data-href="http://bit.ly/2OfU96M">EIP-161</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State trie clearing (invariant-preserving alternative)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Wood</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2JxdKil" data-href="http://bit.ly/2JxdKil">EIP-162</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial ENS Hash Registrar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maurelian, Nick Johnson, Alex Van de Sande</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OgsOkO" data-href="http://bit.ly/2OgsOkO">EIP-165</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC-165 Standard Interface Detection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Reitwiessner et al.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OgCWu1" data-href="http://bit.ly/2OgCWu1">EIP-170</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract code size limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2ERNv7g" data-href="http://bit.ly/2ERNv7g">EIP-181</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENS support for reverse resolution of Ethereum addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nick Johnson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2P0wPz5" data-href="http://bit.ly/2P0wPz5">EIP-190</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethereum Smart Contract Packaging Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Piper Merriam et al.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2SwNQiz" data-href="http://bit.ly/2SwNQiz">EIP-196</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precompiled contracts for addition and scalar multiplication on the elliptic curve alt_bn128. Required in order to perform zkSNARK verification within the block gas limit.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2ETDC9a" data-href="http://bit.ly/2ETDC9a">EIP-197</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precompiled contracts for optimal ate pairing check on the elliptic curve alt_bn128. Combined with EIP-196.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin, Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2DdTCRN" data-href="http://bit.ly/2DdTCRN">EIP-198</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Big integer modular exponentiation. Precompile enabling RSA signature verification and other cryptographic applications.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qjYJr3" data-href="http://bit.ly/2qjYJr3">EIP-211</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New opcodes: <code>RETURNDATASIZE</code> and <code>RETURNDATACOPY</code>. Adds support for returning variable-length values inside the EVM with simple gas charging and minimal change to calling opcodes using new opcodes <code>RETURNDATASIZE</code> and <code>RETURNDATACOPY</code>. Handles similar to existing <code>calldata</code>, whereby after a call, return data is kept inside a virtual buffer from which the caller can copy it (or parts thereof) into memory, and upon the next call, the buffer is overwritten.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OgV0Eb" data-href="http://bit.ly/2OgV0Eb">EIP-214</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New opcode: <code>STATICCALL</code>. Permits non-state-changing calls to itself or other contracts while disallowing any modifications to state during the call (and its subcalls, if present) to increase smart contract security and assure developers that re-entrancy bugs cannot arise from the call. Calls the child with <code>STATIC</code> flag set to <code>true</code> for execution of child, causing exception to be thrown upon any attempts to make state-changing operations inside an execution instance where <code>STATIC</code> is <code>true</code>, and resets flag once call returns.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin, Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2JssHlJ" data-href="http://bit.ly/2JssHlJ">EIP-225</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rinkeby testnet using proof of authority where blocks are only mined by trusted signers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Péter Szilágyi</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Homestead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yPBavd" data-href="http://bit.ly/2yPBavd">EIP-234</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add <code>blockHash</code> to JSON-RPC filter options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micah Zoltu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yKrBNM" data-href="http://bit.ly/2yKrBNM">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subroutines and Static Jumps for the EVM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greg Colvin, Paweł Bylica, Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2AzGX99" data-href="http://bit.ly/2AzGX99">EIP-616</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIMD Operations for the EVM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greg Colvin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qjYX1n" data-href="http://bit.ly/2qjYX1n">EIP-681</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL Format for Transaction Requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel A. Nagy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OYgE5n" data-href="http://bit.ly/2OYgE5n">EIP-649</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Difficulty Bomb Delay and Block Reward Reduction. Delayed the Ice Age (aka Difficulty Bomb) by 1 year, and reduced the block reward from 5 to 3 ether.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Afri Schoedon, Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2RoGCvH" data-href="http://bit.ly/2RoGCvH">EIP-658</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Embedding transaction status code in receipts. Fetches and embeds a status field indicative of success or failure state to transaction receipts for callers, as it&#8217;s no longer possible to assume the transaction failed if and only if it consumed all gas after the introduction of the <code>REVERT</code> opcode in EIP-140.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nick Johnson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Ogwpzs" data-href="http://bit.ly/2Ogwpzs">EIP-706</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEVp2p snappy compression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Péter Szilágyi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Networking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2AAkCIP" data-href="http://bit.ly/2AAkCIP">EIP-721</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC-721 Non-Fungible Token Standard. A standard API that allows smart contracts to operate as unique tradable non-fungible tokens (NFTs) that may be tracked in standardized wallets and traded on exchanges as assets of value, similar to ERC20. CryptoKitties was the first popularly adopted implementation of a digital NFT in the Ethereum ecosystem.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">William Entriken, Dieter Shirley, Jacob Evans, Nastassia Sachs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qmuDmJ" data-href="http://bit.ly/2qmuDmJ">EIP-758</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscriptions and filters for completed transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jack Peterson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2RnqlHy" data-href="http://bit.ly/2RnqlHy">EIP-801</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC-801 Canary Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ligi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2DdTKkf" data-href="http://bit.ly/2DdTKkf">EIP-827</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC827 Token Standard. An extension of the standard interface ERC20 for tokens with methods that allow the execution of calls inside transfer and approvals. This standard provides basic functionality to transfer tokens, as well as allowing tokens to be approved so they can be spent by another on-chain third party. Also, it allows the developer to execute calls on transfers and approvals.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Augusto Lemble</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Jq2hAM" data-href="http://bit.ly/2Jq2hAM">EIP-930</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC930 Eternal Storage. The ES (Eternal Storage) contract is owned by an address that has write permissions. The storage is public, which means everyone has read permissions. It stores the data in mappings, using one mapping per type of variable. The use of this contract allows the developer to migrate the storage easily to another contract if needed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Augusto Lemble</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="evm_opcodes">Appendix C: Opcodes Ethereum EVM et consommation de gaz</h2>
<div class="sectionbody">
<div class="paragraph data-line-5">
<p>This appendix is based on the consolidation work done by the people of <a href="https://github.com/trailofbits/evm-opcodes" class="undefined" data-href="https://github.com/trailofbits/evm-opcodes">https://github.com/trailofbits/evm-opcodes</a> as a reference for Ethereum VM (EVM) opcodes and instruction information licensed under the <a href="http://bit.ly/2zfrv0b" data-href="http://bit.ly/2zfrv0b">Apache License 2.0</a>.</p>
</div>
<table id="evm_opcodes_table" class="tableblock frame-all grid-all stretch data-line-10">
<caption class="title">Table 9. EVM opcodes and gas cost</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Opcode</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Extra info</th>
<th class="tableblock halign-left valign-top">Gas</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halts execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x01</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addition operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x02</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x03</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtraction operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer division operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x05</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDIV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed integer division operation (truncated)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x06</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo remainder operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x07</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed modulo remainder operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x08</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDMOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo addition operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x09</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULMOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo multiplication operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exponential operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10***</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIGNEXTEND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extend length of two&#8217;s complement signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0c</code> - <code>0x0f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less-than comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater-than comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed less-than comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SGT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed greater-than comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equality comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISZERO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple NOT operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise AND operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise OR operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x18</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise XOR operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x19</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise NOT operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x1a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BYTE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve single byte from word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x1b</code> - <code>0x1f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHA3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Keccak-256 hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x21</code> - <code>0x2f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get address of currently executing account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BALANCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get balance of the given account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORIGIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get execution origination address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x33</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get caller address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x34</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLVALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get deposited value by the instruction/transaction responsible for this execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x35</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLDATALOAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get input data of current environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x36</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLDATASIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get size of input data in current environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x37</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLDATACOPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy input data in current environment to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x38</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CODESIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get size of code running in current environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x39</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CODECOPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy code running in current environment to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GASPRICE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get price of gas in current environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXTCODESIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get size of an account&#8217;s code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXTCODECOPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy an account&#8217;s code to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETURNDATASIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pushes the size of the return data buffer onto the stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2zaBcNe" data-href="http://bit.ly/2zaBcNe">EIP-211</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETURNDATACOPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copies data from the return data buffer to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2zaBcNe" data-href="http://bit.ly/2zaBcNe">EIP-211</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x40</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLOCKHASH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the hash of one of the 256 most recent complete blocks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x41</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COINBASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s beneficiary address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x42</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x43</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NUMBER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x44</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIFFICULTY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s difficulty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x45</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GASLIMIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s gas limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x46</code> - <code>0x4f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x50</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove word from stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x51</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MLOAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load word from memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x52</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSTORE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save word to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x53</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSTORE8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save byte to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x54</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLOAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load word from storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x55</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSTORE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save word to storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x56</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alter the program counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x57</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditionally alter the program counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x58</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GETPC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the value of the program counter prior to the increment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x59</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the size of active memory in bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x5a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the amount of available gas, including the corresponding reduction in the amount of available gas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x5b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPDEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a valid destination for jumps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x5c</code> - <code>0x5f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x60</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 1-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x61</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 2-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x62</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 3-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x63</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 4-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x64</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 5-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x65</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 6-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x66</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 7-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x67</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 8-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x68</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 9-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x69</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 10-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 11-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 12-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 13-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 14-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 15-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 16-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x70</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 17-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x71</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 18-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x72</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 19-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 20-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x74</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 21-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x75</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 22-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x76</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 23-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x77</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 24-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x78</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 25-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x79</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 26-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 27-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 28-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 29-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 30-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 31-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 32-byte (full word) item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 1st stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x81</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 2nd stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x82</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 3rd stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x83</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 4th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x84</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 5th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x85</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 6th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x86</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 7th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x87</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 8th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x88</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 9th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x89</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 10th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 11th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 12th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 13th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 14th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 15th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 16th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x90</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 2nd stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x91</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 3rd stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x92</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 4th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x93</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 5th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x94</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 6th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x95</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 7th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x96</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 8th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x97</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 9th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x98</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 10th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x99</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 11th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 12th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 13th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 14th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 15th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 16th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 17th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with no topics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">375</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with one topic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with two topics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1125</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with three topics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with four topics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1875</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa5</code> - <code>0xaf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPTO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative <a href="http://bit.ly/2Sx2Vkg" data-href="http://bit.ly/2Sx2Vkg">libevmasm has different numbers</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP 615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPSUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPSUBV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEGINSUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEGINDATA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETURNSUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUTLOCAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xba</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GETLOCA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xbb</code> - <code>0xe0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xe1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLOADBYTES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only referenced in pyethereum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xe2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSTOREBYTES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only referenced in pyethereum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xe3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only referenced in pyethereum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xe4</code> - <code>0xef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new account with associated code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-call into an account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complicated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLCODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-call into this account with alternative account&#8217;s code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complicated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETURN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halt execution returning output data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELEGATECALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-call into this account with an alternative account&#8217;s code, but persisting into this account with an alternative account&#8217;s code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complicated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLBLACKBOX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf6</code> - <code>0xf9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STATICCALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to CALL, but does not modify state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new account and set creation address to <code>sha3(sender + sha3(init code)) % 2**160</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TXEXECGAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not in yellow paper FIXME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REVERT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop execution and revert state changes, without consuming all provided gas and providing a reason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfe</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INVALID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated invalid instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELFDESTRUCT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halt execution and register account for later deletion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000*</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="dev_tools_frameworks">Appendix D: Outils de développement, cadres de développement, <span class="keep-together">et bibliothèques</span></h2>
<div class="sectionbody">
<div class="sect2 data-line-5">
<h3 id="_frameworks">Frameworks</h3>
<div class="paragraph data-line-7">
<p>Frameworks can be used to ease Ethereum smart contract development. By doing everything yourself you get a better understanding of how everything fits together, but it&#8217;s a lot of tedious, repetitive work. The frameworks described in this section can automate certain tasks and make development easier.</p>
</div>
<div class="sect3 data-line-10">
<h4 id="truffle">Truffle</h4>
<div class="paragraph data-line-12">
<p>GitHub: <a href="https://github.com/trufflesuite/truffle" class="undefined" data-href="https://github.com/trufflesuite/truffle">https://github.com/trufflesuite/truffle</a></p>
</div>
<div class="paragraph data-line-14">
<p>Website: <a href="https://truffleframework.com" class="undefined" data-href="https://truffleframework.com">https://truffleframework.com</a></p>
</div>
<div class="paragraph data-line-16">
<p>Documentation: <a href="https://truffleframework.com/docs" class="undefined" data-href="https://truffleframework.com/docs">https://truffleframework.com/docs</a></p>
</div>
<div class="paragraph data-line-18">
<p>Truffle Boxes: <a href="http://truffleframework.com/boxes/" class="undefined" data-href="http://truffleframework.com/boxes/">http://truffleframework.com/boxes/</a></p>
</div>
<div class="paragraph data-line-20">
<p>npm package repository: <a href="https://www.npmjs.com/package/truffle" class="undefined" data-href="https://www.npmjs.com/package/truffle">https://www.npmjs.com/package/truffle</a></p>
</div>
<div class="sect4 data-line-24">
<h5 id="installing_truffle">Installing the Truffle framework</h5>
<div class="paragraph data-line-26">
<p>The Truffle framework comprises several Node.js packages. Before you install truffle, you need to have an up-to-date and working installation of Node.js and the Node Package Manager (npm).</p>
</div>
<div class="paragraph data-line-28">
<p>The recommended way to install Node.js and npm is to use the Node Version Manager (nvm). Once you install nvm, it will handle all the dependencies and updates for you. Follow the instructions found at <a href="http://nvm.sh" class="undefined" data-href="http://nvm.sh">http://nvm.sh</a>.</p>
</div>
<div class="paragraph data-line-30">
<p>Once nvm is installed on your operating system, installing Node.js is simple. Use the --lts flag to tell nvm that you want the most recent &#x201c;long-term support&#x201d; (LTS) version of Node.js:</p>
</div>
<pre data-type="programlisting">
$ <strong>nvm install --lts</strong>
</pre>
<div class="paragraph data-line-38">
<p>Confirm you have node and npm installed:</p>
</div>
<pre data-type="programlisting">
$ <strong>node -v</strong>
v8.9.4
$ <strong>npm -v</strong>
5.6.0
</pre>
<div class="paragraph data-line-49">
<p>Next, create a hidden file, <em>.nvmrc</em>, that contains the Node.js version supported by your DApp so developers just need to run <code>nvm install</code> in the root of the project directory and it will automatically install and switch to using that version:</p>
</div>
<pre data-type="programlisting">
$ <strong>node -v &gt; .nvmrc</strong>
$ <strong>nvm install</strong>
</pre>
<div class="paragraph data-line-58">
<p>Looking good. Now to install truffle:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm -g install truffle</strong>

+ truffle@4.0.6
installed 1 package in 37.508s
</pre>
</div>
<div class="sect4 data-line-70">
<h5 id="truffle_box">Integrating a prebuilt Truffle project (Truffle Box)</h5>
<div class="paragraph data-line-72">
<p>If you want to use or create a DApp that builds upon prebuilt boilerplate, go to the Truffle Boxes website, choose an existing Truffle project, and then run the following command to download and extract it:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle unbox <em>BOX_NAME</em></strong>
</pre>
</div>
<div class="sect4 data-line-81">
<h5 id="truffle_project_directory">Creating a truffle project directory</h5>
<div class="paragraph data-line-83">
<p>For each project where you will use truffle, create a project directory and initialize truffle within that directory. truffle will create the necessary directory structure inside your project directory. It&#8217;s customary to give the project directory a name that describes the project. For this example, we will use truffle to deploy our Faucet contract from <a href="#simple_contract_example">[simple_contract_example]</a>, and therefore we will name the project folder <em>Faucet</em>:</p>
</div>
<pre data-type="programlisting">
$ <strong>mkdir Faucet</strong>
$ <strong>cd Faucet</strong>
Faucet $
</pre>
<div class="paragraph data-line-93">
<p>Once inside the <em>Faucet</em> directory, we initialize truffle:</p>
</div>
<pre data-type="programlisting">
Faucet $ <strong>truffle init</strong>
</pre>
<div class="paragraph data-line-101">
<p>truffle creates a directory structure and some default files:</p>
</div>
<div class="listingblock data-line-103">
<div class="content">
<pre>Faucet
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- test
+---- truffle-config.js
`---- truffle.js</pre>
</div>
</div>
<div class="paragraph data-line-114">
<p>We will also use a number of JavaScript (Node.js) support packages, in addition to truffle itself. We can install these with npm. We initialize the npm directory structure and accept the defaults suggested by npm:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm init</strong>

package name: (faucet)
version: (1.0.0)
description:
entry point: (truffle-config.js)
test command:
git repository:
keywords:
author:
license: (ISC)
About to write to Faucet/package.json:

{
  "name": "faucet",
  "version": "1.0.0",
  "description": "",
  "main": "truffle-config.js",
  "directories": {
    "test": "test"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "",
  "license": "ISC"
}


Is this ok? (yes)
</pre>
<div class="paragraph data-line-151">
<p>Now, we can install the dependencies that we will use to make working with truffle easier:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm install dotenv truffle-wallet-provider ethereumjs-wallet</strong>
</pre>
<div class="paragraph data-line-159">
<p>We now have a <em>node_modules</em> directory with several thousand files inside our <em>Faucet</em> directory.</p>
</div>
<div class="paragraph data-line-161">
<p>Prior to deploying a DApp to a cloud production or continuous integration environment, it is important to specify the engines field so that your DApp is built with the correct Node.js version and its associated dependencies are installed. For details on configuring this field, see the <a href="http://bit.ly/2zp2GPF" data-href="http://bit.ly/2zp2GPF">documentation</a>.</p>
</div>
</div>
<div class="sect4 data-line-163">
<h5 id="_configuring_truffle">Configuring truffle</h5>
<div class="paragraph data-line-165">
<p>truffle creates some empty configuration files, <em>truffle.js</em> and <em>truffle-config.js</em>. On Windows systems the <em>truffle.js</em> name may cause a conflict when you try to run the command truffle and Windows attempts to run <em>truffle.js</em> instead. To avoid this, we will delete <em>truffle.js</em> and use <em>truffle-config.js</em> (in support of Windows users, who, honestly, suffer enough already):</p>
</div>
<pre data-type="programlisting">
$ <strong>rm truffle.js</strong>
</pre>
<div class="paragraph data-line-173">
<p>Now we edit <em>truffle-config.js</em> and replace the contents with the sample configuation shown here:</p>
</div>
<div class="listingblock data-line-176">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">module.exports = {
  networks: {
    localnode: { // Whatever network our local node connects to
      network_id: "*", // Match any network ID
      host: "localhost",
      port: 8545,
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph data-line-188">
<p>This configuration is a good starting point. It sets up one default Ethereum network (named localnode), which assumes we are running an Ethereum client such as Parity, either as a full node or as a light client. This configuration will instruct truffle to communicate with the local node over RPC, on port 8545. truffle will use whatever Ethereum network the local node is connected to, such as the Ethereum main network, or a test network like Ropsten. The local node will also be providing the wallet functionality.</p>
</div>
<div class="paragraph data-line-190">
<p>In following sections, we will configure additional networks for truffle to use, such as the ganache local test blockchain and Infura, a hosted network provider. As we add more networks, the configuration file will get more complex, but it will also give us more options for our testing and development workflow.</p>
</div>
</div>
<div class="sect4 data-line-192">
<h5 id="_using_truffle_to_deploy_a_contract">Using truffle to deploy a contract</h5>
<div class="paragraph data-line-194">
<p>We now have a basic working directory for our <em>Faucet</em> project, and we have truffle and its dependencies configured. Contracts go in the <em>contracts</em> subdirectory of our project. The directory already contains a "helper" contract, <em>Migrations.sol</em>, which manages contract upgrades for us. We&#8217;ll examine the use of <em>Migrations.sol</em> in the next section.</p>
</div>
<div class="paragraph data-line-196">
<p>Let&#8217;s copy the <em>Faucet.sol</em> contract (from <a href="#solidity_faucet_example">Faucet.sol: Un contrat Solidity mettant en place un robinet</a>) into the <em>contracts</em> subdirectory, so that the project directory looks like this:</p>
</div>
<div class="listingblock data-line-198">
<div class="content">
<pre>Faucet
+---- contracts
|   +---- Faucet.sol
|   `---- Migrations.sol
...</pre>
</div>
</div>
<div class="paragraph data-line-206">
<p>We can now ask truffle to compile the contract for us:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle compile</strong>
Compiling ./contracts/Faucet.sol...
Compiling ./contracts/Migrations.sol...
Writing artifacts to ./build/contracts
</pre>
</div>
<div class="sect4 data-line-218">
<h5 id="truffle_migrations_understanding_deployment_scripts">Truffle migrations&#x2014;understanding deployment scripts</h5>
<div class="paragraph data-line-220">
<p>Truffle offers a deployment system called a <em>migration</em>. If you have worked in other frameworks, you may have seen something similar: Ruby on Rails, Python Django, and many other languages and frameworks have a migrate command.</p>
</div>
<div class="paragraph data-line-222">
<p>In all those frameworks, the purpose of a migration is to handle changes in the data schema between different versions of the software. The purpose of migrations in Ethereum is slightly different. Because Ethereum contracts are immutable and cost gas to deploy, Truffle offers a migration mechanism to keep track of which contracts (and which versions) have already been deployed. In a complex project with dozens of contracts and complex dependencies, you would not want to have to pay to redeploy contracts that haven&#8217;t changed. You would also not want to manually track which versions of which contracts have been deployed already. The Truffle migration mechanism does all that by deploying the smart contract <em>Migrations.sol</em>, which then keeps track of all other contract deployments.</p>
</div>
<div class="paragraph data-line-224">
<p>We have only one contract, <em>Faucet.sol</em>, which means that the migration system is overkill, to say the least. Unfortunately, we have to use it. But, by learning how to use it for one contract, we can start practicing some good habits for our development workflow. The effort will pay off as things get more complicated.</p>
</div>
<div class="paragraph data-line-226">
<p>Truffle&#8217;s <em>migrations</em> directory is where the migration scripts are found. Right now there&#8217;s only one script, <em>1_initial_migration.js</em>, which deploys the <em>Migrations.sol</em> contract itself:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var Migrations = artifacts.require("./Migrations.sol");

module.exports = function(deployer) {
  deployer.deploy(Migrations);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-234">
<p>We need a second migration script, to deploy <em>Faucet.sol</em>. Let&#8217;s call it <em>2_deploy_contracts.js</em>. It is very simple, just like <em>1_initial_migration.js</em>, with only a few small changes. In fact, you can copy the contents of <em>1_initial_migration.j</em> and simply replace all instances of Migrations with Faucet:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var Faucet = artifacts.require("./Faucet.sol");

module.exports = function(deployer) {
  deployer.deploy(Faucet);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-241">
<p>The script initializes a variable Faucet, identifying the <em>Faucet.sol</em> Solidity source code as the artifact that defines Faucet. Then it calls the <code>deploy</code> function to deploy this contract.</p>
</div>
<div class="paragraph data-line-243">
<p>We&#8217;re all set. Let&#8217;s use truffle migrate to deploy it on. We have to specify which network to deploy the contract, using the --network argument. We only have one network specified in the configuration file, which we named localnode. Make sure your local Ethereum client is running and then type:</p>
</div>
<pre data-type="programlisting">
Faucet $ <strong>truffle migrate --network localnode</strong>
</pre>
<div class="paragraph data-line-251">
<p>Because we are using a local node to connect to the Ethereum network and manage our wallet, we have to authorize the transaction that truffle creates. We&#8217;re running parity connected to the Ropsten test blockchain, so during the migration we&#8217;ll see a pop-up like the one in <a href="#parity_deployment_confirmation">Parity asking for confirmation to deploy Faucet</a> on Parity&#8217;s web console.</p>
</div>
<div id="parity_deployment_confirmation" class="imageblock data-line-255">
<div class="content">
<img src="images/parity_deployment_confirmation.png" alt="Parity asking for confirmation to deploy Faucet">
</div>
<div class="title">Figure 59. Parity asking for confirmation to deploy Faucet</div>
</div>
<div class="paragraph data-line-257">
<p>There are four transactions in total: one to deploy Migrations, one to update the deployments counter to 1, one to deploy Faucet, and one to update the deployments counter to 2.</p>
</div>
<div class="paragraph data-line-259">
<p>Truffle will show the migrations completing, show each of the transactions, and show the contract addresses:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle migrate --network localnode</strong>
Using network 'localnode'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xfa090db179d023d2abae543b4a21a1479e70ca7d35a469a5d1a98bfc6bd80fe8
  Migrations: 0x8861c27715550bed8362c0345add158489df6db0
Saving successful migration to network...
  ... 0x985c4a32716826ddbe4eae284104bef8bc69e959899f62246a1b27c9dfcd6c03
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Faucet...
  ... 0xecdbeef77f0558edc689440e34b7bba0a3ba7a45e4b680b071b47c30a930e9d6
  Faucet: 0xd01cd8e7bd29e4bff8c1693f59eee46137a9f300
Saving successful migration to network...
  ... 0x11f376bd7307edddfd40dc4a14c3f7cb84b6c921ac2465602060b67d08f9fd8a
Saving artifacts...
</pre>
</div>
<div class="sect4 data-line-283">
<h5 id="_using_the_truffle_console">Using the Truffle console</h5>
<div class="paragraph data-line-285">
<p>Truffle offers a JavaScript console that we can use to interact with the Ethereum network (via the local node), interact with deployed contracts, and interact with the wallet provider. In our current configuration (localnode), the node and wallet provider is our local Parity client.</p>
</div>
<div class="paragraph data-line-287">
<p>Let&#8217;s start the Truffle console and try some commands:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle console --network localnode</strong>
truffle(localnode)>
</pre>
<div class="paragraph data-line-296">
<p>Truffle presents a prompt, showing the selected network configuration (localnode).</p>
</div>
<div class="admonitionblock tip data-line-299">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-300">
<p>It&#8217;s important to remember and be aware of which network you are using. You wouldn&#8217;t want to accidentally deploy a test contract or make a transaction on the Ethereum main network. That could be an expensive mistake!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-303">
<p>The Truffle console offers an autocomplete function that makes it easy for us to explore the environment. If we press Tab after a partially completed command, Truffle will complete the command for us. Pressing Tab twice will show all possible completions if more than one command matches our input. In fact, if we press Tab twice on an empty prompt, Truffle lists all the available commands:</p>
</div>
<pre data-type="programlisting" class="codewrap">
truffle(localnode)&gt;
Array Boolean Date Error EvalError Function Infinity JSON Math NaN Number Object RangeError ReferenceError RegExp String SyntaxError TypeError URIError decodeURI decodeURIComponent encodeURI encodeURIComponent eval isFinite isNaN parseFloat parseInt undefined

ArrayBuffer Buffer DataView Faucet Float32Array Float64Array GLOBAL Int16Array Int32Array Int8Array Intl Map Migrations Promise Proxy Reflect Set StateManager Symbol Uint16Array Uint32Array Uint8Array Uint8ClampedArray WeakMap WeakSet WebAssembly XMLHttpRequest _ assert async_hooks buffer child_process clearImmediate clearInterval clearTimeout cluster console crypto dgram dns domain escape events fs global http http2 https module net os path perf_hooks process punycode querystring readline repl require root setImmediate setInterval setTimeout stream string_decoder tls tty unescape url util v8 vm web3 zlib

__defineGetter__ __defineSetter__ __lookupGetter__ __lookupSetter__ __proto__ constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf
</pre>
<div class="paragraph data-line-316">
<p>The vast majority of the wallet- and node-related functions are provided by the web3 object, which is an instance of the web3.js library. The web3 object abstracts the RPC interface to our Parity node. You will also notice two objects with familiar names: Migrations and Faucet. Those represent the contracts we just deployed. We will use the Truffle console to interact with a contract. First, let&#8217;s check our wallet via the web3 object:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.accounts</strong>
[ '0x9e713963a92c02317a681b9bb3065a8249de124f',
  '0xdb5dc1a13e3a55cf3b4587cd8d1e5fdeb6738145' ]
</pre>
<div class="paragraph data-line-326">
<p>Our Parity client has two wallets, with some test ether on Ropsten. The web3.eth.accounts attribute contains a list of all the accounts. We can check the balance of the first account using the getBalance function:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.getBalance(web3.eth.accounts[0]).toNumber()</strong>
191198572800000000
truffle(localnode)&gt;
</pre>
<div class="paragraph data-line-336">
<p>web3.js is a large JavaScript library that offers a comprehensive interface to the Ethereum system, via a provider such as a local client. We will examine web3.js in more detail in <a href="#web3js_tutorial">Tutoriel web3.js</a>. Now let&#8217;s try to interact with our contracts:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>Faucet.address</strong>
'0xd01cd8e7bd29e4bff8c1693f59eee46137a9f300'
truffle(localnode)&gt; <strong>web3.eth.getBalance(Faucet.address).toNumber()</strong>
0
truffle(localnode)&gt;
</pre>
<div class="paragraph data-line-348">
<p>Next, we&#8217;ll use sendTransaction to send some test ether to fund the Faucet contract. Note the use of web3.utils.toWei to convert ether units for us. Typing 18 zeros without making a mistake is both difficult and dangerous, so it&#8217;s always better to use a unit converter for values. Here&#8217;s how we send the transaction:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.sendTransaction({from:web3.eth.accounts[0],
                    to:Faucet.address, value:web3.utils.toWei(0.5, 'ether')});</strong>
'0xf134c75b985dc0e0c27c2f0412251e0860eb530a5055e660f21e7483ab336808'
</pre>
<div class="paragraph data-line-358">
<p>If we switch to the Parity web interface, we&#8217;ll see a pop-up asking us to confirm this transaction. Once the transaction is mined, we&#8217;ll be able to see the balance of our Faucet contract:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.getBalance(Faucet.address).toNumber()</strong>
500000000000000000
</pre>
<div class="paragraph data-line-367">
<p>Let&#8217;s call the withdraw function now, to withdraw some test ether from the contract:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>Faucet.deployed().then(instance =>
                       {instance.withdraw(web3.utils.toWei(0.1,
                       'ether'))}).then(console.log)</strong>
</pre>
<div class="paragraph data-line-377">
<p>Again, we&#8217;ll need to approve the transaction in the Parity web interface. If we check again we&#8217;ll see that the balance of the Faucet contract has decreased, and our test wallet has received 0.1 ether:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.getBalance(Faucet.address).toNumber()</strong>
400000000000000000
truffle(localnode)&gt; <strong>Faucet.deployed().then(instance =>
                    {instance.withdraw(web3.utils.toWei(1, 'ether'))})</strong>
StatusError: Transaction: 0xe147ae9e3610334...8612b92d3f9c
  exited with an error (status 0).
</pre>
</div>
</div>
<div class="sect3 data-line-390">
<h4 id="_embark">Embark</h4>
<div class="paragraph data-line-392">
<p>GitHub: <a href="https://github.com/embark-framework/embark/" class="undefined" data-href="https://github.com/embark-framework/embark/">https://github.com/embark-framework/embark/</a></p>
</div>
<div class="paragraph data-line-394">
<p>Documentation: <a href="https://embark.status.im/docs/" class="undefined" data-href="https://embark.status.im/docs/">https://embark.status.im/docs/</a></p>
</div>
<div class="paragraph data-line-396">
<p>npm package repository: <a href="https://www.npmjs.com/package/embark" class="undefined" data-href="https://www.npmjs.com/package/embark">https://www.npmjs.com/package/embark</a></p>
</div>
<div class="paragraph data-line-398">
<p>Embark is a framework built to allow developers to easily develop and deploy decentralized applications.
Embark integrates with Ethereum, IPFS, Whisper, and Swarm to offer the following features:</p>
</div>
<div class="ulist data-line-401">
<ul>
<li class="data-line-401">
<p>Automatically deploy contracts and make them available in JS code.</p>
</li>
<li class="data-line-402">
<p>Watch for changes and update contracts to redeploy if needed.</p>
</li>
<li class="data-line-403">
<p>Manage and interact with different chains (e.g., testnet, local, mainnet).</p>
</li>
<li class="data-line-404">
<p>Manage complex systems of interdependent contracts.</p>
</li>
<li class="data-line-405">
<p>Store and retrieve data, including uploading and retrieving files hosted in IPFS.</p>
</li>
<li class="data-line-406">
<p>Ease the process of deploying the full application to IPFS or Swarm.</p>
</li>
<li class="data-line-407">
<p>Send and receive messages through Whisper.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-409">
<p>You can install it with npm:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm -g install embark</strong>
</pre>
</div>
<div class="sect3 pagebreak-before data-line-418">
<h4 id="_openzeppelin">OpenZeppelin</h4>
<div class="paragraph data-line-420">
<p>GitHub: <a href="https://github.com/OpenZeppelin/openzeppelin-solidity" class="undefined" data-href="https://github.com/OpenZeppelin/openzeppelin-solidity">https://github.com/OpenZeppelin/openzeppelin-solidity</a></p>
</div>
<div class="paragraph data-line-422">
<p>Website: <a href="https://openzeppelin.org/" class="undefined" data-href="https://openzeppelin.org/">https://openzeppelin.org/</a></p>
</div>
<div class="paragraph data-line-424">
<p>Documentation: <a href="https://openzeppelin.org/api/docs/open-zeppelin.html" class="undefined" data-href="https://openzeppelin.org/api/docs/open-zeppelin.html">https://openzeppelin.org/api/docs/open-zeppelin.html</a></p>
</div>
<div class="paragraph data-line-426">
<p><a href="https://openzeppelin.org/" data-href="https://openzeppelin.org/">OpenZeppelin</a> is an open framework of reusable and secure smart contracts in the Solidity language.</p>
</div>
<div class="paragraph data-line-428">
<p>It is community-driven, led by the <a href="https://zeppelin.solutions/" data-href="https://zeppelin.solutions/">Zeppelin</a> team, with over a hundred external contributors. The main focus of the framework is security, achieved by applying industry-standard contract security patterns and best practices, drawing on all the experience the Zeppelin devs have gained from <a href="https://blog.zeppelin.solutions/tagged/security" data-href="https://blog.zeppelin.solutions/tagged/security">auditing</a> a huge number of contracts, and through constant testing and auditing from the community that uses the framework as a base for their real-world applications.</p>
</div>
<div class="paragraph data-line-430">
<p>The OpenZeppelin framework is the most widely used solution for Ethereum smart contracts. The framework currently has an ample library of contracts including implementations of ERC20 and ERC721 tokens, many flavors of crowdsale models, and simple behaviors commonly found in contracts such as <code>Ownable</code>, <code>Pausable</code>, or <code>LimitBalance</code>. The contracts in this repository in some cases function as <em>de facto</em> standard implementations.</p>
</div>
<div class="paragraph data-line-432">
<p>The framework is licensed under an MIT license, and all the contracts have been designed with a modular approach to guarantee ease of reuse and extension. These are clean and basic building blocks, ready to be used in your next Ethereum project. Let&#8217;s set up the framework and build a simple crowdsale using the OpenZeppelin contracts, to demonstrate how easy it is to use. This example also stresses the importance of reusing secure components instead of writing them by yourself.</p>
</div>
<div class="paragraph data-line-434">
<p>First, we will need to install the openzeppelin-solidity library into our workspace. The latest release as of the time of this writing is v1.9.0, so we will use that one:</p>
</div>
<pre data-type="programlisting">
$ <strong>mkdir sample-crowdsale</strong>
$ <strong>cd sample-crowdsale</strong>
$ <strong>npm install openzeppelin-solidity@1.9.0</strong>
$ <strong>mkdir contracts</strong>
</pre>
<div class="paragraph data-line-445">
<p>At the time of writing, OpenZeppelin includes multiple basic token contracts that follow the ERC20, ERC721, and ERC827 standards, with different characteristics for emission, limits, vesting, life cycle, etc.</p>
</div>
<div class="paragraph data-line-447">
<p>Let&#8217;s make an ERC20 token that&#8217;s mintable, meaning that the initial supply starts at 0 and new tokens can be created by the token owner (in our case, the crowdsale <span class="keep-together">contract</span>) and sold to buyers. In order to do this, we&#8217;ll create a <em>contracts/SampleToken.sol</em> file with the following contents:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity 0.4.23;

import 'openzeppelin-solidity/contracts/token/ERC20/MintableToken.sol';

contract SampleToken is MintableToken {
  string public name = "SAMPLE TOKEN";
  string public symbol = "SAM";
  uint8 public decimals = 18;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-454">
<p>OpenZeppelin already provides a MintableToken contract that we can use as a base for our token, so we only define the details that are specific to our case. Next, let&#8217;s make the crowdsale contract. Just like with tokens, OpenZeppelin already provides a wide variety of crowdsale flavors. Currently, you will find contracts for various scenarios involving distribution, emission, price, and validation. So, let’s say that you want to set a goal for your crowdsale and if it’s not met by the time the sale finishes, you want to refund all your investors. For that, you can use the <a href="http://bit.ly/2yHoh65" data-href="http://bit.ly/2yHoh65">RefundableCrowdsale</a> contract. Or maybe you want to define a crowdsale with an increasing price to incentivize early buyers; there is an <a href="http://bit.ly/2PtWOys" data-href="http://bit.ly/2PtWOys">IncreasingPriceCrowdsale</a> contract just for that. You can also end the crowdsale when a specified amount of ether has been received by the contract (<a href="http://bit.ly/2OVsCN8" data-href="http://bit.ly/2OVsCN8">CappedCrowdsale</a>), or set a finishing time with the <a href="http://bit.ly/2zp2Nuz" data-href="http://bit.ly/2zp2Nuz">TimedCrowdsale</a> contract, or create a whitelist of buyers with the <a href="http://bit.ly/2CN8Hc9" data-href="http://bit.ly/2CN8Hc9">WhitelistedCrowdsale</a> contract.</p>
</div>
<div class="paragraph data-line-456">
<p>As we said before, the OpenZeppelin contracts are basic building blocks. These crowdsale contracts have been designed to be combined; just read the source code of the base <a href="http://bit.ly/2ABIQSI" data-href="http://bit.ly/2ABIQSI">Crowdsale</a> contract for directions on how to extend it. For the crowdsale of our token, we need to mint tokens when ether is received by the crowdsale contract, so let&#8217;s use <a href="http://bit.ly/2Sx3HOc" data-href="http://bit.ly/2Sx3HOc">MintedCrowdsale</a> as a base. And to make it more interesting, let&#8217;s also make it a <a href="http://bit.ly/2Qef0Jm" data-href="http://bit.ly/2Qef0Jm">PostDeliveryCrowdsale</a> so the tokens can only be withdrawn after the crowdsale ends. To do this, we&#8217;ll write the following into <em>contracts/SampleCrowdsale.sol</em>:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity 0.4.23;

import './SampleToken.sol';
import 'openzeppelin-solidity/contracts/crowdsale/emission/MintedCrowdsale.sol';
import 'openzeppelin-solidity/contracts/crowdsale/ \
  distribution/PostDeliveryCrowdsale.sol';

contract SampleCrowdsale is PostDeliveryCrowdsale, MintedCrowdsale {

  constructor(
    uint256 _openingTime,
    uint256 _closingTime
    uint256 _rate,
    address _wallet,
    MintableToken _token
  )
    public
    Crowdsale(_rate, _wallet, _token)
    PostDeliveryCrowdsale(_openingTime, _closingTime)
  {
  }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-463">
<p>Again, we barely had to write any code; we just reused the battle-tested code that the OpenZeppelin community made available. However, it is important to note that this case is different than that of our <code>SampleToken</code> contract. If you go to the <a href="http://bit.ly/2Q8lQ3o" data-href="http://bit.ly/2Q8lQ3o">Crowdsale automated tests</a> you will see that they are tested in isolation. When you integrate different units of code into a bigger component, it&#8217;s not enough to test all the units separately, because the interactions between them might cause behaviors that you didn&#8217;t expect. In particular, you will see that here we introduced multiple inheritance, which can surprise the developer if they don&#8217;t understand the details of Solidity. Our <span class="keep-together"><code>SampleCrowdsale</code></span> contract is simple, and it will work just as we expect because the framework was designed to make cases like these straightforward; but do not relax your vigilance because of the simplicity that this framework introduces. Every time you integrate parts of the OpenZeppelin framework to build a more complex solution, you must fully test every aspect of your solution to ensure that all the interactions of the units work as you intend.</p>
</div>
<div class="paragraph data-line-465">
<p>Finally, when we are happy with our solution and have tested it thoroughly, we need to deploy it. OpenZeppelin integrates well with Truffle, so we can just write a migrations file like the following (<em>migrations/2_deploy_contracts.js</em>), as explained in <a href="#truffle_migrations_understanding_deployment_scripts">Truffle migrations&#x2014;understanding deployment scripts</a>:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">const SampleCrowdsale = artifacts.require('./SampleCrowdsale.sol');
const SampleToken = artifacts.require('./SampleToken.sol');

module.exports = function(deployer, network, accounts) {
  const openingTime = web3.eth.getBlock('latest').timestamp + 2; // 2s in future
  const closingTime = openingTime + 86400 * 20; // 20 days
  const rate = new web3.BigNumber(1000);
  const wallet = accounts[1];

  return deployer
    .then(() =&gt; {
      return deployer.deploy(SampleToken);
    })
    .then(() =&gt; {
      return deployer.deploy(
        SampleCrowdsale,
        openingTime,
        closingTime,
        rate,
        wallet,
        SampleToken.address
      );
    });
};</code></pre>
</div>
</div>
<div class="admonitionblock note data-line-473">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-474">
<p>This was just a quick overview of a few of the contracts that are part of the OpenZeppelin framework. You are welcome to join the OpenZeppelin development community to learn and contribute.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-477">
<h4 id="_zeppelinos">ZeppelinOS</h4>
<div class="paragraph data-line-479">
<p>GitHhub: <a href="https://github.com/zeppelinos" class="undefined" data-href="https://github.com/zeppelinos">https://github.com/zeppelinos</a></p>
</div>
<div class="paragraph data-line-481">
<p>Website: <a href="https://zeppelinos.org" class="undefined" data-href="https://zeppelinos.org">https://zeppelinos.org</a></p>
</div>
<div class="paragraph data-line-483">
<p>Blog: <a href="https://blog.zeppelinos.org" class="undefined" data-href="https://blog.zeppelinos.org">https://blog.zeppelinos.org</a></p>
</div>
<div class="paragraph data-line-485">
<p><a href="https://github.com/zeppelinos" data-href="https://github.com/zeppelinos">ZeppelinOS</a> is &#x201c;an open source, distributed platform of tools and services on top of the EVM
to develop and manage smart contract applications securely.&#x201d;</p>
</div>
<div class="paragraph data-line-488">
<p>Unlike OpenZeppelin&#8217;s code, which needs to be redeployed with each application every time it&#8217;s used, ZeppelinOS&#8217;s code lives on-chain. Applications that need a given functionality&#x2014;say, an ERC20 token&#x2014;not only do not have to redesign and reaudit its implementation (something that OpenZeppelin solved) but do not even need to deploy it. With ZeppelinOS, an application interacts with the token&#8217;s on-chain implementation directly, in much the same way as a desktop application interacts with the components of its underlying OS.</p>
</div>
<div class="paragraph data-line-490">
<p>At the core of ZeppelinOS sits a very clever contract known as a <em>proxy</em>. A proxy is a contract that is capable of wrapping any other contract, exposing its interface without having to manually implement setters and getters for it, and can upgrade it without losing state. In Solidity terms, it can be seen as a normal contract whose business logic is contained within a library, which can be swapped for a new library at any time without losing its state. The way in which the proxy links to its implementation is completely automated and encapsulated for the developer. Practically any contract can be made upgradeable with little to no change in its code. More about ZeppelinOS&#8217;s proxy mechanism can be found in the  <a href="http://bit.ly/2OfuNpu" data-href="http://bit.ly/2OfuNpu">blog</a>, and an example of how to use it can be found <a href="http://bit.ly/2OfuE5q" data-href="http://bit.ly/2OfuE5q">on GitHub</a>.</p>
</div>
<div class="paragraph data-line-492">
<p>Developing applications using ZeppelinOS is similar to developing JavaScript applications using npm. An AppManager handles an application package for each version of the application. A package is simply a directory of contracts, each of which can have one or more upgradeable proxies. The AppManager not only provides proxies for application-specific contracts, but also does so for ZeppelinOS implementations, in the form of a standard library. To see a full example of this, please visit <a href="http://bit.ly/2PtyJb3" data-href="http://bit.ly/2PtyJb3">examples/complex</a>.</p>
</div>
<div class="paragraph data-line-494">
<p>Although currently in development, ZeppelinOS aims to provide a wide set of additional features, such as developer tools, a scheduler that automates background operations within contracts, development bounties, a marketplace that facilitates communication and exchange of value between applications, and much more. All of this is described in ZeppelinOS&#8217;s <a href="http://bit.ly/2QcxV7K" data-href="http://bit.ly/2QcxV7K">whitepaper</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-499">
<h3 id="_utilities">Utilities</h3>
<div class="sect3 data-line-501">
<h4 id="_ethereumjs_helpeth_a_command_line_utility">EthereumJS helpeth: A Command-Line Utility</h4>
<div class="paragraph data-line-503">
<p>GitHub: <a href="https://github.com/ethereumjs/helpeth" class="undefined" data-href="https://github.com/ethereumjs/helpeth">https://github.com/ethereumjs/helpeth</a></p>
</div>
<div class="paragraph data-line-505">
<p>helpeth is a command-line tool for key and transaction manipulation that makes a developer&#8217;s job a lot easier.</p>
</div>
<div class="paragraph data-line-507">
<p>It is part of the EthereumJS collection of JavaScript-based libraries and tools:</p>
</div>
<div class="listingblock data-line-511">
<div class="content">
<pre>Usage: helpeth [command]

Commands:
  signMessage &lt;message&gt;                     Sign a message
  verifySig &lt;hash&gt; &lt;sig&gt;                    Verify signature
  verifySigParams &lt;hash&gt; &lt;r&gt; &lt;s&gt; &lt;v&gt;        Verify signature parameters
  createTx &lt;nonce&gt; &lt;to&gt; &lt;value&gt; &lt;data&gt;      Sign a transaction
  &lt;gasLimit&gt; &lt;gasPrice&gt;
  assembleTx &lt;nonce&gt; &lt;to&gt; &lt;value&gt; &lt;data&gt;    Assemble a transaction from its
  &lt;gasLimit&gt; &lt;gasPrice&gt; &lt;v&gt; &lt;r&gt; &lt;s&gt;         components
  parseTx &lt;tx&gt;                              Parse raw transaction
  keyGenerate [format] [icapdirect]         Generate new key
  keyConvert                                Convert a key to V3 keystore format
  keyDetails                                Print key details
  bip32Details &lt;path&gt;                       Print key details for a given path
  addressDetails &lt;address&gt;                  Print details about an address
  unitConvert &lt;value&gt; &lt;from&gt; &lt;to&gt;           Convert between Ethereum units

Options:
  -p, --private      Private key as a hex string                        [string]
  --password         Password for the private key                       [string]
  --password-prompt  Prompt for the private key password               [boolean]
  -k, --keyfile      Encoded key file                                   [string]
  --show-private     Show private key details                          [boolean]
  --mnemonic         Mnemonic for HD key derivation                     [string]
  --version          Show version number                               [boolean]
  --help             Show help                                         [boolean]</pre>
</div>
</div>
</div>
<div class="sect3 data-line-541">
<h4 id="_dapp_tools">dapp.tools</h4>
<div class="paragraph data-line-543">
<p>Website: <a href="https://dapp.tools/" class="undefined" data-href="https://dapp.tools/">https://dapp.tools/</a></p>
</div>
<div class="paragraph data-line-545">
<p>dapp.tools is a comprehensive suite of blockchain-oriented developer tools created in the spirit of the Unix philosophy. The tools included are:</p>
</div>
<div class="dlist data-line-548">
<dl>
<dt class="hdlist1">Dapp</dt>
<dd>
<p>Dapp is the basic user-facing tool, for creating new DApps, running Solidity unit tests, debugging and deploying contracts, launching testnets, and more.</p>
</dd>
<dt class="hdlist1">Seth</dt>
<dd>
<p>Seth is used for composing transactions, querying the blockchain, converting between data formats, performing remote calls, and similar everyday tasks.</p>
</dd>
<dt class="hdlist1">Hevm</dt>
<dd>
<p>Hevm is a Haskell EVM implementation with a nimble terminal-based Solidity debugger. It’s used to test and debug DApps.</p>
</dd>
<dt class="hdlist1">evmdis</dt>
<dd>
<p>evmdis is an EVM disassembler; it performs static analysis on the bytecode to provide a higher level of abstraction than raw EVM operations.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-561">
<h4 id="_sputnikvm">SputnikVM</h4>
<div class="paragraph data-line-563">
<p><a href="https://github.com/etcdevteam/sputnikvm" data-href="https://github.com/etcdevteam/sputnikvm">SputnikVM</a> is a standalone pluggable virtual machine for different Ethereum-based blockchains. It&#8217;s written in Rust and can be used as a binary, cargo crate, or shared library, or integrated through FFI, Protobuf, and JSON interfaces. It has a separate binary, sputnikvm-dev, intended for testing purposes, which emulates most of the JSON-RPC API and block mining.</p>
</div>
</div>
</div>
<div class="sect2 data-line-565">
<h3 id="_libraries">Libraries</h3>
<div class="sect3 data-line-567">
<h4 id="_web3_js">web3.js</h4>
<div class="paragraph data-line-569">
<p>web3.js is the Ethereum-compatible JavaScript API for communicating with clients via JSON-RPC, developed by the Ethereum Foundation.</p>
</div>
<div class="paragraph data-line-571">
<p>GitHub: <a href="https://github.com/ethereum/web3.js" class="undefined" data-href="https://github.com/ethereum/web3.js">https://github.com/ethereum/web3.js</a></p>
</div>
<div class="paragraph data-line-573">
<p>npm package repository: <a href="https://www.npmjs.com/package/web3" class="undefined" data-href="https://www.npmjs.com/package/web3">https://www.npmjs.com/package/web3</a></p>
</div>
<div class="paragraph data-line-575">
<p>Documentation for web3.js API 0.2x.x: <a href="http://bit.ly/2Qcyq1C" class="undefined" data-href="http://bit.ly/2Qcyq1C">http://bit.ly/2Qcyq1C</a></p>
</div>
<div class="paragraph data-line-577">
<p>Documentation for web3.js API 1.0.0-beta.xx: <a href="http://bit.ly/2CT33p0" class="undefined" data-href="http://bit.ly/2CT33p0">http://bit.ly/2CT33p0</a></p>
</div>
</div>
<div class="sect3 pagebreak-before data-line-580">
<h4 id="_web3_py">web3.py</h4>
<div class="paragraph data-line-582">
<p>web3.py is a Python library for interacting with the Ethereum blockchain, maintained by the Ethereum Foundation.</p>
</div>
<div class="paragraph data-line-584">
<p>GitHub: <a href="https://github.com/ethereum/web3.py" class="undefined" data-href="https://github.com/ethereum/web3.py">https://github.com/ethereum/web3.py</a></p>
</div>
<div class="paragraph data-line-586">
<p>PyPi: <a href="https://pypi.python.org/pypi/web3/4.0.0b9" class="undefined" data-href="https://pypi.python.org/pypi/web3/4.0.0b9">https://pypi.python.org/pypi/web3/4.0.0b9</a></p>
</div>
<div class="paragraph data-line-588">
<p>Documentation: <a href="https://web3py.readthedocs.io/" class="undefined" data-href="https://web3py.readthedocs.io/">https://web3py.readthedocs.io/</a></p>
</div>
</div>
<div class="sect3 data-line-590">
<h4 id="_ethereumjs">EthereumJS</h4>
<div class="paragraph data-line-592">
<p>EthereumJS is collection of libraries and utilities for Ethereum.</p>
</div>
<div class="paragraph data-line-594">
<p>GitHub: <a href="https://github.com/ethereumjs" class="undefined" data-href="https://github.com/ethereumjs">https://github.com/ethereumjs</a></p>
</div>
<div class="paragraph data-line-596">
<p>Website: <a href="https://ethereumjs.github.io/" class="undefined" data-href="https://ethereumjs.github.io/">https://ethereumjs.github.io/</a></p>
</div>
</div>
<div class="sect3 data-line-598">
<h4 id="_web3j">web3j</h4>
<div class="paragraph data-line-600">
<p>web3j is a Java and Android library for integrating with Ethereum clients and working with smart contracts.</p>
</div>
<div class="paragraph data-line-602">
<p>GitHub: <a href="https://github.com/web3j/web3j" class="undefined" data-href="https://github.com/web3j/web3j">https://github.com/web3j/web3j</a></p>
</div>
<div class="paragraph data-line-604">
<p>Website: <a href="https://web3j.io" class="undefined" data-href="https://web3j.io">https://web3j.io</a></p>
</div>
<div class="paragraph data-line-606">
<p>Documentation: <a href="https://docs.web3j.io" class="undefined" data-href="https://docs.web3j.io">https://docs.web3j.io</a></p>
</div>
</div>
<div class="sect3 data-line-608">
<h4 id="_etherjar">EtherJar</h4>
<div class="paragraph data-line-610">
<p>EtherJar is another Java library for integrating with Ethereum and working with smart contracts. It&#8217;s designed for server-side projects based on Java 8+ and provides low-level access and a high-level wrapper around RPC, Ethereum data structures, and smart contract access.</p>
</div>
<div class="paragraph data-line-612">
<p>GitHub: <a href="https://github.com/infinitape/etherjar" class="undefined" data-href="https://github.com/infinitape/etherjar">https://github.com/infinitape/etherjar</a></p>
</div>
</div>
<div class="sect3 data-line-614">
<h4 id="_nethereum">Nethereum</h4>
<div class="paragraph data-line-616">
<p>Nethereum is the .Net integration library for Ethereum.</p>
</div>
<div class="paragraph data-line-618">
<p>GitHub: <a href="https://github.com/Nethereum/Nethereum" class="undefined" data-href="https://github.com/Nethereum/Nethereum">https://github.com/Nethereum/Nethereum</a></p>
</div>
<div class="paragraph data-line-620">
<p>Website: <a href="http://nethereum.com/" class="undefined" data-href="http://nethereum.com/">http://nethereum.com/</a></p>
</div>
<div class="paragraph data-line-622">
<p>Documentation: <a href="https://nethereum.readthedocs.io/en/latest/" class="undefined" data-href="https://nethereum.readthedocs.io/en/latest/">https://nethereum.readthedocs.io/en/latest/</a></p>
</div>
</div>
<div class="sect3 data-line-624">
<h4 id="_ethers_js">ethers.js</h4>
<div class="paragraph data-line-626">
<p>The ethers.js library is a compact, complete, full-featured, extensively tested MIT-licensed Ethereum library, which has received a DevEx grant from the Ethereum Foundation toward its extension and maintenance.</p>
</div>
<div class="paragraph data-line-628">
<p>GitHub link: <a href="https://github.com/ethers-io/ethers.js" class="undefined" data-href="https://github.com/ethers-io/ethers.js">https://github.com/ethers-io/ethers.js</a></p>
</div>
<div class="paragraph data-line-630">
<p>Documentation: <a href="https://docs.ethers.io" class="undefined" data-href="https://docs.ethers.io">https://docs.ethers.io</a></p>
</div>
</div>
<div class="sect3 data-line-633">
<h4 id="_emerald_platform">Emerald Platform</h4>
<div class="paragraph data-line-635">
<p>Emerald Platform provides libraries and UI components to build DApps on top of Ethereum. Emerald JS and Emerald JS UI provide sets of modules and React components to build JavaScript applications and websites; Emerald SVG Icons is a set of blockchain-related icons. In addition to JavaScript libraries Emerald has a Rust library to operate private keys and transaction signatures. All Emerald libraries and components are licensed under the Apache License, version 2.0.</p>
</div>
<div class="paragraph data-line-637">
<p>GitHub: <a href="https://github.com/etcdevteam/emerald-platform" class="undefined" data-href="https://github.com/etcdevteam/emerald-platform">https://github.com/etcdevteam/emerald-platform</a></p>
</div>
<div class="paragraph data-line-639">
<p>Documentation: <a href="https://docs.etcdevteam.com" class="undefined" data-href="https://docs.etcdevteam.com">https://docs.etcdevteam.com</a></p>
</div>
</div>
</div>
<div class="sect2 data-line-642">
<h3 id="testing_frameworks">Testing Smart Contracts</h3>
<div class="paragraph data-line-644">
<p>There are several commonly used test frameworks for smart contract development, summarized in <a href="#testing_frameworks_table">Smart contract test frameworks summary</a>:</p>
</div>
<table id="testing_frameworks_table" class="tableblock frame-all grid-all stretch data-line-649">
<caption class="title">Table 10. Smart contract test frameworks summary</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Framework</th>
<th class="tableblock halign-left valign-top">Test language(s)</th>
<th class="tableblock halign-left valign-top">Testing framework</th>
<th class="tableblock halign-left valign-top">Chain emulator</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Truffle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript/Solidity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mocha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TestRPC/Ganache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://truffleframework.com/" class="undefined" data-href="https://truffleframework.com/">https://truffleframework.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Embark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mocha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TestRPC/Ganache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://embark.status.im/docs/" class="undefined" data-href="https://embark.status.im/docs/">https://embark.status.im/docs/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dapp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solidity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ds-test (custom)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ethrun (Parity)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://dapp.tools/dapp/" class="undefined" data-href="https://dapp.tools/dapp/">https://dapp.tools/dapp/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Populus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pytest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python chain emulator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://populus.readthedocs.io" class="undefined" data-href="https://populus.readthedocs.io">https://populus.readthedocs.io</a></p></td>
</tr>
</tbody>
</table>
<div class="dlist data-line-658">
<dl>
<dt class="hdlist1">Truffle</dt>
<dd>
<p>Truffle allows for unit tests to be written in JavaScript (Mocha-based) or Solidity. These tests are run against Ganache.</p>
</dd>
<dt class="hdlist1">Embark</dt>
<dd>
<p>Embark integrates with Mocha to run unit tests written in JavaScript. The tests are in turn run against contracts deployed on TestRPC/Ganache. The Embark framework automatically deploys smart contracts, and will automatically redeploy the contracts when they are changed. It also keeps track of deployed contracts and deploys contracts only when truly needed. Embark includes a testing library to rapidly run and test your contracts in an EVM, with functions like assert.equal. The command embark test will run any test files under the directory <em>test</em>.</p>
</dd>
<dt class="hdlist1">Dapp</dt>
<dd>
<p>Dapp uses native Solidity code (a library called ds-test) and a Parity-built Rust library called ethrun to execute Ethereum bytecode and then assert correctness. The ds-test library provides assertion functions for validating correctness and events for logging data in the console.</p>
<div class="paragraph data-line-664">
<p>The assertion functions include:</p>
</div>
<div class="listingblock data-line-666">
<div class="content">
<pre>assert(bool condition)
assertEq(address a, address b)
assertEq(bytes32 a, bytes32 b)
assertEq(int a, int b)
assertEq(uint a, uint b)
assertEq0(bytes a, bytes b)
expectEventsExact(address target)</pre>
</div>
</div>
<div class="paragraph data-line-676">
<p>The logging commands will log information to the console, making them useful for debugging:</p>
</div>
<div class="listingblock data-line-678">
<div class="content">
<pre>logs(bytes)
log_bytes32(bytes32)
log_named_bytes32(bytes32 key, bytes32 val)
log_named_address(bytes32 key, address val)
log_named_int(bytes32 key, int val)
log_named_uint(bytes32 key, uint val)
log_named_decimal_int(bytes32 key, int val, uint decimals)
log_named_decimal_uint(bytes32 key, uint val, uint decimals)</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Populus</dt>
<dd>
<p>Populus uses Python and its own chain emulator to run contracts written in Solidity. Unit tests are written in Python with the pytest library. Populus supports writing contracts specifically for testing. These contract filenames should match the glob pattern <em>Test*.sol</em> and be located anywhere under the project tests directory, <em>tests</em>.</p>
</dd>
</dl>
</div>
<div class="sect3 data-line-693">
<h4 id="on_blockchain_testing_sec">On-Blockchain Testing</h4>
<div class="paragraph data-line-695">
<p>Although most testing shouldn&#8217;t occur on deployed contracts, a contract&#8217;s behavior can be checked via Ethereum clients.  The following commands can be used to assess a smart contract&#8217;s state. These commands should be typed at the geth terminal, although any web3 console will also support them.</p>
</div>
<div class="paragraph data-line-697">
<p>To get the address of a contract at <em>txhash</em>, use:</p>
</div>
<pre data-type="programlisting">
web3.eth.getTransactionReceipt(<em>txhash</em>);
</pre>
<div class="paragraph data-line-706">
<p>This command gets the code of a contract deployed at <em>contractaddress</em>; this can be used to verify proper deployment:</p>
</div>
<pre data-type="programlisting">
web3.eth.getCode(<em>contractaddress</em>)
</pre>
<div class="paragraph data-line-714">
<p>This gets the full logs of the contract located at the address specified in <em>options</em>, which is helpful for viewing the history of a contract&#8217;s calls:</p>
</div>
<pre data-type="programlisting">
web3.eth.getPastLogs(<em>options</em>)
</pre>
<div class="paragraph data-line-722">
<p>Finally, this command gets the storage located at <em>address</em> with an offset of <em>position</em>:</p>
</div>
<pre data-type="programlisting">
web3.eth.getStorageAt(<em>address</em>, <em>position</em>)
</pre>
</div>
<div class="sect3 data-line-731">
<h4 id="ganache">Ganache: A Local Test Blockchain</h4>
<div class="paragraph data-line-733">
<p>Ganache is a local test blockchain that you can use to deploy contracts, develop your applications, and run tests. It is available as a desktop application (with a graphical user interface) for Windows, macOS, and Linux. It is also available as a command-line utility called ganache-cli. For more details and installation instructions for the Ganache desktop application, see <a href="https://truffleframework.com/ganache" class="undefined" data-href="https://truffleframework.com/ganache">https://truffleframework.com/ganache</a>.</p>
</div>
<div class="paragraph data-line-735">
<p>The ganache-cli code can be found at <a href="https://github.com/trufflesuite/ganache-cli/" class="undefined" data-href="https://github.com/trufflesuite/ganache-cli/">https://github.com/trufflesuite/ganache-cli/</a>.</p>
</div>
<div class="paragraph data-line-737">
<p>To install the command line ganache-cli, use npm:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm install -g ganache-cli</strong>
</pre>
<div class="paragraph data-line-745">
<p>You can use ganache-cli to start a local blockchain for testing as follows:</p>
</div>
<pre data-type="programlisting">
$ <strong>ganache-cli \
  --networkId=3 \
  --port="8545" \
  --verbose \
  --gasLimit=8000000 \
  --gasPrice=4000000000;</strong>
</pre>
<div class="paragraph data-line-758">
<p>A few notes on this command line:</p>
</div>
<div class="ulist checklist data-line-760">
<ul class="checklist">
<li class="data-line-760">
<p>&#10063; Check the <code>--networkId</code> and <code>--port</code> flag values match your configuration in <em>truffle.js</em>.</p>
</li>
<li class="data-line-761">
<p>&#10063; Check the <code>--gasLimit</code> flag value matches the latest mainnet gas limit (e.g., 8,000,000 gas) shown at <a href="https://ethstats.net" class="undefined" data-href="https://ethstats.net">https://ethstats.net</a> to avoid encountering &#x201c;out of gas&#x201d; exceptions unnecessarily. Note that a <code>--gasPrice</code> of 4000000000 represents a gas price of 4 gwei.</p>
</li>
<li class="data-line-762">
<p>&#10063; You can optionally enter a <code>--mnemonic</code> flag value to restore a previous HD wallet and associated addresses.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="web3js_tutorial">Appendix E: Tutoriel web3.js</h2>
<div class="sectionbody">
<div class="sect2 data-line-5">
<h3 id="_description">Description</h3>
<div class="paragraph data-line-6">
<p>This tutorial is based on web3@1.0.0-beta.29 web3.js. It is intended as an introduction to web3.js.</p>
</div>
<div class="paragraph data-line-8">
<p>The web3.js JavaScript library is a collection of modules that contain specific functionality for the Ethereum ecosystem, together with an Ethereum-compatible JavaScript API that implements the Generic JSON RPC spec.</p>
</div>
<div class="paragraph data-line-10">
<p>To run this script you don’t need to run your own local node, because it uses the <a href="https://infura.io" data-href="https://infura.io">Infura services</a>.</p>
</div>
</div>
<div class="sect2 data-line-12">
<h3 id="_web3_js_contract_basic_interaction_in_a_nonblocked_async_fashion">web3.js Contract Basic Interaction in a Nonblocked (Async) Fashion</h3>
<div class="paragraph data-line-14">
<p>Check you have a valid npm version:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm -v</strong>
5.6.0
</pre>
<div class="paragraph data-line-23">
<p>If you haven&#8217;t, initialize npm:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm init</strong>
</pre>
<div class="paragraph data-line-31">
<p>Install basic dependencies:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm i command-line-args</strong>
$ <strong>npm i web3</strong>
$ <strong>npm i node-rest-client-promise</strong>
</pre>
<div class="paragraph data-line-41">
<p>This will update your <em>package.json</em> configuration file with your new dependencies.</p>
</div>
<div class="sect3 data-line-43">
<h4 id="_node_js_script_execution">Node.js Script Execution</h4>
<div class="paragraph data-line-45">
<p>Basic execution:</p>
</div>
<pre data-type="programlisting">
$ <strong>node code/web3js/web3-contract-basic-interaction.js</strong>
</pre>
<div class="paragraph data-line-53">
<p>Use your own Infura token (register at <a href="https://infura.io/" class="undefined" data-href="https://infura.io/">https://infura.io/</a> and store the api-key in a local file called <em>infura_token</em>):</p>
</div>
<pre data-type="programlisting">
$ <strong>node code/web3js/web3-contract-basic-interaction.js \
  --infuraFileToken /path/to/file/with/infura_token</strong>
</pre>
<div class="paragraph data-line-62">
<p>or:</p>
</div>
<pre data-type="programlisting">
$ <strong>node code/web3js/web3-contract-basic-interaction.js \
  /path/to/file/with/infura_token</strong>
</pre>
<div class="paragraph data-line-71">
<p>This will read the file with your own token and pass it in as a command-line argument to the actual command.</p>
</div>
</div>
</div>
<div class="sect2 data-line-73">
<h3 id="_reviewing_the_demo_script">Reviewing the Demo Script</h3>
<div class="paragraph data-line-75">
<p>Next, let&#8217;s review our demo script, <em>web3-contract-basic-interaction</em>.</p>
</div>
<div class="paragraph data-line-77">
<p>We use the Web3 object to obtain a basic web3 provider:</p>
</div>
<div class="listingblock data-line-80">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var web3 = new Web3(infura_host);</code></pre>
</div>
</div>
<div class="paragraph data-line-84">
<p>We can then interact with web3 and try some basic functions. Let&#8217;s see the protocol version:</p>
</div>
<div class="listingblock data-line-87">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getProtocolVersion().then(function(protocolVersion) {
      console.log(`Protocol Version: ${protocolVersion}`);
  })</code></pre>
</div>
</div>
<div class="paragraph data-line-93">
<p>Now let&#8217;s look at the current gas price:</p>
</div>
<div class="listingblock data-line-96">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getGasPrice().then(function(gasPrice) {
      console.log(`Gas Price: ${gasPrice}`);
  })</code></pre>
</div>
</div>
<div class="paragraph data-line-102">
<p>What&#8217;s the last mined block in the current chain?</p>
</div>
<div class="listingblock data-line-105">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getBlockNumber().then(function(blockNumber) {
      console.log(`Block Number: ${blockNumber}`);
  })</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-111">
<h3 id="_contract_interaction">Contract Interaction</h3>
<div class="paragraph data-line-113">
<p>Now let&#8217;s try some basic interactions with a contract. For these examples, we&#8217;ll use the <a href="https://bit.ly/2MPZZLx" data-href="https://bit.ly/2MPZZLx">WETH9_ contract</a> on the Kovan testnet.</p>
</div>
<div class="paragraph pagebreak-before data-line-116">
<p>First, let&#8217;s initialize our contract address:</p>
</div>
<div class="listingblock data-line-119">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var our_contract_address = "0xd0A1E359811322d97991E03f863a0C30C2cF029C";</code></pre>
</div>
</div>
<div class="paragraph data-line-123">
<p>We can then look at its balance:</p>
</div>
<div class="listingblock data-line-126">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getBalance(our_contract_address).then(function(balance) {
      console.log(`Balance of ${our_contract_address}: ${balance}`);
})</code></pre>
</div>
</div>
<div class="paragraph data-line-132">
<p>and see its bytecode:</p>
</div>
<div class="listingblock data-line-135">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getCode(our_contract_address).then(function(code) {
      console.log(code);
})</code></pre>
</div>
</div>
<div class="paragraph data-line-141">
<p>Next, we&#8217;ll prepare our environment to interact with the Etherscan explorer API.</p>
</div>
<div class="paragraph data-line-143">
<p>Let&#8217;s initialize our contract URL in the Etherscan explorer API for the Kovan chain:</p>
</div>
<div class="listingblock data-line-146">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var etherscan_url =
  "https://kovan.etherscan.io/api?module=contract&amp;action=getabi&amp;
  address=${our_contract_address}"</code></pre>
</div>
</div>
<div class="paragraph data-line-152">
<p>And let&#8217;s initialize a REST client to interact with the Etherscan API:</p>
</div>
<div class="listingblock data-line-155">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var client = require('node-rest-client-promise').Client();</code></pre>
</div>
</div>
<div class="paragraph data-line-159">
<p>and get a client promise:</p>
</div>
<div class="listingblock data-line-162">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">client.getPromise(etherscan_url)</code></pre>
</div>
</div>
<div class="paragraph data-line-166">
<p>Once we&#8217;ve got a valid client promise, we can get our contract ABI from the Etherscan API:</p>
</div>
<div class="listingblock data-line-169">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">.then((client_promise) =&gt; {
  our_contract_abi = JSON.parse(client_promise.data.result);</code></pre>
</div>
</div>
<div class="paragraph data-line-174">
<p>And now we can create our contract object as a promise to consume later:</p>
</div>
<div class="listingblock data-line-177">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">  return new Promise((resolve, reject) =&gt; {
      var our_contract = new web3.eth.Contract(our_contract_abi,
                                               our_contract_address);
      try {
        // If all goes well
        resolve(our_contract);
      } catch (ex) {
        // If something goes wrong
        reject(ex);
      }
    });
})</code></pre>
</div>
</div>
<div class="paragraph data-line-192">
<p>If our contract promise returns successfully, we can start interacting with it:</p>
</div>
<div class="listingblock data-line-195">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">.then((our_contract) =&gt; {</code></pre>
</div>
</div>
<div class="paragraph data-line-199">
<p>Let&#8217;s see our contract address:</p>
</div>
<div class="listingblock data-line-202">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">console.log(`Our Contract address:
            ${our_contract._address}`);</code></pre>
</div>
</div>
<div class="paragraph data-line-207">
<p>or alternatively:</p>
</div>
<div class="listingblock data-line-210">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">console.log(`Our Contract address in another way:
            ${our_contract.options.address}`);</code></pre>
</div>
</div>
<div class="paragraph data-line-215">
<p>Now let&#8217;s query our contract ABI:</p>
</div>
<div class="listingblock data-line-218">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">console.log("Our contract abi: " +
            JSON.stringify(our_contract.options.jsonInterface));</code></pre>
</div>
</div>
<div class="paragraph data-line-223">
<p>We can see our contract&#8217;s total supply using a callback:</p>
</div>
<div class="listingblock data-line-226">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">our_contract.methods.totalSupply().call(function(err, totalSupply) {
    if (!err) {
        console.log(`Total Supply with a callback:  ${totalSupply}`);
    } else {
        console.log(err);
    }
});</code></pre>
</div>
</div>
<div class="paragraph data-line-236">
<p>Or we can use the returned promise instead of passing in the callback:</p>
</div>
<div class="listingblock data-line-239">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">our_contract.methods.totalSupply().call().then(function(totalSupply){
    console.log(`Total Supply with a promise:  ${totalSupply}`);
}).catch(function(err) {
    console.log(err);
});</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-247">
<h3 id="_asynchronous_operation_with_await">Asynchronous Operation with Await</h3>
<div class="paragraph data-line-41">
<p>Now that you&#8217;ve seen the basic tutorial, you can try the same interactions using an asynchronous await construct. Review the <em>web3-contract-basic-interaction-async-await.js</em> script in <a href="http://bit.ly/2ABrFkl" data-href="http://bit.ly/2ABrFkl"><em>code/web3js</em></a> and compare it to this tutorial to see how they differ. Async-await is easier to read, as it makes the asynchronous interaction behave more like a sequence of blocking calls.</p>
</div>
<div class="paragraph data-line-43">
<p>&lt;section data-type="index"/&gt;</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-05-14 16:04:26 -0400
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>