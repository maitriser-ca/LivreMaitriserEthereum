<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Ma√Ætriser Ethereum</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
<h1>Ma√Ætriser Ethereum</h1>
</div>
<div id="content">
<div class="sect1 pagenumrestart data-line-3">
<h2 id="whatis_chapter">Qu&#39;est-ce qu&#39;Ethereum ?</h2>
<div class="sectionbody">
<div class="paragraph data-line-5">
<p>Ethereum est souvent d√©crit comme &quot;l&#39;ordinateur du monde.&quot; Mais qu&#39;est-ce que cela signifie¬†? Commen√ßons par une description ax√©e sur l&#39;informatique, puis essayons de d√©crypter cela avec une analyse plus pratique des capacit√©s et des caract√©ristiques d&#39;Ethereum, tout en le comparant √† Bitcoin et √† d&#39;autres plateformes d&#39;√©change d&#39;informations d√©centralis√©es (ou ¬´¬†cha√Ænes de blocs¬†¬ª pour court).</p>
</div>
<div class="paragraph data-line-7">
<p>D&#39;un point de vue informatique, Ethereum est une machine √† √©tats d√©terministe mais pratiquement illimit√©e, compos√©e d&#39;un √©tat singleton globalement accessible et d&#39;une machine virtuelle qui applique des modifications √† cet √©tat.</p>
</div>
<div class="paragraph data-line-9">
<p>D&#39;un point de vue plus pratique, Ethereum est une infrastructure informatique √† source libre d√©centralis√©e √† l&#39;√©chelle mondiale qui ex√©cute des programmes appel√©s <em>contrats intelligents</em>. Il utilise une cha√Æne de blocs pour synchroniser et stocker les changements d&#39;√©tat du syst√®me, ainsi qu&#39;une cryptomonnaie appel√©e <em>ether</em> pour mesurer et limiter les co√ªts des ressources d&#39;ex√©cution.</p>
</div>
<div class="paragraph data-line-11">
<p>La plate-forme Ethereum permet aux d√©veloppeurs de cr√©er de puissantes applications d√©centralis√©es avec des fonctions √©conomiques int√©gr√©es. Tout en offrant une disponibilit√©, une auditabilit√©, une transparence et une neutralit√© √©lev√©es, il r√©duit ou √©limine √©galement la censure et r√©duit certains risques de contrepartie.</p>
</div>
<div class="sect2 data-line-14">
<h3 id="bitcoin_comparison">Compar√© √† Bitcoin</h3>
<div class="paragraph data-line-16">
<p>Beaucoup de gens viendront √† Ethereum avec une exp√©rience pr√©alable des cryptomonnaies, en particulier du Bitcoin. Ethereum partage de nombreux √©l√©ments communs avec d&#39;autres cha√Ænes de blocs ouvertes¬†: un r√©seau pair √† pair reliant les participants, un algorithme de consensus byzantin tol√©rant aux pannes pour la synchronisation des mises √† jour d&#39;√©tat (une cha√Æne de blocs de preuve de travail), l&#39;utilisation de primitives cryptographiques telles que le num√©rique signatures et hachages, et une monnaie num√©rique (ether).</p>
</div>
<div class="paragraph data-line-18">
<p>Pourtant, √† bien des √©gards, le but et la construction d&#39;Ethereum sont √©tonnamment diff√©rents de ceux des cha√Ænes de blocs ouvertes qui l&#39;ont pr√©c√©d√©, y compris Bitcoin.</p>
</div>
<div class="paragraph data-line-20">
<p> Le but d&#39;Ethereum n&#39;est pas principalement d&#39;√™tre un r√©seau de paiement en monnaie num√©rique. Alors que la monnaie num√©rique ether fait √† la fois partie int√©grante et n√©cessaire au fonctionnement d&#39;Ethereum, l&#39;ether est con√ßu comme une <em>monnaie d&#39;utilit√©</em> pour payer l&#39;utilisation de la plate-forme Ethereum en tant qu&#39;ordinateur mondial.</p>
</div>
<div class="paragraph data-line-22">
<p>Contrairement √† Bitcoin, qui a un langage de script tr√®s limit√©, Ethereum est con√ßu pour √™tre une cha√Æne de blocs programmable √† usage g√©n√©ral qui ex√©cute une <em>machine virtuelle</em> capable d&#39;ex√©cuter du code d&#39;une complexit√© arbitraire et illimit√©e. L√† o√π le langage de script de Bitcoin est, intentionnellement, contraint √† une simple √©valuation vrai/faux des conditions de d√©penses, le langage d&#39;Ethereum est <em>Turing complet</em>, ce qui signifie qu&#39;Ethereum peut fonctionner directement comme un ordinateur √† usage g√©n√©ral.</p>
</div>
</div>
<div class="sect2 data-line-25">
<h3 id="blockchain_components">Composantes d&#39;une cha√Æne de blocs</h3>
<div class="paragraph data-line-27">
<p>Les composantes d&#39;une cha√Æne de blocs ouverte et publique sont (g√©n√©ralement)¬†:</p>
</div>
<div class="ulist data-line-29">
<ul>
<li class="data-line-29">
<p>Un r√©seau pair √† pair (P2P) connectant les participants et propageant les transactions et les blocs de transactions v√©rifi√©es, bas√© sur un &quot;√©change&quot; <span class="keep-together">protocolaire</span> standardis√©.</p>
</li>
<li class="data-line-30">
<p>Messages, sous forme de transactions, repr√©sentant des transitions d&#39;√©tat</p>
</li>
<li class="data-line-31">
<p>Un ensemble de r√®gles consensuelles, r√©gissant ce qui constitue une transaction et ce qui constitue une transition d&#39;√©tat valide</p>
</li>
<li class="data-line-32">
<p>Une machine √† √©tats qui traite les transactions selon les r√®gles du consensus</p>
</li>
<li class="data-line-33">
<p>Une cha√Æne de blocs cryptographiquement s√©curis√©s qui agit comme un journal de toutes les transitions d&#39;√©tat v√©rifi√©es et accept√©es</p>
</li>
<li class="data-line-34">
<p>Un algorithme de consensus qui d√©centralise le contr√¥le sur la cha√Æne de blocs, en for√ßant les participants √† coop√©rer √† l&#39;application des r√®gles de consensus</p>
</li>
<li class="data-line-35">
<p>Un sch√©ma d&#39;incitation th√©oriquement valable (par exemple, les co√ªts de la preuve de travail plus les r√©compenses globales) pour s√©curiser √©conomiquement la machine d&#39;√©tat dans un <span class="keep-together">environnement</span> ouvert.</p>
</li>
<li class="data-line-36">
<p>Une ou plusieurs impl√©mentations logicielles √† source libre des √©l√©ments ci-dessus (&quot;clients&quot;)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-38">
<p>Tous ou la plupart de ces composants sont g√©n√©ralement combin√©s dans un seul client logiciel. Par exemple, dans Bitcoin, l&#39;impl√©mentation de r√©f√©rence est d√©velopp√©e par le projet √† source libre <em>Bitcoin Core</em> et impl√©ment√©e en tant que client <em>bitcoind</em>. Dans Ethereum, plut√¥t qu&#39;une impl√©mentation de r√©f√©rence, il existe une <em>sp√©cification de r√©f√©rence</em>, une description math√©matique du syst√®me dans le livre jaune (voir <a href="#references">Lectures compl√©mentaires</a>). Il existe un certain nombre de clients, qui sont construits selon la sp√©cification de r√©f√©rence.</p>
</div>
<div class="paragraph data-line-40">
<p>Dans le pass√©, nous utilisions le terme &quot;cha√Æne de blocs&quot; pour repr√©senter tous les composants que nous venons d&#39;√©num√©rer, comme une r√©f√©rence abr√©g√©e √† la combinaison de technologies qui englobent toutes les caract√©ristiques d√©crites. Aujourd&#39;hui, cependant, il existe une grande vari√©t√© de cha√Ænes de blocs avec des propri√©t√©s diff√©rentes. Nous avons besoin de qualificatifs pour nous aider √† comprendre les caract√©ristiques de la cha√Æne de blocs en question, telles que <em>ouverte, publique, globale, d√©centralis√©e, neutre,</em> et <em>r√©sistante √† la censure</em>, pour identifier les caract√©ristiques √©mergentes importantes d&#39;un syst√®me &quot;cha√Æne de blocs&quot; que ces composants permettent.</p>
</div>
<div class="paragraph data-line-42">
<p>Toutes les cha√Ænes de blocs ne sont pas cr√©√©es √©gales. Quand quelqu&#39;un vous dit que quelque chose est une cha√Æne de blocs, vous n&#39;avez pas re√ßu de r√©ponse ; vous devez plut√¥t commencer √† poser beaucoup de questions pour clarifier ce qu&#39;elles veulent dire lorsqu&#39;elles utilisent le mot &quot;cha√Æne de blocs&quot;. Commencez par demander une description des composants de la liste pr√©c√©dente, puis demandez si cette &quot;cha√Æne de blocs&quot; pr√©sente les caract√©ristiques d&#39;√™tre <em>ouverte, publique</em>, etc.</p>
</div>
</div>
<div class="sect2 data-line-45">
<h3 id="ethereum_birth">La naissance d&#39;Ethereum</h3>
<div class="paragraph data-line-47">
<p> Toutes les grandes innovations r√©solvent de vrais probl√®mes, et Ethereum ne fait pas exception. Ethereum a √©t√© con√ßu √† une √©poque o√π les gens reconnaissaient la puissance du mod√®le Bitcoin et essayaient d&#39;aller au-del√† des applications de cryptomonnaie. Mais les d√©veloppeurs √©taient confront√©s √† une √©nigme : ils devaient soit construire sur Bitcoin, soit d√©marrer une nouvelle cha√Æne de blocs. S&#39;appuyer sur Bitcoin signifiait vivre dans les limites intentionnelles du r√©seau et essayer de trouver des solutions de contournement. L&#39;ensemble limit√© de types de transactions, de types de donn√©es et de tailles de stockage de donn√©es semblait limiter les types d&#39;applications pouvant s&#39;ex√©cuter directement sur Bitcoin¬†; tout le reste n√©cessitait des couches hors cha√Æne suppl√©mentaires, ce qui annulait imm√©diatement bon nombre des avantages de l&#39;utilisation d&#39;une cha√Æne de blocs publique. Pour les projets qui avaient besoin de plus de libert√© et de flexibilit√© tout en restant pertinent, une nouvelle cha√Æne de blocs √©tait la seule option. Mais cela signifiait beaucoup de travail : d√©marrage de tous les √©l√©ments de l&#39;infrastructure, tests exhaustifs, etc.</p>
</div>
<div class="paragraph data-line-49">
<p> Vers la fin de 2013, Vitalik Buterin, un jeune programmeur et passionn√© de Bitcoin, a commenc√© √† r√©fl√©chir √† l&#39;extension des capacit√©s de Bitcoin et Mastercoin (un protocole Bitcoin de superposition √©tendu pour offrir des contrats intelligents rudimentaires). En octobre de la m√™me ann√©e, Vitalik a propos√© une approche plus g√©n√©ralis√©e √† l&#39;√©quipe Mastercoin, qui permettait √† des contrats flexibles et scriptables (mais pas Turing-complets) de remplacer le langage contractuel sp√©cialis√© de Mastercoin. Bien que l&#39;√©quipe Mastercoin ait √©t√© impressionn√©e, cette proposition √©tait un changement trop radical pour s&#39;int√©grer dans leur feuille de route de d√©veloppement.</p>
</div>
<div class="paragraph data-line-51">
<p>En d√©cembre 2013, Vitalik a commenc√© √† partager un livre blanc qui d√©crivait l&#39;id√©e derri√®re Ethereum : une cha√Æne de blocs √† usage g√©n√©ral compl√®te de Turing. Quelques dizaines de personnes ont vu cette premi√®re √©bauche et ont fait part de leurs commentaires, aidant Vitalik √† faire √©voluer la proposition.</p>
</div>
<div class="paragraph data-line-53">
<p>Les deux auteurs de ce livre ont re√ßu une premi√®re √©bauche du livre blanc et l&#39;ont comment√©e. Andreas M. Antonopoulos a √©t√© intrigu√© par l&#39;id√©e et a pos√© de nombreuses questions √† Vitalik sur l&#39;utilisation d&#39;une cha√Æne de blocs distincte pour appliquer des r√®gles de consensus sur l&#39;ex√©cution de contrats intelligents et les implications d&#39;un langage Turing-complet. Andreas a continu√© √† suivre les progr√®s d&#39;Ethereum avec beaucoup d&#39;int√©r√™t, mais en √©tait aux premiers stades de l&#39;√©criture de son livre <em>Mastering Bitcoin</em>, et n&#39;a particip√© directement √† Ethereum que bien plus tard. Dr. Gavin Wood, cependant, a √©t√© l&#39;une des premi√®res personnes √† contacter Vitalik et √† lui proposer de l&#39;aider avec ses comp√©tences en programmation C++. Gavin est devenu le cofondateur, le codesigner et le CTO d&#39;Ethereum.</p>
</div>
<div class="paragraph data-line-55">
<p>Comme le raconte Vitalik dans son <a href="http://bit.ly/2T2t6zs" data-href="http://bit.ly/2T2t6zs">article &quot;Ethereum Prehistory&quot;</a> :</p>
</div>
<div class="quoteblock data-line-57">
<blockquote>
<div class="paragraph data-line-58">
<p>C&#39;√©tait l&#39;√©poque o√π le protocole Ethereum √©tait enti√®rement ma propre cr√©ation. √Ä partir de l√†, cependant, de nouveaux participants ont commenc√© √† rejoindre le giron. De loin, le plus important du c√¥t√© du protocole √©tait Gavin Wood&#8230;&#8203;</p>
</div>
<div class="paragraph data-line-60">
<p>Gavin peut √©galement √™tre largement cr√©dit√© du changement subtil de vision d&#39;Ethereum comme une plate-forme pour cr√©er de l&#39;argent programmable, avec des contrats bas√©s sur la cha√Æne de blocs qui peuvent contenir des actifs num√©riques et les transf√©rer selon des r√®gles pr√©d√©finies, √† une plate-forme informatique √† usage g√©n√©ral. Cela a commenc√© par de subtils changements d&#39;accent et de terminologie, et plus tard cette influence s&#39;est renforc√©e avec l&#39;accent croissant mis sur l&#39;ensemble &quot;Web 3&quot;, qui consid√©rait Ethereum comme un √©l√©ment d&#39;une suite de technologies d√©centralis√©es, les deux autres √©tant Whisper et Swarm.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-63">
<p>√Ä partir de d√©cembre 2013, Vitalik et Gavin ont affin√© et fait √©voluer l&#39;id√©e, construisant ensemble la couche de protocole qui est devenue Ethereum.</p>
</div>
<div class="paragraph data-line-65">
<p>Les fondateurs d&#39;Ethereum pensaient √† une cha√Æne de blocs sans but pr√©cis, qui pourrait prendre en charge une grande vari√©t√© d&#39;applications en √©tant <em>programm√©e</em>. L&#39;id√©e √©tait qu&#39;en utilisant une cha√Æne de blocs √† usage g√©n√©ral comme Ethereum, un d√©veloppeur pouvait programmer son application particuli√®re sans avoir √† mettre en ≈ìuvre les m√©canismes sous-jacents des r√©seaux pair √† pair, des cha√Ænes de blocs, des algorithmes de consensus, etc. La plateforme Ethereum a √©t√© con√ßue pour abstraire ces d√©tails en fournissant un environnement de programmation d√©terministe et s√©curis√© pour les applications cha√Æne de blocs d√©centralis√©es.</p>
</div>
<div class="paragraph data-line-67">
<p>Tout comme Satoshi, Vitalik et Gavin n&#39;ont pas simplement invent√© une nouvelle technologie ; ils ont combin√© de nouvelles inventions avec des technologies existantes d&#39;une mani√®re nouvelle et ont livr√© le code prototype pour prouver leurs id√©es au monde.</p>
</div>
<div class="paragraph data-line-69">
<p>Les fondateurs ont travaill√© pendant des ann√©es, construisant et affinant la vision. Et le 30 juillet 2015, le premier bloc Ethereum a √©t√© min√©. L&#39;ordinateur du monde a commenc√© √† servir le monde.</p>
</div>
<div class="admonitionblock note data-line-72">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-73">
<p>L&#39;article de Vitalik Buterin &quot;A Prehistory of Ethereum&quot; a √©t√© publi√© en septembre 2017 et offre une vue fascinante √† la premi√®re personne des premiers instants d&#39;Ethereum.</p>
</div>
<div class="paragraph data-line-75">
<p>Vous pouvez le lire sur
<a href="https://vitalik.ca/general/2017/09/14/prehistory.html" class="undefined" data-href="https://vitalik.ca/general/2017/09/14/prehistory.html">https://vitalik.ca/general/2017/09/14/prehistory.html</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-80">
<h3 id="development_stages">Les quatre √©tapes de d√©veloppement d&#39;Ethereum</h3>
<div class="paragraph data-line-82">
<p>Le d√©veloppement d&#39;Ethereum a √©t√© planifi√© en quatre √©tapes distinctes, avec des changements majeurs √† chaque √©tape.  Une √©tape peut inclure des sous-versions, appel√©es &quot;embranchements divergents&quot; (hard forks), qui modifient les fonctionnalit√©s d&#39;une mani√®re qui n&#39;est pas r√©trocompatible .</p>
</div>
<div class="paragraph data-line-84">
<p>Les quatre principales √©tapes de d√©veloppement portent le nom de code <em>Frontier</em>, <em>Homestead</em>, <em>Metropolis</em> et <em>Serenity</em>. Les embranchements divergents interm√©diaires qui se sont produits (ou sont pr√©vus) √† ce jour portent les noms de code <em>Ice Age</em>, <em>DAO</em>, <em>Tangerine Whistle</em>, <em>Spurious Dragon</em>, <em>Byzantium</em> et <em>Constantinople</em>. Les √©tapes de d√©veloppement et les embranchements divergents interm√©diaires sont pr√©sent√©es sur la chronologie suivante, qui est &quot;dat√©e&quot; par num√©ro de bloc¬†:</p>
</div>
<div class="dlist data-line-87">
<dl>
<dt class="hdlist1">Bloc #0</dt>
<dd>
<p><em>Frontier</em>‚ÄîL&#39;√©tape initiale d&#39;Ethereum, du 30 juillet 2015 √† mars 2016.</p>
</dd>
<dt class="hdlist1">Bloc #200 000</dt>
<dd>
<p><em>Ice Age</em>‚ÄîUn embranchement divergent pour introduire une augmentation exponentielle de la difficult√©, pour motiver une transition vers PoS lorsque pr√™t.</p>
</dd>
<dt class="hdlist1">Bloc #1 150 000</dt>
<dd>
<p><em>Homestead</em>‚ÄîLa deuxi√®me √©tape d&#39;Ethereum, lanc√©e en mars 2016.</p>
</dd>
<dt class="hdlist1">Bloc #1 192 000</dt>
<dd>
<p><em>DAO</em>‚ÄîUn embranchement divergent qui a rembours√© les victimes du contrat DAO pirat√© et a provoqu√© la scission d&#39;Ethereum et d&#39;Ethereum Classic en deux syst√®mes concurrents.</p>
</dd>
<dt class="hdlist1">Bloc #2 463 000</dt>
<dd>
<p><em>Tangerine Whistle</em>‚ÄîUn embranchement divergent pour modifier le calcul du gaz pour certaines op√©rations lourdes en E/S et pour effacer l&#39;√©tat accumul√© d&#39;un d√©ni de service (DoS) attaque qui a exploit√© le faible co√ªt du gaz de ces op√©rations.</p>
</dd>
<dt class="hdlist1">Bloc #2 675 000</dt>
<dd>
<p><em>Spurious Dragon</em>‚ÄîUn embranchement divergent pour traiter plus de vecteurs d&#39;attaque DoS, et un autre effacement d&#39;√©tat. En outre, un m√©canisme de protection contre les attaques par relecture.</p>
</dd>
<dt class="hdlist1">Bloc #4 370 000</dt>
<dd>
<p><em>Metropolis Byzantium</em>‚ÄîMetropolis est la troisi√®me √©tape d&#39;Ethereum, en cours au moment de la r√©daction de ce livre, lanc√©e en octobre 2017. Byzance est le premier des deux embranchements divergents pr√©vus pour Metropolis.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-103">
<p>Apr√®s Byzance, il y a un autre embranchement divergent pr√©vu pour Metropolis¬†: Constantinople. Metropolis sera suivi de la derni√®re √©tape du d√©ploiement d&#39;Ethereum, baptis√©e Serenity.</p>
</div>
</div>
<div class="sect2 data-line-107">
<h3 id="general_purpose_blockchain">Ethereum¬†: une cha√Æne de blocs √† usage g√©n√©ral</h3>
<div class="paragraph data-line-109">
<p>La cha√Æne de blocs d&#39;origine, √† savoir la cha√Æne de blocs de Bitcoin, suit l&#39;√©tat de unit√©s de bitcoin et leur propri√©t√©.  Vous pouvez consid√©rer Bitcoin comme une <em>machine √† √©tats</em> √† consensus distribu√©, o√π les transactions provoquent une <em>transition d&#39;√©tat</em> globale, modifiant la propri√©t√© des pi√®ces. Les transitions d&#39;√©tat sont contraintes par les r√®gles du consensus, permettant √† tous les participants de (√©ventuellement) converger vers un √©tat commun (consensus) du syst√®me, apr√®s que plusieurs blocs aient √©t√© min√©s.</p>
</div>
<div class="paragraph data-line-111">
<p>Ethereum est √©galement une machine √† √©tats distribu√©e. Mais au lieu de suivre uniquement l&#39;√©tat de la propri√©t√© de la devise, Ethereum suit les transitions d&#39;√©tat d&#39;un magasin de donn√©es √† usage g√©n√©ral, c&#39;est-√†-dire un magasin pouvant contenir toutes les donn√©es exprimables en tant que <em>uplet cl√©‚Äìvaleur</em>. Un magasin de donn√©es cl√©-valeur contient des valeurs arbitraires, chacune r√©f√©renc√©e par une cl√© ; par exemple, la valeur &quot;Mastering Ethereum&quot; r√©f√©renc√©e par la cl√© &quot;Titre du livre&quot;. √Ä certains √©gards, cela sert le m√™me objectif que le mod√®le de stockage de donn√©es de <em>Random Access Memory</em> (RAM) utilis√© par la plupart des ordinateurs √† usage g√©n√©ral. Ethereum a une m√©moire qui stocke √† la fois le code et les donn√©es, et il utilise la cha√Æne de blocs Ethereum pour suivre l&#39;√©volution de cette m√©moire au fil du temps. Comme un ordinateur √† programme stock√© √† usage g√©n√©ral, Ethereum peut charger du code dans sa machine d&#39;√©tat et <em>ex√©cuter</em> ce code, en stockant les changements d&#39;√©tat r√©sultants dans sa cha√Æne de blocs. Deux des diff√©rences critiques par rapport √† la plupart des ordinateurs √† usage g√©n√©ral sont que les changements d&#39;√©tat d&#39;Ethereum sont r√©gis par les r√®gles du consensus et que l&#39;√©tat est distribu√© √† l&#39;√©chelle mondiale. Ethereum r√©pond √† la question : &quot;Et si nous pouvions suivre n&#39;importe quel √©tat arbitraire et programmer la machine √† √©tats pour cr√©er un ordinateur mondial fonctionnant par consensus ?&quot;</p>
</div>
</div>
<div class="sect2 data-line-114">
<h3 id="ethereum_components">Composants d&#39;Ethereum</h3>
<div class="paragraph data-line-116">
<p>Dans Ethereum, les composantes d&#39;un syst√®me de cha√Æne de blocs d√©crit dans <a href="#blockchain_components">Composantes d&#39;une cha√Æne de blocs</a> sont, plus pr√©cis√©ment :</p>
</div>
<div class="dlist data-line-119">
<dl>
<dt class="hdlist1">R√©seau P2P</dt>
<dd>
<p>Ethereum fonctionne sur le <em>r√©seau principal Ethereum</em>, qui est adressable sur le port TCP 30303, et ex√©cute un protocole appel√© <em>√êŒûVp2p</em>.</p>
</dd>
<dt class="hdlist1">R√®gles de consensus </dt>
<dd>
<p>Les r√®gles de consensus d&#39;Ethereum sont d√©finies dans la sp√©cification de r√©f√©rence, le Yellow Paper (voir <a href="#references">Lectures compl√©mentaires</a>).</p>
</dd>
<dt class="hdlist1">Transactions</dt>
<dd>
<p>Les transactions Ethereum sont des messages r√©seau qui incluent (entre autres) un exp√©diteur, un destinataire, une valeur et une charge utile de donn√©es.</p>
</dd>
</dl>
</div>
<div class="dlist pagebreak-before data-line-126">
<dl>
<dt class="hdlist1">Machine d&#39;√©tat</dt>
<dd>
<p>Les transitions d&#39;√©tat Ethereum sont trait√©es par la <em>Ethereum Virtual Machine</em> (EVM), une machine virtuelle bas√©e sur la pile qui ex√©cute le <em>bytecode</em> (code interm√©diaire ou instructions en langage machine). Les programmes EVM, appel√©s ¬´¬†contrats intelligents¬†¬ª, sont √©crits dans des langages de haut niveau (par exemple, Solidity) et compil√©s en code interm√©diaire pour √™tre ex√©cut√©s sur l&#39;EVM.</p>
</dd>
<dt class="hdlist1">Structures de donn√©es</dt>
<dd>
<p>L&#39;√©tat d&#39;Ethereum est stock√© localement sur chaque n≈ìud en tant que <em>base de donn√©es</em> (g√©n√©ralement LevelDB de Google), qui contient les transactions et l&#39;√©tat du syst√®me dans une structure de donn√©es hach√©e s√©rialis√©e appel√©e <em>Arbre Merkle Patricia</em>.</p>
</dd>
<dt class="hdlist1">Algorithme de consensus</dt>
<dd>
<p>Ethereum utilise le mod√®le de consensus de Bitcoin, Nakamoto Consensus, qui utilise des blocs s√©quentiels √† signature unique, pond√©r√©s en importance par PoW pour d√©terminer la cha√Æne la plus longue et donc l&#39;√©tat actuel. Cependant, il est pr√©vu de passer √† un syst√®me de vote pond√©r√© PoS, nomm√© <em>Casper</em>, dans un proche avenir.</p>
</dd>
<dt class="hdlist1">S√©curit√© √©conomique</dt>
<dd>
<p>Ethereum utilise actuellement un algorithme PoW appel√© <em>Ethash</em>, mais cela finira par √™tre abandonn√© avec le passage au PoS √† un moment donn√© dans le futur.</p>
</dd>
<dt class="hdlist1">Clients</dt>
<dd>
<p>Ethereum a plusieurs impl√©mentations interop√©rables du logiciel client, dont les plus importantes sont <em>Go-Ethereum</em> (<em>Geth</em>) et <em>Parity</em>.</p>
</dd>
</dl>
</div>
<div class="sect3 data-line-137">
<h4 id="references">Lectures compl√©mentaires</h4>
<div class="paragraph data-line-139">
<p>Les r√©f√©rences suivantes fournissent des informations suppl√©mentaires sur les technologies mentionn√©es ici¬†:</p>
</div>
<div class="ulist data-line-141">
<ul>
<li class="data-line-141">
<p>Le livre jaune Ethereum:
<a href="https://ethereum.github.io/yellowpaper/paper.pdf" class="undefined" data-href="https://ethereum.github.io/yellowpaper/paper.pdf">https://ethereum.github.io/yellowpaper/paper.pdf</a></p>
</li>
<li class="data-line-144">
<p>Le Livre Beige, une r√©√©criture du Livre Jaune pour un public plus large dans un langage moins formel:
<a href="https://github.com/chronaeon/beigepaper" class="undefined" data-href="https://github.com/chronaeon/beigepaper">https://github.com/chronaeon/beigepaper</a></p>
</li>
<li class="data-line-147">
<p>Protocole r√©seau √êŒûVp2p:
<a href="http://bit.ly/2quAlTE" class="undefined" data-href="http://bit.ly/2quAlTE">http://bit.ly/2quAlTE</a></p>
</li>
<li class="data-line-150">
<p>Liste des ressources de la machine virtuelle Ethereum:
<a href="http://bit.ly/2PmtjiS" class="undefined" data-href="http://bit.ly/2PmtjiS">http://bit.ly/2PmtjiS</a></p>
</li>
<li class="data-line-153">
<p>Base de donn√©es LevelDB (utilis√©e le plus souvent pour stocker la copie locale de la cha√Æne de blocs):
<a href="https://github.com/google/leveldb" class="undefined" data-href="https://github.com/google/leveldb">https://github.com/google/leveldb</a></p>
</li>
<li class="data-line-156">
<p>Arbres Merkle Patricia:
<a href="https://github.com/ethereum/wiki/wiki/Patricia-Tree" class="undefined" data-href="https://github.com/ethereum/wiki/wiki/Patricia-Tree">https://github.com/ethereum/wiki/wiki/Patricia-Tree</a></p>
</li>
<li class="data-line-159">
<p>Algorithme Ethash PoW:
<a href="https://github.com/ethereum/wiki/wiki/Ethash" class="undefined" data-href="https://github.com/ethereum/wiki/wiki/Ethash">https://github.com/ethereum/wiki/wiki/Ethash</a></p>
</li>
<li class="data-line-162">
<p>Guide de mise en ≈ìuvre de Casper PoS v1:
<a href="http://bit.ly/2DyPr3l" class="undefined" data-href="http://bit.ly/2DyPr3l">http://bit.ly/2DyPr3l</a></p>
</li>
<li class="data-line-165">
<p>Client Go-Ethereum (Geth):
<a href="https://geth.ethereum.org/" class="undefined" data-href="https://geth.ethereum.org/">https://geth.ethereum.org/</a></p>
</li>
<li class="data-line-168">
<p>Client Ethereum Parity:
<a href="https://parity.io/" class="undefined" data-href="https://parity.io/">https://parity.io/</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 data-line-172">
<h3 id="turing_completeness">Compl√©tude d&#39;Ethereum et de Turing</h3>
<div class="paragraph data-line-174">
<p>D√®s que vous commencez √† lire sur Ethereum, vous rencontrerez imm√©diatement le terme &quot;Turing complet&quot;. Ethereum, disent-ils, contrairement √† Bitcoin, est Turing complet. Qu&#39;est-ce que cela veut dire exactement?</p>
</div>
<div class="paragraph data-line-176">
<p>Le terme fait r√©f√©rence au math√©maticien anglais Alan Turing, qui est consid√©r√© comme le p√®re de l&#39;informatique. En 1936, il cr√©e un mod√®le math√©matique d&#39;ordinateur consistant en une machine √† √©tats qui manipule des symboles en les lisant et en les √©crivant sur une m√©moire s√©quentielle (ressemblant √† une bande de papier de longueur infinie). Avec cette construction, Turing a continu√© √† fournir une base math√©matique pour r√©pondre (par la n√©gative) aux questions sur la <em>calculabilit√© universelle</em>, c&#39;est-√†-dire si tous les probl√®mes peuvent √™tre r√©solus. Il a prouv√© qu&#39;il existe des classes de probl√®mes qui ne sont pas calculables. Plus pr√©cis√©ment, il a prouv√© que le <em>probl√®me d&#39;arr√™t</em> (s&#39;il est possible, √©tant donn√© un programme arbitraire et son entr√©e, de d√©terminer si le programme finira par s&#39;arr√™ter) n&#39;est pas r√©soluble.</p>
</div>
<div class="paragraph data-line-178">
<p>Alan Turing a en outre d√©fini un syst√®me comme √©tant <em>Turing complet</em> s&#39;il peut √™tre utilis√© pour simuler n&#39;importe quelle machine de Turing. Un tel syst√®me s&#39;appelle une <em>machine de Turing universelle</em> (UTM).</p>
</div>
<div class="paragraph data-line-180">
<p>La capacit√© d&#39;Ethereum √† ex√©cuter un programme stock√©, dans une machine √† √©tats appel√©e Ethereum Virtual Machine, tout en lisant et en √©crivant des donn√©es dans la m√©moire en fait un syst√®me Turing complet et donc un UTM. Ethereum peut calculer n&#39;importe quel algorithme pouvant √™tre calcul√© par n&#39;importe quelle machine de Turing, compte tenu des limites de la m√©moire finie.</p>
</div>
<div class="paragraph data-line-182">
<p>L&#39;innovation r√©volutionnaire d&#39;Ethereum consiste √† combiner l&#39;architecture informatique √† usage g√©n√©ral d&#39;un ordinateur √† programme stock√© avec une cha√Æne de blocs d√©centralis√©e, cr√©ant ainsi un ordinateur mondial distribu√© √† un seul √©tat (singleton). Les programmes Ethereum s&#39;ex√©cutent &quot;partout&quot;, mais produisent un √©tat commun qui est s√©curis√© par les r√®gles de <span class="keep-together">consensus</span>.</p>
</div>
<div class="sect3 data-line-185">
<h4 id="turing_completeness_feature">Compl√©tude de Turing en tant que &quot;fonctionnalit√©&quot;</h4>
<div class="paragraph data-line-187">
<p> En entendant qu&#39;Ethereum est Turing complet, vous pourriez arriver √† la conclusion qu&#39;il s&#39;agit d&#39;une <em>fonctionnalit√©</em> qui manque d&#39;une mani√®re ou d&#39;une autre dans un syst√®me qui est incomplet de Turing. C&#39;est plut√¥t le contraire. La compl√©tude de Turing est tr√®s facile √† r√©aliser ; en fait, <a href="http://bit.ly/2ABft33" class="undefined" data-href="http://bit.ly/2ABft33">http://bit.ly/2ABft33</a> [la machine d&#39;√©tat Turing compl√®te la plus simple connue] a 4 √©tats et utilise 6 symboles, avec une d√©finition d&#39;√©tat qui ne compte que 22 instructions. En effet, il arrive parfois que des syst√®mes soient ¬´ accidentellement Turing complets ¬ª. Une r√©f√©rence amusante de tels syst√®mes peut √™tre trouv√©e √† <a href="http://bit.ly/2Og1VgX" class="undefined" data-href="http://bit.ly/2Og1VgX">http://bit.ly/2Og1VgX</a>.</p>
</div>
<div class="paragraph data-line-189">
<p>Cependant, l&#39;exhaustivit√© de Turing est tr√®s dangereuse, en particulier dans les syst√®mes √† acc√®s ouvert comme les cha√Ænes de blocs publiques, en raison du probl√®me d&#39;arr√™t que nous avons √©voqu√© plus t√¥t. Par exemple, les imprimantes modernes sont Turing compl√®tes et peuvent recevoir des fichiers √† imprimer qui les envoient dans un √©tat fig√©. Le fait qu&#39;Ethereum soit Turing complet signifie que n&#39;importe quel programme de n&#39;importe quelle complexit√© peut √™tre calcul√© par Ethereum. Mais cette flexibilit√© pose des probl√®mes √©pineux de s√©curit√© et de gestion des ressources. Une imprimante qui ne r√©pond pas peut √™tre √©teinte et rallum√©e. Ce n&#39;est pas possible avec une cha√Æne de blocs publique.</p>
</div>
</div>
<div class="sect3 data-line-192">
<h4 id="turing_completeness_implications">Implications de la compl√©tude de Turing</h4>
<div class="paragraph data-line-194">
<p>Turing a prouv√© que vous ne pouvez pas pr√©dire si un programme se terminera en le simulant sur un ordinateur. En termes simples, nous ne pouvons pas pr√©dire le chemin d&#39;un programme sans l&#39;ex√©cuter. Les syst√®mes Turing-complets peuvent s&#39;ex√©cuter en &quot;boucles infinies&quot;, un terme utilis√© (en simplifiant √† l&#39;extr√™me) pour d√©crire un programme qui ne se termine pas. Il est trivial de cr√©er un programme qui ex√©cute une boucle qui ne se termine jamais. Mais des boucles sans fin involontaires peuvent survenir sans avertissement, en raison d&#39;interactions complexes entre les conditions de d√©part et le code. Dans Ethereum, cela pose un d√©fi¬†: chaque n≈ìud participant (client) doit valider chaque transaction, en ex√©cutant tous les contrats intelligents qu&#39;il appelle. Mais comme Turing l&#39;a prouv√©, Ethereum ne peut pas pr√©dire si un contrat intelligent prendra fin, ou combien de temps il durera, sans r√©ellement l&#39;ex√©cuter (√©ventuellement pour toujours). Que ce soit par accident ou expr√®s, un contrat intelligent peut √™tre cr√©√© de telle sorte qu&#39;il s&#39;ex√©cute ind√©finiment lorsqu&#39;un n≈ìud tente de le valider. Il s&#39;agit en fait d&#39;une attaque DoS. Et bien s√ªr, entre un programme qui prend une milliseconde √† valider et un autre qui s&#39;ex√©cute ind√©finiment, il existe une gamme infinie de programmes d√©sagr√©ables, monopolisant les ressources, gonflant la m√©moire et provoquant une surchauffe du processeur qui gaspillent simplement des ressources. Dans un ordinateur mondial, un programme qui abuse des ressources arrive √† abuser des ressources mondiales. Comment Ethereum limite-t-il les ressources utilis√©es par un contrat intelligent s&#39;il ne peut pas pr√©dire l&#39;utilisation des ressources √† l&#39;avance ?</p>
</div>
<div class="paragraph data-line-196">
<p>Pour r√©pondre √† ce d√©fi, Ethereum introduit un m√©canisme de mesure appel√© <em>gaz</em>. Comme l&#39;EVM ex√©cute un contrat intelligent, il comptabilise soigneusement chaque instruction (calcul, acc√®s aux donn√©es, etc.). Chaque instruction a un co√ªt pr√©d√©termin√© en unit√©s de gaz. Lorsqu&#39;une transaction d√©clenche l&#39;ex√©cution d&#39;un contrat intelligent, elle doit inclure une quantit√© de gaz qui fixe la limite sup√©rieure de ce qui peut √™tre consomm√© en ex√©cutant le contrat intelligent. L&#39;EVM terminera l&#39;ex√©cution si la quantit√© de gaz consomm√©e par le calcul d√©passe le gaz disponible dans la transaction. Le gaz est le m√©canisme utilis√© par Ethereum pour permettre un calcul complet de Turing tout en limitant les ressources que tout programme peut consommer.</p>
</div>
<div class="paragraph data-line-198">
<p>La question suivante est, &quot;comment obtenir du gaz pour payer le calcul sur l&#39;ordinateur mondial Ethereum?&quot; Vous ne trouverez pas de gaz sur les √©changes.  Il ne peut √™tre achet√© que dans le cadre d&#39;une transaction et ne peut √™tre achet√© qu&#39;avec de l&#39;ether. L&#39;ether doit √™tre envoy√© avec une transaction et il doit √™tre explicitement affect√© √† l&#39;achat de gaz, avec un prix du gaz acceptable. Comme √† la pompe, le prix de l&#39;essence n&#39;est pas fixe. Le gaz est achet√© pour la transaction, le calcul est ex√©cut√© et tout gaz non utilis√© est rembours√© √† l&#39;exp√©diteur de la transaction.</p>
</div>
</div>
</div>
<div class="sect2 data-line-201">
<h3 id="DApp">Des cha√Ænes de blocs √† usage g√©n√©ral aux applications d√©centralis√©es (DApps)</h3>
<div class="paragraph data-line-203">
<p>Ethereum a commenc√© comme un moyen de cr√©er une cha√Æne de blocs √† usage g√©n√©ral qui peut √™tre programm√© pour une vari√©t√© d&#39;utilisations. Mais tr√®s rapidement, la vision d&#39;Ethereum s&#39;est √©largie pour devenir une plateforme de programmation de DApps. Les DApps repr√©sentent une perspective plus large que les contrats intelligents. Un DApp est, √† tout le moins, un contrat intelligent et une interface utilisateur Web. Plus g√©n√©ralement, une DApp est une application Web qui repose sur des services d&#39;infrastructure ouverts, d√©centralis√©s et pair √† pair.</p>
</div>
<div class="paragraph data-line-205">
<p>Une DApp est compos√©e d&#39;au moins :</p>
</div>
<div class="ulist data-line-207">
<ul>
<li class="data-line-207">
<p>Contrats intelligents sur une cha√Æne de blocs</p>
</li>
<li class="data-line-208">
<p>Une interface utilisateur Web frontale</p>
</li>
</ul>
</div>
<div class="paragraph data-line-210">
<p>De plus, de nombreux DApps incluent d&#39;autres composants d√©centralis√©s, tels que :</p>
</div>
<div class="ulist data-line-212">
<ul>
<li class="data-line-212">
<p>Un protocole et une plateforme de stockage d√©centralis√© (P2P)</p>
</li>
<li class="data-line-213">
<p>Un protocole et une plateforme de messagerie d√©centralis√©e (P2P)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip data-line-216">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-217">
<p>Vous pouvez voir des DApps orthographi√©s comme <em>√êApps</em>. Le caract√®re √ê est le caract√®re latin appel√© &quot;ETH&quot;, faisant allusion √† Ethereum. Pour afficher ce caract√®re, utilisez le point de code Unicode 0xD0, ou si n√©cessaire l&#39;entit√© caract√®re HTML eth (ou entit√© d√©cimale #208).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-221">
<h3 id="evolving_WWW">Le troisi√®me √¢ge d&#39;Internet</h3>
<div class="paragraph data-line-223">
<p>En 2004, le terme &quot;Web 2.0&quot; a pris de l&#39;importance, d√©crivant une √©volution du Web vers un contenu g√©n√©r√© par l&#39;utilisateur, des interfaces r√©actives et l&#39;interactivit√©. Web 2.0 n&#39;est pas une sp√©cification technique, mais plut√¥t un terme d√©crivant le nouveau centre d&#39;int√©r√™t des <span class="keep-together">applications</span> Web.</p>
</div>
<div class="paragraph data-line-225">
<p>Le concept de DApps est destin√© √† faire passer le World Wide Web √† sa prochaine √©tape d&#39;√©volution naturelle, en introduisant la d√©centralisation avec des protocoles pair √† pair dans tous les aspects d&#39;une application Web. Le terme utilis√© pour d√©crire cette √©volution est <em>web3</em>, c&#39;est-√†-dire la troisi√®me &quot;version&quot; du web.  Propos√© pour la premi√®re fois par le Dr Gavin Wood, web3 repr√©sente une nouvelle vision et une nouvelle orientation pour les applications Web¬†: des applications d√©tenues et g√©r√©es de mani√®re centralis√©e aux applications bas√©es sur des protocoles d√©centralis√©s .</p>
</div>
<div class="paragraph data-line-227">
<p>Dans les chapitres suivants, nous explorerons la biblioth√®que JavaScript Ethereum web3.js, qui relie les applications JavaScript qui s&#39;ex√©cutent dans votre navigateur avec la cha√Æne de blocs Ethereum. La biblioth√®que web3.js comprend √©galement une interface vers un r√©seau de stockage P2P appel√© <em>Swarm</em> et un service de messagerie P2P appel√© <em>Whisper</em>. Avec ces trois composants inclus dans une biblioth√®que JavaScript ex√©cut√©e dans votre navigateur Web, les d√©veloppeurs disposent d&#39;une suite compl√®te de d√©veloppement d&#39;applications qui leur permet de cr√©er des DApps web3.</p>
</div>
</div>
<div class="sect2 data-line-230">
<h3 id="development_culture">Culture de d√©veloppement d&#39;Ethereum</h3>
<div class="paragraph data-line-232">
<p> Jusqu&#39;√† pr√©sent, nous avons expliqu√© en quoi les objectifs et la technologie d&#39;Ethereum diff√®rent de ceux des autres cha√Ænes de blocs qui l&#39;ont pr√©c√©d√© , comme Bitcoin. Ethereum a √©galement une culture de d√©veloppement tr√®s diff√©rente.</p>
</div>
<div class="paragraph data-line-234">
<p>Dans Bitcoin, le d√©veloppement est guid√© par des principes conservateurs¬†: tous les changements sont soigneusement √©tudi√©s pour s&#39;assurer qu&#39;aucun des syst√®mes existants ne soit perturb√©. Pour la plupart, les modifications ne sont mises en ≈ìuvre que si elles sont r√©trocompatibles. Les clients existants sont autoris√©s √† s&#39;inscrire, mais continueront √† fonctionner s&#39;ils d√©cident de ne pas effectuer la mise √† niveau.</p>
</div>
<div class="paragraph data-line-236">
<p>Dans Ethereum, en comparaison, la culture de d√©veloppement de la communaut√© est ax√©e sur l&#39;avenir plut√¥t que sur le pass√©. Le mantra (pas tout √† fait s√©rieux) est &quot;avancez vite et cassez des choses&quot;. Si un changement est n√©cessaire, il est mis en ≈ìuvre, m√™me si cela signifie invalider les hypoth√®ses pr√©c√©dentes, rompre la compatibilit√© ou forcer les clients √† se mettre √† jour. La culture de d√©veloppement d&#39;Ethereum se caract√©rise par une innovation et une √©volution rapide et une volont√© de d√©ployer des am√©liorations tourn√©es vers l&#39;avenir, m√™me si cela se fait au d√©triment d&#39;une certaine r√©trocompatibilit√©.</p>
</div>
<div class="paragraph data-line-238">
<p>Cela signifie pour vous, en tant que d√©veloppeur, que vous devez rester flexible et √™tre pr√™t √† reconstruire votre infrastructure √† mesure que certaines des hypoth√®ses sous-jacentes changent. L&#39;un des grands d√©fis auxquels sont confront√©s les d√©veloppeurs d&#39;Ethereum est la contradiction inh√©rente entre le d√©ploiement de code sur un syst√®me immuable et une plate-forme de d√©veloppement en constante √©volution. Vous ne pouvez pas simplement &quot;mettre √† niveau&quot; vos contrats intelligents. Vous devez √™tre pr√™t √† en d√©ployer de nouveaux, √† migrer les utilisateurs, les applications et les fonds, et √† recommencer.</p>
</div>
<div class="paragraph data-line-240">
<p>Ironiquement, cela signifie √©galement que l&#39;objectif de construire des syst√®mes avec plus d&#39;autonomie et moins de contr√¥le centralis√© n&#39;est toujours pas pleinement atteint. L&#39;autonomie et la d√©centralisation n√©cessitent un peu plus de stabilit√© dans la plate-forme que vous n&#39;obtiendrez probablement dans Ethereum dans les prochaines ann√©es. Afin de &quot;faire √©voluer&quot; la plateforme, vous devez √™tre pr√™t √† supprimer et red√©marrer vos contrats intelligents, ce qui signifie que vous devez conserver un certain degr√© de contr√¥le sur eux.</p>
</div>
<div class="paragraph data-line-242">
<p>Mais, du c√¥t√© positif, Ethereum avance tr√®s vite. Il y a peu d&#39;opportunit√©s pour la &quot;bike-shedding&quot;, une expression qui signifie retarder le d√©veloppement en se disputant sur des d√©tails mineurs tels que la fa√ßon de construire le garage √† v√©los √† l&#39;arri√®re d&#39;une centrale nucl√©aire. Si vous commencez √† faire du v√©lo, vous d√©couvrirez peut-√™tre soudainement que pendant que vous √©tiez distrait, le reste de l&#39;√©quipe de d√©veloppement a chang√© le plan et a abandonn√© les v√©los en faveur de l&#39;a√©roglisseur autonome.</p>
</div>
<div class="paragraph data-line-244">
<p>A terme, le d√©veloppement de la plateforme Ethereum ralentira et ses interfaces deviendront fixes. Mais en attendant, l&#39;innovation est le principe moteur. Vous feriez mieux de suivre, car personne ne ralentira pour vous.</p>
</div>
</div>
<div class="sect2 data-line-247">
<h3 id="why_learn">Pourquoi apprendre Ethereum ?</h3>
<div class="paragraph data-line-249">
<p>Les cha√Ænes de blocs ont une courbe d&#39;apprentissage tr√®s abrupte, car elles combinent plusieurs disciplines en un seul domaine: programmation, s√©curit√© de l&#39;information, cryptographie, √©conomie, syst√®mes distribu√©s, r√©seaux pair √† pair, etc. Ethereum rend cette courbe d&#39;apprentissage beaucoup moins abrupte, vous pouvez donc d√©marrer rapidement. Mais juste sous la surface d&#39;un environnement d&#39;une simplicit√© trompeuse se cache bien plus. Au fur et √† mesure que vous apprenez et commencez √† chercher plus profond√©ment, il y a toujours une autre couche de complexit√© et d&#39;√©merveillement.</p>
</div>
<div class="paragraph data-line-251">
<p>Ethereum est une excellente plate-forme pour en savoir plus sur les cha√Ænes de blocs et construit une communaut√© massive de d√©veloppeurs, plus rapidement que toute autre plate-forme de cha√Æne de blocs. Plus que tout autre, Ethereum est une <em>cha√Æne de blocs de d√©veloppeurs</em>, construite par des d√©veloppeurs pour des d√©veloppeurs. Un d√©veloppeur familiaris√© avec les applications JavaScript peut se lancer dans Ethereum et commencer √† produire du code fonctionnel tr√®s rapidement. Pendant les premi√®res ann√©es de la vie d&#39;Ethereum, il √©tait courant de voir des T-shirts annon√ßant que vous pouvez cr√©er un jeton en seulement cinq lignes de code. Bien s√ªr, c&#39;est une √©p√©e √† double tranchant. Il est facile d&#39;√©crire du code, mais il est tr√®s difficile d&#39;√©crire du <em>bon</em> code <em>s√©curis√©</em>.</p>
</div>
</div>
<div class="sect2 data-line-254">
<h3 id="teaching_objectives">Ce que ce livre vous apprendra</h3>
<div class="paragraph data-line-256">
<p>Ce livre plonge dans Ethereum et examine chaque composant. Vous commencerez par une transaction simple, d√©cortiquerez son fonctionnement, √©tablirez un contrat simple, l&#39;am√©liorerez et suivrez son parcours dans le syst√®me Ethereum.</p>
</div>
<div class="paragraph data-line-5">
<p>Vous apprendrez non seulement comment utiliser Ethereum - comment cela fonctionne - mais aussi pourquoi il est con√ßu comme il est. Vous pourrez comprendre comment chacune des pi√®ces fonctionne, comment elles s&#39;embo√Ætent et pourquoi. </p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="intro_chapter">Les bases d&#39;Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p> Dans ce chapitre, nous commencerons √† explorer Ethereum, √† apprendre √† utiliser les portefeuilles, √† cr√©er des transactions, et aussi comment ex√©cuter un contrat intelligent de base.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="ether_units">L&#8217;ether comme unit√© mon√©taire</h3>
<div class="paragraph data-line-9">
<p>L&#39;unit√© mon√©taire d&#39;Ethereum est appel√©e <em>ether</em>, √©galement identifi√©e par &quot;ETH&quot; ou avec les symboles &#926; (de la lettre grecque ¬´ Xi ¬ª qui ressemble √† un E majuscule stylis√©) ou, moins souvent, &#9830;: par exemple, 1 √©ther, ou 1 ETH, ou &#926;1, ou &#9830;1.</p>
</div>
<div class="admonitionblock tip data-line-12">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-13">
<p>Utilisez le caract√®re Unicode U+039E pour &#926; et U+2666 pour &#9830;.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-16">
<p>L&#39;ether est subdivis√© en unit√©s plus petites, jusqu&#39;√† la plus petite unit√© possible, qui est nomm√©e <em>wei</em>. Un ether est √©gal √† 1 quintillion de wei (1 * 10<sup>18</sup> ou 1 000 000 000 000 000 000). Vous entendrez peut-√™tre aussi les gens se r√©f√©rer √† la devise &quot;Ethereum&quot;, mais c&#39;est une erreur courante pour les d√©butants. Ethereum est le syst√®me, ether est la monnaie.</p>
</div>
<div class="paragraph data-line-18">
<p>La valeur de l&#39;ether est toujours repr√©sent√©e en interne dans Ethereum sous la forme d&#39;une valeur enti√®re non sign√©e libell√©e en wei. Lorsque vous traitez 1 ether, la transaction encode 1000000000000000000 wei comme valeur.</p>
</div>
<div class="paragraph data-line-20">
<p>Les diff√©rentes d√©nominations d&#39;ether ont √† la fois un <em>nom scientifique</em> utilisant le Syst√®me international d&#39;unit√©s (<em>SI</em>) et un nom familier qui rend hommage √† de nombreux grands esprits de l&#39;informatique et de la cryptographie.</p>
</div>
<div class="paragraph data-line-22">
<p><a href="#ether_denominations">D√©nominations d&#8217;ether et noms d&#39;unit√©s</a> montre les diff√©rentes unit√©s, leurs noms familiers (communs) et leurs noms SI. Conform√©ment √† la repr√©sentation interne de la valeur, le tableau montre toutes les d√©nominations en wei (premi√®re ligne), avec l&#39;ether indiqu√© par 10<sup>18</sup> wei dans la 7e ligne.</p>
</div>
<table id="ether_denominations" class="tableblock frame-all grid-all stretch data-line-27">
<caption class="title">Table 1. D√©nominations d&#8217;ether et noms d&#39;unit√©s</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Valeur (en wei)</th>
<th class="tableblock halign-left valign-top">Exposant</th>
<th class="tableblock halign-left valign-top">Nom commun</th>
<th class="tableblock halign-left valign-top">Nom SI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wei</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wei</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>3</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Babbage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kilowei ou femtoether</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>6</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lovelace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M√©gawei ou picoether</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>9</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shanon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gigawei ou nanoether</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>12</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Szabo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microether ou micro</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>15</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finney</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Milliether ou milli</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>1¬†000¬†000¬†000¬†000¬†000¬†000</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>10<sup>18</sup></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Ether</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Ether</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000 000 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>21</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">grandiose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kiloether</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 000 000 000 000 000 000 000 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10<sup>24</sup></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M√©gaether</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-41">
<h3 id="choosing_eth_wallet">Choisir un portefeuille Ethereum</h3>
<div class="paragraph data-line-43">
<p>Le terme &quot;portefeuille&quot; est venu signifier beaucoup de choses, bien qu&#39;elles soient toutes li√©es et qu&#39;elles se r√©sument au quotidien √† peu pr√®s √† la m√™me chose. Nous utiliserons le terme &quot;portefeuille&quot; pour d√©signer une application logicielle qui vous aide √† g√©rer votre compte Ethereum. En bref, un portefeuille Ethereum est votre passerelle vers le syst√®me Ethereum. Il d√©tient vos cl√©s et peut cr√©er et diffuser des transactions en votre nom. Choisir un portefeuille Ethereum peut √™tre difficile car il existe de nombreuses options diff√©rentes avec des caract√©ristiques et des conceptions diff√©rentes. Certains sont plus adapt√©s aux d√©butants et certains sont plus adapt√©s aux experts. La plate-forme Ethereum elle-m√™me est toujours en cours d&#39;am√©lioration, et les &quot;meilleurs&quot; portefeuilles sont souvent ceux qui s&#39;adaptent aux changements qui accompagnent les mises √† niveau de la plate-forme.</p>
</div>
<div class="paragraph data-line-45">
<p>Mais ne vous inqui√©tez pas ! Si vous choisissez un portefeuille et que vous n&#39;aimez pas son fonctionnement, ou si vous l&#39;aimez au d√©but, mais que vous souhaitez ensuite essayer autre chose, vous pouvez changer de portefeuille assez facilement. Tout ce que vous avez √† faire est d&#39;effectuer une transaction qui envoie vos fonds de l&#39;ancien portefeuille vers le nouveau portefeuille, ou d&#39;exporter vos cl√©s priv√©es et de les importer dans le nouveau.</p>
</div>
<div class="paragraph data-line-47">
<p>Nous avons s√©lectionn√© trois types de portefeuilles diff√©rents √† utiliser comme exemples tout au long du livre¬†: un portefeuille mobile, un portefeuille de bureau et un portefeuille Web. Nous avons choisi ces trois portefeuilles car ils repr√©sentent un large √©ventail de complexit√© et de fonctionnalit√©s. Cependant, la s√©lection de ces portefeuilles n&#39;est pas une approbation de leur qualit√© ou de leur s√©curit√©. Ils sont simplement un bon point de d√©part pour des d√©monstrations et des tests.</p>
</div>
<div class="paragraph data-line-49">
<p>N&#39;oubliez pas que pour qu&#39;une application de portefeuille fonctionne, elle doit avoir acc√®s √† vos cl√©s priv√©es, il est donc essentiel que vous ne t√©l√©chargiez et n&#39;utilisiez que des applications de portefeuille provenant de sources de confiance. Heureusement, en g√©n√©ral, plus une application de portefeuille est populaire, plus elle est susceptible d&#39;√™tre fiable. N√©anmoins, il est recommand√© d&#39;√©viter de &quot;mettre tous vos ≈ìufs dans le m√™me panier&quot; et de r√©partir vos comptes Ethereum sur plusieurs portefeuilles.</p>
</div>
<div class="paragraph data-line-51">
<p>Voici quelques bons portefeuilles de d√©marrage¬†:</p>
</div>
<div class="dlist data-line-53">
<dl>
<dt class="hdlist1">MetaMask</dt>
<dd>
<p>MetaMask est un portefeuille d&#39;extension de navigateur qui s&#39;ex√©cute dans votre navigateur (Chrome, Firefox, Opera ou Brave Browser). Il est facile √† utiliser et pratique pour les tests, car il est capable de se connecter √† une vari√©t√© de n≈ìuds Ethereum et de tester des cha√Ænes de blocs. MetaMask est un portefeuille bas√© sur le Web.</p>
</dd>
<dt class="hdlist1">Jaxx</dt>
<dd>
<p>Jaxx est un portefeuille multiplateforme et multidevise qui fonctionne sur une vari√©t√© de syst√®mes d&#39;exploitation, y compris Android, iOS, Windows, macOS, et Linux. C&#39;est souvent un bon choix pour les nouveaux utilisateurs car il est con√ßu pour la simplicit√© et la facilit√© d&#39;utilisation. Jaxx est soit un portefeuille mobile, soit un portefeuille de bureau, selon l&#39;endroit o√π vous l&#39;installez.</p>
</dd>
<dt class="hdlist1">MyEtherWallet (MEW)</dt>
<dd>
<p>(&quot;portefeuilles&quot;,&quot;Emerald Wallet&quot; )MyEtherWallet est un portefeuille Web qui s&#39;ex√©cute dans n&#39;importe quel navigateur. Il poss√®de de multiples fonctionnalit√©s sophistiqu√©es que nous explorerons dans plusieurs de nos exemples. MyEtherWallet est un portefeuille bas√© sur le Web.</p>
</dd>
<dt class="hdlist1">Emerald Wallet</dt>
<dd>
<p>Emerald Wallet est con√ßu pour fonctionner avec la blockchain Ethereum Classic, mais est compatible avec d&#39;autres blockchains bas√©es sur Ethereum. C&#39;est une application de bureau √† source libre et fonctionne sous Windows, macOS et Linux. Emerald Wallet peut ex√©cuter un n≈ìud complet ou se connecter √† un n≈ìud distant public, fonctionnant en mode &quot;l√©ger&quot;. Il dispose √©galement d&#39;un outil compagnon pour effectuer toutes les op√©rations √† partir de la ligne de commande.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-61">
<p>Nous commencerons par installer MetaMask sur un bureau, mais nous aborderons d&#39;abord bri√®vement le contr√¥le et la gestion des cl√©s.</p>
</div>
</div>
<div class="sect2 data-line-64">
<h3 id="control_responsibility">Contr√¥le et responsabilit√©</h3>
<div class="paragraph data-line-66">
<p>Les cha√Ænes de blocs ouvertes comme Ethereum sont importantes car elles fonctionnent comme un syst√®me <em>d√©centralis√©</em>. Cela signifie beaucoup de choses, mais un aspect crucial est que chaque utilisateur d&#39;Ethereum peut et doit contr√¥ler ses propres cl√©s priv√©es, qui contr√¥lent l&#39;acc√®s aux fonds et aux contrats intelligents. Nous appelons parfois la combinaison de l&#39;acc√®s aux fonds et des contrats intelligents un &quot;compte&quot; ou un &quot;portefeuille&quot;. Ces termes peuvent devenir assez complexes dans leur fonctionnalit√©, nous y reviendrons donc plus en d√©tail plus tard. En tant que principe fondamental, cependant, c&#39;est aussi simple qu&#39;une cl√© priv√©e √©quivaut √† un &quot;compte&quot;. Certains utilisateurs choisissent de renoncer au contr√¥le de leurs cl√©s priv√©es en utilisant un d√©positaire tiers, tel qu&#39;un √©change en ligne. Dans ce livre, nous vous apprendrons √† prendre le contr√¥le et √† g√©rer vos propres cl√©s priv√©es.</p>
</div>
<div class="paragraph data-line-68">
<p>Avec le contr√¥le vient une grande responsabilit√©. Si vous perdez vos cl√©s priv√©es, vous perdez l&#39;acc√®s √† vos fonds et contrats. Personne ne peut vous aider √† retrouver l&#39;acc√®s - vos fonds seront verrouill√©s pour toujours. Voici quelques conseils pour vous aider √† g√©rer cette responsabilit√© :</p>
</div>
<div class="ulist data-line-70">
<ul>
<li class="data-line-70">
<p>N&#39;improvisez pas la s√©curit√©. Utilisez des approches standardis√©es.</p>
</li>
<li class="data-line-72">
<p>Plus le compte est important (par exemple, plus la valeur des fonds contr√¥l√©s est √©lev√©e, ou plus les contrats intelligents accessibles sont importants), plus les mesures de s√©curit√© doivent √™tre prises.</p>
</li>
<li class="data-line-74">
<p>La s√©curit√© la plus √©lev√©e est obtenue √† partir d&#39;un appareil isol√©, mais ce niveau n&#39;est pas requis pour tous les comptes.</p>
</li>
<li class="data-line-76">
<p>Ne stockez jamais votre cl√© priv√©e en clair, en particulier sous forme num√©rique. Heureusement, la plupart des interfaces utilisateur actuelles ne vous permettent m√™me pas de voir la cl√© priv√©e brute.</p>
</li>
<li class="data-line-78">
<p>Les cl√©s priv√©es peuvent √™tre stock√©es sous forme crypt√©e, en tant que fichier &quot;keystore&quot; num√©rique. √âtant crypt√©s, ils ont besoin d&#39;un mot de passe pour se d√©verrouiller. Lorsque vous √™tes invit√© √† choisir un mot de passe, rendez-le fort (c&#39;est-√†-dire long et al√©atoire), sauvegardez-le et ne le partagez pas. Si vous n&#39;avez pas de gestionnaire de mots de passe, √©crivez-le et conservez-le dans un endroit s√ªr et secret. Pour acc√©der √† votre compte, vous avez besoin √† la fois du fichier keystore et du mot de passe.</p>
</li>
<li class="data-line-80">
<p>Ne stockez aucun mot de passe dans des documents num√©riques, des photos num√©riques, des captures d&#39;√©cran, des lecteurs en ligne, des PDF crypt√©s, etc. Encore une fois, n&#39;improvisez pas la s√©curit√©. Utilisez un gestionnaire de mots de passe ou un stylo et du papier.</p>
</li>
<li class="data-line-82">
<p>Lorsque vous √™tes invit√© √† sauvegarder une cl√© sous forme de s√©quence de mots mn√©moniques, utilisez un stylo et du papier pour effectuer une sauvegarde physique. Ne laissez pas cette t√¢che &quot;pour plus tard&quot;¬†; vous oublierez. Ces sauvegardes peuvent √™tre utilis√©es pour reconstruire votre cl√© priv√©e au cas o√π vous perdriez toutes les donn√©es enregistr√©es sur votre syst√®me, ou si vous oubliez ou perdez votre mot de passe. Cependant, ils peuvent √©galement √™tre utilis√©s par des attaquants pour obtenir vos cl√©s priv√©es. Ne les stockez donc jamais sous forme num√©rique et conservez la copie physique en toute s√©curit√© dans un tiroir ou un coffre-fort verrouill√©.</p>
</li>
<li class="data-line-84">
<p>Avant de transf√©rer des montants importants (en particulier vers de nouvelles adresses), effectuez d&#39;abord une petite transaction test (par exemple, une valeur inf√©rieure √† 1 $) et attendez la confirmation de r√©ception.</p>
</li>
<li class="data-line-86">
<p>Lorsque vous cr√©ez un nouveau compte, commencez par n&#39;envoyer qu&#39;une petite transaction test √† la nouvelle adresse. Une fois que vous avez re√ßu la transaction de test, essayez de renvoyer √† partir de ce compte. Il existe de nombreuses raisons pour lesquelles la cr√©ation d&#39;un compte peut mal tourner, et si cela a mal tourn√©, il vaut mieux le d√©couvrir avec une petite perte. Si les tests fonctionnent, tout va bien.</p>
</li>
<li class="data-line-88">
<p>Les explorateurs de blocs publics sont un moyen simple de voir ind√©pendamment si une transaction a √©t√© accept√©e par le r√©seau. Cependant, cette commodit√© a un impact n√©gatif sur votre vie priv√©e, car vous r√©v√©lez vos adresses pour bloquer les explorateurs, qui peuvent vous suivre.</p>
</li>
<li class="data-line-90">
<p>N&#39;envoyez pas d&#39;argent √† l&#39;une des adresses indiqu√©es dans ce livre. Les cl√©s priv√©es sont r√©pertori√©es dans le livre et quelqu&#39;un prendra imm√©diatement cet argent.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-92">
<p>Maintenant que nous avons couvert quelques bonnes pratiques de base pour la gestion des cl√©s et la s√©curit√©, passons au travail avec MetaMask¬†!</p>
</div>
</div>
<div class="sect2 data-line-95">
<h3 id="installing_MetaMask">Premiers pas avec MetaMask</h3>
<div class="paragraph data-line-97">
<p>Ouvrez le navigateur Google Chrome et acc√©dez √† <a href="https://chrome.google.com/webstore/category/extensions" class="undefined" data-href="https://chrome.google.com/webstore/category/extensions">https://chrome.google.com/webstore/category/extensions</a>.</p>
</div>
<div class="paragraph data-line-99">
<p>Recherchez &quot;MetaMask&quot; et cliquez sur le logo d&#39;un renard. Vous devriez voir quelque chose comme le r√©sultat affich√© dans <a href="#metamask_download">La page de d√©tail de l&#39;extension MetaMask Chrome</a>.</p>
</div>
<div id="metamask_download" class="imageblock data-line-103">
<div class="content">
<img src="images/metamask_download.png" alt="&quot;Page de d√©tails du m√©tamasque&quot;">
</div>
<div class="title">Figure 1. La page de d√©tail de l&#39;extension MetaMask Chrome</div>
</div>
<div class="paragraph data-line-105">
<p>Il est important de v√©rifier que vous t√©l√©chargez la v√©ritable extension MetaMask, car parfois les gens sont capables de passer furtivement des extensions malveillantes au-del√† des filtres de Google. Le vrai:</p>
</div>
<div class="ulist data-line-107">
<ul>
<li class="data-line-107">
<p>Affiche l&#39;ID nkbihfbeogaeaoehlefnkodbefgpgknn dans la barre d&#39;adresse</p>
</li>
<li class="data-line-108">
<p>Est offert par <a href="https://metamask.io" class="undefined" data-href="https://metamask.io">https://metamask.io</a></p>
</li>
<li class="data-line-109">
<p>A plus de 1 500 avis</p>
</li>
<li class="data-line-110">
<p>A plus de 1 000 000 d&#39;utilisateurs</p>
</li>
</ul>
</div>
<div class="paragraph data-line-112">
<p>Une fois que vous avez confirm√© que vous recherchez la bonne extension, cliquez sur &quot;Ajouter √† Chrome&quot; pour l&#39;installer.</p>
</div>
<div class="sect3 data-line-115">
<h4 id="using_MetaMask">Cr√©ation d&#39;un portefeuille</h4>
<div class="paragraph data-line-117">
<p>Une fois MetaMask install√©, vous devriez voir une nouvelle ic√¥ne (la t√™te d&#39;un renard) dans la barre d&#39;outils de votre navigateur. Cliquez dessus pour commencer. Il vous sera demand√© d&#39;accepter les termes et conditions puis de cr√©er votre nouveau portefeuille Ethereum en saisissant un mot de passe (voir <a href="#metamask_password">La page de mot de passe de l&#39;extension MetaMask Chrome</a>).</p>
</div>
<div id="metamask_password" class="imageblock data-line-121">
<div class="content">
<img src="images/metamask_password.png" alt="&quot;Page de mot de passe du m√©tamasque&quot;">
</div>
<div class="title">Figure 2. La page de mot de passe de l&#39;extension MetaMask Chrome</div>
</div>
<div class="admonitionblock tip data-line-124">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-125">
<p>Le mot de passe contr√¥le l&#39;acc√®s √† MetaMask, de sorte qu&#39;il ne peut √™tre utilis√© par personne ayant acc√®s √† votre navigateur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-128">
<p>Une fois que vous avez d√©fini un mot de passe, MetaMask g√©n√©rera un portefeuille pour vous et vous montrera un <em>mn√©monique de sauvegarde</em> compos√© de 12 mots anglais (voir <a href="#metamask_mnemonic">La sauvegarde mn√©monique de votre portefeuille, cr√©√©e par MetaMask</a>). Ces mots peuvent √™tre utilis√©s dans n&#39;importe quel portefeuille compatible pour r√©cup√©rer l&#39;acc√®s √† vos fonds si quelque chose arrivait √† MetaMask ou √† votre ordinateur. Vous n&#39;avez pas besoin du mot de passe pour cette r√©cup√©ration ; les 12 mots suffisent.</p>
</div>
<div class="admonitionblock tip data-line-131">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-132">
<p>Sauvegardez votre mn√©monique (12 mots) sur papier, deux fois. Conservez les deux sauvegardes papier dans deux emplacements s√©curis√©s distincts, tels qu&#39;un coffre-fort r√©sistant au feu, un tiroir verrouill√© ou un coffre-fort. Traitez les sauvegardes papier comme de l&#39;argent de valeur √©quivalente √† ce que vous stockez dans votre portefeuille Ethereum. Toute personne ayant acc√®s √† ces mots peut y acc√©der et voler votre argent.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="metamask_mnemonic" class="imageblock data-line-137">
<div class="content">
<img src="images/metamask_mnemonic.png" alt="&quot;Page Mn√©monique MetaMask&quot;">
</div>
<div class="title">Figure 3. La sauvegarde mn√©monique de votre portefeuille, cr√©√©e par MetaMask</div>
</div>
<div class="paragraph data-line-139">
<p>Une fois que vous avez confirm√© que vous avez stock√© le mn√©monique en toute s√©curit√©, vous pourrez voir les d√©tails de votre compte Ethereum, comme indiqu√© dans <a href="#metamask_account">Votre compte Ethereum dans MetaMask</a>.</p>
</div>
<div id="metamask_account" class="imageblock data-line-143">
<div class="content">
<img src="images/metamask_account.png" alt="&quot;Page de compte MetaMask&quot;">
</div>
<div class="title">Figure 4. Votre compte Ethereum dans MetaMask</div>
</div>
<div class="paragraph data-line-145">
<p>La page de votre compte affiche le nom de votre compte (&quot;Account 1&quot; par d√©faut), une adresse Ethereum (0x9E713... dans l&#39;exemple), et une ic√¥ne color√©e pour vous aider √† distinguer visuellement ce compte des autres comptes. En haut de la page du compte, vous pouvez voir sur quel r√©seau Ethereum vous travaillez actuellement (&quot;Main Network&quot; dans l&#39;exemple).</p>
</div>
<div class="paragraph data-line-147">
<p>Toutes nos f√©licitations! Vous avez configur√© votre premier portefeuille Ethereum.</p>
</div>
</div>
<div class="sect3 data-line-150">
<h4 id="switching_networks">Changer le r√©seau</h4>
<div class="paragraph data-line-152">
<p>Comme vous pouvez le voir sur la page du compte MetaMask, vous pouvez choisir entre plusieurs r√©seaux Ethereum. Par d√©faut, MetaMask essaiera de se connecter au r√©seau principal. Les autres choix sont des r√©seaux de test publics, tout n≈ìud Ethereum de votre choix ou des n≈ìuds ex√©cutant des cha√Ænes de blocs priv√©es sur votre propre ordinateur (localhost)¬†:</p>
</div>
<div class="dlist data-line-154">
<dl>
<dt class="hdlist1">R√©seau principal Ethereum</dt>
<dd>
<p>La principale cha√Æne de blocs publique Ethereum. V√©ritable ETH, valeur r√©elle et cons√©quences r√©elles.</p>
</dd>
<dt class="hdlist1">R√©seau de test Ropsten</dt>
<dd>
<p>Cha√Æne de blocs et r√©seau de test public Ethereum. l&#8217;ETH sur ce r√©seau n&#39;a aucune valeur.</p>
</dd>
<dt class="hdlist1">R√©seau de test Kovan</dt>
<dd>
<p>Cha√Æne de blocs et r√©seau de test public Ethereum utilisant le protocole de consensus Aura avec preuve d&#39;autorit√© (signature f√©d√©r√©e). ETH sur ce r√©seau n&#39;a aucune valeur. Le r√©seau de test Kovan est uniquement pris en charge par Parity. D&#39;autres clients Ethereum utilisent le protocole de consensus Clique, qui a √©t√© propos√© plus tard, pour la preuve de la v√©rification bas√©e sur l&#39;autorit√©.</p>
</dd>
<dt class="hdlist1">R√©seau de test Rinkeby</dt>
<dd>
<p>Cha√Æne de blocs et r√©seau de test public Ethereum, utilisant le protocole de consensus Clique avec preuve d&#39;autorit√© (signature f√©d√©r√©e). ETH sur ce r√©seau n&#39;a aucune valeur.</p>
</dd>
<dt class="hdlist1">Localhost 8545</dt>
<dd>
<p>Se connecte √† un n≈ìud ex√©cut√© sur le m√™me ordinateur que le navigateur. Le n≈ìud peut faire partie de n&#39;importe quelle cha√Æne de blocs publique (principale ou testnet) ou d&#39;un testnet priv√©.</p>
</dd>
<dt class="hdlist1">RPC personnalis√©</dt>
<dd>
<p>vous permet de connecter MetaMask √† n&#39;importe quel n≈ìud avec une interface d&#39;appel de proc√©dure distante (RPC) compatible Geth. Le n≈ìud peut faire partie de n&#39;importe quelle cha√Æne de blocs publique ou priv√©e.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note data-line-167">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-168">
<p>Votre portefeuille MetaMask utilise la m√™me cl√© priv√©e et la m√™me adresse Ethereum sur tous les r√©seaux auxquels il se connecte. Cependant, votre solde d&#39;adresses Ethereum sur chaque r√©seau Ethereum sera diff√©rent. Vos cl√©s peuvent contr√¥ler l&#39;√©ther et les contrats sur Ropsten, par exemple, mais pas sur le r√©seau principal.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-172">
<h4 id="getting_test_eth">Obtenir de l&#39;ether de test</h4>
<div class="paragraph data-line-174">
<p>Votre premi√®re t√¢che est de financer votre portefeuille. Vous ne ferez pas cela sur le r√©seau principal car l&#39;√©ther r√©el co√ªte de l&#39;argent et sa manipulation n√©cessite un peu plus d&#39;exp√©rience. Pour l&#39;instant, vous allez charger votre portefeuille avec de l&#39;ether testnet.</p>
</div>
<div class="paragraph data-line-176">
<p>Passez MetaMask au <em>R√©seau test Ropsten</em>. Cliquez sur Deposit, puis sur Ropsten Test Faucet. MetaMask ouvrira une nouvelle page Web, comme indiqu√© dans <a href="#metamask_ropsten_faucet">MetaMask et le robinet du r√©seau test Ropsten</a>.</p>
</div>
<div id="metamask_ropsten_faucet" class="imageblock data-line-180">
<div class="content">
<img src="images/metamask_ropsten_faucet.png" alt="&quot;MetaMask et le robinet du r√©seau test Ropsten&quot;">
</div>
<div class="title">Figure 5. MetaMask et le robinet du r√©seau test Ropsten</div>
</div>
<div class="paragraph data-line-182">
<p>Vous remarquerez peut-√™tre que la page Web contient d√©j√† l&#39;adresse Ethereum de votre portefeuille MetaMask. MetaMask int√®gre les pages Web compatibles Ethereum avec votre portefeuille MetaMask et peut &quot;voir&quot; les adresses Ethereum sur la page Web, vous permettant, par exemple, d&#39;envoyer un paiement √† une boutique en ligne affichant une adresse Ethereum. MetaMask peut √©galement remplir la page Web avec l&#39;adresse de votre propre portefeuille en tant qu&#39;adresse de destinataire si la page Web le demande. Sur cette page, l&#39;application du robinet demande √† MetaMask une adresse de portefeuille √† laquelle envoyer de l&#39;ether de test.</p>
</div>
<div class="paragraph data-line-184">
<p>Cliquez sur le bouton vert &quot;demander 1 √©ther au robinet&quot;. Vous verrez un ID de transaction appara√Ætre dans la partie inf√©rieure de la page. L&#39;application robinet ou "faucet" a cr√©√© une transaction, un paiement qui vous est destin√©. L&#39;ID de transaction ressemble √† ceci¬†:</p>
</div>
<div id="faucet_tx_id" class="listingblock data-line-187">
<div class="content">
<pre>0x7c7ad5aaea6474adccf6f5c5d6abed11b70a350fbc6f9590109e099568090c57</pre>
</div>
</div>
<div class="paragraph data-line-191">
<p>Dans quelques secondes, la nouvelle transaction sera exploit√©e par les mineurs de Ropsten et votre portefeuille MetaMask affichera un solde de 1 ETH. Cliquez sur l&#39;ID de transaction et votre navigateur vous am√®nera √† un <em>explorateur de bloc</em>, qui est un site Web qui vous permet de visualiser et d&#39;explorer des blocs, des adresses et des transactions. MetaMask utilise <a href="https://etherscan.io/" data-href="https://etherscan.io/">Explorateur de blocs Etherscan</a>, l&#39;un des explorateurs de blocs Ethereum les plus populaires. La transaction contenant le paiement du Ropsten Test Faucet est affich√©e dans <a href="#ropsten_block_explorer">Explorateur de blocs Ropsten sur Etherscan</a>.</p>
</div>
<div id="ropsten_block_explorer" class="imageblock data-line-195">
<div class="content">
<img src="images/ropsten_block_explorer.png" alt="&quot;Explorateur de blocs Ropsten sur Etherscan&quot;">
</div>
<div class="title">Figure 6. Explorateur de blocs Ropsten sur Etherscan</div>
</div>
<div class="paragraph data-line-197">
<p>La transaction a √©t√© enregistr√©e sur la cha√Æne de blocs Ropsten et peut √™tre consult√©e √† tout moment par n&#39;importe qui, simplement en recherchant l&#39;ID de transaction, ou <a href="http://bit.ly/2Q860Wk" data-href="http://bit.ly/2Q860Wk">en visitant le lien</a>.</p>
</div>
<div class="paragraph data-line-199">
<p>Essayez de visiter ce lien ou de saisir le hachage de la transaction sur le site Web <em>ropsten.etherscan.io</em> pour le voir par vous-m√™me.</p>
</div>
</div>
<div class="sect3 data-line-202">
<h4 id="sending_eth_MetaMask">Envoi d&#39;ether depuis MetaMask</h4>
<div class="paragraph data-line-204">
<p>Une fois que vous avez re√ßu votre premier test d&#39;ether du Ropsten Test Faucet, vous pouvez exp√©rimenter l&#39;envoi d&#39;ether en essayant d&#39;en renvoyer au robinet. Comme vous pouvez le voir sur la page Ropsten Test Faucet, il existe une option pour &quot;donner&quot; 1 ETH au robinet. Cette option est disponible pour qu&#39;une fois que vous avez termin√© les tests, vous puissiez retourner le reste de votre ether de test, afin que quelqu&#39;un d&#39;autre puisse l&#39;utiliser ensuite. M√™me si l&#39;ether de test n&#39;a aucune valeur, certaines personnes l&#8217;accumulent, ce qui rend difficile pour tout le monde d&#39;utiliser les r√©seaux de test. L&#8217;accumulation de l&#39;ether de test est mal vue !</p>
</div>
<div class="paragraph data-line-206">
<p>Heureusement, nous ne sommes pas des accumulateurs d&#39;√©ther de test. Cliquez sur le bouton orange &quot;1 ether&quot; pour dire √† MetaMask de cr√©er une transaction payant le robinet 1 ether. MetaMask pr√©parera une transaction et ouvrira une fen√™tre avec la confirmation, comme indiqu√© dans <a href="#send_to_faucet">Envoi de 1 √©ther au robinet</a>.</p>
</div>
<div id="send_to_faucet" class="imageblock data-line-211">
<div class="content">
<img src="images/send_to_faucet.png" alt="&quot;Envoi d&#39;1 ether au robinet&quot;">
</div>
<div class="title">Figure 7. Envoi de 1 √©ther au robinet</div>
</div>
<div class="paragraph data-line-213">
<p>Oups! Vous avez probablement remarqu√© que vous ne pouvez pas terminer la transaction - MetaMask indique que vous avez un solde insuffisant. √Ä premi√®re vue, cela peut sembler d√©routant : vous avez 1 ETH, vous voulez envoyer 1 ETH, alors pourquoi MetaMask dit-il que vous avez des fonds insuffisants ?</p>
</div>
<div class="paragraph data-line-215">
<p>La r√©ponse est √† cause du co√ªt de <em>gaz</em>. Chaque transaction Ethereum n√©cessite le paiement d&#39;une redevance, qui est per√ßue par les mineurs pour valider la transaction. Les frais d&#39;Ethereum sont factur√©s dans une monnaie virtuelle appel√©e gaz. Vous payez le gaz avec de l&#39;ether, dans le cadre de la transaction.</p>
</div>
<div class="admonitionblock note data-line-218">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-219">
<p>Des frais sont √©galement exig√©s sur les r√©seaux de test. Sans frais, un r√©seau de test se comporterait diff√©remment du r√©seau principal, ce qui en ferait une plate-forme de test inad√©quate. Les frais prot√®gent √©galement les r√©seaux de test des attaques DoS et des contrats mal construits (par exemple, des boucles infinies), tout comme ils prot√®gent le r√©seau principal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-222">
<p>Lorsque vous avez envoy√© la transaction, MetaMask a calcul√© le prix moyen du gaz des r√©centes transactions r√©ussies √† 3 gwei, ce qui signifie gigawei. Wei est la plus petite <span class="keep-together">subdivision</span> de la monnaie ether, comme nous l&#39;avons vu dans <a href="#ether_units">L&#8217;ether comme unit√© mon√©taire</a>. La limite de gaz est fix√©e au prix de l&#39;envoi d&#39;une transaction de base, soit 21 000 unit√©s de gaz. Par cons√©quent, le montant maximum d&#39;ETH que vous d√©penserez est de 3 * 21 000 gwei = 63 000 gwei = 0,000063 ETH. (Sachez que les prix moyens du gaz peuvent fluctuer, car ils sont principalement d√©termin√©s par les mineurs. Nous verrons dans un chapitre ult√©rieur comment vous pouvez augmenter/diminuer votre limite de gaz pour vous assurer que votre transaction a la priorit√© si n√©cessaire.)</p>
</div>
<div class="paragraph data-line-224">
<p>Tout cela pour dire : faire une transaction √† 1 ETH co√ªte 1,000063 ETH. MetaMask arrondit de mani√®re confuse au <em>plancher</em> d'1 ETH lors de l&#39;affichage du total, mais le montant r√©el dont vous avez besoin est de 1,000063 ETH et vous n&#39;avez que 1 ETH. Cliquez sur Reject pour annuler cette transaction.</p>
</div>
<div class="paragraph data-line-226">
<p>Prenons un peu plus d&#39;ether de test¬†! Cliquez √† nouveau sur le bouton vert &quot;request 1 ether from the faucet&quot; et attendez quelques secondes. Ne vous inqui√©tez pas, le robinet devrait avoir beaucoup d&#39;ether et vous en donnera plus si vous le demandez.</p>
</div>
<div class="paragraph data-line-228">
<p>Une fois que vous avez un solde de 2 ETH, vous pouvez r√©essayer. Cette fois, lorsque vous cliquez sur le bouton de don orange &quot;1 ether&quot;, vous disposez d&#39;un solde suffisant pour finaliser la transaction. Cliquez sur Soumettre lorsque MetaMask appara√Æt dans la fen√™tre de paiement. Apr√®s tout cela, vous devriez voir un solde de 0,999937 ETH car vous avez envoy√© 1 ETH au robinet avec 0,000063 ETH en gaz.</p>
</div>
</div>
<div class="sect3 data-line-231">
<h4 id="explore_tx_history">Explorer l&#39;historique des transactions d&#39;une adresse</h4>
<div class="paragraph data-line-233">
<p>Vous √™tes maintenant devenu un expert dans l&#39;utilisation de MetaMask pour envoyer et recevoir de l&#39;ether de test. Votre portefeuille a re√ßu au moins deux paiements et en a envoy√© au moins un. Vous pouvez afficher toutes ces transactions √† l&#39;aide de l&#39;explorateur de blocs <em>ropsten.etherscan.io</em>. Vous pouvez soit copier l&#39;adresse de votre portefeuille et la coller dans la zone de recherche de l&#39;explorateur de blocs, soit demander √† MetaMask d&#39;ouvrir la page pour vous. √Ä c√¥t√© de l&#39;ic√¥ne de votre compte dans MetaMask, vous verrez un bouton affichant trois points. Cliquez dessus pour afficher un menu d&#39;options li√©es au compte (voir <a href="#metamask_account_context_menu">Menu contextuel du compte MetaMask</a>).</p>
</div>
<div id="metamask_account_context_menu" class="imageblock data-line-237">
<div class="content">
<img src="images/metamask_account_context_menu.png" alt="&quot;Menu contextuel du compte MetaMask&quot;">
</div>
<div class="title">Figure 8. Menu contextuel du compte MetaMask</div>
</div>
<div class="paragraph data-line-239">
<p>S√©lectionnez &quot;View account on Etherscan&quot; pour ouvrir une page Web dans l&#39;explorateur de blocs affichant l&#39;historique des transactions de votre compte, comme indiqu√© dans <a href="#block_explorer_account_history">Historique des transactions d&#8217;une adresse sur Etherscan</a>.</p>
</div>
<div id="block_explorer_account_history" class="imageblock data-line-243">
<div class="content">
<img src="images/block_explorer_account_history.png" alt="&quot;Historique des transactions d&#39;adresses sur Etherscan&quot;">
</div>
<div class="title">Figure 9. Historique des transactions d&#8217;une adresse sur Etherscan</div>
</div>
<div class="paragraph data-line-245">
<p>Ici, vous pouvez voir l&#39;historique complet des transactions de votre adresse Ethereum. Il montre toutes les transactions enregistr√©es sur la cha√Æne de blocs Ropsten o√π votre adresse est l&#39;exp√©diteur ou le destinataire. Cliquez sur quelques-unes de ces transactions pour voir plus de d√©tails.</p>
</div>
<div class="paragraph data-line-247">
<p>Vous pouvez explorer l&#39;historique des transactions de n&#39;importe quelle adresse. Jetez un ≈ìil √† l&#39;historique des transactions de l&#39;adresse Ropsten Test Faucet (indice : il s&#39;agit de l&#39;adresse ¬´ exp√©diteur ¬ª r√©pertori√©e dans le plus ancien paiement √† votre adresse). Vous pouvez voir tout l&#39;ether de test envoy√© par le robinet √† vous et √† d&#39;autres adresses. Chaque transaction que vous voyez peut vous mener √† plus d&#39;adresses et plus de transactions. D&#39;ici peu, vous serez perdu dans le labyrinthe de donn√©es interconnect√©es. Les cha√Ænes de blocs publiques contiennent une √©norme richesse d&#39;informations, qui peuvent toutes √™tre explor√©es par programmation, comme nous le verrons dans de futurs exemples.</p>
</div>
</div>
</div>
<div class="sect2 data-line-250">
<h3 id="intro_world_computer">Pr√©sentation de l&#39;ordinateur mondial</h3>
<div class="paragraph data-line-252">
<p> Vous avez maintenant cr√©√© un portefeuille et envoy√© et re√ßu de l&#39;ether. Jusqu&#39;√† pr√©sent, nous avons trait√© Ethereum comme une cryptomonnaie. Mais Ethereum est bien plus que cela. En fait, la fonction de cryptomonnaie est subordonn√©e √† la fonction d&#39;Ethereum en tant qu&#39;ordinateur mondial d√©centralis√©. L&#8217;ether est destin√© √† √™tre utilis√© pour payer l&#39;ex√©cution de <em>contrats intelligents</em> aussi, qui sont des programmes informatiques qui s&#39;ex√©cutent sur un ordinateur √©mul√© appel√© <em>Ethereum Virtual Machine</em> (EVM).</p>
</div>
<div class="paragraph data-line-254">
<p>L&#39;EVM est un singleton global, ce qui signifie qu&#39;il fonctionne comme s&#39;il s&#39;agissait d&#39;un ordinateur global √† instance unique, fonctionnant partout. Chaque n≈ìud du r√©seau Ethereum ex√©cute une copie locale de l&#39;EVM pour valider l&#39;ex√©cution du contrat, tandis que la blockchain Ethereum enregistre l&#39;√©tat changeant de cet ordinateur mondial lorsqu&#39;il traite les transactions et les contrats intelligents. Nous en discuterons plus en d√©tail dans <a href="#evm_chapter">La machine virtuelle Ethereum</a>.</p>
</div>
</div>
<div class="sect2 data-line-257">
<h3 id="EOA_contracts">Comptes d√©tenus en externe (EOA ou Externally Owned Accounts) et contrats</h3>
<div class="paragraph data-line-259">
<p>Le type de compte que vous avez cr√©√© dans le portefeuille MetaMask est appel√© un <em>compte d√©tenu par une personne externe</em> (EOA ou Externally Owned Accounts). Les comptes d√©tenus en externe sont ceux qui ont une cl√© priv√©e¬†; avoir la cl√© priv√©e signifie contr√¥ler l&#39;acc√®s aux fonds ou aux contrats. Maintenant, vous devinez probablement qu&#39;il existe un autre type de compte. Cet autre type de compte est un <em>compte de contrat</em>. Un compte de contrat a un code de contrat intelligent, ce qu&#39;un simple EOA ne peut pas avoir. De plus, un compte contractuel ne poss√®de pas de cl√© priv√©e. Au lieu de cela, il est d√©tenu (et contr√¥l√©) par la logique de son code de contrat intelligent : le programme logiciel enregistr√© sur la blockchain Ethereum lors de la cr√©ation du compte de contrat et ex√©cut√© par l&#39;EVM.</p>
</div>
<div class="paragraph data-line-261">
<p>Les contrats ont des adresses, tout comme les EOA. Les contrats peuvent √©galement envoyer et recevoir de l&#39;ether, tout comme les EOA. Cependant, lorsqu&#39;une destination de transaction est une adresse de contrat, cela provoque l&#39;ex√©cution de ce contrat dans l&#39;EVM, en utilisant la transaction et les donn√©es de la transaction comme entr√©e. En plus d&#39;ether, les transactions peuvent contenir des <em>donn√©es</em> indiquant quelle fonction sp√©cifique du contrat ex√©cuter et quels param√®tres transmettre √† cette fonction. De cette fa√ßon, les transactions peuvent <em>appeler</em> des fonctions dans les contrats.</p>
</div>
<div class="paragraph data-line-263">
<p>Notez qu&#39;√©tant donn√© qu&#39;un compte de contrat n&#39;a pas de cl√© priv√©e, il ne peut pas <em>initier</em> une transaction. Seuls les EOA peuvent initier des transactions, mais les contrats peuvent <em>r√©agir</em> aux transactions en appelant d&#39;autres contrats, en cr√©ant des chemins d&#39;ex√©cution complexes. Une utilisation typique de ceci est un EOA envoyant une transaction de demande √† un portefeuille de contrats intelligents multisignatures pour envoyer des ETH √† une autre adresse. Un mod√®le de programmation DApp typique consiste √† ce que le contrat A appelle le contrat B afin de maintenir un √©tat partag√© entre les utilisateurs du contrat A.</p>
</div>
<div class="paragraph data-line-265">
<p>Dans les prochaines sections, nous r√©digerons notre premier contrat. Vous apprendrez ensuite comment cr√©er, financer et utiliser ce contrat avec votre portefeuille MetaMask et tester l&#39;√©ther sur le r√©seau de test Ropsten.</p>
</div>
</div>
<div class="sect2 data-line-268">
<h3 id="exemple_contrat_simple">Un contrat simple¬†: un robinet test d&#8217;ether</h3>
<div class="paragraph data-line-270">
<p> Ethereum poss√®de de nombreux langages de haut niveau diff√©rents, qui peuvent tous √™tre utilis√©s pour √©crire un contrat et produire un code interm√©diaire ou bytecode EVM. Vous pouvez lire sur bon nombre des plus importantes et des plus int√©ressantes dans <a href="#high_level_languages">Introduction aux langages de haut niveau Ethereum</a>. Un langage de haut niveau est de loin le choix dominant pour la programmation de contrats intelligents : Solidity. Solidity a √©t√© cr√©√© par le Dr Gavin Wood, le co-auteur de ce livre, et est devenu le langage le plus largement utilis√© dans Ethereum (et au-del√†). Nous utiliserons Solidity pour r√©diger notre premier contrat.</p>
</div>
<div class="paragraph data-line-272">
<p>Pour notre premier exemple (<a href="#solidity_faucet_example">Faucet.sol: Un contrat Solidity mettant en place un robinet</a>), nous allons √©crire un contrat qui contr√¥le un <em>robinet</em>. Vous avez d√©j√† utilis√© un robinet pour obtenir de l&#39;ether de test sur le r√©seau de test de Ropsten. Un robinet est une chose relativement simple: il donne de l&#39;ether √† toute adresse qui le demande et peut √™tre rempli p√©riodiquement. Vous pouvez impl√©menter un robinet comme un portefeuille contr√¥l√© par un humain ou un serveur Web.</p>
</div>
<div id="solidity_faucet_example" class="exampleblock data-line-276">
<div class="title">Example 1. Faucet.sol: Un contrat Solidity mettant en place un robinet</div>
<div class="content">
<div class="listingblock data-line-278">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity 0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note data-line-284">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-285">
<p>Vous trouverez tous les exemples de code pour ce livre dans le sous-r√©pertoire <em>code</em> de <a href="https://github.com/ethereumbook/ethereumbook/" data-href="https://github.com/ethereumbook/ethereumbook/">le r√©f√©rentiel GitHub du livre</a>. Concr√®tement, notre contrat <em>Faucet.sol</em> est en:</p>
</div>
<div class="listingblock data-line-287">
<div class="content">
<pre>code/Solidity/Faucet.sol</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-292">
<p>Il s&#39;agit d&#39;un contrat tr√®s simple, √† peu pr√®s aussi simple que possible. Il s&#39;agit √©galement d&#39;un contrat <em>fauss√©</em>, d√©montrant un certain nombre de mauvaises pratiques et de failles de s√©curit√©. Nous apprendrons en examinant tous ses d√©fauts dans les sections suivantes. Mais pour l&#39;instant, regardons ce que fait ce contrat et comment il fonctionne, ligne par ligne. Vous remarquerez rapidement que de nombreux √©l√©ments de Solidity sont similaires aux langages de programmation existants, tels que JavaScript, Java ou C++.</p>
</div>
<div class="paragraph data-line-294">
<p>La premi√®re ligne est un commentaire :</p>
</div>
<div id="comment" class="listingblock data-line-298">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Notre premier contrat est un robinet (faucet) !</code></pre>
</div>
</div>
<div class="paragraph data-line-302">
<p>Les commentaires sont destin√©s √† √™tre lus par des humains et ne sont pas inclus dans le code interm√©diaire ex√©cutable de l&#8217;EVM. Nous les pla√ßons g√©n√©ralement sur la ligne avant le code que nous essayons d&#39;expliquer, ou parfois sur la m√™me ligne. Les commentaires commencent par deux barres obliques : //. Tout, depuis la premi√®re barre oblique jusqu&#39;√† la fin de cette ligne, est trait√© comme une ligne vide et ignor√©.</p>
</div>
<div class="paragraph data-line-304">
<p>La ligne suivante est l&#39;endroit o√π notre contrat r√©el commence¬†:</p>
</div>
<div id="contract_definition" class="listingblock data-line-308">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet {</code></pre>
</div>
</div>
<div class="paragraph data-line-312">
<p>Cette ligne d√©clare un objet contract, similaire √† une d√©claration class dans d&#39;autres langages orient√©s objet. La d√©finition du contrat inclut toutes les lignes entre les accolades (<code>{}</code>), qui d√©finissent une <em>port√©e</em>, un peu comme la fa√ßon dont les accolades sont utilis√©es dans de nombreux autres langages de programmation.</p>
</div>
<div class="paragraph data-line-314">
<p>Ensuite, nous d√©clarons la premi√®re fonction du contrat Faucet¬†:</p>
</div>
<div id="withdraw_function" class="listingblock data-line-318">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function withdraw(uint withdraw_amount) public {</code></pre>
</div>
</div>
<div class="paragraph data-line-322">
<p>La fonction est nomm√©e withdraw, et elle prend un argument entier non sign√© (uint) nomm√© withdraw_amount. Elle est d√©clar√©e fonction publique, c&#39;est-√†-dire qu&#39;elle peut √™tre appel√©e par d&#39;autres contrats. La d√©finition de la fonction suit, entre accolades. La premi√®re partie de la fonction retirer fixe une limite aux retraits¬†:</p>
</div>
<div id="withdraw_limit" class="listingblock data-line-326">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(withdraw_amount &lt;= 100000000000000000);</code></pre>
</div>
</div>
<div class="paragraph data-line-330">
<p>Il utilise la fonction int√©gr√©e Solidity require pour tester une condition pr√©alable, que le withdraw_amount est inf√©rieur ou √©gal √† 100 000 000 000 000 000 wei, qui est l&#39;unit√© de base de l&#39;ether (voir <a href="#ether_denominations">D√©nominations d&#8217;ether et noms d&#39;unit√©s</a>) et √©quivalent √† 0,1 ether. Si la fonction withdraw est appel√©e avec un withdraw_amount sup√©rieur √† ce montant, la fonction require provoquera ici l&#39;arr√™t et l&#39;√©chec de l&#39;ex√©cution du contrat avec une <em>exception</em>. Notez que les instructions doivent se terminer par un point-virgule dans Solidity.</p>
</div>
<div class="paragraph data-line-332">
<p>Cette partie du contrat est la logique principale de notre robinet. Il contr√¥le le flux de fonds hors du contrat en imposant une limite aux retraits. C&#39;est un contr√¥le tr√®s simple mais qui peut vous donner un aper√ßu de la puissance d&#39;une cha√Æne de blocs programmable : un logiciel d√©centralis√© contr√¥lant l&#39;argent.</p>
</div>
<div class="paragraph data-line-334">
<p>Vient ensuite le retrait proprement dit :</p>
</div>
<div id="withdraw_command" class="listingblock data-line-338">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-342">
<p>Quelques choses int√©ressantes se passent ici. L&#39;objet msg est l&#39;une des entr√©es auxquelles tous les contrats peuvent acc√©der. Il repr√©sente la transaction qui a d√©clench√© l&#39;ex√©cution de ce contrat. L&#39;attribut sender est l&#39;adresse de l&#39;exp√©diteur de la transaction. La fonction transfer est une fonction int√©gr√©e qui transf√®re l&#39;ether du contrat actuel √† l&#39;adresse de l&#39;exp√©diteur. En le lisant √† l&#39;envers, cela signifie transfert vers l&#39;+exp√©diteur+ du msg qui a d√©clench√© l&#39;ex√©cution de ce contrat. La fonction transfer prend un montant comme seul argument. Nous passons la valeur withdraw_amount qui √©tait le param√®tre √† la fonction withdraw d√©clar√©e quelques lignes plus t√¥t.</p>
</div>
<div class="paragraph data-line-344">
<p>La ligne suivante est l&#39;accolade fermante, indiquant la fin de la d√©finition de notre fonction withdraw.</p>
</div>
<div class="paragraph data-line-346">
<p>Ensuite, nous d√©clarons une autre fonction¬†:</p>
</div>
<div id="fallback_function" class="listingblock data-line-350">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function () external payable {}</code></pre>
</div>
</div>
<div class="paragraph data-line-354">
<p>Cette fonction est une fonction dite de <em>secours</em> ou de <em>fallback</em> (ou <em>default</em>), qui est appel√©e si la transaction qui a d√©clench√© le contrat n&#39;a nomm√© aucune des fonctions d√©clar√©es dans le contrat, ou aucune fonction du tout , ou ne contenait pas de donn√©es. Les contrats peuvent avoir une telle fonction par d√©faut (sans nom) et c&#39;est g√©n√©ralement celle qui re√ßoit l&#39;ether. C&#39;est pourquoi il est d√©fini comme une fonction externe et payante, ce qui signifie qu&#39;il peut accepter de l&#39;ether dans le contrat. Il ne fait rien d&#39;autre que d&#39;accepter l&#39;ether, comme indiqu√© par la d√©finition vide entre les accolades (<code>{}</code>). Si nous effectuons une transaction qui envoie de l&#39;ether √† l&#39;adresse du contrat, comme s&#39;il s&#39;agissait d&#39;un portefeuille, cette fonction s&#39;en chargera.</p>
</div>
<div class="paragraph data-line-356">
<p>Juste en dessous de notre fonction par d√©faut se trouve l&#39;accolade fermante finale, qui ferme la d√©finition du contrat Faucet. C&#39;est tout¬†!</p>
</div>
</div>
<div class="sect2 data-line-359">
<h3 id="compile_faucet_contract">Compilation du contrat de robinet</h3>
<div class="paragraph data-line-361">
<p>Maintenant que nous avons notre premier exemple de contrat, nous devons utiliser un compilateur Solidity pour convertir le code Solidity en code interm√©diaire/bytecode EVM afin qu&#39;il puisse √™tre ex√©cut√© par l&#39;EVM sur la cha√Æne de blocs elle-m√™me .</p>
</div>
<div class="paragraph data-line-363">
<p>Le compilateur Solidity se pr√©sente sous la forme d&#39;un ex√©cutable autonome, dans le cadre de divers frameworks, et regroup√© dans des environnements de d√©veloppement int√©gr√©s (IDE). Pour garder les choses simples, nous utiliserons l&#39;un des IDE les plus populaires, appel√© <em>Remix</em>.</p>
</div>
<div class="paragraph data-line-365">
<p>Utilisez votre navigateur Chrome (avec le portefeuille MetaMask que vous avez install√© pr√©c√©demment) pour acc√©der √† l&#39;IDE Remix √† l&#39;adresse <a href="https://remix.ethereum.org" class="undefined" data-href="https://remix.ethereum.org">https://remix.ethereum.org</a>.</p>
</div>
<div class="paragraph data-line-367">
<p>Lorsque vous chargez Remix pour la premi√®re fois, il d√©marre avec un exemple de contrat appel√© <em>ballot.sol</em>. Nous n&#39;en avons pas besoin, alors fermez-le en cliquant sur le x dans le coin de l&#39;onglet, comme indiqu√© dans <a href="#remix_close_tab">Fermer l&#39;onglet d&#39;exemple par d√©faut</a>.</p>
</div>
<div id="remix_close_tab" class="imageblock data-line-371">
<div class="content">
<img src="images/remix_close_tab.png" alt="&quot;Fermer l&#39;onglet d&#39;exemple par d√©faut&quot;">
</div>
<div class="title">Figure 10. Fermer l&#39;onglet d&#39;exemple par d√©faut</div>
</div>
<div class="paragraph data-line-373">
<p>Maintenant, ajoutez un nouvel onglet en cliquant sur le signe plus circulaire dans la barre d&#39;outils en haut √† gauche, comme indiqu√© dans <a href="#remix_toolbar">Cliquez sur le signe plus pour ouvrir un nouvel onglet</a>. Nommez le nouveau fichier <em>Faucet.sol</em>.</p>
</div>
<div id="remix_toolbar" class="imageblock data-line-377">
<div class="content">
<img src="images/remix_toolbar.png" alt="&quot;Cliquez sur le signe plus pour ouvrir un nouvel onglet&quot;">
</div>
<div class="title">Figure 11. Cliquez sur le signe plus pour ouvrir un nouvel onglet</div>
</div>
<div class="paragraph data-line-379">
<p>Une fois que vous avez ouvert le nouvel onglet, copiez et collez le code de notre exemple <em>Faucet.sol</em>, comme indiqu√© dans <a href="#remix_faucet_load">Copiez l&#39;exemple de code Faucet dans le nouvel onglet</a>.</p>
</div>
<div id="remix_faucet_load" class="imageblock data-line-383">
<div class="content">
<img src="images/remix_faucet_load.png" alt="&quot;Copiez l&#39;exemple de code Faucet dans le nouvel onglet&quot;">
</div>
<div class="title">Figure 12. Copiez l&#39;exemple de code Faucet dans le nouvel onglet</div>
</div>
<div class="paragraph data-line-385">
<p>Une fois que vous avez charg√© le contrat <em>Faucet.sol</em> dans l&#39;IDE Remix, l&#39;IDE compilera automatiquement le code. Si tout se passe bien, vous verrez une bo√Æte verte avec &quot;Faucet&quot; dedans appara√Ætre √† droite, sous l&#39;onglet Compiler, confirmant la compilation r√©ussie (voir <a href="#remix_compile">Remix compile avec succ√®s le contrat Faucet.sol</a>).</p>
</div>
<div id="remix_compile" class="imageblock data-line-389">
<div class="content">
<img src="images/remix_compile.png" alt="&quot;&quot;">
</div>
<div class="title">Figure 13. Remix compile avec succ√®s le contrat Faucet.sol</div>
</div>
<div class="paragraph data-line-391">
<p>Si quelque chose ne va pas, le probl√®me le plus probable est que l&#39;IDE Remix utilise une version du compilateur Solidity diff√©rente de 0.5.12. Dans ce cas, notre directive pragma emp√™chera <em>Faucet.sol</em> de se compiler. Pour modifier la version du compilateur, acc√©dez √† l&#39;onglet Param√®tres, d√©finissez la version sur 0.5.12 et r√©essayez.</p>
</div>
<div class="paragraph data-line-393">
<p>Le compilateur Solidity a maintenant compil√© notre <em>Faucet.sol</em> en code interm√©diaire EVM. Si vous √™tes curieux, le code interm√©diaire ressemble √† ceci :</p>
</div>
<div id="faucet_bytecode" class="listingblock data-line-396">
<div class="content">
<pre>PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH2 0xF JUMPI PUSH1 0x0 DUP1
REVERT JUMPDEST PUSH1 0xE5 DUP1 PUSH2 0x1D PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN
STOP PUSH1 0x60 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3F JUMPI
PUSH1 0x0 CALLDATALOAD PUSH29
0x100000000000000000000000000000000000000000000000000000000
SWAP1 DIV PUSH4 0xFFFFFFFF AND DUP1 PUSH4 0x2E1A7D4D EQ PUSH1 0x41 JUMPI
JUMPDEST STOP JUMPDEST CALLVALUE ISZERO PUSH1 0x4B JUMPI PUSH1 0x0 DUP1 REVERT
JUMPDEST PUSH1 0x5F PUSH1 0x4 DUP1 DUP1 CALLDATALOAD SWAP1 PUSH1 0x20 ADD SWAP1
SWAP2 SWAP1 POP POP PUSH1 0x61 JUMP JUMPDEST STOP JUMPDEST PUSH8
0x16345785D8A0000 DUP2 GT ISZERO ISZERO ISZERO PUSH1 0x77 JUMPI PUSH1 0x0 DUP1
REVERT JUMPDEST CALLER PUSH20 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF AND
PUSH2 0x8FC DUP3 SWAP1 DUP2 ISZERO MUL SWAP1 PUSH1 0x40 MLOAD PUSH1 0x0 PUSH1
0x40 MLOAD DUP1 DUP4 SUB DUP2 DUP6 DUP9 DUP9 CALL SWAP4 POP POP POP POP ISZERO
ISZERO PUSH1 0xB6 JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP JUMP STOP LOG1 PUSH6
0x627A7A723058 KECCAK256 PUSH9 0x13D1EA839A4438EF75 GASLIMIT CALLVALUE LOG4 0x5f
PUSH24 0x7541F409787592C988A079407FB28B4AD000290000000000</pre>
</div>
</div>
<div class="paragraph data-line-415">
<p>N&#39;√™tes-vous pas content d&#39;utiliser un langage de haut niveau comme Solidity au lieu de programmer directement en code interm√©diaire EVM ? Moi aussi¬†!</p>
</div>
</div>
<div class="sect2 data-line-418">
<h3 id="create_contract">Cr√©ation du contrat sur la cha√Æne de blocs</h3>
<div class="paragraph data-line-420">
<p>Donc, nous avons un contrat. Nous l&#39;avons compil√© en code interm√©diaire. Maintenant, nous devons &quot;enregistrer&quot; le contrat sur la cha√Æne de blocs Ethereum. Nous utiliserons le testnet de Ropsten pour tester notre contrat, c&#39;est donc la cha√Æne de blocs √† laquelle nous voulons le soumettre.</p>
</div>
<div class="paragraph data-line-422">
<p>L&#39;enregistrement d&#39;un contrat sur la cha√Æne de blocs implique la cr√©ation d&#39;une transaction sp√©ciale dont la destination est l&#39;adresse 0x00000000000000000000000000000000000000, √©galement appel√©e <em>zero address</em> ou l'<em>adresse z√©ro</em>. L&#39;adresse z√©ro est une adresse sp√©ciale qui indique √† la cha√Æne de blocs Ethereum que vous souhaitez enregistrer un contrat. Heureusement, l&#39;IDE Remix s&#39;occupera de tout cela pour vous et enverra la transaction √† MetaMask.</p>
</div>
<div class="paragraph data-line-424">
<p>Tout d&#39;abord, passez √† l&#39;onglet Run et s√©lectionnez Injected Web3 dans la zone de s√©lection d√©roulante Environment. Cela connecte l&#39;IDE Remix au portefeuille MetaMask et, via MetaMask, au r√©seau de test Ropsten. Une fois que vous faites cela, vous pouvez voir Ropsten sous Environment. De plus, dans la zone de s√©lection du compte, il indique l&#39;adresse de votre portefeuille (voir <a href="#remix_run">Onglet Run du IDE Remix, avec l&#39;environnement Injected Web3 s√©lectionn√©</a>).</p>
</div>
<div id="remix_run" class="imageblock data-line-428">
<div class="content">
<img src="images/remix_run.png" alt="&quot;Onglet Run du IDE Remix" width="avec l&#39;environnement Injected Web3 s√©lectionn√©&quot;">
</div>
<div class="title">Figure 14. Onglet Run du IDE Remix, avec l&#39;environnement Injected Web3 s√©lectionn√©</div>
</div>
<div class="paragraph data-line-430">
<p>Juste en dessous des param√®tres d&#39;ex√©cution que vous venez de confirmer se trouve le contrat Faucet, pr√™t √† √™tre cr√©√©. Cliquez sur le bouton Deploy affich√© dans <a href="#remix_run">Onglet Run du IDE Remix, avec l&#39;environnement Injected Web3 s√©lectionn√©</a>.</p>
</div>
<div class="paragraph data-line-432">
<p>Remix construira la transaction sp√©ciale &quot;cr√©ation&quot; et MetaMask vous demandera de l&#39;approuver, comme indiqu√© dans <a href="#remix_metamask_create">MetaMask montrant la transaction de cr√©ation de contrat</a>. Vous remarquerez que la transaction de cr√©ation de contrat ne contient pas d&#39;ether, mais qu&#39;elle contient 262 octets de donn√©es (le contrat compil√©) et consommera 10 gwei en gaz. Cliquez sur Soumettre pour l&#39;approuver.</p>
</div>
<div id="remix_metamask_create" class="imageblock data-line-436">
<div class="content">
<img src="images/remix_metamask_create.png" alt="&quot;MetaMask montrant la transaction de cr√©ation de contrat&quot;">
</div>
<div class="title">Figure 15. MetaMask montrant la transaction de cr√©ation de contrat</div>
</div>
<div class="paragraph data-line-438">
<p>Maintenant, vous devez attendre. Il faudra environ 15 √† 30 secondes pour que le contrat soit min√© sur Ropsten. Remix ne semblera pas faire grand-chose, mais soyez patient.</p>
</div>
<div class="paragraph data-line-440">
<p>Une fois le contrat cr√©√©, il appara√Æt en bas de l&#39;onglet Run (voir <a href="#remix_contract_interact">Le contrat Faucet est VIVANT¬†!</a>).</p>
</div>
<div id="remix_contract_interact" class="imageblock data-line-444">
<div class="content">
<img src="images/remix_contract_interact.png" alt="&quot;Le contrat Faucet est VIVANT¬†!&quot;">
</div>
<div class="title">Figure 16. Le contrat Faucet est VIVANT¬†!</div>
</div>
<div class="paragraph data-line-446">
<p>Notez que le contrat Faucet a maintenant sa propre adresse¬†: Remix l&#39;affiche comme &quot;Faucet √† 0x72e&#8230;&#8203;c7829&quot; (bien que votre adresse, les lettres et les chiffres al√©atoires, soient diff√©rents). Le petit symbole de presse-papiers √† droite vous permet de copier l&#39;adresse du contrat dans votre presse-papiers. Nous l&#39;utiliserons dans la section suivante.</p>
</div>
</div>
<div class="sect2 data-line-449">
<h3 id="interact_contract">Interagir avec le contrat</h3>
<div class="paragraph data-line-451">
<p>R√©capitulons ce que nous avons appris jusqu&#39;√† pr√©sent¬†: les contrats Ethereum sont des programmes qui contr√¥ler l&#39;argent, qui s&#39;ex√©cutent √† l&#39;int√©rieur d&#39;une machine virtuelle appel√©e EVM. Ils sont cr√©√©s par une transaction sp√©ciale qui soumet leur code interm√©diaire √† enregistrer sur la cha√Æne de blocs. Une fois cr√©√©s sur la cha√Æne de blocs, ils ont une adresse Ethereum, tout comme les portefeuilles. Chaque fois que quelqu&#39;un envoie une transaction √† une adresse de contrat, le contrat s&#39;ex√©cute dans l&#39;EVM, avec la transaction en entr√©e. Transactions envoy√©es pour les adresses de  <span class="keep-together">contrat</span> peuvent contenir de l&#39;ether ou des donn√©es ou les deux. S&#39;ils contiennent de l&#39;ether, il est &quot;d√©pos√©&quot; sur le solde du contrat. S&#39;ils contiennent des donn√©es, les donn√©es peuvent sp√©cifier une fonction nomm√©e dans le contrat et l&#39;appeler, en transmettant des arguments √† la fonction.</p>
</div>
<div class="sect3 data-line-454">
<h4 id="view_contract_address">Affichage de l&#39;adresse du contrat dans un explorateur de blocs</h4>
<div class="paragraph data-line-456">
<p>Nous avons maintenant un contrat enregistr√© sur la cha√Æne de blocs, et nous pouvons voir qu&#39;il a une adresse Ethereum. V√©rifions-le dans l&#39;explorateur de blocs <em>ropsten.etherscan.io</em> et voyons √† quoi ressemble un contrat. Dans l&#39;IDE Remix, copiez l&#39;adresse du contrat en cliquant sur l&#39;ic√¥ne du presse-papiers √† c√¥t√© de son nom (voir <a href="#remix_contract_address">Copiez l&#39;adresse du contrat de Remix</a>).</p>
</div>
<div id="remix_contract_address" class="imageblock data-line-460">
<div class="content">
<img src="images/remix_contract_address.png" alt="&quot;Copier l&#39;adresse du contrat depuis Remix&quot;">
</div>
<div class="title">Figure 17. Copiez l&#39;adresse du contrat de Remix</div>
</div>
<div class="paragraph data-line-462">
<p>Gardez Remix ouvert¬†; nous y reviendrons plus tard. Maintenant, naviguez dans votre navigateur jusqu&#39;√† <em>ropsten.etherscan.io</em> et collez l&#39;adresse dans le champ de recherche. Vous devriez voir l&#39;historique des adresses Ethereum du contrat, comme indiqu√© dans <a href="#etherscan_contract_address">Afficher l&#39;adresse du contrat Faucet dans l&#39;explorateur de blocs Etherscan</a>.</p>
</div>
<div id="etherscan_contract_address" class="imageblock data-line-466">
<div class="content">
<img src="images/etherscan_contract_address.png" alt="&quot;Afficher l&#39;adresse du contrat Faucet dans l&#39;explorateur de blocs etherscan&quot;">
</div>
<div class="title">Figure 18. Afficher l&#39;adresse du contrat Faucet dans l&#39;explorateur de blocs Etherscan</div>
</div>
</div>
<div class="sect3 data-line-469">
<h4 id="fund_contract">Financement du contrat</h4>
<div class="paragraph data-line-471">
<p>Pour l&#39;instant, le contrat n&#39;a qu&#39;une seule transaction dans son historique¬†: l&#8217;op√©ration de cr√©ation de contrat. Comme vous pouvez le voir, le contrat n&#39;a pas non plus d&#39;ether (solde nul). C&#39;est parce que nous n&#39;avons pas envoy√© d&#39;√©ther au contrat dans la transaction de cr√©ation, m√™me si nous aurions pu le faire.</p>
</div>
<div class="paragraph data-line-473">
<p>Notre robinet a besoin de fonds ! Notre premier projet sera d&#39;utiliser MetaMask pour envoyer de l&#39;ether au contrat. Vous devriez toujours avoir l&#39;adresse du contrat dans votre presse-papiers (sinon, copiez-la √† nouveau depuis Remix). Ouvrez MetaMask et envoyez-lui 1 √©ther, exactement comme vous le feriez √† n&#39;importe quelle autre adresse Ethereum (voir <a href="#metamask_send_to_contract">Envoyer 1 ether √† l&#39;adresse du contrat</a>).</p>
</div>
<div id="metamask_send_to_contract" class="imageblock data-line-477">
<div class="content">
<img src="images/metamask_send_to_contract.png" alt="&quot;&quot;">
</div>
<div class="title">Figure 19. Envoyer 1 ether √† l&#39;adresse du contrat</div>
</div>
<div class="paragraph data-line-479">
<p>Dans une minute, si vous rechargez l&#39;explorateur de blocs Etherscan, il affichera une autre transaction √† l&#39;adresse du contrat et un solde mis √† jour de 1 ether.</p>
</div>
<div class="paragraph data-line-481">
<p>Vous souvenez-vous de la fonction de paiement externe par d√©faut sans nom dans notre code <em>Faucet.sol</em>¬†? √áa ressemblait √† √ßa :</p>
</div>
<div id="fallback_function_review" class="listingblock data-line-485">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function () external payable {}</code></pre>
</div>
</div>
<div class="paragraph data-line-489">
<p>Lorsque vous avez envoy√© une transaction √† l&#39;adresse du contrat, sans donn√©es sp√©cifiant la fonction √† appeler, elle a appel√© cette fonction par d√©faut. Parce que nous l&#39;avons d√©clar√© comme payable, il a accept√© et d√©pos√© le 1 √©ther dans le solde du compte du contrat. Votre transaction a entra√Æn√© l&#39;ex√©cution du contrat dans l&#39;EVM, mettant √† jour son solde. Vous avez financ√© votre robinet !</p>
</div>
</div>
<div class="sect3 data-line-492">
<h4 id="withdraw_from_contract">Faire un retrait sur notre contrat</h4>
<div class="paragraph data-line-494">
<p>Ensuite, retirons des fonds du robinet. Pour retirer, nous devons construire une transaction qui appelle la fonction withdraw et lui passe un argument withdraw_amount. Pour garder les choses simples pour le moment, Remix construira cette transaction pour nous et MetaMask la pr√©sentera pour notre approbation.</p>
</div>
<div class="paragraph data-line-496">
<p>Revenez √† l&#39;onglet Remix et consultez le contrat dans l&#39;onglet Run. Vous devriez voir une bo√Æte orange intitul√©e wthdraw (retrait) avec une entr√©e de champ intitul√©e uint256 withdraw_amount (voir <a href="#remix_contract_withdraw">La fonction de retrait (withdraw) de Faucet.sol, dans Remix</a>).</p>
</div>
<div id="remix_contract_withdraw" class="imageblock data-line-500">
<div class="content">
<img src="images/remix_contract_interact.png" alt="&quot;La fonction de retrait (withdraw) de Faucet.sol" width="dans Remix&quot;">
</div>
<div class="title">Figure 20. La fonction de retrait (withdraw) de Faucet.sol, dans Remix</div>
</div>
<div class="paragraph data-line-502">
<p>Il s&#39;agit de l&#39;interface Remix du contrat. Il nous permet de construire des transactions qui appellent les fonctions d√©finies dans le contrat. Nous entrerons un withdraw_amount et cliquerons sur le bouton de retrait pour g√©n√©rer la transaction.</p>
</div>
<div class="paragraph data-line-504">
<p>Tout d&#39;abord, d√©terminons le withdraw_amount (montant de retrait). Nous voulons essayer de retirer 0,1 √©ther, qui est le montant maximum autoris√© par notre contrat. N&#39;oubliez pas que toutes les valeurs mon√©taires d&#39;Ethereum sont libell√©es en wei en interne, et notre fonction withdraw s&#39;attend √† ce que le withdraw_amount soit √©galement libell√© en wei. La quantit√© que nous voulons est de 0,1 √©ther, soit 100 000 000 000 000 000 wei (un 1 suivi de 17 z√©ros).</p>
</div>
<div class="admonitionblock tip data-line-509">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-510">
<p>En raison d&#39;une limitation de JavaScript, un nombre aussi grand que 10<sup>17</sup> ne peut pas √™tre trait√© par Remix. Au lieu de cela, nous l&#39;entourons de guillemets doubles, pour permettre √† Remix de le recevoir sous forme de cha√Æne et de le manipuler comme un BigNumber. Si nous ne le mettons pas entre guillemets, l&#39;IDE Remix ne parviendra pas √† le traiter et affichera &quot;Error encoding arguments: Error: Assertion failed.&quot;</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-513">
<p>Tapez &quot;100000000000000000&quot; (avec les guillemets) dans la case withdraw_amount et cliquez sur le bouton de retrait (voir <a href="#remix_withdraw">Cliquez sur &quot;withdraw&quot; dans Remix pour cr√©er une transaction de retrait</a>).</p>
</div>
<div id="remix_withdraw" class="imageblock data-line-517">
<div class="content">
<img src="images/remix_withdraw.png" alt="&quot;&quot;">
</div>
<div class="title">Figure 21. Cliquez sur &quot;withdraw&quot; dans Remix pour cr√©er une transaction de retrait</div>
</div>
<div class="paragraph data-line-519">
<p>MetaMask fera appara√Ætre une fen√™tre de transaction que vous devrez approuver. Cliquez sur Confirmer pour envoyer votre appel de retrait au contrat (voir <a href="#metamask_withdraw">Transaction MetaMask pour appeler la fonction de retrait</a>).</p>
</div>
<div id="metamask_withdraw" class="imageblock data-line-523">
<div class="content">
<img src="images/metamask_withdraw.png" alt="&quot;Transaction MetaMask pour appeler la fonction de retrait&quot;">
</div>
<div class="title">Figure 22. Transaction MetaMask pour appeler la fonction de retrait</div>
</div>
<div class="paragraph data-line-525">
<p>Attendez une minute, puis rechargez l&#39;explorateur de blocs Etherscan pour voir la transaction refl√©t√©e dans l&#39;historique des adresses de contrat + Faucet + (voir <a href="#etherscan_withdrawal_tx">Etherscan montre la transaction appelant la fonction de retrait</a>).</p>
</div>
<div id="etherscan_withdrawal_tx" class="imageblock data-line-529">
<div class="content">
<img src="images/etherscan_withdrawal_tx.png" alt="&quot;Etherscan affiche la transaction appelant la fonction de retrait&quot;">
</div>
<div class="title">Figure 23. Etherscan montre la transaction appelant la fonction de retrait</div>
</div>
<div class="paragraph data-line-532">
<p>Nous voyons maintenant une nouvelle transaction avec l&#39;adresse du contrat comme destination et une valeur de 0 √©ther. Le solde du contrat a chang√© et est maintenant de 0,9 √©ther car il nous a envoy√© 0,1 √©ther comme demand√©. Mais nous ne voyons pas de transaction &quot;OUT&quot; dans l&#39;_historique des adresses de contrat_.</p>
</div>
<div class="paragraph data-line-534">
<p>O√π est le retrait sortant¬†? Un nouvel onglet est apparu sur la page d&#39;historique des adresses du contrat, nomm√© Transactions internes. Parce que le transfert d&#39;√©ther 0.1 provient du code de contrat, il s&#39;agit d&#39;une transaction interne (√©galement appel√©e <em>message</em>). Cliquez sur cet onglet pour le voir (voir <a href="#etherscan_withdrawal_internal">Etherscan montre la transaction interne transf√©rant l&#39;ether du contrat</a>).</p>
</div>
<div class="paragraph data-line-537">
<p>Cette &quot;transaction interne&quot; a √©t√© envoy√©e par le contrat dans cette ligne de code (√† partir de la fonction <code><span class="keep-together">withdraw</span></code> dans <em>Faucet.sol</em>)¬†:</p>
</div>
<div id="withdraw_command_review" class="listingblock data-line-541">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-545">
<p>Pour r√©capituler¬†: vous avez envoy√© une transaction depuis votre portefeuille MetaMask contenant des instructions de donn√©es pour appeler la fonction withdraw avec un argument withdraw_amount de 0,1¬†ether. Cette transaction a entra√Æn√© l&#39;ex√©cution du contrat √† l&#39;int√©rieur de l&#39;EVM. Lorsque l&#39;EVM a ex√©cut√© la fonction withdraw du contrat Faucet, il a d&#39;abord appel√© la fonction require et valid√© que le montant demand√© √©tait inf√©rieur ou √©gal au retrait maximal autoris√© de 0,1 √©ther. Ensuite, il a appel√© la fonction transfer pour vous envoyer l&#39;√©ther. L&#39;ex√©cution de la fonction transfer a g√©n√©r√© une transaction interne qui a d√©pos√© 0,1 √©ther dans votre adresse de portefeuille, √† partir du solde du contrat. C&#39;est celui affich√© sur l&#39;onglet Internal Transactions dans Etherscan. </p>
</div>
<div id="etherscan_withdrawal_internal" class="imageblock data-line-549">
<div class="content">
<img src="images/etherscan_withdrawal_internal.png" alt="&quot;Etherscan montre la transaction interne transf√©rant l&#39;√©ther hors du contrat&quot;">
</div>
<div class="title">Figure 24. Etherscan montre la transaction interne transf√©rant l&#39;ether du contrat</div>
</div>
</div>
</div>
<div class="sect2 data-line-552">
<h3 id="intro_conclusion">Conclusion</h3>
<div class="paragraph data-line-554">
<p>Dans ce chapitre, vous avez configur√© un portefeuille √† l&#39;aide de MetaMask et l&#39;avez financ√© √† l&#39;aide d&#39;un robinet sur le r√©seau de test Ropsten. Vous avez re√ßu de l&#39;ether dans l&#39;adresse Ethereum de votre portefeuille, puis vous avez envoy√© de l&#39;ether √† l&#39;adresse du robinet Ethereum.</p>
</div>
<div class="paragraph data-line-556">
<p>Ensuite, vous avez √©crit un contrat de robinet dans Solidity. Vous avez utilis√© l&#39;IDE Remix pour compiler le contrat en code interm√©diaire EVM, puis utilis√© Remix pour former une transaction et cr√©√© le contrat Faucet sur la cha√Æne de blocs Ropsten. Une fois cr√©√©, le contrat Faucet avait une adresse Ethereum, et vous lui avez envoy√© de l&#39;ether. Enfin, vous avez construit une transaction pour appeler la fonction withdraw et demand√© avec succ√®s 0,1 √©ther. Le contrat a v√©rifi√© la demande et vous a envoy√© 0,1 ether avec une transaction interne.</p>
</div>
<div class="paragraph data-line-558">
<p>Cela peut ne pas sembler beaucoup, mais vous venez d&#39;interagir avec succ√®s avec un logiciel qui contr√¥le l&#39;argent sur un ordinateur mondial d√©centralis√©.</p>
</div>
<div class="paragraph data-line-7">
<p>Nous ferons beaucoup plus de programmation de contrats intelligents dans <a href="#smart_contracts_chapter">Contrats intelligents et Solidity</a> et d√©couvrirons les meilleures pratiques et les consid√©rations de s√©curit√© dans <a href="#smart_contract_security">S√©curit√© des contrats intelligents</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="ethereum_clients_chapter">Clients Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Un client Ethereum est une application logicielle qui impl√©mente la sp√©cification Ethereum et communique sur le r√©seau pair √† pair avec d&#39;autres clients Ethereum. Diff√©rents clients Ethereum <em>interop√®rent</em> s&#39;ils respectent la sp√©cification de r√©f√©rence et les protocoles de communication standardis√©s. Bien que ces diff√©rents clients soient impl√©ment√©s par des √©quipes diff√©rentes et dans des langages de programmation diff√©rents, ils ¬´ parlent ¬ª tous le m√™me protocole et suivent les m√™mes r√®gles. En tant que tels, ils peuvent tous √™tre utilis√©s pour fonctionner et interagir avec le m√™me r√©seau Ethereum.</p>
</div>
<div class="paragraph data-line-6">
<p>Ethereum est un projet √† source libre, et le code source de tous les principaux clients est disponible sous des licences √† source libre (par exemple, LGPL v3.0), t√©l√©chargeable et utilisable √† n&#39;importe quelle fin. <em>Source libre</em> signifie cependant plus que simplement libre d&#39;utilisation. Cela signifie √©galement qu&#39;Ethereum est d√©velopp√© par une communaut√© ouverte de volontaires et peut √™tre modifi√© par n&#39;importe qui. Plus d&#39;yeux signifie un code plus fiable.</p>
</div>
<div class="paragraph data-line-8">
<p>Ethereum est d√©fini par une sp√©cification formelle appel√©e le &quot;Papier jaune&quot; (voir <a href="#references">Lectures compl√©mentaires</a>).</p>
</div>
<div class="paragraph data-line-10">
<p>Cela contraste avec, par exemple, Bitcoin, qui n&#39;est pas d√©fini de mani√®re formelle. L√† o√π la &quot;sp√©cification&quot; de Bitcoin est l&#39;impl√©mentation de r√©f√©rence de Bitcoin Core, la sp√©cification d&#39;Ethereum est document√©e dans un article qui combine une sp√©cification anglaise et une sp√©cification math√©matique (formelle). Cette sp√©cification formelle, en plus de diverses propositions d&#39;am√©lioration Ethereum, d√©finit le comportement standard d&#39;un <span class="keep-together">client</span> Ethereum. Le livre jaune est p√©riodiquement mis √† jour au fur et √† mesure que des modifications majeures sont apport√©es √† <span class="keep-together">Ethereum</span>.</p>
</div>
<div class="paragraph data-line-12">
<p>En raison de la sp√©cification formelle claire d&#39;Ethereum, il existe un certain nombre d&#39;impl√©mentations logicielles d√©velopp√©es ind√©pendamment, mais interop√©rables, d&#39;un client Ethereum. Ethereum a une plus grande diversit√© d&#39;impl√©mentations fonctionnant sur le r√©seau que toute autre blockchain, ce qui est g√©n√©ralement consid√©r√© comme une bonne chose. En effet, il s&#39;est av√©r√©, par exemple, √™tre un excellent moyen de se d√©fendre contre les attaques sur le r√©seau, car l&#39;exploitation de la strat√©gie de mise en ≈ìuvre d&#39;un client particulier ne fait qu&#39;emb√™ter les d√©veloppeurs pendant qu&#39;ils corrigent l&#39;exploit, tandis que d&#39;autres clients maintiennent le r√©seau en marche presque sans √™tre affect√©.</p>
</div>
<div class="sect2 data-line-14">
<h3 id="_r√©seaux_ethereum">R√©seaux Ethereum</h3>
<div class="paragraph data-line-16">
<p>Il existe une vari√©t√© de r√©seaux bas√©s sur Ethereum qui sont largement conformes √† la sp√©cification formelle d√©finie dans le livre jaune Ethereum, mais qui peuvent ou non interagir les uns avec les autres.</p>
</div>
<div class="paragraph data-line-18">
<p>Parmi ces r√©seaux bas√©s sur Ethereum figurent Ethereum, Ethereum Classic, Ella, Expanse, Ubiq, Musicoin et bien d&#39;autres. Bien qu&#39;ils soient g√©n√©ralement compatibles au niveau du protocole, ces r√©seaux ont souvent des fonctionnalit√©s ou des attributs qui obligent les mainteneurs du logiciel client Ethereum √† apporter de petites modifications afin de prendre en charge chaque r√©seau. Pour cette raison, toutes les versions du logiciel client Ethereum n&#39;ex√©cutent pas toutes les cha√Ænes de blocs bas√©es sur Ethereum.</p>
</div>
<div class="paragraph data-line-20">
<p>Actuellement, il existe six impl√©mentations principales du protocole Ethereum, √©crites dans six langages diff√©rents¬†:</p>
</div>
<div class="ulist data-line-22">
<ul>
<li class="data-line-22">
<p>Parity, √©crite en Rust</p>
</li>
<li class="data-line-23">
<p>Geth, √©crit en Go</p>
</li>
<li class="data-line-24">
<p>cpp-ethereum, √©crit en C++</p>
</li>
<li class="data-line-25">
<p>pyethereum, √©crit en Python</p>
</li>
<li class="data-line-26">
<p>Mantis, √©crit en Scala</p>
</li>
<li class="data-line-27">
<p>Harmony, √©crit en Java</p>
</li>
</ul>
</div>
<div class="paragraph data-line-29">
<p>Dans cette section, nous examinerons les deux clients les plus courants, Parity et Geth. Nous montrerons comment configurer un n≈ìud √† l&#39;aide de chaque client et explorerons certaines de leurs options de ligne de commande et interfaces de programmation d&#39;application (API).</p>
</div>
<div class="sect3 data-line-32">
<h4 id="full_node_importance">Dois-je ex√©cuter un n≈ìud complet¬†?</h4>
<div class="paragraph data-line-34">
<p>La sant√©, la r√©silience et la r√©sistance √† la censure des cha√Ænes de blocs d√©pendent de leur nombre de n≈ìuds complets exploit√©s ind√©pendamment et dispers√©s g√©ographiquement. Chaque n≈ìud complet peut aider d&#39;autres nouveaux n≈ìuds √† obtenir les donn√©es de bloc pour amorcer leur fonctionnement, tout en offrant √† l&#39;op√©rateur une v√©rification faisant autorit√© et ind√©pendante de toutes les transactions et contrats.</p>
</div>
<div class="paragraph data-line-36">
<p>Cependant, l&#39;ex√©cution d&#39;un n≈ìud complet entra√Ænera un co√ªt en ressources mat√©rielles et en bande passante. Un n≈ìud complet doit t√©l√©charger 80 √† 300 Go de donn√©es (√† compter de janvier 2020, selon la configuration du client) et les stocker sur un disque dur local. Cette charge de donn√©es augmente assez rapidement chaque jour √† mesure que de nouvelles transactions et de nouveaux blocs sont ajout√©s. Nous abordons ce sujet plus en d√©tail dans <a href="#requirements">Configuration mat√©rielle requise pour un n≈ìud complet</a>.</p>
</div>
<div class="paragraph data-line-38">
<p>Un n≈ìud complet fonctionnant sur un r√©seau <em>mainnet</em> en direct n&#39;est pas n√©cessaire pour le d√©veloppement d&#39;Ethereum. Vous pouvez faire presque tout ce que vous devez faire avec un n≈ìud <em>testnet</em> (qui vous connecte √† l&#39;une des plus petites cha√Ænes de blocs de test publiques), avec une cha√Æne de blocs priv√©e locale comme Ganache, ou avec un client Ethereum bas√© sur le cloud propos√© par un fournisseur de services comme Infura.</p>
</div>
<div class="paragraph data-line-40">
<p>Vous avez √©galement la possibilit√© d&#39;ex√©cuter un client distant, qui ne stocke pas de copie locale de la cha√Æne de blocs ni ne valide les blocs et les transactions. Ces clients offrent la fonctionnalit√© d&#39;un portefeuille et peuvent cr√©er et diffuser des transactions. Les clients distants peuvent √™tre utilis√©s pour se connecter √† des r√©seaux existants, tels que votre propre n≈ìud complet, une cha√Æne de blocs publique, un testnet public ou autoris√© (preuve d&#39;autorit√©), ou une cha√Æne de blocs locale priv√©e. En pratique, vous utiliserez probablement un client distant tel que MetaMask, Emerald Wallet, <span class="keep-together">MyEtherWallet</span> ou MyCrypto comme moyen pratique de basculer entre toutes les diff√©rentes options de n≈ìud.</p>
</div>
<div class="paragraph data-line-42">
<p>Les termes &quot;client distant&quot; et &quot;portefeuille&quot; sont utilis√©s de mani√®re interchangeable, bien qu&#39;il existe certains diff√©rences. Habituellement, un client distant propose une API (telle que l&#39;API web3.js) en plus de la fonctionnalit√© de transaction d&#39;un portefeuille.</p>
</div>
<div class="paragraph data-line-44">
<p>Ne confondez pas le concept de portefeuille distant dans Ethereum avec celui d&#39;un <em>client l√©ger</em> (qui est analogue √† un client de v√©rification simplifi√©e des paiements dans Bitcoin). Les clients l√©gers valident les en-t√™tes de bloc et utilisent les preuves Merkle pour valider l&#39;inclusion des transactions dans la cha√Æne de blocs et d√©terminer leurs effets, leur donnant un niveau de s√©curit√© similaire √† un n≈ìud complet. Inversement, les clients distants Ethereum ne valident pas les en-t√™tes de bloc ou les transactions. Ils font enti√®rement confiance √† un client complet pour leur donner acc√®s √† la cha√Æne de blocs, et perdent ainsi d&#39;importantes garanties de s√©curit√© et d&#39;anonymat. Vous pouvez att√©nuer ces probl√®mes en utilisant un client complet que vous ex√©cutez vous-m√™me.</p>
</div>
</div>
<div class="sect3 data-line-47">
<h4 id="full_node_adv_disadv">Avantages et d√©savantages du n≈ìud complet</h4>
<div class="paragraph data-line-49">
<p> Choisir d&#39;ex√©cuter un n≈ìud complet facilite le fonctionnement des r√©seaux auxquels vous le connectez, mais entra√Æne √©galement des co√ªts l√©gers √† mod√©r√©s pour vous. Regardons quelques-uns des avantages et des inconv√©nients.</p>
</div>
<div class="paragraph data-line-51">
<p><strong>Avantages:</strong></p>
</div>
<div class="ulist data-line-53">
<ul>
<li class="data-line-53">
<p>Prend en charge la r√©silience et la r√©sistance √† la censure des r√©seaux bas√©s sur Ethereum</p>
</li>
<li class="data-line-54">
<p>Valide avec autorit√© toutes les transactions</p>
</li>
<li class="data-line-55">
<p>Peut interagir avec n&#39;importe quel contrat sur la cha√Æne de blocs publique sans interm√©diaire</p>
</li>
<li class="data-line-56">
<p>Peut d√©ployer directement des contrats dans la cha√Æne de blocs publique sans interm√©diaire</p>
</li>
<li class="data-line-57">
<p>Peut interroger (lecture seule) le statut de la cha√Æne de blocs (comptes, contrats, etc.) hors ligne</p>
</li>
<li class="data-line-58">
<p>Peut interroger la cha√Æne de blocs sans laisser un tiers conna√Ætre les informations que vous lisez</p>
</li>
</ul>
</div>
<div class="paragraph data-line-60">
<p><strong>D√©savantages:</strong></p>
</div>
<div class="ulist data-line-62">
<ul>
<li class="data-line-62">
<p>N√©cessite des ressources mat√©rielles et de bande passante importantes et croissantes</p>
</li>
<li class="data-line-63">
<p>Peut n√©cessiter plusieurs jours pour une synchronisation compl√®te lors du premier d√©marrage</p>
</li>
<li class="data-line-64">
<p>Doit √™tre maintenu, mis √† jour et maintenu en ligne pour rester synchronis√©</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-67">
<h4 id="pub_test_adv_disadv">Avantages et d√©savantages du testnet public</h4>
<div class="paragraph data-line-69">
<p>Que vous choisissiez ou non d&#39;ex√©cuter un n≈ìud complet, vous souhaiterez probablement ex√©cuter un n≈ìud testnet public. Examinons quelques-uns des avantages et des inconv√©nients de l&#39;utilisation d&#39;un testnet public.</p>
</div>
<div class="paragraph data-line-71">
<p><strong>Avantages:</strong></p>
</div>
<div class="ulist data-line-73">
<ul>
<li class="data-line-73">
<p>Un n≈ìud testnet doit synchroniser et stocker beaucoup moins de donn√©es - environ 45 Go selon le r√©seau.</p>
</li>
<li class="data-line-74">
<p>Un n≈ìud testnet peut se synchroniser compl√®tement en quelques heures.</p>
</li>
<li class="data-line-75">
<p>Le d√©ploiement de contrats ou la r√©alisation de transactions n√©cessite un test d&#39;ether, qui n&#39;a aucune valeur et peut √™tre acquis gratuitement √† partir de plusieurs &quot;robinets&quot;.</p>
</li>
<li class="data-line-76">
<p>Les r√©seaux de test sont des cha√Ænes de blocs publiques avec de nombreux autres utilisateurs et contrats, fonctionnant &quot;en direct&quot;.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-78">
<p><strong>D√©savantages:</strong></p>
</div>
<div class="ulist data-line-80">
<ul>
<li class="data-line-80">
<p>Vous ne pouvez pas utiliser d&#39;argent &quot;r√©el&quot; sur un testnet¬†; il fonctionne sur l&#39;ether de test. Par cons√©quent, vous ne pouvez pas tester la s√©curit√© contre de vrais adversaires, car il n&#39;y a rien en jeu.</p>
</li>
<li class="data-line-81">
<p>Il y a certains aspects d&#39;une cha√Æne de blocs publique que vous ne pouvez pas tester de mani√®re r√©aliste sur un testnet. Par exemple, les frais de transaction, bien que n√©cessaires pour envoyer des transactions, ne sont pas pris en compte sur un testnet, car le gaz est gratuit. De plus, les r√©seaux de test ne connaissent pas de congestion du r√©seau comme le fait parfois le r√©seau principal public.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-84">
<h4 id="localtest_adv_dis">Avantages et d√©savantages de la simulation cha√Æne de blocs locale</h4>
<div class="paragraph data-line-86">
<p>√Ä de nombreuses fins de test, la meilleure option consiste √† lancer une cha√Æne de blocs priv√©e √† instance unique. Ganache (anciennement nomm√© testrpc) est l&#39;une des simulations de cha√Æne de blocs locales les plus populaires avec lesquelles vous pouvez interagir, sans aucun autre participant. Il partage de nombreux avantages et inconv√©nients du testnet public, mais pr√©sente √©galement quelques diff√©rences.</p>
</div>
<div class="paragraph data-line-88">
<p><strong>Avantages:</strong></p>
</div>
<div class="ulist data-line-90">
<ul>
<li class="data-line-90">
<p>Aucune synchronisation et presque aucune donn√©e sur le disque¬†; vous minez vous-m√™me le premier bloc</p>
</li>
<li class="data-line-91">
<p>Pas besoin d&#39;obtenir de l&#39;ether de test¬†; vous vous &quot;attribuez&quot; des r√©compenses mini√®res que vous pouvez utiliser pour tester</p>
</li>
<li class="data-line-92">
<p>Aucun autre utilisateur, juste vous</p>
</li>
<li class="data-line-93">
<p>Aucun autre contrat, juste ceux que vous d√©ployez apr√®s le lancement</p>
</li>
</ul>
</div>
<div class="paragraph data-line-95">
<p><strong>D√©savantages:</strong></p>
</div>
<div class="ulist data-line-97">
<ul>
<li class="data-line-97">
<p>Ne pas avoir d&#39;autres utilisateurs signifie qu&#39;il ne se comporte pas de la m√™me mani√®re qu&#39;une cha√Æne de blocs publique. Il n&#39;y a pas de concurrence pour l&#39;espace de transaction ou le s√©quen√ßage des <span class="keep-together">transactions</span>.</p>
</li>
<li class="data-line-98">
<p>Aucun mineur autre que vous signifie que l&#39;exploitation mini√®re est plus pr√©visible¬†; par cons√©quent, vous ne pouvez pas tester certains sc√©narios qui se produisent sur une cha√Æne de blocs publique.</p>
</li>
<li class="data-line-99">
<p>L&#39;absence d&#39;autres contrats signifie que vous devez d√©ployer tout ce que vous souhaitez tester, y compris les d√©pendances et les biblioth√®ques de contrats.</p>
</li>
<li class="data-line-100">
<p>Vous ne pouvez pas recr√©er certains contrats publics et leurs adresses pour tester certains sc√©narios (par exemple, le contrat DAO).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 data-line-104">
<h3 id="running_client">Ex√©cuter un client Ethereum</h3>
<div class="paragraph data-line-106">
<p>Si vous avez le temps et les ressources, vous devriez essayer d&#39;ex√©cuter un n≈ìud complet, m√™me si ce n&#39;est que pour en savoir plus sur le processus. Dans cette section, nous expliquons comment t√©l√©charger, compiler et ex√©cuter les clients Ethereum Parity et Geth. Cela n√©cessite une certaine familiarit√© avec l&#39;utilisation de l&#39;interface de ligne de commande sur votre syst√®me d&#39;exploitation. Cela vaut la peine d&#39;installer ces clients, que vous choisissiez de les ex√©cuter en tant que n≈ìuds complets, en tant que n≈ìuds testnet ou en tant que clients d&#39;une cha√Æne de blocs priv√©e locale.</p>
</div>
<div class="sect3 data-line-109">
<h4 id="requirements">Configuration mat√©rielle requise pour un n≈ìud complet</h4>
<div class="paragraph data-line-111">
<p>Avant de commencer, vous devez vous assurer que vous disposez d&#39;un ordinateur dot√© de ressources suffisantes pour fonctionner un n≈ìud complet Ethereum. Vous aurez besoin d&#39;au moins 300 Go d&#39;espace disque pour stocker une copie compl√®te de la cha√Æne de blocs Ethereum. Si vous souhaitez √©galement ex√©cuter un n≈ìud complet sur le testnet Ethereum, vous aurez besoin d&#39;au moins 45 Go suppl√©mentaires. Le t√©l√©chargement de 345 Go de donn√©es de la cha√Æne de blocs peut prendre beaucoup de temps, il est donc recommand√© de travailler sur une connexion Internet rapide.</p>
</div>
<div class="paragraph data-line-113">
<p>La synchronisation de la cha√Æne de blocs Ethereum est tr√®s intensive en entr√©e/sortie (E/S). Il est pr√©f√©rable d&#39;avoir un disque statique √©lectronique (SSD). Si vous avez un disque dur m√©canique (HDD), vous aurez besoin d&#39;au moins 8 Go de RAM √† utiliser comme cache. Sinon, vous d√©couvrirez peut-√™tre que votre syst√®me est trop lent pour suivre et synchroniser compl√®tement.</p>
</div>
<div class="paragraph data-line-115">
<p><strong>Exigences minimales:</strong></p>
</div>
<div class="ulist data-line-117">
<ul>
<li class="data-line-117">
<p>Processeur avec 2+ c≈ìurs</p>
</li>
<li class="data-line-118">
<p>Au moins 300 Go d&#39;espace de stockage libre</p>
</li>
<li class="data-line-119">
<p>4 Go de RAM minimum avec un SSD, 8 Go+ si vous avez un HDD</p>
</li>
<li class="data-line-120">
<p>Service Internet de t√©l√©chargement de 8 Mbit/s</p>
</li>
</ul>
</div>
<div class="paragraph data-line-122">
<p>Ce sont les exigences minimales pour synchroniser une copie compl√®te (mais √©lagu√©e) d&#39;une cha√Æne de blocs bas√©e sur Ethereum.</p>
</div>
<div class="paragraph data-line-124">
<p>Au moment de la r√©daction, la base de code Parity est plus l√©g√®re sur les ressources, donc si vous utilisez un mat√©riel limit√©, vous obtiendrez probablement de meilleurs r√©sultats en utilisant Parity.</p>
</div>
<div class="paragraph data-line-126">
<p>Si vous souhaitez synchroniser dans un d√©lai raisonnable et stocker tous les outils de d√©veloppement, biblioth√®ques, clients et cha√Ænes de blocs dont nous parlons dans ce livre, vous voudrez un ordinateur plus performant.</p>
</div>
<div class="paragraph data-line-128">
<p><strong>Sp√©cifications recommand√©es¬†:</strong></p>
</div>
<div class="ulist data-line-130">
<ul>
<li class="data-line-130">
<p>Processeur rapide avec 4+ c≈ìurs</p>
</li>
<li class="data-line-131">
<p>16 Go + RAM</p>
</li>
<li class="data-line-132">
<p>SSD rapide avec au moins 500 Go d&#39;espace libre</p>
</li>
<li class="data-line-133">
<p>Service Internet de t√©l√©chargement de plus de 25 Mbit/s</p>
</li>
</ul>
</div>
<div class="paragraph data-line-135">
<p>Il est difficile de pr√©dire √† quelle vitesse la taille d&#39;une cha√Æne de blocs augmentera et quand plus d&#39;espace disque sera n√©cessaire, il est donc recommand√© de v√©rifier la derni√®re taille de la cha√Æne de blocs avant de commencer la synchronisation.</p>
</div>
<div class="admonitionblock note data-line-138">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-139">
<p>Les exigences de taille de disque r√©pertori√©es ici supposent que vous ex√©cuterez un n≈ìud avec les param√®tres par d√©faut, o√π la cha√Æne de blocs est &quot;√©lagu√©e&quot; des anciennes donn√©es d&#39;√©tat. Si vous ex√©cutez √† la place un n≈ìud &quot;d&#39;archivage&quot; complet, o√π tout l&#39;√©tat est conserv√© sur le disque, il n√©cessitera probablement plus de 1 To d&#39;espace disque.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-142">
<p>Ces liens fournissent des estimations √† jour de la taille de la cha√Æne de blocs¬†:</p>
</div>
<div class="ulist data-line-144">
<ul>
<li class="data-line-144">
<p><a href="https://bitinfocharts.com/ethereum/" data-href="https://bitinfocharts.com/ethereum/">Ethereum</a></p>
</li>
<li class="data-line-146">
<p><a href="https://bitinfocharts.com/ethereum%20classic/" data-href="https://bitinfocharts.com/ethereum%20classic/">Ethereum classique</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-149">
<h4 id="sw_reqs">Configuration logicielle requise pour cr√©er et ex√©cuter un client (n≈ìud)</h4>
<div class="paragraph data-line-151">
<p>Cette section couvre les logiciels clients Parity et Geth. Il suppose √©galement que vous utilisez un environnement de ligne de commande de type Unix. Les exemples montrent les commandes et la sortie telles qu&#39;elles apparaissent sur un syst√®me d&#39;exploitation Ubuntu GNU/Linux ex√©cutant le shell bash (environnement d&#39;ex√©cution en ligne de commande).</p>
</div>
<div class="paragraph data-line-153">
<p>En r√®gle g√©n√©rale, chaque cha√Æne de blocs aura sa propre version de Geth, tandis que Parity prend en charge plusieurs cha√Ænes de blocs bas√©es sur Ethereum (Ethereum, Ethereum Classic, <span class="keep-together">Ellaism</span>, Expanse, Musicoin) avec le m√™me client t√©l√©charg√©.</p>
</div>
<div class="admonitionblock tip data-line-156">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-157">
<p>Dans de nombreux exemples de ce chapitre , nous utiliserons l&#39;interface de ligne de commande du syst√®me d&#39;exploitation (√©galement appel√©e &quot;shell&quot;), accessible via une application &quot;terminal&quot;. Le shell affichera une invite¬†; vous tapez une commande et le shell r√©pond avec du texte et une nouvelle invite pour votre prochaine commande. L&#39;invite peut sembler diff√©rente sur votre syst√®me, mais dans les exemples suivants, elle est indiqu√©e par un symbole $. Dans les exemples, lorsque vous voyez du texte apr√®s un symbole $, ne tapez pas le symbole $ mais tapez la commande qui le suit imm√©diatement (en gras), puis appuyez sur Entr√©e pour ex√©cuter la commande. Dans les exemples, les lignes sous chaque commande sont les r√©ponses du syst√®me d&#39;exploitation √† cette commande. Lorsque vous verrez le prochain pr√©fixe $, vous saurez qu&#39;il s&#39;agit d&#39;une nouvelle commande et vous devrez r√©p√©ter le processus.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-160">
<p>Avant de commencer, vous devrez peut-√™tre installer certains logiciels. Si vous n&#39;avez jamais fait de d√©veloppement logiciel sur l&#39;ordinateur que vous utilisez actuellement, vous devrez probablement installer quelques outils de base. Pour les exemples qui suivent, vous devrez installer git, le syst√®me de gestion du code source¬†; golang, le langage de programmation Go et les biblioth√®ques standard¬†; et Rust, un langage de programmation syst√®me.</p>
</div>
<div class="paragraph data-line-162">
<p>Git peut √™tre install√© en suivant les instructions sur <a href="https://git-scm.com" class="undefined" data-href="https://git-scm.com">https://git-scm.com</a>.</p>
</div>
<div class="paragraph data-line-164">
<p>Go peut √™tre install√© en suivant les instructions sur <a href="https://golang.org" class="undefined" data-href="https://golang.org">https://golang.org</a>, ou <a href="https://github.com/golang/" class="undefined" data-href="https://github.com/golang/">https://github.com/golang/</a> go/wiki/Ubuntu[] si vous utilisez Ubuntu.</p>
</div>
<div class="admonitionblock note data-line-167">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-168">
<p>Les exigences de Geth varient, mais si vous vous en tenez √† Go version 1.10 ou sup√©rieure, vous devriez pouvoir compiler n&#39;importe quelle version de Geth que vous souhaitez. Bien s√ªr, vous devriez toujours vous r√©f√©rer √† la documentation de la version de Geth que vous avez choisie.</p>
</div>
<div class="paragraph data-line-170">
<p>La version de golang install√©e sur votre syst√®me d&#39;exploitation ou disponible √† partir du gestionnaire de packages de votre syst√®me peut √™tre bien ant√©rieure √† la 1.10. Si tel est le cas, supprimez-le et installez la derni√®re version √† partir de <a href="https://golang.org/" class="undefined" data-href="https://golang.org/">https://golang.org/</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-173">
<p>Rust peut √™tre install√© en suivant les instructions sur <a href="https://www.rustup.rs/" class="undefined" data-href="https://www.rustup.rs/">https://www.rustup.rs/</a>.</p>
</div>
<div class="admonitionblock note data-line-176">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-177">
<p>Parity n√©cessite Rust version 1.27 ou sup√©rieure.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-180">
<p>Parity n√©cessite √©galement certaines biblioth√®ques logicielles, telles que OpenSSL et libudev. Pour les installer sur un syst√®me compatible Ubuntu ou Debian GNU/Linux, utilisez la  <span class="keep-together">commande</span> suivante¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>sudo apt-get install openssl libssl-dev libudev-dev cmake clang</strong>

</pre>
<div class="paragraph data-line-189">
<p>Pour les autres syst√®mes d&#39;exploitation, utilisez le gestionnaire d&#8217;applications de votre syst√®me d&#39;exploitation ou suivez les <a href="https://github.com/paritytech/parity/wiki/Setup" class="undefined" data-href="https://github.com/paritytech/parity/wiki/Setup">https://github.com/paritytech/parity/wiki/Setup</a> [instructions Wiki] pour installer les biblioth√®ques requises.</p>
</div>
<div class="paragraph data-line-191">
<p>Maintenant que vous avez install√© git, golang, Rust et les biblioth√®ques n√©cessaires, mettons-nous au travail¬†!</p>
</div>
</div>
<div class="sect3 data-line-194">
<h4 id="parity">Parity</h4>
<div class="paragraph data-line-196">
<p>Parity est une impl√©mentation d&#39;un client Ethereum √† n≈ìud complet et d&#39;un navigateur DApp. Il a √©t√© √©crit ¬´ √† partir de z√©ro ¬ª en Rust, un langage de programmation syst√®me, dans le but de cr√©er un client Ethereum modulaire, s√©curis√© et √©volutif. Parity est d√©velopp√© par Parity Tech, une soci√©t√© britannique, et est publi√© sous la licence de logiciel libre GPLv3.</p>
</div>
<div class="admonitionblock note data-line-199">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-200">
<p>Divulgation: L&#39;un des auteurs de ce livre, le Dr Gavin Wood, est le fondateur de Parity Tech et a √©crit une grande partie du client Parity. Parity repr√©sente environ 25% de la base des clients Ethereum install√©s.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-203">
<p>Pour installer Parity, vous pouvez utiliser le gestionnaire d&#8217;applications Rust cargo ou t√©l√©charger le code source depuis GitHub. Le gestionnaire d&#8217;applications t√©l√©charge √©galement le code source, il n&#39;y a donc pas beaucoup de diff√©rence entre les deux options. Dans la section suivante, nous vous montrerons comment t√©l√©charger et compiler Parity vous-m√™me.</p>
</div>
<div class="sect4 data-line-206">
<h5 id="install_parity">Installation de Parity</h5>
<div class="paragraph data-line-208">
<p>Le <a href="https://wiki.parity.io/Setup" data-href="https://wiki.parity.io/Setup">Parity Wiki</a> propose des instructions pour cr√©er Parity dans diff√©rents environnements et conteneurs. Nous allons vous montrer comment cr√©er Parity √† partir de la source. Cela suppose que vous avez d√©j√† install√© Rust en utilisant rustup (voir <a href="#sw_reqs">Configuration logicielle requise pour cr√©er et ex√©cuter un client (n≈ìud)</a>).</p>
</div>
<div class="paragraph data-line-210">
<p>Tout d&#39;abord, r√©cup√©rez le code source sur GitHub¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>git clone https://github.com/paritytech/parity</strong>

</pre>
<div class="paragraph data-line-219">
<p>Passez ensuite au r√©pertoire <em>parity</em> et utilisez cargo pour cr√©er l&#39;ex√©cutable¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>cd parity</strong>
$ <strong>cargo install --path .</strong>

</pre>
<div class="paragraph data-line-229">
<p>Si tout se passe bien, vous devriez voir quelque chose comme :</p>
</div>
<pre data-type="programlisting">
$ <strong>cargo install --path .</strong>
Installing parity-ethereum v2.7.0 (/root/parity)
Updating crates.io index
Updating git repository `https://github.com/paritytech/rust-ctrlc.git`
Updating git repository `https://github.com/paritytech/app-dirs-rs`   Updating git repository

[...]

Compiling parity-ethereum v2.7.0 (/root/parity)
Finished release [optimized] target(s) in 10m 16s
Installing /root/.cargo/bin/parity
Installed package `parity-ethereum v2.7.0 (/root/parity)` (executable `parity`)
$

</pre>
<div class="paragraph data-line-250">
<p>Essayez d&#39;ex√©cuter parity pour voir s&#39;il est install√©, en invoquant l&#39;option --version¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>parity --version</strong>
Parity Ethereum Client.
  version Parity-Ethereum/v2.7.0-unstable-b69a33b3a-20200124/x86_64-unknown-linux-gnu/rustc1.40.0
Copyright 2015-2020 Parity Technologies (UK) Ltd.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

By Wood/Paronyan/Kotewicz/Drwiƒôga/Volf/Greeff
   Habermeier/Czaban/Gotchac/Redman/Nikolsky
   Schoedon/Tang/Adolfsson/Silva/Palm/Hirsz et al.
$

</pre>
<div class="paragraph data-line-271">
<p>G√©nial! Maintenant que Parity est install√©, vous pouvez synchroniser la cha√Æne de blocs et commencer avec quelques options de ligne de commande de base.</p>
</div>
</div>
</div>
<div class="sect3 data-line-274">
<h4 id="go_ethereum_geth">Go-Ethereum (Geth)</h4>
<div class="paragraph data-line-276">
<p>Geth est l&#39;impl√©mentation avec le langage Go activement d√©velopp√©e par la Fondation Ethereum, elle est donc consid√©r√©e comme l&#39;impl√©mentation &quot;officielle&quot; du client Ethereum. En r√®gle g√©n√©rale, chaque cha√Æne de blocs bas√©e sur Ethereum aura sa propre impl√©mentation Geth. Si vous utilisez Geth, assurez-vous de r√©cup√©rer la bonne version pour votre cha√Æne de blocs en utilisant l&#39;un des liens de r√©f√©rentiel suivants¬†:</p>
</div>
<div class="ulist data-line-279">
<ul>
<li class="data-line-279">
<p><a href="https://github.com/ethereum/go-ethereum" data-href="https://github.com/ethereum/go-ethereum">Ethereum</a> (or <a href="https://geth.ethereum.org/" class="undefined" data-href="https://geth.ethereum.org/">https://geth.ethereum.org/</a>)</p>
</li>
<li class="data-line-281">
<p><a href="https://github.com/etclabscore/go-ethereum" data-href="https://github.com/etclabscore/go-ethereum">Ethereum Classic</a></p>
</li>
<li class="data-line-283">
<p><a href="https://github.com/ellaism/go-ellaism" data-href="https://github.com/ellaism/go-ellaism">Ellaism</a></p>
</li>
<li class="data-line-285">
<p><a href="https://github.com/expanse-org/go-expanse" data-href="https://github.com/expanse-org/go-expanse">Expanse</a></p>
</li>
<li class="data-line-287">
<p><a href="https://github.com/Musicoin/go-musicoin" data-href="https://github.com/Musicoin/go-musicoin">Musicoin</a></p>
</li>
<li class="data-line-289">
<p><a href="https://github.com/ubiq/go-ubiq" data-href="https://github.com/ubiq/go-ubiq">Ubiq</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-292">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-293">
<p>Vous pouvez √©galement ignorer ces instructions et installer un binaire pr√©compil√© pour la plate-forme de votre choix. Les versions pr√©compil√©es sont beaucoup plus faciles √† installer et peuvent √™tre trouv√©es dans la section &quot;versions&quot; de l&#39;un des r√©f√©rentiels r√©pertori√©s ici. Cependant, vous pouvez en apprendre davantage en t√©l√©chargeant et en compilant le logiciel vous-m√™me.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-297">
<h5 id="cloning_repo">Cloner le r√©f√©rentiel</h5>
<div class="paragraph data-line-299">
<p>La premi√®re √©tape consiste √† cloner le r√©f√©rentiel Git, pour obtenir une copie du code source.</p>
</div>
<div class="paragraph data-line-301">
<p>Pour cr√©er un clone local de votre r√©f√©rentiel choisi, utilisez la commande git comme suit, dans votre r√©pertoire personnel ou sous n&#39;importe quel r√©pertoire que vous utilisez pour le d√©veloppement¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>git clone &lt;Lien vers le r√©f√©rentiel&gt;</strong>

</pre>
<div class="paragraph data-line-310">
<p>Vous devriez voir un rapport de progression au fur et √† mesure que le r√©f√©rentiel est copi√© sur votre syst√®me local¬†:</p>
</div>
<div id="cloning_status" class="listingblock data-line-313">
<div class="content">
<pre>Cloning into 'go-ethereum'...
remote: Enumerating objects: 86915, done.
remote: Total 86915 (delta 0), reused 0 (delta 0), pack-reused 86915
Receiving objects: 100% (86915/86915), 134.73 MiB | 29.30 MiB/s, done.
Resolving deltas: 100% (57590/57590), done.</pre>
</div>
</div>
<div class="paragraph data-line-321">
<p>G√©nial! Maintenant que vous avez une copie locale de Geth, vous pouvez compiler un ex√©cutable pour votre plate-forme.</p>
</div>
</div>
<div class="sect4 data-line-324">
<h5 id="build_geth_src">Construire Geth √† partir du code source</h5>
<div class="paragraph data-line-326">
<p>Pour compiler Geth, allez dans le r√©pertoire o√π le code source a √©t√© t√©l√©charg√© et utilisez la commande make¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>cd go-ethereum</strong>
$ <strong>make geth</strong>

</pre>
<div class="paragraph data-line-336">
<p>Si tout se passe bien, vous verrez le compilateur Go construire chaque composant jusqu&#39;√† ce qu&#39;il produise l&#39;ex√©cutable geth¬†:</p>
</div>
<div id="making_geth_status" class="listingblock data-line-339">
<div class="content">
<pre>build/env.sh go run build/ci.go install ./cmd/geth
&gt;&gt;&gt; /usr/local/go/bin/go install -ldflags -X main.gitCommit=58a1e13e6dd7f52a1d...
github.com/ethereum/go-ethereum/common/hexutil
github.com/ethereum/go-ethereum/common/math
github.com/ethereum/go-ethereum/crypto/sha3
github.com/ethereum/go-ethereum/rlp
github.com/ethereum/go-ethereum/crypto/secp256k1
github.com/ethereum/go-ethereum/common
[...]
github.com/ethereum/go-ethereum/cmd/utils
github.com/ethereum/go-ethereum/cmd/geth
Done building.
Ex√©cutez &amp;quot;build/bin/geth&amp;quot; pour ex√©cuter geth.
$</pre>
</div>
</div>
<div class="paragraph data-line-356">
<p>Assurons-nous que geth fonctionne sans l&#8217;excuter :</p>
</div>
<pre data-type="programlisting">
$ <strong>./build/bin/geth version</strong>

Geth
Version: 1.9.11-unstable
Git Commit: 0b284f6c6cfc6df452ca23f9454ee16a6330cb8e
Git Commit Date: 20200123
Architecture: amd64
Protocol Versions: [64 63]
Go Version: go1.13.4
Operating System: linux
[...]

</pre>
<div class="paragraph data-line-375">
<p>Votre commande geth version peut afficher des informations l√©g√®rement diff√©rentes, mais vous devriez voir un rapport de version similaire √† celui pr√©sent√© ici.</p>
</div>
<div class="paragraph data-line-377">
<p>Les sections suivantes expliquent le d√©fi avec la synchronisation initiale de la cha√Æne de blocs d&#39;Ethereum.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-381">
<h3 id="first_sync">La premi√®re synchronisation des cha√Ænes de blocs bas√©es sur Ethereum</h3>
<div class="paragraph data-line-383">
<p>Traditionnellement, lors de la synchronisation d&#8217;une cha√Æne de blocs Ethereum, votre client t√©l√©chargerait et validerait chaque bloc et chaque transaction depuis le tout d√©but, c&#39;est-√†-dire depuis le bloc de gen√®se.</p>
</div>
<div class="paragraph data-line-385">
<p>Bien qu&#39;il soit possible de synchroniser enti√®rement la cha√Æne de blocs de cette fa√ßon, ce type de synchronisation prendra tr√®s longtemps et n√©cessite beaucoup de ressources (il n√©cessitera beaucoup plus de RAM, et prendra en effet tr√®s longtemps si vous n&#39;avez pas stockage).</p>
</div>
<div class="paragraph data-line-387">
<p>De nombreuses cha√Ænes de blocs bas√©es sur Ethereum ont √©t√© victimes d&#39;attaques par d√©ni de service fin 2016. Les cha√Ænes de blocs concern√©es auront tendance √† se synchroniser lentement lors d&#39;une synchronisation compl√®te.</p>
</div>
<div class="paragraph data-line-389">
<p>Par exemple, sur Ethereum, un nouveau client progressera rapidement jusqu&#39;√† atteindre le bloc 2 283 397. Ce bloc a √©t√© min√© le 18 septembre 2016 et marque le d√©but des attaques DoS. De ce bloc au bloc 2 700 031 (26 novembre 2016), la validation des transactions devient extr√™mement lente, gourmande en m√©moire et gourmande en E/S. Cela se traduit par des temps de validation sup√©rieurs √† 1 minute par bloc. Ethereum a mis en ≈ìuvre une s√©rie de mises √† niveau, √† l&#39;aide d&#8217;embranchements divergents, pour rem√©dier aux vuln√©rabilit√©s sous-jacentes qui ont √©t√© exploit√©es dans les attaques DoS. Ces mises √† niveau ont √©galement nettoy√© la cha√Æne de blocs en supprimant quelque 20 millions de comptes vides cr√©√©s par des transactions de spam.</p>
</div>
<div class="paragraph data-line-391">
<p>Si vous synchronisez avec une validation compl√®te, votre client ralentira et peut prendre plusieurs jours, voire plus, pour valider les blocs affect√©s par les attaques DoS.</p>
</div>
<div class="paragraph data-line-393">
<p>Heureusement, la plupart des clients Ethereum effectuent d√©sormais par d√©faut une synchronisation &quot;rapide&quot; qui ignore la validation compl√®te des transactions jusqu&#39;√† ce qu&#39;elle soit synchronis√©e avec la pointe de la cha√Æne de blocs, puis reprend la validation compl√®te.</p>
</div>
<div class="paragraph data-line-395">
<p>Geth effectue une synchronisation rapide par d√©faut pour Ethereum. Vous devrez peut-√™tre vous r√©f√©rer aux instructions sp√©cifiques pour l&#39;autre cha√Æne Ethereum choisie.</p>
</div>
<div class="paragraph data-line-397">
<p>Parity effectue √©galement une synchronisation rapide par d√©faut.</p>
</div>
<div class="admonitionblock note data-line-400">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-401">
<p>Geth ne peut op√©rer une synchronisation rapide que lorsqu&#39;il d√©marre avec une base de donn√©es de blocs vide. Si vous avez d√©j√† commenc√© la synchronisation sans mode rapide, Geth ne peut pas basculer de mode. Il est plus rapide de supprimer le r√©pertoire de donn√©es de la cha√Æne de blocs et de commencer la synchronisation rapide depuis le d√©but que de continuer la synchronisation avec une validation compl√®te. Veillez √† ne supprimer aucun portefeuille lors de la suppression des donn√©es de la cha√Æne de blocs¬†!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-404">
<h4 id="_ex√©cuter_geth_ou_parity">Ex√©cuter Geth ou Parity</h4>
<div class="paragraph data-line-406">
<p>Maintenant que vous comprenez les d√©fis de la &quot;premi√®re synchronisation&quot;, vous √™tes pr√™t √† d√©marrer un client Ethereum et √† synchroniser la cha√Æne de blocs. Pour Geth et Parity, vous pouvez utiliser l&#39;option --help pour voir tous les param√®tres de configuration. Les param√®tres par d√©faut sont g√©n√©ralement judicieux et appropri√©s pour la plupart des utilisations. Choisissez comment configurer les param√®tres facultatifs en fonction de vos besoins, puis d√©marrez Geth ou Parity pour synchroniser la cha√Æne. Puis attendre&#8230;&#8203;</p>
</div>
<div class="admonitionblock tip data-line-409">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-410">
<p>La synchronisation de la cha√Æne de blocs Ethereum prendra entre une demi-journ√©e sur un syst√®me tr√®s rapide avec beaucoup de RAM et plusieurs jours sur un syst√®me plus lent.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-414">
<h4 id="json_rpc">L&#39;interface JSON-RPC</h4>
<div class="paragraph data-line-416">
<p>Les clients Ethereum offrent une interface de programmation d&#39;application et un ensemble de commandes Remote Procedure Call (RPC), qui sont encod√©es en JavaScript Object Notation (JSON). Vous verrez cela appel√© <em>API JSON-RPC</em>. Essentiellement, l&#39;API JSON-RPC est une interface qui nous permet d&#39;√©crire des programmes qui utilisent un client Ethereum comme <em>passerelle</em> vers un r√©seau Ethereum et une cha√Æne de blocs.</p>
</div>
<div class="paragraph data-line-418">
<p>Habituellement, l&#39;interface RPC est propos√©e en tant que service HTTP sur le port 8545. Pour des raisons de s√©curit√©, il est restreint, par d√©faut, de n&#39;accepter que les connexions de localhost (l&#39;adresse IP de votre propre ordinateur, qui est 127.0.0.1).</p>
</div>
<div class="paragraph data-line-420">
<p>Pour acc√©der √† l&#39;API JSON-RPC, vous pouvez utiliser une biblioth√®que sp√©cialis√©e (√©crite dans le langage de programmation de votre choix) qui fournit des appels de fonction &quot;stub&quot; correspondant √† chaque commande RPC disponible, ou vous pouvez construire manuellement des requ√™tes HTTP et envoyer/recevoir des requ√™tes cod√©es en JSON. Vous pouvez m√™me utiliser un client HTTP de ligne de commande g√©n√©rique, comme curl, pour appeler l&#39;interface RPC. Essayons √ßa. Tout d&#39;abord, assurez-vous que Geth est op√©rationnel, configur√© avec --rpc pour autoriser l&#39;acc√®s HTTP √† l&#39;interface RPC, puis passez √† une nouvelle fen√™tre de terminal (par exemple, avec Ctrl-Maj-N ou Ctrl-Maj-T dans un fen√™tre de terminal) comme indiqu√© ici¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>curl -X POST -H "Content-Type: application/json" --data \
  '{"jsonrpc":"2.0","method":"web3_clientVersion","params":[],"id":1}' \
  http://localhost:8545</strong>

{"jsonrpc":"2.0","id":1,
"result":"Geth/v1.9.11-unstable-0b284f6c-20200123/linux-amd64/go1.13.4"}

</pre>
<div class="paragraph data-line-434">
<p>Dans cet exemple, nous utilisons curl pour √©tablir une connexion HTTP √† l&#39;adresse <em><a href="http://localhost:8545" class="undefined" data-href="http://localhost:8545">http://localhost:8545</a></em>. Nous ex√©cutons d√©j√† geth, qui propose l&#39;API JSON-RPC en tant que service HTTP sur le port 8545. Nous demandons √† curl d&#39;utiliser la commande HTTP POST et d&#39;identifier le contenu en tant que type application/json. Enfin, nous transmettons une requ√™te encod√©e en JSON en tant que composant data de notre requ√™te HTTP. La majeure partie de notre ligne de commande consiste simplement √† configurer curl pour √©tablir correctement la connexion HTTP. La partie int√©ressante est la commande JSON-RPC que nous √©mettons¬†:</p>
</div>
<div id="JSON_RPC_command" class="listingblock data-line-437">
<div class="content">
<pre>{"jsonrpc":"2.0","method":"web3_clientVersion","params":[],"id":1}</pre>
</div>
</div>
<div class="paragraph data-line-441">
<p>La requ√™te JSON-RPC est format√©e conform√©ment √† la <a href="https://www.jsonrpc.org/specification" class="undefined" data-href="https://www.jsonrpc.org/specification">https://www.jsonrpc.org/specification</a> [sp√©cification JSON-RPC 2.0]. Chaque demande contient quatre √©l√©ments¬†:</p>
</div>
<div class="dlist data-line-443">
<dl>
<dt class="hdlist1">jsonrpc </dt>
<dd>
<p>Version du protocole JSON-RPC. Cela DOIT √™tre exactement &amp;quot;2.0&amp;quot;.</p>
</dd>
<dt class="hdlist1">method </dt>
<dd>
<p>Le nom de la m√©thode √† invoquer.</p>
</dd>
<dt class="hdlist1">params </dt>
<dd>
<p>Une valeur structur√©e qui contient les valeurs de param√®tre √† utiliser lors de l&#39;invocation de la m√©thode. Ce membre PEUT √™tre omis.</p>
</dd>
<dt class="hdlist1">id </dt>
<dd>
<p>Un identifiant √©tabli par le client qui DOIT contenir une valeur String, Number ou NULL si elle est incluse. Le serveur DOIT r√©pondre avec la m√™me valeur dans l&#39;objet de r√©ponse s&#39;il est inclus. Ce membre est utilis√© pour corr√©ler le contexte entre les deux objets.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip data-line-452">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-453">
<p>Le param√®tre id est principalement utilis√© lorsque vous effectuez plusieurs requ√™tes dans un seul appel JSON-RPC, une pratique appel√©e <em>batching</em>. Le traitement par lots est utilis√© pour √©viter la surcharge d&#39;une nouvelle connexion HTTP et TCP pour chaque requ√™te. Dans le contexte Ethereum, par exemple, nous utiliserions le traitement par lots si nous voulions r√©cup√©rer des milliers de transactions sur une seule connexion HTTP. Lors du traitement par lots, vous d√©finissez un id diff√©rent pour chaque demande, puis le faites correspondre au id dans chaque r√©ponse du serveur JSON-RPC. Le moyen le plus simple d&#39;impl√©menter ceci est de maintenir un compteur et d&#39;incr√©menter la valeur pour chaque demande.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-457">
<p>La r√©ponse que nous recevons est :</p>
</div>
<div class="listingblock data-line-459">
<div class="content">
<pre>{"jsonrpc":"2.0","id":1,
"result":"Geth/v1.9.11-unstable-0b284f6c-20200123/linux-amd64/go1.13.4"}</pre>
</div>
</div>
<div class="paragraph data-line-464">
<p>Cela nous indique que l&#39;API JSON-RPC est servie par la version 1.13.4 du client Geth.</p>
</div>
<div class="paragraph data-line-466">
<p>Essayons quelque chose d&#39;un peu plus int√©ressant. Dans l&#39;exemple suivant, nous demandons √† l&#39;API JSON-RPC le prix actuel du gaz en wei¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>curl -X POST -H "Content-Type: application/json" --data \
  '{"jsonrpc":"2.0","method":"eth_gasPrice","params":[],"id":4213}' \
  http://localhost:8545</strong>

{"jsonrpc":"2.0","id":4213,"result":"0x430e23400"}

</pre>
<div class="paragraph data-line-479">
<p>La r√©ponse, 0x430e23400, nous indique que le prix actuel du gaz est de 18 gwei (gigawei ou milliard de wei). Si, comme nous, vous ne pensez pas en hexad√©cimal, vous pouvez le convertir en d√©cimal sur la ligne de commande avec un petit bash-fu :</p>
</div>
<pre data-type="programlisting">
$ <strong>echo $((0x430e23400))</strong>

18000000000

</pre>
<div class="paragraph data-line-490">
<p>L&#39;API JSON-RPC compl√®te peut √™tre √©tudi√©e sur le <a href="https://github.com/ethereum/wiki/wiki/JSON-RPC" data-href="https://github.com/ethereum/wiki/wiki/JSON-RPC">wiki Ethereum</a>.</p>
</div>
<div class="sect4 data-line-493">
<h5 id="parity_compatibility_mode">Mode de compatibilit√© Geth de Parity</h5>
<div class="paragraph data-line-495">
<p>Parity a un &quot;mode de compatibilit√© Geth&quot; sp√©cial, o√π il offre une API JSON-RPC identique √† celle offerte par Geth. Pour ex√©cuter Parity dans ce mode, utilisez le commutateur --geth:</p>
</div>
<pre data-type="programlisting">
$ <strong>parity --geth</strong>

</pre>
</div>
</div>
</div>
<div class="sect2 data-line-505">
<h3 id="lw_eth_clients">Clients Ethereum distants</h3>
<div class="paragraph data-line-507">
<p>Les clients distants offrent un sous-ensemble des fonctionnalit√©s d&#39;un client complet. Ils ne stockent pas la cha√Æne de blocs Ethereum compl√®te, ils sont donc plus rapides √† configurer et n√©cessitent beaucoup moins de stockage de donn√©es.</p>
</div>
<div class="paragraph pagebreak-before data-line-510">
<p>Ces clients offrent g√©n√©ralement la possibilit√© d&#39;effectuer une ou plusieurs des actions suivantes¬†:</p>
</div>
<div class="ulist data-line-512">
<ul>
<li class="data-line-512">
<p>G√©rer les cl√©s priv√©es et les adresses Ethereum dans un portefeuille.</p>
</li>
<li class="data-line-513">
<p>Cr√©er, signer et diffuser des transactions.</p>
</li>
<li class="data-line-514">
<p>Interagir avec les contrats intelligents, en utilisant la charge utile des donn√©es.</p>
</li>
<li class="data-line-515">
<p>Naviguer et interagir avec les DApps.</p>
</li>
<li class="data-line-516">
<p>Offrir des liens vers des services externes tels que des explorateurs de blocs.</p>
</li>
<li class="data-line-517">
<p>Convertir les unit√©s d&#39;ether et r√©cup√©rer les taux de change √† partir de sources externes.</p>
</li>
<li class="data-line-518">
<p>Injecter une instance web3 dans le navigateur Web en tant qu&#39;objet JavaScript.</p>
</li>
<li class="data-line-519">
<p>Utiliser une instance web3 fournie/inject√©e dans le navigateur par un autre client.</p>
</li>
<li class="data-line-520">
<p>Acc√©der aux services RPC sur un n≈ìud Ethereum local ou distant.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-522">
<p>Certains clients distants, par exemple les portefeuilles mobiles (smartphones), n&#39;offrent que des fonctionnalit√©s de portefeuille de base. Les autres clients distants sont des navigateurs DApp √† part enti√®re. Les clients distants offrent g√©n√©ralement certaines des fonctions d&#39;un client Ethereum √† n≈ìud complet sans synchroniser une copie locale de la cha√Æne de blocs Ethereum en se connectant √† un n≈ìud complet ex√©cut√© ailleurs, par exemple, par vous localement sur votre machine ou sur un serveur Web, ou par un tiers sur leurs serveurs.</p>
</div>
<div class="paragraph data-line-524">
<p>Examinons certains des clients distants les plus populaires et les fonctions qu&#39;ils offrent.</p>
</div>
<div class="sect3 data-line-527">
<h4 id="mobile_wallets">Portefeuilles mobiles (Smartphone)</h4>
<div class="paragraph data-line-529">
<p>Tous les portefeuilles mobiles sont des clients distants, car les t√©l√©phones intelligents ne disposent pas des ressources ad√©quates pour ex√©cuter un client Ethereum complet. Les clients l√©gers sont en d√©veloppement et ne sont pas g√©n√©ralement utilis√©s pour Ethereum. Dans le cas de Parity, le client l√©ger est marqu√© &quot;exp√©rimental&quot; et peut √™tre utilis√© en ex√©cutant parity avec l&#39;option --light.</p>
</div>
<div class="paragraph data-line-531">
<p>Les portefeuilles mobiles populaires incluent les √©l√©ments suivants (nous les √©num√©rons simplement √† titre d&#39;exemples¬†; il ne s&#39;agit pas d&#39;une approbation ou d&#39;une indication de la s√©curit√© ou de la fonctionnalit√© de ces portefeuilles)¬†:</p>
</div>
<div class="dlist data-line-533">
<dl>
<dt class="hdlist1"><a href="https://jaxx.io" data-href="https://jaxx.io">Jaxx</a></dt>
<dd>
<p>Un portefeuille mobile multidevises bas√© sur les valeurs mn√©moniques BIP-39, avec prise en charge de Bitcoin, Litecoin, Ethereum, Ethereum Classic, ZCash, une vari√©t√© de jetons ERC20 et de nombreuses autres devises. Jaxx est disponible sur Android et iOS, en tant que portefeuille de plug-in de navigateur et en tant que portefeuille de bureau pour une vari√©t√© de syst√®mes d&#39;exploitation.</p>
</dd>
<dt class="hdlist1"><a href="https://status.im" data-href="https://status.im">Status</a></dt>
<dd>
<p>Un portefeuille mobile et un navigateur DApp, avec prise en charge d&#39;une vari√©t√© de jetons et de DApps populaires. Disponible pour iOS et Android.</p>
</dd>
<dt class="hdlist1"><a href="https://trustwalletapp.com/" data-href="https://trustwalletapp.com/">Trust Wallet</a></dt>
<dd>
<p>Un portefeuille mobile multi-devises qui prend en charge Ethereum et Ethereum Classic ainsi que les jetons ERC20 et ERC223. Trust Wallet est disponible pour iOS et Android.</p>
</dd>
<dt class="hdlist1"><a href="https://www.cipherbrowser.com" data-href="https://www.cipherbrowser.com">Cipher Browser</a></dt>
<dd>
<p> Un navigateur et un portefeuille DApp mobile complet compatible avec Ethereum qui permet l&#39;int√©gration avec les applications et les jetons Ethereum. Disponible pour iOS et Android.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-542">
<h4 id="browser_wallets">Portefeuilles de navigateur</h4>
<div class="paragraph data-line-544">
<p>Une vari√©t√© de portefeuilles et de navigateurs DApp sont disponibles en tant que plug-ins ou extensions de navigateurs Web tels que Chrome et Firefox. Ce sont des clients distants qui s&#39;ex√©cutent dans votre navigateur.</p>
</div>
<div class="paragraph data-line-546">
<p>Certains des plus populaires sont MetaMask, Jaxx, MyEtherWallet et MyCrypto.</p>
</div>
<div class="sect4 data-line-549">
<h5 id="MetaMask">MetaMask</h5>
<div class="paragraph data-line-551">
<p><a href="https://metamask.io/" data-href="https://metamask.io/">MetaMask</a>, introduit dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, est un portefeuille polyvalent bas√© sur un navigateur, un client RPC et un explorateur de contrats de base. Il est disponible sur Chrome, Firefox, Opera et Brave Browser.</p>
</div>
<div class="paragraph data-line-553">
<p>Contrairement aux autres portefeuilles de navigateur, MetaMask injecte une instance web3 dans le contexte JavaScript du navigateur, agissant comme un client RPC qui se connecte √† une vari√©t√© de cha√Ænes de blocs Ethereum (mainnet, Ropsten testnet, Kovan testnet, n≈ìud RPC local, etc.). La possibilit√© d&#39;injecter une instance web3 et d&#39;agir comme une passerelle vers des services RPC externes fait de MetaMask un outil tr√®s puissant pour les d√©veloppeurs et les utilisateurs. Il peut √™tre combin√©, par exemple, avec MyEtherWallet ou MyCrypto, agissant comme un fournisseur web3 et une passerelle RPC pour ces outils.</p>
</div>
</div>
<div class="sect4 data-line-556">
<h5 id="Jaxx">Jaxx</h5>
<div class="paragraph data-line-558">
<p><a href="https://jaxx.io" data-href="https://jaxx.io">Jaxx</a>, qui a √©t√© pr√©sent√© comme un portefeuille mobile dans la section pr√©c√©dente, est √©galement disponible en tant qu&#39;extension Chrome et Firefox et en tant que portefeuille de bureau.</p>
</div>
</div>
<div class="sect4 data-line-561">
<h5 id="MEW">MyEtherWallet (MEW)</h5>
<div class="paragraph data-line-563">
<p><a href="https://www.myetherwallet.com/" data-href="https://www.myetherwallet.com/">MyEtherWallet</a>  est un client distant JavaScript bas√© sur un navigateur qui offre¬†:</p>
</div>
<div class="ulist data-line-565">
<ul>
<li class="data-line-565">
<p>Un pont vers les portefeuilles mat√©riels populaires tels que Trezor et Ledger</p>
</li>
<li class="data-line-566">
<p>Une interface web3 pouvant se connecter √† une instance web3 inject√©e par un autre client (par exemple, MetaMask)</p>
</li>
<li class="data-line-567">
<p>Un client RPC pouvant se connecter √† un client complet Ethereum</p>
</li>
<li class="data-line-568">
<p>Une interface de base qui peut interagir avec des contrats intelligents, √©tant donn√© l&#39;adresse d&#39;un contrat et l&#39;interface binaire d&#39;application (ABI)</p>
</li>
<li class="data-line-569">
<p>Une application mobile, MEWConnect, qui permet d&#39;utiliser un appareil Android ou iOS compatible pour stocker des fonds, de la m√™me mani√®re qu&#39;un portefeuille mat√©riel.</p>
</li>
<li class="data-line-570">
<p>Un portefeuille logiciel fonctionnant en JavaScript</p>
</li>
</ul>
</div>
<div class="admonitionblock warning data-line-573">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-574">
<p>Vous devez √™tre tr√®s prudent lorsque vous acc√©dez √† MyEtherWallet et √† d&#39;autres portefeuilles JavaScript bas√©s sur un navigateur, car ils sont des cibles fr√©quentes pour le phishing. Utilisez toujours un signet et non un moteur de recherche ou un lien pour acc√©der √† l&#39;URL Web correcte.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-578">
<h5 id="MyCrypto">MyCrypto</h5>
<div class="paragraph data-line-580">
<p>D√©but 2018, le  projet MyEtherWallet s&#39;est scind√© en deux impl√©mentations concurrentes, guid√©es par deux √©quipes de d√©veloppement ind√©pendantes¬†: une &quot;fourche&quot; ou &quot;fork&quot;, comme on l&#39;appelle dans le d√©veloppement √† source libre. Les deux projets s&#39;appellent MyEtherWallet (la marque originale) et <a href="https://mycrypto.com/" data-href="https://mycrypto.com/">MyCrypto</a>. MyCrypto offre des fonctionnalit√©s presque identiques √† MyEtherWallet, mais au lieu d&#39;utiliser MEWConnect, il offre une connexion √† l&#39;application mobile Parity Signer. Comme MEWConnect, Parity Signer stocke les cl√©s sur le t√©l√©phone et s&#39;interface avec MyCrypto de la m√™me mani√®re qu&#39;un portefeuille mat√©riel.</p>
</div>
</div>
<div class="sect4 data-line-583">
<h5 id="Mist">Mist (obsol√®te)</h5>
<div class="paragraph data-line-585">
<p><a href="https://github.com/ethereum/mist" data-href="https://github.com/ethereum/mist">Mist</a> √©tait le premier navigateur compatible avec Ethereum, construit par la Fondation Ethereum. Il contenait un portefeuille bas√© sur un navigateur qui √©tait la premi√®re impl√©mentation de la norme de jeton ERC20 (Fabian Vogelsteller, auteur d&#39;ERC20, √©tait √©galement le principal d√©veloppeur de Mist). Mist a √©galement √©t√© le premier portefeuille √† introduire la somme de contr√¥le camelCase (EIP-55). Depuis mars 2019, Mist est obsol√®te et ne doit plus √™tre utilis√©.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-587">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph data-line-9">
<p>Dans ce chapitre, nous avons explor√© les clients Ethereum. Vous avez t√©l√©charg√©, install√© et synchronis√© un client, devenant un participant au r√©seau Ethereum et contribuant √† la sant√© et √† la stabilit√© du syst√®me en r√©pliquant la cha√Æne de blocs sur votre propre ordinateur.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="keys_addresses">Cryptographie</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>L&#39;une des technologies fondamentales d&#39;Ethereum est la <em>cryptographie</em>, qui est une branche des math√©matiques largement utilis√©es en s√©curit√© informatique. La cryptographie signifie &quot;√©criture secr√®te&quot; en grec, mais l&#39;√©tude de la cryptographie englobe plus que la simple √©criture secr√®te, appel√©e <em>cryptage</em>. La cryptographie peut, par exemple, √©galement √™tre utilis√©e pour prouver la connaissance d&#39;un secret sans le r√©v√©ler (par exemple, avec une signature num√©rique), ou pour prouver l&#39;authenticit√© des donn√©es (par exemple, avec des empreintes digitales, √©galement appel√©es &quot;hachages&quot;). Ces types de preuves cryptographiques sont des outils math√©matiques essentiels au fonctionnement de la plate-forme Ethereum (et, en fait, de tous les syst√®mes de cha√Æne de blocs), et sont √©galement largement utilis√©s dans les applications Ethereum. </p>
</div>
<div class="paragraph data-line-6">
<p>Notez qu&#39;au moment de la publication, aucune partie du protocole Ethereum n&#39;implique de cryptage¬†; c&#39;est-√†-dire que toutes les communications avec la plateforme Ethereum et entre les n≈ìuds (y compris les donn√©es de transaction) sont non crypt√©es et peuvent (n√©cessairement) √™tre lues par n&#39;importe qui. C&#39;est ainsi que tout le monde peut v√©rifier l&#39;exactitude des mises √† jour d&#39;√©tat et qu&#39;un consensus peut √™tre atteint. √Ä l&#39;avenir, des outils cryptographiques avanc√©s, tels que les preuves √† z√©ro connaissance et le cryptage homomorphe, seront disponibles, ce qui permettra d&#39;enregistrer certains calculs crypt√©s sur la cha√Æne de blocs tout en permettant le consensus¬†; cependant, bien que des dispositions aient √©t√© prises √† leur intention, elles n&#39;ont pas encore √©t√© d√©ploy√©es.</p>
</div>
<div class="paragraph data-line-8">
<p>Dans ce chapitre, nous pr√©senterons une partie de la cryptographie utilis√©e dans Ethereum : √† savoir la cryptographie √† cl√© publique (PKC), qui est utilis√©e pour contr√¥ler la propri√©t√© des fonds, sous la forme de cl√©s priv√©es et d&#39;adresses.</p>
</div>
<div class="sect2 data-line-11">
<h3 id="keys_addresses_intro">Cl√©s et adresses</h3>
<div class="paragraph data-line-13">
<p>Comme nous l&#39;avons vu pr√©c√©demment dans le livre, Ethereum a deux types de comptes diff√©rents¬†: les <em>comptes d√©tenus par des tiers ou en externe</em> (Externally Owned Accounts ou EOA) et les <em>contrats</em>. La propri√©t√© de l&#39;ether par les EOAs est √©tablie par des <em>cl√©s priv√©es</em> num√©riques, des <em>adresses Ethereum</em> et des <em>signatures num√©riques</em>. Les cl√©s priv√©es sont au c≈ìur de toutes les interactions des utilisateurs avec Ethereum. En fait, les adresses de compte sont directement d√©riv√©es des cl√©s priv√©es¬†: une cl√© priv√©e d√©termine de mani√®re unique une seule adresse Ethereum, √©galement appel√©e <em>compte</em>.</p>
</div>
<div class="paragraph data-line-15">
<p>Les cl√©s priv√©es ne sont en aucun cas utilis√©es directement dans le syst√®me Ethereum ; ils ne sont jamais transmis ou stock√©s sur Ethereum. C&#39;est-√†-dire que les cl√©s priv√©es doivent rester priv√©es et ne jamais appara√Ætre dans les messages transmis au r√©seau, ni √™tre stock√©es en cha√Æne¬†; seules les adresses de compte et les signatures num√©riques sont transmises et stock√©es sur le syst√®me Ethereum. Pour plus d&#39;informations sur la mani√®re de conserver les cl√©s priv√©es en toute s√©curit√©, consultez <a href="#control_responsibility">Contr√¥le et responsabilit√©</a> et <a href="#wallets_chapter">Portefeuilles</a>.</p>
</div>
<div class="paragraph data-line-17">
<p>L&#39;acc√®s et le contr√¥le des fonds sont r√©alis√©s avec des signatures num√©riques, qui sont √©galement cr√©√©es √† l&#39;aide de la cl√© priv√©e. Les transactions Ethereum n√©cessitent une signature num√©rique valide pour √™tre incluses dans la cha√Æne de blocs. Toute personne disposant d&#39;une copie d&#39;une cl√© priv√©e a le contr√¥le du compte correspondant et de tout ether qu&#39;il d√©tient. En supposant qu&#39;un utilisateur garde sa cl√© priv√©e en s√©curit√©, les signatures num√©riques dans les transactions Ethereum prouvent le v√©ritable propri√©taire des fonds, car elles prouvent la propri√©t√© de la cl√© priv√©e.</p>
</div>
<div class="paragraph data-line-19">
<p> Dans les syst√®mes bas√©s sur la cryptographie √† cl√© publique, tels que ceux utilis√©s par Ethereum, les cl√©s sont fournies par paires compos√©es d&#39;une cl√© priv√©e (secr√®te) et d&#39;une cl√© publique. Consid√©rez la cl√© publique comme similaire √† un num√©ro de compte bancaire et la cl√© priv√©e comme similaire au code PIN secret¬†; c&#39;est ce dernier qui fournit le contr√¥le sur le compte, et le premier qui l&#39;identifie aux autres. Les cl√©s priv√©es elles-m√™mes sont tr√®s rarement vues par les utilisateurs d&#39;Ethereum ; pour la plupart, ils sont stock√©s (sous forme crypt√©e) dans des fichiers sp√©ciaux et g√©r√©s par le logiciel de portefeuille Ethereum.</p>
</div>
<div class="paragraph data-line-21">
<p>Dans la partie paiement d&#39;une transaction Ethereum, le destinataire pr√©vu est repr√©sent√© par une adresse Ethereum, qui est utilis√©e de la m√™me mani√®re que les d√©tails du compte b√©n√©ficiaire d&#39;un virement bancaire. Comme nous le verrons plus en d√©tail sous peu, une adresse Ethereum pour un EOA est g√©n√©r√©e √† partir de la partie cl√© publique d&#39;une paire de cl√©s. Cependant, toutes les adresses Ethereum ne repr√©sentent pas des paires de cl√©s publiques-priv√©es ; ils peuvent aussi repr√©senter des contrats, qui, comme nous le verrons dans <a href="#smart_contracts_chapter">Contrats intelligents et Solidity</a>, ne sont pas soutenus par des cl√©s priv√©es.</p>
</div>
<div class="paragraph data-line-23">
<p>Dans le reste de ce chapitre, nous allons d&#39;abord explorer la cryptographie de base un peu plus en d√©tail et expliquer les math√©matiques utilis√©es dans Ethereum. Ensuite, nous verrons comment les cl√©s sont g√©n√©r√©es, stock√©es et g√©r√©es. Enfin, nous passerons en revue les diff√©rents formats d&#39;encodage utilis√©s pour repr√©senter les cl√©s priv√©es, les cl√©s publiques et les adresses.</p>
</div>
</div>
<div class="sect2 data-line-26">
<h3 id="pkc">Cryptographie √† cl√© publique et cryptomonnaie</h3>
<div class="paragraph data-line-28">
<p>La cryptographie √† cl√© publique (√©galement appel√©e &quot;cryptographie asym√©trique&quot;) est un √©l√©ment central de la s√©curit√© de l&#39;information moderne. Le protocole d&#39;√©change de cl√©, d&#39;abord publi√© dans les ann√©es 1970 par Martin Hellman, Whitfield Diffie et Ralph Merkle, a √©t√© une perc√©e monumentale qui a suscit√© la premi√®re grande vague d&#39;int√©r√™t public dans le domaine de la cryptographie. Avant les ann√©es 1970, de solides connaissances cryptographiques √©taient gard√©es secr√®tes par <span class="keep-together">les gouvernements</span>.</p>
</div>
<div class="paragraph data-line-30">
<p>La cryptographie √† cl√© publique utilise des cl√©s uniques pour s√©curiser les informations. Ces cl√©s sont bas√©es sur des fonctions math√©matiques qui ont une propri√©t√© particuli√®re : il est facile de les calculer, mais difficile de calculer leur inverse. Sur la base de ces fonctions, la cryptographie permet la cr√©ation de secrets num√©riques et de signatures num√©riques infalsifiables, qui sont s√©curis√©es par les lois des math√©matiques.</p>
</div>
<div class="paragraph data-line-32">
<p>Par exemple, multiplier deux grands nombres premiers ensemble est trivial. Mais √©tant donn√© le produit de deux grands nombres premiers, il est tr√®s difficile de trouver les facteurs premiers (un probl√®me appel√© <em>factorisation primaire ou premi√®re</em>). Disons que nous pr√©sentons le nombre 8 018 009 et que nous vous disons qu&#39;il est le produit de deux nombres premiers. Trouver ces deux nombres premiers est beaucoup plus difficile pour vous que pour moi de les multiplier pour produire 8 018 009.</p>
</div>
<div class="paragraph data-line-34">
<p>Certaines de ces fonctions math√©matiques peuvent √™tre facilement invers√©es si vous connaissez des informations secr√®tes. Dans l&#39;exemple pr√©c√©dent, si je vous dis que l&#39;un des facteurs premiers est 2 003, vous pouvez trivialement trouver l&#39;autre avec une simple division : 8 018 009 √∑ 2 003 = 4 003. Ces fonctions sont souvent appel√©es <em>fonctions de trappe</em> car elles sont tr√®s difficiles √† inverser √† moins que vous ne receviez une information secr√®te qui peut √™tre utilis√©e comme raccourci pour inverser la fonction.</p>
</div>
<div class="paragraph data-line-36">
<p>Une cat√©gorie plus avanc√©e de fonctions math√©matiques utiles en cryptographie est bas√©e sur des op√©rations arithm√©tiques sur une courbe elliptique. Dans l&#39;arithm√©tique des courbes elliptiques, la multiplication modulo d&#8217;un nombre premier est simple mais la division (l&#39;inverse) est pratiquement impossible.  C&#39;est ce qu&#39;on appelle le <em>probl√®me de logarithme discret</em> et il n&#39;y a actuellement aucune trappe connue. La <em>cryptographie √† courbe elliptique</em> est largement utilis√©e dans les syst√®mes informatiques modernes et constitue la base de l&#39;utilisation par Ethereum (et d&#39;autres cryptomonnaies) des cl√©s priv√©es et des signatures num√©riques.</p>
</div>
<div class="admonitionblock note data-line-39">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-40">
<p>Consultez les ressources suivantes si vous souhaitez en savoir plus sur la cryptographie et les fonctions math√©matiques utilis√©es dans la cryptographie moderne¬†:</p>
</div>
<div class="ulist data-line-42">
<ul>
<li class="data-line-42">
<p><a href="http://bit.ly/2DcwNhn" data-href="http://bit.ly/2DcwNhn">Cryptographie</a></p>
</li>
<li class="data-line-44">
<p><a href="http://bit.ly/2zeZV3c" data-href="http://bit.ly/2zeZV3c">Fonction trappe</a></p>
</li>
<li class="data-line-46">
<p><a href="http://bit.ly/2ACJjnV" data-href="http://bit.ly/2ACJjnV">Factorisation premi√®re</a></p>
</li>
<li class="data-line-48">
<p><a href="http://bit.ly/2Q7mZYI" data-href="http://bit.ly/2Q7mZYI">Logarithme discret</a></p>
</li>
<li class="data-line-50">
<p><a href="http://bit.ly/2zfeKCP" data-href="http://bit.ly/2zfeKCP">Cryptage des courbes elliptiques</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-53">
<p>Dans Ethereum, nous utilisons la cryptographie √† cl√© publique (√©galement connue sous le nom de cryptographie asym√©trique) pour cr√©er la paire de cl√©s publique-priv√©e dont nous avons parl√© dans ce chapitre. Ils sont consid√©r√©s comme une &quot;paire&quot; car la cl√© publique est d√©riv√©e de la cl√© priv√©e. Ensemble, ils repr√©sentent un compte Ethereum en fournissant, respectivement, un identifiant de compte accessible au public (l&#39;adresse) et un contr√¥le priv√© sur l&#39;acc√®s √† tout ether du compte et sur toute authentification dont le compte a besoin lors de l&#39;utilisation de contrats intelligents. La cl√© priv√©e contr√¥le l&#39;acc√®s en √©tant l&#39;√©l√©ment d&#39;information unique n√©cessaire pour cr√©er des <em>signatures num√©riques</em>, qui sont n√©cessaires pour signer des transactions afin de d√©penser des fonds sur le compte. Les signatures num√©riques sont √©galement utilis√©es pour authentifier les propri√©taires ou les utilisateurs de contrats, comme nous le verrons dans <a href="#smart_contracts_chapter">Contrats intelligents et Solidity</a>.</p>
</div>
<div class="admonitionblock tip data-line-56">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-57">
<p>Dans la plupart des impl√©mentations de portefeuille, les cl√©s priv√©es et publiques sont stock√©es ensemble sous la forme d&#39;une <em>paire de cl√©s</em> pour plus de commodit√©. Cependant, la cl√© publique peut √™tre trivialement calcul√©e √† partir de la cl√© priv√©e, de sorte qu&#39;il est √©galement possible de ne stocker que la cl√© priv√©e.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-60">
<p>Une signature num√©rique peut √™tre cr√©√©e pour signer n&#39;importe quel message. Pour les transactions Ethereum, les d√©tails de la transaction elle-m√™me sont utilis√©s comme message. Les math√©matiques de la cryptographie - dans ce cas, la cryptographie √† courbe elliptique - permettent de combiner le message (c&#39;est-√†-dire les d√©tails de la transaction) avec la cl√© priv√©e pour cr√©er un code qui ne peut √™tre produit qu&#39;avec la connaissance de la cl√© priv√©e. Ce
code s&#39;appelle la signature num√©rique. Notez qu&#39;une transaction Ethereum est essentiellement une demande d&#39;acc√®s √† un compte particulier avec une adresse Ethereum particuli√®re. Lorsqu&#39;une transaction est envoy√©e au r√©seau Ethereum afin de d√©placer des fonds ou d&#39;interagir avec des contrats intelligents, elle doit √™tre envoy√©e avec une signature num√©rique cr√©√©e avec la cl√© priv√©e correspondant √† l&#39;adresse Ethereum en question. Les math√©matiques de la courbe elliptique signifient que <em>n&#39;importe qui</em> peut v√©rifier qu&#39;une transaction est valide, en v√©rifiant que la signature num√©rique correspond aux d√©tails de la transaction <em>et</em> √† l&#39;adresse Ethereum √† laquelle l&#39;acc√®s est demand√©. La v√©rification n&#39;implique pas du tout la cl√© priv√©e¬†; qui reste priv√©. Cependant, le processus de v√©rification d√©termine sans aucun doute que la transaction ne peut provenir que de quelqu&#39;un avec la cl√© priv√©e qui correspond √† la cl√© publique derri√®re l&#39;adresse Ethereum. C&#39;est la ¬´ magie ¬ª de la cryptographie √† cl√© publique.</p>
</div>
<div class="admonitionblock tip data-line-65">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-66">
<p>Il n&#39;y a pas de cryptage dans le cadre du protocole Ethereum - tous les messages envoy√©s dans le cadre du fonctionnement du r√©seau Ethereum peuvent (n√©cessairement) √™tre lus par tout le monde. En tant que telles, les cl√©s priv√©es ne sont utilis√©es que pour cr√©er des signatures num√©riques pour l&#39;authentification des transactions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-70">
<h3 id="private_keys">Cl√©s priv√©es</h3>
<div class="paragraph data-line-72">
<p> Une cl√© priv√©e est simplement un nombre, choisi au hasard. La propri√©t√© et le contr√¥le de la cl√© priv√©e sont √† la base du contr√¥le de l&#39;utilisateur sur tous les fonds associ√©s √† l&#39;adresse Ethereum correspondante, ainsi que de l&#39;acc√®s aux contrats qui autorisent cette adresse. La cl√© priv√©e est utilis√©e pour cr√©er les signatures n√©cessaires pour d√©penser de l&#39;ether en prouvant la propri√©t√© des fonds utilis√©s dans une transaction. La cl√© priv√©e doit rester secr√®te √† tout moment, car la r√©v√©ler √† des tiers √©quivaut √† leur donner le contr√¥le de l&#39;ether et des contrats s√©curis√©s par cette cl√© priv√©e. La cl√© priv√©e doit √©galement √™tre sauvegard√©e et prot√©g√©e contre toute perte accidentelle. S&#39;il est perdu, il ne peut pas √™tre r√©cup√©r√© et les fonds garantis par celui-ci sont √©galement perdus √† jamais.</p>
</div>
<div class="admonitionblock tip data-line-75">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-76">
<p>La cl√© priv√©e Ethereum n&#39;est qu&#39;un chiffre. Une fa√ßon de choisir vos cl√©s priv√©es au hasard consiste simplement √† utiliser une pi√®ce de monnaie, un crayon et du papier¬†: lancez une pi√®ce 256 fois et vous obtenez les chiffres binaires d&#39;une cl√© priv√©e al√©atoire que vous pouvez utiliser dans un portefeuille Ethereum (probablement - voir la section suivante ). La cl√© publique et l&#39;adresse peuvent ensuite √™tre g√©n√©r√©es √† partir de la cl√© priv√©e.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-80">
<h4 id="generating_private_key">G√©n√©rer une cl√© priv√©e √† partir d&#39;un nombre al√©atoire</h4>
<div class="paragraph data-line-82">
<p>Le premier et l&#39;√©tape la plus importante dans la g√©n√©ration de cl√©s consiste √† trouver une source s√©curis√©e d&#39;entropie ou de caract√®re al√©atoire. La cr√©ation d&#39;une cl√© priv√©e Ethereum consiste essentiellement √† choisir un nombre compris entre 1 et 2<sup>256</sup>. La m√©thode exacte que vous utilisez pour choisir ce nombre n&#39;a pas d&#39;importance tant qu&#39;elle n&#39;est pas pr√©visible ou d√©terministe. Le logiciel Ethereum utilise le g√©n√©rateur de nombres al√©atoires du syst√®me d&#39;exploitation sous-jacent pour produire 256 bits al√©atoires. Habituellement, le g√©n√©rateur de nombres al√©atoires du syst√®me d&#39;exploitation est initialis√© par une source humaine d&#39;al√©atoire, c&#39;est pourquoi il peut vous √™tre demand√© de remuer votre souris pendant quelques secondes ou d&#39;appuyer sur des touches al√©atoires de votre clavier. Une alternative pourrait √™tre le bruit de rayonnement cosmique sur le canal du microphone de l&#39;ordinateur.</p>
</div>
<div class="paragraph data-line-84">
<p>Plus pr√©cis√©ment, une cl√© priv√©e peut √™tre n&#39;importe quel nombre diff√©rent de z√©ro jusqu&#39;√† un tr√®s grand nombre l√©g√®rement inf√©rieur √† 2<sup>256</sup> - un √©norme nombre √† 78 chiffres, environ 1,158 * 10<sup>77</sup>. Le nombre exact partage les 38 premiers chiffres avec 2<sup>256</sup> et est d√©fini comme l&#39;ordre de la courbe elliptique utilis√©e dans Ethereum (voir <a href="#elliptic_curve">La cryptographie √† courbe elliptique expliqu√©e</a>). Pour cr√©er une cl√© priv√©e, nous choisissons au hasard un nombre de 256 bits et v√©rifions qu&#39;il se trouve dans la plage valide. En termes de programmation, cela est g√©n√©ralement r√©alis√© en introduisant une cha√Æne encore plus grande de bits al√©atoires (collect√©s √† partir d&#39;une source al√©atoire s√©curis√©e par cryptographie) dans un algorithme de hachage de 256 bits tel que Keccak-256 ou SHA-256, qui produiront commod√©ment un nombre de 256 bits. Si le r√©sultat est dans la plage valide, nous avons une cl√© priv√©e appropri√©e. Sinon, nous r√©essayons simplement avec un autre nombre al√©atoire.</p>
</div>
<div class="admonitionblock tip data-line-87">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-88">
<p>2<sup>256</sup> - la taille de l&#39;espace de cl√© priv√©e d&#39;Ethereum - est un nombre insondable. Il est d&#39;environ 10<sup>77</sup> en d√©cimal¬†; c&#39;est-√†-dire un nombre √† 77 chiffres. √Ä titre de comparaison, on estime que l&#39;univers visible contient 10<sup>80</sup> atomes. Ainsi, il y a presque assez de cl√©s priv√©es pour donner √† chaque atome de l&#39;univers un compte Ethereum. Si vous choisissez une cl√© priv√©e au hasard, il est impossible que quelqu&#39;un la devine ou la choisisse lui-m√™me.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-91">
<p>Notez que le processus de g√©n√©ration de cl√© priv√©e est hors ligne¬†; il ne n√©cessite aucune communication avec le r√©seau Ethereum, ni m√™me aucune communication avec qui que ce soit. En tant que tel, afin de choisir un nombre que personne d&#39;autre ne choisira jamais, il doit √™tre vraiment al√©atoire. Si vous choisissez vous-m√™me le num√©ro, la probabilit√© que quelqu&#39;un d&#39;autre l&#39;essaie (et s&#39;enfuie ensuite avec votre ether) est trop √©lev√©e. Utiliser un mauvais g√©n√©rateur de nombres al√©atoires (comme la fonction pseudo-al√©atoire rand dans la plupart des langages de programmation) est encore pire, car il est encore plus √©vident et encore plus facile √† reproduire. Tout comme pour les mots de passe des comptes en ligne, la cl√© priv√©e doit √™tre impossible √† deviner. Heureusement, vous n&#39;avez jamais besoin de vous souvenir de votre cl√© priv√©e, vous pouvez donc adopter la meilleure approche possible pour la choisir : √† savoir, le vrai hasard.</p>
</div>
<div class="admonitionblock warning data-line-94">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-95">
<p>N&#39;√©crivez pas votre propre code pour cr√©er un nombre al√©atoire ou n&#39;utilisez pas un &quot;simple&quot; g√©n√©rateur de nombres al√©atoires propos√© par votre langage de programmation. Il est essentiel que vous utilisiez un g√©n√©rateur de nombres pseudo-al√©atoires cryptographiquement s√©curis√© (tel que CSPRNG) avec une valeur d&#8217;amor√ßage provenant d&#39;une source d&#39;entropie suffisante. √âtudiez la documentation de la biblioth√®que de g√©n√©rateurs de nombres al√©atoires que vous choisissez pour vous assurer qu&#39;elle est cryptographiquement s√©curis√©e. La mise en ≈ìuvre correcte de la biblioth√®que CSPRNG est essentielle √† la s√©curit√© des cl√©s.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-98">
<p>Ce qui suit est une cl√© priv√©e g√©n√©r√©e al√©atoirement affich√©e au format hexad√©cimal (256¬†bits affich√©s sous la forme de 64¬†chiffres hexad√©cimaux, chacun de 4¬†bits)¬†:</p>
</div>
<div id="prv_key_example" class="listingblock data-line-101">
<div class="content">
<pre>f8f8a2f43c8376ccb0871305060d7b27b0554d2cc72bccf41b2705608452f315</pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-107">
<h3 id="pubkey">Cl√©s publiques</h3>
<div class="paragraph data-line-109">
<p>Une cl√© publique Ethereum est un <em>point</em> sur une courbe elliptique, ce qui signifie qu&#39;il s&#39;agit d&#39;un ensemble de coordonn√©es <em>x</em> et <em>y</em> qui satisfont l&#39;√©quation de la courbe elliptique.</p>
</div>
<div class="paragraph data-line-111">
<p>En termes plus simples, une cl√© publique Ethereum est constitu√©e de deux nombres r√©unis. Ces chiffres sont produits √† partir de la cl√© priv√©e par un calcul qui ne peut <em>aller que dans un sens</em>. Cela signifie qu&#39;il est trivial de calculer une cl√© publique si vous avez la cl√© priv√©e, mais vous ne pouvez pas calculer la cl√© priv√©e √† partir de la cl√© publique.</p>
</div>
<div class="admonitionblock warning data-line-114">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-115">
<p>Des MATH√âMATIQUES sont sur le point d&#39;arriver! Ne pas paniquer. Si vous commencez √† vous perdre √† n&#39;importe quel moment dans les paragraphes suivants, vous pouvez ignorer les quelques sections suivantes. Il existe de nombreux outils et biblioth√®ques qui feront le calcul pour vous.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-118">
<p>La cl√© publique est calcul√©e √† partir de la cl√© priv√©e en utilisant la multiplication par courbe elliptique, qui est pratiquement irr√©versible : <em>K</em> = <em>k</em> * <em>G</em>, o√π <em>k</em> est la cl√© priv√©e, <em>G</em> est un point constant appel√© le <em>point g√©n√©rateur</em>, <em>K</em> est la cl√© publique r√©sultante et * est l&#39;op√©rateur sp√©cial de &quot;multiplication&quot; de la courbe elliptique. Notez que la multiplication de courbe elliptique n&#39;est pas comme la multiplication normale. Il partage des attributs fonctionnels avec la multiplication normale, mais c&#39;est √† peu pr√®s tout. Par exemple, l&#39;op√©ration inverse (qui serait une division pour des nombres normaux), connue sous le nom de &quot;trouver le logarithme discret&quot; - c&#39;est-√†-dire calculer <em>k</em> si vous connaissez <em>K</em> - est aussi difficile que d&#39;essayer toutes les valeurs possibles de <em>k</em> (une recherche par force brute cela prendra probablement plus de temps que cet univers ne le permettra).</p>
</div>
<div class="paragraph data-line-120">
<p>En termes plus simples : l&#39;arithm√©tique sur la courbe elliptique est diff√©rente de l&#39;arithm√©tique enti√®re &quot;r√©guli√®re&quot;. Un point (<em>G</em>) peut √™tre multipli√© par un entier (<em>k</em>) pour produire un autre point (<em>K</em>). Mais la <em>division</em> n&#39;existe pas, il n&#39;est donc pas possible de simplement &quot;diviser&quot; la cl√© publique <em>K</em> par le point <em>G</em> pour calculer la cl√© priv√©e <em>k</em>. Il s&#39;agit de la fonction math√©matique √† sens unique d√©crite dans <a href="#pkc">Cryptographie √† cl√© publique et cryptomonnaie</a>.</p>
</div>
<div class="admonitionblock note data-line-123">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-124">
<p>La multiplication de courbe elliptique est un type de fonction que les cryptographes appellent une fonction &quot;√† sens unique&quot;¬†: elle est facile √† faire dans un sens (multiplication) et impossible √† faire dans le sens inverse (division). Le propri√©taire de la cl√© priv√©e peut facilement cr√©er la cl√© publique puis la partager avec le monde, sachant que personne ne peut inverser la fonction et calculer la cl√© priv√©e √† partir de la cl√© publique. Cette astuce math√©matique devient la base de signatures num√©riques infalsifiables et s√©curis√©es qui prouvent la propri√©t√© des fonds Ethereum et le contr√¥le des contrats.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-127">
<p>Avant de montrer comment g√©n√©rer une cl√© publique √† partir d&#39;une cl√© priv√©e, examinons un peu plus en d√©tail la cryptographie √† courbe elliptique.</p>
</div>
<div class="sect3 data-line-131">
<h4 id="elliptic_curve">La cryptographie √† courbe elliptique expliqu√©e</h4>
<div class="paragraph data-line-133">
<p>La courbe elliptique cryptographique est un type de cryptographie asym√©trique ou cryptographie √† cl√© publique bas√©e sur le probl√®me du logarithme discret exprim√© par addition et multiplication sur les points d&#39;une courbe elliptique.</p>
</div>
<div class="paragraph data-line-135">
<p><a href="#ecc-curve">Une visualisation d&#39;une courbe elliptique</a> est un exemple de courbe elliptique, similaire √† celle utilis√©e par Ethereum.</p>
</div>
<div class="admonitionblock note data-line-138">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-139">
<p>Ethereum utilise exactement la m√™me courbe elliptique, appel√©e secp256k1, que Bitcoin. Cela permet de r√©utiliser de nombreuses biblioth√®ques et outils de courbes elliptiques de Bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ecc-curve" class="imageblock data-line-144">
<div class="content">
<img src="images/simple_elliptic_curve.png" alt="ecc-curve">
</div>
<div class="title">Figure 25. Une visualisation d&#39;une courbe elliptique</div>
</div>
<div class="paragraph data-line-146">
<p>Ethereum utilise une courbe elliptique sp√©cifique et un ensemble de constantes math√©matiques, telles que d√©finies dans une norme appel√©e secp256k1, √©tablie par le National Institute of Standards and Technology (NIST) des √âtats-Unis. La courbe secp256k1 est d√©finie par la fonction suivante, qui produit une courbe elliptique¬†:</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mrow>
      <msup><mi>y</mi> <mn>2</mn> </msup>
      <mo>=</mo>
      <mrow>
        <mo>(</mo>
        <msup><mi>x</mi> <mn>3</mn> </msup>
        <mo>+</mo>
        <mn>7</mn>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mspace width="3.33333pt"/>
    <mtext>over</mtext>
    <mspace width="3.33333pt"/>
    <mrow>
      <mo>(</mo>
      <msub><mi>&#x1d53d;</mi> <mi>p</mi> </msub>
      <mo>)</mo>
    </mrow>
  </mrow>
</math>
</div>
<div class="paragraph data-line-176">
<p>ou alors:</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <msup><mi>y</mi> <mn>2</mn> </msup>
    <mspace width="3.33333pt"/>
    <mo form="prefix">mod</mo>
    <mspace width="0.277778em"/>
    <mi>p</mi>
    <mo>=</mo>
    <mrow>
      <mo>(</mo>
      <msup><mi>x</mi> <mn>3</mn> </msup>
      <mo>+</mo>
      <mn>7</mn>
      <mo>)</mo>
    </mrow>
    <mspace width="3.33333pt"/>
    <mo form="prefix">mod</mo>
    <mspace width="0.277778em"/>
    <mi>p</mi>
  </mrow>
</math>
</div>
<div class="paragraph data-line-204">
<p>Le <em>mod p</em> (modulo nombre premier <em>p</em>) indique que cette courbe est sur un corps fini d&#39;ordre premier <em>p</em>, √©galement √©crit comme \(\( \mathbb{F}_p \)\), o√π <em>p</em> = 2<sup>256</sup> ‚Äì 2<sup>32</sup> ‚Äì 2<sup>9</sup> ‚Äì 2<sup>8</sup> ‚Äì 2<sup>7</sup> ‚Äì 2<sup>6</sup> ‚Äì 2<sup>4</sup> ‚Äì 1, qui est un tr√®s grand nombre premier.</p>
</div>
<div class="paragraph data-line-206">
<p>Parce que cette courbe est d√©finie sur un champ fini d&#39;ordre premier au lieu de sur les nombres r√©els, elle ressemble √† un motif de points dispers√©s en deux dimensions, ce qui la rend difficile √† visualiser. Cependant, le calcul est identique √† celui d&#39;une courbe elliptique sur des nombres r√©els. A titre d&#39;exemple, <a href="#ecc-over-F17-math">Cryptographie sur courbe elliptique: visualisation d&#39;une courbe elliptique sur F(p), avec p=17</a> montre la m√™me courbe elliptique sur un champ fini beaucoup plus petit d&#39;ordre premier 17, montrant un motif de points sur une grille. La courbe elliptique secp256k1 Ethereum peut √™tre consid√©r√©e comme un motif beaucoup plus complexe de points sur une grille insondable.</p>
</div>
<div id="ecc-over-F17-math" class="imageblock smallersixty data-line-211">
<div class="content">
<img src="images/ec_over_small_prime_field.png" alt="&quot;ecc-over-F17-math&quot;">
</div>
<div class="title">Figure 26. Cryptographie sur courbe elliptique: visualisation d&#39;une courbe elliptique sur F(p), avec p=17</div>
</div>
<div class="paragraph data-line-213">
<p>Ainsi, par exemple, ce qui suit est un point <em>Q</em> avec des coordonn√©es (<em>x</em>,<em>y</em>) qui est un point sur la courbe secp256k1¬†:</p>
</div>
<div id="coordinates_example" class="listingblock data-line-216">
<div class="content">
<pre>Q =
(49790390825249384486033144355916864607616083520101638681403973749255924539515,
59574132161899900045862086493921015780032175291755807399284007721050341297360)</pre>
</div>
</div>
<div class="paragraph data-line-222">
<p><a href="#example_1">[example_1]</a> montre comment vous pouvez v√©rifier cela vous-m√™me en utilisant Python. Les variables x et y sont les coordonn√©es du point <em>Q</em>, comme dans l&#39;exemple pr√©c√©dent. La variable p est l&#39;ordre premier de la courbe elliptique (le premier qui est utilis√© pour toutes les op√©rations modulo). La derni√®re ligne de Python est l&#39;√©quation de la courbe elliptique (l&#39;op√©rateur % en Python est l&#39;op√©rateur modulo). Si x et y sont bien les coordonn√©es d&#39;un point sur la courbe elliptique, alors elles satisfont l&#39;√©quation et le r√©sultat est z√©ro (0L est un entier long valant z√©ro). Essayez vous-m√™me, en tapant <strong>python</strong> sur une ligne de commande et en copiant chaque ligne (apr√®s l&#39;invite + &gt;&gt;&gt; +) de la liste.</p>
</div>
<div data-type="example" id="example_1">
<h5>Utiliser Python pour confirmer que ce point est sur la courbe elliptique</h5>
<pre data-type="programlisting">
Python 3.4.0 (default, Mar 30 2014, 19:23:13)
[GCC 4.2.1 Compatible Apple LLVM 5.1 (clang-503.0.38)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> <strong>p = 115792089237316195423570985008687907853269984665640564039457584007908834 \
671663</strong>
>>> <strong>x = 49790390825249384486033144355916864607616083520101638681403973749255924539515</strong>
>>> <strong>y = 59574132161899900045862086493921015780032175291755807399284007721050341297360</strong>
>>> <strong>(x ** 3 + 7 - y**2) % p</strong>
0L

</pre>
</div>
</div>
<div class="sect3 data-line-243">
<h4 id="EC_math">Op√©rations arithm√©tiques sur les courbes elliptiques</h4>
<div class="paragraph data-line-245">
<p>Beaucoup de math√©matiques sur les courbes elliptiques ressemblent beaucoup √† l&#39;arithm√©tique des nombres entiers que nous avons apprise √† l&#39;√©cole. Plus pr√©cis√©ment, nous pouvons d√©finir un op√©rateur d&#39;addition qui, au lieu de sauter le long de la droite num√©rique, saute vers d&#39;autres points de la courbe. Une fois que nous avons l&#39;op√©rateur d&#39;addition, nous pouvons √©galement d√©finir la multiplication d&#39;un point et d&#39;un nombre entier, ce qui √©quivaut √† une addition r√©p√©t√©e.</p>
</div>
<div class="paragraph data-line-247">
<p>L&#39;addition de courbe elliptique est d√©finie de telle sorte que, √©tant donn√© deux points <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub> sur la courbe elliptique, il existe un troisi√®me point <em>P</em><sub>3</sub> = <em>P</em><sub>1</sub> + <em>P</em><sub>2</sub>, √©galement sur la courbe elliptique.</p>
</div>
<div class="paragraph data-line-249">
<p>G√©om√©triquement, ce troisi√®me point <em>P</em><sub>3</sub> est calcul√© en tra√ßant une ligne entre <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub>. Cette ligne coupera la courbe elliptique exactement √† un endroit suppl√©mentaire (√©tonnamment). Appelez ce point <em>P</em><sub>3</sub>&#39; = (<em>x</em>, <em>y</em>). R√©fl√©chissez ensuite sur l&#39;axe des x pour obtenir <em>P</em><sub>3</sub> = (<em>x</em>, <em>‚Äìy</em>).</p>
</div>
<div class="paragraph data-line-251">
<p>Si <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub> sont au m√™me point, la ligne &quot;entre&quot; <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub> devrait s&#39;√©tendre pour √™tre la tangente √† la courbe en ce point <em>P</em><sub>1</sub>. Cette tangente coupera la courbe exactement en un nouveau point. Vous pouvez utiliser des techniques de calcul pour d√©terminer la pente de la ligne tangente. Curieusement, ces techniques fonctionnent, m√™me si nous restreignons notre int√©r√™t aux points de la courbe √† deux coordonn√©es enti√®res !</p>
</div>
<div class="paragraph data-line-253">
<p>Dans les math√©matiques des courbes elliptiques, il existe √©galement un point appel√© &quot;point √† l&#39;infini&quot;, qui correspond √† peu pr√®s au r√¥le du nombre z√©ro en addition. Sur les ordinateurs, il est parfois repr√©sent√© par <em>x</em> = <em>y</em> = 0 (ce qui ne satisfait pas l&#39;√©quation de la courbe elliptique, mais c&#39;est un cas s√©par√© facile qui peut √™tre v√©rifi√©). Il y a quelques cas particuliers qui expliquent la n√©cessit√© du point √† l&#39;infini.</p>
</div>
<div class="paragraph data-line-255">
<p>Dans certains cas (par exemple, si <em>P</em><sub>1</sub> et <em>P</em><sub>2</sub> ont les m√™mes valeurs <em>x</em> mais des valeurs <em>y</em> diff√©rentes), la ligne sera exactement verticale, auquel cas <em>P</em><sub>3</sub> = le point √† l&#39;infini.</p>
</div>
<div class="paragraph data-line-257">
<p>Si <em>P</em><sub>1</sub> est le point √† l&#39;infini, alors <em>P</em><sub>1</sub> + <em>P</em><sub>2</sub> = <em>P</em><sub>2</sub>. De m√™me, si <em>P</em><sub>2</sub> est le point √† l&#39;infini, alors <em>P</em><sub>1</sub> + <em>P</em><sub>2</sub> = <em>P</em><sub>1</sub>. Cela montre comment le point √† l&#39;infini joue le r√¥le que joue z√©ro dans l&#39;arithm√©tique &quot;normale&quot;.</p>
</div>
<div class="paragraph data-line-259">
<p>Il s&#39;av√®re que + est associatif, ce qui signifie que (<em>A</em> + <em>B</em>) + <em>C</em> = <em>A</em> + (<em>B</em> + <em>C</em>). Cela signifie que nous pouvons √©crire <em>A</em> + <em>B</em> + <em>C</em> (sans parenth√®ses) sans ambigu√Øt√©.</p>
</div>
<div class="paragraph data-line-261">
<p>Maintenant que nous avons d√©fini l&#39;addition, nous pouvons d√©finir la multiplication de la mani√®re standard qui √©tend l&#39;addition. Pour un point <em>P</em> sur la courbe elliptique, si <em>k</em> est un nombre entier, alors <em>k</em> * <em>P</em> = <em>P</em> + <em>P</em> + <em>P</em> + &#8230;&#8203; + <em>P</em> (<em>k</em> fois). Notez que <em>k</em> est parfois (peut-√™tre de mani√®re d√©routante) appel√© un &quot;exposant&quot; dans ce cas.</p>
</div>
</div>
<div class="sect3 data-line-264">
<h4 id="public_key_derivation">G√©n√©ration d&#39;une cl√© publique</h4>
<div class="paragraph data-line-266">
<p>Commencer avec une cl√© priv√©e sous la forme d&#39;un nombre <em>k</em> g√©n√©r√© al√©atoirement, nous le multiplions par un point pr√©d√©termin√© sur la courbe appel√© <em>point g√©n√©rateur</em> <em>G</em> pour produire un autre point ailleurs sur la courbe, qui est la cl√© publique correspondante <em>K</em>¬†:</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mi>K</mi>
    <mo>=</mo>
    <mi>k</mi>
    <mo>*</mo>
    <mi>G</mi>
  </mrow>
</math>
</div>
<div class="paragraph data-line-282">
<p>Le point g√©n√©rateur est sp√©cifi√© dans le cadre de la norme secp256k1¬†; c&#39;est la m√™me chose pour toutes les impl√©mentations de secp256k1, et toutes les cl√©s d√©riv√©es de cette courbe utilisent le m√™me point <em>G</em>. Comme le point g√©n√©rateur est toujours le m√™me pour tous les utilisateurs d&#39;Ethereum, une cl√© priv√©e <em>k</em> multipli√©e par <em>G</em> donnera toujours la m√™me cl√© publique <em>K</em>. La relation entre <em>k</em> et <em>K</em> est fixe, mais ne peut √™tre calcul√©e que dans un sens, de <em>k</em> vers <em>K</em>. C&#39;est pourquoi une adresse Ethereum (d√©riv√©e de <em>K</em>) peut √™tre partag√©e avec n&#39;importe qui et ne r√©v√®le pas la cl√© priv√©e de l&#39;utilisateur (<em>k</em>).</p>
</div>
<div class="paragraph data-line-284">
<p>Comme nous l&#39;avons d√©crit dans la section pr√©c√©dente, la multiplication de <em>k</em> * <em>G</em> est √©quivalente √† une addition r√©p√©t√©e, donc <em>G</em> + <em>G</em> + <em>G</em> + &#8230;&#8203; + <em>G</em>, r√©p√©t√© <em>k</em> fois. En r√©sum√©, pour produire une cl√© publique <em>K</em> √† partir d&#39;une cl√© priv√©e <em>k</em>, on ajoute le point g√©n√©rateur <em>G</em> √† lui-m√™me, <em>k</em> fois.</p>
</div>
<div class="admonitionblock tip data-line-287">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-288">
<p>Une cl√© priv√©e peut √™tre convertie en cl√© publique, mais une cl√© publique ne peut pas √™tre reconvertie en cl√© priv√©e, car le calcul ne fonctionne que dans un sens.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-291">
<p>Appliquons ce calcul pour trouver la cl√© publique de la cl√© priv√©e sp√©cifique que nous vous avons montr√©e dans <a href="#private_keys">Cl√©s priv√©es</a>¬†:</p>
</div>
<div id="example_privkey" class="listingblock data-line-296">
<div class="title">Exemple de calcul de cl√© priv√©e √† cl√© publique</div>
<div class="content">
<pre>K = f8f8a2f43c8376ccb0871305060d7b27b0554d2cc72bccf41b2705608452f315 * G</pre>
</div>
</div>
<div class="paragraph data-line-300">
<p>Une biblioth√®que cryptographique peut nous aider √† calculer <em>K</em>, en utilisant la multiplication de courbes elliptiques. La cl√© publique r√©sultante <em>K</em> est d√©finie comme le point¬†:</p>
</div>
<div class="listingblock data-line-302">
<div class="content">
<pre>K = (x, y)</pre>
</div>
</div>
<div class="paragraph data-line-306">
<p>o√π:</p>
</div>
<div class="listingblock data-line-308">
<div class="content">
<pre>x = 6e145ccef1033dea239875dd00dfb4fee6e3348b84985c92f103444683bae07b
y = 83b5c38e5e2b0c8529d7fa3f64d46daa1ece2d9ac14cab9477d042c84c32ccd0</pre>
</div>
</div>
<div class="paragraph data-line-313">
<p>Dans Ethereum, vous pouvez voir des cl√©s publiques repr√©sent√©es par une s√©rialisation de 130¬†caract√®res hexad√©cimaux (65¬†octets ). Ceci est adopt√© √† partir d&#39;un format de s√©rialisation standard propos√© par le consortium industriel Standards for Efficient Cryptography Group (SECG), document√© dans <a href="http://www.secg.org/sec1-v2.pdf" class="undefined" data-href="http://www.secg.org/sec1-v2.pdf">http://www.secg.org/sec1-v2.pdf</a> [Standards for Efficient Cryptography (SEC1)]. La norme d√©finit quatre pr√©fixes possibles pouvant √™tre utilis√©s pour identifier des points sur une courbe elliptique, r√©pertori√©s dans <a href="#EC_prefix_table">Pr√©fixes de cl√© publique EC s√©rialis√©s</a>.</p>
</div>
<table id="EC_prefix_table" class="tableblock frame-all grid-all stretch data-line-318">
<caption class="title">Table 2. Pr√©fixes de cl√© publique EC s√©rialis√©s</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pr√©fixe</th>
<th class="tableblock halign-left valign-top">Signification</th>
<th class="tableblock halign-left valign-top">Longueur (octets comptant le pr√©fixe)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointe √† l&#39;infini</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point non compress√©</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">65</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point compress√© avec pair y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point compress√© avec impair y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-326">
<p>Ethereum utilise uniquement des cl√©s publiques non compress√©es ; par cons√©quent, le seul pr√©fixe pertinent est (hex) 04. La s√©rialisation concat√®ne les coordonn√©es <em>x</em> et <em>y</em> de la cl√© publique¬†:</p>
</div>
<div id="concat_coordinates" class="listingblock data-line-329">
<div class="content">
<pre>04 + coordonn√©e x (32 octets/64 hex) + coordonn√©e y (32 octets/64 hex)</pre>
</div>
</div>
<div class="paragraph data-line-333">
<p>Par cons√©quent, la cl√© publique que nous avons calcul√©e pr√©c√©demment est s√©rialis√©e comme suit¬†:</p>
</div>
<div id="serialized_pubkey" class="listingblock data-line-336">
<div class="content">
<pre>046e145ccef1033dea239875dd00dfb4fee6e3348b84985c92f103444683bae07b83b5c38e5e2b0 \
c8529d7fa3f64d46daa1ece2d9ac14cab9477d042c84c32ccd0</pre>
</div>
</div>
</div>
<div class="sect3 data-line-342">
<h4 id="EC_lib">Biblioth√®ques de courbes elliptiques</h4>
<div class="paragraph data-line-344">
<p>Il existe quelques impl√©mentations de la courbe elliptique secp256k1 qui sont utilis√©es dans les projets li√©s √† la cryptomonnaie¬†:</p>
</div>
<div class="dlist data-line-346">
<dl>
<dt class="hdlist1"><a href="https://www.openssl.org/" data-href="https://www.openssl.org/">OpenSSL</a></dt>
<dd>
<p>La biblioth√®que OpenSSL offre un ensemble complet de primitives cryptographiques, y compris une impl√©mentation compl√®te de secp256k1. Par exemple, pour d√©river la cl√© publique, la fonction EC_POINT_mul peut √™tre utilis√©e.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin-core/secp256k1" data-href="https://github.com/bitcoin-core/secp256k1">libsecp256k1</a></dt>
<dd>
<p>libsecp256k1 de Bitcoin Core est une impl√©mentation en langage C de la courbe elliptique secp256k1 et d&#39;autres primitives cryptographiques. Il a √©t√© √©crit √† partir de z√©ro pour remplacer OpenSSL dans le logiciel Bitcoin Core et est consid√©r√© comme sup√©rieur en termes de performances et de s√©curit√©.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 data-line-351">
<h3 id="hash_functions">Fonctions de hachage cryptographique</h3>
<div class="paragraph data-line-353">
<p>Les fonctions de hachage cryptographiques sont utilis√©es dans Ethereum. En fait, les fonctions de hachage sont largement utilis√©es dans presque tous les syst√®mes cryptographiques - un fait captur√© par <span class="keep-together">cryptographeur</span> <a href="http://bit.ly/2Q79qZp" data-href="http://bit.ly/2Q79qZp">Bruce Schneier</a>, qui a dit , &quot;Bien plus que des algorithmes de chiffrement, les fonctions de hachage unidirectionnelles sont les b√™tes de somme de la cryptographie moderne.&quot;</p>
</div>
<div class="paragraph data-line-355">
<p>Dans cette section, nous discuterons des fonctions de hachage, explorerons leurs propri√©t√©s de base et verrons comment ces propri√©t√©s les rendent si utiles dans de nombreux domaines de la cryptographie moderne. Nous abordons ici les fonctions de hachage car elles font partie de la transformation des cl√©s publiques Ethereum en adresses. Ils peuvent √©galement √™tre utilis√©s pour cr√©er des <em>empreintes digitales</em>, qui facilitent la v√©rification des donn√©es.</p>
</div>
<div class="paragraph data-line-357">
<p>En termes simples, une <a href="http://bit.ly/2CR26gD" data-href="http://bit.ly/2CR26gD"><em>fonction de hachage</em></a> est &quot;toute fonction qui peut √™tre utilis√©e pour mapper des donn√©es de taille arbitraire √† des donn√©es de taille fixe. ‚Äù L&#39;entr√©e d&#39;une fonction de hachage est appel√©e une <em>pr√©-image</em>, le <em>message</em> ou simplement les <em>donn√©es d&#39;entr√©e</em>. La sortie est appel√©e <em>hash</em> ou <em>r√©sultat de hachage</em> ou <em>hachage</em> en fran√ßais. <a href="http://bit.ly/2Jrn3jM" data-href="http://bit.ly/2Jrn3jM"><em>Les fonctions de hachage cryptographiques</em></a> sont une sous-cat√©gorie sp√©ciale qui poss√®de des propri√©t√©s sp√©cifiques utiles pour s√©curiser les plates-formes, telles qu&#39;Ethereum.</p>
</div>
<div class="paragraph data-line-359">
<p>Une fonction de hachage cryptographique est une fonction de hachage <em>unidirectionnelle</em> qui associe des donn√©es de taille arbitraire √† une cha√Æne de bits de taille fixe. La nature &quot;unidirectionnelle&quot; signifie qu&#39;il est impossible de recr√©er les donn√©es d&#39;entr√©e si l&#39;on ne conna√Æt que le hachage de sortie. La seule fa√ßon de d√©terminer une entr√©e possible est de mener une recherche par force brute, en v√©rifiant chaque candidat pour une sortie correspondante ; √©tant donn√© que l&#39;espace de recherche est virtuellement infini, il est ais√© de comprendre l&#39;impossibilit√© pratique de la t√¢che. M√™me si vous trouvez des donn√©es d&#39;entr√©e qui cr√©ent un hachage correspondant, il se peut qu&#39;il ne s&#39;agisse pas des donn√©es d&#39;entr√©e d&#39;origine¬†: les fonctions de hachage sont des fonctions &quot;plusieurs vers un&quot;. Trouver deux ensembles de donn√©es d&#39;entr√©e qui hachent la m√™me sortie s&#39;appelle trouver une <em>collision de hachage</em>. En gros, plus la fonction de hachage est bonne, plus les collisions de hachage sont rares. Pour Ethereum, ils sont effectivement impossibles.</p>
</div>
<div class="paragraph data-line-361">
<p>Regardons de plus pr√®s les principales propri√©t√©s des fonctions de hachage cryptographiques. Ceux-ci inclus:</p>
</div>
<div class="dlist data-line-363">
<dl>
<dt class="hdlist1">D√©terministe </dt>
<dd>
<p>Un message d&#39;entr√©e donn√© produit toujours la m√™me sortie de hachage.</p>
</dd>
<dt class="hdlist1">V√©rifiable </dt>
<dd>
<p>Le calcul du hachage d&#39;un message est efficace (complexit√© lin√©aire).</p>
</dd>
<dt class="hdlist1">Non-corr√©lationnaire</dt>
<dd>
<p>Une petite modification du message (par exemple, un changement de 1 bit) devrait modifier la sortie de hachage si largement qu&#39;elle ne peut pas √™tre corr√©l√©e au hachage du message d&#39;origine.</p>
</dd>
<dt class="hdlist1">Irr√©versibile</dt>
<dd>
<p>Le calcul du message √† partir de son hachage est irr√©alisable, ce qui √©quivaut √† une recherche par force brute dans tous les messages possibles.</p>
</dd>
<dt class="hdlist1">Protection contre les collisions</dt>
<dd>
<p>Il devrait √™tre impossible de calculer deux messages diff√©rents qui produisent la m√™me sortie de hachage.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-373">
<p>La r√©sistance aux collisions de hachage est particuli√®rement importante pour √©viter la falsification de signature num√©rique dans Ethereum.</p>
</div>
<div class="paragraph data-line-375">
<p>La combinaison de ces propri√©t√©s rend les fonctions de hachage cryptographiques utiles pour un large √©ventail d&#39;applications de s√©curit√©, notamment¬†:</p>
</div>
<div class="ulist data-line-377">
<ul>
<li class="data-line-377">
<p>Empreinte des donn√©es</p>
</li>
<li class="data-line-378">
<p>Int√©grit√© des messages (d√©tection d&#39;erreur)</p>
</li>
<li class="data-line-379">
<p>Preuve de travail</p>
</li>
<li class="data-line-380">
<p>Authentification (hachage de mot de passe et √©tirement de cl√©)</p>
</li>
<li class="data-line-381">
<p>G√©n√©rateurs de nombres pseudo-al√©atoires</p>
</li>
<li class="data-line-382">
<p>Engagement de message (m√©canismes de validation-r√©v√©lation)</p>
</li>
<li class="data-line-383">
<p>Identifiants uniques</p>
</li>
</ul>
</div>
<div class="paragraph data-line-385">
<p>Nous en trouverons beaucoup dans Ethereum au fur et √† mesure que nous progressons dans les diff√©rentes couches du syst√®me.</p>
</div>
<div class="sect3 data-line-388">
<h4 id="keccak256">Fonction de hachage cryptographique d&#39;Ethereum¬†: Keccak-256</h4>
<div class="paragraph data-line-390">
<p>Ethereum utilise le hachage cryptographique <em>Keccak-256</em> dans de nombreux endroits. Keccak-256 a √©t√© con√ßu comme candidat pour le SHA-3 Cryptographic Hash Function Competition organis√© en 2007 par le National Institute of Science and Technology (NIST). Keccak √©tait l&#39;algorithme gagnant, qui a √©t√© normalis√© en tant que Federal Information Processing Standard (FIPS) 202 en 2015.</p>
</div>
<div class="paragraph data-line-392">
<p>Cependant, pendant la p√©riode de d√©veloppement d&#39;Ethereum, la normalisation du NIST n&#39;√©tait pas encore finalis√©e. Le NIST a ajust√© certains des param√®tres de Keccak apr√®s l&#39;ach√®vement du processus de normalisation, pr√©tendument pour am√©liorer son efficacit√©. Cela se produisait en m√™me temps que le d√©nonciateur h√©ro√Øque Edward Snowden a r√©v√©l√© des documents qui impliquent que le NIST pourrait avoir √©t√© ind√ªment influenc√© par la National Security Agency (NSA) pour affaiblir intentionnellement la norme de g√©n√©rateur de nombres al√©atoires Dual_EC_DRBG, pla√ßant effectivement une porte d√©rob√©e dans le g√©n√©rateur de nombres al√©atoires standard. Le r√©sultat de cette controverse a √©t√© une r√©action violente contre les modifications propos√©es et un retard important dans la normalisation de SHA-3. √Ä l&#39;√©poque, la Fondation Ethereum a d√©cid√© d&#39;impl√©menter l&#39;algorithme Keccak original, tel que propos√© par ses inventeurs, plut√¥t que la norme SHA-3 telle que modifi√©e par le NIST.</p>
</div>
<div class="admonitionblock warning data-line-395">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-396">
<p>Bien que vous puissiez voir &quot;SHA-3&quot; mentionn√© dans les documents et le code Ethereum, beaucoup, sinon toutes, de ces instances font en fait r√©f√©rence √† Keccak-256, et non √† la norme FIPS-202 SHA-3 finalis√©e. Les diff√©rences d&#39;impl√©mentation sont l√©g√®res, li√©es aux param√®tres de remplissage, mais elles sont importantes dans la mesure o√π Keccak-256 produit des sorties de hachage diff√©rentes de FIPS-202 SHA-3 pour la m√™me entr√©e.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-400">
<h4 id="which_hash">Quelle fonction de hachage suis-je en train d&#39;utiliser¬†?</h4>
<div class="paragraph data-line-402">
<p>Comment pouvez-vous savoir si la biblioth√®que de logiciels que vous utilisez impl√©mente FIPS-202 SHA-3 ou Keccak-256, si les deux pouvaient s&#39;appeler &quot;SHA-3&quot;¬†?</p>
</div>
<div class="paragraph data-line-404">
<p>Un moyen simple de le dire est d&#39;utiliser un <em>vecteur de test</em>, une sortie attendue pour une entr√©e donn√©e. Le test le plus couramment utilis√© pour une fonction de hachage est l' <em>entr√©e vide</em>. Si vous ex√©cutez la fonction de hachage avec une cha√Æne vide en entr√©e, vous devriez voir les r√©sultats suivants¬†:</p>
</div>
<div class="listingblock data-line-406">
<div class="content">
<pre>Keccak256("") =
  c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470

SHA3("") =
  a7ffc6f8bf1ed76651c14756a061d662f580ff4de43b49fa82d80a4b80f8434a</pre>
</div>
</div>
<div class="paragraph data-line-415">
<p>Quel que soit le nom de la fonction, vous pouvez la tester pour voir s&#39;il s&#39;agit du Keccak-256 d&#39;origine ou de la norme NIST finale FIPS-202 SHA-3 en ex√©cutant ce test simple. N&#39;oubliez pas qu&#39;Ethereum utilise Keccak-256, m√™me s&#39;il est souvent appel√© SHA-3 dans le code.</p>
</div>
<div class="admonitionblock note data-line-418">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-419">
<p>En raison de la confusion cr√©√©e par la diff√©rence entre la fonction de hachage utilis√©e dans Ethereum (Keccak-256) et la norme finalis√©e (FIP-202 SHA-3), des efforts sont en cours pour renommer toutes les instances de sha3 dans tous les codes, opcodes, et des biblioth√®ques √† keccak256. Voir <a href="https://github.com/ethereum/EIPs/issues/59" data-href="https://github.com/ethereum/EIPs/issues/59">ERC59</a> pour plus de d√©tails.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-423">
<p>Examinons ensuite la premi√®re application de Keccak-256 dans Ethereum, qui consiste √† produire des adresses Ethereum √† partir de cl√©s publiques.</p>
</div>
</div>
</div>
<div class="sect2 data-line-426">
<h3 id="eth_address">Adresses Ethereum</h3>
<div class="paragraph data-line-428">
<p>Les adresses Ethereum sont des <em>identifiants uniques</em> d√©riv√©s de cl√©s publiques ou de contrats utilisant la fonction de hachage unidirectionnelle Keccak-256.</p>
</div>
<div class="paragraph data-line-430">
<p>Dans nos exemples pr√©c√©dents, nous avons commenc√© avec une cl√© priv√©e et avons utilis√© la multiplication par courbe elliptique pour d√©river une cl√© publique¬†:</p>
</div>
<div class="paragraph pagebreak-before data-line-433">
<p>Cl√© priv√©e <em>k</em>¬†:</p>
</div>
<div class="listingblock data-line-435">
<div class="content">
<pre>k = f8f8a2f43c8376ccb0871305060d7b27b0554d2cc72bccf41b2705608452f315</pre>
</div>
</div>
<div id="concat_pubkey" class="paragraph data-line-440">
<p>Cl√© publique <em>K</em> (coordonn√©es <em>x</em> et <em>y</em> concat√©n√©es et affich√©es en hexad√©cimal)¬†:</p>
</div>
<div class="listingblock data-line-442">
<div class="content">
<pre>K = 6e145ccef1033dea239875dd00dfb4fee6e3348b84985c92f103444683bae07b83b5c38e5e...</pre>
</div>
</div>
<div class="admonitionblock note data-line-447">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-448">
<p>Il est √† noter que la cl√© publique n&#39;est pas format√©e avec le pr√©fixe (hex) 04 lors du calcul de l&#39;adresse.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-451">
<p>Nous utilisons Keccak-256 pour calculer le <em>hachage</em> de cette cl√© publique¬†:</p>
</div>
<div id="calculate_hash" class="listingblock data-line-454">
<div class="content">
<pre>Keccak256(K) = 2a5bc342ed616b5ba5732269001d3f1ef827552ae1114027bd3ecf1f086ba0f9</pre>
</div>
</div>
<div class="paragraph data-line-458">
<p>Ensuite, nous ne gardons que les 20 derniers octets (octets les moins significatifs), qui sont notre adresse Ethereum¬†:</p>
</div>
<div id="keep_last_20" class="listingblock data-line-461">
<div class="content">
<pre>001d3f1ef827552ae1114027bd3ecf1f086ba0f9</pre>
</div>
</div>
<div class="paragraph data-line-465">
<p>Le plus souvent, vous verrez des adresses Ethereum avec le pr√©fixe 0x qui indique qu&#39;elles sont cod√©es en hexad√©cimal, comme ceci :</p>
</div>
<div id="hex_prefix" class="listingblock data-line-468">
<div class="content">
<pre>0x001d3f1ef827552ae1114027bd3ecf1f086ba0f9</pre>
</div>
</div>
<div class="sect3 data-line-473">
<h4 id="eth_address_format">Formats d&#39;adresse Ethereum</h4>
<div class="paragraph data-line-475">
<p>Les adresses Ethereum sont des nombres hexad√©cimaux, des identifiants d√©riv√©s des 20 derniers octets du hachage Keccak-256 de la cl√© publique.</p>
</div>
<div class="paragraph data-line-477">
<p>(&quot;somme de contr√¥le&quot;,&quot;dans les formats d&#8217;adresses Ethereum&quot;Contrairement aux adresses Bitcoin, qui sont encod√©es dans l&#39;interface utilisateur de tous les clients pour inclure une somme de contr√¥le int√©gr√©e pour se prot√©ger contre les adresses mal saisies, les adresses Ethereum sont pr√©sent√©es sous forme hexad√©cimale brute sans aucune somme de contr√¥le.</p>
</div>
<div class="paragraph data-line-479">
<p>La justification de cette d√©cision √©tait que les adresses Ethereum seraient √©ventuellement cach√©es derri√®re des abstractions (telles que les services de noms) aux couches sup√©rieures du syst√®me et que des sommes de contr√¥le devraient √™tre ajout√©es aux couches sup√©rieures si n√©cessaire.</p>
</div>
<div class="paragraph data-line-481">
<p>En r√©alit√©, ces couches sup√©rieures ont √©t√© d√©velopp√©es trop lentement et ce choix de conception a entra√Æn√© un certain nombre de probl√®mes dans les premiers jours de l&#39;√©cosyst√®me, notamment la perte de fonds en raison d&#39;adresses mal saisies et d&#39;erreurs de validation des entr√©es. De plus, comme les services de noms Ethereum ont √©t√© d√©velopp√©s plus lentement que pr√©vu initialement, les encodages alternatifs ont √©t√© adopt√©s tr√®s lentement par les d√©veloppeurs de portefeuilles. Nous examinerons ensuite quelques-unes des options d&#39;encodage.</p>
</div>
</div>
<div class="sect3 data-line-484">
<h4 id="ICAP">Inter Exchange Client Address Protocol (ICAP)</h4>
<div class="paragraph data-line-486">
<p>Le client <em>Inter exchange Address Protocol</em> (ICAP) est un codage d&#39;adresse Ethereum partiellement compatible avec le International Bank Account Number (IBAN), offrant un encodage polyvalent, √† somme de contr√¥le et interop√©rable pour les adresses Ethereum. Les adresses ICAP peuvent encoder des adresses Ethereum ou des noms communs enregistr√©s aupr√®s d&#39;un registre de noms Ethereum. Vous pouvez en savoir plus sur ICAP sur <a href="http://bit.ly/2JsZHKu" data-href="http://bit.ly/2JsZHKu">Ethereum Wiki</a>.</p>
</div>
<div class="paragraph data-line-488">
<p>L&#39;IBAN est une norme internationale d&#39;identification des num√©ros de compte bancaire, principalement utilis√©e pour les virements √©lectroniques. Il est largement adopt√© dans l&#39;espace europ√©en unique de paiements en euros (SEPA) et au-del√†. L&#39;IBAN est un service centralis√© et fortement r√©glement√©. ICAP est une impl√©mentation d√©centralis√©e mais compatible pour les adresses Ethereum.</p>
</div>
<div class="paragraph data-line-490">
<p>Un IBAN consiste en une cha√Æne de 34 caract√®res alphanum√©riques au maximum (insensible √† la casse) comprenant un code pays, une somme de contr√¥le et un identifiant de compte bancaire (qui est sp√©cifique au pays).</p>
</div>
<div class="paragraph data-line-492">
<p>ICAP utilise la m√™me structure en introduisant un code de pays non standard, &quot;XE&quot;, qui signifie &quot;Ethereum&quot;, suivi d&#39;une somme de contr√¥le √† deux caract√®res et de trois variantes possibles d&#39;un identifiant de compte¬†:</p>
</div>
<div class="dlist data-line-494">
<dl>
<dt class="hdlist1">Direct</dt>
<dd>
<p>Un entier gros-boutiste base-36 comprenant jusqu&#39;√† 30 caract√®res alphanum√©riques, repr√©sentant les 155 bits les moins significatifs d&#39;une adresse Ethereum. √âtant donn√© que cet encodage correspond √† moins que les 160 bits complets d&#39;une adresse Ethereum g√©n√©rale, il ne fonctionne que pour les adresses Ethereum qui commencent par un ou plusieurs octets √† z√©ro. L&#39;avantage est qu&#39;il est compatible avec l&#39;IBAN, en termes de longueur de champ et de somme de contr√¥le. Exemple¬†: XE60HAMICDXSV5QXVJA7TJW47Q9CHWKJD (33¬†caract√®res).</p>
</dd>
<dt class="hdlist1">Basic</dt>
<dd>
<p>Identique √† l&#39;encodage Direct, sauf qu&#39;il comporte 31 caract√®res. Cela lui permet d&#39;encoder n&#39;importe quelle adresse Ethereum, mais la rend incompatible avec la validation du champ IBAN. Exemple : XE18CHDJBPLTBCJ03FE9O2NS0BPOJVQCU2P (35 caract√®res).</p>
</dd>
<dt class="hdlist1">Indirect</dt>
<dd>
<p>Encode un identifiant qui se r√©sout en une adresse Ethereum via un fournisseur de registre de noms. Il utilise 16 caract√®res alphanum√©riques, comprenant un <em>identifiant d&#39;actif</em> (par exemple, ETH), un service de nom (par exemple, XREG) et un nom lisible par l&#39;homme √† 9 caract√®res (par exemple, KITTYCATS). Exemple¬†: XE##ETHXREGKITTYCATS (longueur de 20¬†caract√®res), o√π le ## doit √™tre remplac√© par les deux¬†caract√®res de la somme de contr√¥le calcul√©e.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-500">
<p>Nous pouvons utiliser l&#39;outil de ligne de commande helpeth pour cr√©er des adresses ICAP. Vous pouvez obtenir de l&#39;aide en l&#39;installant avec¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm install -g helpeth</strong>

</pre>
<div class="paragraph data-line-509">
<p>Si vous n&#39;avez pas npm, vous devrez peut-√™tre d&#39;abord installer nodeJS, ce que vous pouvez faire en suivant les instructions sur <a href="https://nodeJS.org" class="undefined" data-href="https://nodeJS.org">https://nodeJS.org</a>.</p>
</div>
<div class="paragraph data-line-511">
<p>Maintenant que nous avons helpeth, essayons de cr√©er une adresse ICAP avec notre exemple de cl√© priv√©e (pr√©fix√©e par 0x et pass√©e en param√®tre √† helpeth).</p>
</div>
<pre data-type="programlisting">
$ <strong>helpeth keyDetails \
  -p 0xf8f8a2f43c8376ccb0871305060d7b27b0554d2cc72bccf41b2705608452f315</strong>

Address: 0x001d3f1ef827552ae1114027bd3ecf1f086ba0f9
ICAP: XE60 HAMI CDXS V5QX VJA7 TJW4 7Q9C HWKJ D
Public key: 0x6e145ccef1033dea239875dd00dfb4fee6e3348b84985c92f103444683bae07b...

</pre>
<div class="paragraph data-line-525">
<p>La commande helpeth construit une adresse Ethereum hexad√©cimale ainsi qu&#39;une adresse ICAP pour nous. L&#39;adresse ICAP de notre exemple de cl√© est¬†:</p>
</div>
<div id="ICAP_example" class="listingblock data-line-528">
<div class="content">
<pre>XE60HAMICDXSV5QXVJA7TJW47Q9CHWKJD</pre>
</div>
</div>
<div class="paragraph data-line-532">
<p>√âtant donn√© que notre exemple d&#39;adresse Ethereum commence par un octet z√©ro, il peut √™tre encod√© √† l&#39;aide de la m√©thode d&#39;encodage Direct ICAP qui est valide au format IBAN. Vous pouvez le dire car il comporte 33 caract√®res.</p>
</div>
<div class="paragraph data-line-534">
<p>Si notre adresse ne commen√ßait pas par un z√©ro, elle serait encod√©e avec l&#39;encodage Basic, qui comporterait 35 caract√®res et serait invalide en tant qu&#39;IBAN.</p>
</div>
<div class="admonitionblock tip data-line-537">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-538">
<p>Les chances qu&#39;une adresse Ethereum commence par un octet z√©ro sont de 1 sur 256. Pour en g√©n√©rer une comme celle-l√†, il faudra en moyenne 256 tentatives avec 256 cl√©s priv√©es al√©atoires diff√©rentes avant d&#39;en trouver une qui fonctionne comme un type &quot;Direct&quot; compatible IBAN encod√© comme adresse ICAP.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-541">
<p>√Ä l&#39;heure actuelle, ICAP n&#39;est malheureusement pris en charge que par quelques portefeuilles.</p>
</div>
</div>
<div class="sect3 data-line-544">
<h4 id="EIP55">Encodage hexad√©cimal avec somme de contr√¥le en majuscules (EIP-55)</h4>
<div class="paragraph data-line-546">
<p>En raison de la lenteur du d√©ploiement d&#39;ICAP et des services de noms, une norme a √©t√© propos√©e par la <a href="https://github.com/Ethereum/EIPs/blob/master/EIPS/eip-55.md" data-href="https://github.com/Ethereum/EIPs/blob/master/EIPS/eip-55.md">Proposition d&#39;am√©lioration d&#39;Ethereum 55 (EIP-55)</a>. EIP-55 offre une somme de contr√¥le r√©trocompatible pour les adresses Ethereum en modifiant la capitalisation de l&#39;adresse hexad√©cimale. L&#39;id√©e est que les adresses Ethereum sont insensibles √† la casse et que tous les portefeuilles sont cens√©s accepter les adresses Ethereum exprim√©es en majuscules ou en minuscules, sans aucune diff√©rence d&#39;interpr√©tation.</p>
</div>
<div class="paragraph data-line-548">
<p>En modifiant la capitalisation des caract√®res alphab√©tiques dans l&#39;adresse, nous pouvons transmettre une somme de contr√¥le qui peut √™tre utilis√©e pour prot√©ger l&#39;int√©grit√© de l&#39;adresse contre les erreurs de frappe ou de lecture. Les portefeuilles qui ne prennent pas en charge les sommes de contr√¥le EIP-55 ignorent simplement le fait que l&#39;adresse contient des majuscules mixtes, mais ceux qui la prennent en charge peuvent la valider et d√©tecter les erreurs avec une pr√©cision de 99,986 %.</p>
</div>
<div class="paragraph data-line-550">
<p>L&#39;encodage en majuscules mixtes est subtil et vous ne le remarquerez peut-√™tre pas au d√©but. Notre exemple d&#39;adresse est¬†:</p>
</div>
<div class="listingblock data-line-552">
<div class="content">
<pre>0x001d3f1ef827552ae1114027bd3ecf1f086ba0f9</pre>
</div>
</div>
<div class="paragraph data-line-556">
<p>Avec une somme de contr√¥le √† capitalisation mixte EIP-55, cela devient¬†:</p>
</div>
<div id="mixed_capitalization" class="listingblock data-line-559">
<div class="content">
<pre>0x001d3F1ef827552Ae1114027BD3ECF1f086bA0F9</pre>
</div>
</div>
<div class="paragraph data-line-563">
<p>Pouvez-vous faire la diff√©rence? Certains des caract√®res alphab√©tiques (A √† F) de l&#39;alphabet de codage hexad√©cimal sont d√©sormais en majuscules, tandis que d&#39;autres sont en minuscules.</p>
</div>
<div class="paragraph data-line-565">
<p>EIP-55 est assez simple √† mettre en ≈ìuvre. Nous prenons le hachage Keccak-256 de l&#39;adresse hexad√©cimale minuscule. Ce hachage agit comme une empreinte num√©rique de l&#39;adresse, nous donnant une somme de contr√¥le pratique. Tout petit changement dans l&#39;entr√©e (l&#39;adresse) devrait entra√Æner un grand changement dans le hachage r√©sultant (la somme de contr√¥le), nous permettant de d√©tecter efficacement les erreurs. Le hachage de notre adresse est ensuite encod√© dans la capitalisation de l&#39;adresse elle-m√™me. D√©composons-le, √©tape par √©tape :</p>
</div>
<div class="olist arabic data-line-567">
<ol class="arabic">
<li class="data-line-567">
<p>Hachez l&#39;adresse en minuscules, sans le pr√©fixe 0x¬†:</p>
</li>
</ol>
</div>
<div id="hash_lower_case_address" class="listingblock data-line-570">
<div class="content">
<pre>Keccak256("001d3f1ef827552ae1114027bd3ecf1f086ba0f9") =
23a69c1653e4ebbb619b0b2cb8a9bad49892a8b9695d9a19d8f673ca991deae1</pre>
</div>
</div>
<div class="olist arabic data-line-576">
<ol class="arabic" start="2">
<li class="data-line-576">
<p>Mettez en majuscule chaque caract√®re d&#39;adresse alphab√©tique si le chiffre hexad√©cimal correspondant du hachage est sup√©rieur ou √©gal √† 0x8. C&#39;est plus facile √† montrer si nous alignons l&#39;adresse et le hachage¬†:</p>
</li>
</ol>
</div>
<div id="capitalize_input" class="listingblock data-line-579">
<div class="content">
<pre>Adresse : 001d3f1ef827552ae1114027bd3ecf1f086ba0f9
Hachage : 23a69c1653e4ebbb619b0b2cb8a9bad49892a8b9...</pre>
</div>
</div>
<div class="paragraph data-line-584">
<p>Notre adresse contient un caract√®re alphab√©tique d en quatri√®me position. Le quatri√®me caract√®re du hachage est 6, qui est inf√©rieur √† 8. Donc, nous laissons le d minuscule. Le prochain caract√®re alphab√©tique de notre adresse est f, en sixi√®me position. Le sixi√®me caract√®re du hachage hexad√©cimal est c, qui est sup√©rieur √† 8. Par cons√©quent, nous capitalisons le F dans l&#39;adresse, et ainsi de suite. Comme vous pouvez le voir, nous n&#39;utilisons que les 20 premiers octets (40 caract√®res hexad√©cimaux) du hachage comme somme de contr√¥le, car nous n&#39;avons que 20 octets (40 caract√®res hexad√©cimaux) dans l&#39;adresse √† capitaliser de mani√®re appropri√©e.</p>
</div>
<div class="paragraph data-line-586">
<p>V√©rifiez vous-m√™me l&#39;adresse en majuscules mixtes r√©sultante et voyez si vous pouvez dire quels caract√®res ont √©t√© en majuscules et √† quels caract√®res ils correspondent dans le hachage de l&#39;adresse¬†:</p>
</div>
<div id="capitalize_output" class="listingblock data-line-589">
<div class="content">
<pre>Adresse : 001d3F1ef827552Ae1114027BD3ECF1f086bA0F9
Hachage : 23a69c1653e4ebbb619b0b2cb8a9bad49892a8b9...</pre>
</div>
</div>
<div class="sect4 data-line-595">
<h5 id="EIP55_error">D√©tection d&#39;une erreur dans une adresse encod√©e EIP-55</h5>
<div class="paragraph data-line-597">
<p>Maintenant, regardons comment les adresses EIP-55 nous aideront √† trouver une erreur. Supposons que nous ayons imprim√© une adresse Ethereum, qui est cod√©e EIP-55¬†:</p>
</div>
<div id="correct_address" class="listingblock data-line-600">
<div class="content">
<pre>0x001d3F1ef827552Ae1114027BD3ECF1f086bA0F9</pre>
</div>
</div>
<div class="paragraph data-line-604">
<p>Faisons maintenant une erreur fondamentale en lisant cette adresse. Le caract√®re avant le dernier est un F majuscule. Pour cet exemple, supposons que nous interpr√©tions cela comme un E majuscule et que nous tapions l&#39;adresse suivante (incorrecte) dans notre portefeuille¬†:</p>
</div>
<div id="incorrect_address" class="listingblock data-line-607">
<div class="content">
<pre>0x001d3F1ef827552Ae1114027BD3ECF1f086bA0E9</pre>
</div>
</div>
<div class="paragraph data-line-611">
<p>Heureusement, notre portefeuille est conforme √† la norme EIP-55¬†! Il remarque les majuscules mixtes et tente de valider l&#39;adresse. Il le convertit en minuscules et calcule le hachage de la somme de contr√¥le¬†:</p>
</div>
<div id="hash_demo" class="listingblock data-line-614">
<div class="content">
<pre>Keccak256("001d3f1ef827552ae1114027bd3ecf1f086ba0e9") =
5429b5d9460122fb4b11af9cb88b7bb76d8928862e0a57d46dd18dd8e08a6927</pre>
</div>
</div>
<div class="paragraph data-line-619">
<p>Comme vous pouvez le voir, m√™me si l&#39;adresse n&#39;a chang√© que d&#39;un caract√®re (en fait, un seul bit, car e et f sont s√©par√©s d&#39;un bit), le hachage de l&#39;adresse a radicalement chang√©. C&#39;est la propri√©t√© des fonctions de hachage qui les rend si utiles pour les sommes de contr√¥le¬†!</p>
</div>
<div class="paragraph data-line-621">
<p>Maintenant, alignons les deux et v√©rifions la capitalisation¬†:</p>
</div>
<div id="incorrect_capitalization" class="listingblock data-line-624">
<div class="content">
<pre>001d3F1ef827552Ae1114027BD3ECF1f086bA0E9
5429b5d9460122fb4b11af9cb88b7bb76d892886...</pre>
</div>
</div>
<div class="paragraph data-line-629">
<p>C&#39;est tout faux! Plusieurs des caract√®res alphab√©tiques sont mal capitalis√©s. N&#39;oubliez pas que la capitalisation est l&#39;encodage de la somme de contr√¥le <em>correcte</em>.</p>
</div>
<div class="paragraph data-line-631">
<p>La casse de l&#39;adresse que nous avons saisie ne correspond pas √† la somme de contr√¥le que nous venons de calculer, ce qui signifie que quelque chose a chang√© dans l&#39;adresse et qu&#39;une erreur a √©t√© <span class="keep-together">introduite</span>.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-635">
<h3 id="keys-addresses-conclusions">Conclusion</h3>
<div class="paragraph data-line-11">
<p>Dans ce chapitre, nous avons fourni un bref aper√ßu de la cryptographie √† cl√© publique et nous nous sommes concentr√©s sur l&#39;utilisation des cl√©s publiques et priv√©es dans Ethereum et l&#39;utilisation d&#39;outils cryptographiques, tels que les fonctions de hachage, dans la cr√©ation et la v√©rification des adresses Ethereum. Nous avons √©galement examin√© les signatures num√©riques et comment elles peuvent d√©montrer la propri√©t√© d&#39;une cl√© priv√©e sans r√©v√©ler cette cl√© priv√©e. Dans <a href="#wallets_chapter">Portefeuilles</a>, nous allons rassembler ces id√©es et voir comment les portefeuilles peuvent √™tre utilis√©s pour g√©rer les collections de cl√©s.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="wallets_chapter">Portefeuilles</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Le mot &quot;portefeuille&quot; est utilis√© pour d√©crire quelques choses diff√©rentes dans Ethereum.</p>
</div>
<div class="paragraph data-line-6">
<p>√Ä un niveau √©lev√©, un portefeuille est une application logicielle qui sert d&#39;interface utilisateur principale √† Ethereum. Le portefeuille contr√¥le l&#39;acc√®s √† l&#39;argent d&#39;un utilisateur, g√®re les cl√©s et les adresses, suit le solde et cr√©e et signe des transactions. De plus, certains portefeuilles Ethereum peuvent √©galement interagir avec des contrats, tels que les jetons ERC20.</p>
</div>
<div class="paragraph data-line-8">
<p>Plus √©troitement, du point de vue d&#39;un programmeur, le mot <em>wallet</em> ou <em>portefeuille</em> fait r√©f√©rence au syst√®me utilis√© pour stocker et g√©rer les cl√©s d&#39;un utilisateur. Chaque portefeuille a un composant de gestion des cl√©s. Pour certains portefeuilles, c&#39;est tout ce qu&#39;il y a. D&#39;autres portefeuilles font partie d&#39;une cat√©gorie beaucoup plus large, celle des <em>navigateurs</em>, qui sont des interfaces vers des applications d√©centralis√©es bas√©es sur Ethereum, ou <em>DApps</em>, que nous examinerons plus en d√©tail dans <a href="#decentralized_applications_chap">Applications d√©centralis√©es (DApps)</a>. Il n&#39;y a pas de lignes de distinction claires entre les diff√©rentes cat√©gories qui sont regroup√©es sous le terme portefeuille.</p>
</div>
<div class="paragraph data-line-10">
<p>Dans ce chapitre, nous examinerons les portefeuilles en tant que conteneurs de cl√©s priv√©es et en tant que syst√®mes de gestion de ces cl√©s.</p>
</div>
<div class="sect2 data-line-13">
<h3 id="wallet_tech_overview">Pr√©sentation de la technologie de portefeuille</h3>
<div class="paragraph data-line-15">
<p> Dans cette section, nous r√©sumons les diff√©rentes technologies utilis√©es pour construire des portefeuilles Ethereum conviviaux, s√©curis√©s et flexibles.</p>
</div>
<div class="paragraph data-line-17">
<p>L&#39;une des principales consid√©rations dans la conception des portefeuilles est l&#39;√©quilibre entre commodit√© et confidentialit√©. Le portefeuille Ethereum le plus pratique est celui avec une cl√© priv√©e unique et une adresse que vous r√©utilisez pour tout. Malheureusement, une telle solution est un cauchemar pour la confidentialit√©, car n&#39;importe qui peut facilement suivre et corr√©ler toutes vos transactions. L&#39;utilisation d&#39;une nouvelle cl√© pour chaque transaction est pr√©f√©rable pour la confidentialit√©, mais devient tr√®s difficile √† g√©rer. Le bon √©quilibre est difficile √† atteindre, mais c&#39;est pourquoi une bonne conception de portefeuille est primordiale.</p>
</div>
<div class="paragraph data-line-19">
<p>Une id√©e fausse courante √† propos d&#39;Ethereum est que les portefeuilles Ethereum contiennent de l&#39;ether ou des jetons. En fait, tr√®s strictement parlant, le portefeuille ne contient que des cl√©s. L&#39;ether ou d&#39;autres jetons sont enregistr√©s sur la blockchain Ethereum. Les utilisateurs contr√¥lent les jetons sur le r√©seau en signant des transactions avec les cl√©s dans leurs portefeuilles. Dans un sens, un portefeuille Ethereum est un <em>porte-cl√©s</em>. Cela dit, √©tant donn√© que les cl√©s d√©tenues par le portefeuille sont les seules choses n√©cessaires pour transf√©rer de l&#39;ether ou des jetons √† d&#39;autres, en pratique, cette distinction est assez peu pertinente. L√† o√π la diff√©rence est importante, c&#39;est dans le fait de changer d&#39;√©tat d&#39;esprit et de ne plus avoir affaire au syst√®me bancaire conventionnel centralis√© (o√π seuls vous et la banque pouvez voir l&#39;argent sur votre compte, et vous n&#39;avez qu&#39;√† convaincre la banque que vous voulez transf√©rer des fonds pour faire une transaction) vers un syst√®me d√©centralis√© des plates-formes cha√Æne de blocs (o√π tout le monde peut voir le solde d&#39;un compte, bien qu&#39;il ne connaisse probablement pas le propri√©taire du compte, et tout le monde doit √™tre convaincu que le propri√©taire veut d√©placer des fonds pour une transaction √©dict√©e). En pratique, cela signifie qu&#39;il existe un moyen ind√©pendant de v√©rifier le solde d&#39;un compte, sans avoir besoin de son portefeuille. De plus, vous pouvez d√©placer la gestion de votre compte de votre portefeuille actuel vers un autre portefeuille, si vous n&#39;aimez plus l&#39;application de portefeuille que vous avez commenc√© √† utiliser.</p>
</div>
<div class="admonitionblock note data-line-22">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-23">
<p>Les portefeuilles Ethereum contiennent des cl√©s, pas d&#39;ether ni de jetons. Les portefeuilles sont comme des porte-cl√©s contenant des paires de cl√©s priv√©es et publiques. Les utilisateurs signent des transactions avec les cl√©s priv√©es, prouvant ainsi qu&#39;ils poss√®dent l&#39;ether. L&#39;ether est stock√© sur la cha√Æne de blocs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-26">
<p>Il existe deux principaux types de portefeuilles, qui se distinguent par le fait que les cl√©s qu&#39;ils contiennent sont li√©es ou non.</p>
</div>
<div class="paragraph data-line-28">
<p>Le premier type est un <em>portefeuille non d√©terministe</em>, o√π chaque cl√© est g√©n√©r√©e ind√©pendamment √† partir d&#39;un nombre al√©atoire diff√©rent . Les cl√©s ne sont pas li√©es les unes aux autres.  Ce type de portefeuille est √©galement connu sous le nom de portefeuille JBOK, de l&#39;expression "Just a Bunch Of Keys" ou &quot;Juste un tas de cl√©s&quot;.</p>
</div>
<div class="paragraph data-line-30">
<p>Le deuxi√®me type de portefeuille est un <em>portefeuille d√©terministe</em>, o√π toutes les cl√©s sont d√©riv√©es d&#39;une seule cl√© ma√Ætresse, connue sous le nom de <em>seed</em> ou <em>graine</em> ou <em>valeur d&#8217;amor√ßage</em>. Toutes les cl√©s de ce type de portefeuille sont li√©es les unes aux autres et peuvent √™tre g√©n√©r√©es √† nouveau si l&#39;on dispose de la valeur d&#8217;amor√ßage d&#39;origine.  Il existe un certain nombre de m√©thodes diff√©rentes de <em>d√©rivation de cl√©</em> utilis√©es dans les portefeuilles d√©terministes. La m√©thode de d√©rivation la plus couramment utilis√©e utilise une structure arborescente, comme d√©crit dans <a href="#hd_wallets">Portefeuilles d√©terministes hi√©rarchiques (BIP-32/BIP-44)</a>.</p>
</div>
<div class="paragraph data-line-32">
<p>Pour rendre les portefeuilles d√©terministes l√©g√®rement plus s√ªrs contre les accidents de perte de donn√©es, comme le vol de votre t√©l√©phone ou sa chute dans les toilettes, les valeurs d&#8217;amor√ßages sont souvent encod√©es sous la forme d&#39;une liste de mots (en anglais ou dans une autre langue) √† noter et √† utiliser en cas d&#39;accident. Ceux-ci sont connus sous le nom de <em>mots de code mn√©moniques</em> du portefeuille. Bien s√ªr, si quelqu&#39;un met la main sur vos mots de code mn√©moniques, il peut √©galement recr√©er votre portefeuille et ainsi acc√©der √† vos contrats intelligents et votre ether. En tant que tel, soyez tr√®s, tr√®s prudent avec votre liste de mots de r√©cup√©ration ! Ne les stockez jamais √©lectroniquement, dans un fichier, sur votre ordinateur ou votre t√©l√©phone. √âcrivez-le sur papier et rangez-le dans un endroit s√ªr et s√©curis√©.</p>
</div>
<div class="paragraph data-line-34">
<p>Les prochaines sections pr√©sentent chacune de ces technologies √† un niveau √©lev√©.</p>
</div>
<div class="sect3 data-line-38">
<h4 id="random_wallet">Portefeuilles non d√©terministes (al√©atoires)</h4>
<div class="paragraph data-line-40">
<p>Dans le premier portefeuille Ethereum (produit pour la pr√©vente Ethereum), chaque fichier de portefeuille stockait une seule cl√© priv√©e g√©n√©r√©e al√©atoirement. Ces portefeuilles sont remplac√©s par des portefeuilles d√©terministes car ces portefeuilles &quot;√† l&#39;ancienne&quot; sont √† bien des √©gards inf√©rieurs. Par exemple, il est consid√©r√© comme une bonne pratique d&#39;√©viter la r√©utilisation de l&#39;adresse Ethereum dans le cadre de la maximisation de votre vie priv√©e lors de l&#39;utilisation d&#39;Ethereum, c&#39;est-√†-dire d&#39;utiliser une nouvelle adresse (qui n√©cessite une nouvelle cl√© priv√©e) chaque fois que vous recevez des fonds. Vous pouvez aller plus loin et utiliser une nouvelle adresse pour chaque transaction, bien que cela puisse co√ªter cher si vous traitez beaucoup de jetons. Pour suivre cette pratique, un portefeuille non d√©terministe devra r√©guli√®rement augmenter sa liste de cl√©s, ce qui signifie que vous devrez effectuer des sauvegardes r√©guli√®res. Si jamais vous perdez vos donn√©es (panne de disque, accident d&#8217;abus de boisson, vol de t√©l√©phone) avant d&#39;avoir r√©ussi √† sauvegarder votre portefeuille, vous perdrez l&#39;acc√®s √† vos fonds et √† vos contrats intelligents. Les portefeuilles non d√©terministes de &quot;type 0&quot; sont les plus difficiles √† g√©rer, car ils cr√©ent un nouveau fichier de portefeuille pour chaque nouvelle adresse de mani√®re &quot;juste √† temps&quot;.</p>
</div>
<div class="paragraph data-line-42">
<p>N√©anmoins, de nombreux clients Ethereum (y compris geth) utilisent un fichier <em>keystore</em> ou <em>magasin de cl√©s</em>, qui est un fichier cod√© JSON contenant une cl√© priv√©e unique (g√©n√©r√©e de mani√®re al√©atoire), chiffr√©e par une phrase secr√®te pour plus de s√©curit√© . Le contenu du fichier JSON ressemble √† ceci¬†:</p>
</div>
<div id="keystore_example" class="listingblock data-line-46">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "address": "001d3f1ef827552ae1114027bd3ecf1f086ba0f9",
    "crypto": {
        "cipher": "aes-128-ctr",
        "ciphertext":
            "233a9f4d236ed0c13394b504b6da5df02587c8bf1ad8946f6f2b58f055507ece",
        "cipherparams": {
            "iv": "d10c6ec5bae81b6cb9144de81037fa15"
        },
        "kdf": "scrypt",
        "kdfparams": {
            "dklen": 32,
            "n": 262144,
            "p": 1,
            "r": 8,
            "salt":
                "99d37a47c7c9429c66976f643f386a61b78b97f3246adca89abe4245d2788407"
        },
        "mac": "594c8df1c8ee0ded8255a50caf07e8c12061fd859f4b7c76ab704b17c957e842"
    },
    "id": "4fcb2ba4-ccdb-424f-89d5-26cce304bf9c",
    "version": 3
}</code></pre>
</div>
</div>
<div class="paragraph data-line-72">
<p>Le format de magasin de cl√©s utilise une <em>fonction de d√©rivation de cl√©</em> (KDF ou key derivation function), √©galement connue sous le nom d&#39;algorithme d&#39;√©tirement de mot de passe, qui prot√®ge contre les attaques par force, par dictionnaire et par table arc-en-ciel. En termes simples, la cl√© priv√©e n&#39;est pas chiffr√©e directement par la phrase secr√®te. Au lieu de cela, la phrase secr√®te est <em>√©tir√©e</em>, en la hachant √† plusieurs reprises. La fonction de hachage est r√©p√©t√©e pendant 262 144 tours, ce qui peut √™tre vu dans le magasin de cl√©s JSON sous la forme du param√®tre crypto.kdfparams.n. Un attaquant essayant de forcer brutalement la phrase secr√®te devrait appliquer 262 144 cycles de hachage pour chaque phrase secr√®te tent√©e, ce qui ralentit suffisamment l&#39;attaque pour la rendre impossible pour les phrases secr√®tes d&#39;une complexit√© et d&#39;une longueur suffisantes.</p>
</div>
<div class="paragraph data-line-74">
<p>Il existe un certain nombre de biblioth√®ques logicielles qui peuvent lire et √©crire le format keystore, comme la biblioth√®que JavaScript <a href="https://github.com/ethereumjs/keythereum" data-href="https://github.com/ethereumjs/keythereum">keythereum</a>.</p>
</div>
<div class="admonitionblock tip data-line-77">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-78">
<p>L&#39;utilisation de portefeuilles non d√©terministes est d√©conseill√©e pour autre chose que de simples tests. Ils sont trop encombrants pour √™tre sauvegard√©s et utilis√©s pour autre chose que les situations les plus √©l√©mentaires. Utilisez plut√¥t un portefeuille HD standard avec une valeur d&#8217;amor√ßage mn√©monique pour la sauvegarde.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-82">
<h4 id="deterministic_wallets">Portefeuilles d√©terministes (par valeur d&#8217;amor√ßage)</h4>
<div class="paragraph data-line-84">
<p>Les portefeuilles d√©terministes ou &quot;ensemenc√©s par valeurs d&#8217;amor√ßages&quot; sont des portefeuilles qui contiennent des cl√©s priv√©es qui sont toutes d√©riv√©es d&#39;une seule cl√© ma√Ætresse ou valeur d&#8217;amor√ßage. La valeur d&#8217;amor√ßage est un nombre g√©n√©r√© al√©atoirement qui est combin√© avec d&#39;autres donn√©es, telles qu&#39;un num√©ro d&#39;index ou un &quot;code de cha√Æne&quot; (voir <a href="#extended_keys">Cl√©s publiques et priv√©es √©tendues</a>), pour d√©river n&#39;importe quel nombre de cl√©s priv√©es. Dans un portefeuille d√©terministe, la valeur d&#8217;amor√ßage est suffisante pour r√©cup√©rer toutes les cl√©s d√©riv√©es, et donc une seule sauvegarde, au moment de la cr√©ation, est suffisante pour s√©curiser tous les fonds et contrats intelligents dans le portefeuille. La valeur d&#8217;amor√ßage est √©galement suffisante pour une exportation ou une importation de portefeuille, permettant une migration facile de toutes les cl√©s entre diff√©rentes impl√©mentations de portefeuille.</p>
</div>
<div class="paragraph data-line-86">
<p>Cette conception rend la s√©curit√© de la valeur d&#8217;amor√ßage d&#8217;une plus haute importance, car seule la valeur d&#8217;amor√ßage est n√©cessaire pour acc√©der √† l&#39;ensemble du portefeuille. D&#39;un autre c√¥t√©, le fait de pouvoir concentrer les efforts de s√©curit√© sur une seule donn√©e peut √™tre consid√©r√© comme un avantage.</p>
</div>
</div>
<div class="sect3 data-line-89">
<h4 id="hd_wallets">Portefeuilles d√©terministes hi√©rarchiques (BIP-32/BIP-44)</h4>
<div class="paragraph data-line-91">
<p>Les portefeuilles d√©terministes ont √©t√© d√©velopp√©s pour faciliter la d√©rivation de nombreuses cl√©s √† partir d&#39;une seule valeur d&#8217;amor√ßage. Actuellement, la forme la plus avanc√©e de portefeuille d√©terministe est le portefeuille <em>hi√©rarchique d√©terministe</em> (HD ou Hierarchical Deterministic) d√©fini par le <a href="http://bit.ly/2B2vQWs" data-href="http://bit.ly/2B2vQWs"><em>standard BIP-32</em></a> de Bitcoin. Les portefeuilles HD contiennent des cl√©s d√©riv√©es dans une structure arborescente, de sorte qu&#39;une cl√© parent peut d√©river une s√©quence de cl√©s enfants, chacune pouvant d√©river une s√©quence de cl√©s petits-enfants, et ainsi de suite. Cette arborescence est illustr√©e dans <a href="#hd_wallets_figure">Portefeuille HD¬†: un arbre de cl√©s g√©n√©r√© √† partir d&#39;une seule valeur d&#8217;amor√ßage</a>.</p>
</div>
<div id="hd_wallets_figure" class="imageblock data-line-95">
<div class="content">
<img src="images/hd_wallet.png" alt="&quot;Portefeuille HD&quot;">
</div>
<div class="title">Figure 27. Portefeuille HD¬†: un arbre de cl√©s g√©n√©r√© √† partir d&#39;une seule valeur d&#8217;amor√ßage</div>
</div>
<div class="paragraph data-line-97">
<p>Les portefeuilles HD offrent quelques avantages cl√©s par rapport aux portefeuilles d√©terministes plus simples. Tout d&#39;abord, la structure arborescente peut √™tre utilis√©e pour exprimer une signification organisationnelle suppl√©mentaire, par exemple lorsqu&#39;une branche sp√©cifique de sous-cl√©s est utilis√©e pour recevoir des paiements entrants et qu&#39;une branche diff√©rente est utilis√©e pour recevoir la monnaie des paiements sortants. Les branches de cl√©s peuvent √©galement √™tre utilis√©es dans les param√®tres de l&#39;entreprise, en attribuant diff√©rentes branches √† des d√©partements, des filiales, des fonctions sp√©cifiques ou des cat√©gories comptables.</p>
</div>
<div class="paragraph data-line-99">
<p>Le deuxi√®me avantage des portefeuilles HD est que les utilisateurs peuvent cr√©er une s√©quence de cl√©s publiques sans avoir acc√®s aux cl√©s priv√©es correspondantes. Cela permet aux portefeuilles HD d&#39;√™tre utilis√©s sur un serveur non s√©curis√© ou dans une capacit√© de surveillance ou de r√©ception uniquement, o√π le portefeuille n&#39;a pas les cl√©s priv√©es qui peuvent d√©penser les fonds.</p>
</div>
</div>
<div class="sect3 data-line-102">
<h4 id="mnemonic_codes">Valeurs d&#8217;amor√ßage et codes mn√©moniques (BIP-39)</h4>
<div class="paragraph data-line-104">
<p>Il y a beaucoup de mani√®res d&#39;encoder une cl√© priv√©e pour une sauvegarde et une r√©cup√©ration s√©curis√©es. La m√©thode actuellement pr√©f√©r√©e consiste √† utiliser une s√©quence de mots qui, lorsqu&#39;ils sont pris ensemble dans le bon ordre, peuvent recr√©er de mani√®re unique la cl√© priv√©e. Ceci est parfois connu sous le nom de <em>mn√©monique</em>, et l&#39;approche a √©t√© normalis√©e par <a href="http://bit.ly/2OEMjUz" data-href="http://bit.ly/2OEMjUz">BIP-39</a>. Aujourd&#39;hui, de nombreux portefeuilles Ethereum (ainsi que des portefeuilles pour d&#39;autres crypto-monnaies) utilisent cette norme et peuvent importer et exporter des valeurs d&#8217;amor√ßage pour la sauvegarde et la r√©cup√©ration √† l&#39;aide de mn√©moniques interop√©rables.</p>
</div>
<div class="paragraph data-line-106">
<p>Pour comprendre pourquoi cette approche est devenue populaire, examinons un exemple¬†:</p>
</div>
<div id="hex_seed_example" class="listingblock data-line-110">
<div class="title">Une valeur d&#8217;amor√ßage pour un portefeuille d√©terministe, en hexad√©cimal</div>
<div class="content">
<pre>FCCF1AB3329FD5DA3DA9577511F8F137</pre>
</div>
</div>
<div id="mnemonic_seed_example" class="listingblock data-line-116">
<div class="title">Une valeur d&#8217;amor√ßage pour un portefeuille d√©terministe, √† partir d&#39;un mn√©monique de 12 mots</div>
<div class="content">
<pre>wolf juice proud gown wool unfair
wall cliff insect more detail hub</pre>
</div>
</div>
<div class="paragraph data-line-121">
<p>En termes pratiques, le risque d&#39;erreur lors de l&#39;√©criture de la s√©quence hexad√©cimale est inacceptablement √©lev√©. En revanche, la liste des mots connus est assez facile √† g√©rer, principalement parce qu&#39;il y a une forte redondance dans l&#39;√©criture des mots (surtout des mots anglais). Si ¬´ inzect ¬ª avait √©t√© enregistr√© par accident, il pourrait √™tre rapidement d√©termin√©, lors de la r√©cup√©ration du portefeuille, que ¬´ inzect ¬ª n&#39;est pas un mot anglais valide et que ¬´ insect ¬ª devrait √™tre utilis√© √† la place. Nous parlons d&#39;√©crire une repr√©sentation de la valeur d&#8217;amor√ßage car c&#39;est une bonne pratique lors de la gestion des portefeuilles HD¬†: la valeur d&#8217;amor√ßage est n√©cessaire pour r√©cup√©rer un portefeuille en cas de perte de donn√©es (que ce soit par accident ou par vol), il est donc tr√®s prudent de conserver une sauvegarde. Cependant, la valeur d&#8217;amor√ßage doit rester extr√™mement priv√©e, les sauvegardes num√©riques doivent donc √™tre soigneusement √©vit√©es¬†; d&#39;o√π le conseil pr√©c√©dent de sauvegarder avec un stylo et du papier.</p>
</div>
<div class="paragraph data-line-123">
<p>En r√©sum√©, l&#39;utilisation d&#39;une liste de mots de r√©cup√©ration pour coder la valeur d&#8217;amor√ßage d&#39;un portefeuille HD constitue le moyen le plus simple d&#39;exporter, de transcrire, d&#39;enregistrer sur papier en toute s√©curit√©, de lire sans erreur et d&#39;importer un ensemble de cl√©s priv√©es dans un autre portefeuille.</p>
</div>
</div>
</div>
<div class="sect2 data-line-127">
<h3 id="wallet_best_practices">Meilleures pratiques de portefeuille</h3>
<div class="paragraph data-line-129">
<p>Alors que la technologie des portefeuilles de cryptomonnaie a m√ªri, certaines normes industrielles communes ont √©merg√© qui rendent les portefeuilles largement interop√©rables, faciles √† utiliser, s√©curis√© et flexible. Ces normes permettent √©galement aux portefeuilles de d√©river des cl√©s pour plusieurs cryptomonnaies diff√©rentes, toutes √† partir d&#39;un seul mn√©monique. Ces normes communes sont :</p>
</div>
<div class="ulist data-line-131">
<ul>
<li class="data-line-131">
<p>Mots de code mn√©monique, bas√©s sur BIP-39</p>
</li>
<li class="data-line-132">
<p>Portefeuilles HD, bas√©s sur BIP-32</p>
</li>
<li class="data-line-133">
<p>Structure de portefeuille HD polyvalente, bas√©e sur BIP-43</p>
</li>
<li class="data-line-134">
<p>Portefeuilles multidevises et multicomptes, bas√©s sur BIP-44</p>
</li>
</ul>
</div>
<div class="paragraph data-line-136">
<p>Ces normes peuvent changer ou √™tre obsol√®tes par les d√©veloppements futurs, mais pour l&#39;instant, elles forment un ensemble de technologies imbriqu√©es qui sont devenues la norme <em>de facto</em> de portefeuille pour la plupart des plateformes de cha√Æne de blocs et leurs cryptomonnaies.</p>
</div>
<div class="paragraph data-line-138">
<p>Les normes ont √©t√© adopt√©es par une large gamme de portefeuilles logiciels et mat√©riels, rendant tous ces portefeuilles interop√©rables. Un utilisateur peut exporter un mn√©monique g√©n√©r√© dans l&#39;un de ces portefeuilles et l&#39;importer dans un autre portefeuille, en r√©cup√©rant toutes les cl√©s et adresses.</p>
</div>
<div class="paragraph data-line-140">
<p>Quelques exemples de portefeuilles logiciels prenant en charge ces normes incluent (class√©s par ordre alphab√©tique) Jaxx, MetaMask, MyCrypto et MyEtherWallet (MEW). Les exemples de portefeuilles mat√©riels prenant en charge ces normes incluent Keepkey, Ledger et Trezor.</p>
</div>
<div class="paragraph data-line-142">
<p>Les sections suivantes examinent chacune de ces technologies en d√©tail.</p>
</div>
<div class="admonitionblock tip data-line-145">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-146">
<p>Si vous impl√©mentez un portefeuille Ethereum, il doit √™tre construit comme un portefeuille HD, avec une valeur d&#8217;amor√ßage encod√©e sous forme de code mn√©monique pour la sauvegarde, conform√©ment aux normes BIP-32, BIP-39, BIP-43 et BIP-44, comme d√©crit dans les rubriques suivantes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-151">
<h4 id="mnemonic_code_words">Mots de code mn√©monique (BIP-39)</h4>
<div class="paragraph data-line-153">
<p> Les mots de code mn√©moniques sont des s√©quences de mots qui encodent un nombre al√©atoire utilis√© comme valeur d&#8217;amor√ßage pour d√©river un portefeuille d√©terministe. La s√©quence de mots est suffisante pour recr√©er la valeur d&#8217;amor√ßage, et √† partir de l√† recr√©er le portefeuille et toutes les cl√©s d√©riv√©es. Une application de portefeuille qui impl√©mente des portefeuilles d√©terministes avec des mots mn√©moniques montrera √† l&#39;utilisateur une s√©quence de 12 √† 24 mots lors de la premi√®re cr√©ation d&#39;un portefeuille. Cette s√©quence de mots est la sauvegarde du portefeuille et peut √™tre utilis√©e pour r√©cup√©rer et recr√©er toutes les cl√©s dans la m√™me application de portefeuille ou dans n&#39;importe quelle application de portefeuille compatible. Comme nous l&#39;avons expliqu√© pr√©c√©demment, les listes de mots mn√©moniques facilitent la sauvegarde des portefeuilles par les utilisateurs, car elles sont faciles √† lire et correctement <span class="keep-together">transcrire</span>.</p>
</div>
<div class="admonitionblock note data-line-156">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-157">
<p> Les mots mn√©moniques sont souvent confondus avec les &quot;brainwallets&quot;. Ils ne sont pas les m√™mes. La principale diff√©rence est qu&#39;un brainwallet se compose de mots choisis par l&#39;utilisateur, tandis que les mots mn√©moniques sont cr√©√©s de mani√®re al√©atoire par le portefeuille et pr√©sent√©s √† l&#39;utilisateur. Cette diff√©rence importante rend les mots mn√©moniques beaucoup plus s√ªrs, car les humains sont de tr√®s mauvaises sources d&#39;al√©atoire. Peut-√™tre plus important encore, l&#39;utilisation du terme &quot;brainwallet&quot; sugg√®re que les mots doivent √™tre m√©moris√©s, ce qui est une id√©e terrible et une recette pour ne pas avoir votre sauvegarde lorsque vous en avez besoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-160">
<p>Les codes mn√©moniques sont d√©finis dans le BIP-39. Notez que BIP-39 est une impl√©mentation d&#39;une norme de code mn√©monique. Il existe une norme diff√©rente, <em>avec un ensemble de mots diff√©rent</em>, utilis√©e par le portefeuille Electrum Bitcoin et ant√©rieure √† BIP-39. BIP-39 a √©t√© propos√© par la soci√©t√© √† l&#39;origine du portefeuille mat√©riel Trezor et est incompatible avec la mise en ≈ìuvre d&#39;Electrum. Cependant, BIP-39 a maintenant obtenu un large soutien de l&#39;industrie √† travers des dizaines d&#39;impl√©mentations interop√©rables et devrait √™tre consid√©r√© comme la norme <em>de facto</em> industrielle. De plus, BIP-39 peut √™tre utilis√© pour produire des portefeuilles multidevises prenant en charge Ethereum, contrairement aux valeurs d&#8217;amor√ßage Electrum.</p>
</div>
<div class="paragraph data-line-162">
<p>La BIP-39 d√©finit la cr√©ation d&#39;un code mn√©monique et d&#39;une valeur d&#8217;amor√ßage, que nous d√©crivons ici en neuf √©tapes. Pour plus de clart√©, le processus est divis√© en deux parties : les √©tapes 1 √† 6 sont pr√©sent√©es dans <a href="#generating_mnemonic_words">G√©n√©ration de mots mn√©moniques</a> et les √©tapes 7 √† 9 sont illustr√©es dans <a href="#mnemonic_to_seed">Du mn√©monique √† la valeur d&#8217;amor√ßage</a>.</p>
</div>
<div class="sect4 data-line-165">
<h5 id="generating_mnemonic_words">G√©n√©ration de mots mn√©moniques</h5>
<div class="paragraph data-line-167">
<p>Les mots mn√©moniques sont g√©n√©r√©s automatiquement par le portefeuille en utilisant le processus standardis√© d√©fini dans BIP-39. Le portefeuille part d&#39;une source d&#39;entropie, ajoute une somme de contr√¥le, puis mappe l&#39;entropie sur une liste de mots¬†:</p>
</div>
<div class="olist arabic data-line-169">
<ol class="arabic">
<li class="data-line-169">
<p>Cr√©er une s√©quence cryptographiquement al√©atoire S de 128 √† 256 bits.</p>
</li>
<li class="data-line-170">
<p>Cr√©ez une somme de contr√¥le de S en prenant la premi√®re longueur de S √∑ 32 bits du hachage SHA-256 de S.</p>
</li>
<li class="data-line-171">
<p>Ajoutez la somme de contr√¥le √† la fin de la s√©quence al√©atoire S.</p>
</li>
<li class="data-line-172">
<p>Divisez la concat√©nation de s√©quence et de somme de contr√¥le en sections de 11 bits.</p>
</li>
<li class="data-line-173">
<p>Associez chaque valeur 11 bits √† un mot du dictionnaire pr√©d√©fini de 2 048 mots.</p>
</li>
<li class="data-line-174">
<p>Cr√©ez le code mn√©monique √† partir de la s√©quence de mots en respectant l&#39;ordre.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-176">
<p><a href="#generating_entropy_and_encoding">G√©n√©ration d&#39;entropie et encodage sous forme de mots mn√©moniques</a> montre comment l&#39;entropie est utilis√©e pour g√©n√©rer des mots mn√©moniques.</p>
</div>
<div class="paragraph data-line-178">
<p><a href="#table_bip39_entropy">Codes mn√©moniques : entropie et longueur des mots</a> montre la relation entre la taille des donn√©es d&#39;entropie et la longueur des codes mn√©moniques en mots.</p>
</div>
<table id="table_bip39_entropy" class="tableblock frame-all grid-all stretch data-line-183">
<caption class="title">Table 3. Codes mn√©moniques : entropie et longueur des mots</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entropie (bits)</th>
<th class="tableblock halign-left valign-top">Somme de contr√¥le (bits)</th>
<th class="tableblock halign-left valign-top">Somme de contr√¥le d&#39;entropie <strong>+</strong> (bits)</th>
<th class="tableblock halign-left valign-top">Longueur mn√©monique (mots)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">165</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">198</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">231</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">264</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
</tbody>
</table>
<div id="generating_entropy_and_encoding" class="imageblock smallerseventy data-line-195">
<div class="content">
<img src="images/bip39-part1.png" alt="&quot;G√©n√©ration d&#39;entropie et encodage sous forme de mots mn√©moniques&quot;">
</div>
<div class="title">Figure 28. G√©n√©ration d&#39;entropie et encodage sous forme de mots mn√©moniques</div>
</div>
</div>
<div class="sect4 data-line-198">
<h5 id="mnemonic_to_seed">Du mn√©monique √† la valeur d&#8217;amor√ßage</h5>
<div class="paragraph data-line-200">
<p>Les mots mn√©moniques repr√©sentent l&#39;entropie d&#39;une longueur de 128 √† 256¬†bits . L&#39;entropie est ensuite utilis√©e pour d√©river une valeur d&#8217;amor√ßage plus longue (512 bits) gr√¢ce √† l&#39;utilisation de la fonction d&#39;√©tirement de cl√© PBKDF2. La valeur d&#8217;amor√ßage produite est utilis√©e pour construire un portefeuille d√©terministe et en d√©river ses cl√©s.</p>
</div>
<div class="paragraph data-line-202">
<p>La fonction d&#8217;√©tirement de cl√© prend deux param√®tres : le mn√©monique et un <em>sel</em>. Le but d&#39;un sel dans une fonction d&#39;√©tirement de cl√© est de rendre difficile la construction d&#39;une table de recherche permettant une attaque par force brute. Dans la norme BIP-39, le sel a un autre objectif : il permet l&#39;introduction d&#39;une phrase secr√®te qui sert de facteur de s√©curit√© suppl√©mentaire prot√©geant la valeur d&#8217;amor√ßage, comme nous le d√©crirons plus en d√©tail dans <a href="#mnemonic_passphrase">Phrase secr√®te facultative dans BIP-39</a>.</p>
</div>
<div class="paragraph data-line-204">
<p>Le processus d√©crit aux √©tapes 7 √† 9 continue √† partir du processus d√©crit dans la section pr√©c√©dente¬†:</p>
</div>
<div class="olist arabic data-line-207">
<ol class="arabic" start="7">
<li class="data-line-207">
<p>Le premier param√®tre de la fonction d&#39;√©tirement de cl√© PBKDF2 est le <em>mn√©monique</em> produit √† l&#39;√©tape 6.</p>
</li>
<li class="data-line-208">
<p>Le deuxi√®me param√®tre de la fonction d&#39;√©tirement de cl√© PBKDF2 est un <em>sel</em>. Le sel est compos√© de la constante de cha√Æne &amp;quot;mn√©monique&amp;quot; concat√©n√©e avec une phrase secr√®te facultative fournie par l&#39;utilisateur.</p>
</li>
<li class="data-line-209">
<p>PBKDF2 √©tend les param√®tres mn√©moniques et de sel en utilisant 2 048 cycles de hachage avec l&#39;algorithme HMAC-SHA512, produisant une valeur de 512 bits comme sortie finale. Cette valeur de 512 bits est la valeur d&#8217;amor√ßage.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-211">
<p><a href="#mnemonic_to_seed_figure">Du mn√©monique √† la valeur d&#8217;amor√ßage</a> montre comment un mn√©monique est utilis√© pour g√©n√©rer une valeur d&#8217;amor√ßage.</p>
</div>
<div id="mnemonic_to_seed_figure" class="imageblock data-line-215">
<div class="content">
<img src="images/bip39-part2.png" alt="&quot;Du mn√©monique √† la valeur d&#8217;amor√ßage&quot;">
</div>
<div class="title">Figure 29. Du mn√©monique √† la valeur d&#8217;amor√ßage</div>
</div>
<div class="admonitionblock note data-line-218">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-219">
<p>La fonction d&#39;√©tirement de cl√©, avec ses 2 048 cycles de hachage, est une protection assez efficace contre les attaques par force brute contre le mn√©monique ou la phrase secr√®te. Cela rend co√ªteux (en calcul) d&#39;essayer plus de quelques milliers de combinaisons de mots de passe et de mn√©moniques, alors que le nombre de valeurs d&#8217;amor√ßage d√©riv√©es possibles est vaste (2<sup>512</sup>, soit environ 10<sup>154</sup>) - bien plus grand que le nombre d&#39;atomes dans l&#39;univers visible (environ 10<sup>80</sup>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-222">
<p>Les tables <a data-type="xref" data-xrefstyle="select:labelnumber" href="#mnemonic_128_no_pass">#mnemonic_128_no_pass</a>, <a data-type="xref" data-xrefstyle="select:labelnumber" href="#mnemonic_128_w_pass">#mnemonic_128_w_pass</a> et <a data-type="xref" data-xrefstyle="select:labelnumber" href="#mnemonic_256_no_pass">#mnemonic_256_no_pass</a> montrent quelques exemples de codes mn√©moniques et les valeurs d&#8217;amor√ßage qu&#39;ils produisent.</p>
</div>
<table id="mnemonic_128_no_pass" class="tableblock frame-all grid-all stretch data-line-227">
<caption class="title">Table 4. Code mn√©monique d&#39;entropie 128 bits, sans phrase secr√®te, valeur d&#8217;amor√ßage r√©sultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entr√©e d&#39;entropie (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mn√©monique (12 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secr√®te</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(rien)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amor√ßage (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">5b56c417303faa3fcba7e57400e120a0ca83ec5a4fc9ffba757fbe63fbd77a89a1a3be4c67196f57c39
a88b76373733891bfaba16ed27a813ceed498804c0570</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_128_w_pass" class="tableblock frame-all grid-all stretch data-line-238">
<caption class="title">Table 5. Code mn√©monique d&#39;entropie 128 bits, avec phrase secr√®te, valeur d&#8217;amor√ßage r√©sultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entr√©e d&#39;entropie (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mn√©monique (12 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secr√®te</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SuperDuperSecret</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amor√ßage (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3b5df16df2157104cfdd22830162a5e170c0161653e3afe6c88defeefb0818c793dbb28ab3ab091897d0
715861dc8a18358f80b79d49acf64142ae57037d1d54</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_256_no_pass" class="tableblock frame-all grid-all stretch pagebreak-before data-line-250">
<caption class="title">Table 6. Code mn√©monique d&#39;entropie 256 bits, sans phrase secr√®te, valeur d&#8217;amor√ßage r√©sultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entr√©e d&#39;entropie (256 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2041546864449caff939d32d574753fe684d3c947c3346713dd8423e74abcf8c</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mn√©monique (24 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cake apple borrow silk endorse fitness top denial coil riot stay wolf
luggage oxygen faint major edit measure invite love trap field dilemma oblige</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secr√®te</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(rien)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amor√ßage (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3269bce2674acbd188d4f120072b13b088a0ecf87c6e4cae41657a0bb78f5315b33b3a04356e53d062e5
5f1e0deaa082df8d487381379df848a6ad7e98798404</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-260">
<h5 id="mnemonic_passphrase">Phrase secr√®te facultative dans BIP-39</h5>
<div class="paragraph data-line-262">
<p>La norme BIP-39 permet l&#39;utilisation d&#39;une phrase secr√®te facultative dans la d√©rivation de la valeur d&#8217;amor√ßage. Si aucune phrase secr√®te n&#39;est utilis√©e, le mn√©monique est √©tir√© avec un sel constitu√© de la cha√Æne constante &amp;quot;mn√©monique&amp;quot;, produisant une valeur d&#8217;amor√ßage sp√©cifique de 512 bits √† partir de n&#39;importe quel mn√©monique donn√©. Si une phrase secr√®te est utilis√©e, la fonction d&#39;√©tirement produit une valeur d&#8217;amor√ßage <em>diff√©rente</em> √† partir de ce m√™me mn√©monique. En fait, √©tant donn√© un seul mn√©monique, chaque phrase secr√®te possible conduit √† une valeur d&#8217;amor√ßage diff√©rente. Essentiellement, il n&#39;y a pas de &quot;mauvaise&quot; phrase secr√®te. Toutes les phrases secr√®tes sont valides et m√®nent toutes √† des valeur d&#8217;amor√ßage diff√©rentes, formant un vaste ensemble de portefeuilles non initialis√©s possibles. L&#39;ensemble des portefeuilles possibles est si grand (2<sup>512</sup>) qu&#39;il n&#39;y a aucune possibilit√© pratique de forcer brutalement ou de deviner accidentellement celui qui est utilis√©, tant que la phrase secr√®te a une complexit√© et une longueur suffisantes.</p>
</div>
<div class="admonitionblock tip data-line-265">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-266">
<p>Il n&#39;y a pas de &quot;mauvaises&quot; phrases secr√®te dans BIP-39. Chaque phrase secr√®te m√®ne √† un portefeuille qui, √† moins qu&#39;il n&#39;ait √©t√© utilis√© auparavant, sera vide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-269">
<p>La phrase secr√®te facultative cr√©e deux fonctionnalit√©s importantes¬†:</p>
</div>
<div class="ulist data-line-271">
<ul>
<li class="data-line-271">
<p>Un deuxi√®me facteur (quelque chose de m√©moris√©) qui rend un mn√©monique inutile par lui-m√™me, prot√©geant les sauvegardes mn√©moniques de la compromission par un voleur.</p>
</li>
<li class="data-line-273">
<p>Une forme de d√©ni plausible ou &quot;portefeuille sous contrainte&quot;, o√π une phrase secr√®te choisie m√®ne √† un portefeuille avec une petite quantit√© de fonds , utilis√© pour distraire un attaquant du &quot;vrai&quot; portefeuille qui contient la majorit√© des fonds.</p>
</li>
</ul>
</div>
<div class="paragraph pagebreak-before data-line-276">
<p>Cependant, il est important de noter que l&#39;utilisation d&#39;une phrase secr√®te introduit √©galement un risque de perte¬†:</p>
</div>
<div class="ulist data-line-278">
<ul>
<li class="data-line-278">
<p>Si le propri√©taire du portefeuille est incapacit√© ou d√©c√©d√© et que personne d&#39;autre ne conna√Æt la phrase secr√®te, la valeur d&#8217;amor√ßage est inutile et tous les fonds stock√©s dans le portefeuille sont perdus √† jamais.</p>
</li>
<li class="data-line-280">
<p>√Ä l&#39;inverse, si le propri√©taire sauvegarde la phrase secr√®te au m√™me endroit que la valeur d&#8217;amor√ßage, cela va √† l&#39;encontre de l&#39;objectif d&#39;un deuxi√®me facteur.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-282">
<p>Bien que les phrases secr√®tes soient tr√®s utiles, elles ne doivent √™tre utilis√©es qu&#39;en combinaison avec un processus soigneusement planifi√© de sauvegarde et de r√©cup√©ration, compte tenu de la possibilit√© que des h√©ritiers survivant au propri√©taire puissent r√©cup√©rer la cryptomonnaie.</p>
</div>
</div>
<div class="sect4 data-line-285">
<h5 id="working_mnemonic_codes">Travailler avec des codes mn√©moniques</h5>
<div class="paragraph data-line-287">
<p>BIP-39 est impl√©ment√© comme une biblioth√®que dans de nombreux langages de programmation diff√©rents. Par example:</p>
</div>
<div class="dlist data-line-289">
<dl>
<dt class="hdlist1"><a href="https://github.com/trezor/python-mnemonic" data-href="https://github.com/trezor/python-mnemonic">python-mnemonic</a></dt>
<dd>
<p>L&#39;impl√©mentation de r√©f√©rence de la norme par l&#39;√©quipe SatoshiLabs qui a propos√© BIP-39, en Python</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/ConsenSys/eth-lightwallet" data-href="https://github.com/ConsenSys/eth-lightwallet">ConsenSys/eth-lightwallet</a></dt>
<dd>
<p>Portefeuille l√©ger JS Ethereum pour n≈ìuds et navigateur (avec BIP-39)</p>
</dd>
<dt class="hdlist1"><a href="https://www.npmjs.com/package/bip39" data-href="https://www.npmjs.com/package/bip39">npm/bip39</a></dt>
<dd>
<p>Impl√©mentation JavaScript de Bitcoin BIP-39 : Code mn√©monique pour g√©n√©rer des cl√©s d√©terministes</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-295">
<p>Il existe √©galement un g√©n√©rateur BIP-39 impl√©ment√© dans une page Web autonome (<a href="#a_bip39_generator_as_a_standalone_web_page">Un g√©n√©rateur BIP-39 en tant que page Web autonome</a>), ce qui est extr√™mement utile pour les tests et l&#39;exp√©rimentation. Le <a href="https://iancoleman.io/bip39/" data-href="https://iancoleman.io/bip39/">Mnemonic Code Converter</a> g√©n√®re des mn√©moniques, des valeurs d&#8217;amor√ßage et des cl√©s priv√©es √©tendues. Il peut √™tre utilis√© hors ligne dans un navigateur ou accessible en ligne.</p>
</div>
<div id="a_bip39_generator_as_a_standalone_web_page" class="imageblock data-line-299">
<div class="content">
<img src="images/bip39_web.png" alt="&quot;Page Web du g√©n√©rateur BIP-39&quot;">
</div>
<div class="title">Figure 30. Un g√©n√©rateur BIP-39 en tant que page Web autonome</div>
</div>
</div>
</div>
<div class="sect3 data-line-302">
<h4 id="create_hd_wallet">Cr√©er un portefeuille HD √† partir de la valeur d&#8217;amor√ßage</h4>
<div class="paragraph data-line-304">
<p>Les portefeuilles HD sont cr√©√©s √† partir d&#39;une seule <em>valeur d&#8217;amor√ßage racine</em>, qui est un nombre al√©atoire de 128, 256 ou 512 bits. Le plus souvent, cette valeur d&#8217;amor√ßage est g√©n√©r√©e √† partir d&#39;un mn√©monique comme d√©taill√© dans la section pr√©c√©dente.</p>
</div>
<div class="paragraph data-line-306">
<p>Chaque cl√© du portefeuille HD est d√©riv√©e de mani√®re d√©terministe de cette valeur d&#8217;amor√ßage racine, ce qui permet de recr√©er l&#39;int√©gralit√© du portefeuille HD √† partir de cette valeur d&#8217;amor√ßage dans n&#39;importe quel portefeuille HD compatible. Cela facilite l&#39;exportation, la sauvegarde, la restauration et l&#39;importation de portefeuilles HD contenant des milliers, voire des millions de cl√©s en transf√©rant uniquement le mn√©monique √† partir duquel la valeur d&#8217;amor√ßage racine est d√©riv√©e.</p>
</div>
</div>
<div class="sect3 data-line-309">
<h4 id="bip32_bip43_44">Portefeuilles HD (BIP-32) et Chemins (BIP-43/44)</h4>
<div class="paragraph data-line-311">
<p>La plupart des portefeuilles HD suivent le Standard BIP-32, qui est devenu un standard industriel <em>de facto</em> pour la g√©n√©ration de cl√© d√©terministe.</p>
</div>
<div class="paragraph data-line-313">
<p>Nous ne discuterons pas de tous les d√©tails du BIP-32 ici, seulement des composants n√©cessaires pour comprendre comment il est utilis√© dans les portefeuilles. Le principal aspect important est les relations hi√©rarchiques arborescentes qu&#39;il est possible que les cl√©s d√©riv√©es aient, comme vous pouvez le voir dans <a href="#hd_wallets_figure">Portefeuille HD¬†: un arbre de cl√©s g√©n√©r√© √† partir d&#39;une seule valeur d&#8217;amor√ßage</a>. Il est √©galement important de comprendre les notions de <em>cl√©s √©tendues</em> et <em>cl√©s renforc√©es</em>, qui sont expliqu√©es dans les sections suivantes.</p>
</div>
<div class="paragraph data-line-315">
<p>Il existe des dizaines d&#39;impl√©mentations interop√©rables de BIP-32 propos√©es dans de nombreuses biblioth√®ques de logiciels. Ceux-ci sont principalement con√ßus pour les portefeuilles Bitcoin, qui impl√©mentent les adresses d&#39;une mani√®re diff√©rente, mais partagent la m√™me impl√©mentation de d√©rivation de cl√© que les portefeuilles compatibles BIP-32 d&#39;Ethereum. Utilisez-en un <a href="https://github.com/ConsenSys/eth-lightwallet" class="undefined" data-href="https://github.com/ConsenSys/eth-lightwallet">https://github.com/ConsenSys/eth-lightwallet</a> [con√ßu pour Ethereum], ou adaptez-en un √† partir de Bitcoin en ajoutant une biblioth√®que d&#39;encodage d&#39;adresses Ethereum.</p>
</div>
<div class="paragraph data-line-317">
<p>Il existe √©galement un g√©n√©rateur BIP-32 impl√©ment√© sous la forme d&#39;une <a href="http://bip32.org/" data-href="http://bip32.org/">page Web autonome</a> qui est tr√®s utile pour tester et exp√©rimenter avec BIP-32.</p>
</div>
<div class="admonitionblock warning data-line-320">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-321">
<p>Le g√©n√©rateur BIP-32 autonome n&#39;est pas un site HTTPS. C&#39;est pour vous rappeler que l&#39;utilisation de cet outil n&#39;est pas s√©curis√©e. C&#39;est uniquement pour tester. Vous ne devez pas utiliser les cl√©s produites par ce site avec des fonds r√©els.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-325">
<h5 id="extended_keys">Cl√©s publiques et priv√©es √©tendues</h5>
<div class="paragraph data-line-327">
<p>Dans la terminologie BIP-32, les cl√©s peuvent √™tre &quot;√©tendues&quot;. Avec les bonnes op√©rations math√©matiques, ces cl√©s &quot;parentes&quot; √©tendues peuvent √™tre utilis√©es pour d√©river des cl√©s &quot;enfant&quot;, produisant ainsi la hi√©rarchie des cl√©s et des adresses d√©crites pr√©c√©demment. Une cl√© parent n&#39;a pas besoin d&#39;√™tre au sommet de l&#39;arborescence. peut √™tre choisi n&#39;importe o√π dans l&#39;arborescence. L&#39;extension d&#39;une cl√© implique de prendre la cl√© elle-m√™me et d&#39;y ajouter un <em>code de cha√Æne</em> sp√©cial. Un code de cha√Æne est une cha√Æne binaire de 256¬†bits qui est m√©lang√© avec chaque cl√© pour produire des cl√©s enfants.</p>
</div>
<div class="paragraph data-line-329">
<p>Si la cl√© est une cl√© priv√©e, elle devient une <em>cl√© priv√©e √©tendue</em> qui se distingue par le <span class="keep-together">pr√©fixe</span> xprv¬†:</p>
</div>
<div id="xprv_example" class="listingblock data-line-332">
<div class="content">
<pre>xprv9s21ZrQH143K2JF8RafpqtKiTbsbaxEeUaMnNHsm5o6wCW3z8ySyH4UxFVSfZ8n7ESu7fgir8i...</pre>
</div>
</div>
<div class="paragraph data-line-336">
<p>Une <em>cl√© publique √©tendue</em> se distingue par le pr√©fixe xpub¬†:</p>
</div>
<div id="xpub_example" class="listingblock data-line-339">
<div class="content">
<pre>xpub661MyMwAqRbcEnKbXcCqD2GT1di5zQxVqoHPAgHNe8dv5JP8gWmDproS6kFHJnLZd23tWevhdn...</pre>
</div>
</div>
<div class="paragraph data-line-343">
<p>Une caract√©ristique tr√®s utile des portefeuilles HD est la possibilit√© de d√©river les cl√©s publiques enfants des cl√©s publiques parents, <em>sans</em> avoir les cl√©s priv√©es. Cela nous donne deux fa√ßons de d√©river une cl√© publique enfant : soit directement √† partir de la cl√© priv√©e enfant, soit √† partir de la cl√© publique parent.</p>
</div>
<div class="paragraph data-line-345">
<p>Une cl√© publique √©tendue peut donc √™tre utilis√©e pour d√©river toutes les cl√©s publiques (et uniquement les cl√©s publiques) dans cette branche de la structure du portefeuille HD.</p>
</div>
<div class="paragraph data-line-347">
<p>Ce raccourci peut √™tre utilis√© pour cr√©er des d√©ploiements tr√®s s√©curis√©s √† cl√© publique uniquement, o√π un serveur ou une application poss√®de une copie d&#39;une cl√© publique √©tendue, mais aucune cl√© priv√©e. Ce type de d√©ploiement peut produire un nombre infini de cl√©s publiques et d&#39;adresses Ethereum, mais ne peut pas d√©penser l&#39;argent envoy√© √† ces adresses. Pendant ce temps, sur un autre serveur plus s√©curis√©, la cl√© priv√©e √©tendue peut d√©river toutes les cl√©s priv√©es correspondantes pour signer des transactions et d√©penser de l&#39;argent.</p>
</div>
<div class="paragraph data-line-349">
<p>Une application courante de cette m√©thode consiste √† installer une cl√© publique √©tendue sur un serveur Web qui sert une application de commerce √©lectronique. Le serveur Web peut utiliser la fonction de d√©rivation de cl√© publique pour cr√©er une nouvelle adresse Ethereum pour chaque transaction (par exemple, pour le panier d&#39;un client) et n&#39;aura aucune cl√© priv√©e vuln√©rable au vol. Sans les portefeuilles HD, la seule fa√ßon d&#39;y parvenir est de g√©n√©rer des milliers d&#39;adresses Ethereum sur un serveur s√©curis√© s√©par√©, puis de les pr√©charger sur le serveur de commerce √©lectronique. Cette approche est lourde et n√©cessite une maintenance constante pour s&#39;assurer que le serveur ne manque pas de cl√©s, d&#39;o√π la pr√©f√©rence d&#39;utiliser des cl√©s publiques √©tendues √† partir de portefeuilles HD.</p>
</div>
<div class="paragraph data-line-351">
<p>Une autre application courante de cette solution est pour le stockage √† froid ou pour les portefeuilles mat√©riels. Dans ce sc√©nario, la cl√© priv√©e √©tendue peut √™tre stock√©e dans un portefeuille mat√©riel, tandis que la cl√© publique √©tendue peut √™tre conserv√©e en ligne. L&#39;utilisateur peut cr√©er des adresses &quot;de r√©ception&quot; √† volont√©, tandis que les cl√©s priv√©es sont stock√©es en toute s√©curit√© hors ligne. Pour d√©penser les fonds, l&#39;utilisateur peut utiliser la cl√© priv√©e √©tendue dans un client Ethereum de signature hors ligne ou signer des transactions sur le p√©riph√©rique de portefeuille mat√©riel.</p>
</div>
</div>
<div class="sect4 data-line-354">
<h5 id="hardened_child_key">D√©rivation de cl√© enfant renforc√©e</h5>
<div class="paragraph data-line-356">
<p>La possibilit√© de d√©river une branche de cl√©s publiques √† partir d&#39;une cl√© publique √©tendue, ou <em>xpub</em>, est tr√®s utile, mais elle comporte un risque potentiel. L&#39;acc√®s √† une xpub ne donne pas acc√®s aux cl√©s priv√©es enfants. Cependant, √©tant donn√© que le xpub contient le code de cha√Æne (utilis√© pour d√©river les cl√©s publiques enfants de la cl√© publique parent), si une cl√© priv√©e enfant est connue ou divulgu√©e d&#39;une mani√®re ou d&#39;une autre, elle peut √™tre utilis√©e avec le code de cha√Æne pour d√©river tous les autres enfants priv√©s. cl√©s. Une seule cl√© priv√©e enfant divulgu√©e, associ√©e √† un code de cha√Æne parent, r√©v√®le toutes les cl√©s priv√©es de tous les enfants. Pire encore, la cl√© priv√©e enfant associ√©e √† un code de cha√Æne parent peut √™tre utilis√©e pour d√©duire la cl√© priv√©e parent.</p>
</div>
<div class="paragraph data-line-358">
<p>Pour contrer ce risque, les portefeuilles HD utilisent une fonction de d√©rivation alternative appel√©e <em>d√©rivation renforc√©e</em>, qui &quot;casse&quot; la relation entre la cl√© publique parent et le code de cha√Æne enfant. La fonction de d√©rivation renforc√©e utilise la cl√© priv√©e parent pour d√©river le code de cha√Æne enfant, au lieu de la cl√© publique parent. Cela cr√©e un &quot;pare-feu&quot; dans la s√©quence parent/enfant, avec un code de cha√Æne qui ne peut pas √™tre utilis√© pour compromettre une cl√© priv√©e parent ou s≈ìur.</p>
</div>
<div class="paragraph data-line-360">
<p>En termes simples, si vous souhaitez utiliser la commodit√© d&#39;un xpub pour d√©river des branches de cl√©s publiques sans vous exposer au risque d&#39;une fuite de code de cha√Æne, vous devez le d√©river d&#39;un parent renforc√©, plut√¥t que d&#39;un parent normal. La meilleure pratique consiste √† toujours d√©river les enfants de niveau 1 des cl√©s principales par d√©rivation renforc√©e, afin d&#39;√©viter toute compromission des cl√©s principales.</p>
</div>
</div>
<div class="sect4 data-line-363">
<h5 id="index_number">Num√©ros d&#39;index pour d√©rivation normale et durcie</h5>
<div class="paragraph data-line-365">
<p>Il est clairement souhaitable de pouvoir d√©river plus d&#39;une cl√© enfant √† partir d&#39;une cl√© parent donn√©e. Pour g√©rer cela, un num√©ro d&#39;index est utilis√©. Chaque num√©ro d&#39;index, lorsqu&#39;il est combin√© avec une cl√© parent √† l&#39;aide de la fonction sp√©ciale de d√©rivation d&#39;enfant, donne une cl√© enfant diff√©rente. Le num√©ro d&#39;index utilis√© dans la fonction de d√©rivation parent-enfant BIP-32 est un entier de 32 bits. Pour distinguer facilement les cl√©s d√©riv√©es via la fonction de d√©rivation normale (non renforc√©e) des cl√©s d√©riv√©es via la d√©rivation renforc√©e, ce num√©ro d&#39;index est divis√© en deux plages. Les num√©ros d&#39;index entre 0 et 2<sup>31</sup>‚Äì1 (0x0 √† 0x7FFFFFFF) sont utilis√©s <em>uniquement</em> pour la d√©rivation normale. Les num√©ros d&#39;index entre 2<sup>31</sup> et 2<sup>32</sup>‚Äì1 (0x80000000 √† 0xFFFFFFFF) sont utilis√©s <em>uniquement</em> pour la d√©rivation renforc√©e. Ainsi, si l&#39;indice est inf√©rieur √† 2<sup>31</sup>, l&#39;enfant est normal, alors que si l&#39;indice est √©gal ou sup√©rieur √† 2<sup>31</sup>, l&#39;enfant est endurci.</p>
</div>
<div class="paragraph data-line-367">
<p>Pour faciliter la lecture et l&#39;affichage des num√©ros d&#39;index, les num√©ros d&#39;index pour les enfants endurcis sont affich√©s √† partir de z√©ro, mais avec un symbole prime. La premi√®re cl√© enfant normale est donc affich√©e sous la forme 0, tandis que la premi√®re cl√© enfant renforc√©e (index 0x80000000) est affich√©e sous la forme 0&amp;#39;. Dans l&#39;ordre, alors, la deuxi√®me cl√© renforc√©e aurait un index de 0x80000001 et serait affich√©e comme 1&amp;#39;, et ainsi de suite. Lorsque vous voyez un index de portefeuille HD i&amp;#39;, cela signifie 2<sup>31</sup> + i.</p>
</div>
</div>
<div class="sect4 data-line-370">
<h5 id="hd_wallet_path">Identifiant de cl√© de portefeuille HD (chemin)</h5>
<div class="paragraph data-line-372">
<p>Les cl√©s d&#39;un portefeuille HD sont identifi√©es √† l&#39;aide d&#39;un &quot; chemin&quot;, avec chaque niveau de l&#39;arborescence s√©par√© par une barre oblique (/) (voir <a href="#hd_path_table">[hd_path_table]</a>). Les cl√©s priv√©es d√©riv√©es de la cl√© priv√©e principale commencent par m. Les cl√©s publiques d√©riv√©es de la cl√© publique principale commencent par M. Par cons√©quent, la premi√®re cl√© priv√©e enfant de la cl√© priv√©e principale est m/0. La premi√®re cl√© publique enfant est M/0. Le deuxi√®me petit-enfant du premier enfant est m/0/1, et ainsi de suite.</p>
</div>
<div class="paragraph data-line-374">
<p>L&#39;&quot;ascendance&quot; d&#39;une cl√© se lit de droite √† gauche, jusqu&#39;√† atteindre la cl√© ma√Ætresse dont elle est issue. Par exemple, l&#39;identifiant m/x/y/z d√©crit la cl√© qui est le z-√®me enfant de la cl√© m/x/y, qui est le y-√®me enfant de la cl√© m/x, qui est le x-i√®me enfant de m.</p>
</div>
<div id="hd_path_table" class="paragraph data-line-377">
<p>Exemples de chemin de portefeuille .HD</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-379">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Chemin HD</th>
<th class="tableblock halign-left valign-top">Cl√© d√©crite</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La premi√®re cl√© priv√©e enfant (0) de la cl√© priv√©e principale (m)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La cl√© priv√©e du premier petit-enfant du premier enfant (m/0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0&amp;#39;/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le premier petit-enfant normal du premier enfant <em>renforc√©</em> (m/0&amp;#39;)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/1/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La cl√© priv√©e du premier petit-enfant du deuxi√®me enfant (m/1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/23/17/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La cl√© publique du premier arri√®re-arri√®re-petit-enfant du premier arri√®re-petit-enfant du 18e petit-enfant du <span class="keep-together">24e enfant</span></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-389">
<h5 id="navigating_hd_wallet_tree">Naviguer dans l&#39;arborescence du portefeuille HD</h5>
<div class="paragraph data-line-391">
<p>La structure arborescente du portefeuille HD est extr√™mement flexible. Le revers de la m√©daille est qu&#39;il permet √©galement une complexit√© illimit√©e : chaque cl√© √©tendue parent peut avoir 4 milliards d&#39;enfants : 2 milliards d&#39;enfants normaux et 2 milliards d&#39;enfants renforc√©s. Chacun de ces enfants peut avoir 4 milliards d&#39;enfants suppl√©mentaires, et ainsi de suite. L&#39;arbre peut √™tre aussi profond que vous le souhaitez, avec un nombre potentiellement infini de g√©n√©rations. Avec tout ce potentiel, il peut devenir assez difficile de naviguer dans ces tr√®s grands arbres.</p>
</div>
<div class="paragraph data-line-393">
<p>Deux BIP offrent un moyen de g√©rer cette complexit√© potentielle en cr√©ant des normes pour la structure des arborescences de portefeuille HD. BIP-43 propose l&#39;utilisation du premier index enfant renforc√© comme identifiant sp√©cial qui signifie le &quot;but&quot; de la structure arborescente. Bas√© sur BIP-43, un portefeuille HD ne devrait utiliser qu&#39;une seule branche de niveau 1 de l&#39;arborescence, le num√©ro d&#39;index d√©finissant l&#39;objectif du portefeuille en identifiant la structure et l&#39;espace de noms du reste de l&#39;arborescence. Plus pr√©cis√©ment, un portefeuille HD utilisant uniquement la branche m/i&amp;#39;/... est destin√© √† signifier un objectif sp√©cifique et cet objectif est identifi√© par le num√©ro d&#39;index i.</p>
</div>
<div class="paragraph data-line-395">
<p>√âtendant cette sp√©cification, BIP-44 propose une structure multicompte multidevise signifi√©e en d√©finissant le num√©ro de &quot;but&quot; √† 44&amp;#39;. Tous les portefeuilles HD suivant la structure BIP-44 sont identifi√©s par le fait qu&#39;ils n&#39;utilisent qu&#39;une seule branche de l&#39;arbre : m/44&amp;#39;/*.</p>
</div>
<div class="paragraph data-line-397">
<p>BIP-44 sp√©cifie la structure comme √©tant compos√©e de cinq niveaux d&#39;arborescence pr√©d√©finis¬†:</p>
</div>
<div id="bip44_tree" class="listingblock data-line-400">
<div class="content">
<pre>m / but&amp;#39; / type_de_monnaie&amp;#39; / compte&amp;#39; / change / index_adresse</pre>
</div>
</div>
<div class="paragraph data-line-404">
<p>Le premier niveau, but&amp;#39;, est toujours r√©gl√© sur 44&amp;#39;. Le deuxi√®me niveau, type_de_monnaie&amp;#39;, sp√©cifie le type de pi√®ce de cryptomonnaie, permettant des portefeuilles HD multidevises o√π chaque devise a son propre sous-arbre sous le deuxi√®me niveau. Il existe plusieurs devises d√©finies dans un document standard appel√© <a href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md" data-href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md">SLIP0044</a>¬†; par exemple, Ethereum vaut m/44&amp;#39;/60&amp;#39;, Ethereum Classic vaut m/44&amp;#39;/61&amp;#39;, Bitcoin vaut m/44&amp;#39;/0&amp;#39; et Testnet pour tous devises est m/44&amp;#39;/1&amp;#39;.</p>
</div>
<div class="paragraph data-line-406">
<p>Le troisi√®me niveau de l&#39;arborescence est compte&amp;#39;, qui permet aux utilisateurs de subdiviser leurs portefeuilles en sous-comptes logiques distincts √† des fins comptables ou organisationnelles. Par exemple, un portefeuille HD peut contenir deux &quot;comptes&quot; Ethereum¬†: m/44&amp;#39;/60&amp;#39;/0&amp;#39; et m/44&amp;#39;/60&amp;#39;/1&amp;#39;. Chaque compte est la racine de sa propre sous-arborescence.</p>
</div>
<div class="paragraph data-line-408">
<p>Parce que BIP-44 a √©t√© cr√©√© √† l&#39;origine pour Bitcoin, il contient une &quot;bizarrerie&quot; qui n&#39;est pas pertinente dans le monde Ethereum. Au quatri√®me niveau du chemin, change, un portefeuille HD a deux sous-arbres : un pour cr√©er des adresses de r√©ception et un pour cr√©er des adresses de change (retour du change de la transaction). Seul le chemin &quot;r√©ception&quot; est utilis√© dans Ethereum, car il n&#39;est pas n√©cessaire de changer d&#39;adresse comme c&#39;est le cas dans Bitcoin. Notez qu&#39;alors que les niveaux pr√©c√©dents utilisaient une d√©rivation renforc√©e, ce niveau utilise une d√©rivation normale. Cela permet au niveau du compte de l&#39;arborescence d&#39;exporter des cl√©s publiques √©tendues pour une utilisation dans un environnement non s√©curis√©. Les adresses utilisables sont d√©riv√©es par le portefeuille HD en tant qu&#39;enfants du quatri√®me niveau, faisant du cinqui√®me niveau de l&#39;arborescence le index_adresse. Par exemple, la troisi√®me adresse de r√©ception des paiements Ethereum dans le compte principal serait M/44&amp;#39;/60&amp;#39;/0&amp;#39;/0/2. <a href="#bip44_path_examples">[bip44_path_examples]</a> montre quelques exemples suppl√©mentaires.</p>
</div>
<div id="bip44_path_examples" class="paragraph data-line-411">
<p>Exemples de structure de portefeuille .BIP-44 HD</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-413">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Chemin HD</th>
<th class="tableblock halign-left valign-top">Cl√© d√©crite</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#39;/60&amp;#39;/0&amp;#39;/0/2+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La troisi√®me cl√© publique de r√©ception pour le compte Ethereum principal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#39;/0&amp;#39;/3&amp;#39;/1/14+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La 15<sup>√®me</sup> cl√© publique d&#39;adresse de change pour le 4<sup>√®me</sup> compte Bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/44&amp;#39;/2&amp;#39;/0&amp;#39;/0/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La deuxi√®me cl√© priv√©e du compte principal Litecoin, pour la signature des transactions</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-420">
<h3 id="_conclusion_2">Conclusion</h3>
<div class="paragraph data-line-13">
<p>Les portefeuilles sont la base de toute application cha√Æne de blocs destin√©e aux utilisateurs. Ils permettent aux utilisateurs de g√©rer des collections de cl√©s et d&#39;adresses. Les portefeuilles permettent √©galement aux utilisateurs de d√©montrer leur propri√©t√© d&#39;ether et d&#39;autoriser les transactions, en appliquant des signatures num√©riques, comme nous le verrons dans <a href="#tx_chapter">Transactions</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="tx_chapter">Transactions</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Les transactions sont des messages sign√©s provenant d&#39;un compte externe, transmis par le r√©seau Ethereum et enregistr√©s sur la cha√Æne de blocs Ethereum. Cette d√©finition de base cache bien des d√©tails surprenants et fascinants. Une autre fa√ßon de voir les transactions est qu&#39;elles sont les seules choses qui peuvent d√©clencher un changement d&#39;√©tat ou provoquer l&#39;ex√©cution d&#39;un contrat dans l&#39;EVM. Ethereum est une machine √† √©tats singleton globale, et les transactions sont ce qui fait que cette machine √† √©tats &quot;fonctionner&quot;, qui change son √©tat. Les contrats ne fonctionnent pas seuls. Ethereum ne fonctionne pas de mani√®re autonome. Tout commence par une transaction.</p>
</div>
<div class="paragraph data-line-6">
<p>Dans ce chapitre, nous allons diss√©quer les transactions, montrer leur fonctionnement et examiner les d√©tails. Notez qu&#39;une grande partie de ce chapitre s&#39;adresse √† ceux qui souhaitent g√©rer leurs propres transactions √† un niveau inf√©rieur, peut-√™tre parce qu&#39;ils √©crivent une application de portefeuille¬†; vous n&#39;avez pas √† vous en soucier si vous √™tes satisfait des applications de portefeuille existantes, bien que vous puissiez trouver les d√©tails int√©ressants !</p>
</div>
<div class="sect2 data-line-9">
<h3 id="tx_struct">La structure d&#39;une transaction</h3>
<div class="paragraph data-line-11">
<p>Regardons d&#39;abord la structure de base d&#39;une transaction, telle qu&#39;elle est s√©rialis√©e et transmise sur le r√©seau Ethereum. Chaque client et application qui re√ßoit une transaction s√©rialis√©e la stocke en m√©moire en utilisant sa propre structure de donn√©es interne, √©ventuellement agr√©ment√©e de m√©tadonn√©es qui n&#39;existent pas dans la transaction s√©rialis√©e du r√©seau elle-m√™me. La s√©rialisation r√©seau est la seule forme standard d&#39;une transaction.</p>
</div>
<div class="paragraph data-line-13">
<p>Une transaction est un message binaire s√©rialis√© qui contient les donn√©es suivantes¬†:</p>
</div>
<div class="dlist data-line-15">
<dl>
<dt class="hdlist1">Nonce</dt>
<dd>
<p>Un num√©ro de s√©quence, √©mis par l&#39;EOA d&#39;origine, utilis√© pour emp√™cher la relecture du message</p>
</dd>
<dt class="hdlist1">Prix du gaz</dt>
<dd>
<p>Le prix du gaz (en wei) que le donneur d&#39;ordre est pr√™t √† payer</p>
</dd>
<dt class="hdlist1">Limite de gaz</dt>
<dd>
<p>La quantit√© maximale de gaz que l&#39;initiateur est pr√™t √† acheter pour cette transaction</p>
</dd>
<dt class="hdlist1">Destinataire</dt>
<dd>
<p>L&#39;adresse Ethereum de destination</p>
</dd>
<dt class="hdlist1">Valeur</dt>
<dd>
<p>La quantit√© d&#39;√©ther √† envoyer √† la destination</p>
</dd>
<dt class="hdlist1">Donn√©es</dt>
<dd>
<p>La charge utile de donn√©es binaires de longueur variable</p>
</dd>
<dt class="hdlist1">v,r,s</dt>
<dd>
<p>Les trois composants d&#39;une signature num√©rique ECDSA de l&#39;EOA d&#39;origine</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-29">
<p>La structure du message de transaction est s√©rialis√©e √† l&#39;aide du sch√©ma de codage Recursive Length Prefix (RLP) (ou Pr√©fixe de longueur r√©cursif), qui a √©t√© cr√©√© sp√©cifiquement pour s√©rialisation de donn√©es simple et parfaite dans Ethereum. Tous les nombres dans Ethereum sont cod√©s sous forme d&#39;entiers gros-boutiste, de longueurs multiples de 8 bits.</p>
</div>
<div class="paragraph data-line-31">
<p>Notez que les √©tiquettes de champ (to, gas limit, etc.) sont affich√©es ici pour plus de clart√©, mais ne font pas partie des donn√©es s√©rialis√©es de la transaction, qui contiennent les valeurs de champ cod√©es RLP. En g√©n√©ral, RLP ne contient aucun d√©limiteur de champ ou √©tiquette. Le pr√©fixe de longueur de RLP est utilis√© pour identifier la longueur de chaque champ. Tout ce qui d√©passe la longueur d√©finie appartient au champ suivant dans la structure.</p>
</div>
<div class="paragraph data-line-33">
<p>Bien qu&#39;il s&#39;agisse de la structure de transaction r√©elle transmise, la plupart des repr√©sentations internes et des visualisations d&#39;interface utilisateur l&#39;agr√©mentent d&#39;informations suppl√©mentaires, d√©riv√©es de la transaction ou de la cha√Æne de blocs.</p>
</div>
<div class="paragraph data-line-35">
<p>Par exemple, vous remarquerez peut-√™tre qu&#39;il n&#39;y a pas de donn√©es &quot;from&quot; dans l&#39;adresse identifiant l&#39;EOA d&#39;origine. En effet, la cl√© publique de l&#39;EOA peut √™tre d√©riv√©e des composants v,r,s de la signature ECDSA. L&#39;adresse peut, √† son tour, √™tre d√©riv√©e de la cl√© publique. Lorsque vous voyez une transaction affichant un champ &quot;from&quot;, qui a √©t√© ajout√© par le logiciel utilis√© pour visualiser la transaction. D&#39;autres m√©tadonn√©es fr√©quemment ajout√©es √† la transaction par le logiciel client incluent le num√©ro de bloc (une fois extrait et inclus dans la cha√Æne de blocs) et un ID de transaction (hachage calcul√©). Encore une fois, ces donn√©es sont d√©riv√©es de la transaction et ne font pas partie du message de transaction lui-m√™me.</p>
</div>
</div>
<div class="sect2 data-line-38">
<h3 id="tx_nonce">Le Nonce de transaction</h3>
<div class="paragraph data-line-40">
<p>Le nonce est l&#39;un des composants les plus importants et les moins compris d&#39;une transaction. La d√©finition du Livre jaune (voir <a href="#references">Lectures compl√©mentaires</a>) lit :</p>
</div>
<div class="quoteblock data-line-42">
<blockquote>
<div class="paragraph data-line-43">
<p>nonce : Une valeur scalaire √©gale au nombre de transactions √©mises depuis cette adresse ou, dans le cas de comptes avec code associ√©, au nombre de cr√©ations de contrats effectu√©es par ce compte.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-46">
<p>√Ä proprement parler, le nonce est un attribut de l&#39;adresse d&#39;origine¬†; c&#39;est-√†-dire qu&#39;il n&#39;a de sens que dans le contexte de l&#39;adresse d&#39;envoi. Cependant, le nonce n&#39;est pas stock√© explicitement dans le cadre de l&#39;√©tat d&#39;un compte sur la cha√Æne de blocs. Au lieu de cela, il est calcul√© dynamiquement, en comptant le nombre de transactions confirm√©es provenant d&#39;une adresse.</p>
</div>
<div class="paragraph data-line-48">
<p>Il existe deux sc√©narios dans lesquels l&#39;existence d&#39;un nonce de comptage des transactions est importante¬†: la fonctionnalit√© d&#39;utilisabilit√© des transactions incluses dans l&#39;ordre de cr√©ation et la fonctionnalit√© vitale de la protection contre la duplication des transactions. Regardons un exemple de sc√©nario pour chacun d&#39;entre eux¬†:</p>
</div>
<div class="olist arabic data-line-50">
<ol class="arabic">
<li class="data-line-50">
<p>Imaginez que vous souhaitiez effectuer deux transactions. Vous avez un paiement important √† effectuer de 6 ethers, et aussi un autre paiement de 8 ethers. Vous signez et diffusez d&#39;abord la transaction √† 6 ethers, car c&#39;est la plus importante, puis vous signez et diffusez la deuxi√®me transaction √† 8 ethers. Malheureusement, vous avez oubli√© le fait que votre compte ne contient que 10 ethers, donc le r√©seau ne peut pas accepter les deux transactions : l&#39;une d&#39;entre elles √©chouera. Parce que vous avez envoy√© le 6-ether le plus important en premier, vous vous attendez naturellement √† ce que celui-ci passe et que le 8-ether soit rejet√©. Cependant, dans un syst√®me d√©centralis√© comme Ethereum, les n≈ìuds peuvent recevoir les transactions dans n&#39;importe quel ordre ; il n&#39;y a aucune garantie qu&#39;un n≈ìud particulier aura une transaction qui lui sera propag√©e avant l&#39;autre. En tant que tel, il sera presque certainement le cas que certains n≈ìuds re√ßoivent la transaction √† 6 ethers en premier et que d&#39;autres re√ßoivent la transaction √† 8 ethers en premier. Sans le nonce, il serait al√©atoire de savoir lequel est accept√© et lequel est rejet√©. Cependant, avec le nonce inclus, la premi√®re transaction que vous avez envoy√©e aura un nonce de, disons, 3, tandis que la transaction 8-ether a la valeur de nonce suivante (c&#39;est-√†-dire 4). Ainsi, cette transaction sera ignor√©e jusqu&#39;√† ce que les transactions avec des nonces de 0 √† 3 aient √©t√© trait√©es, m√™me si elle est re√ßue en premier. Phew!</p>
</li>
<li class="data-line-53">
<p>Imaginez maintenant que vous avez un compte avec 100 ethers. Fantastique! Vous trouvez quelqu&#39;un en ligne qui acceptera le paiement en ether pour un mcguffin-widget que vous voulez vraiment acheter. Vous leur envoyez 2 ethers et ils vous envoient le widget mcguffin. Beau. Pour effectuer ce paiement √† 2 ethers, vous avez sign√© une transaction en envoyant 2 ethers de votre compte √† leur compte, puis vous les avez diffus√©s sur le r√©seau Ethereum pour qu&#39;ils soient v√©rifi√©s et inclus dans la cha√Æne de blocs. Maintenant, sans valeur nonce dans la transaction, une seconde transaction envoyant 2 ethers √† la m√™me adresse une seconde fois aura exactement la m√™me apparence que la premi√®re transaction. Cela signifie que toute personne qui voit votre transaction sur le r√©seau Ethereum (ce qui signifie que tout le monde, y compris le destinataire ou vos ennemis) peut &quot;rejouer&quot; la transaction encore et encore et encore jusqu&#39;√† ce que tout votre ether soit parti simplement en copiant et collant votre transaction d&#39;origine et le renvoyer sur le r√©seau. Cependant, avec la valeur nonce incluse dans les donn√©es de transaction, <em>chaque transaction est unique</em>, m√™me lors de l&#39;envoi de la m√™me quantit√© d&#39;√©ther √† la m√™me adresse de destinataire plusieurs fois. Ainsi, en ayant le nonce incr√©ment√© dans le cadre de la transaction, il n&#39;est tout simplement pas possible pour quiconque de &quot;dupliquer&quot; un paiement que vous avez effectu√©.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-55">
<p>En r√©sum√©, il est important de noter que l&#39;utilisation du nonce est en fait vitale pour un protocole <em>bas√© sur le compte</em>, contrairement au m√©canisme &quot;Unspent Transaction Output&quot; (UTXO) du protocole Bitcoin.</p>
</div>
<div class="sect3 data-line-58">
<h4 id="tracking_nonce">Garder une trace des Nonces</h4>
<div class="paragraph data-line-60">
<p>En termes pratiques, le nonce est un d√©compte √† jour du nombre de transactions <em>confirm√©es</em> (c&#39;est-√†-dire en cha√Æne) provenant d&#39;un compte. Pour savoir ce qu&#39;est le nonce, vous pouvez interroger la cha√Æne de blocs, par exemple via l&#39;interface web3. Ouvrez une console JavaScript dans Geth (ou votre interface web3 pr√©f√©r√©e) sur Ropsten testnet, puis tapez¬†:</p>
</div>
<pre data-type="programlisting">
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f")</strong>
40

</pre>
<div class="admonitionblock tip data-line-71">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-72">
<p>Le nonce est un compteur bas√© sur z√©ro, ce qui signifie que la premi√®re transaction a le nonce 0. Dans cet exemple, nous avons un nombre de transactions de 40, ce qui signifie que les nonces 0 √† 39 ont √©t√© vus. Le nonce de la prochaine transaction devra √™tre de 40.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-75">
<p>Votre portefeuille gardera une trace des nonces pour chaque adresse qu&#39;il g√®re. C&#39;est assez simple √† faire, tant que vous n&#39;effectuez des transactions qu&#39;√† partir d&#39;un seul point. Disons que vous √©crivez votre propre logiciel de portefeuille ou une autre application qui g√©n√®re des transactions. Comment suivre les nonces ?</p>
</div>
<div class="paragraph data-line-77">
<p>Lorsque vous cr√©ez une nouvelle transaction, vous affectez le nonce suivant dans la s√©quence. Mais jusqu&#39;√† ce qu&#39;il soit confirm√©, il ne comptera pas dans le total getTransactionCount.</p>
</div>
<div id="get_tx_count_bug" class="admonitionblock warning data-line-81">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-82">
<p>Soyez prudent lorsque vous utilisez la fonction getTransactionCount pour compter les transactions en attente, car vous pourriez rencontrer des probl√®mes si vous envoyez quelques transactions √† la suite.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-85">
<p>Regardons un exemple¬†:</p>
</div>
<pre data-type="programlisting">
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f", \
"pending")</strong>
40
&gt; <strong>web3.eth.sendTransaction({from: web3.eth.accounts[0], to: \
"0xB0920c523d582040f2BCB1bD7FB1c7C1ECEbdB34", value: web3.utils.toWei(0.01, "ether")});</strong>
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f", \
"pending")</strong>
41
&gt; <strong>web3.eth.sendTransaction({from: web3.eth.accounts[0], to: \
"0xB0920c523d582040f2BCB1bD7FB1c7C1ECEbdB34", value: web3.utils.toWei(0.01, "ether")});</strong>
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f", \
"pending")</strong>
41
&gt; <strong>web3.eth.sendTransaction({from: web3.eth.accounts[0], to: \
"0xB0920c523d582040f2BCB1bD7FB1c7C1ECEbdB34", value: web3.utils.toWei(0.01, "ether")});</strong>
&gt; <strong>web3.eth.getTransactionCount("0x9e713963a92c02317a681b9bb3065a8249de124f", \
"pending")</strong>
41

</pre>
<div class="admonitionblock tip data-line-111">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-112">
<p>Si vous essayez de recr√©er vous-m√™me ces exemples de code dans la console javascript de Geth, vous devez utiliser web3.toWei() au lieu de web3.utils.toWei(). En effet, Geth utilise une ancienne version de la biblioth√®que web3.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-115">
<p>Comme vous pouvez le voir, la premi√®re transaction que nous avons envoy√©e a augment√© le nombre de transactions √† 41, indiquant la transaction en attente. Mais lorsque nous avons envoy√© trois autres transactions en succession rapide, l&#39;appel getTransactionCount ne les a pas compt√©es. Il n&#39;en comptait qu&#39;un, m√™me si vous vous attendiez √† ce qu&#39;il y en ait trois en attente dans le mempool. Si nous attendons quelques secondes pour permettre aux communications r√©seau de s&#39;√©tablir, l&#39;appel getTransactionCount renverra le nombre attendu. Mais dans l&#39;intervalle, bien qu&#39;il y ait plus d&#39;une transaction en attente, cela pourrait ne pas nous aider.</p>
</div>
<div class="paragraph data-line-117">
<p>Lorsque vous construisez une application qui construit des transactions, elle ne peut pas s&#39;appuyer sur <span class="keep-together"><code>getTransactionCount</code></span> pour les transactions en attente. Ce n&#39;est que lorsque les nombres en attente et confirm√©s sont √©gaux (toutes les transactions en attente sont confirm√©es) que vous pouvez faire confiance √† la sortie de getTransactionCount pour d√©marrer votre compteur de nonce. Par la suite, gardez une trace du nonce dans votre application jusqu&#39;√† ce que chaque transaction soit confirm√©e.</p>
</div>
<div class="paragraph data-line-119">
<p>L&#39;interface JSON RPC de Parity propose la fonction parity_nextNonce, qui renvoie le prochain nonce √† utiliser dans une transaction. La fonction parity_nextNonce compte correctement les nonces, m√™me si vous construisez plusieurs transactions en succession rapide sans les confirmer¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>curl --data '{"method":"parity_nextNonce", \
  "params":["0x9e713963a92c02317a681b9bb3065a8249de124f"],\
  "id":1,"jsonrpc":"2.0"}' -H "Content-Type: application/json" -X POST \
  localhost:8545</strong>

{"jsonrpc":"2.0","result":"0x32","id":1}

</pre>
<div id="parity_curl" class="admonitionblock tip data-line-135">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-136">
<p>Parity dispose d&#39;une console Web pour acc√©der √† l&#39;interface JSON RPC, mais ici nous utilisons un client HTTP en ligne de commande pour y acc√©der.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-140">
<h4 id="gaps_nonce">Lacunes dans les nonces, les nonces en double et la confirmation</h4>
<div class="paragraph data-line-142">
<p>Il est important de garder une trace des nonces si vous cr√©ez des transactions par programmation, surtout si vous le faites √† partir de plusieurs processus ind√©pendants <span class="keep-together">simultan√©ment</span>.</p>
</div>
<div class="paragraph data-line-144">
<p>Le r√©seau Ethereum traite les transactions de mani√®re s√©quentielle, sur la base du nonce. Cela signifie que si vous transmettez une transaction avec nonce 0, puis transmettez une transaction avec nonce 2, la deuxi√®me transaction ne sera incluse dans aucun bloc. Il sera stock√© dans le mempool, pendant que le r√©seau Ethereum attend que le nonce manquant apparaisse. Tous les n≈ìuds supposeront que le nonce manquant a simplement √©t√© retard√© et que la transaction avec le nonce 2 a √©t√© re√ßue dans le d√©sordre.</p>
</div>
<div class="paragraph data-line-146">
<p>Si vous transmettez ensuite une transaction avec le nonce 1 manquant, les deux transactions (nonces 1 et 2) seront trait√©es et incluses (si elles sont valides, bien s√ªr). Une fois que vous avez combl√© le vide, le r√©seau peut exploiter la transaction hors s√©quence qu&#39;il a conserv√©e dans le mempool.</p>
</div>
<div class="paragraph data-line-148">
<p>Cela signifie que si vous cr√©ez plusieurs transactions en s√©quence et que l&#39;une d&#39;entre elles n&#39;est officiellement incluse dans aucun bloc, toutes les transactions suivantes seront &quot;bloqu√©es&quot;, en attendant le nonce manquant. Une transaction peut cr√©er un &quot;√©cart&quot; par inadvertance dans la s√©quence nonce car elle n&#39;est pas valide ou n&#39;a pas suffisamment de gaz. Pour que les choses bougent √† nouveau, vous devez transmettre une transaction valide avec le nonce manquant. Vous devez √©galement garder √† l&#39;esprit qu&#39;une fois qu&#39;une transaction avec le nonce &quot;manquant&quot; est valid√©e par le r√©seau, toutes les transactions de diffusion avec les nonces suivants deviendront progressivement valides¬†; il n&#39;est pas possible de &quot;rappeler&quot; une transaction !</p>
</div>
<div class="paragraph data-line-150">
<p>Si, en revanche, vous dupliquez accidentellement un nonce, par exemple en transmettant deux transactions avec le m√™me nonce mais diff√©rents destinataires ou valeurs, l&#39;un d&#39;entre eux sera confirm√© et l&#39;autre sera rejet√©. Celui qui est confirm√© sera d√©termin√© par la s√©quence dans laquelle ils arrivent au premier n≈ìud de validation qui les re√ßoit, c&#39;est-√†-dire que ce sera assez al√©atoire.</p>
</div>
<div class="paragraph data-line-152">
<p>Comme vous pouvez le constater, le suivi des nonces est n√©cessaire, et si votre application ne g√®re pas correctement ce processus, vous rencontrerez des probl√®mes. Malheureusement, les choses deviennent encore plus difficiles si vous essayez de le faire simultan√©ment, comme nous le verrons dans la section suivante.</p>
</div>
</div>
<div class="sect3 data-line-155">
<h4 id="concurrency">Concurrence, origine des transactions et nonces</h4>
<div class="paragraph data-line-157">
<p>La concurrence est un aspect complexe de l&#39;informatique, et il appara√Æt parfois de mani√®re inattendue, en particulier dans les syst√®mes en temps r√©el d√©centralis√©s et distribu√©s comme <span class="keep-together">Ethereum</span>.</p>
</div>
<div class="paragraph data-line-159">
<p>En termes simples, la concurrence est lorsque vous avez un calcul simultan√© par plusieurs syst√®mes ind√©pendants. Ceux-ci peuvent se trouver dans le m√™me programme (par exemple, multithreading), sur le m√™me processeur (par exemple, multitraitement) ou sur diff√©rents ordinateurs (c&#39;est-√†-dire, <span class="keep-together">syst√®mes</span> distribu√©s). Ethereum, par d√©finition, est un syst√®me qui permet la simultan√©it√© des op√©rations (n≈ìuds, clients, DApps) mais applique un √©tat singleton par consensus.</p>
</div>
<div class="paragraph data-line-161">
<p>Maintenant, imaginez que vous ayez plusieurs applications de portefeuille ind√©pendantes qui g√©n√®rent des transactions √† partir de la ou des m√™mes adresses. Un exemple d&#39;une telle situation serait un √©change traitant des retraits du portefeuille chaud de l&#39;√©change (un portefeuille dont les cl√©s sont stock√©es en ligne, contrairement √† un portefeuille froid o√π les cl√©s ne sont jamais en ligne). Id√©alement, vous voudriez avoir plus d&#39;un ordinateur traitant les retraits, afin qu&#39;il ne devienne pas un goulot d&#39;√©tranglement ou un point de d√©faillance unique. Cependant, cela devient rapidement probl√©matique, car le fait d&#39;avoir plus d&#39;un ordinateur produisant des retraits entra√Ænera des probl√®mes √©pineux de concurrence, dont le moindre n&#39;est pas la s√©lection des nonces. Comment plusieurs ordinateurs g√©n√©rant, signant et diffusant des transactions √† partir du m√™me compte du portefeuille chaud (Hot Wallet) se coordonnent-ils ?</p>
</div>
<div class="paragraph data-line-163">
<p>Vous pouvez utiliser un seul ordinateur pour attribuer des nonces, selon le principe du premier arriv√©, premier servi, aux ordinateurs signant des transactions. Cependant, cet ordinateur est maintenant un point de d√©faillance unique. Pire encore, si plusieurs nonces sont attribu√©s et que l&#39;un d&#39;entre eux n&#39;est jamais utilis√© (√† cause d&#39;une d√©faillance de l&#39;ordinateur traitant la transaction avec ce nonce), toutes les transactions suivantes restent bloqu√©es.</p>
</div>
<div class="paragraph data-line-165">
<p>Une autre approche serait de g√©n√©rer les transactions, mais de ne pas leur attribuer de nonce (et donc de les laisser non sign√©es - rappelez-vous que le nonce fait partie int√©grante des donn√©es de transaction et doit donc √™tre inclus dans la signature num√©rique qui authentifie la transaction) . Vous pouvez ensuite les mettre en file d&#39;attente sur un seul n≈ìud qui les signe et garde √©galement une trace des nonces. Encore une fois, cependant, ce serait un point d&#39;√©tranglement dans le processus¬†: la signature et le suivi des nonces est la partie de votre op√©ration qui est susceptible d&#39;√™tre encombr√©e sous charge, alors que la g√©n√©ration de la transaction non sign√©e est la partie que vous n&#39;avez pas vraiment besoin de parall√©liser. Vous auriez une certaine concurrence, mais il y aurait un manque dans une partie essentielle du processus.</p>
</div>
<div class="paragraph data-line-167">
<p>En fin de compte, ces probl√®mes de simultan√©it√©, en plus de la difficult√© de suivre les soldes des comptes et les confirmations de transaction dans des processus ind√©pendants, obligent la plupart des impl√©mentations √† √©viter la simultan√©it√© et √† cr√©er des goulots d&#39;√©tranglement tels qu&#39;un processus unique g√©rant toutes les transactions de retrait dans un √©change, ou la mise en place de plusieurs des portefeuilles chauds qui peuvent fonctionner de mani√®re totalement ind√©pendante pour les retraits et ne doivent √™tre r√©√©quilibr√©s que par intermittence.</p>
</div>
</div>
</div>
<div class="sect2 data-line-170">
<h3 id="tx_gas">Gaz de transaction</h3>
<div class="paragraph data-line-172">
<p>Nous avons un peu parl√© du gaz dans les chapitres pr√©c√©dents, et nous en discutons plus en d√©tail dans <a href="#gas">Gas</a>. Cependant, couvrons quelques notions de base sur le r√¥le des composants gasPrice et gasLimit d&#39;une transaction.</p>
</div>
<div class="paragraph data-line-174">
<p>Le gaz est le carburant d&#39;Ethereum. Le gaz n&#39;est pas de l&#39;ether, c&#39;est une monnaie virtuelle distincte avec son propre taux de change par rapport √† l&#39;ether. Ethereum utilise du gaz pour contr√¥ler la quantit√© de ressources qu&#39;une transaction peut utiliser, car elle sera trait√©e sur des milliers d&#39;ordinateurs √† travers le monde. Le mod√®le de calcul ouvert (Turing-complet) n√©cessite une certaine forme de mesure afin d&#39;√©viter les attaques par d√©ni de service ou les transactions gourmandes en ressources par inadvertance.</p>
</div>
<div class="paragraph data-line-176">
<p>Le gaz est s√©par√© de l&#39;ether afin de prot√©ger le syst√®me de la volatilit√© qui pourrait survenir avec les changements rapides de la valeur de l&#39;ether, et aussi comme moyen de g√©rer les rapports importants et sensibles entre les co√ªts des diverses ressources que le gaz paie. (√† savoir, calcul, m√©moire et stockage).</p>
</div>
<div class="paragraph data-line-178">
<p>Le champ gasPrice dans une transaction permet √† l&#39;initiateur de la transaction de d√©finir le prix qu&#39;il est pr√™t √† payer en √©change de gaz. Le prix est mesur√© en wei par unit√© de gaz. Par exemple, dans l&#39;exemple de transaction dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a> votre portefeuille fixe le gasPrice √† 3 gwei (3 gigawei ou 3 milliards de wei).</p>
</div>
<div class="admonitionblock tip data-line-181">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-182">
<p>Le site populaire <a href="https://ethgasstation.info/" data-href="https://ethgasstation.info/">ETH Gas Station</a> fournit des informations sur les prix actuels du gaz et d&#39;autres param√®tres de gaz pertinents pour le r√©seau principal Ethereum.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-185">
<p>Les portefeuilles peuvent ajuster le gasPrice dans les transactions qu&#39;ils g√©n√®rent pour obtenir une confirmation plus rapide des transactions. Plus le gasPrice est √©lev√©, plus la transaction est susceptible d&#39;√™tre confirm√©e rapidement. √Ä l&#39;inverse, les transactions moins prioritaires peuvent avoir un prix r√©duit, ce qui entra√Æne une confirmation plus lente. La valeur minimale √† laquelle gasPrice peut √™tre d√©fini est z√©ro, ce qui signifie une transaction sans frais. Pendant les p√©riodes de faible demande d&#39;espace dans un bloc, de telles transactions pourraient tr√®s bien √™tre min√©es.</p>
</div>
<div class="admonitionblock note data-line-188">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-189">
<p>Le gasPrice minimum acceptable est z√©ro. Cela signifie que les portefeuilles peuvent g√©n√©rer des transactions totalement gratuites. Selon la capacit√©, celles-ci peuvent ne jamais √™tre confirm√©es, mais rien dans le protocole n&#39;interdit les transactions gratuites. Vous pouvez trouver plusieurs exemples de telles transactions incluses avec succ√®s sur la cha√Æne de blocs Ethereum.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="gas_price_suggestion" class="paragraph data-line-193">
<p>L&#39;interface web3 propose une suggestion gasPrice, en calculant un prix m√©dian sur plusieurs blocs (nous pouvons utiliser la console truffle ou n&#39;importe quelle console web3 JavaScript pour le faire)¬†:</p>
</div>
<pre data-type="programlisting">
> <strong>web3.eth.getGasPrice(console.log)</strong>
> null BigNumber { s: 1, e: 10, c: [ 10000000000 ] }

</pre>
<div id="calc_gas_price" class="paragraph data-line-204">
<p>Le deuxi√®me champ important li√© au gaz est gasLimit. En termes simples, gasLimit donne le nombre maximum d&#39;unit√©s de gaz que l&#39;initiateur de la transaction est pr√™t √† acheter pour finaliser la transaction. Pour les paiements simples, c&#39;est-√†-dire les transactions qui transf√®rent de l&#39;ether d&#39;un EOA √† un autre EOA, la quantit√© de gaz n√©cessaire est fix√©e √† 21 000 unit√©s de gaz. Pour calculer combien d&#39;ether cela co√ªtera, vous multipliez 21 000 par le gasPrice que vous √™tes pr√™t √† payer. Par example:</p>
</div>
<pre data-type="programlisting">
> <strong>web3.eth.getGasPrice(function(err, res) {console.log(res*21000)} )</strong>
> 210000000000000

</pre>
<div class="paragraph data-line-214">
<p>Si l&#39;adresse de destination de votre transaction est un contrat, la quantit√© de gaz n√©cessaire peut √™tre estim√©e mais ne peut pas √™tre d√©termin√©e avec pr√©cision. En effet, un contrat peut √©valuer diff√©rentes conditions qui conduisent √† diff√©rentes voies d&#39;ex√©cution, avec diff√©rents co√ªts totaux du gaz. Le contrat peut n&#39;ex√©cuter qu&#39;un calcul simple ou un calcul plus complexe, selon des conditions ind√©pendantes de votre volont√© et impr√©visibles. Pour le d√©montrer, regardons un exemple¬†: nous pouvons √©crire un contrat intelligent qui incr√©mente un compteur √† chaque fois qu&#39;il est appel√© et ex√©cute une boucle particuli√®re un nombre de fois √©gal au nombre d&#39;appels. Peut-√™tre qu&#39;au 100e appel, il distribue un prix sp√©cial, comme une loterie, mais doit faire des calculs suppl√©mentaires pour calculer le prix. Si vous appelez le contrat 99 fois, une chose se produit, mais au 100e appel, quelque chose de tr√®s diff√©rent se produit. La quantit√© de gaz que vous paieriez pour cela d√©pend du nombre d&#39;autres transactions qui ont appel√© cette fonction avant que votre transaction ne soit incluse dans un bloc. Peut-√™tre que votre estimation est bas√©e sur la 99e transaction, mais juste avant que votre transaction ne soit confirm√©e, quelqu&#39;un d&#39;autre appelle le contrat pour la 99e fois. Vous √™tes maintenant la 100e transaction √† appeler, et l&#39;effort de calcul (et le co√ªt du gaz) est beaucoup plus √©lev√©.</p>
</div>
<div class="paragraph data-line-216">
<p>Pour emprunter une analogie courante utilis√©e dans Ethereum, vous pouvez consid√©rer gasLimit comme la capacit√© du r√©servoir de carburant de votre voiture (votre voiture est la transaction). Vous remplissez le r√©servoir avec autant d&#39;essence que vous pensez qu&#39;il en aura besoin pour le trajet (le calcul n√©cessaire pour valider votre transaction). Vous pouvez estimer le montant dans une certaine mesure, mais il peut y avoir des changements inattendus dans votre trajet, comme une d√©viation (un chemin d&#39;ex√©cution plus complexe), qui augmentent la consommation de carburant.</p>
</div>
<div class="paragraph data-line-218">
<p>L&#39;analogie avec un r√©servoir de carburant est cependant quelque peu trompeuse. Il s&#39;agit en fait plus d&#39;un compte de cr√©dit pour une entreprise de station-service, o√π vous payez une fois le voyage termin√©, en fonction de la quantit√© d&#39;essence que vous avez r√©ellement utilis√©e. Lorsque vous transmettez votre transaction, l&#39;une des premi√®res √©tapes de validation consiste √† v√©rifier que le compte dont elle provient dispose de suffisamment d&#39;ether pour payer la limite gasPrice * gaz. Mais le montant n&#39;est pas r√©ellement d√©duit de votre compte tant que la transaction n&#39;est pas termin√©e. Vous n&#39;√™tes factur√© que pour le gaz r√©ellement consomm√© par votre transaction, mais vous devez disposer d&#39;un solde suffisant pour le montant maximum que vous √™tes pr√™t √† payer avant d&#39;envoyer votre transaction.</p>
</div>
</div>
<div class="sect2 data-line-221">
<h3 id="tx_recipient">Destinataire de la transaction</h3>
<div class="paragraph data-line-223">
<p>Le destinataire d&#39;une transaction est sp√©cifi√© dans le champ to. Celui-ci contient une adresse Ethereum de 20 octets. L&#39;adresse peut √™tre une EOA ou une adresse de contrat.</p>
</div>
<div class="paragraph data-line-225">
<p>Ethereum ne valide plus ce champ. Toute valeur de 20 octets est consid√©r√©e comme valide. Si la valeur de 20 octets correspond √† une adresse sans cl√© priv√©e correspondante, ou sans contrat correspondant, la transaction est toujours valide. Ethereum n&#39;a aucun moyen de savoir si une adresse a √©t√© correctement d√©riv√©e d&#39;une cl√© publique (et donc d&#39;une cl√© priv√©e) existante.</p>
</div>
<div class="admonitionblock warning data-line-228">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-229">
<p>Le protocole Ethereum ne valide pas les adresses des destinataires dans les transactions. Vous pouvez envoyer √† une adresse qui n&#39;a pas de cl√© priv√©e ou de contrat correspondant, &quot;br√ªlant&quot; ainsi l&#39;ether, le rendant √† jamais inutilisable. La validation doit √™tre effectu√©e au niveau de l&#39;interface utilisateur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-232">
<p>L&#39;envoi d&#39;une transaction √† la mauvaise adresse va probablement <em>br√ªler</em> l&#39;ether envoy√©, le rendant √† jamais inaccessible (inutilisable), puisque la plupart des adresses n&#39;ont pas de cl√© priv√©e connue et donc aucune signature ne peut √™tre g√©n√©r√©e pour le d√©penser. On suppose que la validation de l&#39;adresse se produit au niveau de l&#39;interface utilisateur (voir <a href="#EIP55">Encodage hexad√©cimal avec somme de contr√¥le en majuscules (EIP-55)</a>). En fait, il existe un certain nombre de raisons valables pour br√ªler de l&#39;ether - par exemple, pour dissuader de tricher dans les canaux de paiement et autres contrats intelligents - et puisque la quantit√© d&#39;ether est finie, br√ªler de l&#39;ether distribue efficacement la valeur br√ªl√©e √† tous les d√©tenteurs d&#39;ether. (proportionnellement √† la quantit√© d&#39;ether qu&#39;ils contiennent).</p>
</div>
</div>
<div class="sect2 data-line-235">
<h3 id="tx_value_data">Valeur et donn√©es de la transaction</h3>
<div class="paragraph data-line-237">
<p>La &quot;charge utile&quot; principale d&#39;une transaction est contenue dans deux¬†champs¬†: value et data. Les transactions peuvent avoir √† la fois une valeur et des donn√©es, uniquement une valeur, uniquement des donn√©es ou ni valeur ni donn√©es. Les quatre combinaisons sont valides.</p>
</div>
<div class="paragraph data-line-239">
<p>Une transaction avec seulement une valeur est un <em>paiement</em>. Une transaction avec uniquement des donn√©es est une <em>invocation</em>. Une transaction comportant √† la fois de la valeur et des donn√©es est √† la fois un paiement et une invocation. Une transaction sans valeur ni donn√©es - eh bien, ce n&#39;est probablement qu&#39;un gaspillage de gaz¬†! Mais c&#39;est encore possible.</p>
</div>
<div class="paragraph data-line-241">
<p>Essayons toutes ces combinaisons. Nous allons d&#39;abord d√©finir les adresses source et de destination de notre portefeuille, juste pour rendre la d√©mo plus facile √† lire¬†:</p>
</div>
<div class="listingblock data-line-244">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">src = web3.eth.accounts[0];
dst = web3.eth.accounts[1];</code></pre>
</div>
</div>
<div class="paragraph data-line-249">
<p>Notre premi√®re transaction ne contient qu&#39;une valeur (paiement) et aucune charge de donn√©es¬†:</p>
</div>
<div id="tx_value_nodata_src" class="listingblock data-line-253">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">web3.eth.sendTransaction({from: src, to: dst, \
  value: web3.utils.toWei(0.01, "ether"), data: ""});</code></pre>
</div>
</div>
<div class="paragraph data-line-258">
<p>Notre portefeuille affiche un √©cran de confirmation indiquant la valeur √† envoyer, comme indiqu√© dans <a href="#parity_txdemo_value_nodata">Portefeuille de Parity montrant une transaction avec une valeur, mais pas de donn√©es</a>.</p>
</div>
<div id="parity_txdemo_value_nodata" class="imageblock data-line-262">
<div class="content">
<img src="images/parity_txdemo_value_nodata.png" alt="&quot;Portefeuille de Parity montrant une transaction avec valeur" width="mais pas de donn√©es&quot;">
</div>
<div class="title">Figure 31. Portefeuille de Parity montrant une transaction avec une valeur, mais pas de donn√©es</div>
</div>
<div class="paragraph data-line-265">
<p>L&#39;exemple suivant sp√©cifie √† la fois une valeur et une charge utile de donn√©es¬†:</p>
</div>
<div id="tx_value_data_src" class="listingblock data-line-269">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">web3.eth.sendTransaction({from: src, to: dst, \
  value: web3.utils.toWei(0.01, "ether"), data: "0x1234"});</code></pre>
</div>
</div>
<div class="paragraph data-line-274">
<p>Notre portefeuille affiche un √©cran de confirmation indiquant la valeur √† envoyer ainsi que la charge utile des donn√©es, comme indiqu√© dans <a href="#parity_txdemo_value_data">Portefeuille de Parity montrant une transaction avec valeur et donn√©es</a>.</p>
</div>
<div id="parity_txdemo_value_data" class="imageblock data-line-278">
<div class="content">
<img src="images/parity_txdemo_value_data.png" alt="&quot;Portefeuille de Parity montrant une transaction avec valeur et donn√©es&quot;">
</div>
<div class="title">Figure 32. Portefeuille de Parity montrant une transaction avec valeur et donn√©es</div>
</div>
<div class="paragraph data-line-280">
<p>La transaction suivante inclut une charge utile de donn√©es mais sp√©cifie une valeur de z√©ro¬†:</p>
</div>
<div id="tx_novalue_data_src" class="listingblock data-line-284">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">web3.eth.sendTransaction({from: src, to: dst, value: 0, data: "0x1234"});</code></pre>
</div>
</div>
<div class="paragraph data-line-288">
<p>Notre portefeuille affiche un √©cran de confirmation indiquant la valeur z√©ro et la charge utile des donn√©es, comme indiqu√© dans <a href="#parity_txdemo_novalue_data">Portefeuille de Parity montrant une transaction sans valeur, uniquement des donn√©es</a>.</p>
</div>
<div id="parity_txdemo_novalue_data" class="imageblock data-line-292">
<div class="content">
<img src="images/parity_txdemo_novalue_data.png" alt="&quot;Portefeuille de Parity montrant une transaction sans valeur" width="uniquement des donn√©es&quot;">
</div>
<div class="title">Figure 33. Portefeuille de Parity montrant une transaction sans valeur, uniquement des donn√©es</div>
</div>
<div class="paragraph pagebreak-before data-line-295">
<p>Enfin, la derni√®re transaction n&#39;inclut ni valeur √† envoyer ni donn√©es utiles¬†:</p>
</div>
<div id="tx_novalue_nodata_src" class="listingblock data-line-299">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">web3.eth.sendTransaction({from: src, to: dst, value: 0, data: ""}));</code></pre>
</div>
</div>
<div class="paragraph data-line-303">
<p>Notre portefeuille affiche un √©cran de confirmation indiquant la valeur z√©ro, comme indiqu√© dans <a href="#parity_txdemo_novalue_nodata">Portefeuille de Parity montrant une transaction sans valeur et sans donn√©es</a>.</p>
</div>
<div id="parity_txdemo_novalue_nodata" class="imageblock data-line-307">
<div class="content">
<img src="images/parity_txdemo_novalue_nodata.png" alt="&quot;Portefeuille de Parity montrant une transaction sans valeur et sans donn√©es&quot;">
</div>
<div class="title">Figure 34. Portefeuille de Parity montrant une transaction sans valeur et sans donn√©es</div>
</div>
<div class="sect3 data-line-310">
<h4 id="value_EOA_contracts">Transmettre de la valeur aux EOA et aux contrats</h4>
<div class="paragraph data-line-312">
<p>Lorsque vous construisez une transaction Ethereum qui contient une valeur, c&#39;est l&#39;√©quivalent d&#39;un <em>paiement</em>. Ces transactions se comportent diff√©remment selon que l&#39;adresse de destination est un contrat ou non.</p>
</div>
<div class="paragraph data-line-314">
<p>Pour les adresses EOA, ou plut√¥t pour toute adresse qui n&#39;est pas signal√©e comme un contrat sur la cha√Æne de blocs, Ethereum enregistrera un changement d&#39;√©tat, ajoutant la valeur que vous avez envoy√©e au solde de l&#39;adresse. Si l&#39;adresse n&#39;a pas √©t√© vue auparavant, elle sera ajout√©e √† la repr√©sentation interne de l&#39;√©tat du client et son solde initialis√© √† la valeur de votre paiement.</p>
</div>
<div class="paragraph data-line-316">
<p>Si l&#39;adresse de destination (to) est un contrat, alors l&#39;EVM ex√©cutera le contrat et tentera d&#39;appeler la fonction nomm√©e dans la charge utile de donn√©es de votre transaction. S&#39;il n&#39;y a pas de donn√©es dans votre transaction, l&#39;EVM appellera une fonction <em>fallback</em> (ou fonction de repli ou par d√©faut) et, si cette fonction est payante, l&#39;ex√©cutera pour d√©terminer ce qu&#39;il faut faire ensuite. S&#39;il n&#39;y a pas de code dans la fonction de secours, l&#39;effet de la transaction sera d&#39;augmenter le solde du contrat, exactement comme un paiement sur un portefeuille. S&#39;il n&#39;y a pas de fonction de secours ou de fonction de secours non payante, la transaction sera annul√©e.</p>
</div>
<div class="paragraph data-line-318">
<p>Un contrat peut rejeter les paiements entrants en levant une exception imm√©diatement lorsqu&#39;une fonction est appel√©e, ou tel que d√©termin√© par des conditions cod√©es dans une fonction. Si la fonction se termine avec succ√®s (sans exception), l&#39;√©tat du contrat est mis √† jour pour refl√©ter une augmentation du solde d&#39;ether du contrat.</p>
</div>
</div>
<div class="sect3 data-line-321">
<h4 id="data_EOA">Transmission d&#39;une charge utile de donn√©es √† un EOA ou √† un contrat</h4>
<div class="paragraph data-line-323">
<p>Lorsque votre transaction contient des donn√©es, elle est tr√®s probablement adress√©e √† une adresse de contrat. Cela ne signifie pas que vous ne pouvez pas envoyer une charge utile de donn√©es √† un EOA, ce qui est tout √† fait valide dans le protocole Ethereum. Cependant, dans ce cas, l&#39;interpr√©tation des donn√©es d√©pend du portefeuille que vous utilisez pour acc√©der √† l&#39;EOA. Il est ignor√© par le protocole Ethereum. La plupart des portefeuilles ignorent √©galement toutes les donn√©es re√ßues lors d&#39;une transaction vers un EOA qu&#39;ils contr√¥lent. √Ä l&#39;avenir, il est possible que des normes √©mergent qui permettent aux portefeuilles d&#39;interpr√©ter les donn√©es comme le font les contrats, permettant ainsi aux transactions d&#39;invoquer des fonctions ex√©cut√©es √† l&#39;int√©rieur des portefeuilles des utilisateurs. La diff√©rence essentielle est que toute interpr√©tation de la charge utile de donn√©es par un EOA n&#39;est pas soumise aux r√®gles de consensus d&#39;Ethereum, contrairement √† un contrat <span class="keep-together">ex√©cution</span>.</p>
</div>
<div class="paragraph data-line-325">
<p>Pour l&#39;instant, supposons que votre transaction envoie des donn√©es √† une adresse contractuelle. Dans ce cas, les donn√©es seront interpr√©t√©es par l&#39;EVM comme une <em>invocation de contrat</em>.  La plupart des contrats utilisent ces donn√©es plus sp√©cifiquement comme <em>invocation de fonction</em>, appelant la fonction nomm√©e et transmettant tous les arguments cod√©s √† la fonction.</p>
</div>
<div class="paragraph data-line-327">
<p>La charge utile de donn√©es envoy√©e √† un contrat compatible ABI (dont vous pouvez supposer que tous les contrats le sont) est un codage hexad√©cimal de¬†:</p>
</div>
<div class="dlist data-line-329">
<dl>
<dt class="hdlist1">Un s√©lecteur de fonction</dt>
<dd>
<p>Les 4 premiers octets du hachage Keccak-256 du prototype de la fonction. Cela permet au contrat d&#39;identifier sans ambigu√Øt√© la fonction que vous souhaitez invoquer.</p>
</dd>
<dt class="hdlist1">Les arguments de la fonction</dt>
<dd>
<p>Les arguments de la fonction, encod√©s selon les r√®gles des diff√©rents types √©l√©mentaires d√©finies dans la sp√©cification ABI.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-333">
<p>Dans <a href="#solidity_faucet_example">Faucet.sol: Un contrat Solidity mettant en place un robinet</a>, nous avons d√©fini une fonction pour les retraits :</p>
</div>
<div id="withdraw_function_src" class="listingblock data-line-337">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function withdraw(uint withdraw_amount) public {</code></pre>
</div>
</div>
<div class="paragraph data-line-341">
<p>Le <em>prototype</em> d&#39;une fonction est d√©fini comme la cha√Æne contenant le nom de la fonction, suivi des types de donn√©es de chacun de ses arguments, entre parenth√®ses et s√©par√©s par des virgules. Le nom de la fonction ici est withdraw et il prend un seul argument qui est un uint (qui est un alias pour uint256), donc le prototype de withdraw serait¬†:</p>
</div>
<div class="listingblock data-line-344">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">withdraw(uint256)</code></pre>
</div>
</div>
<div class="paragraph data-line-348">
<p>Calculons le hachage Keccak-256 de cette cha√Æne¬†:</p>
</div>
<pre data-type="programlisting">
> <strong>web3.utils.sha3("withdraw(uint256)");</strong>
'0x2e1a7d4d13322e7b96f9a57413e1525c250fb7a9021cf91d1540d5b69f16a49f'

</pre>
<div class="paragraph data-line-358">
<p>Les 4 premiers octets du hachage sont 0x2e1a7d4d. C&#39;est notre valeur &quot;s√©lecteur de fonction&quot;, qui indiquera au contrat quelle fonction nous voulons appeler.</p>
</div>
<div class="paragraph data-line-360">
<p>Ensuite, calculons une valeur √† passer comme argument withdraw_amount. Nous voulons retirer 0,01 ether. Encodons cela en un entier 256 bits non sign√© gros-boutiste hexa-s√©rialis√©, libell√© en wei¬†:</p>
</div>
<pre data-type="programlisting">
> <strong>withdraw_amount = web3.utils.toWei(0.01, "ether");</strong>
'10000000000000000'
> <strong>withdraw_amount_hex = web3.utils.toHex(withdraw_amount);</strong>
'0x2386f26fc10000'

</pre>
<div class="paragraph data-line-372">
<p>Maintenant, nous ajoutons le s√©lecteur de fonction au montant (rembourr√© √† 32 octets) :</p>
</div>
<div class="listingblock data-line-374">
<div class="content">
<pre>2e1a7d4d000000000000000000000000000000000000000000000000002386f26fc10000</pre>
</div>
</div>
<div class="paragraph data-line-378">
<p>C&#39;est la charge utile de donn√©es pour notre transaction, appelant la fonction withdraw et demandant 0,01¬†√©ther comme withdraw_amount.</p>
</div>
</div>
</div>
<div class="sect2 data-line-381">
<h3 id="contract_reg">Transaction sp√©ciale¬†: cr√©ation de contrat</h3>
<div class="paragraph data-line-383">
<p>Un cas particulier que nous devrions mentionner est une transaction qui <em>cr√©e un nouveau contrat</em> sur la cha√Æne de blocs, le d√©ployant pour une utilisation future. Les transactions de cr√©ation de contrat sont envoy√©es √† une adresse de destination sp√©ciale appel√©e <em>adresse z√©ro</em>¬†; le champ to dans une transaction d&#39;enregistrement de contrat contient l&#39;adresse 0x0. Cette adresse ne repr√©sente ni un EOA (il n&#39;y a pas de paire de cl√©s priv√©e-publique correspondante) ni un contrat. Il ne peut jamais d√©penser d&#39;ether ou initier une transaction. Il n&#39;est utilis√© que comme destination, avec la signification sp√©ciale &quot;cr√©er ce contrat&quot;.</p>
</div>
<div class="paragraph data-line-385">
<p>Alors que l&#39;adresse z√©ro est destin√©e uniquement √† la cr√©ation de contrats, elle re√ßoit parfois des paiements de diff√©rentes adresses. Il y a deux explications √† cela¬†: soit c&#39;est par accident, entra√Ænant la perte d&#39;√©ther, soit c&#39;est une <em>br√ªlure d&#39;ether</em> intentionnelle (d√©truisant d√©lib√©r√©ment l&#39;ether en l&#39;envoyant √† une adresse d&#39;o√π il ne peut jamais √™tre d√©pens√©). Cependant, si vous souhaitez effectuer une br√ªlure intentionnelle d&#39;ether, vous devez indiquer clairement votre intention au r√©seau et utiliser √† la place l&#39;adresse de brpulure sp√©cialement d√©sign√©e¬†:</p>
</div>
<div id="burn_address" class="listingblock data-line-388">
<div class="content">
<pre>0x000000000000000000000000000000000000dEaD</pre>
</div>
</div>
<div class="admonitionblock warning data-line-393">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-394">
<p>Tout ether envoy√© √† l&#39;adresse de br√ªlure d√©sign√©e deviendra inutilisable et sera perdu √† jamais.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-397">
<p>Une transaction de cr√©ation de contrat ne doit contenir qu&#39;une charge utile de donn√©es contenant le bytecode compil√© qui cr√©era le contrat. Le seul effet de cette transaction est de cr√©er le contrat. Vous pouvez inclure un montant en ether dans le champ value si vous souhaitez configurer le nouveau contrat avec un solde de d√©part, mais cela est enti√®rement facultatif. Si vous envoyez une valeur (ether) √† l&#39;adresse de cr√©ation de contrat sans charge utile de donn√©es (pas de contrat), l&#39;effet est le m√™me que l&#39;envoi √† une adresse de br√ªlure : il n&#39;y a pas de contrat √† cr√©diter, donc l&#39;ether est perdu.</p>
</div>
<div class="paragraph data-line-399">
<p>Par exemple, nous pouvons cr√©er le contrat <em>Faucet.sol</em> utilis√© dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a> en cr√©ant manuellement une transaction √† l&#39;adresse z√©ro avec le contrat dans la charge utile des donn√©es. Le contrat doit √™tre compil√© dans une repr√©sentation en bytecode. Cela peut √™tre fait avec le compilateur Solidity :</p>
</div>
<pre data-type="programlisting" class="pagebreak-before">
$ <strong>solc --bin Faucet.sol</strong>

Binary:
6060604052341561000f57600080fd5b60e58061001d6000396000f30060606040526004361060...

</pre>
<div class="paragraph data-line-411">
<p>Les m√™mes informations peuvent √©galement √™tre obtenues √† partir du compilateur en ligne Remix.</p>
</div>
<div class="paragraph data-line-413">
<p>Nous pouvons maintenant cr√©er la transaction¬†:</p>
</div>
<pre data-type="programlisting">
> <strong>src = web3.eth.accounts[0];</strong>
> <strong>faucet_code = \
  "0x6060604052341561000f57600080fd5b60e58061001d6000396000f300606...f0029";</strong>
> <strong>web3.eth.sendTransaction({from: src, to: 0, data: faucet_code, \
  gas: 113558, gasPrice: 200000000000});</strong>

"0x7bcc327ae5d369f75b98c0d59037eec41d44dfae75447fd753d9f2db9439124b"

</pre>
<div class="paragraph data-line-428">
<p>Il est recommand√© de toujours sp√©cifier un param√®tre to, m√™me dans le cas d&#39;une cr√©ation de contrat sans adresse, car le co√ªt d&#39;envoyer accidentellement votre ether √† 0x0 et de le perdre pour toujours est trop √©lev√©. Vous devez √©galement sp√©cifier un gasPrice et un gasLimit.</p>
</div>
<div class="paragraph data-line-430">
<p>Une fois le contrat extrait, nous pouvons le voir sur l&#39;explorateur de blocs Etherscan, comme indiqu√© dans <a href="#publish_contract_from_web3">Etherscan montrant le contrat min√© avec succ√®s</a>.</p>
</div>
<div id="publish_contract_from_web3" class="imageblock data-line-434">
<div class="content">
<img src="images/contract_published.png" alt="&quot;Etherscan montrant le contrat extrait avec succ√®s&quot;">
</div>
<div class="title">Figure 35. Etherscan montrant le contrat min√© avec succ√®s</div>
</div>
<div class="paragraph data-line-436">
<p>Nous pouvons regarder le re√ßu de la transaction pour obtenir des informations sur le contrat :</p>
</div>
<pre data-type="programlisting">
> <strong>web3.eth.getTransactionReceipt( \
  "0x7bcc327ae5d369f75b98c0d59037eec41d44dfae75447fd753d9f2db9439124b");</strong>

{
  blockHash: "0x6fa7d8bf982490de6246875deb2c21e5f3665b4422089c060138fc3907a95bb2",
  blockNumber: 3105256,
  contractAddress: "0xb226270965b43373e98ffc6e2c7693c17e2cf40b",
  cumulativeGasUsed: 113558,
  from: "0x2a966a87db5913c1b22a59b0d8a11cc51c167a89",
  gasUsed: 113558,
  logs: [],
  logsBloom: \
    "0x00000000000000000000000000000000000000000000000000...00000",
  status: "0x1",
  to: null,
  transactionHash: \
    "0x7bcc327ae5d369f75b98c0d59037eec41d44dfae75447fd753d9f2db9439124b",
  transactionIndex: 0
}

</pre>
<div class="paragraph data-line-463">
<p>Cela inclut l&#39;adresse du contrat, que nous pouvons utiliser pour envoyer et recevoir des fonds du contrat, comme indiqu√© dans la section pr√©c√©dente¬†:</p>
</div>
<pre data-type="programlisting">
> <strong>contract_address = "0xb226270965b43373e98ffc6e2c7693c17e2cf40b"</strong>
> <strong>web3.eth.sendTransaction({from: src, to: contract_address, \
  value: web3.utils.toWei(0.1, "ether"), data: ""});</strong>

"0x6ebf2e1fe95cc9c1fe2e1a0dc45678ccd127d374fdf145c5c8e6cd4ea2e6ca9f"

> <strong>web3.eth.sendTransaction({from: src, to: contract_address, value: 0, data: \
  "0x2e1a7d4d000000000000000000000000000000000000000000000000002386f26fc10000"});</strong>

"0x59836029e7ce43e92daf84313816ca31420a76a9a571b69e31ec4bf4b37cd16e"

</pre>
<div class="paragraph data-line-481">
<p>Apr√®s un certain temps, les deux transactions sont visibles sur Etherscan, comme indiqu√© dans <a href="#publish_contract_transactions">Etherscan montrant les transactions d&#39;envoi et de r√©ception de fonds</a>.</p>
</div>
<div id="publish_contract_transactions" class="imageblock data-line-485">
<div class="content">
<img src="images/published_contract_transactions.png" alt="&quot;Etherscan affichant les transactions d&#39;envoi et de r√©ception de fonds&quot;">
</div>
<div class="title">Figure 36. Etherscan montrant les transactions d&#39;envoi et de r√©ception de fonds</div>
</div>
</div>
<div class="sect2 data-line-489">
<h3 id="digital_sign">Signatures num√©riques</h3>
<div class="paragraph data-line-491">
<p>Jusqu&#39;√† pr√©sent, nous n&#39;avons pas approfondi les d√©tails sur les signatures num√©riques. Dans cette section, nous examinons le fonctionnement des signatures num√©riques et comment elles peuvent √™tre utilis√©es pour pr√©senter une preuve de propri√©t√© d&#39;une cl√© priv√©e sans r√©v√©ler cette cl√© priv√©e.</p>
</div>
<div class="sect3 data-line-494">
<h4 id="ecdsa">L&#39;algorithme de signature num√©rique √† courbe elliptique</h4>
<div class="paragraph data-line-496">
<p>L&#39;algorithme de signature num√©rique utilis√© dans Ethereum est l&#39;_Elliptic Curve Digital Signature Algorithm_ ( ECDSA). Il est bas√© sur des paires de cl√©s priv√©es-publiques √† courbe elliptique, comme d√©crit dans <a href="#elliptic_curve">La cryptographie √† courbe elliptique expliqu√©e</a>.</p>
</div>
<div class="paragraph data-line-498">
<p>Une signature num√©rique sert trois objectifs dans Ethereum (voir l&#39;encadr√© suivant). Premi√®rement, la signature prouve que le propri√©taire de la cl√© priv√©e, qui est implicitement le propri√©taire d&#39;un compte Ethereum, a <em>autoris√©</em> la d√©pense d&#39;ether ou l&#39;ex√©cution d&#39;un contrat. Deuxi√®mement, il garantit la <em>non-r√©pudiation</em> : la preuve de l&#39;autorisation est ind√©niable. Troisi√®mement, la signature prouve que les donn√©es de transaction n&#39;ont pas √©t√© et <em>ne peuvent pas √™tre modifi√©es</em> par quiconque apr√®s la signature de la transaction.</p>
</div>
<div id="digital_signature_definition" class="sidebarblock data-line-502">
<div class="content">
<div class="title">D√©finition de Wikipedia d&#39;une signature num√©rique</div>
<div class="paragraph data-line-503">
<p>Une <em>signature num√©rique</em> est un sch√©ma math√©matique permettant de pr√©senter l&#39;authenticit√© de messages ou de documents num√©riques. Une signature num√©rique valide donne au destinataire des raisons de croire que le message a √©t√© cr√©√© par un exp√©diteur connu (authentification), que l&#39;exp√©diteur ne peut pas nier avoir envoy√© le message (non-r√©pudiation) et que le message n&#39;a pas √©t√© alt√©r√© en transit (int√©grit√©) .</p>
</div>
<div class="paragraph data-line-505">
<p><em>Source¬†: <a href="https://en.wikipedia.org/wiki/Digital_signature" class="undefined" data-href="https://en.wikipedia.org/wiki/Digital_signature">https://en.wikipedia.org/wiki/Digital_signature</a></em></p>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-509">
<h4 id="digital_sign_work">Comment fonctionnent les signatures num√©riques</h4>
<div class="paragraph data-line-511">
<p>Une signature num√©rique est un sch√©ma math√©matique compos√© de deux parties. La premi√®re partie est un algorithme de cr√©ation d&#39;une signature, √† l&#39;aide d&#39;une cl√© priv√©e (la cl√© de signature), √† partir d&#39;un message (qui dans notre cas est la transaction). La deuxi√®me partie est un algorithme qui permet √† quiconque de v√©rifier la signature en utilisant uniquement le message et une cl√© publique.</p>
</div>
<div class="sect4 data-line-514">
<h5 id="digital_sign_create">Cr√©ation d&#39;une signature num√©rique</h5>
<div class="paragraph data-line-516">
<p>Dans l&#39;impl√©mentation ECDSA d&#39;Ethereum, le &quot;message&quot; sign√© est la transaction , ou plus pr√©cis√©ment, le hachage Keccak-256 des donn√©es encod√©es RLP de la transaction. La cl√© de signature est la cl√© priv√©e de l&#39;EOA. Le r√©sultat est la signature :</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mrow>
      <mi>S</mi>
      <mi>i</mi>
      <mi>g</mi>
    </mrow>
    <mo>=</mo>
    <msub><mi>F</mi> <mrow><mi>s</mi><mi>i</mi><mi>g</mi></mrow> </msub>
    <mrow>
      <mo>(</mo>
      <msub><mi>F</mi> <mrow><mi>k</mi><mi>e</mi><mi>c</mi><mi>c</mi><mi>a</mi><mi>k</mi><mn>256</mn></mrow> </msub>
      <mrow>
        <mo>(</mo>
        <mi>m</mi>
        <mo>)</mo>
      </mrow>
      <mo>,</mo>
      <mi>k</mi>
      <mo>)</mo>
    </mrow>
  </mrow>
</math>
</div>
<div class="paragraph data-line-546">
<p>o√π:</p>
</div>
<div class="ulist data-line-548">
<ul>
<li class="data-line-548">
<p><em>k</em> est la cl√© priv√©e de signature.</p>
</li>
<li class="data-line-549">
<p><em>m</em> est la transaction cod√©e RLP.</p>
</li>
<li class="data-line-550">
<p><em>F</em><sub><em>keccak256</em></sub> est la fonction de hachage Keccak-256.</p>
</li>
<li class="data-line-551">
<p><em>F</em><sub><em>sig</em></sub> est l&#39;algorithme de signature.</p>
</li>
<li class="data-line-552">
<p><em>Sig</em> est la signature r√©sultante.</p>
</li>
</ul>
</div>
<div id="sign_function" class="paragraph data-line-555">
<p>La fonction <em>F</em><sub><em>sig</em></sub> produit une signature <em>Sig</em> compos√©e de deux valeurs, commun√©ment appel√©es <em>r</em> et <em>s</em>¬†:</p>
</div>
<div data-type="equation">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mrow>
      <mi>S</mi>
      <mi>i</mi>
      <mi>g</mi>
    </mrow>
    <mo>=</mo>
    <mo>(</mo>
    <mi>r</mi>
    <mo>,</mo>
    <mi>s</mi>
    <mo>)</mo>
  </mrow>
</math>
</div>
</div>
</div>
<div class="sect3 data-line-578">
<h4 id="verify_sign">V√©rification de la signature</h4>
<div class="paragraph data-line-580">
<p>Pour v√©rifier la signature, il faut avoir la signature (<em>r</em> et <em>s</em>), la transaction s√©rialis√©e et la cl√© publique qui correspond √† la cl√© priv√©e utilis√©e pour cr√©er la signature. Essentiellement, la v√©rification d&#39;une signature signifie que &quot;seul le propri√©taire de la cl√© priv√©e qui a g√©n√©r√© cette cl√© publique pourrait avoir produit cette signature sur cette transaction&quot;.</p>
</div>
<div class="paragraph data-line-582">
<p>L&#39;algorithme de v√©rification de signature prend le message (c&#39;est-√†-dire, un hachage de la transaction pour notre usage), la cl√© publique du signataire et la signature (valeurs <em>r</em> et <em>s</em>), et renvoie true si la signature est valide pour ce message et la cl√© publique .</p>
</div>
</div>
<div class="sect3 data-line-585">
<h4 id="ecdsa_math">Math√©matiques ECDSA</h4>
<div class="paragraph data-line-587">
<p>Comme mentionn√© pr√©c√©demment, les signatures sont cr√©√©es par une fonction math√©matique <em>F</em><sub><em>sig</em></sub> qui produit une signature compos√©e de deux valeurs, <em>r</em> et <em>s</em>. Dans cette section, nous examinons la fonction <em>F</em><sub><em>sig</em></sub> plus en d√©tail.</p>
</div>
<div class="paragraph data-line-589">
<p>L&#39;algorithme de signature g√©n√®re d&#39;abord une cl√© priv√©e <em>√©ph√©m√®re</em> (temporaire) de mani√®re cryptographiquement s√©curis√©e. Cette cl√© temporaire est utilis√©e dans le calcul des valeurs <em>r</em> et <em>s</em> pour s&#39;assurer que la cl√© priv√©e r√©elle de l&#39;exp√©diteur ne peut pas √™tre calcul√©e par des attaquants qui surveillent les transactions sign√©es sur le r√©seau Ethereum.</p>
</div>
<div class="paragraph data-line-591">
<p>Comme nous le savons depuis <a href="#pubkey">Cl√©s publiques</a>, la cl√© priv√©e √©ph√©m√®re est utilis√©e pour d√©river la cl√© publique (√©ph√©m√®re) correspondante, nous avons donc¬†:</p>
</div>
<div class="ulist data-line-593">
<ul>
<li class="data-line-593">
<p>Un nombre al√©atoire cryptographiquement s√©curis√© <em>q</em>, qui est utilis√© comme cl√© priv√©e √©ph√©m√®re</p>
</li>
<li class="data-line-594">
<p>La cl√© publique √©ph√©m√®re correspondante <em>Q</em>, g√©n√©r√©e √† partir de <em>q</em> et du point g√©n√©rateur de courbe elliptique <em>G</em></p>
</li>
</ul>
</div>
<div class="paragraph data-line-596">
<p>La valeur <em>r</em> de la signature num√©rique est alors la coordonn√©e <em>x</em> de la cl√© publique √©ph√©m√®re <em>Q</em>.</p>
</div>
<div class="paragraph data-line-598">
<p>A partir de l√†, l&#39;algorithme calcule la valeur <em>s</em> de la signature, telle que¬†:</p>
</div>
<ul class="simplelist">
<li><em>s</em> &#8801; <em>q</em><sup>-1</sup> (<em>Keccak256</em>(<em>m</em>) + <em>r</em> * <em>k</em>)  &nbsp;  &nbsp; (<em>mod p</em>)</li>
</ul>
<div class="paragraph data-line-606">
<p>o√π:</p>
</div>
<div class="ulist data-line-608">
<ul>
<li class="data-line-608">
<p><em>q</em> est la cl√© priv√©e √©ph√©m√®re.</p>
</li>
<li class="data-line-609">
<p><em>r</em> est la coordonn√©e <em>x</em> de la cl√© publique √©ph√©m√®re.</p>
</li>
<li class="data-line-610">
<p><em>k</em> est la cl√© priv√©e de signature (propri√©taire EOA).</p>
</li>
<li class="data-line-611">
<p><em>m</em> est les donn√©es de transaction.</p>
</li>
<li class="data-line-612">
<p><em>p</em> est l&#39;ordre premier de la courbe elliptique.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-614">
<p>La v√©rification est l&#39;inverse de la fonction de g√©n√©ration de signature, utilisant les valeurs <em>r</em> et <em>s</em> et la cl√© publique de l&#39;exp√©diteur pour calculer une valeur <em>Q</em>, qui est un point sur la courbe elliptique (la cl√© publique √©ph√©m√®re utilis√©e dans la cr√©ation de la signature). Les √©tapes sont les suivantes:</p>
</div>
<div class="olist arabic data-line-616">
<ol class="arabic">
<li class="data-line-616">
<p>V√©rifiez que toutes les entr√©es sont correctement form√©es</p>
</li>
<li class="data-line-617">
<p>Calculez <em>w</em> = <em>s</em><sup>-1</sup> <em>mod p</em></p>
</li>
<li class="data-line-618">
<p>Calculez <em>u<sub>1</sub></em> = <em>Keccak256</em>(<em>m</em>) * <em>w</em> <em>mod p</em></p>
</li>
<li class="data-line-619">
<p>Calculez <em>u<sub>2</sub></em> = <em>r</em> * <em>w</em> <em>mod p</em></p>
</li>
<li class="data-line-620">
<p>Enfin, calculez le point sur la courbe elliptique <em>Q</em> ‚â° <em>u<sub>1</sub></em> * <em>G</em> + <em>u<sub>2</sub></em> * <em>K</em> &#160; &#160; (<em>mod p</em>)</p>
</li>
</ol>
</div>
<div class="paragraph data-line-622">
<p>o√π:</p>
</div>
<div class="ulist data-line-624">
<ul>
<li class="data-line-624">
<p><em>r</em> et <em>s</em> sont les valeurs de signature.</p>
</li>
<li class="data-line-625">
<p><em>K</em> est la cl√© publique du signataire (propri√©taire de l&#39;EOA).</p>
</li>
<li class="data-line-626">
<p><em>m</em> est les donn√©es de transaction qui ont √©t√© sign√©es.</p>
</li>
<li class="data-line-627">
<p><em>G</em> est le point g√©n√©rateur de la courbe elliptique.</p>
</li>
<li class="data-line-628">
<p><em>p</em> est l&#39;ordre premier de la courbe elliptique.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-630">
<p>Si la coordonn√©e <em>x</em> du point calcul√© <em>Q</em> est √©gale √† <em>r</em>, alors le v√©rificateur peut conclure que la signature est valide.</p>
</div>
<div class="paragraph data-line-632">
<p>Notez qu&#39;en v√©rifiant la signature, la cl√© priv√©e n&#39;est ni connue ni r√©v√©l√©e.</p>
</div>
<div class="admonitionblock tip data-line-635">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-636">
<p>ECDSA est n√©cessairement un calcul assez compliqu√©; une explication compl√®te est au-del√† de la port√©e de ce livre. Un certain nombre d&#39;excellents guides en ligne vous guident √©tape par √©tape¬†: recherchez &quot;ECDSA expliqu√©&quot; ou essayez celui-ci¬†: <a href="http://bit.ly/2r0HhGB" class="undefined" data-href="http://bit.ly/2r0HhGB">http://bit.ly/2r0HhGB</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-640">
<h4 id="tx_sign">Signature de transaction en pratique</h4>
<div class="paragraph data-line-642">
<p>Pour produire une transaction valide, l&#39;exp√©diteur doit signer num√©riquement le message, en utilisant l&#39;algorithme de signature num√©rique √† courbe elliptique. Lorsque nous disons &quot;signer la transaction&quot;, nous entendons en fait &quot;signer le hachage Keccak-256 des donn√©es de transaction s√©rialis√©es RLP&quot;. La signature est appliqu√©e au hachage des donn√©es de transaction, pas √† la transaction elle-m√™me.</p>
</div>
<div class="paragraph data-line-644">
<p>Pour signer une transaction dans Ethereum, l&#39;initiateur doit :</p>
</div>
<div class="olist arabic data-line-646">
<ol class="arabic">
<li class="data-line-646">
<p>Cr√©ez une structure de donn√©es de transaction contenant neuf champs¬†: nonce, gasPrice, gasLimit, to, value, data, chainID, 0, 0.</p>
</li>
<li class="data-line-647">
<p>Produire un message s√©rialis√© cod√© RLP de la structure de donn√©es de transaction.</p>
</li>
<li class="data-line-648">
<p>Calculez le hachage Keccak-256 de ce message s√©rialis√©.</p>
</li>
<li class="data-line-649">
<p>Calculez la signature ECDSA, en signant le hachage avec la cl√© priv√©e de l&#39;EOA d&#39;origine.</p>
</li>
<li class="data-line-650">
<p>Ajoutez les valeurs v, r et s calcul√©es de la signature ECDSA √† la transaction.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-652">
<p>La variable de signature sp√©ciale v indique deux choses¬†: l&#39;ID (identifiant) de cha√Æne et l&#39;identifiant de r√©cup√©ration pour aider la fonction ECDSArecover √† v√©rifier la signature. Il est calcul√© comme l&#39;un des 27 ou 28, ou comme l&#39;ID de cha√Æne doubl√© plus 35 ou 36. Pour plus d&#39;informations sur l&#39;ID de cha√Æne, voir <a href="#raw_tx_eip155">Cr√©ation de transactions brutes avec EIP-155</a>. L&#39;identifiant de r√©cup√©ration (27 ou 28 dans les signatures &quot;√† l&#39;ancienne&quot;, ou 35 ou 36 dans les transactions compl√®tes de type Spurious Dragon) est utilis√© pour indiquer la parit√© du composant y de la cl√© publique (voir <a href="#sign_prefix">La valeur du pr√©fixe de signature (v) et la r√©cup√©ration de la cl√© publique</a> pour plus de d√©tails).</p>
</div>
<div class="admonitionblock note data-line-656">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-657">
<p> Au bloc #2 675 000, Ethereum a impl√©ment√© l&#8217;embranchement divergent &quot;Spurious Dragon&quot;, qui, entre autres changements, a introduit un nouveau sch√©ma de signature qui inclut la protection contre la relecture des transactions (emp√™chant les transactions destin√©es √† un r√©seau d&#39;√™tre rejou√©es sur autres). Ce nouveau sch√©ma de signature est sp√©cifi√© dans EIP-155. Ce changement affecte la forme de la transaction et sa signature, il faut donc pr√™ter attention √† la premi√®re des trois variables de signature (c&#39;est-√†-dire v), qui prend l&#39;une des deux formes et indique les champs de donn√©es inclus dans le message de transaction hach√© .</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-662">
<h4 id="raw_tx">Cr√©ation et signature de transactions brutes</h4>
<div class="paragraph data-line-664">
<p>Dans cette section, nous allons cr√©er une transaction brute et la signer, en utilisant la biblioth√®que ethereumjs-tx, qui peut √™tre install√© avec npm. Cela d√©montre les fonctions qui seraient normalement utilis√©es dans un portefeuille ou une application qui signe des transactions au nom d&#39;un utilisateur. Le code source de cet exemple se trouve dans le fichier <em>raw_tx_demo.js</em> dans le <a href="http://bit.ly/2yI2GL3" data-href="http://bit.ly/2yI2GL3">r√©f√©rentiel GitHub</a> du livre¬†:</p>
</div>
<div id="raw_tx_demo_source" class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Load requirements first:
//
// npm init
// npm install ethereumjs-tx
//
// Run with: $ node raw_tx_demo.js
const ethTx = require('ethereumjs-tx').Transaction;

const txData = {
  nonce: '0x0',
  gasPrice: '0x09184e72a000',
  gasLimit: '0x30000',
  to: '0xb0920c523d582040f2bcb1bd7fb1c7c1ecebdb34',
  value: '0x00',
  data: '',
  v: "0x1c", // Ethereum mainnet chainID
  r: 0,
  s: 0 
};

tx = new ethTx(txData);
console.log('RLP-Encoded Tx: 0x' + tx.serialize().toString('hex'))

txHash = tx.hash(); // This step encodes into RLP and calculates the hash
console.log('Tx Hash: 0x' + txHash.toString('hex'))

// Sign transaction
const privKey = Buffer.from(
    '91c8360c4cb4b5fac45513a7213f31d4e4a7bfcb4630e9fbf074f42a203ac0b9', 'hex');
tx.sign(privKey);

serializedTx = tx.serialize();
rawTx = 'Signed Raw Transaction: 0x' + serializedTx.toString('hex');
console.log(rawTx)</code></pre>
</div>
</div>
<div id="raw_tx_demo_run" class="paragraph data-line-673">
<p>L&#39;ex√©cution de l&#39;exemple de code produit les r√©sultats suivants¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>node raw_tx_demo.js</strong>
RLP-Encoded Tx: 0xe6808609184e72a0008303000094b0920c523d582040f2bcb1bd7fb1c7c1...
Tx Hash: 0xaa7f03f9f4e52fcf69f836a6d2bbc7706580adce0a068ff6525ba337218e6992
Signed Raw Transaction: 0xf866808609184e72a0008303000094b0920c523d582040f2bcb1...

</pre>
</div>
<div class="sect3 data-line-686">
<h4 id="raw_tx_eip155">Cr√©ation de transactions brutes avec EIP-155</h4>
<div class="paragraph data-line-688">
<p>La norme EIP-155 &quot;Simple Replay Attack Protection&quot; sp√©cifie un codage de transaction prot√©g√© contre les attaques de relecture, qui inclut un <em>identifiant de cha√Æne</em> dans les donn√©es de transaction, avant la signature. Cela garantit que les transactions cr√©√©es pour une cha√Æne de blocs (par exemple, le r√©seau principal Ethereum) sont invalides sur une autre cha√Æne de blocs (par exemple, Ethereum Classic ou le r√©seau de test Ropsten). Par cons√©quent, les transactions diffus√©es sur un r√©seau ne peuvent pas √™tre <em>rejou√©es</em> sur un autre, d&#39;o√π le nom de la norme.</p>
</div>
<div class="paragraph data-line-690">
<p>EIP-155 ajoute trois champs aux six principaux champs de la structure de donn√©es de transaction, √† savoir l&#39;identifiant de cha√Æne, 0 et 0. Ces trois champs sont ajout√©s aux donn√©es de transaction <em>avant qu&#39;elles ne soient encod√©es et hach√©es</em>. Ils modifient donc le hash de la transaction, auquel la signature est ensuite appliqu√©e. En incluant l&#39;identifiant de la cha√Æne dans les donn√©es √† signer, la signature de la transaction emp√™che tout changement, car la signature est invalid√©e si l&#39;identifiant de la cha√Æne est modifi√©. Par cons√©quent, EIP-155 rend impossible la relecture d&#39;une transaction sur une autre cha√Æne, car la validit√© de la signature d√©pend de l&#39;identifiant de la cha√Æne.</p>
</div>
<div class="paragraph data-line-693">
<p>Le champ d&#39;identifiant de cha√Æne prend une valeur en fonction du r√©seau auquel la transaction est destin√©e, comme indiqu√© dans <a href="#chain_id_table">Identifiants de cha√Æne</a>.</p>
</div>
<table id="chain_id_table" class="tableblock frame-all grid-all stretch data-line-698">
<caption class="title">Table 7. Identifiants de cha√Æne</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cha√Æne</th>
<th class="tableblock halign-left valign-top">ID de cha√Æne</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mainnet Ethereum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Morden (obsol√®te), √âtendue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ropsten</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rinkeby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mainnet Rootstock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testnet Rootstock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kovan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">42</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mainnet Ethereum Classic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">61</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testnet Ethereum Classic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">62</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testets priv√©s Geth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1337</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-712">
<p>La structure de transaction r√©sultante est cod√©e RLP, hach√©e et sign√©e. L&#39;algorithme de signature est l√©g√®rement modifi√© pour encoder √©galement l&#39;identifiant de la cha√Æne dans le pr√©fixe v.</p>
</div>
<div class="paragraph data-line-714">
<p>Pour plus de d√©tails, voir <a href="http://bit.ly/2CQUgne" data-href="http://bit.ly/2CQUgne">la sp√©cification EIP-155</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-717">
<h3 id="sign_prefix">La valeur du pr√©fixe de signature (v) et la r√©cup√©ration de la cl√© publique</h3>
<div class="paragraph data-line-719">
<p>Comme mentionn√© dans <a href="#tx_struct">La structure d&#39;une transaction</a>, le message de transaction n&#39;inclut pas de champ &quot;from&quot;. En effet, la cl√© publique de l&#39;exp√©diteur peut √™tre calcul√©e directement √† partir de la signature ECDSA. Une fois que vous avez la cl√© publique, vous pouvez facilement calculer l&#39;adresse. Le processus de r√©cup√©ration de la cl√© publique du signataire est appel√© <em>r√©cup√©ration de la cl√© publique</em>.</p>
</div>
<div class="paragraph data-line-721">
<p>√âtant donn√© les valeurs r et s qui ont √©t√© calcul√©es dans <a href="#ecdsa_math">Math√©matiques ECDSA</a>, nous pouvons calculer deux cl√©s publiques possibles.</p>
</div>
<div class="paragraph data-line-723">
<p>Tout d&#39;abord, nous calculons deux points de courbe elliptique, <em>R</em> et <em>R</em><sup><em>&#39;</em></sup>, √† partir de la coordonn√©e <em>x</em> r valeur qui se trouve dans la signature. Il y a deux points parce que la courbe elliptique est sym√©trique sur l&#39;axe des x, de sorte que pour toute valeur x il y a deux valeurs possibles qui correspondent √† la courbe, une de chaque c√¥t√© de l&#39;axe des x.</p>
</div>
<div class="paragraph data-line-725">
<p>√Ä partir de r, nous calculons √©galement <em>r</em><sup>-1</sup>, qui est l&#39;inverse multiplicatif de r.</p>
</div>
<div class="paragraph data-line-727">
<p>Enfin, nous calculons <em>z</em>, qui correspond aux <em>n</em> bits les plus bas du hachage du message, o√π <em>n</em> est l&#39;ordre de la courbe elliptique.</p>
</div>
<div class="paragraph data-line-729">
<p>Les deux cl√©s publiques possibles sont alors :</p>
</div>
<ul class="simplelist">
<li><em>K</em><sub>1</sub> = <em>r</em><sup>&#x2013;1</sup> (<em>sR</em> &#x2013; <em>zG</em>)</li>
</ul>
<div class="paragraph data-line-737">
<p>et:</p>
</div>
<ul class="simplelist">
<li><em>K</em><sub>2</sub> = <em>r</em><sup>&#x2013;1</sup> (<em>sR</em><sup>'</sup> &#x2013; <em>zG</em>)</li>
</ul>
<div class="paragraph data-line-745">
<p>o√π:</p>
</div>
<div class="ulist data-line-747">
<ul>
<li class="data-line-747">
<p><em>K</em><sub>1</sub> et <em>K</em><sub>2</sub> sont les deux possibilit√©s pour la cl√© publique du signataire.</p>
</li>
<li class="data-line-748">
<p><em>r</em><sup>-1</sup> est l&#39;inverse multiplicatif de la valeur r de la signature.</p>
</li>
<li class="data-line-749">
<p><em>s</em> est la valeur s de la signature.</p>
</li>
<li class="data-line-750">
<p><em>R</em> et <em>R</em><sup>&#39;</sup> sont les deux possibilit√©s pour la cl√© publique √©ph√©m√®re <em>Q</em>.</p>
</li>
<li class="data-line-751">
<p><em>z</em> correspond aux <em>n</em> bits les plus bas du hachage du message.</p>
</li>
<li class="data-line-752">
<p><em>G</em> est le point g√©n√©rateur de la courbe elliptique.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-754">
<p>Pour rendre les choses plus efficaces, la signature de la transaction inclut une valeur de pr√©fixe v, qui nous indique laquelle des deux valeurs <em>R</em> possibles est la cl√© publique √©ph√©m√®re. Si v est pair, alors <em>R</em> est la valeur correcte. Si v est impair, alors c&#39;est <em>R</em><sup>&#39;</sup>. De cette fa√ßon, nous devons calculer une seule valeur pour <em>R</em> et une seule valeur pour <em>K</em>.</p>
</div>
</div>
<div class="sect2 data-line-757">
<h3 id="offline_sign">S√©parer la signature et la transmission (signature hors ligne)</h3>
<div class="paragraph data-line-759">
<p>Une fois qu&#39;une transaction est sign√©e, elle est pr√™te √† √™tre transmise au r√©seau Ethereum . Les trois √©tapes de cr√©ation, de signature et de diffusion d&#39;une transaction se d√©roulent normalement en une seule op√©ration, par exemple en utilisant web3.eth.sendTransaction. Cependant, comme vous l&#39;avez vu dans <a href="#raw_tx">Cr√©ation et signature de transactions brutes</a>, vous pouvez cr√©er et signer la transaction en deux √©tapes distinctes. Une fois que vous avez une transaction sign√©e, vous pouvez ensuite la transmettre √† l&#39;aide de web3.eth.sendSignedTransaction, qui prend une transaction cod√©e en hexad√©cimal et sign√©e et la transmet sur le r√©seau Ethereum.</p>
</div>
<div class="paragraph data-line-761">
<p>Pourquoi voudriez-vous s√©parer la signature et la transmission des transactions¬†? La raison la plus courante est la s√©curit√©. L&#39;ordinateur qui signe une transaction doit avoir des cl√©s priv√©es d√©verrouill√©es charg√©es en m√©moire. L&#39;ordinateur qui effectue la transmission doit √™tre connect√© √† Internet (et ex√©cuter un client Ethereum). Si ces deux fonctions sont sur un seul ordinateur, alors vous avez des cl√©s priv√©es sur un syst√®me en ligne, ce qui est assez dangereux. S√©parer les fonctions de signature et de transmission et les ex√©cuter sur diff√©rentes machines (sur un appareil hors ligne et en ligne, respectivement) est appel√© <em>signature hors ligne</em> et est une pratique de s√©curit√© courante.</p>
</div>
<div class="paragraph data-line-763">
<p><a href="#offline_signing">Signature hors ligne des transactions Ethereum</a> montre le processus¬†:</p>
</div>
<div class="olist arabic data-line-765">
<ol class="arabic">
<li class="data-line-765">
<p>Cr√©ez une transaction non sign√©e sur l&#39;ordinateur en ligne o√π l&#39;√©tat actuel du compte, notamment le nonce actuel et les fonds disponibles, peut √™tre r√©cup√©r√©.</p>
</li>
<li class="data-line-766">
<p>Transf√©rez la transaction non sign√©e vers un appareil hors ligne ¬´ isol√© ¬ª pour la signature de la transaction, par exemple via un code QR ou une cl√© USB.</p>
</li>
<li class="data-line-767">
<p>Transmettez (retour) la transaction sign√©e √† un appareil en ligne pour diffusion sur la cha√Æne de blocs Ethereum, par exemple via un code QR ou une cl√© USB.</p>
</li>
</ol>
</div>
<div id="offline_signing" class="imageblock data-line-771">
<div class="content">
<img src="images/offline_signing.png" alt="&quot;Signature hors ligne des transactions Ethereum&quot;">
</div>
<div class="title">Figure 37. Signature hors ligne des transactions Ethereum</div>
</div>
<div class="paragraph data-line-773">
<p>Selon le niveau de s√©curit√© dont vous avez besoin, votre ordinateur de &quot;signature hors ligne&quot; peut avoir diff√©rents degr√©s de s√©paration de l&#39;ordinateur en ligne, allant d&#39;un sous-r√©seau isol√© et prot√©g√© par un pare-feu (en ligne mais s√©par√©) √† un syst√®me compl√®tement hors ligne connu sous le nom de syst√®me <em>air-gapped</em> ou <em>√† espacement d&#8217;air</em> . Dans un syst√®me √† espacement d&#39;air, il n&#39;y a aucune connectivit√© r√©seau - l&#39;ordinateur est s√©par√© de l&#39;environnement en ligne par un espace &quot;d&#39;air&quot;. Pour signer des transactions, vous les transf√©rez vers et depuis l&#39;ordinateur isol√© √† l&#39;aide d&#39;un support de stockage de donn√©es ou (mieux) d&#39;une webcam et d&#39;un code QR. Bien s√ªr, cela signifie que vous devez transf√©rer manuellement chaque transaction que vous souhaitez signer, et cela n&#39;√©volue pas.</p>
</div>
<div class="paragraph data-line-775">
<p>Bien que peu d&#39;environnements puissent utiliser un syst√®me enti√®rement isol√©, m√™me un faible degr√© d&#39;isolement pr√©sente des avantages significatifs en mati√®re de s√©curit√©. Par exemple, un sous-r√©seau isol√© avec un pare-feu qui n&#39;autorise qu&#39;un protocole de file d&#39;attente de messages peut offrir une surface d&#39;attaque tr√®s r√©duite et une s√©curit√© bien plus √©lev√©e que la signature sur le syst√®me en ligne. De nombreuses entreprises utilisent un protocole tel que ZeroMQ (0MQ) √† cette fin. Avec une telle configuration, les transactions sont s√©rialis√©es et mises en file d&#39;attente pour signature. Le protocole de mise en file d&#39;attente transmet le message s√©rialis√©, d&#39;une mani√®re similaire √† un socket TCP, √† l&#39;ordinateur signataire. L&#39;ordinateur signataire lit les transactions s√©rialis√©es √† partir de la file d&#39;attente (avec pr√©caution), applique une signature avec la cl√© appropri√©e et les place dans une file d&#39;attente sortante. La file d&#39;attente sortante transmet les transactions sign√©es √† un ordinateur avec un client Ethereum qui les retire de la file d&#39;attente et les transmet.</p>
</div>
</div>
<div class="sect2 data-line-778">
<h3 id="tx_propagation">Propagation des transactions</h3>
<div class="paragraph data-line-780">
<p>Le r√©seau Ethereum utilise un protocole de &quot;routage par inondation&quot;. Chaque client Ethereum agit comme un <em>n≈ìud</em> dans un r√©seau <em>pair √† pair (P2P)</em>, qui (id√©alement) forme un r√©seau de <em>toile</em>. Aucun n≈ìud de r√©seau n&#39;est sp√©cial : ils agissent tous comme des pairs √©gaux. Nous utiliserons le terme &quot;n≈ìud&quot; pour d√©signer un client Ethereum qui est connect√© et participe au r√©seau P2P.</p>
</div>
<div class="paragraph data-line-782">
<p>La propagation de la transaction commence par la cr√©ation (ou la r√©ception hors ligne) par le n≈ìud Ethereum d&#39;origine d&#39;une transaction sign√©e. La transaction est valid√©e puis transmise √† tous les autres n≈ìuds Ethereum qui sont <em>directement</em> connect√©s au n≈ìud d&#39;origine. En moyenne, chaque n≈ìud Ethereum maintient des connexions avec au moins 13 autres n≈ìuds, appel√©s ses <em>voisins</em>. Chaque n≈ìud voisin valide la transaction d√®s qu&#39;il la re√ßoit. S&#39;ils conviennent qu&#39;il est valide, ils en stockent une copie et le propagent √† tous leurs voisins (sauf celui dont il provient). En cons√©quence, la transaction se r√©percute vers l&#39;ext√©rieur √† partir du n≈ìud d&#39;origine, <em>inondant</em> √† travers le r√©seau, jusqu&#39;√† ce que tous les n≈ìuds du r√©seau aient une copie de la transaction. Les n≈ìuds peuvent filtrer les messages qu&#39;ils propagent, mais la valeur par d√©faut consiste √† propager tous les messages de transaction valides qu&#39;ils re√ßoivent.</p>
</div>
<div class="paragraph data-line-784">
<p>En quelques secondes seulement, une transaction Ethereum se propage √† tous les n≈ìuds Ethereum du monde entier. Du point de vue de chaque n≈ìud, il n&#39;est pas possible de discerner l&#39;origine de la transaction. Le voisin qui l&#39;a envoy√© au n≈ìud peut √™tre l&#39;initiateur de la transaction ou peut l&#39;avoir re√ßue de l&#39;un de ses voisins. Pour pouvoir suivre l&#39;origine des transactions ou interf√©rer avec la propagation, un attaquant devrait contr√¥ler un pourcentage significatif de tous les n≈ìuds. Cela fait partie de la conception de la s√©curit√© et de la confidentialit√© des r√©seaux P2P, en particulier lorsqu&#39;elle est appliqu√©e aux r√©seaux blockchain.</p>
</div>
</div>
<div class="sect2 data-line-787">
<h3 id="chain_record">Enregistrement sur la cha√Æne de blocs</h3>
<div class="paragraph data-line-789">
<p>Bien que tous les n≈ìuds d&#39;Ethereum soient des pairs √©gaux, certains d&#39;entre eux sont exploit√©s par des <em>mineurs</em> et alimentent des transactions et des blocs vers des <em>fermes mini√®res</em>, qui sont des ordinateurs dot√©s d&#39;unit√©s de traitement graphique (GPU) hautes performances. Les ordinateurs de minage ajoutent des transactions √† un bloc candidat et tentent de trouver une <em>preuve de travail</em> qui rend le bloc candidat valide. Nous en discuterons plus en d√©tail dans <a href="#consensus">Consensus</a>.</p>
</div>
<div class="paragraph data-line-791">
<p>Sans entrer dans trop de d√©tails, les transactions valides seront √©ventuellement incluses dans un bloc de transactions et, ainsi, enregistr√©es dans la cha√Æne de blocs Ethereum. Une fois min√©es dans un bloc, les transactions modifient √©galement l&#39;√©tat du singleton Ethereum, soit en modifiant le solde d&#39;un compte (dans le cas d&#39;un simple paiement) soit en invoquant des contrats qui changent leur √©tat interne. Ces modifications sont enregistr√©es parall√®lement √† la transaction, sous la forme d&#39;un <em>re√ßu</em> de transaction, qui peut √©galement inclure des <em>√©v√©nements</em>. Nous examinerons tout cela beaucoup plus en d√©tail dans <a href="#evm_chapter">La machine virtuelle Ethereum</a>.</p>
</div>
<div class="paragraph data-line-793">
<p>Une transaction qui a termin√© son parcours depuis la cr√©ation jusqu&#39;√† la signature par un EOA, la propagation et enfin l&#39;exploitation mini√®re a chang√© l&#39;√©tat du singleton et laiss√© une marque ind√©l√©bile sur la cha√Æne de blocs.</p>
</div>
</div>
<div class="sect2 data-line-795">
<h3 id="_transactions_√†_signatures_multiples_multisig">Transactions √† signatures multiples (Multisig)</h3>
<div class="paragraph data-line-797">
<p>Si vous connaissez les capacit√©s de script de Bitcoin, vous savez qu&#39;il est possible de cr√©er un compte multisig Bitcoin qui ne peut d√©penser des fonds que lorsque plusieurs parties signent la transaction (par exemple, 2 sur 2 ou 3 sur 4 signatures). Les transactions de valeur EOA de base d&#39;Ethereum ne comportent aucune disposition pour les signatures multiples¬†; cependant, des restrictions de signature arbitraires peuvent √™tre appliqu√©es par des contrats intelligents avec toutes les conditions auxquelles vous pouvez penser, pour g√©rer le transfert d&#39;ether et de jetons.</p>
</div>
<div class="paragraph data-line-799">
<p>Pour tirer parti de cette capacit√©, l&#39;ether doit √™tre transf√©r√© dans un &quot;contrat de portefeuille&quot; programm√© avec les r√®gles de d√©penses souhait√©es, telles que les exigences de multisignature ou les limites de d√©penses (ou des combinaisons des deux). Le contrat de portefeuille envoie ensuite les fonds lorsqu&#39;il y est invit√© par un EOA autoris√© une fois que les conditions de d√©penses ont √©t√© remplies. Par exemple, pour prot√©ger votre ether sous une condition multisig, transf√©rez l&#39;ether vers un contrat multisig. Chaque fois que vous souhaitez envoyer des fonds vers un autre compte, tous les utilisateurs requis devront envoyer des transactions au contrat √† l&#39;aide d&#39;une application de portefeuille standard, autorisant effectivement le contrat √† effectuer en finale la <span class="keep-together">transaction</span>.</p>
</div>
<div class="paragraph data-line-801">
<p>Ces contrats peuvent √©galement √™tre con√ßus pour exiger plusieurs signatures avant d&#39;ex√©cuter du code local ou pour d√©clencher d&#39;autres contrats. La s√©curit√© du syst√®me est finalement d√©termin√©e par le code de contrat multisig.</p>
</div>
<div class="paragraph data-line-803">
<p>La possibilit√© de mettre en ≈ìuvre des transactions multisignatures en tant que contrat intelligent d√©montre la flexibilit√© d&#39;Ethereum. Cependant, c&#39;est une √©p√©e √† double tranchant, car la flexibilit√© suppl√©mentaire peut entra√Æner des bogues qui compromettent la s√©curit√© des sch√©mas multisignatures. Il existe, en fait, un certain nombre de propositions pour cr√©er une commande multisignature dans l&#39;EVM qui supprime le besoin de contrats intelligents, du moins pour les simples sch√©mas multisignatures M-de-N. Cela √©quivaudrait au syst√®me multisignature de Bitcoin, qui fait partie des r√®gles de consensus de base et s&#39;est av√©r√© robuste et s√©curis√©.</p>
</div>
</div>
<div class="sect2 data-line-805">
<h3 id="_conclusion_3">Conclusion</h3>
<div class="paragraph data-line-15">
<p>Les transactions sont le point de d√©part de chaque activit√© dans le syst√®me Ethereum. Les transactions sont les &quot;entr√©es&quot; qui am√®nent la machine virtuelle Ethereum √† √©valuer les contrats, √† mettre √† jour les soldes et, plus g√©n√©ralement, √† modifier l&#39;√©tat de la cha√Æne de blocs Ethereum. Ensuite, nous travaillerons avec des contrats intelligents de mani√®re beaucoup plus d√©taill√©e et apprendrons √† programmer dans le langage orient√© contrat de Solidity.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="smart_contracts_chapter">Contrats intelligents et Solidity</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Comme nous en avons discut√© dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, il existe deux types de comptes diff√©rents dans Ethereum : les comptes externes (EOA) et comptes contractuels. Les EOA sont contr√¥l√©s par les utilisateurs, souvent via un logiciel tel qu&#39;une application de portefeuille externe √† la plate-forme Ethereum.  contrats ¬ª) qui est ex√©cut√© par la machine virtuelle Ethereum. En bref, les EOA sont de simples comptes sans code ni stockage de donn√©es associ√©s, tandis que les comptes contractuels ont √† la fois un code et un stockage de donn√©es associ√©s. Les EOA sont contr√¥l√©s par des transactions cr√©√©es et sign√©es cryptographiquement avec une cl√© priv√©e dans le &quot;monde r√©el&quot; externe et ind√©pendant du protocole, alors que les comptes contractuels n&#39;ont pas de cl√©s priv√©es et &quot;se contr√¥lent&quot; donc de la mani√®re pr√©d√©termin√©e prescrite par leur code de contrat intelligent. Les deux types de comptes sont identifi√©s par une adresse Ethereum. Dans ce chapitre, nous discuterons des comptes contractuels et du code de programme qui les contr√¥le.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="smart_contracts_definition">Qu&#39;est-ce qu&#39;un contrat intelligent¬†?</h3>
<div class="paragraph data-line-9">
<p>Le terme <em>contrat intelligent</em> a √©t√© utilis√© au fil des ans pour d√©crire une grande vari√©t√© de choses diff√©rentes. Dans les ann√©es 1990, le cryptographe Nick Szabo a invent√© le terme et l&#39;a d√©fini comme &quot;un ensemble de promesses, sp√©cifi√©es sous forme num√©rique, y compris des protocoles au sein que les parties ex√©cutent sur les autres promesses. Depuis lors, le concept de contrats intelligents a √©volu√©, notamment apr√®s l&#39;introduction de plateformes de cha√Æne de blocs d√©centralis√©es avec l&#39;invention de Bitcoin en 2009. Dans le contexte d&#39;Ethereum, le terme est en fait un peu impropre, √©tant donn√© que les contrats intelligents Ethereum ne sont ni des contrats intelligents ni l√©gaux, mais le terme est rest√©. Dans ce livre, nous utilisons le terme ¬´contrats intelligents¬ª pour d√©signer des programmes informatiques immuables qui s&#39;ex√©cutent de mani√®re d√©terministe dans le contexte d&#39;une machine virtuelle Ethereum dans le cadre du protocole r√©seau Ethereum, c&#39;est-√†-dire sur l&#39;ordinateur mondial Ethereum d√©centralis√©.</p>
</div>
<div class="paragraph data-line-11">
<p>D√©ballons cette d√©finition¬†:</p>
</div>
<div class="dlist data-line-13">
<dl>
<dt class="hdlist1">Logiciels d&#39;ordinateur</dt>
<dd>
<p>Les contrats intelligents sont simplement des programmes informatiques. Le mot ¬´¬†contrat¬†¬ª n&#39;a aucune signification juridique dans ce contexte.</p>
</dd>
<dt class="hdlist1">Immuable</dt>
<dd>
<p>Une fois d√©ploy√©, le code d&#39;un contrat intelligent ne peut pas changer. Contrairement aux logiciels traditionnels, la seule fa√ßon de modifier un contrat intelligent est de d√©ployer une nouvelle instance.</p>
</dd>
<dt class="hdlist1">D√©terministe</dt>
<dd>
<p>Le r√©sultat de l&#39;ex√©cution d&#39;un contrat intelligent est le m√™me pour tous ceux qui l&#39;ex√©cutent, compte tenu du contexte de la transaction qui a initi√© son ex√©cution et de l&#39;√©tat de la cha√Æne de blocs Ethereum au moment de l&#39;ex√©cution.</p>
</dd>
<dt class="hdlist1">Contexte EVM</dt>
<dd>
<p>Les contrats intelligents fonctionnent avec un contexte d&#39;ex√©cution tr√®s limit√©. Ils peuvent acc√©der √† leur propre √©tat, au contexte de la transaction qui les a appel√©s et √† certaines informations sur les blocs les plus r√©cents.</p>
</dd>
<dt class="hdlist1">Ordinateur mondial d√©centralis√©</dt>
<dd>
<p>L&#39;EVM fonctionne comme une instance locale sur chaque n≈ìud Ethereum, mais comme toutes les instances de l&#39;EVM fonctionnent sur le m√™me √©tat initial et produisent le m√™me √©tat final, le syst√®me dans son ensemble fonctionne comme un seul &quot;ordinateur mondial&quot;.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2 data-line-29">
<h3 id="smart_contract_lifecycle">Cycle de vie d&#39;un contrat intelligent</h3>
<div class="paragraph data-line-31">
<p>Les contrats intelligents sont g√©n√©ralement √©crits dans un langage de haut niveau, tel que Solidity. Mais pour fonctionner, ils doivent √™tre compil√©s dans le code interm√©diaire (bytecode) de bas niveau qui s&#39;ex√©cute dans l&#39;EVM. Une fois compil√©s, ils sont d√©ploy√©s sur la plateforme Ethereum √† l&#39;aide d&#39;une transaction sp√©ciale de <em>cr√©ation de contrat</em>, qui est identifi√©e comme telle en √©tant envoy√©e √† l&#39;adresse sp√©ciale de cr√©ation de contrat, √† savoir 0x0 (voir <a href="#contract_reg">Transaction sp√©ciale¬†: cr√©ation de contrat</a>). Chaque contrat est identifi√© par une adresse Ethereum, qui est d√©riv√©e de la transaction de cr√©ation de contrat en fonction du compte d&#39;origine et du nonce. L&#39;adresse Ethereum d&#39;un contrat peut √™tre utilis√©e dans une transaction en tant que destinataire, envoyer des fonds au contrat ou appeler l&#39;une des fonctions du contrat. Notez que, contrairement aux EOA, il n&#39;y a pas de cl√©s associ√©es √† un compte cr√©√© pour un nouveau contrat intelligent. En tant que cr√©ateur du contrat, vous n&#39;obtenez aucun privil√®ge sp√©cial au niveau du protocole (bien que vous puissiez les coder explicitement dans le contrat intelligent). Vous ne recevez certainement pas la cl√© priv√©e du compte de contrat, qui en fait n&#39;existe pas - nous pouvons dire que les comptes de contrat intelligents se poss√®dent eux-m√™mes.</p>
</div>
<div class="paragraph data-line-33">
<p>Il est important de noter que les contrats <em>ne s&#39;ex√©cutent que s&#39;ils sont appel√©s par une transaction</em>. Tous les contrats intelligents dans Ethereum sont ex√©cut√©s, en fin de compte, en raison d&#39;une transaction initi√©e √† partir d&#39;un EOA. Un contrat peut appeler un autre contrat qui peut appeler un autre contrat, et ainsi de suite, mais le premier contrat d&#39;une telle cha√Æne d&#39;ex√©cution aura toujours √©t√© appel√© par une transaction d&#39;un EOA. Les contrats ne fonctionnent jamais &quot;seuls&quot; ou &quot;en arri√®re-plan&quot;. Les contrats restent effectivement inactifs jusqu&#39;√† ce qu&#39;une transaction d√©clenche l&#39;ex√©cution, soit directement, soit indirectement dans le cadre d&#39;une cha√Æne d&#39;appels de contrats. Il convient √©galement de noter que les contrats intelligents ne sont en aucun cas ex√©cut√©s &quot;en parall√®le&quot; - l&#39;ordinateur mondial Ethereum peut √™tre consid√©r√© comme une machine √† un seul fil d&#8217;ex√©cution (thread).</p>
</div>
<div class="paragraph data-line-35">
<p>Les transactions sont <em>atomique</em>, quel que soit le nombre de contrats qu&#39;elles appellent ou ce que ces contrats font lorsqu&#39;ils sont appel√©s. Les transactions s&#39;ex√©cutent dans leur int√©gralit√©, avec tout changement dans l&#39;√©tat global (contrats, comptes, etc.) enregistr√© uniquement si toutes les ex√©cutions se terminent avec succ√®s. Une fin r√©ussie signifie que le programme s&#39;est ex√©cut√© sans erreur et a atteint la fin de l&#39;ex√©cution. Si l&#39;ex√©cution √©choue en raison d&#39;une erreur, tous ses effets (changements d&#39;√©tat) sont &quot;annul√©s&quot; comme si la transaction n&#39;avait jamais √©t√© ex√©cut√©e. Une transaction √©chou√©e est toujours enregistr√©e comme ayant √©t√© tent√©e, et l&#39;ether d√©pens√© en gaz pour l&#39;ex√©cution est d√©duit du compte d&#39;origine, mais cela n&#39;a par ailleurs aucun autre effet sur le contrat ou l&#39;√©tat du compte.</p>
</div>
<div class="paragraph data-line-37">
<p>Comme mentionn√© pr√©c√©demment, il est important de se rappeler que le code d&#39;un contrat ne peut pas √™tre modifi√©. Cependant, un contrat peut √™tre &quot;supprim√©&quot;, supprimant le code et son √©tat interne (stockage) de son adresse, laissant un compte vide. Toutes les transactions envoy√©es √† cette adresse de compte apr√®s la suppression du contrat n&#39;entra√Ænent aucune ex√©cution de code, car il n&#39;y a plus de code √† ex√©cuter. Pour supprimer un contrat, vous ex√©cutez un opcode EVM appel√© SELFDESTRUCT (pr√©c√©demment appel√© SUICIDE). Cette op√©ration co√ªte du &quot;gaz n√©gatif&quot;, un remboursement de gaz, incitant ainsi √† lib√©rer les ressources du client du r√©seau √† partir de la suppression de l&#39;√©tat stock√©. La suppression d&#39;un contrat de cette mani√®re ne supprime pas l&#39;historique des transactions (pass√©) du contrat, car la blockchain elle-m√™me est immuable. Il est √©galement important de noter que la capacit√© SELFDESTRUCT ne sera disponible que si l&#39;auteur du contrat a programm√© le contrat intelligent pour avoir cette fonctionnalit√©. Si le code du contrat n&#39;a pas d&#39;opcode SELFDESTRUCT, ou s&#39;il est inaccessible, le contrat intelligent ne peut pas √™tre supprim√©.</p>
</div>
</div>
<div class="sect2 data-line-40">
<h3 id="high_level_languages">Introduction aux langages de haut niveau Ethereum</h3>
<div class="paragraph data-line-42">
<p>L&#39;EVM est une machine virtuelle qui ex√©cute une forme sp√©ciale de code appel√© <em>code interm√©diaire EVM</em> ou <em>EVM bytecode</em>, analogue au processeur de votre ordinateur, qui ex√©cute un code machine tel que x86_64. Nous examinerons le fonctionnement et le langage de l&#39;EVM de mani√®re beaucoup plus d√©taill√©e dans <a href="#evm_chapter">La machine virtuelle Ethereum</a>. Dans cette section, nous verrons comment les contrats intelligents sont √©crits pour s&#39;ex√©cuter sur l&#39;EVM.</p>
</div>
<div class="paragraph data-line-44">
<p>Bien qu&#39;il soit possible de programmer des contrats intelligents directement en code interm√©diaire, le code interm√©diaire EVM est plut√¥t lourd et tr√®s difficile √† lire et √† comprendre pour les programmeurs. Au lieu de cela, la plupart des d√©veloppeurs Ethereum utilisent un langage de haut niveau pour √©crire des programmes et un compilateur pour les convertir en code interm√©diaire.</p>
</div>
<div class="paragraph data-line-46">
<p>Bien que n&#39;importe quel langage de haut niveau puisse √™tre adapt√© pour √©crire des contrats intelligents, adapter un langage arbitraire pour qu&#39;il soit compilable au code interm√©diaire EVM est un exercice assez fastidieux et conduirait en g√©n√©ral √† une certaine confusion. Les contrats intelligents fonctionnent dans un environnement d&#39;ex√©cution tr√®s contraint et minimaliste (l&#39;EVM). De plus, un ensemble sp√©cial de variables syst√®me et de fonctions sp√©cifiques √† EVM doit √™tre disponible. En tant que tel, il est plus facile de cr√©er un langage de contrat intelligent √† partir de z√©ro que de cr√©er un langage √† usage g√©n√©ral adapt√© √† l&#39;√©criture de contrats intelligents. En cons√©quence, un certain nombre de langages sp√©ciaux ont √©merg√© pour programmer des contrats intelligents. Ethereum poss√®de plusieurs langages de ce type, ainsi que les compilateurs n√©cessaires pour produire un code interm√©diaire ex√©cutable EVM.</p>
</div>
<div class="paragraph data-line-48">
<p>En g√©n√©ral, les langages de programmation peuvent √™tre class√©s en deux grands paradigmes de programmation¬†: <em>d√©claratif</em> et <em>imp√©ratif</em>, √©galement appel√©s respectivement <em>fonctionnel</em> et <em>proc√©dural</em>. En programmation d√©clarative, nous √©crivons des fonctions qui expriment la <em>logique</em> d&#39;un programme, mais pas son <em>flux</em>. La programmation d√©clarative est utilis√©e pour cr√©er des programmes sans <em>effets secondaires</em>, ce qui signifie qu&#39;il n&#39;y a pas de changement d&#39;√©tat en dehors d&#39;une fonction. Les langages de programmation d√©claratifs incluent Haskell et SQL. La programmation imp√©rative, en revanche, est l&#39;endroit o√π un programmeur √©crit un ensemble de proc√©dures qui combinent la logique et le d√©roulement d&#39;un programme. Les langages de programmation imp√©ratifs incluent C++ et Java. Certains langages sont ¬´ hybrides ¬ª, ce qui signifie qu&#39;ils encouragent la programmation d√©clarative mais peuvent √©galement √™tre utilis√©s pour exprimer un paradigme de programmation imp√©rative. Ces hybrides incluent Lisp, JavaScript et Python. En g√©n√©ral, n&#39;importe quel langage imp√©ratif peut √™tre utilis√© pour √©crire dans un paradigme d√©claratif, mais il en r√©sulte souvent un code in√©l√©gant. Par comparaison, les langages d√©claratifs purs ne peuvent pas √™tre utilis√©s pour √©crire dans un paradigme imp√©ratif. Dans les langages purement d√©claratifs, <em>il n&#39;y a pas de &quot;variables&quot;.</em></p>
</div>
<div class="paragraph data-line-50">
<p>Bien que la programmation imp√©rative soit plus couramment utilis√©e par les programmeurs, il peut √™tre tr√®s difficile d&#39;√©crire des programmes qui s&#39;ex√©cutent <em>exactement comme pr√©vu</em>. La capacit√© de n&#39;importe quelle partie du programme √† modifier l&#39;√©tat de n&#39;importe quelle autre rend difficile le raisonnement sur l&#39;ex√©cution d&#39;un programme et introduit de nombreuses opportunit√©s de bogues. La programmation d√©clarative, par comparaison, permet de comprendre plus facilement le comportement d&#39;un programme : puisqu&#39;elle n&#39;a pas d&#39;effets secondaires, n&#39;importe quelle partie d&#39;un programme peut √™tre comprise isol√©ment.</p>
</div>
<div class="paragraph data-line-52">
<p>Dans les contrats intelligents, les bogues co√ªtent litt√©ralement de l&#39;argent. Par cons√©quent, il est extr√™mement important de r√©diger des contrats intelligents sans effets ind√©sirables. Pour ce faire, vous devez √™tre capable de raisonner clairement sur le comportement attendu du programme. Ainsi, les langages d√©claratifs jouent un r√¥le beaucoup plus important dans les contrats intelligents que dans les logiciels √† usage g√©n√©ral. N√©anmoins, comme vous le verrez, le langage le plus utilis√© pour les contrats intelligents (Solidity) est imp√©ratif. Les programmeurs, comme la plupart des humains, r√©sistent au changement¬†!</p>
</div>
<div class="paragraph data-line-54">
<p>Les langages de programmation de haut niveau actuellement pris en charge pour les contrats intelligents incluent (class√©s par √¢ge approximatif) :</p>
</div>
<div class="dlist data-line-56">
<dl>
<dt class="hdlist1">LLL</dt>
<dd>
<p>Un langage de programmation fonctionnel (d√©claratif), avec une syntaxe de type Lisp. C&#39;√©tait le premier langage de haut niveau pour les contrats intelligents Ethereum, mais il est rarement utilis√© aujourd&#39;hui.</p>
</dd>
<dt class="hdlist1">Serpent</dt>
<dd>
<p>Un langage de programmation proc√©dural (imp√©ratif) avec une syntaxe similaire √† Python. Peut √©galement √™tre utilis√© pour √©crire du code fonctionnel (d√©claratif), bien qu&#39;il ne soit pas enti√®rement exempt d&#39;effets secondaires.</p>
</dd>
<dt class="hdlist1">Solidity</dt>
<dd>
<p>Un langage de programmation proc√©dural (imp√©ratif) avec une syntaxe similaire √† JavaScript, C++, ou Java. Le langage le plus populaire et le plus fr√©quemment utilis√© pour les contrats intelligents Ethereum.</p>
</dd>
<dt class="hdlist1">Vyper</dt>
<dd>
<p>Un langage d√©velopp√© plus r√©cemment, similaire √† Serpent et encore une fois avec une syntaxe de type Python. Destin√© √† se rapprocher d&#39;un langage de type Python purement fonctionnel que Serpent, mais pas √† remplacer Serpent.</p>
</dd>
<dt class="hdlist1">Bamboo</dt>
<dd>
<p>Un langage nouvellement d√©velopp√©, influenc√© par Erlang, avec des transitions d&#39;√©tat explicites et sans flux it√©ratifs (boucles). Destin√© √† r√©duire les effets secondaires et √† augmenter l&#39;auditabilit√©. Tr√®s nouveau et en attente d&#8217;√™tre largement adopt√©.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-66">
<p>Comme vous pouvez le voir, il existe de nombreux languages parmi lesquelles choisir. Cependant, de tous, Solidity est de loin le plus populaire, au point d&#39;√™tre le langage de haut niveau <em>de facto</em> d&#39;Ethereum et m√™me d&#39;autres cha√Ænes de blocs de type EVM. Nous passerons la plupart de notre temps √† utiliser Solidity, mais nous explorerons √©galement certains des exemples dans d&#39;autres langages de haut niveau pour comprendre leurs diff√©rentes philosophies.</p>
</div>
</div>
<div class="sect2 data-line-69">
<h3 id="building_a_smart_contract_sec">Construire un contrat intelligent avec Solidity</h3>
<div class="paragraph data-line-71">
<p>Solidity a √©t√© cr√©√© par Dr. Gavin Wood (co-auteur de ce livre) en tant que langage explicite pour √©crire des contrats intelligents avec des fonctionnalit√©s permettant de prendre directement en charge l&#39;ex√©cution dans l&#39;environnement d√©centralis√© de l&#39;ordinateur mondial Ethereum. Les attributs r√©sultants sont assez g√©n√©raux et ont donc fini par √™tre utilis√©s pour coder des contrats intelligents sur plusieurs autres plateformes de cha√Æne de blocs. Il a √©t√© d√©velopp√© par Christian Reitiwessner puis √©galement par Alex Beregszaszi, Liana Husikyan, Yoichi Hirai et plusieurs anciens contributeurs principaux d&#39;Ethereum. Solidity est maintenant d√©velopp√© et maintenu en tant que projet ind√©pendant <a href="https://github.com/ethereum/solidity" data-href="https://github.com/ethereum/solidity">sur GitHub</a>.</p>
</div>
<div class="paragraph data-line-73">
<p>Le &quot;produit&quot; principal du projet Solidity est le compilateur Solidity, solc, qui convertit les programmes √©crits dans le langage Solidity en bytecode EVM. Le projet g√®re √©galement l&#39;importante norme d&#39;interface binaire d&#39;application (ABI) pour les contrats intelligents Ethereum, que nous explorerons en d√©tail dans ce chapitre. Chaque version du compilateur Solidity correspond √† et compile une version sp√©cifique de <span class="keep-together">language</span> de Solidity.</p>
</div>
<div class="paragraph data-line-75">
<p>Pour commencer, nous allons t√©l√©charger un ex√©cutable binaire du compilateur Solidity. Ensuite, nous d√©velopperons et compilerons un contrat simple, √† la suite de l&#39;exemple avec lequel nous avons commenc√© dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>.</p>
</div>
<div class="sect3 data-line-77">
<h4 id="_s√©lection_dune_version_de_solidity">S√©lection d&#39;une version de Solidity</h4>
<div class="paragraph data-line-79">
<p>Solidity suit un mod√®le de versionnage appel√© <a href="https://semver.org/" data-href="https://semver.org/"><em>versionnage de s√©mantique</em></a> (<em>semantic versioning</em>), qui sp√©cifie les num√©ros de version structur√©s comme trois nombres s√©par√©s par des points¬†: <em>MAJEUR.MINEUR.CORRECTIF</em>. Le num√©ro &quot;majeur&quot; est incr√©ment√© pour les modifications majeures et <em>r√©tro-incompatibles</em>, le num√©ro &quot;mineur&quot; est incr√©ment√© lorsque des fonctionnalit√©s r√©trocompatibles sont ajout√©es entre les versions majeures, et le num√©ro &quot;correctif&quot; est incr√©ment√© pour les corrections de bogues r√©trocompatibles.</p>
</div>
<div class="paragraph data-line-81">
<p>Au moment de la r√©daction, Solidity est √† la version 0.4.24. Les r√®gles de la version majeure 0, qui concerne le d√©veloppement initial d&#39;un projet, sont diff√©rentes : tout peut changer √† tout moment. En pratique, Solidity traite le num√©ro &quot;mineur&quot; comme s&#39;il s&#39;agissait de la version majeure et le num√©ro de &quot;correctif&quot; comme s&#39;il s&#39;agissait de la version mineure. Par cons√©quent, dans la version 0.4.24, 4 est consid√©r√©e comme la version majeure et 24 comme la version mineure.</p>
</div>
<div class="paragraph data-line-83">
<p>La sortie de la version majeure 0.5 de Solidity est attendue de mani√®re imminente.</p>
</div>
<div class="paragraph data-line-85">
<p>Comme vous l&#39;avez vu dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, vos programmes Solidity peuvent contenir une directive pragma qui sp√©cifie les versions minimale et maximale de Solidity avec lesquelles il est compatible, et peut √™tre utilis√©e pour compiler votre contrat.</p>
</div>
<div class="paragraph data-line-87">
<p>√âtant donn√© que Solidity √©volue rapidement, il est souvent pr√©f√©rable d&#39;installer la derni√®re version.</p>
</div>
</div>
<div class="sect3 data-line-89">
<h4 id="_t√©l√©charger_et_installer">T√©l√©charger et installer</h4>
<div class="paragraph data-line-91">
<p>Il existe un certain nombre de m√©thodes que vous pouvez utiliser pour t√©l√©charger et installer Solidity, soit sous forme de version binaire, soit en compilant √† partir du code source. Vous pouvez trouver des instructions d√©taill√©es dans <a href="http://bit.ly/2RrZmup" class="undefined" data-href="http://bit.ly/2RrZmup">http://bit.ly/2RrZmup</a> [la documentation de Solidity].</p>
</div>
<div class="paragraph data-line-93">
<p>Voici comment installer la derni√®re version binaire de Solidity sur un syst√®me d&#39;exploitation Ubuntu/Debian, en utilisant le gestionnaire de paquets apt¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>sudo add-apt-repository ppa:ethereum/ethereum</strong>
$ <strong>sudo apt update</strong>
$ <strong>sudo apt install solc</strong>

</pre>
<div class="paragraph data-line-104">
<p>Une fois que vous avez install√© solc, v√©rifiez la version en ex√©cutant¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --version</strong>
solc, the solidity compiler commandline interface
Version: 0.4.24+commit.e67f0147.Linux.g++

</pre>
<div class="paragraph data-line-115">
<p>Il existe plusieurs autres fa√ßons d&#39;installer Solidity, en fonction de votre syst√®me d&#39;exploitation et de vos exigences, y compris la compilation directe √† partir du code source. Pour plus d&#39;informations, consultez <a href="https://github.com/ethereum/solidity" class="undefined" data-href="https://github.com/ethereum/solidity">https://github.com/ethereum/solidity</a>.</p>
</div>
</div>
<div class="sect3 data-line-119">
<h4 id="_environnement_de_d√©veloppement">Environnement de d√©veloppement</h4>
<div class="paragraph data-line-121">
<p>Pour d√©velopper dans Solidity, vous pouvez utiliser n&#39;importe quel √©diteur de texte et solc sur la ligne de commande. Cependant, vous constaterez peut-√™tre que certains √©diteurs de texte con√ßus pour le d√©veloppement, tels que Emacs, Vim et Atom, offrent des fonctionnalit√©s suppl√©mentaires telles que la coloration syntaxique et les macros qui facilitent le d√©veloppement de Solidity.</p>
</div>
<div class="paragraph data-line-123">
<p>Il existe √©galement des environnements de d√©veloppement bas√©s sur le Web, tels que <a href="https://remix.ethereum.org/" data-href="https://remix.ethereum.org/">Remix IDE</a> et <a href="https://ethfiddle.com/" data-href="https://ethfiddle.com/">EthFiddle</a>.</p>
</div>
<div class="paragraph data-line-125">
<p>Utilisez les outils qui vous rendent productif. En fin de compte, les programmes Solidity ne sont que des fichiers texte. Bien que des √©diteurs et des environnements de d√©veloppement sophistiqu√©s puissent faciliter les choses, vous n&#39;avez besoin de rien de plus qu&#39;un simple √©diteur de texte, tel que nano (Linux/Unix), TextEdit (macOS) ou m√™me NotePad (Windows). Enregistrez simplement le code source de votre programme avec une extension <em>.sol</em> et il sera reconnu par le compilateur Solidity comme un programme Solidity.</p>
</div>
</div>
<div class="sect3 data-line-127">
<h4 id="_√©crire_un_programme_solidity_simple">√âcrire un programme Solidity simple</h4>
<div class="paragraph data-line-129">
<p>Dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, nous avons √©crit notre premier programme Solidity. Lorsque nous avons cr√©√© le contrat Faucet pour la premi√®re fois, nous avons utilis√© l&#39;IDE Remix pour compiler et d√©ployer le contrat. Dans cette section, nous allons revisiter, am√©liorer et embellir Faucet.</p>
</div>
<div class="paragraph data-line-131">
<p>Notre premi√®re tentative ressemblait √† <a href="#original_sol_faucet">Faucet.sol : Un contrat Solidity mettant en place un robinet</a>.</p>
</div>
<div id="original_sol_faucet" class="exampleblock data-line-135">
<div class="title">Example 2. Faucet.sol : Un contrat Solidity mettant en place un robinet</div>
<div class="content">
<div class="listingblock data-line-137">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity 0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-142">
<h4 id="_compiler_avec_le_compilateur_solidity_solc">Compiler avec le compilateur Solidity (solc)</h4>
<div class="paragraph data-line-144">
<p>Maintenant, nous allons utilisez le compilateur Solidity en ligne de commande pour compiler directement notre contrat. Le compilateur Solidity solc offre une vari√©t√© d&#39;options, que vous pouvez voir en passant l&#39;argument --help.</p>
</div>
<div class="paragraph data-line-146">
<p>Nous utilisons les arguments --bin et --optimize de solc pour produire un binaire optimis√© de notre exemple de contrat¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --optimize --bin Faucet.sol</strong>
======= Faucet.sol:Faucet =======
Binary:
6060604052341561000f57600080fd5b60cf8061001d6000396000f300606060405260043610603e5
763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416
632e1a7d4d81146040575b005b3415604a57600080fd5b603e60043567016345785d8a00008111156
06357600080fd5b73ffffffffffffffffffffffffffffffffffffffff331681156108fc0282604051
600060405180830381858888f19350505050151560a057600080fd5b505600a165627a7a723058203
556d79355f2da19e773a9551e95f1ca7457f2b5fbbf4eacf7748ab59d2532130029

</pre>
<div class="paragraph data-line-165">
<p>Le r√©sultat que solc produit est un binaire s√©rialis√© hexad√©cimal qui peut √™tre soumis √† la cha√Æne de blocs Ethereum.</p>
</div>
</div>
</div>
<div class="sect2 data-line-168">
<h3 id="eth_contract_abi_sec">L&#39;ABI du contrat Ethereum</h3>
<div class="paragraph data-line-170">
<p>Dans les logiciels informatiques, une <em>interface binaire d&#39;application</em> est une interface entre deux modules de programme¬†; souvent, entre le syst√®me d&#39;exploitation et les programmes utilisateur. Un ABI d√©finit la fa√ßon dont les structures de donn√©es et les fonctions sont accessibles en <em>code machine</em>¬†; cela ne doit pas √™tre confondu avec une API, qui d√©finit cet acc√®s dans des formats de haut niveau, souvent lisibles par l&#39;homme, en tant que <em>code source</em>. L&#39;ABI est donc le principal moyen d&#39;encoder et de d√©coder des donn√©es dans et hors du code machine.</p>
</div>
<div class="paragraph data-line-172">
<p>Dans Ethereum, l&#39;ABI est utilis√© pour coder les appels de contrat pour l&#39;EVM et pour lire les donn√©es des transactions. Le but d&#39;un ABI est de d√©finir les fonctions du contrat qui peuvent √™tre invoqu√©es et de d√©crire comment chaque fonction acceptera les arguments et renverra son r√©sultat.</p>
</div>
<div class="paragraph data-line-174">
<p>L&#39;ABI d&#39;un contrat est sp√©cifi√© sous la forme d&#39;un tableau JSON de descriptions de fonctions (voir <a href="#solidity_functions">Fonctions</a>) et √©v√©nements (voir <a href="#solidity_events">√âv√©nements</a>). Une description de fonction est un objet JSON avec les champs <code>type</code>, <code>name</code>, <code>inputs</code>, <code>outputs</code>, <code>constant</code> et <code>payable</code>. Un objet de description d&#39;√©v√©nement a des champs <code>type</code>, <code>name</code>, <code>inputs</code> et <code>anonymous</code>.</p>
</div>
<div class="paragraph data-line-176">
<p>Nous utilisons le compilateur Solidity en ligne de commande solc pour produire l&#39;ABI pour notre exemple de contrat¬†<span class="keep-together"><em>Faucet.sol</em></span> :</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --abi Faucet.sol</strong>
======= Faucet.sol:Faucet =======
Contract JSON ABI
[{"constant":false,"inputs":[{"name":"withdraw_amount","type":"uint256"}], \
"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable", \
"type":"function"},{"payable":true,"stateMutability":"payable", \
"type":"fallback"}]

</pre>
<div class="paragraph data-line-191">
<p>Comme vous pouvez le voir, le compilateur produit un tableau JSON d√©crivant les deux fonctions d√©finies par <em>Faucet.sol</em>. Ce JSON peut √™tre utilis√© par toute application qui souhaite acc√©der au contrat Faucet une fois qu&#39;il est d√©ploy√©. √Ä l&#39;aide de l&#39;ABI, une application telle qu&#39;un portefeuille ou un navigateur DApp peut construire des transactions qui appellent les fonctions dans + Faucet + avec les arguments et types d&#39;arguments corrects. Par exemple, un portefeuille saura que pour appeler la fonction withdraw, il devra fournir un argument uint256 nomm√© withdraw_amount. Le portefeuille pourrait inviter l&#39;utilisateur √† fournir cette valeur, puis √† cr√©er une transaction qui l&#39;encode et ex√©cute la fonction retirer.</p>
</div>
<div class="paragraph data-line-193">
<p>Tout ce qui est n√©cessaire pour qu&#39;une application interagisse avec un contrat est un ABI et l&#39;adresse o√π le contrat a √©t√© d√©ploy√©.</p>
</div>
<div class="sect3 data-line-196">
<h4 id="solidity_pragma">S√©lection d&#39;un compilateur Solidity et d&#39;une version linguistique</h4>
<div class="paragraph data-line-198">
<p>Comme nous l&#39;avons vu dans le code pr√©c√©dent, notre contrat Faucet se compile avec succ√®s avec Solidity version 0.4.21. Et si nous avions utilis√© une version diff√©rente du compilateur Solidity ? Le language est toujours en constante √©volution et les choses peuvent changer de mani√®re inattendue. Notre contrat est assez simple, mais que se passerait-il si notre programme utilisait une fonctionnalit√© qui n&#39;a √©t√© ajout√©e que dans la version 0.4.19 de Solidity et que nous essayions de la compiler avec la version 0.4.18 ?</p>
</div>
<div class="paragraph data-line-200">
<p>Pour r√©soudre ces probl√®mes, Solidity propose une <em>directive du compilateur</em> connue sous le nom de <em>version pragma</em> qui indique au compilateur que le programme attend un compilateur (et un langage) sp√©cifique √† une version. Regardons un exemple¬†:</p>
</div>
<div id="compiler_version" class="listingblock data-line-203">
<div class="content">
<pre>pragma solidity ^0.4.19;</pre>
</div>
</div>
<div class="paragraph data-line-207">
<p>Le compilateur Solidity lit le pragma de version et g√©n√®re une erreur si la version du compilateur est incompatible avec le pragma de version. Dans ce cas, notre pragma de version indique que ce programme peut √™tre compil√© par un compilateur Solidity avec une version minimale de 0.4.19. Le symbole ^ indique, cependant, que nous autorisons la compilation avec toute <em>r√©vision mineure</em> au-dessus de 0.4.19¬†; par exemple, 0.4.20, mais pas 0.5.0 (qui est une r√©vision majeure, pas une r√©vision mineure). Les directives Pragma ne sont pas compil√©es dans le code interm√©diaire EVM. Ils ne sont utilis√©s par le compilateur que pour v√©rifier la compatibilit√©.</p>
</div>
<div class="paragraph data-line-209">
<p>Ajoutons une directive pragma √† notre contrat Faucet. Nous nommerons le nouveau fichier <span class="keep-together"><em>Faucet2.sol</em></span>, pour garder une trace de nos modifications au fur et √† mesure que nous avancerons dans ces exemples en commen√ßant par <a href="#add_pragma_to_faucet">Faucet2.sol¬†: Ajout du pragma de version √† Faucet</a>.</p>
</div>
<div id="add_pragma_to_faucet" class="exampleblock data-line-213">
<div class="title">Example 3. Faucet2.sol¬†: Ajout du pragma de version √† Faucet</div>
<div class="content">
<div class="listingblock data-line-215">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity ^0.6.4;

// Our first contract is a faucet!
contract Faucet {
    // Accept any incoming amount
    receive() external payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-220">
<p>L&#39;ajout d&#39;un pragma de version est une bonne pratique, car il √©vite les probl√®mes li√©s aux versions incompatibles du compilateur et du langage. Nous explorerons d&#39;autres bonnes pratiques et continuerons d&#39;am√©liorer le contrat Faucet tout au long de ce chapitre.</p>
</div>
</div>
</div>
<div class="sect2 data-line-222">
<h3 id="_programmation_avec_solidity">Programmation avec Solidity</h3>
<div class="paragraph data-line-224">
<p>Dans cette section, nous examinerons certaines des fonctionnalit√©s du langage Solidity. Comme nous l&#39;avons mentionn√© dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a>, notre premier exemple de contrat √©tait tr√®s simple et √©galement d√©fectueux √† plusieurs √©gards. Nous allons l&#39;am√©liorer progressivement ici, tout en explorant comment utiliser Solidity. Cependant, ce ne sera pas un didacticiel complet sur Solidity, car Solidity est assez complexe et √©volue rapidement. Nous couvrirons les bases et vous donnerons suffisamment de bases pour pouvoir explorer le reste par vous-m√™me. La documentation de Solidity se trouve
<a href="https://solidity.readthedocs.io/en/latest/" data-href="https://solidity.readthedocs.io/en/latest/">sur le site du projet</a>.</p>
</div>
<div class="paragraph data-line-227">
<p>====Types de donn√©es</p>
</div>
<div class="paragraph data-line-229">
<p>D&#39;abord, examinons certains des types de donn√©es de base propos√©s dans Solidity¬†:</p>
</div>
<div class="dlist data-line-231">
<dl>
<dt class="hdlist1">Boolean (bool)</dt>
<dd>
<p>valeur bool√©enne, true ou false, avec les op√©rateurs logiques ! (not), &amp;amp;&amp;amp; (and), || (or), == (equal) et != (non √©gal).</p>
</dd>
<dt class="hdlist1">Integer (int, uint)</dt>
<dd>
<p>Entiers sign√©s (int) et non sign√©s (uint), d√©clar√©s par incr√©ments de 8 bits de int8 √† uint256. Sans suffixe de taille, des quantit√©s de 256 bits sont utilis√©es pour correspondre √† la taille de mot de l&#39;EVM.</p>
</dd>
<dt class="hdlist1">Fixed point (fixed, ufixed)</dt>
<dd>
<p>Nombres √† virgule fixe, d√©clar√©s avec ( <code>u</code>) <code>fixed <em>M</em> x <em>N</em></code> o√π <em>M</em> est la taille en bits (incr√©ments de 8 jusqu&#39;√† 256) et <em>N</em> est le nombre de d√©cimales apr√®s le point (jusqu&#39;√† 18)¬†; par exemple, ufixed32x2.</p>
</dd>
<dt class="hdlist1">Address</dt>
<dd>
<p>Une adresse Ethereum de 20 octets. L&#39;objet address a de nombreuses fonctions membres utiles, les principales √©tant balance (renvoie le solde du compte) et <span class="keep-together"><code>transfer</code></span> (transf√®re l&#39;ether au compte).</p>
</dd>
<dt class="hdlist1">Byte array (fixe)</dt>
<dd>
<p>Tableaux d&#39;octets de taille fixe, d√©clar√©s avec bytes1 jusqu&#39;√† bytes32.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-241">
<p>Byte array (dynamique)::¬†tableaux d&#39;octets de taille variable, d√©clar√©s avec bytes ou string.</p>
</div>
<div class="dlist data-line-243">
<dl>
<dt class="hdlist1">Enum</dt>
<dd>
<p>Type d√©fini par l&#39;utilisateur pour √©num√©rer des valeurs discr√®tes¬†: enum NAME {LABEL1, LABEL 2, ...}.</p>
</dd>
<dt class="hdlist1">Arrays</dt>
<dd>
<p>Un tableau de n&#39;importe quel type, fixe ou dynamique : uint32[][5] est un tableau de taille fixe de cinq tableaux dynamiques d&#39;entiers non sign√©s.</p>
</dd>
<dt class="hdlist1">Struct</dt>
<dd>
<p>Conteneurs de donn√©es d√©finis par l&#39;utilisateur pour regrouper les variables¬†: <code>struct NAME {TYPE1 <span class="keep-together">VARIABLE1</span>; TYPE2 VARIABLE2; ...}</code>.</p>
</dd>
<dt class="hdlist1">Mapping</dt>
<dd>
<p>Tables de recherche de hachage pour les paires <em>key</em> =&amp;gt; <em>value</em>¬†: mapping(KEY_TYPE =&amp;gt; VALUE_TYPE) NAME.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-251">
<p>En plus de ces types de donn√©es, Solidity propose √©galement une vari√©t√© de valeurs litt√©rales qui peuvent √™tre utilis√©es pour calculer diff√©rentes unit√©s¬†:</p>
</div>
<div class="dlist data-line-253">
<dl>
<dt class="hdlist1">Unit√©s de temps</dt>
<dd>
<p>Les unit√©s seconds, minutes, hours et days peuvent √™tre utilis√©es comme suffixes, convertis en multiples de l&#39;unit√© de base seconds.</p>
</dd>
<dt class="hdlist1">Unit√©s d&#39;ether</dt>
<dd>
<p>Les unit√©s wei, finney, szabo et ether peuvent √™tre utilis√©es comme suffixes, convertis en multiples de l&#39;unit√© de base wei.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-257">
<p>Dans notre exemple de contrat Faucet, nous avons utilis√© un uint (qui est un alias pour uint256) pour la variable withdraw_amount. Nous avons √©galement utilis√© indirectement une variable address, que nous avons d√©finie avec msg.sender. Nous utiliserons plus de ces types de donn√©es dans nos exemples dans le reste de ce chapitre.</p>
</div>
<div class="paragraph data-line-259">
<p>Utilisons l&#39;un des multiplicateurs d&#39;unit√©s pour am√©liorer la lisibilit√© de notre exemple de contrat. Dans la fonction withdraw nous limitons le retrait maximum, en exprimant la limite en wei, l&#39;unit√© de base de l&#39;ether :</p>
</div>
<div class="listingblock data-line-261">
<div class="content">
<pre>require(withdraw_amount &lt;= 100000000000000000);</pre>
</div>
</div>
<div class="paragraph data-line-265">
<p>Ce n&#39;est pas tr√®s facile √† lire. Nous pouvons am√©liorer notre code en utilisant le multiplicateur d&#39;unit√© ether, pour exprimer la valeur en ether au lieu de wei :</p>
</div>
<div class="listingblock data-line-267">
<div class="content">
<pre>require(withdraw_amount &lt;= 0.1 ether);</pre>
</div>
</div>
<div class="sect3 data-line-271">
<h4 id="_variables_et_fonctions_globales_pr√©d√©finies">Variables et fonctions globales pr√©d√©finies</h4>
<div class="paragraph data-line-273">
<p>Lorsqu&#39;un contrat est ex√©cut√© dans l&#39;EVM, il a acc√®s √† un petit ensemble d&#39;objets globaux. Ceux-ci incluent les objets block, msg et tx. De plus, Solidity expose un certain nombre d&#39;opcodes EVM en tant que fonctions pr√©d√©finies. Dans cette section, nous examinerons les variables et les fonctions auxquelles vous pouvez acc√©der √† partir d&#39;un contrat intelligent dans Solidity.</p>
</div>
<div class="sect4 data-line-275">
<h5 id="_contexte_dappel_de_transactionmessage">Contexte d&#39;appel de transaction/message</h5>
<div class="paragraph data-line-277">
<p>L&#39;objet msg est l&#39;appel de transaction (origine EOA) ou l&#39;appel de message (origine contrat) qui lanc√© l&#39;ex√©cution de ce contrat. Il contient un certain nombre d&#39;attributs utiles¬†:</p>
</div>
<div class="dlist data-line-279">
<dl>
<dt class="hdlist1">msg.sender</dt>
<dd>
<p>Nous avons d√©j√† utilis√© celui-ci. Il repr√©sente l&#39;adresse qui a lanc√© cet appel de contrat, pas n√©cessairement l&#39;EOA d&#39;origine qui a envoy√© la transaction. Si notre contrat a √©t√© appel√© directement par une transaction EOA, alors c&#39;est l&#39;adresse qui a sign√© la transaction, mais sinon ce sera une adresse de contrat.</p>
</dd>
<dt class="hdlist1">msg.value</dt>
<dd>
<p>La valeur d&#39;ether envoy√©e avec cet appel (en wei).</p>
</dd>
<dt class="hdlist1">msg.gas</dt>
<dd>
<p>La quantit√© de gaz restant dans l&#39;approvisionnement en gaz de cet environnement d&#39;ex√©cution. Cela a √©t√© d√©pr√©ci√© dans Solidity v0.4.21 et remplac√© par la fonction gasleft.</p>
</dd>
<dt class="hdlist1">msg.data</dt>
<dd>
<p>La charge utile de donn√©es de cet appel dans notre contrat.</p>
</dd>
<dt class="hdlist1">msg.sig</dt>
<dd>
<p>Les quatre premiers octets de la charge utile de donn√©es, qui est le s√©lecteur de fonction.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note data-line-290">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-291">
<p>Chaque fois qu&#39;un contrat appelle un autre contrat, les valeurs de tous les attributs de msg changent pour refl√©ter les informations du nouvel appelant. La seule exception √† cela est la fonction delegatecall, qui ex√©cute le code d&#39;un autre contrat/biblioth√®que dans le <span class="keep-together">contexte</span> de msg.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-294">
<h5 id="_contexte_transactionnel">Contexte transactionnel</h5>
<div class="paragraph data-line-296">
<p>L&#39;objet tx fournit un moyen d&#39;acc√©der aux informations relatives √† la transaction¬†:</p>
</div>
<div class="dlist data-line-298">
<dl>
<dt class="hdlist1">tx.gasprice</dt>
<dd>
<p>Le prix du gaz dans la transaction d&#39;appel.</p>
</dd>
<dt class="hdlist1">tx.origin</dt>
<dd>
<p>L&#39;adresse de l&#39;EOA d&#39;origine pour cette transaction. ATTENTION : dangereux !</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-302">
<h5 id="_contexte_de_bloc">Contexte de bloc</h5>
<div class="paragraph data-line-304">
<p>L&#39;objet block contient des informations sur le bloc courant¬†:</p>
</div>
<div class="dlist data-line-306">
<dl>
<dt class="hdlist1">block.blockhash(__blockNumber__)</dt>
<dd>
<p>Le hachage de bloc du num√©ro de bloc sp√©cifi√©, jusqu&#39;√† 256 blocs dans le pass√©. Obsol√®te et remplac√© par la fonction blockhash dans Solidity v0.4.22.</p>
</dd>
<dt class="hdlist1">block.coinbase</dt>
<dd>
<p>L&#39;adresse du destinataire des frais du bloc actuel et de la r√©compense du bloc.</p>
</dd>
<dt class="hdlist1">block.difficulty</dt>
<dd>
<p>La difficult√© (preuve de travail) du bloc actuel.</p>
</dd>
<dt class="hdlist1">block.gaslimit</dt>
<dd>
<p>La quantit√© maximale de gaz pouvant √™tre d√©pens√©e pour toutes les transactions incluses dans le bloc actuel.</p>
</dd>
<dt class="hdlist1">block.number</dt>
<dd>
<p>Le num√©ro de bloc actuel (hauteur de la cha√Æne de blocs).</p>
</dd>
<dt class="hdlist1">block.timestamp</dt>
<dd>
<p>L&#39;horodatage plac√© dans le bloc actuel par le mineur (nombre de secondes depuis l&#39;√©poque Unix).</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-319">
<h5 id="solidity_address_object">objet d&#39;adresse</h5>
<div class="paragraph data-line-321">
<p>Toute adresse, transmise en tant qu&#39;entr√©e ou extraite d&#39;un objet de contrat, poss√®de un certain nombre d&#39;attributs et de m√©thodes¬†:</p>
</div>
<div class="dlist data-line-323">
<dl>
<dt class="hdlist1">address.balance</dt>
<dd>
<p>Le solde de l&#39;adresse, en wei. Par exemple, le solde actuel du contrat est address(this).balance.</p>
</dd>
<dt class="hdlist1">address.transfer(__amount__)</dt>
<dd>
<p>Transf√®re le montant (en wei) √† cette adresse, en levant une exception en cas d&#39;erreur. Nous avons utilis√© cette fonction dans notre exemple Faucet comme m√©thode sur l&#39;adresse msg.sender, comme msg.sender.transfer.</p>
</dd>
<dt class="hdlist1">address.send(__amount__)</dt>
<dd>
<p>similaire √† transfer, mais au lieu de lancer une exception, il renvoie false en cas d&#39;erreur. ATTENTION : v√©rifiez toujours la valeur de retour de send.</p>
</dd>
<dt class="hdlist1">address.call(__payload__)</dt>
<dd>
<p>fonction CALL de bas niveau ‚Äî peut construire un appel de message arbitraire avec une charge utile de donn√©es. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT¬†: dangereux¬†: le destinataire peut (accidentellement ou par malveillance) utiliser tout votre gaz, provoquant l&#39;arr√™t de votre contrat avec une exception¬†OOG¬†; v√©rifiez toujours la valeur de retour de call.</p>
</dd>
<dt class="hdlist1">address.callcode(__payload__)</dt>
<dd>
<p>fonction CALLCODE de bas niveau, comme address(this).call(pass¬†:[...]) mais avec le code de ce contrat remplac√© par celui de address. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT¬†: utilisation avanc√©e uniquement¬†!</p>
</dd>
<dt class="hdlist1">address.delegatecall()</dt>
<dd>
<p>Fonction DELEGATECALL de bas niveau, comme callcode(...) mais avec le contexte msg complet vu par le contrat actuel. Renvoie faux en cas d&#39;erreur. AVERTISSEMENT¬†: utilisation avanc√©e uniquement¬†!</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-335">
<h5 id="_fonctions_int√©gr√©es">Fonctions int√©gr√©es</h5>
<div class="paragraph data-line-337">
<p>Les autres fonctions √† noter sont :</p>
</div>
<div class="dlist data-line-339">
<dl>
<dt class="hdlist1">addmod, mulmod</dt>
<dd>
<p>Pour l&#39;addition et la multiplication modulo. Par exemple, addmod(x,y,k) calcule (x + y) % k.</p>
</dd>
<dt class="hdlist1">keccak256, sha256, sha3, ripemd160</dt>
<dd>
<p>Fonctions pour calculer les hachages avec divers algorithmes de hachage standard.</p>
</dd>
<dt class="hdlist1">ecrecover</dt>
<dd>
<p>R√©cup√®re l&#39;adresse utilis√©e pour signer un message √† partir de la signature.</p>
</dd>
<dt class="hdlist1">selfdestruct(__recipient_address__)</dt>
<dd>
<p>Supprime le contrat actuel, en envoyant tout ether restant dans le compte √† l&#39;adresse du destinataire.</p>
</dd>
<dt class="hdlist1">this</dt>
<dd>
<p>L&#39;adresse du compte de contrat en cours d&#39;ex√©cution.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-349">
<h4 id="_d√©finition_du_contrat">D√©finition du contrat</h4>
<div class="paragraph data-line-351">
<p>Le type de donn√©es principal de Solidity est contract¬†; notre exemple Faucet d√©finit simplement un objet <span class="keep-together"><code>contract</code></span>. Semblable √† tout objet dans un langage orient√© objet, le contrat est un conteneur qui inclut des donn√©es et des m√©thodes.</p>
</div>
<div class="paragraph data-line-353">
<p>Solidity propose deux autres types d&#39;objets qui s&#39;apparentent √† un contrat :</p>
</div>
<div class="dlist data-line-355">
<dl>
<dt class="hdlist1">interface</dt>
<dd>
<p>Une d√©finition d&#39;interface est structur√©e exactement comme un contrat, sauf qu&#39;aucune des fonctions n&#39;est d√©finie, elles sont seulement d√©clar√©es. Ce type de d√©claration est souvent appel√© <em>stub</em> ou <em>souche</em> ; il vous indique les arguments des fonctions et les types de retour sans aucune impl√©mentation. Une interface pr√©cise la ¬´ forme ¬ª d&#39;un contrat ; lorsqu&#39;elle est h√©rit√©e, chacune des fonctions d√©clar√©es par l&#39;interface doit √™tre d√©finie par l&#39;enfant.</p>
</dd>
<dt class="hdlist1">library</dt>
<dd>
<p>Un contrat de biblioth√®que est un contrat destin√© √† √™tre d√©ploy√© une seule fois et utilis√© par d&#39;autres contrats, en utilisant la m√©thode delegatecall (voir <a href="#solidity_address_object">objet d&#39;adresse</a>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-360">
<h4 id="solidity_functions">Fonctions</h4>
<div class="paragraph data-line-362">
<p>Au sein d&#39;un contrat, on d√©finit des fonctions qui peuvent √™tre appel√©es par une transaction EOA ou un autre contrat. Dans notre exemple Faucet, nous avons deux fonctions¬†: withdraw et la fonction (sans nom) <em>fallback</em>.</p>
</div>
<div class="paragraph data-line-364">
<p>La syntaxe que nous utilisons pour d√©clarer une fonction dans Solidity est la suivante¬†:</p>
</div>
<pre data-type="programlisting">
function FunctionName([<em>parameters</em>]) {public|private|internal|external}
[pure|constant|view|payable] [<em>modifiers</em>] [returns (<em>return types</em>)]

</pre>
<div class="paragraph data-line-375">
<p>Examinons chacun de ces composants¬†:</p>
</div>
<div class="dlist data-line-377">
<dl>
<dt class="hdlist1">FunctionName</dt>
<dd>
<p>Le nom de la fonction, qui est utilis√© pour appeler la fonction dans une transaction (√† partir d&#39;un EOA), √† partir d&#39;un autre contrat, ou m√™me √† partir du m√™me contrat. Une fonction dans chaque contrat peut √™tre d√©finie sans nom, auquel cas c&#39;est la fonction <em>fallback</em>, qui est appel√©e lorsqu&#39;aucune autre fonction n&#39;est nomm√©e. La fonction de secours ne peut pas avoir d&#39;arguments ni rien renvoyer.</p>
</dd>
<dt class="hdlist1"><em>parameters</em></dt>
<dd>
<p>Apr√®s le nom, nous sp√©cifions les arguments qui doivent √™tre pass√©s √† la fonction, avec leurs noms et leurs types. Dans notre exemple Faucet, nous avons d√©fini uint remove_amount comme le seul argument de la fonction <code><span class="keep-together">withdraw</span></code>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-381">
<p>Le prochain ensemble de mots cl√©s (public, private, internal, external) sp√©cifie la <em>visibilit√©</em> de la fonction¬†:</p>
</div>
<div class="dlist data-line-383">
<dl>
<dt class="hdlist1">public</dt>
<dd>
<p>Public est la valeur par d√©faut¬†; ces fonctions peuvent √™tre appel√©es par d&#39;autres contrats ou transactions EOA, ou depuis le contrat. Dans notre exemple Faucet, les deux fonctions sont d√©finies comme publiques.</p>
</dd>
<dt class="hdlist1">external</dt>
<dd>
<p>Les fonctions externes sont comme des fonctions publiques, sauf qu&#39;elles ne peuvent pas √™tre appel√©es depuis le contrat √† moins d&#39;√™tre explicitement pr√©fix√©es avec le mot-cl√© this.</p>
</dd>
<dt class="hdlist1">interne </dt>
<dd>
<p>Les fonctions internes ne sont accessibles qu&#39;√† partir du contrat - elles ne peuvent pas √™tre appel√©es par un autre contrat ou une transaction EOA. Ils peuvent √™tre appel√©s par des contrats d√©riv√©s (ceux qui h√©ritent de celui-ci).</p>
</dd>
<dt class="hdlist1">private</dt>
<dd>
<p>Les fonctions priv√©es sont comme des fonctions internes mais ne peuvent pas √™tre appel√©es par les  <span class="keep-together">contrats</span> d√©riv√©s.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-391">
<p>Gardez √† l&#39;esprit que les termes <em>internal</em> et <em>private</em> sont quelque peu trompeurs. Toute fonction ou donn√©e √† l&#39;int√©rieur d&#39;un contrat est toujours <em>visible</em> sur la cha√Æne de blocs publique, ce qui signifie que n&#39;importe qui peut voir le code ou les donn√©es. Les mots cl√©s d√©crits ici n&#39;affectent que comment et quand une fonction peut √™tre <em>appel√©e</em>.</p>
</div>
<div class="paragraph data-line-393">
<p>Le deuxi√®me ensemble de mots cl√©s (pure, constant, view, payable) affecte le comportement de la fonction¬†:</p>
</div>
<div class="dlist data-line-395">
<dl>
<dt class="hdlist1">constant ou view </dt>
<dd>
<p>Une fonction marqu√©e comme <em>view</em> promet de ne modifier aucun √©tat. Le terme <em>constant</em> est un alias pour la vue qui sera obsol√®te dans une future version. Pour le moment, le compilateur n&#39;applique pas le modificateur view, ne produisant qu&#39;un avertissement, mais cela devrait devenir un mot-cl√© appliqu√© dans la v0.5 de Solidity.</p>
</dd>
<dt class="hdlist1">pure</dt>
<dd>
<p>Une fonction pure est une fonction qui ne lit ni √©crit aucune variable dans le stockage. Il ne peut fonctionner que sur des arguments et renvoyer des donn√©es, sans r√©f√©rence √† aucune donn√©e stock√©e. Les fonctions pures sont destin√©es √† encourager la programmation de style d√©claratif sans effets secondaires ni √©tat.</p>
</dd>
<dt class="hdlist1">payable</dt>
<dd>
<p>Une fonction payable est une fonction qui peut accepter des paiements entrants. Les fonctions non d√©clar√©es comme payable rejetteront les paiements entrants. Il existe deux exceptions, dues √† des d√©cisions de conception dans l&#39;EVM¬†: les paiements coinbase et l&#39;h√©ritage SELFDESTRUCT seront pay√©s m√™me si la fonction de secours n&#39;est pas d√©clar√©e comme payable, mais cela a du sens car l&#39;ex√©cution de code ne fait pas partie de ces paiements¬†<span class="keep-together">de toute fa√ßon</span>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-401">
<p>Comme vous pouvez le voir dans notre exemple Faucet, nous avons une fonction payante (la fonction de secours), qui est la seule fonction qui peut recevoir des paiements entrants.</p>
</div>
</div>
<div class="sect3 data-line-403">
<h4 id="_constructeur_de_contrat_et_autodestruction">Constructeur de contrat et autodestruction</h4>
<div class="paragraph data-line-405">
<p>Il existe une fonction sp√©ciale qui n&#39;est utilis√©e qu&#39;une seule fois . Lorsqu&#39;un contrat est cr√©√©, il ex√©cute √©galement la <em>fonction constructor</em> s&#39;il en existe une, pour initialiser l&#39;√©tat du contrat. Le constructeur est ex√©cut√© dans la m√™me transaction que la cr√©ation du contrat. La fonction constructeur est facultative ; vous remarquerez que notre exemple Faucet n&#39;en a pas.</p>
</div>
<div class="paragraph data-line-407">
<p>Les constructeurs peuvent √™tre sp√©cifi√©s de deux mani√®res. Jusqu&#39;√† et y compris dans Solidity v0.4.21, le constructeur est une fonction dont le nom correspond au nom du contrat, comme vous pouvez le voir ici :</p>
</div>
<div class="listingblock data-line-410">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract MEContract {
	function MEContract() {
// C&amp;#39;est le constructeur
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-419">
<p>La difficult√© avec ce format est que si le nom du contrat est modifi√© et que le nom de la fonction constructeur n&#39;est pas modifi√©, ce n&#39;est plus un constructeur. De m√™me, s&#39;il y a une faute de frappe accidentelle dans la d√©nomination du contrat et/ou du constructeur, la fonction n&#39;est plus un constructeur. Cela peut provoquer des bogues assez d√©sagr√©ables, inattendus et difficiles √† trouver. Imaginez par exemple si le constructeur met le propri√©taire du contrat √† des fins de contr√¥le. Si la fonction n&#39;est pas r√©ellement le constructeur en raison d&#39;une erreur de nommage, non seulement le propri√©taire ne sera pas d√©fini au moment de la cr√©ation du contrat, mais la fonction peut √©galement √™tre d√©ploy√©e en tant que partie permanente et &quot;appelable&quot; du contrat, comme un fonction normale, permettant √† tout tiers de d√©tourner le contrat et d&#39;en devenir le &quot;propri√©taire&quot; apr√®s la cr√©ation du contrat.</p>
</div>
<div class="paragraph data-line-421">
<p>Pour r√©soudre les probl√®mes potentiels avec les fonctions constructeur bas√©es sur le fait d&#39;avoir un nom identique √† celui du contrat, Solidity v0.4.22 introduit un mot-cl√© constructor qui fonctionne comme une fonction constructeur mais n&#39;a pas de nom. Renommer le contrat n&#39;affecte en rien le constructeur. De plus, il est plus facile d&#39;identifier quelle fonction est le constructeur. Il ressemble √† ceci¬†:</p>
</div>
<div class="listingblock data-line-424">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma ^0.4.22
contract MEContract {
	constructor () {
// C&amp;#39;est le constructeur
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-433">
<p>Pour r√©sumer, le cycle de vie d&#39;un contrat commence par une transaction de cr√©ation √† partir d&#39;un compte EOA ou un contrat. S&#39;il existe un constructeur, il est ex√©cut√© dans le cadre de la cr√©ation du contrat, pour initialiser l&#39;√©tat du contrat lors de sa cr√©ation, puis est supprim√©.</p>
</div>
<div class="paragraph data-line-435">
<p>L&#39;autre la fin du cycle de vie du contrat est la <em>destruction du contrat</em>. Les contrats sont d√©truits par un opcode EVM sp√©cial appel√© SELFDESTRUCT. Il s&#39;appelait autrefois <span class="keep-together"><code>SUICIDE</code></span>, mais ce nom a √©t√© d√©pr√©ci√© en raison des associations n√©gatives du mot. Dans Solidity, cet opcode est expos√© sous la forme d&#39;une fonction int√©gr√©e de haut niveau appel√©e selfdestruct, qui prend un argument¬†: l&#39;adresse pour recevoir tout solde d&#39;√©ther restant dans le compte du contrat. Il ressemble √† ceci¬†:</p>
</div>
<div class="listingblock data-line-438">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">selfdestruct(address recipient);</code></pre>
</div>
</div>
<div class="paragraph data-line-442">
<p>Notez que vous devez explicitement ajouter cette commande √† votre contrat si vous voulez qu&#39;il soit supprimable - c&#39;est la seule fa√ßon de supprimer un contrat, et il n&#39;est pas pr√©sent par d√©faut. De cette mani√®re, les utilisateurs d&#39;un contrat qui pourraient s&#39;attendre √† ce qu&#39;un contrat soit l√† pour toujours peuvent √™tre certains qu&#39;un contrat ne peut pas √™tre supprim√© s&#39;il ne contient pas d&#39;opcode <span class="keep-together"><code>SELFDESTRUCT</code></span>.</p>
</div>
</div>
<div class="sect3 data-line-444">
<h4 id="_ajout_dun_constructeur_et_autodestruction_√†_notre_exemple_de_robinet">Ajout d&#39;un constructeur et autodestruction √† notre exemple de robinet</h4>
<div class="paragraph data-line-446">
<p>L&#39;exemple de contrat Faucet que nous avons introduit dans <a href="#intro_chapter">Les bases d&#39;Ethereum</a> n&#39;a pas de constructeur ou de fonctions selfdestruct. C&#39;est un contrat √©ternel qui ne peut pas √™tre supprim√©. Changeons cela en ajoutant un constructeur et une fonction selfdestruct. Nous voulons probablement que selfdestruct soit appelable <em>uniquement</em> par l&#39;EOA qui a initialement cr√©√© le contrat. Par convention, ceci est g√©n√©ralement stock√© dans une variable d&#39;adresse appel√©e owner. Notre constructeur d√©finit la variable owner, et la fonction selfdestruct v√©rifiera d&#39;abord que le propri√©taire l&#39;a appel√©e directement.</p>
</div>
<div class="paragraph data-line-448">
<p>Tout d&#39;abord, notre constructeur :</p>
</div>
<div class="listingblock data-line-451">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version du compilateur Solidity pour lequel ce programme a √©t√© √©crit
pragma solidity ^0.4.22;

// Notre premier contrat est un robinet !
contract Faucet {

	address owner;

// Initialiser le contrat Faucet¬†: d√©finir le propri√©taire
	constructor() {
		owner = msg.sender;
	}

[...]</code></pre>
</div>
</div>
<div class="paragraph data-line-468">
<p>Nous avons modifi√© la directive pragma pour sp√©cifier la v0.4.22 comme version minimale pour cet exemple, car nous utilisons le nouveau mot-cl√© constructor introduit dans la v0.4.22 de Solidity. Notre contrat a maintenant une variable de type address nomm√©e owner. Le nom &quot;owner&quot; n&#39;est en aucun cas sp√©cial. Nous pourrions appeler cette variable d&#39;adresse &quot;potato&quot; et l&#39;utiliser toujours de la m√™me mani√®re. Le nom owner rend simplement son objectif clair.</p>
</div>
<div class="paragraph data-line-470">
<p>Ensuite, notre constructeur, qui s&#39;ex√©cute dans le cadre de la transaction de cr√©ation de contrat, attribue l&#39;adresse de msg.sender √† la variable owner. Nous avons utilis√© msg.sender dans la fonction remove pour identifier l&#39;initiateur de la demande de <span class="keep-together"><code>withdraw</code></span>. Dans le constructeur, cependant, le msg.sender est l&#39;EOA ou l&#39;adresse du contrat qui a initi√© la cr√©ation du contrat. Nous savons que c&#39;est le cas <em>car</em> il s&#39;agit d&#39;une fonction constructeur¬†: elle ne s&#39;ex√©cute qu&#39;une seule fois, lors de la cr√©ation du contrat.</p>
</div>
<div class="paragraph data-line-472">
<p>Nous pouvons maintenant ajouter une fonction pour d√©truire le contrat. Nous devons nous assurer que seul le propri√©taire peut ex√©cuter cette fonction, nous utiliserons donc une instruction require pour contr√¥ler l&#39;acc√®s. Voici √† quoi cela ressemblera¬†:</p>
</div>
<div class="listingblock data-line-475">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Destructeur de contrat
function destroy() public {
	require(msg.sender == owner);
	selfdestruct(owner);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-483">
<p>Si quelqu&#39;un appelle cette fonction destroy depuis une adresse autre que owner, elle √©chouera. Mais si la m√™me adresse stock√©e dans owner par le constructeur l&#39;appelle, le contrat s&#39;autod√©truira et enverra tout solde restant √† l&#39;adresse owner. Notez que nous n&#39;avons pas utilis√© le non s√©curis√© tx.origin pour d√©terminer si le propri√©taire souhaitait d√©truire le contrat. L&#39;utilisation de tx.origin permettrait √† des contrats malveillants de d√©truire votre contrat sans votre permission.</p>
</div>
</div>
<div class="sect3 data-line-485">
<h4 id="_modificateurs_de_fonction">Modificateurs de fonction</h4>
<div class="paragraph data-line-487">
<p>Solidity offre un type sp√©cial de fonction appel√© <em>modificateur de fonction</em>. Vous appliquez des modificateurs aux fonctions en ajoutant le nom du modificateur dans la d√©claration de la fonction. Les modificateurs sont le plus souvent utilis√©s pour cr√©er des conditions qui s&#39;appliquent √† de nombreuses fonctions au sein d&#39;un contrat. Nous avons d√©j√† une instruction de contr√¥le d&#39;acc√®s dans notre fonction destroy. Cr√©ons un modificateur de fonction qui exprime cette condition¬†:</p>
</div>
<div class="listingblock data-line-490">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">modifier onlyOwner {
    require(msg.sender == owner);
    _;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-498">
<p>Ce modificateur de fonction, nomm√© onlyOwner, d√©finit une condition sur toute fonction qu&#39;il modifie, exigeant que l&#39;adresse stock√©e en tant que owner du contrat soit la m√™me que l&#39;adresse du msg.sender de la transaction. Il s&#39;agit du mod√®le de conception de base pour le contr√¥le d&#39;acc√®s, permettant uniquement au propri√©taire d&#39;un contrat d&#39;ex√©cuter toute fonction qui a le modificateur onlyOwner.</p>
</div>
<div class="paragraph data-line-500">
<p>Vous avez peut-√™tre remarqu√© que notre modificateur de fonction contient un &quot;espace r√©serv√©&quot; syntaxique particulier, un trait de soulignement suivi d&#39;un point-virgule (_;). Cet espace r√©serv√© est remplac√© par le code de la fonction en cours de modification. Essentiellement, le modificateur est &quot;enroul√© autour&quot; de la fonction modifi√©e, pla√ßant son code √† l&#39;emplacement identifi√© par le caract√®re de soulignement.</p>
</div>
<div class="paragraph data-line-502">
<p>Pour appliquer un modificateur, vous ajoutez son nom √† la d√©claration de la fonction. Plusieurs modificateurs peuvent √™tre appliqu√©s √† une fonction¬†; ils sont appliqu√©s dans l&#39;ordre dans lequel ils sont d√©clar√©s, sous forme de liste s√©par√©e par des virgules.</p>
</div>
<div class="paragraph data-line-504">
<p>R√©√©crivons notre fonction destroy pour utiliser le modificateur onlyOwner¬†:</p>
</div>
<div class="listingblock data-line-507">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function destroy() public onlyOwner {
    selfdestruct(owner);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-513">
<p>Le nom du modificateur de fonction (onlyOwner) se trouve apr√®s le mot-cl√© public et nous indique que la fonction destroy est modifi√©e par le modificateur onlyOwner. Essentiellement, vous pouvez lire cela comme &quot;Seul le propri√©taire peut d√©truire ce contrat&quot;. En pratique, le code r√©sultant √©quivaut √† &quot;envelopper&quot; le code de onlyOwner autour de destroy.</p>
</div>
<div class="paragraph data-line-515">
<p>Les modificateurs de fonction sont un outil extr√™mement utile car ils nous permettent d&#39;√©crire des conditions pr√©alables pour les fonctions et de les appliquer de mani√®re coh√©rente, ce qui rend le code plus facile √† lire et, par cons√©quent, plus facile √† auditer pour la s√©curit√©. Ils sont le plus souvent utilis√©s pour le contr√¥le d&#39;acc√®s, mais ils sont assez polyvalents et peuvent √™tre utilis√©s √† diverses autres fins.</p>
</div>
<div class="paragraph data-line-517">
<p>A l&#39;int√©rieur d&#39;un modificateur, vous pouvez acc√©der √† toutes les valeurs (variables et arguments) visibles par la fonction modifi√©e. Dans ce cas, nous pouvons acc√©der √† la variable owner, qui est d√©clar√©e dans le contrat. Cependant, l&#39;inverse n&#39;est pas vrai : vous ne pouvez acc√©der √† aucune des variables du modificateur √† l&#39;int√©rieur de la fonction modifi√©e.</p>
</div>
</div>
<div class="sect3 data-line-519">
<h4 id="_h√©ritage_du_contrat">H√©ritage du contrat</h4>
<div class="paragraph data-line-521">
<p>L&#39;objet contract de Solidity prend en charge l'<em>h√©ritage</em>, qui est un m√©canisme permettant d&#39;√©tendre un contrat de base avec des fonctionnalit√©s suppl√©mentaires. Pour utiliser l&#39;h√©ritage, sp√©cifiez un contrat parent avec le mot-cl√© is¬†:</p>
</div>
<div class="listingblock data-line-524">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Child is Parent {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-530">
<p>Avec cette construction, le contrat Child h√©rite de toutes les m√©thodes, fonctionnalit√©s et variables de Parent. Solidity prend √©galement en charge l&#39;h√©ritage multiple, qui peut √™tre sp√©cifi√© par des noms de contrat s√©par√©s par des virgules apr√®s le mot-cl√© is¬†:</p>
</div>
<div class="listingblock data-line-533">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Child is Parent1, Parent2 {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-539">
<p>L&#39;h√©ritage de contrat nous permet d&#39;√©crire nos contrats de mani√®re √† atteindre la modularit√©, l&#39;extensibilit√© et la r√©utilisation. Nous commen√ßons par des contrats simples et impl√©mentons les capacit√©s les plus g√©n√©riques, puis nous les √©tendons en h√©ritant de ces capacit√©s dans des contrats plus sp√©cialis√©s.</p>
</div>
<div class="paragraph data-line-541">
<p>Dans notre contrat Faucet, nous avons introduit le constructeur et le destructeur, ainsi qu&#39;un contr√¥le d&#39;acc√®s pour un propri√©taire, assign√© √† la construction. Ces capacit√©s sont assez g√©n√©riques : de nombreux contrats en auront. Nous pouvons les d√©finir comme des contrats g√©n√©riques, puis utiliser l&#39;h√©ritage pour les √©tendre au contrat Faucet.</p>
</div>
<div class="paragraph data-line-543">
<p>Nous commen√ßons par d√©finir un contrat de base owned, qui a une variable owner, en la d√©finissant dans le constructeur du contrat¬†:</p>
</div>
<div class="listingblock data-line-546">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract owned {
	address owner;

// Constructeur de contrat¬†: d√©finit le propri√©taire
	constructor() {
		owner = msg.sender;
	}

// Modificateur de contr√¥le d&amp;#39;acc√®s
	modifier onlyOwner {
	    require(msg.sender == owner);
	    _;
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-563">
<p>Ensuite, nous d√©finissons un contrat de base mortal, qui h√©rite de owned¬†:</p>
</div>
<div class="listingblock data-line-566">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract mortal is owned {
	// Contract destructor
	function destroy() public onlyOwner {
		selfdestruct(owner);
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-575">
<p>Comme vous pouvez le voir, le contrat mortal peut utiliser le modificateur de fonction onlyOwner, d√©fini dans owned. Il utilise aussi indirectement la variable d&#39;adresse owner et le constructeur d√©fini dans owned. L&#39;h√©ritage rend chaque contrat plus simple et ax√© sur sa fonctionnalit√© sp√©cifique, nous permettant de g√©rer les d√©tails de mani√®re modulaire.</p>
</div>
<div class="paragraph data-line-577">
<p>Nous pouvons maintenant √©tendre davantage le contrat owned, en h√©ritant de ses capacit√©s dans Faucet¬†:</p>
</div>
<div class="listingblock data-line-580">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet is mortal {
// Donnez de l&amp;#39;√©ther √† quiconque demande
    function withdraw(uint withdraw_amount) public {
// Limiter le montant du retrait
        require(withdraw_amount &lt;= 0.1 ether);
// Envoie le montant √† l&amp;#39;adresse qui l&amp;#39;a demand√©
        msg.sender.transfer(withdraw_amount);
    }
// Accepte tout montant entrant
    function () external payable {}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-594">
<p>En h√©ritant de mortal, qui √† son tour h√©rite de owned, le contrat Faucet a maintenant les fonctions constructeur et destroy, et un propri√©taire d√©fini. La fonctionnalit√© est la m√™me que lorsque ces fonctions √©taient dans Faucet, mais maintenant nous pouvons r√©utiliser ces fonctions dans d&#39;autres contrats sans les r√©√©crire. La r√©utilisation et la modularit√© du code rendent notre code plus propre, plus facile √† lire et plus facile √† auditer.</p>
</div>
</div>
<div class="sect3 data-line-596">
<h4 id="_gestion_des_erreurs_assert_require_revert">Gestion des erreurs (assert, require, revert)</h4>
<div class="paragraph data-line-598">
<p>Un appel de contrat peut se terminer et renvoyer une erreur. La gestion des erreurs dans Solidity est g√©r√©e par quatre fonctions : assert, require, revert et throw (d√©sormais obsol√®te).</p>
</div>
<div class="paragraph data-line-600">
<p>Lorsqu&#39;un contrat se termine avec une erreur, tous les changements d&#39;√©tat (changements de variables, de soldes, etc.) sont annul√©s, tout au long de la cha√Æne d&#39;appels de contrat si plusieurs contrats ont √©t√© appel√©s. Cela garantit que les transactions sont <em>atomiques</em>, ce qui signifie qu&#39;elles se terminent avec succ√®s ou n&#39;ont aucun effet sur l&#39;√©tat et sont enti√®rement annul√©es.</p>
</div>
<div class="paragraph data-line-602">
<p>Les fonctions assert et require fonctionnent de la m√™me mani√®re, √©valuant une condition et arr√™tant l&#39;ex√©cution avec une erreur si la condition c&#39;est fausse. Par convention, assert est utilis√© lorsque le r√©sultat est cens√© √™tre vrai, ce qui signifie que nous utilisons assert pour tester les conditions internes. Par comparaison, require est utilis√© lors du test d&#39;entr√©es (telles que des arguments de fonction ou des champs de transaction), d√©finissant nos attentes pour ces <span class="keep-together">conditions</span>.</p>
</div>
<div class="paragraph data-line-604">
<p>Nous avons utilis√© require dans notre modificateur de fonction onlyOwner, pour tester que l&#39;exp√©diteur du message est le propri√©taire du contrat¬†:</p>
</div>
<div class="listingblock data-line-607">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(msg.sender == owner);</code></pre>
</div>
</div>
<div class="paragraph data-line-611">
<p>La fonction require agit comme une <em>condition d&#8217;entr√©e</em>, emp√™chant l&#39;ex√©cution du reste de la fonction et produisant une erreur si elle n&#39;est pas satisfaite.</p>
</div>
<div class="paragraph data-line-613">
<p>Depuis Solidity v0.4.22, require peut √©galement inclure un message texte utile qui peut √™tre utilis√© pour indiquer la raison de l&#39;erreur. Le message d&#39;erreur est enregistr√© dans le journal des transactions. Ainsi, nous pouvons am√©liorer notre code en ajoutant un message d&#39;erreur dans notre fonction require¬†:</p>
</div>
<div class="listingblock data-line-616">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(msg.sender == owner, &amp;quot;Seul le propri√©taire du contrat peut appeler cette fonction&amp;quot;);</code></pre>
</div>
</div>
<div class="paragraph data-line-620">
<p>Les fonctions revert et throw interrompent l&#39;ex√©cution du contrat et annulent tout changement d&#39;√©tat. La fonction throw est obsol√®te et sera supprim√©e dans les futures versions de Solidity ; vous devriez utiliser revert √† la place. La fonction revert peut √©galement prendre un message d&#39;erreur comme seul argument, qui est enregistr√© dans le journal des transactions.</p>
</div>
<div class="paragraph data-line-622">
<p>Certaines conditions d&#39;un contrat g√©n√©reront des erreurs, que nous les v√©rifiions explicitement ou non. Par exemple, dans notre contrat Faucet, nous ne v√©rifions pas s&#39;il y a suffisamment d&#39;√©ther pour satisfaire une demande de retrait. En effet, la fonction transfer √©chouera avec une erreur et annulera la transaction si le solde est insuffisant pour effectuer le transfert¬†:</p>
</div>
<div class="listingblock data-line-625">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-629">
<p>Cependant, il peut √™tre pr√©f√©rable de v√©rifier explicitement et de fournir un message d&#39;erreur clair en cas d&#39;√©chec. Nous pouvons le faire en ajoutant une instruction require avant le transfert¬†:</p>
</div>
<div class="listingblock data-line-632">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">require(this.balance &gt;= withdraw_amount,
&amp;quot;Solde insuffisant dans le robinet pour la demande de retrait&amp;quot;¬†);
msg.sender.transfer(withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-638">
<p>Un code de v√©rification d&#39;erreur suppl√©mentaire comme celui-ci augmentera l√©g√®rement la consommation de gaz, mais il offre un meilleur rapport d&#39;erreur que s&#39;il est omis. Vous devrez trouver le bon √©quilibre entre la consommation de gaz et la v√©rification d√©taill√©e des erreurs en fonction de l&#39;utilisation pr√©vue de votre contrat. Dans le cas d&#39;un contrat Faucet destin√© √† un testnet, nous pouvons probablement abuser du c√¥t√© des rapports suppl√©mentaires m√™me si cela co√ªte plus cher en gaz. Peut-√™tre que pour un contrat de r√©seau principal, nous choisirons plut√¥t d&#39;√™tre √©conomes avec notre consommation de gaz.</p>
</div>
</div>
<div class="sect3 data-line-641">
<h4 id="solidity_events">√âv√©nements</h4>
<div class="paragraph data-line-643">
<p>Lorsque une transaction se termine (avec succ√®s ou non), elle produit une <em>r√©ception de transaction</em>, comme nous le verrons dans <a href="#evm_chapter">La machine virtuelle Ethereum</a>. Le re√ßu de transaction contient des entr√©es <em>log</em> qui fournissent des informations sur les actions qui se sont produites lors de l&#39;ex√©cution de la transaction. Les <em>√âv√©nements</em> ou <em>Events</em> sont les objets de haut niveau de Solidity utilis√©s pour construire ces journaux.</p>
</div>
<div class="paragraph data-line-645">
<p>Les √©v√©nements sont particuli√®rement utiles pour les clients l√©gers et les services DApp, qui peuvent &quot;surveiller&quot; des √©v√©nements sp√©cifiques et les signaler √† l&#39;interface utilisateur, ou modifier l&#39;√©tat de l&#39;application pour refl√©ter un √©v√©nement dans un contrat sous-jacent.</p>
</div>
<div class="paragraph data-line-647">
<p>Les objets d&#39;√©v√©nement prennent des arguments qui sont s√©rialis√©s et enregistr√©s dans les journaux de transactions, dans la cha√Æne de blocs. Vous pouvez fournir le mot-cl√© index√© avant un argument, pour que la valeur fasse partie d&#39;une table index√©e (table de hachage) qui peut √™tre recherch√©e ou filtr√©e par une application.</p>
</div>
<div class="paragraph data-line-649">
<p>Nous n&#39;avons ajout√© aucun √©v√©nement dans notre exemple Faucet jusqu&#39;√† pr√©sent, alors faisons cela. Nous ajouterons deux √©v√©nements, un pour enregistrer les retraits et un pour enregistrer les d√©p√¥ts. Nous appellerons ces √©v√©nements Withdrawal et Deposit, respectivement. Tout d&#39;abord, nous d√©finissons les √©v√©nements dans le contrat Faucet¬†:</p>
</div>
<div class="listingblock data-line-652">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Faucet is mortal {
	event Withdrawal(address indexed to, uint amount);
	event Deposit(address indexed from, uint amount);

	[...]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-661">
<p>Nous avons choisi de rendre les adresses indexed, pour permettre la recherche et le filtrage dans n&#39;importe quelle interface utilisateur con√ßue pour acc√©der √† notre Faucet.</p>
</div>
<div class="paragraph data-line-663">
<p>Ensuite, nous utilisons le mot-cl√© emit pour incorporer les donn√©es d&#39;√©v√©nement dans les journaux de transactions¬†:</p>
</div>
<div class="listingblock data-line-666">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Donnez de l&amp;#39;√©ther √† quiconque demande
function withdraw(uint withdraw_amount) public {
    [...]
    msg.sender.transfer(withdraw_amount);
    emit Withdrawal(msg.sender, withdraw_amount);
}
// Accepte tout montant entrant
function () external payable {
    emit Deposit(msg.sender, msg.value);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-679">
<p>Le contrat <em>Faucet.sol</em> r√©sultant ressemble √† <a href="#Faucet8_sol">Faucet8.sol¬†: contrat de robinet r√©vis√©, avec √©v√©nements</a>.</p>
</div>
<div id="Faucet8_sol" class="exampleblock data-line-683">
<div class="title">Example 4. Faucet8.sol¬†: contrat de robinet r√©vis√©, avec √©v√©nements</div>
<div class="content">
<div class="listingblock data-line-685">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// SPDX-License-Identifier: CC-BY-SA-4.0

// Version of Solidity compiler this program was written for
pragma solidity ^0.6.4;

contract Owned {
    address payable owner;

    // Contract constructor: set owner
    constructor() public {
        owner = msg.sender;
    }

    // Access control modifier
    modifier onlyOwner {
        require(msg.sender == owner, "Only the contract owner can call this function");
        _;
    }
}

contract Mortal is Owned {
    // Contract destructor
    function destroy() public onlyOwner {
        selfdestruct(owner);
    }
}

contract Faucet is Mortal {
    event Withdrawal(address indexed to, uint amount);
    event Deposit(address indexed from, uint amount);

    // Accept any incoming amount
    receive() external payable {
        emit Deposit(msg.sender, msg.value);
    }

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 0.1 ether);

        require(
            address(this).balance &gt;= withdraw_amount,
            "Insufficient balance in faucet for withdrawal request"
        );

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);

        emit Withdrawal(msg.sender, withdraw_amount);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4 data-line-690">
<h5 id="_attraper_des_√©v√©nements">Attraper des √©v√©nements</h5>
<div class="paragraph data-line-692">
<p>OK, nous avons donc configur√© notre contrat pour √©mettre des √©v√©nements. Comment voir les r√©sultats d&#39;une transaction et &quot;attraper&quot; les √©v√©nements¬†? La biblioth√®que web3.js fournit une structure de donn√©es qui contient les journaux d&#39;une transaction. Dans ceux-ci, nous pouvons voir les √©v√©nements g√©n√©r√©s par la transaction.</p>
</div>
<div class="paragraph data-line-694">
<p>Utilisons truffle pour ex√©cuter une transaction de test sur le contrat Faucet r√©vis√©. Suivez les instructions dans <a href="#truffle">Truffle</a> pour configurer un r√©pertoire de projet et compiler le code <span class="keep-together"><code>Faucet</code></span>. Le code source peut √™tre trouv√© dans <a href="https://github.com/ethereumbook/ethereumbook" data-href="https://github.com/ethereumbook/ethereumbook">le r√©f√©rentiel GitHub du livre</a> sous <em>code/truffle/FaucetEvents</em>.</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle develop</strong>
truffle(develop)> <strong>compile</strong>
truffle(develop)> <strong>migrate</strong>
Using network 'develop'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb77ceae7c3f5afb7fbe3a6c5974d352aa844f53f955ee7d707ef6f3f8e6b4e61
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Faucet...
  ... 0xfa850d754314c3fb83f43ca1fa6ee20bc9652d891c00a2f63fd43ab5bfb0d781
  Faucet: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

truffle(develop)> <strong>Faucet.deployed().then(i => {FaucetDeployed = i})</strong>
truffle(develop)> <strong>FaucetDeployed.send(web3.utils.toWei(1, "ether")).then(res => \
                  { console.log(res.logs[0].event, res.logs[0].args) })</strong>
Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }
truffle(develop)> <strong>FaucetDeployed.withdraw(web3.utils.toWei(0.1, "ether")).then(res => \
                  { console.log(res.logs[0].event, res.logs[0].args) })</strong>
Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }

</pre>
<div class="paragraph data-line-731">
<p>Apr√®s avoir d√©ploy√© le contrat √† l&#39;aide de la fonction deployed, nous ex√©cutons deux transactions. La premi√®re transaction est un d√©p√¥t (en utilisant send), qui √©met un √©v√©nement Deposit dans les journaux de transactions¬†:</p>
</div>
<div class="listingblock data-line-733">
<div class="content">
<pre>Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }</pre>
</div>
</div>
<div class="paragraph data-line-738">
<p>Ensuite, nous utilisons la fonction withdraw pour effectuer un retrait. Cela √©met un √©v√©nement Withdrawal¬†:</p>
</div>
<div class="listingblock data-line-740">
<div class="content">
<pre>Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }</pre>
</div>
</div>
<div class="paragraph data-line-745">
<p>Pour obtenir ces √©v√©nements, nous avons examin√© le tableau logs renvoy√© comme r√©sultat (res) des transactions. La premi√®re entr√©e de journal (logs[0]) contient un nom d&#39;√©v√©nement dans logs[0].event et les arguments d&#39;√©v√©nement dans logs[0].args. En les affichant sur la console, nous pouvons voir le nom de l&#39;√©v√©nement √©mis et les arguments de l&#39;√©v√©nement.</p>
</div>
<div class="paragraph data-line-747">
<p>Les √©v√©nements sont un m√©canisme tr√®s utile, non seulement pour la communication intra-contrat, mais aussi pour le d√©bogage pendant le d√©veloppement.</p>
</div>
</div>
</div>
<div class="sect3 data-line-749">
<h4 id="_appel_dautres_contrats_send_call_callcode_delegatecall">Appel d&#39;autres contrats (send, call, callcode, delegatecall)</h4>
<div class="paragraph data-line-751">
<p>Appeler d&#39;autres contrats depuis votre contrat est une op√©ration tr√®s utile mais potentiellement dangereuse. Nous examinerons les diff√©rentes fa√ßons d&#39;y parvenir et √©valuerons les risques de chaque m√©thode. En bref, les risques d√©coulent du fait que vous ne savez peut-√™tre pas grand-chose sur un contrat auquel vous faites appel ou qui fait appel √† votre contrat. Lors de la r√©daction de contrats intelligents, vous devez garder √† l&#39;esprit que m√™me si vous vous attendez principalement √† traiter avec des EOA, rien n&#39;emp√™che des contrats arbitrairement complexes et peut-√™tre malveillants d&#39;appeler et d&#39;√™tre appel√©s par votre code.</p>
</div>
<div class="sect4 data-line-753">
<h5 id="_cr√©ation_dune_nouvelle_instance">Cr√©ation d&#39;une nouvelle instance</h5>
<div class="paragraph data-line-755">
<p>Le moyen le plus s√ªr d&#39;appeler un autre contrat est de cr√©er vous-m√™me cet autre contrat. De cette fa√ßon, vous √™tes certain de ses interfaces et de son comportement. Pour ce faire, vous pouvez simplement l&#39;instancier, en utilisant le mot-cl√© new, comme dans d&#39;autres langages orient√©s objet. Dans Solidity, le mot-cl√© new cr√©era le contrat sur la cha√Æne de blocs et renverra un objet que vous pourrez utiliser pour le r√©f√©rencer. Supposons que vous souhaitiez cr√©er et appeler un contrat Faucet √† partir d&#39;un autre contrat appel√© Token¬†:</p>
</div>
<div class="listingblock pagebreak-before data-line-759">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-769">
<p>Ce m√©canisme de construction de contrat garantit que vous connaissez le type exact du contrat et son interface. Le contrat Faucet doit √™tre d√©fini dans la port√©e de Token, ce que vous pouvez faire avec une instruction import si la d√©finition se trouve dans un autre fichier¬†:</p>
</div>
<div class="listingblock data-line-772">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-784">
<p>Vous pouvez √©ventuellement sp√©cifier la value du transfert d&#39;ether lors de la cr√©ation et passer des arguments au constructeur du nouveau contrat¬†:</p>
</div>
<div class="listingblock data-line-787">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-799">
<p>Vous pouvez √©galement appeler ensuite les fonctions Faucet. Dans cet exemple, nous appelons la fonction destroy de Faucet depuis la fonction destroy de Token¬†:</p>
</div>
<div class="listingblock data-line-802">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}

	function destroy() ownerOnly {
		_faucet.destroy();
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-818">
<p>Notez que tant que vous √™tes le propri√©taire du contrat Token, le contrat Token lui-m√™me poss√®de le nouveau contrat Faucet, donc seul le contrat Token peut le d√©truire.</p>
</div>
</div>
<div class="sect4 data-line-820">
<h5 id="_adressage_dune_instance_existante">Adressage d&#39;une instance existante</h5>
<div class="paragraph data-line-822">
<p>Une autre fa√ßon d&#39;appeler un contrat consiste √† convertir l&#39;adresse d&#39;une instance existante du contrat. Avec cette m√©thode, vous appliquez une interface connue √† une instance existante. Il est donc extr√™mement important que vous sachiez avec certitude que l&#39;instance √† laquelle vous vous adressez est en fait du type que vous supposez. Regardons un exemple¬†:</p>
</div>
<div class="listingblock data-line-825">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Faucet.sol";

contract Token is mortal {

	Faucet _faucet;

	constructor(address _f) {
		_faucet = Faucet(_f);
		_faucet.withdraw(0.1 ether)
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-839">
<p>Ici, nous prenons une adresse fournie comme argument au constructeur, _f, et nous la transformons en un objet Faucet. C&#39;est beaucoup plus risqu√© que le m√©canisme pr√©c√©dent, car nous ne savons pas avec certitude si cette adresse est r√©ellement un objet Faucet. Lorsque nous appelons withdraw, nous supposons qu&#39;il accepte les m√™mes arguments et ex√©cute le m√™me code que notre d√©claration Faucet, mais nous ne pouvons pas en √™tre s√ªrs. Pour autant que nous sachions, la fonction withdraw √† cette adresse pourrait ex√©cuter quelque chose de compl√®tement diff√©rent de ce que nous attendons, m√™me si elle porte le m√™me nom. Utiliser des adresses pass√©es en entr√©e et les int√©grer dans des objets sp√©cifiques est donc beaucoup plus dangereux que de cr√©er soi-m√™me le contrat.</p>
</div>
</div>
<div class="sect4 data-line-841">
<h5 id="_appel_brut_call_et_delegatecall">Appel brut call et delegatecall</h5>
<div class="paragraph data-line-843">
<p>Solidity propose des fonctions encore plus &quot;de bas niveau&quot; pour appeler d&#39;autres contrats. Ceux-ci correspondent directement aux opcodes EVM du m√™me nom et nous permettent de construire manuellement un appel de contrat √† contrat. En tant que tels, ils repr√©sentent les m√©canismes les plus flexibles <em>et</em> les plus dangereux pour appeler d&#39;autres contrats.</p>
</div>
<div class="paragraph data-line-845">
<p>Voici le m√™me exemple, en utilisant une m√©thode call¬†:</p>
</div>
<div class="listingblock data-line-848">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	constructor(address _faucet) {
		_faucet.call("withdraw", 0.1 ether);
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-856">
<p>Comme vous pouvez le voir, ce type de call est un appel <em>aveugle</em> dans une fonction, un peu comme la construction d&#39;une transaction brute, uniquement √† partir du contexte d&#39;un contrat. Cela peut exposer votre contrat √† un certain nombre de risques de s√©curit√©, le plus important √©tant la <em>r√©entrance</em>, dont nous discuterons plus en d√©tail dans <a href="#reentrancy_security">R√©entrance</a>. La fonction call renverra false s&#39;il y a un probl√®me, vous pouvez donc √©valuer la valeur de retour pour la gestion des erreurs¬†:</p>
</div>
<div class="listingblock data-line-859">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Token is mortal {
	constructor(address _faucet) {
		if !(_faucet.call("withdraw", 0.1 ether)) {
			revert("Withdrawal from faucet failed");
		}
	}
}</code></pre>
</div>
</div>
<div class="paragraph data-line-869">
<p>Une autre variante de call est delegatecall, qui a remplac√© le plus dangereux callcode. La m√©thode <code><span class="keep-together">callcode</span></code> sera bient√¥t obsol√®te, elle ne doit donc pas √™tre utilis√©e.</p>
</div>
<div class="paragraph data-line-871">
<p>Comme mentionn√© dans <a href="#solidity_address_object">objet d&#39;adresse</a>, un delegatecall est diff√©rent d&#39;un call en ce que le contexte msg ne change pas. Par exemple, alors qu&#39;un call change la valeur de msg.sender pour √™tre le contrat d&#39;appel, un delegatecall conserve le m√™me msg.sender que dans le contrat d&#39;appel. Essentiellement, delegatecall ex√©cute le code d&#39;un autre contrat dans le contexte de l&#39;ex√©cution du contrat en cours. Il est le plus souvent utilis√© pour invoquer du code √† partir d&#39;une biblioth√®que. Cela vous permet √©galement de dessiner sur le mod√®le d&#39;utilisation des fonctions de biblioth√®que stock√©es ailleurs, mais de faire fonctionner ce code avec les donn√©es de stockage de votre contrat.</p>
</div>
<div class="paragraph data-line-873">
<p>L&#39;appel delegatecall doit √™tre utilis√© avec beaucoup de prudence. Cela peut avoir des effets inattendus, surtout si le contrat que vous appelez n&#39;a pas √©t√© con√ßu comme une biblioth√®que.</p>
</div>
<div class="paragraph data-line-875">
<p>Utilisons un exemple de contrat pour d√©montrer les diff√©rentes s√©mantiques d&#39;appel utilis√©es par call et delegatecall pour appeler des biblioth√®ques et des contrats. Dans <a href="#call_examples_code">CallExamples.sol¬†: un exemple de diff√©rentes s√©mantiques d&#39;appel</a>, nous utilisons un √©v√©nement pour enregistrer les d√©tails de chaque appel et voir comment le contexte d&#39;appel change en fonction du type d&#39;appel.</p>
</div>
<div id="call_examples_code" class="exampleblock data-line-879">
<div class="title">Example 5. CallExamples.sol¬†: un exemple de diff√©rentes s√©mantiques d&#39;appel</div>
<div class="content">
<div class="listingblock data-line-881">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.22;

contract calledContract {
    event callEvent(address sender, address origin, address from);
    function calledFunction() public {
        emit callEvent(msg.sender, tx.origin, this);
    }
}

library calledLibrary {
    event callEvent(address sender, address origin,  address from);
    function calledFunction() public {
        emit callEvent(msg.sender, tx.origin, this);
    }
}

contract caller {

    function make_calls(calledContract _calledContract) public {

    // Calling calledContract and calledLibrary directly
    _calledContract.calledFunction();
    calledLibrary.calledFunction();

    // Low-level calls using the address object for calledContract
    require(address(_calledContract).
            call(bytes4(keccak256("calledFunction()"))));
    require(address(_calledContract).
            delegatecall(bytes4(keccak256("calledFunction()"))));



	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-886">
<p>Comme vous pouvez le voir dans cet exemple, notre contrat principal est caller, qui appelle une biblioth√®que calledLibrary et un contrat calledContract. La biblioth√®que appel√©e et le contrat ont des fonctions calledFunction identiques, qui √©mettent un √©v√©nement calledEvent. L&#39;√©v√©nement calledEvent enregistre trois √©l√©ments de donn√©es¬†: msg.sender, tx.origin et this. Chaque fois que calledFunction est appel√©, il peut avoir un contexte d&#39;ex√©cution diff√©rent (avec des valeurs diff√©rentes pour potentiellement toutes les variables de contexte), selon qu&#39;il est appel√© directement ou via delegatecall.</p>
</div>
<div class="paragraph data-line-888">
<p>Dans caller, nous appelons d&#39;abord le contrat et la biblioth√®que directement, en invoquant calledFunction dans chacun. Ensuite, nous utilisons explicitement les fonctions de bas niveau call et delegatecall pour appeler calledContract.calledFunction. De cette fa√ßon, nous pouvons voir comment les diff√©rents m√©canismes d&#39;appel se comportent.</p>
</div>
<div class="paragraph data-line-890">
<p>Ex√©cutons ceci dans un environnement de d√©veloppement Truffle et capturons les √©v√©nements, pour voir √† quoi cela ressemble¬†:</p>
</div>
<pre data-type="programlisting">
truffle(develop)> <strong>migrate</strong>
Using network 'develop'.
[...]
Saving artifacts...
truffle(develop)> <strong>web3.eth.accounts[0]</strong>
'0x627306090abab3a6e1400e9345bc60c78a8bef57'
truffle(develop)> <strong>caller.address</strong>
'0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'
truffle(develop)> <strong>calledContract.address</strong>
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'
truffle(develop)> <strong>calledLibrary.address</strong>
'0xf25186b5081ff5ce73482ad761db0eb0d25abfbf'
truffle(develop)> <strong>caller.deployed().then( i => { callerDeployed = i })</strong>

truffle(develop)> <strong>callerDeployed.make_calls(calledContract.address).then(res => \
                  { res.logs.forEach( log => { console.log(log.args) })})</strong>
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }

</pre>
<div class="paragraph data-line-926">
<p>Voyons ce qui s&#39;est pass√© ici. Nous avons appel√© la fonction make_calls et pass√© l&#39;adresse de calledContract, puis avons intercept√© les quatre √©v√©nements √©mis par chacun des diff√©rents appels. Examinons la fonction make_calls et passons en revue chaque √©tape.</p>
</div>
<div class="paragraph data-line-928">
<p>Le premier appel est :</p>
</div>
<div class="listingblock data-line-930">
<div class="content">
<pre>_calledContract.calledFunction();</pre>
</div>
</div>
<div class="paragraph data-line-934">
<p>Ici, nous appelons calledContract.calledFunction directement, en utilisant l&#39;ABI de haut niveau pour calledFunction. L&#39;√©v√©nement √©mis est :</p>
</div>
<div class="listingblock data-line-936">
<div class="content">
<pre>sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10'</pre>
</div>
</div>
<div class="paragraph data-line-942">
<p>Comme vous pouvez le voir, msg.sender est l&#39;adresse du contrat caller. Le tx.origin est l&#39;adresse de notre compte, web3.eth.accounts[0], qui a envoy√© la transaction √† caller. L&#39;√©v√©nement a √©t√© √©mis par calledContract, comme nous pouvons le voir sur le dernier argument de l&#39;√©v√©nement.</p>
</div>
<div class="paragraph data-line-944">
<p>Le prochain appel dans make_calls est vers la biblioth√®que¬†:</p>
</div>
<div class="listingblock data-line-946">
<div class="content">
<pre>calledLibrary.calledFunction();</pre>
</div>
</div>
<div class="paragraph data-line-950">
<p>Il semble identique √† la fa√ßon dont nous avons appel√© le contrat, mais se comporte tr√®s diff√©remment. Regardons le second √©v√©nement √©mis :</p>
</div>
<div class="listingblock data-line-952">
<div class="content">
<pre>sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'</pre>
</div>
</div>
<div class="paragraph data-line-958">
<p>Cette fois, le msg.sender n&#39;est pas l&#39;adresse de caller. Au lieu de cela, c&#39;est l&#39;adresse de notre compte, et c&#39;est la m√™me que l&#39;origine de la transaction. En effet, lorsque vous appelez une biblioth√®que, l&#39;appel est toujours delegatecall et s&#39;ex√©cute dans le contexte de l&#39;appelant. Ainsi, lorsque le code calledLibrary s&#39;ex√©cutait, il h√©ritait du contexte d&#39;ex√©cution de caller, comme si son code s&#39;ex√©cutait √† l&#39;int√©rieur de caller. La variable this (affich√©e comme from dans l&#39;√©v√©nement √©mis) est l&#39;adresse de caller, m√™me si elle est accessible depuis <span class="keep-together"><code>calledLibrary</code></span>.</p>
</div>
<div class="paragraph data-line-960">
<p>Les deux appels suivants, utilisant les appels call et delegatecall de bas niveau, v√©rifient nos attentes, √©mettant des √©v√©nements qui refl√®tent ce que nous venons de faire</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-963">
<h3 id="gas_sec">Consid√©rations sur le gaz</h3>
<div class="paragraph data-line-965">
<p>Le gaz, d√©crit dans plus de d√©tails dans <a href="#gas">Gas</a>, est une consid√©ration extr√™mement importante dans la programmation de contrats intelligents. Le gaz est une ressource limitant la quantit√© maximale de calculs qu&#39;Ethereum permettra √† une transaction de consommer. Si la limite de gaz est d√©pass√©e pendant le calcul, la s√©rie d&#39;√©v√©nements suivante se produit¬†:</p>
</div>
<div class="ulist data-line-967">
<ul>
<li class="data-line-967">
<p>Une exception &quot;out of gas&quot; est lev√©e.</p>
</li>
<li class="data-line-968">
<p>L&#39;√©tat du contrat avant l&#39;ex√©cution est restaur√© (invers√©).</p>
</li>
<li class="data-line-969">
<p>Tout l&#39;√©ther utilis√© pour payer le gaz est consid√©r√© comme des frais de transaction¬†; il n&#39;est <em>pas</em> rembours√©.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-971">
<p>√âtant donn√© que le gaz est pay√© par l&#39;utilisateur qui initie la transaction, les utilisateurs sont d√©courag√©s d&#39;appeler des fonctions qui ont un co√ªt de gaz √©lev√©. Il est donc dans l&#39;int√©r√™t du programmeur de minimiser le co√ªt en gaz des fonctions d&#39;un contrat. √Ä cette fin, certaines pratiques sont recommand√©es lors de la construction de contrats intelligents, afin de minimiser le co√ªt en gaz d&#39;un appel de fonction.</p>
</div>
<div class="sect3 data-line-973">
<h4 id="_√©vitez_les_tableaux_dimensionn√©s_dynamiquement">√âvitez les tableaux dimensionn√©s dynamiquement</h4>
<div class="paragraph data-line-975">
<p>Toute boucle √† travers un tableau de taille dynamique o√π une fonction effectue des op√©rations sur chaque √©l√©ment ou recherche un √©l√©ment particulier introduit le risque d&#39;utiliser trop de gaz. En effet, le contrat peut s&#39;essouffler avant d&#39;avoir trouv√© le r√©sultat souhait√©, ou avant d&#39;agir sur chaque √©l√©ment, perdant ainsi du temps et de l&#39;√©ther sans donner le moindre r√©sultat.</p>
</div>
</div>
<div class="sect3 data-line-977">
<h4 id="_√©vitez_les_appels_vers_dautres_contrats">√âvitez les appels vers d&#39;autres contrats</h4>
<div class="paragraph data-line-979">
<p>Appeler d&#39;autres contrats, surtout lorsque le co√ªt en gaz de leurs fonctions n&#39;est pas connu, introduit le risque de manquer de gaz. √âvitez d&#39;utiliser des biblioth√®ques qui ne sont pas bien test√©es et largement utilis√©es. Moins une biblioth√®que a √©t√© examin√©e par d&#39;autres programmeurs, plus le risque de l&#39;utiliser est grand.</p>
</div>
</div>
<div class="sect3 data-line-981">
<h4 id="_estimation_du_co√ªt_du_gaz">Estimation du co√ªt du gaz</h4>
<div class="paragraph data-line-983">
<p>Si vous avez besoin d&#39;estimer le gaz n√©cessaire pour ex√©cuter une certaine m√©thode d&#39;un contrat en tenant compte ses arguments, vous pouvez utiliser la proc√©dure suivante¬†:</p>
</div>
<div class="listingblock data-line-986">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var contract = web3.eth.contract(abi).at(address);
var gasEstimate = contract.myAweSomeMethod.estimateGas(arg1, arg2,
    {from: account});</code></pre>
</div>
</div>
<div class="paragraph data-line-990">
<p>gasEstimate vous indiquera le nombre d&#39;unit√©s de gaz n√©cessaires √† son ex√©cution. Il s&#39;agit d&#39;une estimation en raison de l&#39;exhaustivit√© de Turing de l&#39;EVM - il est relativement trivial de cr√©er une fonction qui prendra des quantit√©s de gaz tr√®s diff√©rentes pour ex√©cuter diff√©rents appels. M√™me le code de production peut modifier les chemins d&#39;ex√©cution de mani√®re subtile, ce qui entra√Æne des co√ªts de gaz extr√™mement diff√©rents d&#39;un appel √† l&#39;autre. Cependant, la plupart des fonctions sont sensibles et estimateGas donnera une bonne estimation la plupart du temps.</p>
</div>
<div class="paragraph data-line-992">
<p>Pour obtenir le prix du gaz du r√©seau, vous pouvez utiliser :</p>
</div>
<div class="listingblock data-line-995">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var gasPrice = web3.eth.getGasPrice();</code></pre>
</div>
</div>
<div class="paragraph data-line-997">
<p>Et √† partir de l√†, vous pouvez estimer le co√ªt du gaz¬†:</p>
</div>
<div class="listingblock data-line-1000">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var gasCostInEther = web3.utils.fromWei((gasEstimate * gasPrice), 'ether');</code></pre>
</div>
</div>
<div class="paragraph data-line-1002">
<p>Appliquons nos fonctions d&#39;estimation de gaz pour estimer le co√ªt du gaz de notre exemple Faucet, en utilisant le code <a href="http://bit.ly/2zf0SIO" data-href="http://bit.ly/2zf0SIO">du r√©f√©rentiel du livre</a>.</p>
</div>
<div class="paragraph data-line-1004">
<p>D√©marrez Truffle en mode d√©veloppement et ex√©cutez le fichier JavaScript dans <a href="#estimateGas_function">gas_estimates.js¬†: Utilisation de la fonction estimateGas</a>, <em>gas_estimates.js</em>.</p>
</div>
<div id="estimateGas_function" class="exampleblock data-line-1009">
<div class="title">Example 6. gas_estimates.js¬†: Utilisation de la fonction estimateGas</div>
<div class="content">
<div class="listingblock data-line-1011">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var FaucetContract = artifacts.require("./Faucet.sol");

FaucetContract.web3.eth.getGasPrice(function(error, result) {
    var gasPrice = Number(result);
    console.log("Gas Price is " + gasPrice + " wei"); // "10000000000000"

// R√©cup√®re l&amp;#39;instance de contrat
    FaucetContract.deployed().then(function(FaucetContractInstance) {

// Utilisez le mot cl√© &amp;#39;estimateGas&amp;#39; apr√®s le nom de la fonction pour obtenir le gaz
// estimation pour cette fonction particuli√®re (aprove)
		FaucetContractInstance.send(web3.utils.toWei(1, "ether"));
        return FaucetContractInstance.withdraw.estimateGas(web3.utils.toWei(0.1, "ether"));

    }).then(function(result) {
        var gas = Number(result);

        console.log("gas estimation = " + gas + " units");
        console.log("gas cost estimation = " + (gas * gasPrice) + " wei");
        console.log("gas cost estimation = " +
                FaucetContract.web3.utils.fromWei((gas * gasPrice), 'ether') + " ether");
    });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1038">
<p>Voici √† quoi cela ressemble dans la console de d√©veloppement Truffle¬†:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle develop</strong>

truffle(develop)> <strong>exec gas_estimates.js</strong>
Using network 'develop'.

Gas Price is 20000000000 wei
gas estimation = 31397 units
gas cost estimation = 627940000000000 wei
gas cost estimation = 0.00062794 ether

</pre>
<div class="paragraph data-line-1055">
<p>Il est recommand√© d&#39;√©valuer le co√ªt en gaz des fonctions dans le cadre de votre workflow de d√©veloppement, afin d&#39;√©viter toute surprise lors du d√©ploiement de contrats sur le r√©seau principal.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1057">
<h3 id="_conclusion_4">Conclusion</h3>
<div class="paragraph data-line-17">
<p>Dans ce chapitre, nous avons commenc√© √† travailler en d√©tail avec les contrats intelligents et explor√© le langage de programmation de contrats Solidity. Nous avons pris un exemple de contrat simple, <em>Faucet.sol</em>, et l&#39;avons progressivement am√©lior√© et rendu plus complexe, en l&#39;utilisant pour explorer divers aspects du langage Solidity. Dans <a href="#vyper_chap">Contrats intelligents et Vyper</a> nous travaillerons avec Vyper, un autre langage de programmation orient√© contrat. Nous comparerons Vyper √† Solidity, montrant certaines des diff√©rences dans la conception de ces deux langages et approfondirons notre compr√©hension de la programmation de contrats intelligents.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="vyper_chap">Contrats intelligents et Vyper</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Vyper est un langage de programmation exp√©rimental orient√© contrat pour la machine virtuelle Ethereum qui s&#39;efforce de fournir une auditabilit√© sup√©rieure, en permettant aux d√©veloppeurs de produire plus facilement du code intelligible. En fait, l&#39;un des principes de Vyper est de rendre pratiquement impossible pour les d√©veloppeurs d&#39;√©crire du code trompeur.</p>
</div>
<div class="paragraph data-line-6">
<p>Dans ce chapitre, nous examinerons les probl√®mes courants li√©s aux contrats intelligents, pr√©senterons le langage de programmation de contrats Vyper et le comparerons √† Solidity, en d√©montrant les diff√©rences.</p>
</div>
<div class="sect2 data-line-8">
<h3 id="_vuln√©rabilit√©s_et_vyper">Vuln√©rabilit√©s et Vyper</h3>
<div class="paragraph data-line-10">
<p><a href="https://arxiv.org/pdf/1802.06038.pdf" data-href="https://arxiv.org/pdf/1802.06038.pdf">Une √©tude r√©cente</a>  a analys√© pr√®s d&#39;un million de contrats intelligents Ethereum d√©ploy√©s et a constat√© que nombre de ces contrats contenaient de graves vuln√©rabilit√©s. Au cours de leur analyse, les chercheurs ont d√©fini trois cat√©gories de base de vuln√©rabilit√©s en trace:</p>
</div>
<div class="dlist data-line-12">
<dl>
<dt class="hdlist1">Contrats suicidaires</dt>
<dd>
<p>Contrats intelligents qui peuvent √™tre tu√©s par des adresses arbitraires</p>
</dd>
<dt class="hdlist1">Contrats cupides</dt>
<dd>
<p>Contrats intelligents pouvant atteindre un √©tat dans lequel ils ne peuvent pas lib√©rer d&#39;ether</p>
</dd>
<dt class="hdlist1">Contrats prodigues</dt>
<dd>
<p>Contrats intelligents pouvant √™tre conclus pour lib√©rer de l&#39;ether √† des adresses arbitraires</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-18">
<p>Les vuln√©rabilit√©s sont introduites dans les contrats intelligents via le code. Il peut √™tre fortement soutenu que ces vuln√©rabilit√©s et d&#39;autres ne sont pas introduites intentionnellement, mais quoi qu&#39;il en soit, un code de contrat intelligent ind√©sirable entra√Æne √©videmment une perte de fonds inattendue pour les utilisateurs d&#39;Ethereum, et ce n&#39;est pas id√©al. Vyper est con√ßu pour faciliter l&#39;√©criture de code s√©curis√©, ou √©galement pour rendre plus difficile l&#39;√©criture accidentelle de code trompeur ou vuln√©rable.</p>
</div>
</div>
<div class="sect2 data-line-21">
<h3 id="comparison_to_solidity_sec">Comparaison avec Solidity</h3>
<div class="paragraph data-line-23">
<p>L&#39;une des fa√ßons dont Vyper essaie de rendre le code dangereux plus difficile √† √©crire est en <em>omettant</em> d√©lib√©r√©ment certaines fonctionnalit√©s de Solidity. Il est important pour ceux qui envisagent de d√©velopper des contrats intelligents dans Vyper de comprendre quelles fonctionnalit√©s Vyper n&#39;a <em>pas</em>, et pourquoi. Par cons√©quent, dans cette section, nous allons explorer ces fonctionnalit√©s et expliquer pourquoi elles ont √©t√© omises.</p>
</div>
<div class="sect3 data-line-25">
<h4 id="_modificateurs">Modificateurs</h4>
<div class="paragraph data-line-27">
<p>Comme nous l&#39;avons vu dans le chapitre pr√©c√©dent, dans Solidity vous pouvez √©crire une fonction √† l&#39;aide de modificateurs (modifiers). Par exemple, la fonction suivante, <code>changeOwner</code>, ex√©cutera le code dans un modificateur appel√© <code>onlyBy</code> dans le cadre de son ex√©cution¬†:</p>
</div>
<div class="listingblock data-line-30">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">function changeOwner(address _newOwner)
    public
    onlyBy(owner)
{
    owner = _newOwner;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-39">
<p>Ce modificateur applique une r√®gle relative √† la propri√©t√©. Comme vous pouvez le voir, ce modificateur particulier agit comme un m√©canisme pour effectuer une pr√©-v√©rification au nom de la fonction <code>changeOwner</code>¬†:</p>
</div>
<div class="listingblock data-line-42">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">modifier onlyBy(address _account)
{
    require(msg.sender == _account);
    _;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-50">
<p>Mais les modificateurs ne sont pas l√† uniquement pour effectuer des v√©rifications, comme illustr√© ici. En fait, en tant que modificateurs, ils peuvent modifier consid√©rablement l&#39;environnement d&#39;un contrat intelligent, dans le contexte de la fonction appelante. En termes simples, les modificateurs sont <em>omnipr√©sents</em>.</p>
</div>
<div class="paragraph data-line-52">
<p>Regardons un autre exemple de style Solidity¬†:</p>
</div>
<div class="listingblock data-line-55">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">enum Stages {
    SafeStage,
    DangerStage,
    FinalStage
}

uint public creationTime = now;
Stages public stage = Stages.SafeStage;

function nextStage() internal {
    stage = Stages(uint(stage) + 1);
}

modifier stageTimeConfirmation() {
    if (stage == Stages.SafeStage &amp;&amp;
                now &gt;= creationTime + 10 days)
        nextStage();
    _;
}

function a()
    public
    stageTimeConfirmation
// Plus de code va ici
{
}</code></pre>
</div>
</div>
<div class="paragraph data-line-84">
<p>D&#39;une part, les d√©veloppeurs doivent toujours v√©rifier tout autre code que leur propre code appelle. Cependant, il est possible que dans certaines situations (comme lorsque les contraintes de temps ou l&#39;√©puisement entra√Ænent un manque de concentration), un d√©veloppeur oublie une seule ligne de code. Cela est encore plus probable si le d√©veloppeur doit se d√©placer dans un fichier volumineux tout en gardant mentalement une trace de la hi√©rarchie des appels de fonction et en m√©morisant l&#39;√©tat des variables de contrat intelligent.</p>
</div>
<div class="paragraph data-line-86">
<p>Regardons l&#39;exemple pr√©c√©dent un peu plus en profondeur. Imaginez qu&#39;un d√©veloppeur √©crive une fonction publique appel√©e &quot;a&quot;. Le d√©veloppeur est nouveau dans ce contrat et utilise un modificateur √©crit par quelqu&#39;un d&#39;autre. En un coup d&#39;≈ìil, il semble que le modificateur <code>stageTimeConfirmation</code> effectue simplement quelques v√©rifications concernant l&#39;√¢ge du contrat par rapport √† la fonction appelante. Ce que le d√©veloppeur peut <em>ne pas</em> r√©aliser, c&#39;est que le modificateur appelle √©galement une autre fonction, <code>nextStage</code>. Dans ce sc√©nario de d√©monstration simpliste, le simple fait d&#39;appeler la fonction publique &quot;a&quot; entra√Æne le d√©placement de la variable &quot;stage&quot; du contrat intelligent de &quot;SafeStage&quot; √† &quot;DangerStage&quot;.</p>
</div>
<div class="paragraph data-line-88">
<p>Vyper a compl√®tement supprim√© les modificateurs. Les recommandations de Vyper sont les suivantes¬†: si vous n&#39;ex√©cutez que des assertions avec des modificateurs, utilisez simplement des v√©rifications et des assertions en ligne dans le cadre de la fonction¬†; si vous modifiez l&#39;√©tat du contrat intelligent, etc., int√©grez √† nouveau ces modifications explicitement √† la fonction. Cela am√©liore l&#39;auditabilit√© et la lisibilit√©, car le lecteur n&#39;a pas √† &quot;envelopper&quot; mentalement (ou manuellement) le code du modificateur autour de la fonction pour voir ce qu&#39;elle fait.</p>
</div>
</div>
<div class="sect3 data-line-90">
<h4 id="_h√©ritage_de_classe">H√©ritage de classe</h4>
<div class="paragraph data-line-92">
<p>L&#39;h√©ritage permet aux programmeurs pour exploiter la puissance du code pr√©-√©crit en acqu√©rant des fonctionnalit√©s, des propri√©t√©s et des comportements pr√©existants √† partir de biblioth√®ques de logiciels existantes. L&#39;h√©ritage est puissant et favorise la r√©utilisation du code. Solidity prend en charge l&#39;h√©ritage multiple ainsi que le polymorphisme, mais bien que ce soient des fonctionnalit√©s cl√©s de la programmation orient√©e objet, Vyper ne les prend pas en charge. Vyper soutient que la mise en ≈ìuvre de l&#39;h√©ritage n√©cessite que les codeurs et les auditeurs sautent entre plusieurs fichiers afin de comprendre ce que fait le programme. Vyper consid√®re √©galement que l&#39;h√©ritage multiple peut rendre le code trop compliqu√© √† comprendre - un point de vue tacitement admis par la <a href="http://bit.ly/2Q6Azvo" data-href="http://bit.ly/2Q6Azvo">documentation</a> Solidity, qui donne un exemple de la fa√ßon dont l&#39;h√©ritage multiple peut √™tre probl√©matique.</p>
</div>
</div>
<div class="sect3 data-line-94">
<h4 id="_assemblage_en_ligne">Assemblage en ligne</h4>
<div class="paragraph data-line-96">
<p>L&#39;assemblage en ligne donne aux d√©veloppeurs un acc√®s de bas niveau √† Ethereum Virtual Machine, permettant aux programmes Solidity d&#39;effectuer des op√©rations en acc√©dant directement aux instructions EVM. Par exemple, le code assembleur en ligne suivant ajoute 3 √† l&#39;emplacement m√©moire 0x80¬†:</p>
</div>
<div class="listingblock data-line-98">
<div class="content">
<pre>3 0x80 mload add 0x80 mstore</pre>
</div>
</div>
<div class="paragraph data-line-102">
<p>Vyper consid√®re que la perte de lisibilit√© est un prix trop √©lev√© √† payer pour la puissance suppl√©mentaire et ne prend donc pas en charge l&#39;assemblage en ligne.</p>
</div>
</div>
<div class="sect3 data-line-104">
<h4 id="_surcharge_de_fonction">Surcharge de fonction</h4>
<div class="paragraph data-line-106">
<p>La surcharge de fonction permet aux d√©veloppeurs d&#39;√©crire plusieurs fonctions du m√™me nom. La fonction utilis√©e √† une occasion donn√©e d√©pend des types d&#39;arguments fournis. Prenons par exemple les deux fonctions suivantes :</p>
</div>
<div class="listingblock data-line-109">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">function f(uint _in) public pure returns (uint out) {
    out = 1;
}

function f(uint _in, bytes32 _key) public pure returns (uint out) {
    out = 2;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-119">
<p>La premi√®re fonction (nomm√©e f) accepte un argument d&#39;entr√©e de type uint¬†; la deuxi√®me fonction (√©galement nomm√©e f) accepte deux arguments, un de type uint et un de type bytes32. Avoir plusieurs d√©finitions de fonction avec le m√™me nom prenant des arguments diff√©rents peut √™tre d√©routant, donc Vyper ne prend pas en charge la surcharge de fonction.</p>
</div>
</div>
<div class="sect3 data-line-121">
<h4 id="_conversion_de_type_variable">Conversion de type variable</h4>
<div class="paragraph data-line-123">
<p>Il existe deux types de typage : <em>implicit</em> et <em>explicit</em></p>
</div>
<div class="paragraph data-line-125">
<p>Le transtypage implicite est souvent effectu√© au moment de la compilation. Par exemple, si une conversion de type est s√©mantiquement correcte et qu&#39;aucune information n&#39;est susceptible d&#39;√™tre perdue, le compilateur peut effectuer une conversion implicite, telle que la conversion d&#39;une variable de type uint8 en uint16. Les premi√®res versions de Vyper autorisaient le transtypage implicite des variables, mais pas les versions r√©centes.</p>
</div>
<div class="paragraph data-line-127">
<p>Les transtypages explicites peuvent √™tre ins√©r√©s dans Solidity. Malheureusement, ils peuvent entra√Æner des comportements inattendus. Par exemple, convertir un uint32 en un type plus petit uint16 supprime simplement les bits d&#39;ordre sup√©rieur, comme illustr√© ici¬†:</p>
</div>
<div class="listingblock data-line-130">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">uint32 a = 0x12345678;
uint16 b = uint16(a);
// La variable b est 0x5678 maintenant</code></pre>
</div>
</div>
<div class="paragraph data-line-136">
<p>Vyper a √† la place une fonction convert pour effectuer des transtypages explicites. La fonction convert (trouv√©e √† la ligne 82 de <a href="http://bit.ly/2P36ZKT" data-href="http://bit.ly/2P36ZKT"><em>convert.py</em></a>)¬†:</p>
</div>
<div class="listingblock data-line-139">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def convert(expr, context):
    output_type = expr.args[1].s
    if output_type in conversion_table:
        return conversion_table[output_type](expr, context)
    else:
        raise Exception("Conversion to {} is invalid.".format(output_type))</code></pre>
</div>
</div>
<div class="paragraph data-line-148">
<p>Notez l&#39;utilisation de conversion_table (trouv√© √† la ligne 90 du m√™me fichier), qui ressemble √† ceci¬†:</p>
</div>
<div class="listingblock data-line-151">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">conversion_table = {
    'int128': to_int128,
    'uint256': to_unint256,
    'decimal': to_decimal,
    'bytes32': to_bytes32,
}</code></pre>
</div>
</div>
<div class="paragraph data-line-160">
<p>Lorsqu&#39;un d√©veloppeur appelle convert, il fait r√©f√©rence √† conversion_table, ce qui garantit que la conversion appropri√©e est effectu√©e. Par exemple, si un d√©veloppeur passe un int128 √† la fonction convert, la fonction to_int128 √† la ligne 26 du m√™me fichier (<em>convert.py</em>) sera ex√©cut√©e. La fonction to_int128 est la suivante¬†:</p>
</div>
<div class="listingblock data-line-163">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@signature(('int128', 'uint256', 'bytes32', 'bytes'), 'str_literal')
def to_int128(expr, args, kwargs, context):
    in_node = args[0]
    typ, len = get_type(in_node)
    if typ in ('int128', 'uint256', 'bytes32'):
        if in_node.typ.is_literal
            and not SizeLimits.MINNUM &lt;= in_node.value &lt;= SizeLimits.MAXNUM:
            raise InvalidLiteralException(
                "Number out of range: {}".format(in_node.value), expr
            )
        return LLLnode.from_list(
            ['clamp', ['mload', MemoryPositions.MINNUM], in_node,
            ['mload', MemoryPositions.MAXNUM]], typ=BaseType('int128'),
            pos=getpos(expr)
        )
    else:
        return byte_array_to_num(in_node, expr, 'int128')</code></pre>
</div>
</div>
<div class="paragraph data-line-183">
<p>Comme vous pouvez le constater, le processus de conversion garantit qu&#39;aucune information ne peut √™tre perdue. si c&#39;est possible, une exception est lev√©e. Le code de conversion emp√™che la troncation ainsi que d&#39;autres anomalies qui seraient normalement autoris√©es par un transtypage implicite.</p>
</div>
<div class="paragraph data-line-185">
<p>Choisir un transtypage explicite plut√¥t qu&#39;implicite signifie que le d√©veloppeur est responsable de l&#39;ex√©cution de tous les transtypages. Bien que cette approche produise un code plus d√©taill√©, elle am√©liore √©galement la s√©curit√© et la v√©rifiabilit√© des contrats intelligents.</p>
</div>
</div>
<div class="sect3 data-line-188">
<h4 id="_pr√©conditions_et_postconditions">Pr√©conditions et Postconditions</h4>
<div class="paragraph data-line-190">
<p>Vyper g√®re explicitement les pr√©conditions, les postconditions et les changements d&#39;√©tat. Bien que cela produise un code redondant, cela permet √©galement une lisibilit√© et une s√©curit√© maximales. Lors de la r√©daction d&#39;un contrat intelligent dans Vyper, un d√©veloppeur doit observer les trois points suivants¬†:</p>
</div>
<div class="dlist data-line-192">
<dl>
<dt class="hdlist1">Condition</dt>
<dd>
<p>Quel est l&#39;√©tat/condition actuel des variables d&#39;√©tat Ethereum¬†?</p>
</dd>
<dt class="hdlist1">Effets</dt>
<dd>
<p>Quels effets ce code de contrat intelligent aura-t-il sur la condition des variables d&#39;√©tat lors de l&#39;ex√©cution¬†? Autrement dit, qu&#39;est-ce qui sera affect√© et qu&#39;est-ce qui ne sera pas affect√©¬†? Ces effets sont-ils conformes aux intentions du contrat intelligent ?</p>
</dd>
<dt class="hdlist1">Interaction</dt>
<dd>
<p>Une fois que les deux premi√®res consid√©rations ont √©t√© trait√©es de mani√®re exhaustive, il est temps d&#39;ex√©cuter le code. Avant le d√©ploiement, parcourez logiquement le code et examinez tous les r√©sultats permanents possibles, les cons√©quences et les sc√©narios d&#39;ex√©cution du code, y compris les interactions avec d&#39;autres contrats.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-199">
<p>Id√©alement, chacun de ces points devrait √™tre soigneusement examin√© puis document√© de mani√®re approfondie dans le code. Cela am√©liorera la conception du code, le rendant finalement plus lisible et auditable.</p>
</div>
</div>
</div>
<div class="sect2 data-line-202">
<h3 id="decorators_sec">D√©corateurs</h3>
<div class="paragraph data-line-203">
<p>Les d√©corateurs suivants peuvent √™tre utilis√©s au d√©but de chaque fonction¬†:</p>
</div>
<div class="dlist data-line-205">
<dl>
<dt class="hdlist1">@private </dt>
<dd>
<p>Le d√©corateur <code>@private</code> rend la fonction inaccessible depuis l&#39;ext√©rieur du contrat.</p>
</dd>
<dt class="hdlist1">@public </dt>
<dd>
<p>Le d√©corateur <code>@public</code> rend la fonction √† la fois visible et ex√©cutable publiquement. Par exemple, m√™me le portefeuille Ethereum affichera de telles fonctions lors de la visualisation du contrat.</p>
</dd>
<dt class="hdlist1">@constant </dt>
<dd>
<p>Les fonctions avec le d√©corateur <code>@constant</code> ne sont pas autoris√©es √† modifier les variables d&#39;√©tat. En fait, le compilateur rejettera le programme entier (avec une erreur appropri√©e) si la fonction essaie de changer une variable d&#39;√©tat.</p>
</dd>
<dt class="hdlist1">@payable </dt>
<dd>
<p>Seules les fonctions avec le d√©corateur <code>@payable</code> sont autoris√©es √† transf√©rer de la valeur.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-213">
<p>Vyper impl√©mente explicitement <a href="http://bit.ly/2P14RDq" data-href="http://bit.ly/2P14RDq">la logique des d√©corateurs</a>. Par exemple, le processus de compilation de Vyper √©chouera si une fonction a √† la fois un d√©corateur <code>@payable</code> et un d√©corateur <code>@constant</code>. Cela a du sens car une fonction qui transf√®re une valeur a par d√©finition mis √† jour l&#39;√©tat, elle ne peut donc pas √™tre <code>@constant</code>. Chaque fonction Vyper doit √™tre d√©cor√©e avec <code>@public</code> ou <code>@private</code> (mais pas les deux¬†!).</p>
</div>
</div>
<div class="sect2 data-line-216">
<h3 id="order_of_functions_sec">Ordre des fonctions et des variables</h3>
<div class="paragraph data-line-218">
<p>Chaque contrat intelligent Vyper individuel se compose d&#39;un seul fichier Vyper uniquement. En d&#39;autres termes, tout le code d&#39;un contrat intelligent Vyper donn√©, y compris toutes les fonctions, variables, etc., existe au m√™me endroit. Vyper exige que la fonction et les d√©clarations de variables de chaque contrat intelligent soient √©crites physiquement dans un ordre particulier. Solidity n&#39;a pas du tout cette exigence. Jetons un coup d&#39;≈ìil √† un exemple Solidity¬†:</p>
</div>
<div class="listingblock data-line-221">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">pragma solidity ^0.4.0;

contract ordering {

    function topFunction()
    external
    returns (bool) {
        initiatizedBelowTopFunction = this.lowerFunction();
        return initiatizedBelowTopFunction;
    }

    bool initiatizedBelowTopFunction;
    bool lowerFunctionVar;

    function lowerFunction()
    external
    returns (bool) {
        lowerFunctionVar = true;
        return lowerFunctionVar;
    }

}</code></pre>
</div>
</div>
<div class="paragraph data-line-246">
<p>Dans cet exemple, la fonction appel√©e topFunction appelle une autre fonction, lowerFunction. topFunction attribue √©galement une valeur √† une variable appel√©e initiatizedBelowTopFunction. Comme vous pouvez le voir, Solidity n&#39;exige pas que ces fonctions et variables soient physiquement d√©clar√©es avant d&#39;√™tre appel√©es par le code d&#39;ex√©cution. Il s&#39;agit d&#39;un code Solidity valide qui se compilera avec succ√®s.</p>
</div>
<div class="paragraph data-line-248">
<p>Les exigences de commande de Vyper ne sont pas une nouveaut√© ; en fait, ces exigences de commande ont toujours √©t√© pr√©sentes dans la programmation Python. La commande requise par Vyper est simple et logique, comme illustr√© dans cet exemple suivant¬†:</p>
</div>
<div class="listingblock data-line-251">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># D√©clarez une variable appel√©e theBool
theBool: public(bool)

# D√©clarez une fonction appel√©e topFunction
@public
def topFunction() -&gt; bool:
# Attribuez une valeur √† la fonction d√©j√† d√©clar√©e appel√©e theBool
    self.theBool = True
    return self.theBool

# D√©clarez une fonction appel√©e lowerFunction
@public
def lowerFunction():
# Appelez la fonction d√©j√† d√©clar√©e appel√©e topFunction
    assert self.topFunction()</code></pre>
</div>
</div>
<div class="paragraph data-line-269">
<p>Cela montre le bon ordre des fonctions et des variables dans un contrat intelligent Vyper. Notez comment la variable theBool et la fonction topFunction sont d√©clar√©es avant qu&#39;elles ne re√ßoivent une valeur et ne soient appel√©es, respectivement. Si theBool √©tait d√©clar√© sous topFunction ou si topFunction √©tait d√©clar√© sous lowerFunction, ce contrat ne serait pas compil√©.</p>
</div>
</div>
<div class="sect2 data-line-272">
<h3 id="online_code_editor_and_compiler_sec">Compilation</h3>
<div class="paragraph data-line-273">
<p>Vyper a son propre <a href="https://vyper.online" data-href="https://vyper.online">√©diteur de code et compilateur en ligne</a>, qui vous permet d&#39;√©crire puis compilez vos contrats intelligents en bytecode, ABI et LLL en utilisant uniquement votre navigateur Web. Le compilateur en ligne Vyper propose une vari√©t√© de contrats intelligents pr√©-√©crits pour votre commodit√©, y compris des contrats pour une simple ench√®re ouverte, des achats √† distance s√©curis√©s, des jetons ERC20, etc. Cet outil, propose une seule version du logiciel de compilation. Il est mis √† jour r√©guli√®rement mais ne garantit pas toujours la derni√®re version. Etherscan a un <a href="https://etherscan.io/vyper" data-href="https://etherscan.io/vyper">compilateur Vyper en ligne</a> qui vous permet de s√©lectionner la version du compilateur. De plus, <a href="https://remix.ethereum.org" data-href="https://remix.ethereum.org">Remix</a>, con√ßu √† l&#39;origine pour les contrats intelligents Solidity, dispose d√©sormais d&#39;un plug-in Vyper disponible dans l&#39;onglet Param√®tres.</p>
</div>
<div class="admonitionblock note data-line-276">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-277">
<p>Vyper impl√©mente ERC20 en tant que contrat pr√©compil√©, ce qui permet d&#39;utiliser facilement ces contrats intelligents pr√™ts √† l&#39;emploi. Les contrats dans Vyper doivent √™tre d√©clar√©s en tant que variables globales. Un exemple de d√©claration de la variable ERC20 est le suivant :</p>
</div>
<div class="listingblock data-line-280">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">token: address(ERC20)</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-285">
<p>Vous pouvez √©galement compiler un contrat √† l&#39;aide de la ligne de commande. Chaque contrat Vyper est enregistr√© dans un seul fichier avec l&#39;extension <em>.vy</em>.
Une fois install√©, vous pouvez compiler un contrat avec Vyper en ex√©cutant la commande suivante¬†:</p>
</div>
<div class="listingblock data-line-288">
<div class="content">
<pre>vyper ~/hello_world.vy</pre>
</div>
</div>
<div class="paragraph data-line-292">
<p>La description ABI lisible par l&#39;homme (au format JSON) peut ensuite √™tre obtenue en ex√©cutant la commande suivante¬†:</p>
</div>
<div class="listingblock data-line-294">
<div class="content">
<pre>vyper -f json ~/hello_world.v.py</pre>
</div>
</div>
</div>
<div class="sect2 data-line-299">
<h3 id="protecting_against_overflows_sec">Protection contre les erreurs de d√©bordement au niveau du compilateur</h3>
<div class="paragraph data-line-301">
<p>Les erreurs de d√©bordement dans le logiciel peut √™tre catastrophique lorsqu&#39;il s&#39;agit de valeur r√©elle. Par exemple, une <a href="http://bit.ly/2yHfvoF" data-href="http://bit.ly/2yHfvoF">transaction de la mi-avril 2018</a> montre le <span class="keep-together">transfert malveillant de plus de 57¬†896¬†044¬†618¬†658¬†100¬†000¬†000¬†000¬†000¬†000¬†000¬†000¬†000,</span>000¬†000¬†000¬†000¬†000¬†000¬†tokens ou jetons BEC. Cette transaction √©tait le r√©sultat d&#39;un probl√®me de d√©bordement d&#39;entier dans le contrat de jeton ERC20 de BeautyChain (<em>BecToken.sol</em>). Les d√©veloppeurs de Solidity ont acc√®s √† des biblioth√®ques comme <a href="http://bit.ly/2ABhb4l" data-href="http://bit.ly/2ABhb4l">SafeMath</a> ainsi qu&#39;√† des outils d&#39;analyse de la s√©curit√© des contrats intelligents Ethereum comme <a href="http://bit.ly/2CQRoGU" data-href="http://bit.ly/2CQRoGU">Mythril OSS</a>. Cependant, les d√©veloppeurs ne sont pas oblig√©s d&#39;utiliser les outils de s√©curit√©. En termes simples, si la s√©curit√© n&#39;est pas appliqu√©e par le langage, les d√©veloppeurs peuvent √©crire du code non s√©curis√© qui se compilera avec succ√®s et s&#39;ex√©cutera plus tard &quot;avec succ√®s&quot;.</p>
</div>
<div class="paragraph data-line-303">
<p>Vyper dispose d&#39;une protection int√©gr√©e contre les d√©bordements, mise en ≈ìuvre selon une approche √† deux volets. Tout d&#39;abord, Vyper fournit <a href="http://bit.ly/2PuDfpB" data-href="http://bit.ly/2PuDfpB">un SafeMath √©quivalent</a> qui inclut les cas d&#39;exception n√©cessaires pour l&#39;arithm√©tique enti√®re. Deuxi√®mement, Vyper utilise des pinces chaque fois qu&#39;une constante litt√©rale est charg√©e, qu&#39;une valeur est transmise √† une fonction ou qu&#39;une variable est affect√©e. Les pinces sont impl√©ment√©es via des fonctions personnalis√©es dans le compilateur LLL (Low-level Lisp-like Language) et ne peuvent pas √™tre d√©sactiv√©es. (Le compilateur Vyper g√©n√®re LLL plut√¥t que le bytecode EVM¬†; cela simplifie le d√©veloppement de Vyper lui-m√™me.)</p>
</div>
</div>
<div class="sect2 data-line-307">
<h3 id="reading_and_writing_data_sec">Lecture et √©criture de donn√©es</h3>
<div class="paragraph data-line-308">
<p>Bien qu&#39;il soit co√ªteux de stocker, lire et modifier des donn√©es, ces op√©rations de stockage sont une composante n√©cessaire de la plupart des contrats intelligents. Les contrats intelligents peuvent √©crire des donn√©es √† deux endroits¬†:</p>
</div>
<div class="dlist data-line-310">
<dl>
<dt class="hdlist1">√âtat global</dt>
<dd>
<p> Les variables d&#39;√©tat d&#39;un contrat intelligent donn√© sont stock√©es dans le trie d&#39;√©tat global d&#39;Ethereum¬†; un contrat intelligent ne peut stocker, lire et modifier que des donn√©es relatives √† l&#39;adresse de ce contrat particulier (c&#39;est-√†-dire que les contrats intelligents ne peuvent pas lire ou √©crire dans d&#39;autres contrats intelligents).</p>
</dd>
<dt class="hdlist1">Journaux</dt>
<dd>
<p>Un contrat intelligent peut √©galement √©crire dans les donn√©es de la cha√Æne d&#39;Ethereum via des √©v√©nements de journal. Alors que Vyper utilisait initialement la syntaxe <code>__log__</code> pour d√©clarer ces √©v√©nements, une mise √† jour a √©t√© effectu√©e pour aligner davantage sa d√©claration d&#39;√©v√©nement sur la syntaxe d&#39;origine de Solidity. Par exemple, la d√©claration par Vyper d&#39;un √©v√©nement appel√© <code>MyLog</code> √©tait √† l&#39;origine <code>MyLog: __log__({arg1: indexed(bytes[3])})</code>. La syntaxe est maintenant devenue <code>MyLog: event({arg1: indexed(bytes[3])})</code>. Il est important de noter que l&#39;ex√©cution de l&#39;√©v√©nement de journalisation dans Vyper √©tait, et est toujours, comme suit¬†: <code>log.MyLog(&quot;123&quot;)</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-314">
<p>Bien que les contrats intelligents puissent √©crire dans les donn√©es de la cha√Æne d&#39;Ethereum (via des √©v√©nements de journal), ils ne peuvent pas lire les √©v√©nements de journal en cha√Æne qu&#39;ils ont cr√©√©s. N√©anmoins, l&#39;un des avantages de l&#39;√©criture dans les donn√©es de la cha√Æne d&#39;Ethereum via des √©v√©nements de journal est que les journaux peuvent √™tre d√©couverts et lus, sur la cha√Æne publique, par des clients l√©gers. Par exemple, la valeur logsBloom dans un bloc extrait peut indiquer si un √©v√©nement de journal est pr√©sent ou non. Une fois que l&#39;existence d&#39;√©v√©nements de journal a √©t√© √©tablie, les donn√©es de journal peuvent √™tre obtenues √† partir d&#39;un re√ßu de transaction donn√©.</p>
</div>
</div>
<div class="sect2 data-line-317">
<h3 id="_conclusion_5">Conclusion</h3>
<div class="paragraph data-line-19">
<p>Vyper est un nouveau langage de programmation orient√© contrat puissant et int√©ressant. Sa conception est biais√©e vers &quot;l&#39;exactitude&quot;, au d√©triment d&#39;une certaine flexibilit√©. Cela peut permettre aux programmeurs de r√©diger de meilleurs contrats intelligents et d&#39;√©viter certains pi√®ges qui provoquent l&#39;apparition de graves vuln√©rabilit√©s. Ensuite, nous examinerons plus en d√©tail la s√©curit√© des contrats intelligents. Certaines des nuances de la conception de Vyper peuvent devenir plus apparentes une fois que vous avez lu tous les probl√®mes de s√©curit√© possibles qui peuvent survenir dans les contrats intelligents.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="smart_contract_security">S√©curit√© des contrats intelligents</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>La s√©curit√© est l&#8217;une des consid√©rations les plus importantes lors de la r√©daction de contrats intelligents. Dans le domaine de la programmation de contrats intelligents, les erreurs sont co√ªteuses et facilement exploitables. Dans ce chapitre, nous examinerons les meilleures pratiques de s√©curit√© et les mod√®les de conception, ainsi que les ¬´anti-mod√®les de s√©curit√©¬ª, qui sont des pratiques et des mod√®les qui peuvent introduire des vuln√©rabilit√©s dans nos contrats intelligents.</p>
</div>
<div class="paragraph data-line-6">
<p>Comme avec d&#8217;autres programmes, un contrat intelligent ex√©cutera exactement ce qui est √©crit, ce qui n&#8217;est pas toujours ce que le programmeur avait pr√©vu. De plus, tous les contrats intelligents sont publics et tout utilisateur peut interagir avec eux simplement en cr√©ant une transaction. Toute vuln√©rabilit√© peut √™tre exploit√©e et les pertes sont presque toujours impossibles √† r√©cup√©rer. Il est donc essentiel de suivre les meilleures pratiques et d&#8217;utiliser des mod√®les de conception √©prouv√©s.</p>
</div>
<div class="sect2 data-line-8">
<h3 id="_meilleures_pratiques_de_s√©curit√©">Meilleures pratiques de s√©curit√©</h3>
<div class="paragraph data-line-10">
<p><em>La programmation d√©fensive</em> est un style de programmation particuli√®rement bien adapt√© aux contrats intelligents. Il met l&#8217;accent sur les √©l√©ments suivants, qui sont tous des pratiques exemplaires¬†:</p>
</div>
<div class="dlist data-line-12">
<dl>
<dt class="hdlist1">Minimalisme/simplicit√©</dt>
<dd>
<p>La complexit√© est l&#8217;ennemie de la s√©curit√©. Plus le code est simple et moins il en fait, moins il y a de chances qu&#8217;un bogue ou un effet impr√©vu se produise. Lorsqu&#8217;ils s&#8217;engagent pour la premi√®re fois dans la programmation de contrats intelligents, les d√©veloppeurs sont souvent tent√©s d&#8217;essayer d&#8217;√©crire beaucoup de code. Au lieu de cela, vous devriez parcourir votre code de contrat intelligent et essayer de trouver des moyens d&#8217;en faire moins, avec moins de lignes de code, moins de complexit√© et moins de "fonctionnalit√©s". Si quelqu&#8217;un vous dit que son projet a produit "des milliers de lignes de code" pour ses contrats intelligents, vous devez vous interroger sur la s√©curit√© de ce projet. Plus simple est plus s√ªr.</p>
</dd>
<dt class="hdlist1">R√©utilisation du code</dt>
<dd>
<p>Essayez de ne pas r√©inventer la roue. S&#8217;il existe d√©j√† une biblioth√®que ou un contrat qui fait la plupart de ce dont vous avez besoin, r√©utilisez-le. Dans votre propre code, suivez le principe DRY (Don&#8217;t Repeat Yourself)¬†: ne vous r√©p√©tez pas. Si vous voyez un extrait de code r√©p√©t√© plus d&#8217;une fois, demandez-vous s&#8217;il pourrait √™tre √©crit en tant que fonction ou biblioth√®que et r√©utilis√©. Le code qui a √©t√© largement utilis√© et test√© est probablement plus s√©curis√© que tout nouveau code que vous √©crivez. M√©fiez-vous du syndrome "Pas invent√© ici", o√π vous √™tes tent√© d'"am√©liorer" une fonctionnalit√© ou un composant en le construisant √† partir de z√©ro. Le risque de s√©curit√© est souvent sup√©rieur √† la valeur d&#8217;am√©lioration.</p>
</dd>
<dt class="hdlist1">Qualit√© du code</dt>
<dd>
<p>Le code de contrat intelligent est impitoyable. Chaque bogue peut entra√Æner une perte mon√©taire. Vous ne devez pas traiter la programmation de contrats intelligents de la m√™me mani√®re que la programmation √† usage g√©n√©ral. √âcrire des DApps dans Solidity n&#8217;est pas comme cr√©er un widget Web en JavaScript. Vous devez plut√¥t appliquer des m√©thodologies d&#8217;ing√©nierie et de d√©veloppement de logiciels rigoureuses, comme vous le feriez dans l&#8217;ing√©nierie a√©rospatiale ou dans toute discipline similairement impitoyable. Une fois que vous avez "lanc√©" votre code, vous ne pouvez pas faire grand-chose pour r√©soudre les probl√®mes.</p>
</dd>
<dt class="hdlist1">Lisibilit√©/auditabilit√©</dt>
<dd>
<p>Votre code doit √™tre clair et facile √† comprendre. Plus c&#8217;est facile √† lire, plus c&#8217;est facile √† auditer. Les contrats intelligents sont publics, car tout le monde peut lire le bytecode et tout le monde peut le d√©sosser. Par cons√©quent, il est avantageux de d√©velopper votre travail en public, en utilisant des m√©thodologies collaboratives et √† source libre, pour tirer parti de la sagesse collective de la communaut√© des d√©veloppeurs et b√©n√©ficier du plus grand d√©nominateur commun du d√©veloppement √† source libre. Vous devez √©crire un code bien document√© et facile √† lire, en suivant les conventions de style et de nommage qui font partie de la communaut√© Ethereum.</p>
</dd>
<dt class="hdlist1">Couverture de test</dt>
<dd>
<p>Testez tout ce que vous pouvez. Les contrats intelligents s&#8217;ex√©cutent dans un environnement d&#8217;ex√©cution public, o√π n&#8217;importe qui peut les ex√©cuter avec la contribution de son choix. Vous ne devez jamais supposer que l&#8217;entr√©e, telle que les arguments de fonction, est bien form√©e, correctement d√©limit√©e ou a un objectif b√©nin. Testez tous les arguments pour vous assurer qu&#8217;ils se situent dans les plages attendues et qu&#8217;ils sont correctement format√©s avant d&#8217;autoriser la poursuite de l&#8217;ex√©cution de votre code.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2 data-line-22">
<h3 id="_risques_de_s√©curit√©_et_anti_mod√®les">Risques de s√©curit√© et anti-mod√®les</h3>
<div class="paragraph data-line-24">
<p>En tant que programmeur de contrats intelligents, vous devez √™tre familiaris√© avec les risques de s√©curit√© les plus courants, afin de pouvoir d√©tecter et √©viter les mod√®les de programmation qui exposent vos contrats √† ces risques. Dans les sections suivantes, nous examinerons diff√©rents risques de s√©curit√©, des exemples de la fa√ßon dont les vuln√©rabilit√©s peuvent survenir et des contre-mesures ou des solutions pr√©ventives qui peuvent √™tre utilis√©es pour y faire face.</p>
</div>
</div>
<div class="sect2 data-line-27">
<h3 id="reentrancy_security">R√©entrance</h3>
<div class="paragraph data-line-29">
<p>L&#8217;une des caract√©ristiques des contrats intelligents Ethereum est leur capacit√© √† appeler et √† utiliser le code d&#8217;autres contrats externes. Les contrats g√®rent √©galement g√©n√©ralement l&#8217;ether et, en tant que tels, envoient souvent de l&#8217;ether √† diverses adresses d&#8217;utilisateurs externes. Ces op√©rations n√©cessitent que les contrats soumettent des appels externes. Ces appels externes peuvent √™tre d√©tourn√©s par des attaquants, qui peuvent forcer les contrats √† ex√©cuter du code suppl√©mentaire (via une fonction de secours ), y compris des rappels vers eux-m√™mes. Des attaques de ce type ont √©t√© utilis√©es dans le tristement c√©l√®bre <a href="http://bit.ly/2DamSZT" data-href="http://bit.ly/2DamSZT">piratage DAO</a> .</p>
</div>
<div class="paragraph data-line-31">
<p>Pour en savoir plus sur les attaques par r√©entrance , voir <a href="http://bit.ly/2zaqSEY" data-href="http://bit.ly/2zaqSEY">l&#8217;article de blog</a> de Gus Guimareas sur le sujet et les <a href="http://bit.ly/2ERDMxV" data-href="http://bit.ly/2ERDMxV">meilleures pratiques pour les contrats intelligents Ethereum</a>.</p>
</div>
<div class="sect3 notoc data-line-34">
<h4 id="_la_vuln√©rabilit√©">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-36">
<p>Ce type d&#8217;attaque peut se produire lorsqu&#8217;un contrat envoie de l&#8217;ether √† une adresse inconnue. Un attaquant peut soigneusement construire un contrat √† une adresse externe qui contient du code malveillant dans la fonction de secours. Ainsi, lorsqu&#8217;un contrat envoie de l&#8217;ether √† cette adresse, il invoquera le code malveillant. G√©n√©ralement , le code malveillant ex√©cute une fonction sur le contrat vuln√©rable, effectuant des op√©rations non pr√©vues par le d√©veloppeur. Le terme ¬´ r√©entrance ¬ª vient du fait que le contrat externe malveillant appelle une fonction sur le contrat vuln√©rable et que le chemin d&#8217;ex√©cution du code le ¬´ <em>r√©int√®gre</em> ¬ª. Pour clarifier cela, consid√©rons le simple contrat vuln√©rable dans <a href="#etherstore_vulnerable">EtherStore.sol</a> , qui agit comme un coffre-fort Ethereum qui permet aux d√©posants de retirer seulement 1 ether par semaine.</p>
</div>
<div id="etherstore_vulnerable" class="exampleblock data-line-40">
<div class="title">Example 7. EtherStore.sol</div>
<div class="content">
<div class="listingblock data-line-42">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract EtherStore {

    uint256 public withdrawalLimit = 1 ether;
    mapping(address =&gt; uint256) public lastWithdrawTime;
    mapping(address =&gt; uint256) public balances;

    function depositFunds() external payable {
        balances[msg.sender] += msg.value;
    }

    function withdrawFunds (uint256 _weiToWithdraw) public {
        require(balances[msg.sender] &gt;= _weiToWithdraw);
        // limite le retrait
        require(_weiToWithdraw &lt;= withdrawalLimit);
        // limite le temps accord√© pour se r√©tracter
        require(now &gt;= lastWithdrawTime[msg.sender] + 1 weeks);
        require(msg.sender.call.value(_weiToWithdraw)());
        balances[msg.sender] -= _weiToWithdraw;
        lastWithdrawTime[msg.sender] = now;
    }
 }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-67">
<p>Ce contrat a deux fonctions publiques, <code>depositFunds</code> et <code>removeFunds</code>. La fonction de d√©p√¥t de fonds incr√©mente simplement le solde de l&#8217;exp√©diteur. La fonction de retrait de fonds permet √† l&#8217;exp√©diteur de sp√©cifier le montant de wei √† retirer. Cette fonction est destin√©e √† r√©ussir uniquement si le montant demand√© √† retirer est inf√©rieur √† 1 ether et qu&#8217;aucun retrait n&#8217;a eu lieu la semaine derni√®re.</p>
</div>
<div class="paragraph data-line-69">
<p>La vuln√©rabilit√© se trouve √† la ligne 17, o√π le contrat envoie √† l&#8217;utilisateur la quantit√© d&#8217;ether demand√©e. Consid√©rez un attaquant qui a cr√©√© le contrat dans <a href="#etherstore_attack">Attack.sol</a> .</p>
</div>
<div id="etherstore_attack" class="exampleblock data-line-73">
<div class="title">Example 8. Attack.sol</div>
<div class="content">
<div class="listingblock data-line-75">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "EtherStore.sol";

contract Attack {
  EtherStore public etherStore;

  // initialise la variable etherStore avec l'adresse du contrat
  constructor(address _etherStoreAddress) {
      etherStore = EtherStore(_etherStoreAddress);
  }

  function attackEtherStore() external payable {
      // attaque √† l'ether le plus proche
      require(msg.value &gt;= 1 ether);
      // envoie eth √† la fonction depositFunds()
      etherStore.depositFunds.value(1 ether)();
      // d√©but de magie
      etherStore.withdrawFunds(1 ether);
  }

  function collectEther() public {
      msg.sender.transfer(this.balance);
  }

  // fonction de secours - o√π la magie op√®re
  function () payable {
      if (etherStore.balance &gt; 1 ether) {
          etherStore.withdrawFunds(1 ether);
      }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-109">
<p>Comment l&#8217;exploit peut-il se produire¬†? Tout d&#8217;abord, l&#8217;attaquant cr√©erait le contrat malveillant (disons √† l&#8217;adresse <code>0x0&#8230;&#8203;123</code>) avec l' adresse de contrat de l' <code>EtherStore</code> comme seul param√®tre constructeur. Cela initialiserait et pointerait la variable publique <code>etherStore</code> vers le contrat √† attaquer.</p>
</div>
<div class="paragraph data-line-111">
<p>L&#8217;attaquant appellerait alors la fonction <code>attackEtherStore</code> , avec une certaine quantit√© d&#8217;ether sup√©rieure ou √©gale √† 1 - supposons <code>1 ether</code> pour le moment. Dans cet exemple, nous supposerons √©galement qu&#8217;un certain nombre d&#8217;autres utilisateurs ont d√©pos√© de l&#8217;ether dans ce contrat, de sorte que son solde actuel est de <code>10 ether</code>. La suite sera alors ainsi :</p>
</div>
<div class="olist arabic data-line-113">
<ol class="arabic">
<li class="data-line-113">
<p><em>Attack.sol</em> , ligne 15 : La fonction <code>DepositFunds</code> du contrat <code>EtherStore</code> sera appel√©e avec un <code>msg.value</code> de <code>1 ether</code> (et beaucoup de gaz). L&#8217;exp√©diteur (<code>msg.sender</code>) sera le contrat malveillant ( <code>0x0&#8230;&#8203;‚Äã123</code> ). Ainsi , <code>balances[0x0&#8230;&#8203;123] = 1 ether</code>.</p>
</li>
<li class="data-line-115">
<p><em>Attack.sol</em> , ligne 17 : Le contrat malveillant va alors appeler la fonction <code>withdrawFunds</code> du contrat <code>EtherStore</code> avec un param√®tre de <code>1 ether</code> . Cela satisfera √† toutes les exigences (lignes 12 √† 16 du contrat <code>EtherStore</code> ) car aucun retrait pr√©c√©dent n&#8217;a √©t√© effectu√©.</p>
</li>
<li class="data-line-117">
<p><em>EtherStore.sol</em> , ligne 17 : Le contrat renverra <code>1 ether</code> au <span class="keep-together">contrat</span> malveillant.</p>
</li>
<li class="data-line-119">
<p><em>Attack.sol</em> , ligne 25 : Le paiement au contrat malveillant ex√©cutera alors la fonction de secours.</p>
</li>
<li class="data-line-121">
<p><em>Attack.sol</em> , ligne 26 : Le solde total du contrat EtherStore √©tait de <code>10 ether</code> et est maintenant de <code>9 ether</code> , donc cette instruction if passe.</p>
</li>
<li class="data-line-123">
<p><em>Attack.sol</em> , ligne 27 : La fonction de secours appelle de l' <code>EtherStore</code> la fonction <code>withdrawFunds</code> √† nouveau et ¬´ r√©int√®gre ¬ª le contrat <code>EtherStore</code> .</p>
</li>
<li class="data-line-125">
<p><em>EtherStore.sol</em> , ligne 11 : Dans ce deuxi√®me appel √† <code>withdrawFunds</code> , le solde du contrat attaquant est toujours de <code>1 ether</code> car la ligne 18 n&#8217;a pas encore √©t√© ex√©cut√©e. Ainsi, nous avons toujours <code>balances[0x0&#8230;&#8203;123] = 1 ether</code> . C&#8217;est √©galement le cas pour la variable <code>lastWithdrawTime</code> . Encore une fois , nous passons toutes les exigences .</p>
</li>
<li class="data-line-127">
<p><em>EtherStore.sol</em> , ligne 17 : Le contrat attaquant retire un autre <code>1 ether</code> .</p>
</li>
<li class="data-line-129">
<p>R√©p√©tez les √©tapes 4 √† 8 jusqu&#8217;√† ce qu&#8217;il ne soit plus le cas que <code>EtherStore.balance &gt; 1</code> , comme dict√© par la ligne 26 dans <em>Attack.sol</em> .</p>
</li>
<li class="data-line-131">
<p><em>Attack.sol</em> , ligne 26 : Une fois qu&#8217;il reste 1 (ou moins) d&#8217;ether dans le contrat <code>EtherStore</code> , cette instruction <code>if</code> √©chouera. Cela permettra alors d&#8217;ex√©cuter les lignes 18 et 19 du contrat <code>EtherStore</code> (pour chaque appel √† la fonction <code>withdrawFunds</code>).</p>
</li>
<li class="data-line-133">
<p><em>EtherStore.sol</em> , lignes 18 et 19 : Les mappages <code>balances</code> et <code>lastWithdrawTime</code> seront d√©finis et l&#8217;ex√©cution se terminera.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-135">
<p>Le r√©sultat final est que l&#8217;attaquant a retir√© tous les ethers sauf 1 du contrat <code>EtherStore</code> en une seule transaction.</p>
</div>
</div>
<div class="sect3 notoc data-line-138">
<h4 id="_techniques_pr√©ventives">Techniques pr√©ventives</h4>
<div class="paragraph data-line-140">
<p>Il existe un certain nombre de techniques courantes qui permettent d&#8217;√©viter les vuln√©rabilit√©s potentielles de r√©entrance dans les contrats intelligents. La premi√®re consiste √† (dans la mesure du possible) utiliser la fonction de <a href="http://bit.ly/2Ogvnng" data-href="http://bit.ly/2Ogvnng">transfert</a> int√©gr√©e lors de l&#8217;envoi d&#8217;ether √† des contrats externes. La fonction de transfert n&#8217;envoie que 2300 gaz avec l&#8217;appel externe, ce qui n&#8217;est pas suffisant pour que l&#8217;adresse/le contrat de destination appelle un autre contrat (c&#8217;est-√†-dire qu&#8217;il ressaisisse le contrat d&#8217;envoi).</p>
</div>
<div class="paragraph data-line-142">
<p>La deuxi√®me technique consiste √† s&#8217;assurer que toute la logique qui modifie les variables d&#8217;√©tat se produit avant que l&#8217;ether ne soit envoy√© hors du contrat (ou de tout appel externe). Dans l' exemple <code>EtherStore</code>, les lignes 18 et 19 de <em>EtherStore.sol</em> doivent √™tre plac√©es avant la ligne 17. Il est recommand√© que tout code effectuant des appels externes √† des adresses inconnues soit la derni√®re op√©ration d&#8217;une fonction localis√©e ou d&#8217;un morceau de code ex√©cut√©. C&#8217;est ce qu&#8217;on appelle le <a href="http://bit.ly/2EVo70v" data-href="http://bit.ly/2EVo70v">mod√®le v√©rifications-effets-interactions</a> .</p>
</div>
<div class="paragraph data-line-144">
<p>Une troisi√®me technique consiste √† introduire un mutex, c&#8217;est-√†-dire √† ajouter une variable d&#8217;√©tat qui verrouille le contrat pendant l&#8217;ex√©cution du code, emp√™chant les appels r√©entrants .</p>
</div>
<div class="paragraph data-line-146">
<p>L&#8217;application de toutes ces techniques (l&#8217;utilisation des trois n&#8217;est pas n√©cessaire, mais nous le faisons √† des fins de d√©monstration) √† <em>EtherStore.sol</em> donne le contrat sans r√©entrance¬†:</p>
</div>
<div class="listingblock data-line-149">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract EtherStore {

    // initialise le mutex
    bool reEntrancyMutex = false;
    uint256 public withdrawalLimit = 1 ether;
    mapping(address =&gt; uint256) public lastWithdrawTime;
    mapping(address =&gt; uint256) public balances;

    function depositFunds() external payable {
        balances[msg.sender] += msg.value;
    }

    function withdrawFunds (uint256 _weiToWithdraw) public {
        require(!reEntrancyMutex);
        require(balances[msg.sender] &gt;= _weiToWithdraw);
        // limite le retrait
        require(_weiToWithdraw &lt;= withdrawalLimit);
        // limite le temps accord√© pour se r√©tracter
        require(now &gt;= lastWithdrawTime[msg.sender] + 1 weeks);
        balances[msg.sender] -= _weiToWithdraw;
        lastWithdrawTime[msg.sender] = now;
        // d√©finit le mutex de r√©entrance avant l'appel externe
        reEntrancyMutex = true;
        msg.sender.transfer(_weiToWithdraw);
        // lib√®re le mutex apr√®s l'appel externe
        reEntrancyMutex = false;
    }
 }</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-181">
<h4 id="real_world_example_the_dao">Exemple concret¬†: le DAO</h4>
<div class="paragraph data-line-183">
<p>L&#8217;attaque DAO (Decentralized Autonomous Organization) a √©t√© l&#8217;un des principaux piratages survenus au d√©but du d√©veloppement d&#8217;Ethereum. √Ä l&#8217;√©poque, le contrat d√©tenait plus de 150 millions de dollars. La r√©entrance a jou√© un r√¥le majeur dans l&#8217;attaque, qui a finalement conduit √† l&#8217;embranchement divergent (hard fork) qui a cr√©√© Ethereum Classic (ETC). Pour une bonne analyse de l&#8217;exploit DAO, voir <a href="http://bit.ly/2EQaLCI" data-href="http://bit.ly/2EQaLCI">http://bit.ly/2EQaLCI</a> . Plus d&#8217;informations sur l&#8217;historique des embranchements d&#8217;Ethereum, la chronologie du piratage DAO et la naissance d&#8217;ETC dans un embranchement divergent peuvent √™tre trouv√©es dans <a href="#ethereum_standards">Normes Ethereum</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-185">
<h3 id="_d√©passement_et_soupassement_arithm√©tique">D√©passement et soupassement arithm√©tique</h3>
<div class="paragraph data-line-187">
<p>La machine virtuelle Ethereum sp√©cifie des types de donn√©es de taille fixe pour les entiers. Cela signifie qu&#8217;une variable enti√®re ne peut repr√©senter qu&#8217;une certaine plage de nombres. Un uint8 , par exemple, ne peut stocker que des nombres dans la plage [0,255]. Essayer de stocker 256 dans un uint8 donnera 0 . Si l&#8217;on n&#8217;y prend pas garde, les variables de Solidity peuvent √™tre exploit√©es si la saisie de l&#8217;utilisateur n&#8217;est pas coch√©e et si des calculs sont effectu√©s qui aboutissent √† des nombres qui se situent en dehors de la plage du type de donn√©es qui les stocke.</p>
</div>
<div class="paragraph data-line-189">
<p>Pour en savoir plus sur les d√©bordements arithm√©tiques, voir <a href="https://bit.ly/2nNLuOr" data-href="https://bit.ly/2nNLuOr">"Comment s√©curiser vos contrats intelligents"</a> , <a href="https://bit.ly/2MOfBPv" data-href="https://bit.ly/2MOfBPv">Ethereum Smart Contract Best Practices</a> et <a href="https://bit.ly/2xvbx1M" data-href="https://bit.ly/2xvbx1M">"Ethereum, Solidity and integer overflows: Programming blockchains like 1970"</a> .</p>
</div>
<div class="sect3 notoc data-line-192">
<h4 id="_la_vuln√©rabilit√©_2">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-194">
<p>Un d√©passement/soupassement se produit lorsqu&#8217;une op√©ration effectu√©e n√©cessite une variable de taille fixe pour stocker un nombre (ou un √©l√©ment de donn√©es) qui est en dehors de la plage du type de donn√©es de la variable.</p>
</div>
<div class="paragraph data-line-196">
<p>Par exemple, soustraire <code>1</code> d&#8217;une variable <code>uint8</code> (entier non sign√© de 8 bits, c&#8217;est-√†-dire non n√©gatif) dont la valeur est <code>0</code> donnera le nombre <code>255</code> . Il s&#8217;agit d&#8217;un <em>soupassement</em> . Nous avons attribu√© un nombre en dessous de la plage de <code>uint8</code> , de sorte que le r√©sultat <em>est une boucle</em> et donne le plus grand nombre qu&#8217;un <code>uint8</code> puisse stocker. De m√™me, ajouter <code>2^8=256</code> √† un <code>uint8</code> laissera la variable inchang√©e, car nous avons enroul√© autour de toute la longueur du <code>uint</code> . Deux analogies simples de ce comportement sont les odom√®tres dans les voitures, qui mesurent la distance parcourue (ils se r√©initialisent √† 000000, apr√®s que le plus grand nombre, c&#8217;est-√†-dire 999999, est d√©pass√©) et les fonctions math√©matiques p√©riodiques (l&#8217;ajout de 2 œÄ √† l&#8217;argument de sin laisse la valeur inchang√©e ).</p>
</div>
<div class="paragraph data-line-198">
<p>L&#8217;ajout de nombres sup√©rieurs √† la plage du type de donn√©es est appel√© un <em>d√©passement</em> . Pour plus de clart√©, ajouter <code>257</code> √† un <code>uint8</code> qui a actuellement une valeur de <code>0</code> se traduira par le nombre <code>1</code> . Il est parfois instructif de consid√©rer les variables de taille fixe comme √©tant cycliques, o√π nous recommen√ßons √† partir de z√©ro si nous ajoutons des nombres au-dessus du plus grand nombre stock√© possible, et commen√ßons √† compter √† partir du plus grand nombre si nous soustrayons de z√©ro. Dans le cas des types <code>int</code> sign√©s , qui <em>peuvent</em> repr√©senter des nombres n√©gatifs, nous recommen√ßons une fois que nous atteignons la plus grande valeur n√©gative; par exemple, si nous essayons de soustraire <code>1</code> √† un <code>int8</code> dont la valeur est <code>-128</code> , nous obtiendrons <code>127</code> .</p>
</div>
<div class="paragraph data-line-200">
<p>Ces types de pi√®ges num√©riques permettent aux attaquants de mal utiliser le code et de cr√©er des flux logiques inattendus. Par exemple, consid√©rez le contrat TimeLock dans  <a href="#timelock_sol_security">TimeLock.sol</a>.</p>
</div>
<div id="timelock_sol_security" class="exampleblock data-line-204">
<div class="title">Example 9. TimeLock.sol</div>
<div class="content">
<div class="listingblock data-line-206">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract TimeLock {

    mapping(address =&gt; uint) public balances;
    mapping(address =&gt; uint) public lockTime;

    function deposit() external payable {
        balances[msg.sender] += msg.value;
        lockTime[msg.sender] = now + 1 weeks;
    }

    function increaseLockTime(uint _secondsToIncrease) public {
        lockTime[msg.sender] += _secondsToIncrease;
    }

    function withdraw() public {
        require(balances[msg.sender] &gt; 0);
        require(now &gt; lockTime[msg.sender]);
        balances[msg.sender] = 0;
        msg.sender.transfer(balance);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-231">
<p>Ce contrat est con√ßu pour agir comme un coffre-fort temporel¬†: les utilisateurs peuvent d√©poser de l&#8217;ether dans le contrat et il y sera verrouill√© pendant au moins une semaine. L&#8217;utilisateur peut prolonger le temps d&#8217;attente √† plus d&#8217;une semaine s&#8217;il le souhaite, mais une fois d√©pos√©, l&#8217;utilisateur peut √™tre s√ªr que son ether est verrouill√© en toute s√©curit√© pendant au moins une semaine, du moins c&#8217;est ce que pr√©voit ce contrat.</p>
</div>
<div class="paragraph data-line-233">
<p>Dans le cas o√π un utilisateur est oblig√© de remettre sa cl√© priv√©e, un contrat comme celui-ci peut √™tre utile pour s&#8217;assurer que son ether est introuvable pendant une courte p√©riode. Mais si un utilisateur avait verrouill√© <code>100 ether</code> dans ce contrat et remis ses cl√©s √† un attaquant, l&#8217;attaquant pourrait utiliser un d√©bordement pour recevoir l&#8217;ether, quel que soit le <code>lockTime</code>.</p>
</div>
<div class="paragraph data-line-235">
<p>L&#8217;attaquant pourrait d√©terminer le <code>lockTime</code> actuel pour l&#8217;adresse pour laquelle il d√©tient maintenant la cl√© (c&#8217;est une variable publique). Appelons le <code>userLockTime</code> . Ils pourraient alors appeler la fonction <code>increaseLockTime</code> et passer en argument le nombre <code>2^256 - userLockTime</code> . Ce nombre serait ajout√© √† l' <code>userLockTime</code> actuel et provoquerait un d√©passement, r√©initialisant <code>lockTime[msg.sender]</code> √† <code>0</code>. L&#8217;attaquant pourrait alors simplement appeler la fonction <code>withdraw</code> pour obtenir sa r√©compense.</p>
</div>
<div class="paragraph data-line-237">
<p>Regardons un autre exemple (<a href="#underflow_vulnerability_example_from_ethernaut_challenge">Underflow vulnerability example from Ethernaut challenge</a>), celui des <a href="https://github.com/OpenZeppelin/ethernaut" data-href="https://github.com/OpenZeppelin/ethernaut">d√©fis Ethernaut</a>.</p>
</div>
<div class="paragraph data-line-239">
<p><strong>ALERTE DIVULGATION:</strong> <em>Si vous n&#8217;avez pas encore fait les d√©fis Ethernaut, cela donne une solution √† l&#8217;un des niveaux</em> .</p>
</div>
<div id="underflow_vulnerability_example_from_ethernaut_challenge" class="exampleblock data-line-243">
<div class="title">Example 10. Underflow vulnerability example from Ethernaut challenge</div>
<div class="content">
<div class="listingblock data-line-245">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.18;

contract Token {

  mapping(address =&gt; uint) balances;
  uint public totalSupply;

  function Token(uint _initialSupply) {
    balances[msg.sender] = totalSupply = _initialSupply;
  }

  function transfer(address _to, uint _value) public returns (bool) {
    require(balances[msg.sender] - _value &gt;= 0);
    balances[msg.sender] -= _value;
    balances[_to] += _value;
    return true;
  }

  function balanceOf(address _owner) public constant returns (uint balance) {
    return balances[_owner];
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-271">
<p>Il s&#8217;agit d&#8217;un simple contrat de jeton qui utilise une fonction de <code>transfer</code> , permettant aux participants de d√©placer leurs jetons. Pouvez-vous voir l&#8217;erreur dans ce contrat ?</p>
</div>
<div class="paragraph data-line-273">
<p>La faille vient de la fonction <code>transfer</code>. L&#8217;instruction require de la ligne 13 peut √™tre contourn√©e √† l&#8217;aide d&#8217;un soupassement. Consid√©rez un utilisateur avec un solde nul. Il pourrait appeler la fonction <code>transfer</code> avec n&#8217;importe quelle <code>_value</code> diff√©rente de z√©ro et passer l&#8217;instruction require √† la ligne 13. En effet, <code>balances[msg.sender]</code> est √©gal √† 0 (et un <code>uint256</code> ), donc la soustraction de tout montant positif (√† l&#8217;exception de <code>2^256</code> ) entra√Ænera un nombre positif, comme d√©crit pr√©c√©demment. Ceci est √©galement vrai pour la ligne 14, o√π le solde sera cr√©dit√© d&#8217;un nombre positif. Ainsi, dans cet exemple, un attaquant peut obtenir des jetons gratuits en raison d&#8217;une vuln√©rabilit√© de soupassement.</p>
</div>
</div>
<div class="sect3 notoc data-line-276">
<h4 id="_techniques_pr√©ventives_2">Techniques pr√©ventives</h4>
<div class="paragraph data-line-278">
<p>La technique conventionnelle actuelle pour se pr√©munir contre les vuln√©rabilit√©s de soupassement/d√©passement consiste √† utiliser ou √† cr√©er des biblioth√®ques math√©matiques qui remplacent les op√©rateurs math√©matiques standard d' addition, de soustraction et de multiplication (la division est exclue car elle ne provoque pas de soupassement/d√©passement et l&#8217;EVM revient √† la division par 0 ).</p>
</div>
<div class="paragraph data-line-280">
<p><a href="https://github.com/OpenZeppelin/openzeppelin-solidity" data-href="https://github.com/OpenZeppelin/openzeppelin-solidity">OpenZeppelin</a> a fait un excellent travail de cr√©ation et d&#8217;audit de biblioth√®ques s√©curis√©es pour la communaut√© Ethereum. En particulier, la <a href="http://bit.ly/2ABhb4l" data-href="http://bit.ly/2ABhb4l">biblioth√®que SafeMath</a> peut √™tre utilis√©e pour √©viter les vuln√©rabilit√©s de soupassement/d√©passement.</p>
</div>
<div class="paragraph data-line-282">
<p>Pour montrer comment ces biblioth√®ques sont utilis√©es dans Solidity, corrigeons le contrat <code>TimeLock</code> √† l&#8217;aide de la biblioth√®que <code>SafeMath</code>. La version sans d√©bordement du contrat est¬†:</p>
</div>
<div class="listingblock data-line-285">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">library SafeMath {

  function mul(uint256 a, uint256 b) internal pure returns (uint256) {
    if (a == 0) {
      return 0;
    }
    uint256 c = a * b;
    assert(c / a == b);
    return c;
  }

  function div(uint256 a, uint256 b) internal pure returns (uint256) {
    // assert( b &gt; 0); // Solidity relance automatiquement lors de la division par 0
    uint256 c = a / b;
    // assert( a == b * c + a % b); // Cela vaut dans tous les cas
    return c;
  }

  function sub(uint256 a, uint256 b) internal pure returns (uint256) {
    assert(b &lt;= a);
    return a - b;
  }

  function add(uint256 a, uint256 b) internal pure returns (uint256) {
    uint256 c = a + b;
    assert(c &gt;= a);
    return c;
  }
}

contract TimeLock {
    using SafeMath for uint; // utiliser la biblioth√®que pour le type uint
    mapping(address =&gt; uint256) public balances;
    mapping(address =&gt; uint256) public lockTime;

    function deposit() external payable {
        balances[msg.sender] = balances[msg.sender].add(msg.value);
        lockTime[msg.sender] = now.add(1 weeks);
    }

    function increaseLockTime(uint256 _secondsToIncrease) public {
        lockTime[msg.sender] = lockTime[msg.sender].add(_secondsToIncrease);
    }

    function withdraw() public {
        require(balances[msg.sender] &gt; 0);
        require(now &gt; lockTime[msg.sender]);
        balances[msg.sender] = 0;
        msg.sender.transfer(balance);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-339">
<p>Notez que toutes les op√©rations math√©matiques standard ont √©t√© remplac√©es par celles d√©finies dans la biblioth√®que <code>SafeMath</code>. Le contrat <code>TimeLock</code> n&#8217;effectue plus aucune op√©ration capable de soupassement/d√©passement.</p>
</div>
</div>
<div class="sect3 data-line-341">
<h4 id="_exemples_concrets_powhc_et_d√©bordement_de_transfert_par_lots_cve_201810299">Exemples concrets¬†: PoWHC et d√©bordement de transfert par lots (CVE-2018‚Äì10299)</h4>
<div class="paragraph data-line-343">
<p>Proof of Weak Hands Coin ( PoWHC ), con√ßu √† l&#8217;origine comme une sorte de blague, √©tait un stratag√®me de Ponzi √©crit par un collectif Internet. Malheureusement , il semble que l&#8217;auteur ou les auteurs du contrat n&#8217;avaient pas vu de soupassement/d√©passement auparavant, et par cons√©quent 866 ethers ont √©t√© lib√©r√©s de son contrat. Eric Banisadr donne un bon aper√ßu de la fa√ßon dont le d√©bordement s&#8217;est produit (ce qui n&#8217;est pas trop diff√©rent du d√©fi Ethernaut d√©crit pr√©c√©demment) dans son <a href="https://bit.ly/2wrxIFJ" data-href="https://bit.ly/2wrxIFJ">article de blog</a> sur l&#8217;√©v√©nement.</p>
</div>
<div class="paragraph data-line-345">
<p><a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">Un autre exemple</a> provient de l&#8217;impl√©mentation d&#8217;une fonction <code>batchTransfer()</code> dans un groupe de contrats de jetons ERC20. L&#8217;impl√©mentation contenait une vuln√©rabilit√© de d√©passement; vous pouvez lire les d√©tails dans le <a href="https://bit.ly/2HDlIs8" data-href="https://bit.ly/2HDlIs8">compte rendu de PeckShield</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-347">
<h3 id="_ether_inattendu">Ether inattendu</h3>
<div class="paragraph data-line-349">
<p>En r√®gle g√©n√©rale, lorsque de l&#8217;ether est envoy√© √† un contrat, il doit ex√©cuter soit la fonction de secours, soit une autre fonction d√©finie dans le contrat. Il y a deux exceptions √† cela, o√π l&#8217;ether peut exister dans un contrat sans avoir ex√©cut√© de code. Les contrats qui reposent sur l&#8217;ex√©cution de code pour tout l&#8217;ether qui leur est envoy√© peuvent √™tre vuln√©rables aux attaques o√π l&#8217;ether est envoy√© de force.</p>
</div>
<div class="paragraph data-line-351">
<p>Pour en savoir plus √† ce sujet, consultez <a href="https://bit.ly/2MR8Gp0" data-href="https://bit.ly/2MR8Gp0">¬´¬†Comment s√©curiser vos contrats intelligents¬†¬ª</a> et <a href="http://bit.ly/2RjXmUWl" data-href="http://bit.ly/2RjXmUWl">¬´¬†Mod√®les de s√©curit√© solides¬†‚Äì¬†Forcer Ether √† un contrat¬†¬ª</a> .</p>
</div>
<div class="sect3 notoc data-line-354">
<h4 id="_la_vuln√©rabilit√©_3">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-356">
<p>Une technique de programmation d√©fensive courante qui est utile pour appliquer des transitions d&#8217;√©tat correctes ou valider des op√©rations est <em>la v√©rification invariante</em> . Cette technique consiste √† d√©finir un ensemble d&#8217;invariants (m√©triques ou param√®tres qui ne doivent pas changer) et √† v√©rifier qu&#8217;ils restent inchang√©s apr√®s une (ou plusieurs) op√©ration(s). C&#8217;est g√©n√©ralement une bonne conception, √† condition que les invariants v√©rifi√©s soient en fait des invariants. Un exemple d&#8217;invariant est <code>totalSupply</code> d&#8217;une √©mission fixe de <a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">Jeton ERC20</a> . Comme aucune fonction ne doit modifier cet invariant, on pourrait ajouter une v√©rification √† la fonction <code>transfer</code> qui s&#8217;assure que le <code>totalSupply</code> reste inchang√©, pour garantir que la fonction fonctionne comme pr√©vu.</p>
</div>
<div class="paragraph data-line-358">
<p>En particulier, il existe un invariant apparent qu&#8217;il peut √™tre tentant d&#8217;utiliser mais qui peut en fait √™tre manipul√© par des utilisateurs externes (quelles que soient les r√®gles mises en place dans le contrat intelligent). Il s&#8217;agit de l&#8217;ether actuel stock√© dans le contrat. Souvent, lorsque les d√©veloppeurs apprennent Solidity pour la premi√®re fois , ils ont l&#8217;id√©e fausse qu&#8217;un contrat ne peut accepter ou obtenir de l&#8217;ether que via des fonctions payantes. Cette id√©e fausse peut conduire √† des contrats qui contiennent de fausses hypoth√®ses sur l&#8217;√©quilibre de l&#8217;ether, ce qui peut entra√Æner une s√©rie de vuln√©rabilit√©s. La preuve irr√©futable de cette vuln√©rabilit√© est l&#8217;utilisation (incorrecte) de <code>this.balance</code>.</p>
</div>
<div class="paragraph data-line-360">
<p>Il existe deux mani√®res d&#8217;envoyer (de force) de l&#8217;ether √† un contrat sans utiliser de fonction payante ni ex√©cuter de code sur le contrat¬†:</p>
</div>
<div class="dlist data-line-362">
<dl>
<dt class="hdlist1">Autodestruction/suicide</dt>
<dd>
<p>Tout contrat est capable d' impl√©menter la <a href="http://bit.ly/2RovrDf" data-href="http://bit.ly/2RovrDf">fonction</a> <code>selfdestruct</code> , qui supprime tout le bytecode de l&#8217;adresse du contrat et envoie tout l&#8217;ether qui y est stock√© √† l&#8217;adresse sp√©cifi√©e par le param√®tre. Si cette adresse sp√©cifi√©e est √©galement un contrat, aucune fonction (y compris la fonction de secours) n&#8217;est appel√©e. Par cons√©quent, la fonction <code>selfdestruct</code> peut √™tre utilis√©e pour envoyer de force de l&#8217;ether √† n&#8217;importe quel contrat, quel que soit le code pouvant exister dans le contrat, m√™me les contrats sans fonctions payantes. Cela signifie que tout attaquant peut cr√©er un contrat avec une fonction <code>selfdestruct</code> , lui envoyer de l&#8217;ether, appeler <code>selfdestruct(target)</code> et forcer l&#8217;ether √† √™tre envoy√© √† un contrat <code>target</code> . Martin Swende a un excellent <a href="http://bit.ly/2OfLukM" data-href="http://bit.ly/2OfLukM">article de blog</a> d√©crivant certaines bizarreries de l&#8217;opcode d&#8217;autodestruction (Quirk # 2) ainsi qu&#8217;un compte rendu de la fa√ßon dont les n≈ìuds clients v√©rifiaient des invariants incorrects, ce qui aurait pu conduire √† un crash plut√¥t catastrophique du r√©seau Ethereum.</p>
</dd>
<dt class="hdlist1">Ether pr√©-envoy√©</dt>
<dd>
<p>Une autre fa√ßon d&#8217;int√©grer de l&#8217;ether dans un contrat consiste √† pr√©charger l&#8217;adresse du contrat avec de l&#8217;ether. Les adresses de contrat sont d√©terministes - en fait, l&#8217;adresse est calcul√©e √† partir du hachage Keccak-256 (g√©n√©ralement synonyme de SHA-3) de l&#8217;adresse cr√©ant le contrat et du nonce de transaction qui cr√©e le contrat. Plus pr√©cis√©ment, il se pr√©sente sous la forme <code>address = sha3(rlp.encode([ account_address,transaction_nonce ]))</code> (voir la discussion d&#8217;Adrian Manning sur <a href="http://bit.ly/2EPj5Tq" data-href="http://bit.ly/2EPj5Tq">"Keyless Ether"</a> pour quelques cas d&#8217;utilisation amusants). Cela signifie que n&#8217;importe qui peut calculer quelle sera l&#8217;adresse d&#8217;un contrat avant sa cr√©ation et envoyer de l&#8217;ether √† cette adresse. Lorsque le contrat est cr√©√©, il aura un solde d&#8217;ether non nul.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-366">
<p>Explorons quelques pi√®ges qui peuvent survenir compte tenu de ces connaissances. Consid√©rez le contrat trop simple dans <a href="#etherGame_security">EtherGame.sol</a>.</p>
</div>
<div id="etherGame_security" class="exampleblock data-line-370">
<div class="title">Example 11. EtherGame.sol</div>
<div class="content">
<div class="listingblock data-line-372">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract EtherGame {

    uint public payoutMileStone1 = 3 ether;
    uint public mileStone1Reward = 2 ether;
    uint public payoutMileStone2 = 5 ether;
    uint public mileStone2Reward = 3 ether;
    uint public finalMileStone = 10 ether;
    uint public finalReward = 5 ether;

    mapping(address =&gt; uint) redeemableEther;
    // Les utilisateurs paient 0,5 ether. √Ä des √©tapes sp√©cifiques, cr√©ditez leurs comptes.
    function play() external payable {
        require(msg.value == 0.5 ether); // each play is 0.5 ether
        uint currentBalance = this.balance + msg.value;
        // s'assure qu'il n'y a plus de joueurs apr√®s la fin du jeu
        require(currentBalance &lt;= finalMileStone);
        // si √† un jalon, cr√©diter le compte du joueur
        if (currentBalance == payoutMileStone1) {
            redeemableEther[msg.sender] += mileStone1Reward;
        }
        else if (currentBalance == payoutMileStone2) {
            redeemableEther[msg.sender] += mileStone2Reward;
        }
        else if (currentBalance == finalMileStone ) {
            redeemableEther[msg.sender] += finalReward;
        }
        return;
    }

    function claimReward() public {
        // s'assure que le jeu est termin√©
        require(this.balance == finalMileStone);
        // s'assure qu'il y a une r√©compense √† donner
        require(redeemableEther[msg.sender] &gt; 0);
        redeemableEther[msg.sender] = 0;
        msg.sender.transfer(transferValue);
    }
 }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-414">
<p>Ce contrat repr√©sente un jeu simple (qui impliquerait naturellement des conditions de course) o√π les joueurs envoient 0,5 ether au contrat dans l&#8217;espoir d&#8217;√™tre le joueur qui atteint l&#8217;un des trois jalons en premier. Les jalons sont libell√©s en ether. Le premier √† atteindre le jalon peut r√©clamer une partie de l&#8217;ether √† la fin de la partie. Le jeu se termine lorsque le dernier jalon (10 ether) est atteint; les utilisateurs peuvent ensuite r√©clamer leurs r√©compenses.</p>
</div>
<div class="paragraph data-line-416">
<p>Les probl√®mes avec le contrat <code>EtherGame</code> proviennent de la mauvaise utilisation de <code>this.balance</code> dans les deux lignes 14 (et par association 16) et 32. Un attaquant malicieux pourrait envoyer de force une petite quantit√© d&#8217;ether, disons 0,1 ether, via la fonction <code>selfdestruct</code> ( discut√© plus t√¥t) pour emp√™cher tout futur joueur d&#8217;atteindre un jalon. <code>this.balance</code> ne sera jamais un multiple de 0,5 ether gr√¢ce √† cette contribution de 0,1 ether, car tous les joueurs l√©gitimes ne peuvent envoyer que des incr√©ments de 0,5 ether. Cela emp√™che toutes les conditions if des lignes 18, 21 et 24 d&#8217;√™tre vraies.</p>
</div>
<div class="paragraph data-line-418">
<p>Pire encore, un attaquant vengeur qui a rat√© un jalon pourrait envoyer de force 10 ethers (ou une quantit√© √©quivalente d&#8217;ethers qui pousse le solde du contrat au-dessus du <code>finalMileStone</code> ), ce qui verrouillerait toutes les r√©compenses dans le contrat pour toujours. En effet, la fonction <code>claimReward</code> sera toujours r√©tablie, en raison de l&#8217;exigence √† la ligne 32 (c&#8217;est-√†-dire parce que <code>this.balance</code> est sup√©rieur √† <code>finalMileStone</code> ).</p>
</div>
</div>
<div class="sect3 notoc data-line-421">
<h4 id="_techniques_pr√©ventives_3">Techniques pr√©ventives</h4>
<div class="paragraph data-line-423">
<p>Ce type de vuln√©rabilit√© provient g√©n√©ralement d&#8217;une mauvaise utilisation de <code>this.balance</code>. La logique contractuelle, dans la mesure du possible, doit √©viter de d√©pendre des valeurs exactes du solde du contrat, car elle peut √™tre artificiellement manipul√©e. Si vous appliquez une logique bas√©e sur <code>this.balance</code> , vous devez faire face √† des soldes inattendus.</p>
</div>
<div class="paragraph data-line-425">
<p>Si des valeurs exactes d&#8217;ether d√©pos√© sont requises, une variable auto-d√©finie doit √™tre utilis√©e qui est incr√©ment√©e dans les fonctions payables, pour suivre en toute s√©curit√© l&#8217;ether d√©pos√©. Cette variable ne sera pas influenc√©e par l&#8217;ether forc√© envoy√© via un appel <code>selfdestruct</code>.</p>
</div>
<div class="listingblock data-line-428">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract EtherGame {

    uint public payoutMileStone1 = 3 ether;
    uint public mileStone1Reward = 2 ether;
    uint public payoutMileStone2 = 5 ether;
    uint public mileStone2Reward = 3 ether;
    uint public finalMileStone = 10 ether;
    uint public finalReward = 5 ether;
    uint public depositedWei;

    mapping (address =&gt; uint) redeemableEther;

    function play() external payable {
        require(msg.value == 0.5 ether);
        uint currentBalance = depositedWei + msg.value;
        // s'assure qu'il n'y a plus de joueurs apr√®s la fin du jeu
        require(currentBalance &lt;= finalMileStone);
        if (currentBalance == payoutMileStone1) {
            redeemableEther[msg.sender] += mileStone1Reward;
        }
        else if (currentBalance == payoutMileStone2) {
            redeemableEther[msg.sender] += mileStone2Reward;
        }
        else if (currentBalance == finalMileStone ) {
            redeemableEther[msg.sender] += finalReward;
        }
        depositedWei += msg.value;
        return;
    }

    function claimReward() public {
        // s'assure que le jeu est termin√©
        require(depositedWei == finalMileStone);
        // s'assure qu'il y a une r√©compense √† donner
        require(redeemableEther[msg.sender] &gt; 0);
        redeemableEther[msg.sender] = 0;
        msg.sender.transfer(transferValue);
    }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-470">
<p>Ici, nous avons cr√©√© une nouvelle variable, <code>depositWei</code> , qui garde la trace de l&#8217;ether connu d√©pos√©, et c&#8217;est cette variable que nous utilisons pour nos tests. Notez que nous n&#8217;avons plus aucune r√©f√©rence √† <code>this.balance</code>.</p>
</div>
</div>
<div class="sect3 data-line-472">
<h4 id="_autres_exemples">Autres exemples</h4>
<div class="paragraph data-line-474">
<p>Quelques exemples de contrats exploitables ont √©t√© donn√©s dans le <a href="https://github.com/Arachnid/uscc/tree/master/submissions-2017/" data-href="https://github.com/Arachnid/uscc/tree/master/submissions-2017/">Underhanded Solidity Coding Contest</a> , qui fournit √©galement des exemples d√©taill√©s d&#8217;un certain nombre de pi√®ges soulev√©s dans cette section.</p>
</div>
</div>
</div>
<div class="sect2 data-line-476">
<h3 id="_delegatecall_appel_d√©l√©gu√©">DELEGATECALL (Appel d√©l√©gu√©)</h3>
<div class="paragraph data-line-478">
<p>Les opcodes <code>CALL</code> et <code>DELEGATECALL</code> sont utiles pour permettre aux d√©veloppeurs Ethereum de modulariser leur code. Les appels de messages externes standard aux contrats sont g√©r√©s par l' opcode <code>CALL</code>, le code √©tant ex√©cut√© dans le contexte du contrat/de la fonction externe. L' opcode <code>DELEGATECALL</code> est presque identique, sauf que le code ex√©cut√© √† l&#8217;adresse cibl√©e est ex√©cut√© dans le contexte du contrat appelant, et <code>msg.sender</code> et <code>msg.value</code> restent inchang√©s. Cette fonctionnalit√© permet la mise en ≈ìuvre de <em>biblioth√®ques</em> , permettant aux d√©veloppeurs de d√©ployer du code r√©utilisable une seule fois et de l&#8217;appeler √† partir de futurs contrats.</p>
</div>
<div class="paragraph data-line-480">
<p>Bien que les diff√©rences entre ces deux opcodes soient simples et intuitives, l&#8217;utilisation de <code>DELEGATECALL</code> peut conduire √† l&#8217;ex√©cution de code inattendu.</p>
</div>
<div class="paragraph data-line-482">
<p>Pour plus de lecture, voir ¬†http://bit.ly/2AAElb8[Question Ethereum Stack Exchange sur ce sujet] de Loi.Luu et la <a href="http://bit.ly/2Oi7UlH" data-href="http://bit.ly/2Oi7UlH">documentation Solidity</a> .</p>
</div>
<div class="sect3 notoc data-line-485">
<h4 id="_la_vuln√©rabilit√©_4">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-487">
<p>En raison de la nature de pr√©servation du contexte de <code>DELEGATECALL</code> , la cr√©ation de biblioth√®ques personnalis√©es sans vuln√©rabilit√© n&#8217;est pas aussi simple qu&#8217;on pourrait le penser. Le code des biblioth√®ques elles-m√™mes peut √™tre s√©curis√© et sans vuln√©rabilit√© ; cependant, lorsqu&#8217;il est ex√©cut√© dans le contexte d&#8217;une autre application, de nouvelles vuln√©rabilit√©s peuvent survenir. Voyons un exemple assez complexe de cela, en utilisant des nombres de Fibonacci.</p>
</div>
<div class="paragraph data-line-489">
<p>Consid√©rez la biblioth√®que dans <a href="#fibonacci_security">FibonacciLib.sol</a>, qui peut g√©n√©rer la s√©quence de Fibonacci et des s√©quences de forme similaire. (Remarque¬†: ce code a √©t√© modifi√© √† partir de <a href="https://bit.ly/2MReuii" data-href="https://bit.ly/2MReuii">https://bit.ly/2MReuii</a> .)</p>
</div>
<div id="fibonacci_security" class="exampleblock data-line-493">
<div class="title">Example 12. FibonacciLib.sol</div>
<div class="content">
<div class="listingblock data-line-495">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// contrat de biblioth√®que - calcule les nombres de type Fibonacci
contract FibonacciLib {
    // initialisation de la suite standard de Fibonacci
    uint public start;
    uint public calculatedFibNumber;

    // modifie le num√©ro z√©ro de la s√©quence
    function setStart(uint _start) public {
        start = _start;
    }

    function setFibonacci(uint n) public {
        calculatedFibNumber = fibonacci(n);
    }

    function fibonacci(uint n) internal returns (uint) {
        if (n == 0) return start;
        else if (n == 1) return start + 1;
        else return fibonacci(n - 1) + fibonacci(n - 2);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-520">
<p>Cette biblioth√®que fournit une fonction qui peut g√©n√©rer le <em>n</em>-√®me nombre de Fibonacci dans la s√©quence. Il permet aux utilisateurs de changer le num√©ro de d√©part de la s√©quence (<code>start</code>) et de calculer les <em>n</em>-√®mes nombres de type Fibonacci dans cette nouvelle s√©quence.</p>
</div>
<div class="paragraph data-line-522">
<p>Consid√©rons maintenant un contrat qui utilise cette biblioth√®que, montr√© dans <a href="#fib_balance_security">FibonacciBalance.sol</a>.</p>
</div>
<div id="fib_balance_security" class="exampleblock data-line-526">
<div class="title">Example 13. FibonacciBalance.sol</div>
<div class="content">
<div class="listingblock data-line-528">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract FibonacciBalance {

    address public fibonacciLibrary;
    // le nombre de Fibonacci actuel √† retirer
    uint public calculatedFibNumber;
    // le num√©ro de s√©quence de Fibonacci de d√©part
    uint public start = 3;
    uint public withdrawalCounter;
    // le s√©lecteur de fonction de Fibonancci
    bytes4 constant fibSig = bytes4(sha3("setFibonacci(uint256)"));

    // constructeur - charge le contrat avec ether
    constructor(address _fibonacciLibrary) external payable {
        fibonacciLibrary = _fibonacciLibrary;
    }

    function withdraw() {
        withdrawalCounter += 1;
        // calcule le nombre de Fibonacci pour l'utilisateur de retrait actuel-
        // ceci d√©finit le nombreFibcalcul√©
        require(fibonacciLibrary.delegatecall(fibSig, withdrawalCounter));
        msg.sender.transfer(calculatedFibNumber * 1 ether);
    }

    // permet aux utilisateurs d'appeler les fonctions de la biblioth√®que Fibonacci
    function() public {
        require(fibonacciLibrary.delegatecall(msg.data));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-561">
<p>Ce contrat permet √† un participant de retirer des ethers du contrat, la quantit√© d&#8217;ethers √©tant √©gale au nombre de Fibonacci correspondant √† l&#8217;ordre de retrait du participant ; c&#8217;est-√†-dire que le premier participant obtient 1 ether, le second obtient √©galement 1, le troisi√®me obtient 2, le quatri√®me obtient 3, le cinqui√®me 5, et ainsi de suite (jusqu&#8217;√† ce que le solde du contrat soit inf√©rieur au nombre de Fibonacci retir√©).</p>
</div>
<div class="paragraph data-line-563">
<p>Il y a un certain nombre d' √©l√©ments dans ce contrat qui peuvent n√©cessiter quelques explications. Tout d&#8217;abord, il existe une variable int√©ressante, <code>fibSig</code>. Cela contient les 4 premiers octets du hachage Keccak-256 (SHA-3) de la cha√Æne <code>'setFibonacci (uint256)'</code>. Ceci est connu sous le nom de <a href="http://bit.ly/2RmueMP" data-href="http://bit.ly/2RmueMP">s√©lecteur de fonction</a> et est plac√© dans <code>calldata</code> pour sp√©cifier quelle fonction d&#8217;un contrat intelligent sera appel√©e. Il est utilis√© dans la fonction d&#8217;appel d√©l√©gu√© √† la ligne 21 pour sp√©cifier que nous souhaitons ex√©cuter la fonction <code>fibonacci(uint256)</code>. Le deuxi√®me argument est <code>delegatecall</code> le param√®tre que nous passons √† la fonction. Deuxi√®mement, nous supposons que l&#8217;adresse de la biblioth√®que <code>FibonacciLib</code> est correctement r√©f√©renc√©e dans le constructeur (<a href="#external_contract_referencing">R√©f√©rencement des contrats externes</a> traite de certaines vuln√©rabilit√©s potentielles li√©es √† ce type d&#8217;initialisation de r√©f√©rence de contrat).</p>
</div>
<div class="paragraph data-line-565">
<p>Pouvez-vous rep√©rer des erreurs dans ce contrat ? Si l&#8217;on d√©ployait ce contrat, le remplissait d&#8217;ether et appelait <code>withdraw</code>, il reviendrait probablement.</p>
</div>
<div class="paragraph data-line-567">
<p>Vous avez peut-√™tre remarqu√© que la variable d&#8217;√©tat <code>start</code> est utilis√©e √† la fois dans la biblioth√®que et dans le contrat d&#8217;appel principal. Dans le contrat de biblioth√®que, <code>start</code> est utilis√© pour sp√©cifier le d√©but de la s√©quence de Fibonacci et est d√©fini sur 0 , alors qu&#8217;il est d√©fini sur <code>3</code> dans le contrat appelant. Vous avez peut-√™tre √©galement remarqu√© que la fonction de secours dans le contrat <code>FibonacciBalance</code> permet de transmettre tous les appels au contrat de biblioth√®que, ce qui permet d&#8217;appeler la fonction <code>setStart</code> du contrat de biblioth√®que. En rappelant que nous pr√©servons l&#8217;√©tat du contrat, il peut sembler que cette fonction permettrait de changer l&#8217;√©tat de la variable <code>start</code> dans le contrat local <code>FibonnacciBalance</code>. Si c&#8217;est le cas, cela permettrait de retirer plus d&#8217;ether, car le <code>calculatedFibNumber</code> r√©sultant d√©pend de la variable <code>start</code> (comme indiqu√© dans le contrat de biblioth√®que). En r√©alit√© , la fonction <code>setStart</code> ne modifie pas (et ne peut pas modifier) la variable <code>start</code> dans le contrat <code>FibonacciBalance</code>. La vuln√©rabilit√© sous-jacente de ce contrat est bien pire que la simple modification de la variable <code>start</code>.</p>
</div>
<div class="paragraph data-line-569">
<p>Avant de discuter du probl√®me r√©el, faisons un petit d√©tour pour comprendre comment les variables d&#8217;√©tat sont r√©ellement stock√©es dans les contrats. Les variables d&#8217;√©tat ou de stockage (variables qui persistent sur des transactions individuelles) sont plac√©es dans des <em>emplacements</em> de mani√®re s√©quentielle au fur et √† mesure qu&#8217;elles sont introduites dans le contrat. (Il y a quelques complexit√©s ici ; consultez la documentation de <a href="http://bit.ly/2JslDWf" data-href="http://bit.ly/2JslDWf">Solidity</a> pour une compr√©hension plus approfondie.)</p>
</div>
<div class="paragraph data-line-571">
<p>Prenons l&#8217;exemple du contrat de biblioth√®que. Il a deux variables d&#8217;√©tat, <code>start</code> et <code>calculatedFibNumber</code> . La premi√®re variable, <code>start</code>, est stock√©e dans le stockage du contrat √† <code>slot[0]</code> (c&#8217;est-√†-dire le premier slot (fente ou espace)). La deuxi√®me variable, <code>calculatedFibNumber</code>, est plac√©e dans le prochain emplacement de stockage disponible, <code>slot[1]</code>. La fonction <code>setStart</code> prend une entr√©e et d√©finit start quelle que soit l&#8217;entr√©e. Cette fonction d√©finit donc <code>slot[0]</code> sur l&#8217;entr√©e que nous fournissons dans la fonction <code>setStart</code>. De la m√™me mani√®re, la fonction <code>setFibonacci</code> d√©finit la fonction <code>calculatedFibNumber</code> sur le r√©sultat de <code>fibonacci(n)</code>. Encore une fois, il s&#8217;agit simplement de d√©finir storage <code>slot[1]</code> sur la valeur de <code>fibonacci(n)</code>.</p>
</div>
<div class="paragraph data-line-573">
<p>Regardons maintenant le contrat <code>FibonacciBalance</code>. Storage <code>slot[0]</code> correspond maintenant √† l' adresse <code>fibonacciLibrary</code> , et <code>slot[1]</code> correspond √† <code>calculatedFibNumber</code> . C&#8217;est dans ce mappage incorrect que la vuln√©rabilit√© se produit. <code>delegatecall</code> <em>pr√©serve le contexte du contrat</em> . Cela signifie que le code ex√©cut√© via l&#8217;appel d√©l√©gu√© <code>delegatecall</code> agira sur l&#8217;√©tat (c&#8217;est-√†-dire le stockage) du contrat appelant.</p>
</div>
<div class="paragraph data-line-575">
<p>Notez maintenant que <code>withdraw</code> √† la ligne 21, nous ex√©cutons <code>fibonacciLibrary.delegatecall(fibSig,withdrawalCounter)</code>. Cela appelle la fonction <code>setFibonacci</code>, qui, comme nous l&#8217;avons vu, modifie l&#8217;espace de stockage <code>slot[1]</code> , qui dans notre contexte actuel est <code>calculatedFibNumber</code> . C&#8217;est comme pr√©vu (c&#8217;est-√†-dire qu&#8217;apr√®s l&#8217;ex√©cution, le <code>calculatedFibNumber</code> est modifi√©). Cependant, rappelez-vous que la variable de d√©but dans le contrat <code>FibonacciLib</code> est situ√©e dans l&#8217;espace de stockage <code>slot[0]</code>, qui est l' adresse <code>fibonacciLibrary</code> dans le contrat actuel. Cela signifie que la fonction <code>fibonacci</code> donnera un r√©sultat inattendu. En effet, il fait r√©f√©rence √† <code>start</code> ( <code>slot[0]</code> ), qui dans le contexte d&#8217;appel actuel est l' adresse <code>fibonacciLibrary</code> (qui sera souvent assez grande, lorsqu&#8217;elle est interpr√©t√©e comme un <code>uint</code>). Ainsi , il est probable que la fonction de retrait <code>withdraw</code> reviendra, car elle ne contiendra pas la quantit√© <code>uint(fibonacciLibrary)</code> d&#8217;ether, ce qui est ce que <code>calculatedFibNumber</code> renverra.</p>
</div>
<div class="paragraph data-line-577">
<p>Pire encore, le contrat <code>FibonacciBalance</code> permet aux utilisateurs d&#8217;appeler toutes les fonctions <code>fibonacciLibrary</code> via la fonction de secours √† la ligne 26. Comme nous l&#8217;avons vu pr√©c√©demment, cela inclut la fonction <code>setStart</code>. Nous avons expliqu√© que cette fonction permet √† quiconque de modifier ou de d√©finir l' emplacement de stockage <code>slot[0]</code>. Dans ce cas, emplacement de stockage <code>slot[0]</code> est l' adresse <code>fibonacciLibrary</code>. Par cons√©quent, un attaquant pourrait cr√©er un contrat malveillant, convertir l&#8217;adresse en <code>uint</code> (cela peut √™tre fait facilement en Python en utilisant <code>int('&lt;address&gt;',16)</code> ), puis appeler <code>setStart</code> (<a href="#attack_contract_address_as_uint">[attack_contract_address_as_uint]</a>) . Cela changera <code>fibonacciLibrary</code> √† l&#8217;adresse du contrat d&#8217;attaque. Ensuite, chaque fois qu&#8217;un utilisateur appelle <code>withdraw</code> ou la fonction de secours, le contrat malveillant s&#8217;ex√©cutera (ce qui peut voler la totalit√© du solde du contrat) car nous avons modifi√© l&#8217;adresse r√©elle de <code>fibonacciLibrary</code>. Un exemple d&#8217;un tel contrat d&#8217;attaque serait :</p>
</div>
<div class="listingblock data-line-580">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Attack {
    uint storageSlot0; // correspond √† fibonacciLibrary
    uint storageSlot1; // correspond √† calculatedFibNumber

    // d√©faut - cela s'ex√©cutera si une fonction sp√©cifi√©e n'est pas trouv√©e
    function() public {
        storageSlot1 = 0; // we set calculatedFibNumber to 0, so if withdraw
        // s'appelle nous n'envoyons pas d'ether
        &lt;attacker_address&gt;.transfer(this.balance); // we take all the ether
    }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-594">
<p>Notez que ce contrat d&#8217;attaque modifie le <code>calculatedFibNumber</code> en changeant l&#8217;espace de stockage <code>slot[1]</code>. En principe, un attaquant pourrait modifier n&#8217;importe quel autre emplacement de stockage de son choix, pour effectuer toutes sortes d&#8217;attaques sur ce contrat. Nous vous encourageons √† mettre ces contrats dans <a href="https://remix.ethereum.org" data-href="https://remix.ethereum.org">Remix</a> et √† exp√©rimenter diff√©rents contrats d&#8217;attaque et changements d&#8217;√©tat via ces fonctions d&#8217;appel d√©l√©gu√© <code>delegatecall</code>.</p>
</div>
<div class="paragraph data-line-596">
<p>Il est √©galement important de noter que lorsque nous disons que l&#8217;appel <code>delegatecall</code> pr√©serve l&#8217;√©tat, nous ne parlons pas des noms de variables du contrat, mais plut√¥t des emplacements de stockage r√©els vers lesquels ces noms pointent. Comme vous pouvez le voir dans cet exemple, une simple erreur peut conduire un attaquant √† d√©tourner l&#8217;int√©gralit√© du contrat et de son ether.</p>
</div>
</div>
<div class="sect3 notoc data-line-599">
<h4 id="_techniques_pr√©ventives_4">Techniques pr√©ventives</h4>
<div class="paragraph data-line-601">
<p>Solidity fournit le mot-cl√© de <code>library</code> (biblioth√®que) pour la mise en ≈ìuvre des contrats de biblioth√®que (voir la <a href="http://bit.ly/2zjD8TI" data-href="http://bit.ly/2zjD8TI">documentation</a> pour plus de d√©tails). Cela garantit que le contrat de biblioth√®que est sans √©tat et non autodestructible. Forcer les biblioth√®ques √† √™tre sans √©tat att√©nue les complexit√©s du contexte de stockage d√©montr√©es dans cette section. Les biblioth√®ques sans √©tat emp√™chent √©galement les attaques dans lesquelles les attaquants modifient directement l&#8217;√©tat de la biblioth√®que afin d' affecter les contrats qui d√©pendent du code de la biblioth√®que. En r√®gle g√©n√©rale, lorsque vous utilisez <code>DELEGATECALL</code>, faites tr√®s attention au contexte d&#8217;appel possible du contrat de biblioth√®que et du contrat d&#8217;appel, et chaque fois que possible, cr√©ez des <span class="keep-together">biblioth√®ques</span>. sans √©tat.</p>
</div>
</div>
<div class="sect3 data-line-604">
<h4 id="multisig_secondhack">Exemple concret¬†: Parity Multisig Wallet (Second Hack)</h4>
<div class="paragraph data-line-606">
<p>Le deuxi√®me hack de Parity Multisig Wallet est un exemple de la fa√ßon dont un code de biblioth√®que bien √©crit peut √™tre exploit√© s&#8217;il est ex√©cut√© en dehors de son contexte pr√©vu. Il existe un certain nombre de bonnes explications de ce hack, telles que <a href="http://bit.ly/2Dg7GtW" data-href="http://bit.ly/2Dg7GtW">"Parity Multisig Hacked. Encore une fois ¬ª</a> et <a href="http://bit.ly/2Of06B9" data-href="http://bit.ly/2Of06B9">¬´ Un examen approfondi du bogue multisig de parity ¬ª</a>.</p>
</div>
<div class="paragraph data-line-608">
<p>Pour compl√©ter ces r√©f√©rences, explorons les contrats qui ont √©t√© exploit√©s. Les contrats de biblioth√®que et de portefeuille peuvent √™tre trouv√©s <a href="http://bit.ly/2OgnXQC" data-href="http://bit.ly/2OgnXQC">sur GitHub</a> .</p>
</div>
<div class="paragraph data-line-610">
<p>Le contrat de biblioth√®que est le suivant :</p>
</div>
<div class="listingblock data-line-614">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract WalletLibrary is WalletEvents {

  ...

  // lancer sauf si le contrat n'est pas encore initialis√©.
  modifier only_uninitialized { if (m_numOwners &gt; 0) throw; _; }

  // constructeur - il suffit de transmettre le tableau propri√©taire √† multipropri√©t√© et
  // la limite √† daylimit
  function initWallet(address[] _owners, uint _required, uint _daylimit)
      only_uninitialized {
    initDaylimit(_daylimit);
    initMultiowned(_owners, _required);
  }

  // tue le contrat en envoyant tout √† `_to`.
  function kill(address _to) onlymanyowners(sha3(msg.data)) external {
    suicide(_to);
  }

  ...

}</code></pre>
</div>
</div>
<div class="paragraph data-line-640">
<p>Et voici le contrat de portefeuille¬†:</p>
</div>
<div class="listingblock data-line-643">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Wallet is WalletEvents {

  ...
  // M√âTHODES

  // est appel√© lorsqu'aucune autre fonction ne correspond
  function() payable {
    // juste envoyer de l' argent¬†?
    if (msg.value &gt; 0)
      Deposit(msg.sender, msg.value);
    else if (msg.data.length &gt; 0)
      _walletLibrary.delegatecall(msg.data);
  }

  ...

  // DES CHAMPS
  address constant _walletLibrary =
    0xcafecafecafecafecafecafecafecafecafecafe;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-666">
<p>Notez que le contrat <code>Wallet</code> transmet essentiellement tous les appels au contrat <code>WalletLibrary</code> via un appel d√©l√©gu√©. L&#8217;adresse constante <code>_walletLibrary</code> dans cet extrait de code agit comme un espace r√©serv√© pour le d√©ploiement r√©el de contrat <code>WalletLibrary</code> (qui √©tait √† 0x863DF6BFa4469f3ead0bE8f9F2AAE51c91A907b4 ).</p>
</div>
<div class="paragraph data-line-668">
<p>L&#8217;op√©ration voulue de ces contrats est d&#8217;avoir un portefeuille <code>Wallet</code> d√©ployable √† faible co√ªt dont la base de code et les principales fonctionnalit√©s se trouvaient dans le contrat <code>WalletLibrary</code>. Malheureusement, le contrat <code>WalletLibrary</code> est lui-m√™me un contrat et conserve son propre √©tat. Pouvez-vous voir pourquoi cela pourrait √™tre un probl√®me?</p>
</div>
<div class="paragraph data-line-670">
<p>Il est possible d&#8217;envoyer des appels au contrat <code><span class="keep-together">WalletLibrary</span></code> lui-m√™me. Plus pr√©cis√©ment, le contrat <code><span class="keep-together">WalletLibrary</span></code> pourrait √™tre initialis√© et devenir propri√©taire. En fait, un utilisateur a fait cela, appelant la fonction <code>initWallet</code> sur le contrat <code>WalletLibrary</code> et devenant propri√©taire du contrat de biblioth√®que. Le m√™me utilisateur a ensuite appel√© la fonction <code>kill</code> . √âtant donn√© que l&#8217;utilisateur √©tait propri√©taire du contrat de biblioth√®que, le modificateur a √©t√© adopt√© et le contrat de biblioth√®que s&#8217;est auto-d√©truit. Comme tous les contrats <code>Wallet</code> existants se r√©f√®rent √† ce contrat de biblioth√®que et ne contiennent aucune m√©thode pour modifier cette r√©f√©rence, toutes leurs fonctionnalit√©s, y compris la possibilit√© de retirer de l&#8217;ether, ont √©t√© perdues avec le contrat <code>WalletLibrary</code> . En cons√©quence, tout l&#8217;ether de tous les portefeuilles multisig Parity de ce type a √©t√© instantan√©ment perdu ou d√©finitivement irr√©cup√©rable..</p>
</div>
</div>
</div>
<div class="sect2 data-line-672">
<h3 id="_visibilit√©s_par_d√©faut">Visibilit√©s par d√©faut</h3>
<div class="paragraph data-line-674">
<p>Les fonctions dans Solidity ont des sp√©cificateurs de visibilit√© qui dictent comment elles peuvent √™tre appel√©es. La visibilit√© d√©termine si une fonction peut √™tre appel√©e en externe par les utilisateurs, par d&#8217;autres contrats d√©riv√©s, uniquement en interne ou uniquement en externe. Il existe quatre sp√©cificateurs de visibilit√©, qui sont d√©crits en d√©tail dans la <a href="http://bit.ly/2ABiv7j" data-href="http://bit.ly/2ABiv7j">documentation Solidity</a>. Les fonctions sont par d√©faut √† <code>public</code> , permettant aux utilisateurs de les appeler de l&#8217;ext√©rieur. Nous allons maintenant voir comment une utilisation incorrecte des sp√©cificateurs de visibilit√© peut entra√Æner des vuln√©rabilit√©s d√©vastatrices dans les contrats intelligents.</p>
</div>
<div class="sect3 notoc data-line-677">
<h4 id="_la_vuln√©rabilit√©_5">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-679">
<p>La visibilit√© par d√©faut des fonctions est <code>public</code> , donc les fonctions qui ne sp√©cifient pas leur visibilit√© pourront √™tre appel√©es par des utilisateurs externes. Le probl√®me survient lorsque les d√©veloppeurs omettent par erreur les sp√©cificateurs de visibilit√© sur les fonctions qui devraient √™tre priv√©es (ou uniquement appelables dans le contrat lui-m√™me).</p>
</div>
<div class="paragraph data-line-681">
<p>Explorons rapidement un exemple trivial¬†:</p>
</div>
<div class="listingblock data-line-684">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract HashForEther {

    function withdrawWinnings() {
        // Gagnant si les 8 derniers caract√®res hexad√©cimaux de l'adresse sont 0
        require(uint32(msg.sender) == 0);
        _sendWinnings();
     }

     function _sendWinnings() {
         msg.sender.transfer(this.balance);
     }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-700">
<p>Ce contrat simple est con√ßu pour agir comme un jeu de prime de devinette d&#8217;adresse. Pour remporter le solde du contrat, un utilisateur doit g√©n√©rer une adresse Ethereum dont les 8 derniers caract√®res hexad√©cimaux sont 0. Une fois atteint, il peut appeler la fonction <code>withdrawWinnings</code> pour obtenir sa prime.</p>
</div>
<div class="paragraph data-line-702">
<p>Malheureusement, la visibilit√© des fonctions n&#8217;a pas √©t√© pr√©cis√©e. En particulier, la fonction <code>_sendWinnings</code> est <code>public</code> (par d√©faut), et donc n&#8217;importe quelle adresse peut appeler cette fonction pour voler la prime.</p>
</div>
</div>
<div class="sect3 notoc data-line-705">
<h4 id="_techniques_pr√©ventives_5">Techniques pr√©ventives</h4>
<div class="paragraph data-line-707">
<p>Il est de bonne pratique de toujours sp√©cifier la visibilit√© de toutes les fonctions dans un contrat, m√™me si elles sont intentionnellement <code>public</code>. Les versions r√©centes de solc affichent un avertissement pour les fonctions qui n&#8217;ont pas de visibilit√© explicite d√©finie, pour encourager cette pratique.</p>
</div>
</div>
<div class="sect3 data-line-709">
<h4 id="_exemple_concret_parity_multisig_wallet_premier_hack">Exemple concret¬†: Parity Multisig Wallet (premier hack)</h4>
<div class="paragraph data-line-711">
<p> Dans le premier multisig hack de Parity, environ 31 millions de dollars d&#8217;ether ont √©t√© vol√©s, principalement dans trois portefeuilles. Un bon r√©capitulatif de la fa√ßon exacte dont cela a √©t√© fait est donn√© par <a href="https://bit.ly/2vHiuJQ" data-href="https://bit.ly/2vHiuJQ">Haseeb Qureshi</a>.</p>
</div>
<div class="paragraph data-line-713">
<p>Essentiellement, le portefeuille multisig est construit √† partir d&#8217;un contrat <code>Wallet</code> de base, qui appelle un contrat de biblioth√®que contenant la fonctionnalit√© de base (comme d√©crit dans <a href="#multisig_secondhack">Exemple concret¬†: Parity Multisig Wallet (Second Hack)</a>). Le contrat de biblioth√®que contient le code pour initialiser le portefeuille, comme le montre l&#8217;extrait suivant¬†:</p>
</div>
<div class="listingblock data-line-717">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract WalletLibrary is WalletEvents {

  ...

  // M√âTHODES

  ...

  // le constructeur re√ßoit le nombre de sigs requis pour faire des
  // transactions prot√©g√©s "seulement pour ces propri√©taires" ainsi que
  //  la s√©lection des adresses capable de les confirmer
  function initMultiowned(address[] _owners, uint _required) {
    m_numOwners = _owners.length + 1;
    m_owners[1] = uint(msg.sender);
    m_ownerIndex[uint(msg.sender)] = 1;
    for (uint i = 0; i &lt; _owners.length; ++i)
    {
      m_owners[2 + i] = uint(_owners[i]);
      m_ownerIndex[uint(_owners[i])] = 2 + i;
    }
    m_required = _required;
  }

  ...

  // constructeur - il suffit de transmettre le tableau propri√©taire √† multipropri√©t√© et
  // la limite √† daylimit
  function initWallet(address[] _owners, uint _required, uint _daylimit) {
    initDaylimit(_daylimit);
    initMultiowned(_owners, _required);
  }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-752">
<p>Notez qu&#8217;aucune des fonctions ne sp√©cifie leur visibilit√©, donc les deux sont par d√©faut <code>public</code> . La fonction <code>initWallet</code> est appel√©e dans le constructeur du portefeuille et d√©finit les propri√©taires du portefeuille multisig comme on peut le voir dans la fonction <code>initMultiowned</code> . √âtant donn√© que ces fonctions ont √©t√© accidentellement laiss√©es publiques , un attaquant a pu appeler ces fonctions sur des contrats d√©ploy√©s, r√©initialisant la propri√©t√© √† l&#8217;adresse de l&#8217;attaquant. En tant que propri√©taire, l&#8217;attaquant a ensuite vid√© les portefeuilles de tout leur ether.</p>
</div>
</div>
</div>
<div class="sect2 data-line-756">
<h3 id="entropyillusion_security">Illusion d&#8217;entropie</h3>
<div class="paragraph data-line-758">
<p>Toutes les transactions sur la cha√Æne de blocs Ethereum sont des op√©rations de transition d&#8217;√©tat d√©terministes. Cela signifie que chaque transaction modifie l&#8217;√©tat global de l' √©cosyst√®me Ethereum de mani√®re calculable, sans incertitude. Cela a pour implication fondamentale qu&#8217;il n&#8217;y a pas de source d&#8217;entropie ou d&#8217;al√©atoire dans Ethereum. Atteindre une entropie d√©centralis√©e (al√©atoire) est un probl√®me bien connu pour lequel de nombreuses solutions ont √©t√© propos√©es, y compris <a href="https://github.com/randao/randao" data-href="https://github.com/randao/randao">RANDAO</a> , ou en utilisant une cha√Æne de hachages, comme d√©crit par Vitalik Buterin dans le billet de blog <a href="https://vitalik.ca/files/randomness.html" data-href="https://vitalik.ca/files/randomness.html">¬´ Validator Ordering and Randomness in PoS ¬ª</a>.</p>
</div>
<div class="sect3 notoc data-line-761">
<h4 id="_la_vuln√©rabilit√©_6">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-763">
<p>Certains des premiers contrats construits sur la plate-forme Ethereum √©taient bas√©s sur le jeu. Fondamentalement, le jeu n√©cessite de l&#8217;incertitude (quelque chose sur lequel parier), ce qui rend la construction d&#8217;un syst√®me de jeu sur la cha√Æne de blocs (un syst√®me d√©terministe) plut√¥t difficile. Il est clair que l' incertitude doit provenir d&#8217;une source ext√©rieure √† la cha√Æne de blocs. C&#8217;est possible pour les paris entre joueurs (voir par exemple la <a href="http://bit.ly/2CUh2KS" data-href="http://bit.ly/2CUh2KS">technique commit‚Äìreveal</a>); cependant, c&#8217;est beaucoup plus difficile si vous voulez mettre en place un contrat pour agir en tant que "croupier" (comme au blackjack ou √† la roulette). Un √©cueil courant consiste √† utiliser des variables de bloc futures, c&#8217;est-√†-dire des variables contenant des informations sur le bloc de transaction dont les valeurs ne sont pas encore connues, telles que des hachages, des horodatages, des num√©ros de bloc ou des limites de gaz. Le probl√®me avec ceux-ci est qu&#8217;ils sont contr√¥l√©s par le mineur qui exploite le bloc et, en tant que tels, ne sont pas vraiment al√©atoires. Consid√©rez, par exemple, un contrat intelligent de roulette avec une logique qui renvoie un nombre noir si le hachage du bloc suivant se termine par un nombre pair. Un mineur (ou pool de mineurs) pourrait parier 1 million de dollars sur le noir. S&#8217;ils r√©solvent le bloc suivant et trouvent que le hachage se termine par un nombre impair, ils pourraient heureusement ne pas publier leur bloc et en exploiter un autre, jusqu&#8217;√† ce qu&#8217;ils trouvent une solution avec le hachage du bloc √©tant un nombre pair (en supposant que la r√©compense du bloc et les frais sont inf√©rieurs √† 1 M$). L&#8217;utilisation de variables pass√©es ou pr√©sentes peut √™tre encore plus d√©vastatrice, comme le d√©montre Martin Swende dans son excellent <a href="http://martin.swende.se/blog/Breaking_the_house.html" data-href="http://martin.swende.se/blog/Breaking_the_house.html">article de blog</a>. De plus, utiliser uniquement des variables de bloc signifie que le nombre pseudo-al√©atoire sera le m√™me pour toutes les transactions d&#8217;un bloc, de sorte qu&#8217;un attaquant peut multiplier ses gains en effectuant de nombreuses transactions dans un bloc (si il devait y avoir une mise maximale).</p>
</div>
</div>
<div class="sect3 notoc data-line-766">
<h4 id="_techniques_pr√©ventives_6">Techniques pr√©ventives</h4>
<div class="paragraph data-line-768">
<p>La source d&#8217;entropie (al√©atoire) doit √™tre externe √† la cha√Æne de blocs. Cela peut √™tre fait entre pairs avec des syst√®mes tels que <a href="http://bit.ly/2CUh2KS" data-href="http://bit.ly/2CUh2KS">commit‚Äìreveal</a>, ou en changeant le mod√®le de confiance en un groupe de participants (comme dans <a href="https://github.com/randao/randao" data-href="https://github.com/randao/randao">RandDAO</a>). Cela peut √©galement √™tre fait via une entit√© centralis√©e qui agit comme un oracle al√©atoire. Les variables de bloc (en g√©n√©ral, il y a quelques exceptions) ne doivent pas √™tre utilis√©es pour g√©n√©rer de l&#8217;entropie, car elles peuvent √™tre manipul√©es par les mineurs.</p>
</div>
</div>
<div class="sect3 data-line-770">
<h4 id="_exemple_concret_contrats_prng">Exemple concret¬†: contrats PRNG</h4>
<div class="paragraph data-line-772">
<p>En f√©vrier 2018 Arseny Reutov <a href="http://bit.ly/2Q589lx" data-href="http://bit.ly/2Q589lx">a blogu√©</a> sur son analyse de 3 649 contrats intelligents en direct qui utilisaient une sorte de g√©n√©rateur de nombres pseudo-al√©atoires (PRNG)¬†; il a trouv√© 43 contrats qui pourraient √™tre exploit√©s.</p>
</div>
</div>
</div>
<div class="sect2 data-line-775">
<h3 id="external_contract_referencing">R√©f√©rencement des contrats externes</h3>
<div class="paragraph data-line-777">
<p>L&#8217;un des avantages de "l&#8217;ordinateur mondial" Ethereum est la possibilit√© de r√©utiliser du code et d&#8217;interagir avec des contrats d√©j√† d√©ploy√©s sur le r√©seau. En cons√©quence, un grand nombre de contrats font r√©f√©rence √† des contrats externes, g√©n√©ralement via des appels de messages externes. Ces appels de messages externes peuvent masquer les intentions des acteurs malveillants de certaines mani√®res non √©videntes, que nous allons maintenant examiner.</p>
</div>
<div class="sect3 notoc data-line-780">
<h4 id="_la_vuln√©rabilit√©_7">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-782">
<p>Dans Solidity, n&#8217;importe quelle adresse peut √™tre convertie en contrat, que le code √† l&#8217;adresse repr√©sente ou non le type de contrat en cours de conversion. Cela peut causer des probl√®mes, en particulier lorsque l&#8217;auteur du contrat tente de dissimuler un code malveillant. Illustrons cela par un exemple.</p>
</div>
<div class="paragraph data-line-784">
<p>Consid√©rez un morceau de code comme <a href="#rot13_security">Rot13Encryption.sol</a>, qui impl√©mente rudimentairement le <a href="https://en.wikipedia.org/wiki/ROT13" data-href="https://en.wikipedia.org/wiki/ROT13">chiffrement ROT13</a> .</p>
</div>
<div id="rot13_security" class="exampleblock data-line-788">
<div class="title">Example 14. Rot13Encryption.sol</div>
<div class="content">
<div class="listingblock data-line-790">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// contrat de chiffrement
contract Rot13Encryption {

   event Result(string convertedString);

    // rot13-chiffre une cha√Æne
    function rot13Encrypt (string text) public {
        uint256 length = bytes(text).length;
        for (var i = 0; i &lt; length; i++) {
            byte char = bytes(text)[i];
            // assemblage en ligne pour modifier la cha√Æne
            assembly {
                // r√©cup√®re le premier octet
                char := byte(0,char)
                // si le caract√®re est dans [ n,z ], c'est-√†-dire l'enveloppant
                if and(gt(char,0x6D), lt(char,0x7B))
                // soustraire du nombre ASCII 'a',
                // la diff√©rence entre le caract√®re &lt;char&gt; et 'z'
                { char:= sub(0x60, sub(0x7A,char)) }
                if iszero(eq(char, 0x20)) // ignore spaces
                // ajoute 13 au caract√®re
                {mstore8(add(add(text,0x20), mul(i,1)), add(char,13))}
            }
        }
        emit Result(text);
    }

    // rot13-d√©chiffre une cha√Æne
    function rot13Decrypt (string text) public {
        uint256 length = bytes(text).length;
        for (var i = 0; i &lt; length; i++) {
            byte char = bytes(text)[i];
            assembly {
                char := byte(0,char)
                if and(gt(char,0x60), lt(char,0x6E))
                { char:= add(0x7B, sub(char,0x61)) }
                if iszero(eq(char, 0x20))
                {mstore8(add(add(text,0x20), mul(i,1)), sub(char,13))}
            }
        }
        emit Result(text);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-837">
<p>Ce code prend simplement une cha√Æne (lettres a √† z, sans validation) et l'<em>encrypte</em> en d√©calant chaque caract√®re de 13 positions vers la droite (en s&#8217;enroulant autour de <code>z</code>); c&#8217;est-√†-dire <code>a</code> passe √† <code>n</code> et <code>x</code> passe √† <code>k</code>. L&#8217;assemblage dans le contrat pr√©c√©dent n&#8217;a pas besoin d&#8217;√™tre compris pour appr√©cier le probl√®me discut√©, de sorte que les lecteurs non familiaris√©s avec l&#8217;assemblage peuvent l&#8217;ignorer en toute s√©curit√©.</p>
</div>
<div class="paragraph data-line-839">
<p>Consid√©rons maintenant le contrat suivant, qui utilise ce code pour son chiffrement¬†:</p>
</div>
<div class="listingblock data-line-842">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Rot13Encryption.sol";

// crypte vos informations top-secr√®tes
contract EncryptionContract {
    // biblioth√®que pour le chiffrement
    Rot13Encryption encryptionLibrary;

    // constructeur - initialise la biblioth√®que
    constructor(Rot13Encryption _encryptionLibrary) {
        encryptionLibrary = _encryptionLibrary;
    }

    function encryptPrivateData(string privateInfo) {
        // faire potentiellement quelques op√©rations ici
        encryptionLibrary.rot13Encrypt(privateInfo);
     }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-863">
<p>Le probl√®me avec ce contrat est que l&#8217;adresse de <code>encryptionLibrary</code> n&#8217;est pas publique ou constante. Ainsi, le d√©ployeur du contrat pourrait donner une adresse dans le constructeur qui pointe vers ce contrat :</p>
</div>
<div class="listingblock data-line-867">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// contrat de chiffrement
contract Rot26Encryption {

   event Result(string convertedString);

    // rot13-encrypte une cha√Æne
    function rot13Encrypt (string text) public {
        uint256 length = bytes(text).length;
        for (var i = 0; i &lt; length; i++) {
            byte char = bytes(text)[i];
            // assemblage en ligne pour modifier la cha√Æne
            assembly {
                // r√©cup√®re le premier octet
                char := byte(0,char)
                // si le caract√®re est dans [ n,z ], c'est-√†-dire l'enveloppant
                if and(gt(char,0x6D), lt(char,0x7B))
                // soustraire du nombre ASCII 'a',
                // la diff√©rence entre le caract√®re &lt;char&gt; et 'z'
                { char:= sub(0x60, sub(0x7A,char)) }
                // ignore les espaces
                if iszero(eq(char, 0x20))
                // ajoute 26 au caract√®re¬†!
                {mstore8(add(add(text,0x20), mul(i,1)), add(char,26))}
            }
        }
        emit Result(text);
    }

    // rot13-d√©crypte une cha√Æne
    function rot13Decrypt (string text) public {
        uint256 length = bytes(text).length;
        for (var i = 0; i &lt; length; i++) {
            byte char = bytes(text)[i];
            assembly {
                char := byte(0,char)
                if and(gt(char,0x60), lt(char,0x6E))
                { char:= add(0x7B, sub(char,0x61)) }
                if iszero(eq(char, 0x20))
                {mstore8(add(add(text,0x20), mul(i,1)), sub(char,26))}
            }
        }
        emit Result(text);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-914">
<p>Ce contrat impl√©mente le chiffrement ROT26, qui d√©cale chaque caract√®re de 26 places (c&#8217;est-√†-dire, ne fait rien). Encore une fois, il n&#8217;est pas n√©cessaire de comprendre l&#8217;assemblage dans ce contrat. Plus simplement, l&#8217;attaquant aurait pu lier le contrat suivant au m√™me effet¬†:</p>
</div>
<div class="listingblock data-line-917">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Print{
    event Print(string text);

    function rot13Encrypt(string text) public {
        emit Print(text);
    }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-927">
<p>Si l&#8217;adresse de l&#8217;un de ces contrats √©tait donn√©e dans le constructeur, la fonction <code>encryptPrivateData</code> produirait simplement un √©v√©nement qui imprime les donn√©es priv√©es non chiffr√©es.</p>
</div>
<div class="paragraph data-line-929">
<p>Bien que dans cet exemple, un contrat de type biblioth√®que ait √©t√© d√©fini dans le constructeur, il arrive souvent qu&#8217;un utilisateur privil√©gi√© (tel qu&#8217;un propri√©taire) puisse modifier les adresses de contrat de biblioth√®que. Si un contrat li√© ne contient pas la fonction appel√©e, la fonction de secours s&#8217;ex√©cutera. Par exemple, avec la ligne <code>encryptionLibrary.rot13&#x200b;Encrypt()</code>, si le contrat sp√©cifi√© par <code>encryptionLibrary</code> √©tait¬†:</p>
</div>
<div class="listingblock data-line-932">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity"> contract Blank {
     event Print(string text);
     function () {
         emit Print("Here");
         // placez le code malveillant ici et il s'ex√©cutera
     }
 }</code></pre>
</div>
</div>
<div class="paragraph data-line-942">
<p>alors un √©v√©nement avec le texte <code>Here</code> serait √©mis. Ainsi, si les utilisateurs peuvent modifier les biblioth√®ques de contrats, ils peuvent en principe amener d&#8217;autres utilisateurs √† ex√©cuter du code arbitraire sans le savoir.</p>
</div>
<div class="admonitionblock warning data-line-945">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-946">
<p>Les contrats repr√©sent√©s ici sont uniquement √† des fins de d√©monstration et ne repr√©sentent pas un cryptage appropri√©. Ils ne devrait pas √™tre utilis√© pour le cryptage .</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 notoc data-line-950">
<h4 id="_techniques_pr√©ventives_7">Techniques pr√©ventives</h4>
<div class="paragraph data-line-952">
<p>Comme d√©montr√© pr√©c√©demment, les contrats s√ªrs peuvent (dans certains cas) √™tre d√©ploy√©s de telle mani√®re qu&#8217;ils se comportent de mani√®re malveillante. Un auditeur pourrait v√©rifier publiquement un contrat et demander √† son propri√©taire de le d√©ployer de mani√®re malveillante, ce qui entra√Ænerait un contrat audit√© publiquement pr√©sentant des vuln√©rabilit√©s ou une intention malveillante.</p>
</div>
<div class="paragraph data-line-954">
<p>Il existe un certain nombre de techniques qui emp√™chent ces sc√©narios.</p>
</div>
<div class="paragraph data-line-956">
<p>Une technique consiste √† utiliser le mot-cl√© <code>new</code> pour cr√©er des contrats. Dans l&#8217;exemple pr√©c√©dent, le constructeur pourrait s&#8217;√©crire :</p>
</div>
<div class="listingblock data-line-959">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">constructor() {
    encryptionLibrary = new Rot13Encryption();
}</code></pre>
</div>
</div>
<div class="paragraph data-line-965">
<p>de cette mani√®re, une instance du contrat r√©f√©renc√© est cr√©√©e au moment du d√©ploiement et le d√©ployeur ne peut pas remplacer le contrat <code>Rot13Encryption</code> sans le modifier.</p>
</div>
<div class="paragraph data-line-967">
<p>Une autre solution consiste √† coder en dur les adresses de contrat externes.</p>
</div>
<div class="paragraph data-line-969">
<p>En g√©n√©ral, le code qui appelle des contrats externes doit toujours √™tre audit√© avec soin. En tant que d√©veloppeur, lors de la d√©finition de contrats externes, il peut √™tre judicieux de rendre publiques les adresses des contrats (ce qui n&#8217;est pas le cas dans l&#8217;exemple du pot de miel de la section suivante) pour permettre aux utilisateurs d&#8217;examiner facilement le code r√©f√©renc√© par le contrat. Inversement, si un contrat a une adresse de contrat en variable priv√©e, cela peut √™tre le signe d&#8217;un comportement malveillant (comme le montre l&#8217;exemple du monde r√©el). Si un utilisateur peut modifier une adresse de contrat utilis√©e pour appeler des fonctions externes, il peut √™tre important (dans un contexte de syst√®me d√©centralis√©) d&#8217;impl√©menter un m√©canisme de verrouillage du temps et/ou de vote pour permettre aux utilisateurs de voir quel code est modifi√©, ou pour donner aux participants la possibilit√© de s&#8217;inscrire ou s&#8217;abstenir avec la nouvelle adresse contractuelle.</p>
</div>
</div>
<div class="sect3 data-line-971">
<h4 id="_exemple_concret_pot_de_miel_de_r√©entrance">Exemple concret¬†: pot de miel de r√©entrance</h4>
<div class="paragraph data-line-973">
<p>Un certain nombre de pots de miel r√©cents ont √©t√© publi√©s sur le r√©seau principal. Ces contrats tentent de d√©jouer les pirates Ethereum qui tentent d&#8217;exploiter les contrats, mais qui finissent par perdre de l&#8217;ether au profit du contrat qu&#8217;ils s&#8217;attendent √† exploiter. Un exemple utilise cette attaque en rempla√ßant un contrat attendu par un contrat malveillant dans le constructeur. Le code se trouve <a href="http://bit.ly/2JtdqRi" data-href="http://bit.ly/2JtdqRi">ici</a> :</p>
</div>
<div class="listingblock data-line-976">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.19;

contract Private_Bank
{
    mapping (address =&gt; uint) public balances;
    uint public MinDeposit = 1 ether;
    Log TransferLog;

    function Private_Bank(address _log)
    {
        TransferLog = Log(_log);
    }

    function Deposit()
    public
    payable
    {
        if(msg.value &gt;= MinDeposit)
        {
            balances[msg.sender]+=msg.value;
            TransferLog.AddMessage(msg.sender,msg.value,"Deposit");
        }
    }

    function CashOut(uint _am)
    {
        if(_am&lt;=balances[msg.sender])
        {
            if(msg.sender.call.value(_am)())
            {
                balances[msg.sender]-=_am;
                TransferLog.AddMessage(msg.sender,_am,"CashOut");
            }
        }
    }

    function() external payable{}

}

contract Log
{
    struct Message
    {
        address Sender;
        string  Data;
        uint Val;
        uint  Time;
    }

    Message[] public History;
    Message LastMsg;

    function AddMessage(address _adr,uint _val,string _data)
    public
    {
        LastMsg.Sender = _adr;
        LastMsg.Time = now;
        LastMsg.Val = _val;
        LastMsg.Data = _data;
        History.push(LastMsg);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1042">
<p>Ce <a href="http://bit.ly/2Q58VyX" data-href="http://bit.ly/2Q58VyX">message</a> d&#8217;un utilisateur de reddit explique comment il a perdu 1 ether √† cause de ce contrat en essayant d&#8217;exploiter le bogue de r√©entrance qu&#8217;il s&#8217;attendait √† trouver dans le contrat..</p>
</div>
</div>
</div>
<div class="sect2 data-line-1044">
<h3 id="_attaque_par_adresse_courteparam√®tre">Attaque par adresse courte/param√®tre</h3>
<div class="paragraph data-line-1046">
<p>Cette attaque n&#8217;est pas effectu√©e sur les contrats Solidity eux-m√™mes, mais sur des applications tierces susceptibles d&#8217;interagir avec eux. Cette section est ajout√©e par souci d&#8217;exhaustivit√© et pour donner au lecteur une id√©e de la fa√ßon dont les param√®tres peuvent √™tre manipul√©s dans les contrats.</p>
</div>
<div class="paragraph data-line-1048">
<p>Pour en savoir plus, consultez <a href="http://bit.ly/2yKme14" data-href="http://bit.ly/2yKme14">¬´ The ERC20 Short Address Attack Explained ¬ª</a> , <a href="http://bit.ly/2yFOGRQ" data-href="http://bit.ly/2yFOGRQ">¬´ ICO Smart Contract Vulnerability : Short Address Attack ¬ª</a> , ou ce <a href="http://bit.ly/2CQjBhc" data-href="http://bit.ly/2CQjBhc">post Reddit</a> .</p>
</div>
<div class="sect3 notoc data-line-1051">
<h4 id="_la_vuln√©rabilit√©_8">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1053">
<p>Lors de la transmission de param√®tres √† un contrat intelligent, les param√®tres sont cod√©s conform√©ment √† la <a href="http://bit.ly/2Q5VIG9" data-href="http://bit.ly/2Q5VIG9">sp√©cification ABI</a> . Il est possible d&#8217;envoyer des param√®tres cod√©s plus courts que la longueur de param√®tre attendue (par exemple, envoyer une adresse qui ne contient que 38 caract√®res hexad√©cimaux (19 octets) au lieu des 40 caract√®res hexad√©cimaux standard (20 octets)). Dans un tel sc√©nario, l&#8217;EVM ajoutera des z√©ros √† la fin des param√®tres cod√©s pour compenser la longueur attendue.</p>
</div>
<div class="paragraph data-line-1055">
<p>Cela devient un probl√®me lorsque les applications tierces ne valident pas les entr√©es. L&#8217;exemple le plus clair est un √©change qui ne v√©rifie pas l&#8217;adresse d&#8217;un jeton ERC20 lorsqu&#8217;un utilisateur demande un retrait. Cet exemple est trait√© plus en d√©tail dans l&#8217;article de Peter Vessenes , <a href="http://bit.ly/2Q1ybpQ" data-href="http://bit.ly/2Q1ybpQ">"The ERC20 Short Address Attack Explained"</a> .</p>
</div>
<div class="paragraph data-line-1057">
<p>Consid√©rez l&#8217;interface de fonction de transfert standard <a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">ERC20</a> , en notant l&#8217;ordre des param√®tres¬†:</p>
</div>
<div class="listingblock data-line-1060">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function transfer(address to, uint tokens) public returns (bool success);</code></pre>
</div>
</div>
<div class="paragraph data-line-1064">
<p>Consid√©rons maintenant un √©change d√©tenant une grande quantit√© d&#8217;un jeton (disons <code>REP</code>) et un utilisateur qui souhaite retirer sa part de 100 jetons. L&#8217;utilisateur soumettrait son adresse, <code>0xdeaddeaddeaddeaddeaddeaddeaddeaddeaddead</code> , et le nombre de jetons, <code>100</code>. L&#8217;√©change coderait ces param√®tres dans l&#8217;ordre sp√©cifi√© par la fonction <code><span class="keep-together">transfer</span></code>; c&#8217;est-√†-dire <code>address</code> puis <code>tokens</code> . Le r√©sultat encod√© serait :</p>
</div>
<div class="listingblock data-line-1066">
<div class="content">
<pre>a9059cbb000000000000000000000000deaddeaddea \
ddeaddeaddeaddeaddeaddeaddead0000000000000
000000000000000000000000000000000056bc75e2d63100000</pre>
</div>
</div>
<div class="paragraph data-line-1072">
<p>Les 4 premiers octets ( <code>a9059cbb</code> ) sont <a href="http://bit.ly/2RmueMP" data-href="http://bit.ly/2RmueMP">la signature ou le s√©lecteur de fonction</a> de <code>transfer</code>, les 32 octets suivants sont l&#8217;adresse et les 32 derniers octets repr√©sentent le nombre <code>uint256</code> de jetons. Notez que l&#8217;hex <code>56bc75e2d63100000</code> √† la fin correspond √† 100 jetons (avec 18 d√©cimales, comme sp√©cifi√© par le contrat de jeton REP ).</p>
</div>
<div class="paragraph data-line-1074">
<p>Voyons maintenant ce qui se passerait si l&#8217;on envoyait une adresse √† laquelle il manquait 1 octet (2 chiffres hexad√©cimaux). Plus pr√©cis√©ment, disons qu&#8217;un attaquant envoie <code>0xdeaddeaddeaddeaddeaddeaddeaddeadde</code> comme adresse (il manque les deux derniers chiffres) et les m√™mes 100 jetons √† retirer. Si l&#8217;√©change ne valide pas cette entr√©e, elle sera encod√©e comme¬†:</p>
</div>
<div class="listingblock data-line-1076">
<div class="content">
<pre>a9059cbb000000000000000000000000deaddeaddea \
ddeaddeaddeaddeaddeaddeadde00000000000000
00000000000000000000000000000000056bc75e2d6310000000</pre>
</div>
</div>
<div class="paragraph data-line-1082">
<p>La diff√©rence est subtile. Notez que <code>00</code> a √©t√© ajout√© √† la fin de l&#8217;encodage, pour compenser l&#8217;adresse courte qui a √©t√© envoy√©e. Lorsque cela est envoy√© au contrat intelligent, les param√®tres de <code>address</code> seront lus comme <code>0xdeaddeaddeaddeaddeaddeaddeaddeadde00</code> et la valeur sera lue comme <code>56bc75e2d6310000000</code> (notez les deux 0 suppl√©mentaires). Cette valeur est maintenant de <code>25600</code> jetons (la valeur a √©t√© multipli√©e par <code>256</code>). Dans cet exemple, si l&#8217;√©change contenait autant de jetons, l&#8217;utilisateur retirerait <code>25600</code> jetons (alors que l&#8217;√©change pense que l&#8217;utilisateur n&#8217;en retire que <code>100</code>) √† l&#8217;adresse modifi√©e. √âvidemment , l&#8217;attaquant ne poss√©dera pas l&#8217;adresse modifi√©e dans cet exemple, mais si l&#8217;attaquant devait g√©n√©rer une adresse qui se terminait par des 0 (qui peut √™tre facilement forc√©e brutalement) et utilisait cette adresse g√©n√©r√©e, il pourrait voler des jetons √† l&#8217;√©change sans m√©fiance.</p>
</div>
</div>
<div class="sect3 notoc data-line-1085">
<h4 id="_techniques_pr√©ventives_8">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1087">
<p>Tous les param√®tres d&#8217;entr√©e dans les applications externes doivent √™tre valid√©s avant de les envoyer √† la cha√Æne de blocs. Il convient √©galement de noter que l&#8217;ordre des param√®tres joue ici un r√¥le important. Comme le rembourrage ne se produit qu&#8217;√† la fin, un ordre minutieux des param√®tres dans le contrat intelligent peut att√©nuer certaines formes de cette attaque.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1089">
<h3 id="_valeurs_de_retour_call_non_v√©rifi√©s">Valeurs de retour CALL non v√©rifi√©s</h3>
<div class="paragraph data-line-1091">
<p>Il existe plusieurs fa√ßons d&#8217;effectuer des appels externes dans Solidity. L&#8217;envoi d&#8217;ether √† des comptes externes est g√©n√©ralement effectu√© via la m√©thode <code>transfer</code> . Cependant, la fonction d&#8217;envoi <code>send</code> peut √©galement √™tre utilis√©e, et pour des appels externes plus polyvalents, l' opcode <code>CALL</code> peut √™tre directement utilis√© dans Solidity. Les fonctions d&#8217;appel <code>call</code> et d&#8217;envoi <code>send</code> renvoient un bool√©en indiquant si l&#8217;appel a r√©ussi ou √©chou√©. Ainsi, ces fonctions ont une simple mise en garde, en ce sens que la transaction qui ex√©cute ces fonctions ne reviendra pas si l&#8217;appel externe ( initialis√© par <code>call</code> ou <code>send</code> ) √©choue; √† la place, les fonctions renverront simplement <code>false</code>. Une erreur courante est que le d√©veloppeur s&#8217;attend √† ce qu&#8217;un retour se produise si l&#8217;appel externe √©choue et ne v√©rifie pas la valeur de retour.</p>
</div>
<div class="paragraph data-line-1093">
<p>Pour en savoir plus, consultez le num√©ro 4 du <a href="http://www.dasp.co/#item-4" data-href="http://www.dasp.co/#item-4">Top 10 DASP de 2018</a> et <a href="http://bit.ly/2RnS1vA" data-href="http://bit.ly/2RnS1vA">"Scanning Live Ethereum Contracts for the 'Unchecked-Send' Bug"</a>.</p>
</div>
<div class="sect3 notoc data-line-1096">
<h4 id="_la_vuln√©rabilit√©_9">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1098">
<p>Consid√©rez l&#8217;exemple suivant¬†:</p>
</div>
<div class="listingblock data-line-1101">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Lotto {

    bool public payedOut = false;
    address public winner;
    uint public winAmount;

    // ... fonctionnalit√© suppl√©mentaire ici

    function sendToWinner() public {
        require(!payedOut);
        winner.send(winAmount);
        payedOut = true;
    }

    function withdrawLeftOver() public {
        require(payedOut);
        msg.sender.send(this.balance);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1123">
<p>Cela repr√©sente un contrat de type Lotto, o√π un gagnant <code>winner</code> re√ßoit une quantit√© d&#8217;ether (<code>winAmount</code>), ce qui laisse g√©n√©ralement un peu de reste √† retirer.</p>
</div>
<div class="paragraph data-line-1125">
<p>La vuln√©rabilit√© existe sur la ligne 11, o√π un envoi <code>send</code> est utilis√© sans v√©rifier la r√©ponse. Dans cet exemple trivial, un gagnant <code>winner</code> dont la transaction √©choue (soit parce qu&#8217;il est √† court d&#8217;essence, soit parce qu&#8217;il s&#8217;agit d&#8217;un contrat qui lance intentionnellement la fonction de secours) permet √† <code>payedOut</code> d&#8217;√™tre d√©fini sur <code>true</code>, que l&#8217;ether ait √©t√© envoy√© ou non. Dans ce cas, n&#8217;importe qui peut retirer les gains du gagnant <code>winner</code> via la fonction <code>withdrawLeftOver</code>.</p>
</div>
</div>
<div class="sect3 notoc data-line-1128">
<h4 id="_techniques_pr√©ventives_9">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1130">
<p>Dans la mesure du possible, utilisez la fonction <code>transfer</code> plut√¥t que <code>send</code>, car le transfert sera annul√© si la transaction externe est annul√©e. Si un envoi <code>send</code> est requis, v√©rifiez toujours la valeur de retour.</p>
</div>
<div class="paragraph data-line-1132">
<p>Une <a href="http://bit.ly/2CSdF7y" data-href="http://bit.ly/2CSdF7y">recommandation</a> plus robuste est d&#8217;adopter un <em>mod√®le de retrait</em> . Dans cette solution, chaque utilisateur doit appeler une fonction de retrait isol√©e qui g√®re l&#8217;envoi d&#8217;ether hors du contrat et traite les cons√©quences des transactions d&#8217;envoi √©chou√©es. L&#8217;id√©e est d&#8217;isoler logiquement la fonctionnalit√© d&#8217;envoi externe du reste de la base de code et de placer le fardeau d&#8217;une transaction potentiellement √©chou√©e sur l&#8217;utilisateur final appelant la fonction de retrait.</p>
</div>
</div>
<div class="sect3 data-line-1134">
<h4 id="_exemple_concret_etherpot_et_king_of_the_ether">Exemple concret¬†: Etherpot et King of the Ether</h4>
<div class="paragraph data-line-1136">
<p><a href="http://bit.ly/2OfHalK" data-href="http://bit.ly/2OfHalK">Etherpot</a> √©tait une loterie de contrats intelligents, pas trop diff√©rente de l&#8217;exemple de contrat mentionn√© pr√©c√©demment. La chute de ce contrat √©tait principalement due √† une utilisation incorrecte des hachages de bloc (seuls les 256 derniers hachages de bloc sont utilisables ; voir le <a href="http://bit.ly/2Jpzf4x" data-href="http://bit.ly/2Jpzf4x">post d&#8217;Aakil Fernandes</a> sur la mani√®re dont Etherpot n&#8217;a pas r√©ussi √† en tenir compte correctement). Cependant, ce contrat a √©galement souffert d&#8217;une valeur d&#8217;appel non contr√¥l√©e. Consid√©rez la fonction <code>cash</code> dans <a href="#lotto_security">lotto.sol: Code snippet</a>.</p>
</div>
<div id="lotto_security" class="exampleblock data-line-1140">
<div class="title">Example 15. lotto.sol: Code snippet</div>
<div class="content">
<div class="listingblock data-line-1142">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">...
  function cash(uint roundIndex, uint subpotIndex){

        var subpotsCount = getSubpotsCount(roundIndex);

        if(subpotIndex&gt;=subpotsCount)
            return;

        var decisionBlockNumber = getDecisionBlockNumber(roundIndex,subpotIndex);

        if(decisionBlockNumber&gt;block.number)
            return;

        if(rounds[roundIndex].isCashed[subpotIndex])
            return;
        // Les sous-cagnottes ne peuvent √™tre encaiss√©s qu'une seule fois. C'est pour √©viter les doubles paiements
        var winner = calculateWinner(roundIndex,subpotIndex);
        var subpot = getSubpot(roundIndex);

        winner.send(subpot);

        rounds[roundIndex].isCashed[subpotIndex] = true;
        // Marquer le tour comme encaiss√©
}
...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1171">
<p>Notez qu&#8217;√† la ligne 21, la valeur de retour de la fonction <code>send</code> n&#8217;est pas v√©rifi√©e, et la ligne suivante d√©finit alors un bool√©en indiquant que le gagnant a re√ßu ses fonds. Ce bogue peut autoriser un √©tat o√π le gagnant ne re√ßoit pas son ether, mais l&#8217;√©tat du contrat peut indiquer que le gagnant a d√©j√† √©t√© pay√©.</p>
</div>
<div class="paragraph data-line-1173">
<p>Une version plus s√©rieuse de ce bogue s&#8217;est produite dans le <a href="http://bit.ly/2ACsfi1" data-href="http://bit.ly/2ACsfi1">King of the Ether</a>. Un excellent <a href="http://bit.ly/2ESoaub" data-href="http://bit.ly/2ESoaub">post-mortem</a> de ce contrat a √©t√© √©crit qui d√©taille comment un envoi √©chou√© non contr√¥l√© pourrait √™tre utilis√© pour attaquer le <span class="keep-together">contrat</span>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1176">
<h3 id="frontrunning_security">Conditions de course/devancement</h3>
<div class="paragraph data-line-1178">
<p>La combinaison d&#8217;appels externes √† d&#8217;autres contrats et la nature multi-utilisateurs de la cha√Æne de blocs sous-jacente donnent lieu √† une vari√©t√© de pi√®ges potentiels de Solidity dans lesquels les utilisateurs font la <em>course</em> √† l&#8217;ex√©cution du code pour obtenir des √©tats inattendus. La r√©entrance (discut√©e plus haut dans ce chapitre) est un exemple d&#8217;une telle condition de concurrence. Dans cette section, nous discuterons d&#8217;autres types de conditions de concurrence pouvant survenir sur la cha√Æne de blocs Ethereum. Il existe une vari√©t√© de bons articles sur ce sujet, y compris "Race Conditions" sur le <a href="http://bit.ly/2yFesFF" data-href="http://bit.ly/2yFesFF">Wiki Ethereum</a> , <a href="http://www.dasp.co/#item-7" data-href="http://www.dasp.co/#item-7">#7 sur le DASP Top10 de 2018</a> , et les <a href="http://bit.ly/2Q6E4lP" data-href="http://bit.ly/2Q6E4lP">meilleures pratiques pour les contrats intelligents Ethereum</a> .</p>
</div>
<div class="sect3 notoc data-line-1181">
<h4 id="_la_vuln√©rabilit√©_10">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1183">
<p>Comme avec la plupart des cha√Ænes de blocs, les n≈ìuds Ethereum regroupent les transactions et les forment en blocs. Les transactions ne sont consid√©r√©es comme valides qu&#8217;une fois qu&#8217;un mineur a r√©solu un m√©canisme de consensus (actuellement <a href="http://bit.ly/2yI5Dv7" data-href="http://bit.ly/2yI5Dv7">Ethash</a> PoW (preuve de travail) pour Ethereum). Le mineur qui r√©sout le bloc choisit √©galement les transactions du bassin qui seront incluses dans le bloc, g√©n√©ralement class√©es par le <code>gasPrice</code> de chaque transaction. Voici un vecteur d&#8217;attaque potentiel. Un attaquant peut surveiller le bassin de transactions √† la recherche de transactions susceptibles de contenir des solutions √† des probl√®mes, et modifier ou r√©voquer les autorisations du solveur ou changer l&#8217;√©tat d&#8217;un contrat au d√©triment du solveur. L&#8217;attaquant peut alors obtenir les donn√©es de cette transaction et cr√©er sa propre transaction avec un <code>gasPrice</code> plus √©lev√© afin que sa transaction soit incluse dans un bloc avant l&#8217;original.</p>
</div>
<div class="paragraph data-line-1185">
<p>Voyons comment cela pourrait fonctionner avec un exemple simple. Consid√©rez le contrat affich√© dans <a href="#findthishash_security">FindThisHash.sol</a>.</p>
</div>
<div id="findthishash_security" class="exampleblock data-line-1189">
<div class="title">Example 16. FindThisHash.sol</div>
<div class="content">
<div class="listingblock data-line-1191">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract FindThisHash {
    bytes32 constant public hash =
      0xb5b5b97fafd9855eec9b41f74dfb6c38f5951141f9a3ecd7f44d5479b630ee0a;

    constructor() external payable {} // load with ether

    function solve(string solution) public {
        // Si vous pouvez trouver la pr√©-image du hachage, recevez 1000 ether
        require(hash == sha3(solution));
        msg.sender.transfer(1000 ether);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1207">
<p>Supposons que ce contrat contienne 1 000 ether . L&#8217;utilisateur qui peut trouver la pr√©image du hachage SHA-3 suivant¬†:</p>
</div>
<div class="listingblock data-line-1209">
<div class="content">
<pre>0xb5b5b97fafd9855eec9b41f74dfb6c38f5951141f9a3ecd7f44d5479b630ee0a</pre>
</div>
</div>
<div class="paragraph data-line-1213">
<p>peut soumettre la solution et r√©cup√©rer les 1 000 ethers . Disons qu&#8217;un utilisateur d√©couvre que la solution est <code>Ethereum!</code>. Ils appellent <code>resolve</code> (r√©soudre) avec <code>Ethereum!</code> comme param√®tre. Malheureusement, un attaquant a √©t√© assez intelligent pour surveiller le bassin de transactions pour toute personne soumettant une solution. Ils voient cette solution, v√©rifient sa validit√©, puis soumettent une transaction √©quivalente avec un <code>gasPrice</code> beaucoup plus √©lev√© que la transaction d&#8217;origine. Le mineur qui r√©sout le bloc donnera probablement la pr√©f√©rence √† l&#8217;attaquant en raison du <code>gasPrice</code> plus √©lev√© et exploitera sa transaction avant celle du solveur d&#8217;origine. L&#8217;attaquant prendra les 1 000 ethers et l&#8217;utilisateur qui a r√©solu le probl√®me n&#8217;obtiendra rien. Gardez √† l&#8217;esprit que dans ce type de vuln√©rabilit√© de "devancement", les mineurs sont particuli√®rement incit√©s √† ex√©cuter les attaques eux-m√™mes (ou peuvent √™tre soudoy√©s pour ex√©cuter ces attaques avec des frais extravagants). La possibilit√© que l&#8217;attaquant soit lui-m√™me un mineur ne doit pas √™tre sous-estim√©e.</p>
</div>
</div>
<div class="sect3 notoc data-line-1216">
<h4 id="_techniques_pr√©ventives_10">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1218">
<p>Il existe deux classes d&#8217;acteurs qui peuvent effectuer ce type d&#8217;attaques de devancement: les utilisateurs (qui modifient la valeur du <code>gasPrice</code> de leurs transactions) et les mineurs eux-m√™mes (qui peuvent r√©organiser les transactions dans un bloc comme ils l&#8217;entendent). Un contrat vuln√©rable √† la premi√®re classe (utilisateurs) est nettement moins bien loti qu&#8217;un contrat vuln√©rable √† la seconde (mineurs), car les mineurs ne peuvent effectuer l&#8217;attaque que lorsqu&#8217;ils r√©solvent un bloc, ce qui est peu probable pour un mineur individuel ciblant un bloc sp√©cifique. Nous √©num√©rerons ici quelques mesures d&#8217;att√©nuation relatives aux deux classes d&#8217;attaquants.</p>
</div>
<div class="paragraph data-line-1220">
<p>Une m√©thode consiste √† placer une limite sup√©rieure sur le <code>gasPrice</code>. Cela emp√™che les utilisateurs d&#8217;augmenter le <code>gasPrice</code> et d&#8217;obtenir un ordre de transaction pr√©f√©rentiel au-del√† de la limite sup√©rieure. Cette mesure prot√®ge uniquement contre la premi√®re classe d&#8217;attaquants (utilisateurs arbitraires). Les mineurs dans ce sc√©nario peuvent toujours attaquer le contrat, car ils peuvent commander les transactions dans leur bloc comme ils le souhaitent, quel que soit le prix du gaz.</p>
</div>
<div class="paragraph data-line-1222">
<p>Une m√©thode plus robuste consiste √† utiliser un sch√©ma de <a href="http://bit.ly/2CUh2KS" data-href="http://bit.ly/2CUh2KS">validation-r√©v√©lation</a>. Un tel syst√®me dicte que les utilisateurs envoient des transactions avec des informations cach√©es (g√©n√©ralement un hachage). Une fois la transaction incluse dans un bloc, l&#8217;utilisateur envoie une transaction r√©v√©lant les donn√©es qui ont √©t√© envoy√©es (la phase de r√©v√©lation). Cette m√©thode emp√™che les mineurs et les utilisateurs d&#8217;ex√©cuter des transactions en amont, car ils ne peuvent pas d√©terminer le contenu de la transaction. Cette m√©thode, cependant, ne peut pas dissimuler la valeur de la transaction (qui, dans certains cas, est l&#8217;information pr√©cieuse qui doit √™tre cach√©e). Le contrat intelligent <a href="https://ens.domains/" data-href="https://ens.domains/">ENS</a> permettait aux utilisateurs d&#8217;envoyer des transactions dont les donn√©es engag√©es comprenaient la quantit√© d&#8217;ether qu&#8217;ils √©taient pr√™ts √† d√©penser. Les utilisateurs pourraient alors envoyer des transactions de valeur arbitraire. Au cours de la phase de r√©v√©lation, les utilisateurs ont √©t√© rembours√©s de la diff√©rence entre le montant envoy√© lors de la transaction et le montant qu&#8217;ils √©taient pr√™ts √† d√©penser.</p>
</div>
<div class="paragraph data-line-1224">
<p>Une autre suggestion de Lorenz Breidenbach, Phil Daian , Ari Juels et Florian Tram√®r est d&#8217;utiliser des <a href="http://bit.ly/2SygqQx" data-href="http://bit.ly/2SygqQx">"envois sous-marins"</a>. Une impl√©mentation efficace de cette id√©e n√©cessite l' opcode <code>CREATE2</code>, qui n&#8217;a actuellement pas √©t√© adopt√© mais semble susceptible de l&#8217;√™tre dans les embranchements √† venir.</p>
</div>
</div>
<div class="sect3 data-line-1226">
<h4 id="_exemples_concrets_erc20_et_bancor">Exemples concrets¬†: ERC20 et Bancor</h4>
<div class="paragraph data-line-1228">
<p>La <a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">norme ERC20</a> est assez connue pour la construction de jetons sur Ethereum. Cette norme pr√©sente une vuln√©rabilit√© de devancement potentielle due √† la fonction d&#8217;approbation <code>approve</code>. <a href="http://bit.ly/2DbvQpJ" data-href="http://bit.ly/2DbvQpJ">Mikhail Vladimirov et Dmitry Khovratovich</a> ont √©crit une bonne explication de cette vuln√©rabilit√© (et des moyens d&#8217;att√©nuer l&#8217;attaque).</p>
</div>
<div class="paragraph data-line-1230">
<p>La norme sp√©cifie la fonction d' approbation <code>approve</code> comme suit¬†:</p>
</div>
<div class="listingblock data-line-1233">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function approve(address _spender, uint256 _value) returns (bool success)</code></pre>
</div>
</div>
<div class="paragraph data-line-1237">
<p>Cette fonction permet √† un utilisateur d&#8217;autoriser d&#8217;autres utilisateurs √† transf√©rer des jetons en son nom. La vuln√©rabilit√© de devancement se produit dans le sc√©nario o√π une utilisatrice Alice <em>autorise</em> son ami Bob √† d√©penser 100 jetons. Alice d√©cide plus tard qu&#8217;elle veut r√©voquer l&#8217;autorisation de Bob de d√©penser, disons, 100 jetons, alors elle cr√©e une transaction qui fixe l&#8217;allocation de Bob √† 50 jetons. Bob, qui a observ√© attentivement la cha√Æne, voit cette transaction et construit sa propre transaction en d√©pensant les 100 jetons. Il met un <code>gasPrice</code> plus √©lev√© sur sa transaction que celle d&#8217;Alice, donc sa transaction est prioritaire sur la sienne. Certaines impl√©mentations d' approbation <code>approve</code> permettraient √† Bob de transf√©rer ses 100 jetons, puis, lorsque la transaction d&#8217;Alice est valid√©e, r√©initialiserait l&#8217;approbation de Bob √† 50 jetons, donnant ainsi √† Bob l&#8217;acc√®s √† 150 jetons.</p>
</div>
<div class="paragraph data-line-1239">
<p><a href="https://www.bancor.network/" data-href="https://www.bancor.network/">Bancor</a> est un autre exemple important dans le monde r√©el. Ivan Bogatyy et son √©quipe ont document√© une attaque rentable sur la mise en ≈ìuvre initiale de Bancor. Son <a href="http://bit.ly/2EUlLzb" data-href="http://bit.ly/2EUlLzb">article de blog</a> et <a href="http://bit.ly/2yHgkhs" data-href="http://bit.ly/2yHgkhs">sa conf√©rence DevCon3 expliquent</a> en d√©tail comment cela a √©t√© fait. Essentiellement, les prix des jetons sont d√©termin√©s en fonction de la valeur de la transaction¬†; les utilisateurs peuvent surveiller le bassin de transactions pour les transactions Bancor et les ex√©cuter en amont pour profiter des diff√©rences de prix. Cette attaque a √©t√© trait√©e par l&#8217;√©quipe de Bancor.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1241">
<h3 id="_d√©ni_de_service_dos">D√©ni de service (DoS)</h3>
<div class="paragraph data-line-1243">
<p>Cette cat√©gorie est tr√®s large, mais se compose essentiellement d&#8217;attaques o√π les utilisateurs peuvent rendre un contrat inop√©rant pendant une p√©riode de temps, ou dans certains cas de fa√ßon permanente. Cela peut pi√©ger l&#8217;ether dans ces contrats pour toujours, comme ce fut le cas dans <a href="#multisig_secondhack">Exemple concret¬†: Parity Multisig Wallet (Second Hack)</a>.</p>
</div>
<div class="sect3 notoc data-line-1246">
<h4 id="_la_vuln√©rabilit√©_11">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1248">
<p>Un contrat peut devenir inop√©rant de diff√©rentes mani√®res. Ici, nous mettons en √©vidence quelques mod√®les de codage Solidity moins √©vidents qui peuvent conduire √† des vuln√©rabilit√©s DoS¬†:</p>
</div>
<div class="dlist data-line-1250">
<dl>
<dt class="hdlist1">Boucle √† travers des mappages ou des tableaux manipul√©s en externe</dt>
<dd>
<p>Ce mod√®le appara√Æt g√©n√©ralement lorsqu&#8217;un propri√©taire souhaite distribuer des jetons aux investisseurs avec une fonction de type distribution <code>distribute</code>, comme dans cet exemple de contrat¬†:</p>
</dd>
</dl>
</div>
<div class="exampleblock data-line-1252">
<div class="content">
<div class="listingblock data-line-1254">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract DistributeTokens {
    address public owner; // est d√©fini ailleurs
    address[] investors; // tableau d'investisseurs
    uint[] investorTokens; // quantit√© de jeton que re√ßoivent les investisseurs

    // ... fonctionnalit√© suppl√©mentaire, y compris transfertoken()

    function invest() external payable {
        investors.push(msg.sender);
        investorTokens.push(msg.value * 5); // 5 times the wei sent
        }

    function distribute() public {
        require(msg.sender == owner); // only owner
        for(uint i = 0; i &lt; investors.length; i++) {
            // ici transferToken(to,amount) transf√®re le "montant" de
            // jetons √† l'adresse "to"
            transferToken(investors[i],investorTokens[i]);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1279">
<p>Notez que la boucle de ce contrat s&#8217;ex√©cute sur un tableau qui peut √™tre gonfl√© artificiellement. Un attaquant peut cr√©er de nombreux comptes d&#8217;utilisateurs, ce qui agrandit le tableau des investisseurs <code>investor</code>. En principe, cela peut √™tre fait de telle sorte que le gaz requis pour ex√©cuter la boucle for d√©passe la limite de gaz du bloc, rendant essentiellement la fonction de distribution <code>distribute</code> inop√©rante.</p>
</div>
<div class="dlist data-line-1281">
<dl>
<dt class="hdlist1">Op√©rations du propri√©taire</dt>
<dd>
<p>Un autre mod√®le courant est celui o√π les propri√©taires ont des privil√®ges sp√©cifiques dans les contrats et doivent effectuer certaines t√¢ches pour que le contrat passe √† l&#8217;√©tat suivant. Un exemple serait un contrat d&#8217;offre initiale de pi√®ces (ICO) qui oblige le propri√©taire √† finaliser (<code>finalize</code>) le contrat, ce qui permet ensuite aux jetons d&#8217;√™tre transf√©rables. Par example:</p>
</dd>
</dl>
</div>
<div class="exampleblock data-line-1283">
<div class="content">
<div class="listingblock data-line-1285">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">bool public isFinalized = false;
address public owner; // est d√©fini quelque part

function finalize() public {
    require(msg.sender == owner);
    isFinalized == true;
}

// ... fonctionnalit√© ICO suppl√©mentaire

// fonction de transfert surcharg√©e
function transfer(address _to, uint _value) returns (bool) {
    require(isFinalized);
    super.transfer(_to,_value)
}

...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1306">
<p>Dans de tels cas, si l&#8217;utilisateur privil√©gi√© perd ses cl√©s priv√©es ou devient inactif, l&#8217;ensemble du contrat de jeton devient inop√©rant. Dans ce cas, si le propri√©taire ne peut pas appeler <span class="keep-together"><code>finalize</code></span>, aucun jeton ne peut √™tre transf√©r√©¬†; l&#8217;ensemble du fonctionnement de l&#8217;√©cosyst√®me de jetons repose sur une seule adresse.</p>
</div>
<div class="dlist data-line-1308">
<dl>
<dt class="hdlist1">√âtat de progression bas√© sur les appels externes</dt>
<dd>
<p>Les contrats sont parfois r√©dig√©s de telle sorte que la progression vers un nouvel √©tat n√©cessite l&#8217;envoi d&#8217;ether √† une adresse ou l&#8217;attente d&#8217;une entr√©e d&#8217;une source externe. Ces mod√®les peuvent conduire √† des attaques DoS lorsque l&#8217;appel externe √©choue ou est emp√™ch√© pour des raisons externes. Dans l&#8217;exemple de l&#8217;envoi d&#8217;ether, un utilisateur peut cr√©er un contrat qui n&#8217;accepte pas l&#8217;ether. Si un contrat exige que l&#8217;ether soit retir√© afin de passer √† un nouvel √©tat (consid√©rez un contrat √† verrouillage temporel qui exige que tout l&#8217;ether soit retir√© avant d&#8217;√™tre √† nouveau utilisable), le contrat n&#8217;atteindra jamais le nouvel √©tat, car l&#8217;ether ne peut jamais √™tre envoy√© au contrat de l&#8217;utilisateur qui n&#8217;accepte pas l&#8217;ether.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 notoc data-line-1311">
<h4 id="_techniques_pr√©ventives_11">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1313">
<p>Dans le premier exemple, les contrats ne doivent pas boucler sur des structures de donn√©es pouvant √™tre artificiellement manipul√©es par des utilisateurs externes. Un mod√®le de retrait est recommand√©, dans lequel chacun des investisseurs appelle une fonction de retrait pour r√©clamer des jetons de mani√®re ind√©pendante.</p>
</div>
<div class="paragraph data-line-1315">
<p>Dans le deuxi√®me exemple, un utilisateur privil√©gi√© devait modifier l&#8217;√©tat du contrat. Dans de tels exemples, une s√©curit√© int√©gr√©e peut √™tre utilis√©e dans le cas o√π le propri√©taire deviendrait incapable. Une solution consiste √† faire du propri√©taire un contrat multisig. Une autre solution consiste √† utiliser un verrouillage temporel: dans l&#8217;exemple donn√©, le require √† la ligne 5 pourrait inclure un m√©canisme bas√© sur le temps, tel que <code>require(msg.sender == owner || now &gt; unlockTime)</code> , qui permet √† tout utilisateur de finaliser apr√®s une p√©riode de temps sp√©cifi√©e par <code>unlockTime</code>. Ce type de technique d&#8217;att√©nuation peut √©galement √™tre utilis√© dans le troisi√®me exemple. Si les appels externes doivent progresser vers un nouvel √©tat, tenez compte de leur √©chec possible et ajoutez √©ventuellement une progression d&#8217;√©tat bas√©e sur le temps dans le cas o√π l&#8217;appel souhait√© n&#8217;arrive jamais.</p>
</div>
<div class="admonitionblock note data-line-1318">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1319">
<p>Bien s√ªr, il existe des alternatives centralis√©es √† ces suggestions : on peut ajouter un <code>maintenanceUser</code> qui peut intervenir et r√©soudre les probl√®mes avec les vecteurs d&#8217;attaque bas√©s sur DoS si besoin est. G√©n√©ralement, ces types de contrats posent des probl√®mes de confiance, en raison du pouvoir d&#8217;une telle entit√©.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-1322">
<h4 id="_exemples_concrets_gouvernmental">Exemples concrets¬†: GouvernMental</h4>
<div class="paragraph data-line-1324">
<p><a href="http://governmental.github.io/GovernMental/" data-href="http://governmental.github.io/GovernMental/">GovernMental</a> √©tait un ancien sch√©ma de Ponzi qui accumulait une assez grande quantit√© d&#8217;ether (1 100 ether, √† un moment donn√©). Malheureusement, il √©tait sensible aux vuln√©rabilit√©s DoS mentionn√©es dans cette section. Un <a href="http://bit.ly/2DcgvFc" data-href="http://bit.ly/2DcgvFc">post Reddit</a> par etherik d√©crit comment le contrat exigeait la suppression d&#8217;un grand mappage afin de retirer l&#8217;ether. La suppression de cette cartographie avait un co√ªt en gaz qui d√©passait la limite de gaz du bloc √† l&#8217;√©poque, et il n&#8217;√©tait donc pas possible de retirer les 1 100 ethers . L&#8217;adresse du contrat est <a href="http://bit.ly/2Oh8j7R" data-href="http://bit.ly/2Oh8j7R">0xF45717552f12Ef7cb65e95476F217Ea008167Ae3</a>, et vous pouvez voir dans la transaction <a href="http://bit.ly/2Ogzrnn" data-href="http://bit.ly/2Ogzrnn">0x0d80d67202bd9cb6773df8dd2020e719&thinsp;0a1b0793e8ec4fc105257e8128f0506b</a> que les 1 100 ether ont finalement √©t√© obtenus via 2.5M en frais de gaz (et ce quand la limite du gaz f√ªt augment√©).</p>
</div>
</div>
</div>
<div class="sect2 data-line-1326">
<h3 id="_blocage_de_la_manipulation_de_lhorodatage">Blocage de la manipulation de l&#8217;horodatage</h3>
<div class="paragraph data-line-1328">
<p>Les horodatages de bloc ont historiquement √©t√© utilis√©s pour une vari√©t√© d&#8217;applications, telles que l&#8217;entropie pour les nombres al√©atoires (voir l'<a href="#entropyillusion_security">Illusion d&#8217;entropie</a> pour plus de d√©tails), le verrouillage des fonds pendant des p√©riodes de temps et diverses instructions conditionnelles de changement d&#8217;√©tat qui d√©pendent du temps. Les mineurs ont la possibilit√© d' ajuster l√©g√®rement les horodatages, ce qui peut s&#8217;av√©rer dangereux si les horodatages de bloc sont utilis√©s de mani√®re incorrecte dans les contrats intelligents.</p>
</div>
<div class="paragraph data-line-1330">
<p>Les r√©f√©rences utiles pour cela incluent <a href="http://bit.ly/2OdUC9C" data-href="http://bit.ly/2OdUC9C">la documentation Solidity</a> et <a href="http://bit.ly/2CQ8gh4" data-href="http://bit.ly/2CQ8gh4">la question Ethereum sur Stack Exchange de Joris Bontje</a> sur le sujet.</p>
</div>
<div class="sect3 notoc data-line-1333">
<h4 id="_la_vuln√©rabilit√©_12">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1335">
<p><code>block.timestamp</code> et son alias <code>now</code> peuvent d√©sormais √™tre manipul√©s par les mineurs s&#8217;ils sont incit√©s √† le faire. Construisons un jeu simple, montr√© dans <a href="#roulette_security">roulette.sol</a>, qui serait vuln√©rable √† l&#8217;exploitation des mineurs.</p>
</div>
<div id="roulette_security" class="exampleblock data-line-1339">
<div class="title">Example 17. roulette.sol</div>
<div class="content">
<div class="listingblock data-line-1341">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Roulette {
    uint public pastBlockTime; // force un pari par bloc

    constructor() external payable {} // initialise le financement du contrat

    // fonction de repli utilis√©e pour faire un pari
    function () external payable {
        require(msg.value == 10 ether); // doit envoyer 10 ether pour jouer
        require(now != pastBlockTime); // seulement 1 transaction par bloc
        pastBlockTime = now;
        if(now % 15 == 0) { // winner
            msg.sender.transfer(this.balance);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1360">
<p>Ce contrat se comporte comme une simple loterie. Une transaction par bloc peut parier 10 ethers pour avoir une chance de gagner le solde du contrat. L&#8217;hypoth√®se ici est que les deux derniers chiffres de <code>block.timestamp</code> sont uniform√©ment distribu√©s. Si tel √©tait le cas, il y aurait 1 chance sur 15 de gagner √† cette loterie.</p>
</div>
<div class="paragraph data-line-1362">
<p>Cependant, comme nous le savons, les mineurs peuvent ajuster l&#8217;horodatage s&#8217;ils en ont besoin. Dans ce cas particulier, s&#8217;il y a suffisamment d&#8217;ether dans le contrat, un mineur qui r√©sout un bloc est incit√© √† choisir un horodatage tel que <code>block.timestamp</code> ou <code>now</code> modulo 15 est <code>0</code>. Ce faisant, ils peuvent gagner l&#8217;ether verrouill√© dans ce contrat avec la r√©compense globale. Comme il n&#8217;y a qu&#8217;une seule personne autoris√©e √† parier par bloc, cela est √©galement vuln√©rable aux attaques de d√©passement (voir <a href="#frontrunning_security">Conditions de course/devancement</a> pour plus de d√©tails).</p>
</div>
<div class="paragraph data-line-1364">
<p>En pratique, les horodatages de bloc augmentent de mani√®re monotone et les mineurs ne peuvent donc pas choisir des horodatages de bloc arbitraires (ils doivent √™tre post√©rieurs √† leurs pr√©d√©cesseurs). Ils sont √©galement limit√©s √† d√©finir des heures de bloc pas trop √©loign√©es dans le futur, car ces blocs seront probablement rejet√©s par le r√©seau (les n≈ìuds ne valideront pas les blocs dont les horodatages sont dans le futur).</p>
</div>
</div>
<div class="sect3 notoc data-line-1367">
<h4 id="_techniques_pr√©ventives_12">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1369">
<p>Les horodatages de bloc ne doivent pas √™tre utilis√©s pour l&#8217;entropie ou la g√©n√©ration de nombres al√©atoires, c&#8217;est-√†-dire qu&#8217;ils ne doivent pas √™tre le facteur d√©cisif (directement ou par d√©rivation) pour gagner un jeu ou changer un √©tat important.</p>
</div>
<div class="paragraph data-line-1371">
<p>Une logique sensible au temps est parfois n√©cessaire¬†; par exemple, pour d√©bloquer des contrats (verrou temporel), remplir une ICO apr√®s quelques semaines ou faire respecter des dates d&#8217;expiration. Il est parfois recommand√© d&#8217;utiliser <a href="http://bit.ly/2OdUC9C" data-href="http://bit.ly/2OdUC9C"><code>block.number</code></a> et un temps de bloc moyen pour estimer les temps; avec un temps de bloc de <code>10 secondes</code>, <code>1 semaine</code> √©quivaut √† environ <code>60 480 blocs</code>. Ainsi, sp√©cifier un num√©ro de bloc auquel changer un √©tat de contrat peut √™tre plus s√ªr, car les mineurs sont incapables de manipuler facilement le num√©ro de bloc. Le contrat <a href="http://bit.ly/2AAebFr" data-href="http://bit.ly/2AAebFr">BAT ICO</a> a employ√© cette strat√©gie.</p>
</div>
<div class="paragraph data-line-1373">
<p>Cela peut √™tre inutile si les contrats ne sont pas particuli√®rement concern√©s par les manipulations des mineurs de l&#8217;horodatage du bloc, mais c&#8217;est quelque chose dont il faut √™tre conscient lors de l&#8217;√©laboration des contrats.</p>
</div>
</div>
<div class="sect3 data-line-1375">
<h4 id="_exemple_concret_governmental">Exemple concret¬†: GovernMental</h4>
<div class="paragraph data-line-1377">
<p><a href="http://governmental.github.io/GovernMental/" data-href="http://governmental.github.io/GovernMental/">GovernMental</a>, l&#8217;ancien sch√©ma de Ponzi mentionn√© ci-dessus, √©tait √©galement vuln√©rable √† une attaque bas√©e sur l&#8217;horodatage. Le contrat est pay√© au joueur qui a √©t√© le dernier joueur √† rejoindre (pendant au moins une minute) un tour. Ainsi, un mineur qui √©tait un joueur pouvait ajuster l&#8217;horodatage (√† une heure future, pour donner l&#8217;impression qu&#8217;une minute s&#8217;√©tait √©coul√©e) pour faire appara√Ætre qu&#8217;il √©tait le dernier joueur √† rejoindre pendant plus d&#8217;une minute (m√™me si ce n&#8217;√©tait pas vrai dans la r√©alit√©). Plus de d√©tails √† ce sujet peuvent √™tre trouv√©s dans le <a href="http://bit.ly/2Q1AMA6" data-href="http://bit.ly/2Q1AMA6">post "Historique des vuln√©rabilit√©s de s√©curit√© d&#8217;Ethereum, des piratages et de leurs correctifs"</a> par Tanya <span class="keep-together">Bahrynovska</span>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1379">
<h3 id="_constructeurs_avec_soin">Constructeurs avec soin</h3>
<div class="paragraph data-line-1381">
<p>Les constructeurs sont des fonctions sp√©ciales qui effectuent souvent des t√¢ches critiques et privil√©gi√©es lors de l&#8217;initialisation des contrats. Avant Solidity v0.4.22, les constructeurs √©taient d√©finis comme des fonctions portant le m√™me nom que le contrat qui les contenait. Dans de tels cas, lorsque le nom du contrat est modifi√© au cours du d√©veloppement, si le nom du constructeur n&#8217;est pas √©galement modifi√©, il devient une fonction appelable normale. Comme vous pouvez l&#8217;imaginer, cela peut conduire (et a conduit) √† des hacks de contrats int√©ressants.</p>
</div>
<div class="paragraph data-line-1383">
<p>Pour plus d&#8217;informations, le lecteur peut √™tre int√©ress√© √† tenter les <a href="https://github.com/OpenZeppelin/ethernaut" data-href="https://github.com/OpenZeppelin/ethernaut">d√©fis Ethernaut</a> (en particulier le niveau Fallout).</p>
</div>
<div class="sect3 notoc data-line-1386">
<h4 id="_la_vuln√©rabilit√©_13">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1388">
<p>Si le nom du contrat est modifi√©, ou s&#8217;il y a une faute de frappe dans le nom du constructeur qui ne correspond pas au nom du contrat, le constructeur se comportera comme une fonction normale. Cela peut avoir des cons√©quences d√©sastreuses, surtout si le constructeur effectue des op√©rations privil√©gi√©es. Consid√©rez le contrat suivant :</p>
</div>
<div class="exampleblock data-line-1390">
<div class="content">
<div class="listingblock data-line-1392">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract OwnerWallet {
    address public owner;
    // constructeur
    function ownerWallet(address _owner) public {
        owner = _owner;
    }

    // Par d√©faut. R√©cup√©rer de l'ether.
    function () payable {}

    function withdraw() public {
        require(msg.sender == owner);
        msg.sender.transfer(this.balance);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1411">
<p>Ce contrat collecte de l&#8217;ether et permet uniquement au propri√©taire de le retirer, en appelant la fonction de retrait <code>withdraw</code>. Le probl√®me se pose car le constructeur ne porte pas exactement le m√™me nom que le contrat : la premi√®re lettre est diff√©rente ! Ainsi, n&#8217;importe quel utilisateur peut appeler la fonction <code>ownerWallet</code>, se d√©finir comme propri√©taire, puis prendre tout l&#8217;ether du contrat en appelant <code>withdraw</code>.</p>
</div>
</div>
<div class="sect3 notoc data-line-1414">
<h4 id="_techniques_pr√©ventives_13">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1416">
<p>Ce probl√®me a √©t√© r√©solu dans la version 0.4.22 du compilateur Solidity. Cette version a introduit un mot cl√© <code>constructor</code> qui sp√©cifie le constructeur, plut√¥t que d&#8217;exiger que le nom de la fonction corresponde au nom du contrat. L&#8217;utilisation de ce mot-cl√© pour sp√©cifier les constructeurs est recommand√©e pour √©viter les probl√®mes de nommage.</p>
</div>
</div>
<div class="sect3 data-line-1418">
<h4 id="_exemple_concret_rubixi">Exemple concret¬†: Rubixi</h4>
<div class="paragraph data-line-1420">
<p><a href="http://bit.ly/2ESWG7t" data-href="http://bit.ly/2ESWG7t">Rubixi</a> √©tait un autre syst√®me pyramidal qui pr√©sentait ce type de vuln√©rabilit√©. Il s&#8217;appelait √† l&#8217;origine <code>DynamicPyramid</code> , mais le nom du contrat a √©t√© modifi√© avant le d√©ploiement sur <code>Rubixi</code>. Le nom du constructeur n&#8217;a pas √©t√© modifi√©, permettant √† n&#8217;importe quel utilisateur de devenir le cr√©ateur. Des discussions int√©ressantes li√©es √† ce bogue peuvent √™tre trouv√©es sur <a href="http://bit.ly/2P0TRWw" data-href="http://bit.ly/2P0TRWw">Bitcointalk</a>. En fin de compte, cela a permis aux utilisateurs de se battre pour le statut de cr√©ateur afin de r√©clamer les frais du syst√®me pyramidal. Plus de d√©tails sur ce bogue particulier peuvent √™tre trouv√©s dans <a href="http://bit.ly/2Q1AMA6" data-href="http://bit.ly/2Q1AMA6">"Historique des vuln√©rabilit√©s de s√©curit√© d&#8217;Ethereum, des piratages et de leurs correctifs"</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1422">
<h3 id="_pointeurs_de_stockage_non_initialis√©s">Pointeurs de stockage non initialis√©s</h3>
<div class="paragraph data-line-1424">
<p>L&#8217;EVM stocke les donn√©es sous forme de stockage (disque, par exemple) ou de m√©moire. Il est fortement recommand√© de comprendre exactement comment cela se fait et les types par d√©faut des variables locales des fonctions lors du d√©veloppement de contrats. En effet, il est possible de produire des contrats vuln√©rables en initialisant de mani√®re inappropri√©e des variables.</p>
</div>
<div class="paragraph data-line-1426">
<p>Pour en savoir plus sur le stockage et la m√©moire dans l&#8217;EVM, consultez la documentation de Solidity sur <a href="http://bit.ly/2OdUU0l" data-href="http://bit.ly/2OdUU0l">l&#8217;emplacement des donn√©es</a> , la <a href="http://bit.ly/2JslDWf" data-href="http://bit.ly/2JslDWf">disposition des variables d&#8217;√©tat dans le stockage</a> et <a href="http://bit.ly/2Dch2Hc" data-href="http://bit.ly/2Dch2Hc">la disposition dans la m√©moire</a>.</p>
</div>
<div class="admonitionblock note data-line-1429">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1430">
<p>Cette section est bas√©e sur un excellent <a href="http://bit.ly/2ERI0pb" data-href="http://bit.ly/2ERI0pb">article de Stefan Beyer</a>. D&#8217;autres lectures sur ce sujet, inspir√©es par Stefan, peuvent √™tre trouv√©es dans ce <a href="http://bit.ly/2OgxPtG" data-href="http://bit.ly/2OgxPtG">fil Reddit</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 notoc data-line-1434">
<h4 id="_la_vuln√©rabilit√©_14">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1436">
<p>Les variables locales dans les fonctions sont par d√©faut le stockage ou la m√©moire en fonction de leur type. Les variables de stockage local non initialis√©es peuvent contenir la valeur d&#8217;autres variables de stockage dans le contrat¬†; ce fait peut provoquer des vuln√©rabilit√©s involontaires ou √™tre exploit√© d√©lib√©r√©ment.</p>
</div>
<div class="paragraph data-line-1438">
<p>Consid√©rons le contrat de bureau d&#8217;enregistrement de noms relativement simple dans <a href="#nameregistrar_security">NameRegistrar.sol</a>.</p>
</div>
<div id="nameregistrar_security" class="exampleblock data-line-1442">
<div class="title">Example 18. NameRegistrar.sol</div>
<div class="content">
<div class="listingblock data-line-1444">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Un bureau d'enregistrement de noms verrouill√©
contract NameRegistrar {

    bool public unlocked = false;  // bureau d'enregistrement verrouill√©, pas de mises √† jour de nom

    struct NameRecord { // mappe les hachages aux adresses
        bytes32 name;
        address mappedAddress;
    }

    // enregistre les noms
    mapping(address =&gt; NameRecord) public registeredNameRecord;
    // r√©sout les hachages en adresses
    mapping(bytes32 =&gt; address) public resolve;

    function register(bytes32 _name, address _mappedAddress) public {
        // configure le nouveau NameRecord
        NameRecord newRecord;
        newRecord.name = _name;
        newRecord.mappedAddress = _mappedAddress;

        resolve[_name] = _mappedAddress;
        registeredNameRecord[msg.sender] = newRecord;

        require(unlocked); // n'autorise les inscriptions que si le contrat est d√©verrouill√©
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1475">
<p>Ce simple registraire de noms n&#8217;a qu&#8217;une seule fonction. Lorsque le contrat est <code>unlocked</code> (d√©verrouill√©), il permet √† quiconque d&#8217;enregistrer un nom (sous forme de hachage <code>bytes32</code>) et de mapper ce nom √† une adresse. Le bureau d&#8217;enregistrement est initialement verrouill√© et l' exigence <code>require</code> √† la ligne 25 emp√™che le registre d&#8217;ajouter des enregistrements de nom avec <code>register</code>. Il semble que le contrat soit inutilisable, car il n&#8217;y a aucun moyen de d√©verrouiller le registre ! Il existe cependant une vuln√©rabilit√© qui permet l&#8217;enregistrement du nom quelle que soit la variable <code>unlocked</code>.</p>
</div>
<div class="paragraph data-line-1477">
<p>Pour discuter de cette vuln√©rabilit√©, nous devons d&#8217;abord comprendre comment fonctionne le stockage dans Solidity. En tant qu&#8217;aper√ßu de haut niveau (sans aucun d√©tail technique appropri√© - nous vous sugg√©rons de lire les documents Solidity pour un examen appropri√©), les variables d&#8217;√©tat sont stock√©es s√©quentiellement dans les <em>emplacements</em> (ou <em>slots</em>) tels qu&#8217;ils apparaissent dans le contrat (ils peuvent √™tre regroup√©s mais ne sont pas dans ce exemple, donc nous ne nous en pr√©occuperons pas). Ainsi, <code>unlocked</code> existe dans <code>slot[0]</code>, <code>registerNameRecord</code> dans <code>slot[1]</code> , et <code>resolve</code> dans <code>slot[2]</code>, etc. Chacun de ces emplacements a une taille de 32 octets (il y a des complexit√©s suppl√©mentaires avec les mappages, que nous ignorerons pour √† pr√©sent). Le bool√©en <code>unlocked</code> ressemblera √† <code>0x000&#8230;&#8203;0</code> (64 0s, √† l&#8217;exclusion du <code>0x</code>) pour <code>false</code> ou <code>0x000&#8230;&#8203;1</code> (63 0s) pour <code>true</code>. Comme vous pouvez le voir, il y a un important gaspillage de stockage dans cet exemple particulier .</p>
</div>
<div class="paragraph data-line-1479">
<p>La pi√®ce suivante du puzzle est que Solidity place par d√©faut des types de donn√©es complexes, tels que des structures structs, en stockage lors de leur initialisation en tant que variables locales. Par cons√©quent, <span class="keep-together"><code>newRecord</code></span> √† la ligne 18 utilise par d√©faut le stockage. La vuln√©rabilit√© est caus√©e par le fait que <span class="keep-together"><code>newRecord</code></span> n&#8217;est pas initialis√©. Comme il s&#8217;agit par d√©faut du stockage, il est mapp√© sur l&#8217;emplacement de stockage slot[0], qui contient actuellement un pointeur vers <code>unlocked</code>. Notez qu&#8217;aux lignes 19 et 20, nous d√©finissons ensuite <code>newRecord.name</code> sur <code>_name</code> et <code>newRecord.mappedAddress</code> sur <span class="keep-together"><code>_mappedAddress</code></span>; cela met √† jour les emplacements de stockage de slot[0] et slot[1], ce qui modifie √† la fois <code>unlocked</code> et l&#8217;emplacement de stockage associ√© √† <code>registerNameRecord</code>.</p>
</div>
<div class="paragraph data-line-1481">
<p>Cela signifie que <code>unlocked</code> peut √™tre modifi√© directement, simplement par le param√®tre <code>bytes32 _name</code> de la fonction <code>register</code>. Par cons√©quent, si le dernier octet de <code>_name</code> est diff√©rent de z√©ro, il modifiera le dernier octet de storage <code>slot[0]</code> et changera directement <code>unlocked</code> en true . De telles valeurs <code>_name</code> entra√Æneront la r√©ussite de l&#8217;appel <code>require</code> sur la ligne 25, car nous avons d√©fini <code>unlocked</code> sur true . Essayez ceci dans Remix. Notez que la fonction passera si vous utilisez un <code>_name</code> du formulaire¬†:</p>
</div>
<div class="listingblock data-line-1483">
<div class="content">
<pre>0x0000000000000000000000000000000000000000000000000000000000000001</pre>
</div>
</div>
</div>
<div class="sect3 notoc data-line-1488">
<h4 id="_techniques_pr√©ventives_14">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1490">
<p>Solidity affiche un avertissement pour les variables de stockage non initialis√©es¬†; les d√©veloppeurs doivent pr√™ter une attention particuli√®re √† ces avertissements lors de la cr√©ation de contrats intelligents. La version actuelle de Mist (0.10) ne permet pas de compiler ces contrats. Il est souvent recommand√© d&#8217;utiliser explicitement les sp√©cificateurs de m√©moire <code>memory</code> ou de stockage <code>storage</code> lorsqu&#8217;il s&#8217;agit de types complexes, pour s&#8217;assurer qu&#8217;ils se comportent comme pr√©vu.</p>
</div>
</div>
<div class="sect3 data-line-1492">
<h4 id="_exemples_concrets_pots_de_miel_openaddresslottery_et_cryptoroulette">Exemples concrets¬†: Pots de miel OpenAddressLottery et CryptoRoulette</h4>
<div class="paragraph data-line-1494">
<p>Un pot de miel nomm√© <a href="http://bit.ly/2AAVnWD" data-href="http://bit.ly/2AAVnWD">OpenAddressLottery</a> a √©t√© d√©ploy√© qui a utilis√© cette bizarrerie de variable de stockage non initialis√©e pour collecter de l&#8217;ether aupr√®s de certains pirates potentiels. Le contrat est plut√¥t impliqu√©, nous laisserons donc l&#8217;analyse au <a href="http://bit.ly/2OgxPtG" data-href="http://bit.ly/2OgxPtG">fil Reddit</a> o√π l&#8217;attaque est assez clairement expliqu√©e.</p>
</div>
<div class="paragraph data-line-1496">
<p>Un autre pot de miel, <a href="http://bit.ly/2OfNGJ2" data-href="http://bit.ly/2OfNGJ2">CryptoRoulette</a>, a √©galement utilis√© cette astuce pour essayer de collecter de l&#8217;ether. Si vous ne pouvez pas comprendre comment fonctionne l&#8217;attaque, consultez <a href="http://bit.ly/2OVkSL4" data-href="http://bit.ly/2OVkSL4">¬´ Une analyse de quelques contrats de pot de miel Ethereum ¬ª</a> pour un aper√ßu de ce contrat et d&#8217;autres.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1498">
<h3 id="_virgule_flottante_et_de_pr√©cision">Virgule flottante et de pr√©cision</h3>
<div class="paragraph data-line-1500">
<p>Au moment d&#8217;√©crire ces lignes (v0.4.24), Solidity ne prend pas en charge les nombres √† virgule fixe et √† virgule flottante. Cela signifie que les repr√©sentations en virgule flottante doivent √™tre construites avec des types entiers dans Solidity. Cela peut entra√Æner des erreurs et des vuln√©rabilit√©s s&#8217;il n&#8217;est pas mis en ≈ìuvre correctement.</p>
</div>
<div class="admonitionblock note data-line-1503">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1504">
<p>Pour en savoir plus, consultez le <a href="http://bit.ly/2Ogp2Ia" data-href="http://bit.ly/2Ogp2Ia">wiki Ethereum Contract Security Techniques and Tips</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 notoc data-line-1508">
<h4 id="_la_vuln√©rabilit√©_15">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1510">
<p>Comme il n&#8217;y a pas de type √† virgule fixe dans Solidity, les d√©veloppeurs doivent impl√©menter le leur en utilisant les types de donn√©es entiers standard. Il existe un certain nombre de pi√®ges que les d√©veloppeurs peuvent rencontrer au cours de ce processus. Nous allons essayer d&#8217;en souligner quelques-uns dans cette section.</p>
</div>
<div class="paragraph data-line-1512">
<p>Commen√ßons par un exemple de code (nous ignorerons les probl√®mes de soupassement/d√©passement, abord√©s plus haut dans ce chapitre, pour plus de simplicit√©)¬†:</p>
</div>
<div class="exampleblock data-line-1514">
<div class="content">
<div class="listingblock data-line-1516">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract FunWithNumbers {
    uint constant public tokensPerEth = 10;
    uint constant public weiPerEth = 1e18;
    mapping(address =&gt; uint) public balances;

    function buyTokens() external payable {
        // convertit wei en eth, puis multiplie par le taux de jeton
        uint tokens = msg.value/weiPerEth*tokensPerEth;
        balances[msg.sender] += tokens;
    }

    function sellTokens(uint tokens) public {
        require(balances[msg.sender] &gt;= tokens);
        uint eth = tokens/tokensPerEth;
        balances[msg.sender] -= tokens;
        msg.sender.transfer(eth*weiPerEth);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1538">
<p>Ce simple contrat d&#8217;achat/vente de jetons pr√©sente des probl√®mes √©vidents. Bien que les calculs math√©matiques pour l&#8217;achat et la vente de jetons soient corrects, l&#8217;absence de nombres √† virgule flottante donnera des r√©sultats erron√©s. Par exemple, lors de l&#8217;achat de jetons sur la ligne 8, si la valeur est inf√©rieure √† <code>1 ether</code>, la division initiale donnera <code>0</code>, laissant le r√©sultat de la multiplication finale √† <code>0</code> (par exemple, <code>200 wei</code> divis√© par <code>1e18</code> <code>weiPerEth</code> est √©gal √† <code>0</code>). De m√™me, lors de la vente de jetons, tout nombre de jetons inf√©rieur √† <code>10</code> entra√Ænera √©galement <code>0 ether</code>. En fait, l&#8217;arrondi ici est toujours inf√©rieur, donc la vente de <code>29 jetons</code> se traduira par <code>2 ether</code>.</p>
</div>
<div class="paragraph data-line-1540">
<p>Le probl√®me avec ce contrat est que la pr√©cision n&#8217;est qu&#8217;√† l&#8217;ether le plus proche (c&#8217;est-√†-dire 1e18 wei ). Cela peut devenir d√©licat lorsqu&#8217;il s&#8217;agit de d√©cimales dans les jetons <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md" data-href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md">ERC20</a> lorsque vous avez besoin d&#8217;une plus grande pr√©cision.</p>
</div>
</div>
<div class="sect3 notoc data-line-1543">
<h4 id="_techniques_pr√©ventives_15">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1545">
<p>Garder la bonne pr√©cision dans vos contrats intelligents est tr√®s important, en particulier lorsqu&#8217;il s&#8217;agit de ratios et de taux qui refl√®tent des d√©cisions √©conomiques.</p>
</div>
<div class="paragraph data-line-1547">
<p>Vous devez vous assurer que tous les ratios ou taux que vous utilisez permettent de grands num√©rateurs dans les fractions. Par exemple, nous avons utilis√© le taux <code>tokensPerEth</code> dans notre exemple. Il aurait √©t√© pr√©f√©rable d&#8217;utiliser <code>weiPerTokens</code>, qui serait un grand nombre. Pour calculer le nombre correspondant de jetons, nous pourrions faire <code>msg.value/weiPerTokens</code>. Cela donnerait un r√©sultat plus pr√©cis.</p>
</div>
<div class="paragraph data-line-1549">
<p>Une autre tactique √† garder √† l&#8217;esprit est l&#8217;ordre des op√©rations. Dans notre exemple, le calcul pour acheter des jetons √©tait <code>msg.value/weiPerEth*tokenPerEth</code>. Notez que la division se produit avant la multiplication. (Solidity, contrairement √† certains langages, garantit d&#8217;effectuer les op√©rations dans l&#8217;ordre dans lequel elles sont √©crites.) Cet exemple aurait atteint une plus grande pr√©cision si le calcul effectuait d&#8217;abord la multiplication puis la division; c&#8217;est-√†-dire <code>msg.value*tokenPerEth/weiPerEth</code>.</p>
</div>
<div class="paragraph data-line-1551">
<p>Enfin, lors de la d√©finition d&#8217;une pr√©cision arbitraire pour les nombres, il peut √™tre judicieux de convertir les valeurs en une pr√©cision sup√©rieure, d&#8217;effectuer toutes les op√©rations math√©matiques, puis de les reconvertir finalement √† la pr√©cision requise pour la sortie. G√©n√©ralement, les <code>uint256</code> sont utilis√©s (car ils sont optimaux pour l&#8217;utilisation du gaz); ceux-ci donnent environ 60 ordres de grandeur dans leur gamme, dont certains peuvent √™tre d√©di√©s √† la pr√©cision des op√©rations math√©matiques. Il se peut qu&#8217;il soit pr√©f√©rable de conserver toutes les variables en haute pr√©cision dans Solidity et de les reconvertir en pr√©cisions inf√©rieures dans les applications externes (c&#8217;est essentiellement ainsi que fonctionne la variable d√©cimale dans les contrats de jeton ERC20). Pour voir un exemple de la fa√ßon dont cela peut √™tre fait, nous vous recommandons de regarder <a href="https://github.com/dapphub/ds-math" data-href="https://github.com/dapphub/ds-math">DS-Math</a>. Il utilise des noms funky ("wads" et "rays"), mais le concept est utile.</p>
</div>
</div>
<div class="sect3 data-line-1553">
<h4 id="_exemple_concret_ethstick">Exemple concret¬†: Ethstick</h4>
<div class="paragraph data-line-1555">
<p>Le <a href="http://bit.ly/2Qb7PSB" data-href="http://bit.ly/2Qb7PSB">contrat Ethstick</a> n&#8217;utilise pas la pr√©cision √©tendue; cependant, il traite de wei. Donc, ce contrat aura des probl√®mes d&#8217;arrondi, mais seulement au niveau de pr√©cision wei. Il a quelques d√©fauts plus graves, mais ceux-ci sont li√©s √† la difficult√© d&#8217;obtenir de l&#8217;entropie sur la cha√Æne de blocs (voir <a href="#entropyillusion_security">Illusion d&#8217;entropie</a>). Pour une discussion plus approfondie du contrat Ethstick, nous vous renverrons √† un autre article de Peter Vessenes, <a href="http://bit.ly/2SwDnE0" data-href="http://bit.ly/2SwDnE0">"Les contrats Ethereum vont √™tre des bonbons pour les pirates"</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1557">
<h3 id="_authentification_tx_origin">Authentification Tx.Origin</h3>
<div class="paragraph data-line-1559">
<p>Solidity a une variable globale, <code>tx.origin</code>, qui parcourt toute la pile d&#8217;appels et contient l&#8217;adresse du compte qui a initialement envoy√© l&#8217;appel (ou la transaction). L&#8217;utilisation de cette variable pour l&#8217;authentification dans un contrat intelligent rend le contrat vuln√©rable √† une attaque de type hame√ßonnage.</p>
</div>
<div class="admonitionblock note data-line-1562">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1563">
<p>Pour en savoir plus, consultez la question Ethereum sur <a href="http://bit.ly/2PxU1UM" data-href="http://bit.ly/2PxU1UM">Stack Exchange de dbryson</a> , <a href="http://bit.ly/2qm7ocJ" data-href="http://bit.ly/2qm7ocJ">"Tx.Origin and Ethereum Oh My!"</a> de Peter Vessenes et <a href="http://bit.ly/2P3KVA4" data-href="http://bit.ly/2P3KVA4">"Solidity¬†: Tx Origin Attacks"</a> de Chris Coverdale.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 notoc data-line-1567">
<h4 id="_la_vuln√©rabilit√©_16">La vuln√©rabilit√©</h4>
<div class="paragraph data-line-1569">
<p>Les contrats qui autorisent les utilisateurs √† utiliser la variable <code>tx.origin</code> sont g√©n√©ralement vuln√©rables aux attaques de phishing qui peuvent inciter les utilisateurs √† effectuer des actions authentifi√©es sur le contrat vuln√©rable. Consid√©rez le contrat simple dans <a href="#phishable_security">Phishable.sol</a>.</p>
</div>
<div id="phishable_security" class="exampleblock data-line-1573">
<div class="title">Example 19. Phishable.sol</div>
<div class="content">
<div class="listingblock data-line-1575">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract Phishable {
    address public owner;

    constructor (address _owner) {
        owner = _owner;
    }

    function () external payable {} // recevoir ether

    function withdrawAll(address _recipient) public {
        require(tx.origin == owner);
        _recipient.transfer(this.balance);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-1593">
<p>Notez qu&#8217;√† la ligne 11 le contrat autorise la fonction <code>withdrawAll</code> en utilisant <code>tx.origin</code>. Ce contrat permet √† un attaquant de cr√©er un contrat d&#8217;attaque de la forme :</p>
</div>
<div class="listingblock data-line-1596">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">import "Phishable.sol";

contract AttackContract {

    Phishable phishableContract;
    address attacker; // L'adresse de l'attaquant pour recevoir les fonds

    constructor (Phishable _phishableContract, address _attackerAddress) {
        phishableContract = _phishableContract;
        attacker = _attackerAddress;
    }

    function () payable {
        phishableContract.withdrawAll(attacker);
    }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1615">
<p>L&#8217;attaquant pourrait d√©guiser ce contrat en sa propre adresse priv√©e et organiser socialement la victime (le propri√©taire du contrat Phishable ) pour envoyer une forme de transaction √† l&#8217;adresse, peut-√™tre en envoyant ce contrat une certaine quantit√© d&#8217;ether. La victime, √† moins d&#8217;√™tre prudente, peut ne pas remarquer qu&#8217;il y a du code √† l&#8217;adresse de l&#8217;attaquant, ou l&#8217;attaquant peut le faire passer pour un portefeuille multisignature ou un portefeuille de stockage avanc√© (rappelez-vous que le code source des contrats publics n&#8217;est pas disponible par d√©faut) .</p>
</div>
<div class="paragraph data-line-1617">
<p>Dans tous les cas, si la victime envoie une transaction avec suffisamment de gaz √† l' adresse <code>AttackContract</code>, elle invoquera la fonction de secours, qui √† son tour appellera la fonction <code>withdrawAll</code> du contrat <code>Phishable</code> avec le param√®tre <code>attacker</code>. Cela entra√Ænera le retrait de tous les fonds du contrat <code>Phishable</code> √† l&#8217;adresse de l' attaquant <code>attacker</code>. C&#8217;est parce que l&#8217;adresse qui a initialement initialis√© l&#8217;appel √©tait la victime (c&#8217;est-√†-dire le propri√©taire du contrat <code>Phishable</code>). Par cons√©quent, <code>tx.origin</code> sera √©gal √† <code>owner</code> et l' exigence <code>require</code> √† la ligne 11 du contrat <code>Phishable</code> passera.</p>
</div>
</div>
<div class="sect3 notoc data-line-1620">
<h4 id="_techniques_pr√©ventives_16">Techniques pr√©ventives</h4>
<div class="paragraph data-line-1622">
<p><code>tx.origin</code> ne doit pas √™tre utilis√© pour l&#8217;autorisation dans les contrats intelligents. Cela ne veut pas dire que la variable <code>tx.origin</code> ne doit jamais √™tre utilis√©e. Il existe des cas d&#8217;utilisation l√©gitimes dans les contrats intelligents. Par exemple, si l&#8217;on voulait emp√™cher les contrats externes d&#8217;appeler le contrat actuel, on pourrait impl√©menter un <code>require</code> de la forme <code>require(tx.origin==msg.sender)</code>. Cela emp√™che l&#8217;utilisation de contrats interm√©diaires pour appeler le contrat en cours, limitant le contrat √† des adresses sans code r√©gulier.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1625">
<h3 id="contract_libraries_sec">Contrats de biblioth√®ques</h3>
<div class="paragraph data-line-1627">
<p>De nombreux codes existants sont disponibles pour √™tre r√©utilis√©s, √† la fois d√©ploy√©s en cha√Æne en tant que biblioth√®ques appelables et hors cha√Æne en tant que biblioth√®ques de mod√®les de code. Les biblioth√®ques sur plate-forme, ayant √©t√© d√©ploy√©es, existent sous forme de contrats intelligents en code interm√©diaire (bytecode), il faut donc faire tr√®s attention avant de les utiliser en production. Cependant, l&#8217;utilisation de biblioth√®ques sur plate-forme existantes bien √©tablies pr√©sente de nombreux avantages, tels que la possibilit√© de b√©n√©ficier des derni√®res mises √† jour, et vous permet d&#8217;√©conomiser de l&#8217;argent et profite √† l&#8217;√©cosyst√®me Ethereum en r√©duisant le nombre total de contrats en direct dans Ethereum.</p>
</div>
<div class="paragraph data-line-1629">
<p>Dans Ethereum, la ressource la plus largement utilis√©e est la <a href="https://openzeppelin.org/" data-href="https://openzeppelin.org/">suite OpenZeppelin</a>, une vaste biblioth√®que de contrats allant des impl√©mentations de jetons ERC20 et ERC721, √† de nombreuses variantes de mod√®les de crowdsale , en passant par des comportements simples couramment trouv√©s dans les contrats, tels que <code>Ownable</code>, <code>Pausable</code> ou <code>LimitBalance</code>. Les contrats de ce r√©f√©rentiel ont √©t√© largement test√©s et, dans certains cas, fonctionnent m√™me comme des impl√©mentations standard <em>de facto .</em> Ils sont libres d' utilisation et sont construits et maintenus par <a href="https://zeppelin.solutions" data-href="https://zeppelin.solutions">Zeppelin</a> avec une liste sans cesse croissante de contributeurs externes.</p>
</div>
<div class="paragraph data-line-1631">
<p>√âgalement de Zeppelin est <a href="https://zeppelinos.org/" data-href="https://zeppelinos.org/">ZeppelinOS</a>, une plate-forme √† source libre de services et d&#8217;outils pour d√©velopper et g√©rer en toute s√©curit√© des applications de contrat intelligent. ZeppelinOS fournit une couche au-dessus de l&#8217;EVM qui permet aux d√©veloppeurs de lancer facilement des DApps √©volutives li√©es √† une biblioth√®que en cha√Æne de contrats bien test√©s qui sont eux-m√™mes √©volutifs. Diff√©rentes versions de ces biblioth√®ques peuvent coexister sur la plate-forme Ethereum, et un syst√®me de caution permet aux utilisateurs de proposer ou de pousser des am√©liorations dans diff√©rentes directions. Un ensemble d&#8217;outils hors cha√Æne pour d√©boguer, tester, d√©ployer et surveiller les applications d√©centralis√©es est √©galement fourni par la plate-forme.</p>
</div>
<div class="paragraph data-line-1633">
<p>Le projet ethpm vise √† organiser les diff√©rentes ressources qui se d√©veloppent dans l&#8217;√©cosyst√®me en proposant un syst√®me de gestion de packages. En tant que tel, leur registre fournit plus d&#8217;exemples √† parcourir¬†:</p>
</div>
<div class="ulist data-line-1635">
<ul>
<li class="data-line-1635">
<p>Site Web : <a href="https://www.ethpm.com/" data-href="https://www.ethpm.com/">https://www.ethpm.com/</a></p>
</li>
<li class="data-line-1636">
<p>Lien vers le r√©f√©rentiel : <a href="https://www.ethpm.com/registry" data-href="https://www.ethpm.com/registry">https://www.ethpm.com/registry</a></p>
</li>
<li class="data-line-1637">
<p>Lien GitHub : <a href="https://github.com/ethpm" data-href="https://github.com/ethpm">https://github.com/ethpm</a></p>
</li>
<li class="data-line-1638">
<p>Documentation¬†: <a href="https://www.ethpm.com/docs/integration-guide" data-href="https://www.ethpm.com/docs/integration-guide">https://www.ethpm.com/docs/integration-guide</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-1640">
<h3 id="_conclusion_6">Conclusion</h3>
<div class="paragraph data-line-1642">
<p>Tout d√©veloppeur travaillant dans le domaine des contrats intelligents a beaucoup √† savoir et √† comprendre. En suivant les meilleures pratiques dans la conception de votre contrat intelligent et la r√©daction de votre code, vous √©viterez de nombreux pi√®ges et attrappes.</p>
</div>
<div class="paragraph data-line-21">
<p>Le principe de s√©curit√© logicielle le plus fondamental est peut-√™tre de maximiser la r√©utilisation du code de confiance. En cryptographie, c&#8217;est si important qu&#8217;il a √©t√© condens√© en un adage¬†: "Ne lancez pas votre propre crypto." Dans le cas des contrats intelligents, cela revient √† tirer le meilleur parti possible des biblioth√®ques librement disponibles qui ont √©t√© soigneusement contr√¥l√©es par la communaut√©.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="tokens_chapter">Jetons</h2>
<div class="sectionbody">
<div class="paragraph data-line-5">
<p>Le mot &quot;token&quot; (jeton) d√©rive du vieil anglais &quot;tƒÅcen&quot;, signifiant un signe ou un symbole. Il est couramment utilis√© pour d√©signer des objets de type pi√®ce de monnaie √† usage sp√©cial √©mis par des particuliers et ayant une valeur intrins√®que insignifiante, tels que des token ou jetons de transport, des jetons de blanchisserie et des jetons de jeux d&#39;arcade.</p>
</div>
<div class="paragraph data-line-7">
<p>De nos jours, les &quot;tokens&quot; ou &quot;jetons&quot; (nous utiliserons le terme fran√ßais "jeton" pour le restant du chapitre) administr√©s sur les cha√Ænes de blocs red√©finissent le mot pour d√©signer des abstractions bas√©es sur la cha√Æne de blocs qui peuvent √™tre poss√©d√©es et qui repr√©sentent des actifs, des devises ou des droits d&#39;acc√®s.</p>
</div>
<div class="paragraph data-line-9">
<p>L&#39;association entre le mot &quot;jeton&quot; et la valeur insignifiante a beaucoup √† voir avec l&#39;utilisation limit√©e des versions physiques des jetons. Souvent limit√©s √† des entreprises, des organisations ou des emplacements sp√©cifiques, les jetons physiques ne sont pas facilement √©changeables et n&#39;ont g√©n√©ralement qu&#39;une seule fonction. Avec les jetons de cha√Æne de blocs, ces restrictions sont lev√©es ou, plus pr√©cis√©ment, compl√®tement red√©finissables. De nombreux jetons de cha√Æne de blocs ont plusieurs objectifs √† l&#39;√©chelle mondiale et peuvent √™tre √©chang√©s les uns contre les autres ou contre d&#39;autres devises sur les march√©s liquides mondiaux. Avec la disparition des restrictions d&#39;utilisation et de propri√©t√©, l&#39;attente d&#39;une &quot;valeur insignifiante&quot; appartient √©galement au pass√©.</p>
</div>
<div class="paragraph data-line-11">
<p>Dans ce chapitre, nous examinons les diff√©rentes utilisations des jetons et comment ils sont cr√©√©s. Nous discutons √©galement des attributs des jetons tels que la fongibilit√© et l&#39;intrins√®que. Enfin, nous examinons les normes et les technologies sur lesquelles ils sont bas√©s et exp√©rimentons en cr√©ant nos propres jetons.</p>
</div>
<div class="sect2 data-line-14">
<h3 id="tokens_use">Comment les jetons sont utilis√©s</h3>
<div class="paragraph data-line-16">
<p>L&#39;utilisation la plus √©vidente des jetons est celle des monnaies priv√©es num√©riques. Cependant, ce n&#39;est qu&#39;une utilisation possible. Les jetons peuvent √™tre programm√©s pour remplir de nombreuses fonctions diff√©rentes, qui se chevauchent souvent. Par exemple, un jeton peut simultan√©ment transmettre un droit de vote, un droit d&#39;acc√®s et la propri√©t√© d&#39;une ressource. Comme le montre la liste suivante, la devise n&#39;est que la premi√®re &quot;application&quot;¬†:</p>
</div>
<div class="dlist data-line-18">
<dl>
<dt class="hdlist1">Monnaie</dt>
<dd>
<p>Un jeton peut servir de forme de monnaie, avec une valeur d√©termin√©e par le commerce priv√©.</p>
</dd>
<dt class="hdlist1">Ressource</dt>
<dd>
<p>Un jeton peut repr√©senter une ressource gagn√©e ou produite dans une √©conomie de partage ou un environnement de partage de ressources¬†; par exemple, un jeton de stockage ou de processeur repr√©sentant des ressources qui peuvent √™tre partag√©es sur un r√©seau.</p>
</dd>
<dt class="hdlist1">Actif</dt>
<dd>
<p>un jeton peut repr√©senter la propri√©t√© d&#39;un actif intrins√®que ou extrins√®que, tangible ou intangible¬†; par exemple, de l&#39;or, de l&#39;immobilier, une voiture, du p√©trole, de l&#39;√©nergie, des objets MMOG, etc.</p>
</dd>
<dt class="hdlist1">Acc√®s</dt>
<dd>
<p>un jeton peut repr√©senter des droits d&#39;acc√®s et accorder l&#39;acc√®s √† une propri√©t√© num√©rique ou physique, telle qu&#39;un forum de discussion, un site Web exclusif, une chambre d&#39;h√¥tel ou une voiture de location.</p>
</dd>
<dt class="hdlist1">√âquit√©</dt>
<dd>
<p>Un jeton peut repr√©senter l&#39;√©quit√© des actionnaires dans une organisation num√©rique (par exemple, un DAO) ou une entit√© juridique (par exemple, une soci√©t√©).</p>
</dd>
<dt class="hdlist1">Vote</dt>
<dd>
<p>Un jeton peut repr√©senter des droits de vote dans un syst√®me num√©rique ou juridique.</p>
</dd>
<dt class="hdlist1">Objet de collection</dt>
<dd>
<p>Un jeton peut repr√©senter un objet de collection num√©rique (par exemple, CryptoPunks) ou un objet de collection physique (par exemple, une peinture).</p>
</dd>
<dt class="hdlist1">Identit√©</dt>
<dd>
<p>Un jeton peut repr√©senter une identit√© num√©rique (par exemple, un avatar) ou une identit√© l√©gale (par exemple, une carte d&#39;identit√© nationale).</p>
</dd>
<dt class="hdlist1">Attestation</dt>
<dd>
<p>Un jeton peut repr√©senter une certification ou une attestation de fait par une autorit√© ou par un syst√®me de r√©putation d√©centralis√© (par exemple, acte de mariage, certificat de naissance, dipl√¥me universitaire).</p>
</dd>
<dt class="hdlist1">Utilitaire</dt>
<dd>
<p>Un jeton peut √™tre utilis√© pour acc√©der ou payer un service.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-38">
<p>Souvent, un seul jeton englobe plusieurs de ces fonctions. Parfois, il est difficile de les distinguer, car les √©quivalents physiques ont toujours √©t√© inextricablement li√©s. Par exemple, dans le monde physique, un permis de conduire (attestation) est aussi un document d&#39;identit√© (identit√©) et les deux ne peuvent pas √™tre s√©par√©s. Dans le domaine num√©rique, les fonctions pr√©c√©demment m√©lang√©es peuvent √™tre s√©par√©es et d√©velopp√©es ind√©pendamment (par exemple, une attestation anonyme).</p>
</div>
</div>
<div class="sect2 data-line-41">
<h3 id="tokens_fungibility">Jetons et fongibilit√©</h3>
<div class="paragraph data-line-43">
<p><a href="https://en.wikipedia.org/wiki/Fungibility" data-href="https://en.wikipedia.org/wiki/Fungibility">Wikipedia</a> dit¬†: &quot; En √©conomie, la fongibilit√© est la propri√©t√© d&#39;un bien ou d&#39;une marchandise dont les unit√©s individuelles sont essentiellement interchangeables.&quot;</p>
</div>
<div class="paragraph data-line-45">
<p>Les jetons sont fongibles lorsque nous pouvons remplacer n&#39;importe quelle unit√© du jeton par une autre sans aucune diff√©rence dans sa valeur ou sa fonction.</p>
</div>
<div class="paragraph data-line-47">
<p>√Ä proprement parler, si la provenance historique d&#39;un jeton peut √™tre suivie, il n&#39;est pas enti√®rement fongible. La possibilit√© de suivre la provenance peut conduire √† la mise sur liste noire et √† la liste blanche, r√©duisant ou √©liminant la fongibilit√©.</p>
</div>
<div class="paragraph data-line-49">
<p>Les jetons non fongibles sont des jetons qui repr√©sentent chacun un √©l√©ment tangible ou intangible unique et ne sont donc pas interchangeables. Par exemple, un jeton qui repr√©sente la propri√©t√© d&#39;un tableau <em>sp√©cifique</em> de Van Gogh n&#39;est pas √©quivalent √† un autre jeton qui repr√©sente un Picasso, m√™me s&#39;ils peuvent faire partie du m√™me syst√®me de &quot;jeton de propri√©t√© d&#39;art&quot;. De m√™me, un jeton repr√©sentant un objet de collection num√©rique <em>sp√©cifique</em> tel qu&#39;un CryptoKitty sp√©cifique n&#39;est pas interchangeable avec un autre CryptoKitty. Chaque jeton non fongible est associ√© √† un identifiant unique, tel qu&#39;un num√©ro de s√©rie.</p>
</div>
<div class="paragraph data-line-51">
<p>Nous verrons des exemples de jetons fongibles et non fongibles plus loin dans ce chapitre.</p>
</div>
<div class="admonitionblock note data-line-54">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-55">
<p>Notez que &quot;fongible&quot; est souvent utilis√© pour signifier &quot;directement √©changeable contre de l&#39;argent&quot; (par exemple, un jeton de casino peut √™tre &quot;encaiss√©&quot;, contrairement aux jetons de blanchisserie). Ce n&#39;est <em>pas</em> le sens dans lequel nous utilisons le mot ici.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-59">
<h3 id="counterparty_risk">Risque de contrepartie</h3>
<div class="paragraph data-line-61">
<p>Le risque de contrepartie est le risque que l&#39;_autre_ partie √† une transaction ne respecte pas ses obligations. Certains types de transactions pr√©sentent un risque de contrepartie suppl√©mentaire car il y a plus de deux parties impliqu√©es. Par exemple, si vous d√©tenez un certificat de d√©p√¥t pour un m√©tal pr√©cieux et que vous le vendez √† quelqu&#39;un, il y a au moins trois parties dans cette transaction : le vendeur, l&#39;acheteur et le d√©positaire du m√©tal pr√©cieux. Quelqu&#39;un d√©tient l&#39;actif physique¬†; par n√©cessit√©, ils deviennent partie √† l&#39;ex√©cution de la transaction et ajoutent un risque de contrepartie √† toute transaction impliquant cet actif. En g√©n√©ral, lorsqu&#39;un actif est n√©goci√© indirectement via l&#39;√©change d&#39;un jeton de propri√©t√©, il existe un risque de contrepartie suppl√©mentaire de la part du d√©positaire de l&#39;actif. En ont-ils l&#39;atout ? Reconna√Ætront-ils (ou autoriseront-ils) le transfert de propri√©t√© bas√© sur le transfert d&#39;un jeton (tel qu&#39;un certificat, un acte, un titre ou un jeton num√©rique)¬†? Dans le monde des jetons num√©riques repr√©sentant des actifs, comme dans le monde non num√©rique, il est important de comprendre qui d√©tient l&#39;actif repr√©sent√© par le jeton et quelles r√®gles s&#39;appliquent √† cet actif sous-jacent.</p>
</div>
</div>
<div class="sect2 data-line-64">
<h3 id="tokens_intrinsicality">Tokens et Intrinsicit√©</h3>
<div class="paragraph data-line-66">
<p>Le mot &quot;intrins√®que&quot; d√©rive du latin &quot;intra&quot;, qui signifie &quot;de l&#39;int√©rieur&quot;.</p>
</div>
<div class="paragraph data-line-68">
<p>Certains jetons repr√©sentent des √©l√©ments num√©riques intrins√®ques √† la cha√Æne de blocs. Ces actifs num√©riques sont r√©gis par des r√®gles consensuelles, tout comme les jetons eux-m√™mes. Cela a une implication importante¬†: les jetons qui repr√©sentent des actifs intrins√®ques ne comportent pas de risque de contrepartie suppl√©mentaire. Si vous d√©tenez les cl√©s d&#39;un CryptoKitty, aucune autre partie ne d√©tient ce CryptoKitty pour vous - vous le poss√©dez directement. Les r√®gles de consensus de la cha√Æne de blocs s&#39;appliquent et votre propri√©t√© (c&#39;est-√†-dire votre contr√¥le) des cl√©s priv√©es √©quivaut √† la propri√©t√© de l&#39;actif, sans aucun interm√©diaire.</p>
</div>
<div class="paragraph data-line-70">
<p>√Ä l&#39;inverse, de nombreux jetons sont utilis√©s pour repr√©senter des choses <em>extrins√®ques</em>, telles que l&#39;immobilier, les actions avec droit de vote des entreprises, les marques et les lingots d&#39;or. La propri√©t√© de ces √©l√©ments, qui ne sont pas &quot;dans&quot; la cha√Æne de blocs, est r√©gie par la loi, la coutume et la politique, distinctes des r√®gles consensuelles qui r√©gissent le jeton. En d&#39;autres termes, les √©metteurs et propri√©taires de jetons peuvent toujours d√©pendre de contrats r√©els non intelligents. En cons√©quence, ces actifs extrins√®ques comportent un risque de contrepartie suppl√©mentaire car ils sont d√©tenus par des d√©positaires, enregistr√©s dans des registres externes ou contr√¥l√©s par des lois et des politiques en dehors de l&#39;environnement de la cha√Æne de blocs.</p>
</div>
<div class="paragraph data-line-72">
<p>L&#39;une des ramifications les plus importantes des jetons bas√©s sur la cha√Æne de blocs est la capacit√© de convertir des actifs extrins√®ques en actifs intrins√®ques et ainsi de supprimer le risque de contrepartie. Un bon exemple est le passage de l&#39;√©quit√© dans une soci√©t√© (extrins√®que) √† une √©quit√© ou √† un jeton de vote dans un <em>DAO</em> ou une organisation similaire (intrins√®que).</p>
</div>
</div>
<div class="sect2 data-line-75">
<h3 id="using_tokens">Utilisation de jetons¬†: utilit√© ou √©quit√©</h3>
<div class="paragraph data-line-77">
<p>Presque tous les projets d&#39;Ethereum sont lanc√©s aujourd&#39;hui avec une sorte de jeton. Mais est-ce que tous ces projets ont vraiment besoin de jetons ? Y a-t-il des inconv√©nients √† utiliser un jeton, ou verrons-nous le slogan &quot;tok√©niser toutes les choses&quot; se concr√©tiser¬†? En principe, l&#39;utilisation de jetons peut √™tre consid√©r√©e comme l&#39;ultime outil de gestion ou d&#39;organisation. Dans la pratique, l&#39;int√©gration des plateformes de cha√Æne de blocs, y compris Ethereum, dans les structures existantes de la soci√©t√© signifie que, jusqu&#39;√† pr√©sent, il existe de nombreuses limites √† leur applicabilit√©.</p>
</div>
<div class="paragraph data-line-79">
<p>Commen√ßons par clarifier le r√¥le d&#39;un jeton dans un nouveau projet. La majorit√© des projets utilisent des jetons de deux mani√®res¬†: soit en tant que ¬´¬†jetons utilitaires¬†¬ª, soit en tant que ¬´¬†jetons d&#39;√©quit√©¬†¬ª. Tr√®s souvent, ces deux r√¥les sont confondus.</p>
</div>
<div class="paragraph data-line-81">
<p>Les jetons utilitaires sont ceux o√π l&#39;utilisation du jeton est n√©cessaire pour acc√©der √† un service, une application ou une ressource. Des exemples de jetons utilitaires incluent des jetons qui repr√©sentent des ressources telles que le stockage partag√© ou l&#39;acc√®s √† des services tels que les r√©seaux de m√©dias sociaux.</p>
</div>
<div class="paragraph data-line-83">
<p>Les jetons d&#8217;√©quit√© sont ceux qui repr√©sentent des parts dans le contr√¥le ou la propri√©t√© de quelque chose, comme une startup. Les jetons d&#39;√©quit√© peuvent √™tre aussi limit√©s que les actions sans droit de vote pour la distribution des dividendes et des b√©n√©fices, ou aussi expansifs que les actions avec droit de vote dans une organisation autonome d√©centralis√©e, o√π la gestion de la plate-forme se fait par un syst√®me de gouvernance complexe bas√© sur les votes des d√©tenteurs de jetons.</p>
</div>
<div class="sect3 data-line-86">
<h4 id="its_not_duck">C&#39;est un canard¬†!</h4>
<div class="paragraph data-line-88">
<p>De nombreuses startups sont confront√©es √† un probl√®me difficile¬†: les jetons sont un excellent m√©canisme de collecte de fonds, mais offrir des titres (actions) au public est une activit√© r√©glement√©e dans la plupart des juridictions. En d√©guisant les jetons d&#8217;√©quit√© en jetons utilitaires, de nombreuses startups esp√®rent contourner ces restrictions r√©glementaires et lever des fonds √† partir d&#8217;une offre publique tout en la pr√©sentant comme une pr√©vente de "bons d&#8217;acc√®s au service" ou, comme nous les appelons, de jetons utilitaires. Reste √† savoir si ces offres d&#8217;actions √† peine d√©guis√©es pourront contourner les r√©gulateurs.</p>
</div>
<div class="paragraph data-line-90">
<p>Comme le dit le dicton populaire : &quot;Si √ßa marche comme un canard et cancane comme un canard, c&#39;est un canard.&quot; Les r√©gulateurs ne risquent pas d&#39;√™tre distraits par ces contorsions s√©mantiques ; bien au contraire, ils sont plus susceptibles de consid√©rer ce sophisme juridique comme une tentative de tromper le public.</p>
</div>
</div>
<div class="sect3 data-line-93">
<h4 id="who_needs_utility_tokens">Jetons utilitaires¬†: qui en a besoin¬†?</h4>
<div class="paragraph data-line-95">
<p>Le vrai probl√®me est que les jetons utilitaires introduisent des risques importants et des obstacles √† l&#39;adoption pour les startups. Peut-√™tre que dans un avenir lointain, &quot;tok√©niser toutes les choses&quot; deviendra r√©alit√©, mais √† l&#39;heure actuelle, l&#39;ensemble des personnes qui comprennent et souhaitent utiliser un jeton est un sous-ensemble du march√© d√©j√† petit de la crypto-monnaie.</p>
</div>
<div class="paragraph data-line-97">
<p>Pour une startup, chaque innovation repr√©sente un risque et un filtre de march√©. L&#39;innovation, c&#39;est emprunter le chemin le moins fr√©quent√©, s&#39;√©loigner du chemin de la tradition. C&#39;est d√©j√† une promenade solitaire. Si une startup essaie d&#39;innover dans un nouveau domaine technologique, tel que le partage de stockage sur des r√©seaux P2P, c&#39;est une voie assez solitaire. L&#39;ajout d&#39;un jeton utilitaire √† cette innovation et l&#39;obligation pour les utilisateurs d&#39;adopter des jetons afin d&#39;utiliser le service aggravent le risque et augmentent les obstacles √† l&#39;adoption. C&#39;est sortir de la piste d√©j√† solitaire de l&#39;innovation de stockage P2P et dans le d√©sert.</p>
</div>
<div class="paragraph data-line-99">
<p>Consid√©rez chaque innovation comme un filtre. Cela limite l&#39;adoption au sous-ensemble du march√© qui peut devenir les premiers √† adopter cette innovation. L&#39;ajout d&#39;un deuxi√®me filtre aggrave cet effet, limitant davantage le march√© adressable. Vous demandez √† vos premiers utilisateurs d&#39;adopter non pas une mais deux technologies enti√®rement nouvelles¬†: la nouvelle application/plate-forme/service que vous avez cr√©√©e et l&#39;√©conomie des jetons.</p>
</div>
<div class="paragraph data-line-101">
<p>Pour une startup, chaque innovation introduit des risques qui augmentent les chances d&#39;√©chec de la startup. Si vous prenez votre id√©e de d√©marrage d√©j√† risqu√©e et ajoutez un jeton utilitaire, vous ajoutez tous les risques de la plate-forme sous-jacente (Ethereum), de l&#39;√©conomie plus large (√©changes, liquidit√©), de l&#39;environnement r√©glementaire (r√©gulateurs des actions/mati√®res premi√®res) et de la technologie (contrats intelligents , normes symboliques). C&#39;est beaucoup de risques pour une startup.</p>
</div>
<div class="paragraph data-line-103">
<p>Les partisans de la &quot;tok√©nisation de toutes les choses&quot; r√©torqueront probablement qu&#39;en adoptant des jetons, ils h√©ritent √©galement de l&#39;enthousiasme du march√©, des premiers utilisateurs, de la technologie, de l&#39;innovation et de la liquidit√© de l&#39;ensemble de l&#39;√©conomie des jetons. C&#39;est vrai aussi. La question est de savoir si les avantages et l&#39;enthousiasme l&#39;emportent sur les risques et les incertitudes.</p>
</div>
<div class="paragraph data-line-105">
<p>N√©anmoins, certaines des id√©es commerciales les plus innovantes se d√©roulent effectivement dans le domaine de la cryptographie. Si les r√©gulateurs ne sont pas assez rapides pour adopter des lois et soutenir de nouveaux mod√®les commerciaux, les entrepreneurs et les talents associ√©s chercheront √† op√©rer dans d&#39;autres juridictions plus favorables √† la cryptographie. Cela se produit d√©j√†.</p>
</div>
<div class="paragraph data-line-107">
<p>Enfin, au d√©but de ce chapitre, lors de l&#39;introduction des jetons, nous avons discut√© de la signification famili√®re du ¬´ jeton ¬ª comme ¬´ quelque chose de valeur insignifiante ¬ª. La raison sous-jacente de la valeur insignifiante de la plupart des jetons est qu&#39;ils ne peuvent √™tre utilis√©s que dans un contexte tr√®s √©troit¬†: une compagnie d&#8217;autobus, une buanderie automatique, une arcade, un h√¥tel ou un magasin d&#39;entreprise. Une liquidit√© limit√©e, une applicabilit√© limit√©e et des co√ªts de conversion √©lev√©s r√©duisent la valeur des jetons jusqu&#39;√† ce qu&#39;ils n&#39;aient plus qu&#39;une valeur ¬´ symbolique ¬ª. Ainsi, lorsque vous ajoutez un jeton utilitaire √† votre plateforme, mais que le jeton ne peut √™tre utilis√© que sur votre seule plateforme avec un petit march√©, vous recr√©ez les conditions qui ont rendu les jetons physiques sans valeur. Cela peut en effet √™tre la bonne fa√ßon d&#39;int√©grer la tokenisation dans votre projet. Cependant, si pour utiliser votre plate-forme, un utilisateur doit convertir quelque chose en votre jeton utilitaire, l&#39;utiliser, puis reconvertir le reste en quelque chose de plus g√©n√©ralement utile, vous avez cr√©√© un certificat d&#39;entreprise. Les co√ªts de commutation d&#39;un jeton num√©rique sont des ordres de grandeur inf√©rieurs √† ceux d&#39;un jeton physique sans march√©, mais ils ne sont pas nuls. Les jetons utilitaires qui fonctionnent dans tout un secteur industriel seront tr√®s int√©ressants et probablement tr√®s pr√©cieux. Mais si vous configurez votre startup pour qu&#39;elle doive amorcer une norme industrielle enti√®re pour r√©ussir, vous avez peut-√™tre d√©j√† √©chou√©.</p>
</div>
<div class="admonitionblock note data-line-110">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-111">
<p>L&#39;un des avantages du d√©ploiement de services sur des plates-formes √† usage g√©n√©ral comme Ethereum est de pouvoir connecter des contrats intelligents (et donc l&#39;utilit√© des jetons) √† travers les projets, augmentant ainsi le potentiel de liquidit√© et l&#39;utilit√© des jetons.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-114">
<p>Prenez cette d√©cision pour les bonnes raisons. Adoptez un jeton car votre application <em>ne peut pas fonctionner sans jeton</em>. Adoptez-le car le jeton l√®ve une barri√®re fondamentale du march√© ou r√©sout un probl√®me d&#39;acc√®s. N&#39;introduisez pas de jeton utilitaire car c&#39;est le seul moyen de collecter des fonds rapidement et vous devez pr√©tendre qu&#39;il ne s&#39;agit pas d&#39;une offre publique de titres .</p>
</div>
</div>
</div>
<div class="sect2 data-line-117">
<h3 id="token_std">Jetons sur Ethereum</h3>
<div class="paragraph data-line-119">
<p>Les jetons de cha√Æne de blocs existaient avant Ethereum. D&#39;une certaine mani√®re, la premi√®re monnaie cha√Æne de blocs, Bitcoin, est un jeton lui-m√™me. De nombreuses plateformes de jetons ont √©galement √©t√© d√©velopp√©es sur Bitcoin et d&#39;autres crypto-monnaies avant Ethereum. Cependant, l&#39;introduction de la premi√®re norme de jeton sur Ethereum a conduit √† une explosion de jetons.</p>
</div>
<div class="paragraph data-line-121">
<p>Vitalik Buterin a sugg√©r√© les jetons comme l&#39;une des applications les plus √©videntes et les plus utiles d&#39;une cha√Æne de blocs programmable g√©n√©ralis√©e telle qu&#39;Ethereum. En fait, au cours de la premi√®re ann√©e d&#39;Ethereum, il √©tait courant de voir Vitalik et d&#39;autres porter des T-shirts arborant le logo Ethereum et un √©chantillon de contrat intelligent au dos. Il y avait plusieurs variantes de ce T-shirt, mais la plus courante montrait une impl√©mentation d&#39;un jeton.</p>
</div>
<div class="paragraph data-line-123">
<p>Avant de nous plonger dans les d√©tails de la cr√©ation de jetons sur Ethereum, il est important d&#39;avoir un aper√ßu du fonctionnement des jetons sur Ethereum. Les jetons sont diff√©rents de l&#39;ether car le protocole Ethereum ne sait rien d&#39;eux. L&#39;envoi d&#39;√©ther est une action intrins√®que de la plateforme Ethereum, mais l&#39;envoi ou m√™me la possession de jetons ne l&#39;est pas. Le solde d&#39;ether des comptes Ethereum est g√©r√© au niveau du protocole, tandis que le solde de jetons des comptes Ethereum est g√©r√© au niveau du contrat intelligent. Afin de cr√©er un nouveau jeton sur Ethereum, vous devez cr√©er un nouveau contrat intelligent. Une fois d√©ploy√©, le contrat intelligent g√®re tout, y compris la propri√©t√©, les transferts et les droits d&#39;acc√®s. Vous pouvez r√©diger votre contrat intelligent pour effectuer toutes les actions n√©cessaires comme vous le souhaitez, mais il est probablement plus sage de suivre une norme existante. Nous examinerons ensuite ces normes. Nous discutons des avantages et des inconv√©nients des normes suivantes √† la fin du chapitre.</p>
</div>
<div class="sect3 data-line-127">
<h4 id="ERC20_std">La norme de jeton ERC20</h4>
<div class="paragraph data-line-129">
<p>La premi√®re norme a √©t√© introduite en novembre 2015 par Fabian Vogelsteller en tant que demande de commentaires Ethereum (ERC). Il s&#39;est automatiquement vu attribuer le num√©ro de probl√®me GitHub 20, donnant lieu au nom de &quot;jeton ERC20&quot;. La grande majorit√© des jetons sont actuellement bas√©s sur la norme ERC20. La demande de commentaires ERC20 est finalement devenue la proposition d&#39;am√©lioration Ethereum 20 (EIP-20), mais elle est encore principalement d√©sign√©e par le nom d&#39;origine, ERC20.</p>
</div>
<div class="paragraph data-line-131">
<p>ERC20 est une norme pour les <em>jetons fongibles</em>, ce qui signifie que diff√©rentes unit√©s d&#39;un token ERC20 sont interchangeables et n&#39;ont pas de propri√©t√©s uniques.</p>
</div>
<div class="paragraph data-line-133">
<p><a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">La norme ERC20</a> d√©finit une interface commune pour les contrats mettant en ≈ìuvre un jeton, de sorte que tout jeton compatible est accessible et utilisable de la m√™me mani√®re. L&#39;interface se compose d&#39;un certain nombre de fonctions qui doivent √™tre pr√©sentes dans chaque impl√©mentation de la norme, ainsi que de certaines fonctions et attributs facultatifs qui peuvent √™tre ajout√©s par les d√©veloppeurs.</p>
</div>
<div class="sect4 data-line-136">
<h5 id="ERC20_reqd_func">Fonctions et √©v√©nements requis par ERC20</h5>
<div class="paragraph data-line-138">
<p>Un contrat de jeton conforme √† ERC20 doit fournir au moins les fonctions et √©v√©nements suivants¬†:</p>
</div>
<div class="dlist data-line-140">
<dl>
<dt class="hdlist1">totalSupply</dt>
<dd>
<p>Renvoie le nombre total d&#39;unit√©s de ce jeton qui existent actuellement. Les jetons ERC20 peuvent avoir une offre fixe ou variable.</p>
</dd>
<dt class="hdlist1">balanceOf</dt>
<dd>
<p>√âtant donn√© une adresse, renvoie le solde du jeton de cette adresse.</p>
</dd>
<dt class="hdlist1">transfer</dt>
<dd>
<p>√âtant donn√© une adresse et un montant, transf√®re ce montant de jetons √† cette adresse, √† partir du solde de l&#39;adresse qui a ex√©cut√© le transfert.</p>
</dd>
<dt class="hdlist1">transferFrom</dt>
<dd>
<p>√âtant donn√© un exp√©diteur, un destinataire et un montant, transf√®re des jetons d&#39;un compte √† un autre. Utilis√© en combinaison avec approve.</p>
</dd>
<dt class="hdlist1">approve</dt>
<dd>
<p>√âtant donn√© une adresse et un montant de destinataire, autorise cette adresse √† ex√©cuter plusieurs virements jusqu&#39;√† ce montant, √† partir du compte qui a √©mis l&#39;approbation.</p>
</dd>
<dt class="hdlist1">allowance</dt>
<dd>
<p>√âtant donn√© une adresse de propri√©taire et une adresse de d√©pensier, renvoie le montant restant que le d√©pensier est autoris√© √† retirer au propri√©taire.</p>
</dd>
<dt class="hdlist1">Transfer</dt>
<dd>
<p>Ev√©nement d√©clench√© lors d&#39;un transfert r√©ussi (appel √† transfer ou transferFrom) (m√™me pour les transferts de valeur nulle).</p>
</dd>
<dt class="hdlist1">Approval</dt>
<dd>
<p>√âv√©nement enregistr√© lors d&#39;un appel r√©ussi √† approve.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-157">
<h5 id="ERC20_optional_func">Fonctions optionnelles ERC20</h5>
<div class="paragraph data-line-159">
<p>En plus des fonctions requises list√©es dans la section pr√©c√©dente, les fonctions optionnelles suivantes sont √©galement d√©finies par la norme¬†:</p>
</div>
<div class="dlist data-line-161">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>Renvoie le nom lisible par l&#39;homme (par exemple, &quot;US Dollars&quot;) du jeton.</p>
</dd>
<dt class="hdlist1">symbol</dt>
<dd>
<p>Renvoie un symbole lisible par l&#39;homme (par exemple, &quot;USD&quot;) pour le jeton.</p>
</dd>
<dt class="hdlist1">decimals</dt>
<dd>
<p>Renvoie le nombre de d√©cimales utilis√©es pour diviser les quantit√©s de jetons. Par exemple, si decimals vaut 2, alors le montant du jeton est divis√© par 100 pour obtenir sa <span class="keep-together">repr√©sentation</span> d&#8217;usage.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4 data-line-168">
<h5 id="ERC20_interface">L&#39;interface ERC20 d√©finie dans Solidity</h5>
<div class="paragraph data-line-170">
<p>Voici √† quoi ressemble une sp√©cification d&#39;interface ERC20 dans Solidity¬†:</p>
</div>
<div id="ERC20_interface_example" class="listingblock data-line-174">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract ERC20 {
   function totalSupply() constant returns (uint theTotalSupply);
   function balanceOf(address _owner) constant returns (uint balance);
   function transfer(address _to, uint _value) returns (bool success);
   function transferFrom(address _from, address _to, uint _value) returns
      (bool success);
   function approve(address _spender, uint _value) returns (bool success);
   function allowance(address _owner, address _spender) constant returns
      (uint remaining);
   event Transfer(address indexed _from, address indexed _to, uint _value);
   event Approval(address indexed _owner, address indexed _spender, uint _value);
}</code></pre>
</div>
</div>
</div>
<div class="sect4 data-line-190">
<h5 id="ERC20_data_struct">Structures de donn√©es ERC20</h5>
<div class="paragraph data-line-192">
<p>Si vous examinez une impl√©mentation ERC20, vous verrez qu&#39;elle contient deux structures de donn√©es, une pour suivre les soldes et une pour suivre indemnit√©s. Dans Solidity, ils sont impl√©ment√©s avec un <em>data mapping</em> ou <em>mappage de donn√©es</em>.</p>
</div>
<div class="paragraph data-line-194">
<p>Le premier mappage de donn√©es impl√©mente une table interne des soldes de jetons, par propri√©taire. Cela permet au contrat de jeton de garder une trace de qui poss√®de les jetons. Chaque transfert est une d√©duction d&#39;un solde et un ajout √† un autre solde¬†:</p>
</div>
<div id="balance_mapping" class="listingblock data-line-198">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">mapping(address =&gt; uint256) balances;</code></pre>
</div>
</div>
<div class="paragraph data-line-202">
<p>La deuxi√®me structure de donn√©es est un mappage de donn√©es d&#39;allocations. Comme nous le verrons dans la section suivante, avec les jetons ERC20, le propri√©taire d&#39;un jeton peut d√©l√©guer l&#39;autorit√© √† un d√©pensier, lui permettant de d√©penser un montant sp√©cifique (allocation) √† partir du solde du propri√©taire. Le contrat ERC20 assure le suivi des allocations avec un mappage bidimensionnel, la cl√© primaire √©tant l&#39;adresse du propri√©taire du jeton, mapp√©e √† une adresse de d√©pense et un montant d&#39;allocation¬†:</p>
</div>
<div id="allowance_mapping" class="listingblock data-line-206">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">mapping (address =&gt; mapping (address =&gt; uint256)) public allowed;</code></pre>
</div>
</div>
</div>
<div class="sect4 data-line-212">
<h5 id="transfer_workflows">Flux de travail ERC20 : &quot;transfer&quot; et &quot;approve et transferFrom&quot;</h5>
<div class="paragraph data-line-214">
<p>La norme de jeton ERC20 a deux fonctions de transfert. Vous vous demandez peut-√™tre pourquoi.</p>
</div>
<div class="paragraph data-line-216">
<p>ERC20 permet deux flux de travail diff√©rents. Le premier est un flux de travail simple et √† transaction unique utilisant la fonction transfer. Ce flux de travail est celui utilis√© par les portefeuilles pour envoyer des jetons √† d&#39;autres portefeuilles. La grande majorit√© des transactions de jetons se produisent avec le flux de travail transfer.</p>
</div>
<div class="paragraph data-line-218">
<p>L&#39;ex√©cution du contrat de transfert est tr√®s simple. Si Alice veut envoyer 10 jetons √† Bob, son portefeuille envoie une transaction √† l&#39;adresse du contrat de jeton, en appelant la fonction <span class="keep-together"><code>transfer</code></span> avec l&#39;adresse de Bob et 10 comme arguments. Le contrat de jeton ajuste le solde d&#39;Alice (‚Äì10) et le solde de Bob (+10) et √©met un √©v√©nement Transfer.</p>
</div>
<div class="paragraph data-line-220">
<p>Le deuxi√®me flux de travail est un processus √† deux transactions qui utilise approve suivi de transferFrom. Ce workflow permet √† un propri√©taire de jeton de d√©l√©guer son contr√¥le √† une autre adresse. Il est le plus souvent utilis√© pour d√©l√©guer le contr√¥le √† un contrat de distribution de jetons, mais il peut √©galement √™tre utilis√© par les √©changes.</p>
</div>
<div class="paragraph data-line-222">
<p>Par exemple, si une entreprise vend des tokens pour une ICO (Initial Coin Offerings ou "offres initiales de pi√®ces"), elle peut approve (approuver) une adresse de contrat de crowdsale pour distribuer une certaine quantit√© de jetons. Le contrat de crowdsale peut alors transferFrom le solde du propri√©taire du contrat de jeton √† chaque acheteur du jeton, comme illustr√© dans <a href="#approve_transferFrom_workflow">Le flux de travail d&#39;approbation et de transfert en deux √©tapes des jetons ERC20</a>.</p>
</div>
<div class="admonitionblock note data-line-225">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-226">
<p>(&quot;Initial Coin Offerings (ICOs)&quot;,&quot;d√©fini&quot;Une <em>Initial Coin Offering</em> (ICO) ou <em>Offres initiales de pi√®ces</em> est un m√©canisme de financement participatif utilis√© par les entreprises et les organisations pour collecter des fonds en vendant des jetons. Le terme est d√©riv√© de l&#39;offre publique initiale (IPO), qui est le processus par lequel une soci√©t√© publique propose des actions √† vendre aux investisseurs en bourse. Contrairement aux march√©s des introductions en bourse hautement r√©glement√©s, les ICO sont ouverts, mondiaux et d√©sordonn√©s. Les exemples et les explications des ICO dans ce livre ne constituent pas une approbation de ce type de collecte de fonds.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="approve_transferFrom_workflow" class="imageblock data-line-231">
<div class="content">
<img src="images/approve_transferFrom_workflow.png" alt="&quot;Le flux de travail d&#39;approbation et de transfert en deux √©tapes des jetons ERC20&quot;">
</div>
<div class="title">Figure 38. Le flux de travail d&#39;approbation et de transfert en deux √©tapes des jetons ERC20</div>
</div>
<div class="paragraph data-line-233">
<p>Pour le flux de travail approve et transferFrom, deux transactions sont n√©cessaires. Disons qu&#39;Alice veut autoriser le contrat AliceICO √† vendre 50 % de tous les jetons AliceCoin √† des acheteurs comme Bob et Charlie. Tout d&#39;abord, Alice lance le contrat AliceCoin ERC20, √©mettant tous les AliceCoin √† sa propre adresse. Ensuite, Alice lance le contrat AliceICO qui peut vendre des jetons contre de l&#39;ether. Ensuite, Alice lance le flux de travail approve et transferFrom. Elle envoie une transaction au contrat AliceCoin, en appelant approve avec l&#39;adresse du contrat AliceICO et 50¬†% du totalSupply comme arguments. Cela d√©clenchera l&#39;√©v√©nement Approbation. D√©sormais, le contrat AliceICO peut vendre AliceCoin.</p>
</div>
<div class="paragraph data-line-235">
<p>Lorsque le contrat AliceICO re√ßoit de l&#39;ether de Bob, il doit envoyer des AliceCoin √† Bob en retour. Dans le contrat AliceICO se trouve un taux de change entre AliceCoin et de l&#8217;Ether. Le taux de change qu&#39;Alice a fix√© lors de la cr√©ation du contrat AliceICO d√©termine le nombre de jetons que Bob recevra pour la quantit√© d&#39;ether envoy√© au contrat AliceICO. Lorsque le contrat AliceICO appelle la fonction AliceCoin transferFrom, il d√©finit l&#39;adresse d&#39;Alice comme exp√©diteur et l&#39;adresse de Bob comme destinataire, et utilise le taux de change pour d√©terminer le nombre de jetons AliceCoin qui seront transf√©r√©s √† Bob dans le champ value. Le contrat AliceCoin transf√®re le solde de l&#39;adresse d&#39;Alice √† l&#39;adresse de Bob et d√©clenche un √©v√©nement Transfer. Le contrat AliceICO peut appeler transferFrom un nombre illimit√© de fois, tant qu&#39;il ne d√©passe pas la limite d&#39;approbation d√©finie par Alice. Le contrat AliceICO peut suivre le nombre de jetons AliceCoin qu&#39;il peut vendre en appelant la fonction allowance.</p>
</div>
</div>
<div class="sect4 data-line-238">
<h5 id="ERC20_impl√©mentation">Impl√©mentations ERC20</h5>
<div class="paragraph data-line-240">
<p>Bien qu&#39;il soit possible d&#39;impl√©menter un jeton compatible ERC20 dans environ 30 lignes de code Solidity, la plupart des impl√©mentations sont plus complexes. Ceci pour tenir compte des vuln√©rabilit√©s de s√©curit√© potentielles. Deux impl√©mentations sont mentionn√©es dans la norme EIP-20¬†:</p>
</div>
<div class="dlist data-line-242">
<dl>
<dt class="hdlist1"><a href="http://bit.ly/2EUYCMR" data-href="http://bit.ly/2EUYCMR">Consensys EIP20</a></dt>
<dd>
<p>Une impl√©mentation simple et facile √† lire d&#39;un jeton compatible ERC20.</p>
</dd>
<dt class="hdlist1"><a href="https://bit.ly/2xPYck6" data-href="https://bit.ly/2xPYck6">OpenZeppelin StandardToken</a></dt>
<dd>
<p>Cette impl√©mentation est compatible ERC20, avec des pr√©cautions de s√©curit√© suppl√©mentaires. Il constitue la base des biblioth√®ques OpenZeppelin impl√©mentant des jetons compatibles ERC20 plus complexes avec des plafonds de collecte de fonds, des ench√®res, des calendriers d&#39;acquisition et d&#39;autres fonctionnalit√©s.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-247">
<h4 id="METoken_example">Lancement de notre propre jeton ERC20</h4>
<div class="paragraph data-line-249">
<p> Cr√©ons et lan√ßons notre propre jeton. Pour cet exemple, nous utiliserons le cadre de d√©veloppement (framework) Truffle. L&#39;exemple suppose que vous avez d√©j√† install√© truffle et que vous l&#39;avez configur√©, et que vous √™tes familiaris√© avec son fonctionnement de base (pour plus de d√©tails, voir <a href="#truffle">Truffle</a>).</p>
</div>
<div class="paragraph data-line-251">
<p>Nous appellerons notre jeton &quot;Mastering Ethereum Token&quot;, avec le symbole &quot;MET&quot;.</p>
</div>
<div class="admonitionblock note data-line-254">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-255">
<p>Vous pouvez trouver cet exemple <a href="https://github.com/ethereumbook/ethereumbook/blob/develop/code/truffle/METoken" data-href="https://github.com/ethereumbook/ethereumbook/blob/develop/code/truffle/METoken">dans le r√©f√©rentiel GitHub du livre</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-258">
<p>Commen√ßons par cr√©er et initialiser un r√©pertoire de projet Truffle. Ex√©cutez ces quatre commandes et acceptez les r√©ponses par d√©faut √† toutes les questions¬†:</p>
</div>
<pre data-type="programlist">
$ <strong>mkdir METoken</strong>
$ <strong>cd METoken</strong>
METoken $ <strong>truffle init</strong>
METoken $ <strong>npm init</strong>

</pre>
<div class="paragraph data-line-270">
<p>Vous devriez maintenant avoir la structure de r√©pertoires suivante¬†:</p>
</div>
<div id="truffle_directory" class="listingblock data-line-273">
<div class="content">
<pre>METoken/
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- package.json
+---- test
+---- truffle-config.js
`---- truffle.js</pre>
</div>
</div>
<div class="paragraph data-line-285">
<p>Modifiez le fichier de configuration <em>truffle.js</em> ou <em>truffle-config.js</em> pour configurer votre environnement Truffle, ou copiez ce dernier depuis <a href="http://bit.ly/2DdP2mz" data-href="http://bit.ly/2DdP2mz">le r√©f√©rentiel</a>.</p>
</div>
<div class="paragraph data-line-287">
<p>Si vous utilisez l&#39;exemple <em>truffle-config.js</em>, pensez √† cr√©er un fichier <em>.env</em> dans le dossier <em>METoken</em> contenant vos cl√©s priv√©es de test pour le test et le d√©ploiement sur les r√©seaux publics de test Ethereum, tels que Ropsten ou Kovan. Vous pouvez exporter votre cl√© priv√©e de r√©seau de test √† partir de MetaMask.</p>
</div>
<div class="paragraph data-line-289">
<p>Apr√®s cela, votre r√©pertoire devrait ressembler √†¬†:</p>
</div>
<div id="truffle_directory_metoken" class="listingblock data-line-292">
<div class="content">
<pre>METoken/
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- package.json
+---- test
+---- truffle-config.js
+---- truffle.js
`---- .env *new file*</pre>
</div>
</div>
<div class="admonitionblock warning data-line-306">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-307">
<p>N&#39;utilisez que des cl√©s de test ou des mn√©moniques de test qui ne sont <em>pas</em> utilis√©s pour d√©tenir des fonds sur le r√©seau Ethereum principal. <em>Ne jamais</em> utiliser des cl√©s contenant de l&#39;argent r√©el pour les tests.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-310">
<p>Pour notre exemple, nous allons importer la biblioth√®que OpenZeppelin, qui impl√©mente des contr√¥les de s√©curit√© importants et est facile √† √©tendre¬†:</p>
</div>
<pre data-type="programlist">
$ <strong>npm install openzeppelin-solidity@1.12.0</strong>

+ openzeppelin-solidity@1.12.0
added 1 package from 1 contributor and audited 2381 packages in 4.074s

</pre>
<div class="paragraph data-line-322">
<p>Le module de d√©velopement openzeppelin-solidity ajoutera environ 250 fichiers sous le r√©pertoire <em>node_modules</em>. La biblioth√®que OpenZeppelin comprend bien plus que le jeton ERC20, mais nous n&#39;en utiliserons qu&#39;une petite partie.</p>
</div>
<div class="paragraph data-line-324">
<p>Ensuite, √©crivons notre contrat de jeton. Cr√©ez un nouveau fichier, <em>METoken.sol</em>, et copiez l&#39;exemple de code depuis <a href="http://bit.ly/2qfIFH0" data-href="http://bit.ly/2qfIFH0">GitHub</a>.</p>
</div>
<div class="paragraph data-line-326">
<p>Notre contrat, illustr√© en <a href="#solidity_token_example">METoken.sol : Un contrat Solidity impl√©mentant un token ERC20</a>, est tr√®s simple, car il h√©rite toutes ses fonctionnalit√©s de la biblioth√®que OpenZeppelin.</p>
</div>
<div id="solidity_token_example" class="exampleblock data-line-330">
<div class="title">Example 20. METoken.sol : Un contrat Solidity impl√©mentant un token ERC20</div>
<div class="content">
<div class="listingblock data-line-332">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.21;

import 'openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol';

contract METoken is StandardToken {
    string public constant name = 'Mastering Ethereum Token';
    string public constant symbol = 'MET';
    uint8 public constant decimals = 2;
    uint constant _initial_supply = 2100000000;

    function METoken() public {
        totalSupply_ = _initial_supply;
        balances[msg.sender] = _initial_supply;
        emit Transfer(address(0), msg.sender, _initial_supply);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-337">
<p>Ici, nous d√©finissons les variables optionnelles name, symbol et decimals. Nous d√©finissons √©galement une variable _initial_supply, d√©finie sur 21¬†millions de jetons¬†; avec deux d√©cimales de subdivision qui donne 2,1 milliards d&#39;unit√©s au total. Dans la fonction d&#39;initialisation (constructeur) du contrat, nous d√©finissons le totalSupply √©gal √† _initial_supply et allouons tout le _initial_supply au solde du compte (msg.sender) qui cr√©e le contrat METoken.</p>
</div>
<div class="paragraph data-line-339">
<p>Nous utilisons maintenant truffe pour compiler le code METoken¬†:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle compile</strong>
Compiling ./contracts/METoken.sol...
Compiling ./contracts/Migrations.sol...
Compiling openzeppelin-solidity/contracts/math/SafeMath.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/BasicToken.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/ERC20.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/ERC20Basic.sol...
Compiling openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol...

</pre>
<div class="paragraph data-line-355">
<p>Comme vous pouvez le voir, truffle int√®gre les d√©pendances n√©cessaires des biblioth√®ques OpenZeppelin et compile √©galement ces contrats.</p>
</div>
<div class="paragraph data-line-357">
<p>Configurons un script de migration pour d√©ployer le contrat METoken. Cr√©ez un nouveau fichier appel√© <em>2_deploy_contracts.js</em>, dans le dossier <em>METoken/migrations</em>. Copiez le contenu de l&#39;exemple <a href="http://bit.ly/2P0rHLl" data-href="http://bit.ly/2P0rHLl">dans le r√©f√©rentiel GitHub</a>¬†:</p>
</div>
<div id="METoken_migration" class="listingblock data-line-0">
<div class="title">2_deploy_contracts¬†: Migration pour d√©ployer METoken</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var METoken = artifacts.require("METoken");

module.exports = function(deployer) {
  // Deploy the METoken contract as our only task
  deployer.deploy(METoken);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-367">
<p>Avant de d√©ployer sur l&#39;un des r√©seaux de test Ethereum, d√©marrons une cha√Æne de blocs locale pour tout tester. D√©marrez la cha√Æne de blocs ganache, soit depuis la ligne de commande avec ganache-cli, soit depuis l&#39;interface utilisateur graphique.</p>
</div>
<div class="paragraph data-line-369">
<p>Une fois ganache lanc√©, nous pouvons d√©ployer notre contrat METoken et voir si tout fonctionne comme pr√©vu¬†:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle migrate --network ganache</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb2e90a056dc6ad8e654683921fc613c796a03b89df6760ec1db1084ea4a084eb
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying METoken...
  ... 0xbe9290d59678b412e60ed6aefedb17364f4ad2977cfb2076b9b8ad415c5dc9f0
  METoken: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

</pre>
<div class="paragraph data-line-394">
<p>Sur la console ganache, nous devrions voir que notre d√©ploiement a cr√©√© quatre nouvelles transactions, comme illustr√© dans <a href="#ganache_METoken">D√©ploiement METoken sur ganache</a>.</p>
</div>
<div id="ganache_METoken" class="imageblock data-line-398">
<div class="content">
<img src="images/ganache_metoken.png" alt="&quot;D√©ploiement de METoken sur Ganache&quot;">
</div>
<div class="title">Figure 39. D√©ploiement METoken sur ganache</div>
</div>
<div class="sect4 data-line-401">
<h5 id="truffle_console">Interagir avec METoken √† l&#39;aide de la console Truffle</h5>
<div class="paragraph data-line-403">
<p> Nous pouvons interagir avec notre contrat sur la cha√Æne de blocs ganache en utilisant la console Truffle. Il s&#39;agit d&#39;un environnement JavaScript interactif qui donne acc√®s √† l&#39;environnement Truffle et, via web3, √† la cha√Æne de blocs. Dans ce cas, nous allons connecter la console Truffle √† la cha√Æne de blocs ganache¬†:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt;

</pre>
<div class="paragraph data-line-413">
<p>L&#39;invite truffe(ganache)&amp;gt; indique que nous sommes connect√©s √† la cha√Æne de blocs ganache et que nous sommes pr√™ts √† taper nos commandes. La console Truffle prend en charge toutes les commandes truffle, nous pourrions donc compiler et migrer depuis la console. Nous avons d√©j√† ex√©cut√© ces commandes, allons donc directement au contrat lui-m√™me. Le contrat METoken existe en tant qu&#39;objet JavaScript dans l&#39;environnement Truffle. Tapez METoken** √† l&#39;invite et il affichera l&#39;int√©gralit√© de la d√©finition du contrat¬†:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken</strong>
{ [Function: TruffleContract]
  _static_methods:

[...]

currentProvider:
 HttpProvider {
   host: 'http://localhost:7545',
   timeout: 0,
   user: undefined,
   password: undefined,
   headers: undefined,
   send: [Function],
   sendAsync: [Function],
   _alreadyWrapped: true },
network_id: '5777' }

</pre>
<div class="paragraph data-line-438">
<p>L&#39;objet METoken expose √©galement plusieurs attributs, tels que l&#39;adresse du contrat (telle que d√©ploy√©e par la commande migrate)¬†:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.address</strong>
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'

</pre>
<div class="paragraph data-line-448">
<p>Si nous voulons interagir avec le contrat d√©ploy√©, nous devons utiliser un appel asynchrone, sous la forme d&#39;une &quot;promesse&quot; JavaScript. Nous utilisons la fonction deployed pour obtenir l&#39;instance de contrat, puis appelons la fonction totalSupply¬†:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance => instance.totalSupply())</strong>
BigNumber { s: 1, e: 9, c: [ 2100000000 ] }

</pre>
<div class="paragraph data-line-458">
<p>Ensuite, utilisons les comptes cr√©√©s par ganache pour v√©rifier notre solde de METoken et envoyer des METoken √† une autre adresse. Commen√ßons par obtenir les adresses de compte¬†:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>let accounts</strong>
undefined
truffle(ganache)&gt; <strong>web3.eth.getAccounts((err,res) => { accounts = res })</strong>
undefined
truffle(ganache)&gt; <strong>accounts[0]</strong>
'0x627306090abab3a6e1400e9345bc60c78a8bef57'

</pre>
<div class="paragraph data-line-472">
<p>La liste accounts contient maintenant tous les comptes cr√©√©s par ganache, et account[0] est le compte qui a d√©ploy√© le contrat METoken. Il devrait avoir un solde de <span class="keep-together">METoken</span>, car notre constructeur METoken donne l&#39;int√©gralit√© de l&#39;offre de jetons √† l&#39;adresse qui l&#39;a cr√©√©. Allons v√©rifier:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =></strong>
                  <strong>{ instance.balanceOf(accounts[0]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 9, c: [ 2100000000 ] }</strong>

</pre>
<div class="paragraph data-line-484">
<p>Enfin, transf√©rons 1000.00 METoken de account[0] vers account[1], en appelant la fonction transfer du contrat¬†:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.transfer(accounts[1], 100000) })</strong>
undefined
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(accounts[0]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 9, c: [ 2099900000 ] }</strong>
undefined
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(accounts[1]).then(console.log) })</strong>
undefined
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 5, c: [ 100000 ] }</strong>

</pre>
<div class="admonitionblock tip data-line-505">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-506">
<p>METoken a 2 d√©cimales de pr√©cision, ce qui signifie que 1 METoken correspond √† 100 unit√©s dans le contrat. Lorsque nous transf√©rons 1 000 METoken, nous sp√©cifions la valeur comme 100000 dans l&#39;appel √† la fonction transfer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-509">
<p>Comme vous pouvez le voir, dans la console, account[0] a maintenant 20¬†999¬†000 MET, et account[1] a 1¬†000 MET.</p>
</div>
<div class="paragraph data-line-511">
<p>Si vous passez √† l&#39;interface utilisateur graphique ganache, comme indiqu√© dans <a href="#ganache_METoken_transfer">Transfert METoken sur ganache</a>, vous verrez la transaction qui a appel√© la fonction transfer.</p>
</div>
<div id="ganache_METoken_transfer" class="imageblock data-line-515">
<div class="content">
<img src="images/ganache_metoken_transfer.png" alt="&quot;Transfert METoken sur Ganache&quot;">
</div>
<div class="title">Figure 40. Transfert METoken sur ganache</div>
</div>
</div>
<div class="sect4 data-line-518">
<h5 id="sending_erc20_tokens_contracts">Envoi de jetons ERC20 aux adresses contractuelles</h5>
<div class="paragraph data-line-520">
<p> Jusqu&#39;√† pr√©sent, nous avons configur√© un jeton ERC20 et transf√©r√© certains jetons d&#39;un compte √† un autre. Tous les comptes que nous avons utilis√©s pour ces d√©monstrations sont des comptes externes, ce qui signifie qu&#39;ils sont contr√¥l√©s par une cl√© priv√©e et non par un contrat. Que se passe-t-il si nous envoyons MET √† une adresse contractuelle¬†? D√©couvrons-le!</p>
</div>
<div class="paragraph data-line-522">
<p>Tout d&#39;abord, d√©ployons un autre contrat dans notre environnement de test. Pour cet exemple, nous utiliserons notre premier contrat, <em>Faucet.sol</em>. Ajoutons-le au projet METoken en le copiant dans le r√©pertoire <em>contracts</em>. Notre r√©pertoire devrait ressembler √† ceci :</p>
</div>
<div id="METoken_directory" class="listingblock data-line-525">
<div class="content">
<pre>METoken/
+---- contracts
|   +---- Faucet.sol
|   +---- METoken.sol
|   `---- Migrations.sol</pre>
</div>
</div>
<div class="paragraph data-line-533">
<p>Nous ajouterons √©galement une migration, pour d√©ployer Faucet s√©par√©ment de METoken¬†:</p>
</div>
<div id="faucet_migration" class="listingblock data-line-537">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var Faucet = artifacts.require("Faucet");

module.exports = function(deployer) {
  // D√©ployer le contrat Faucet comme seule t√¢che
  deployer.deploy(Faucet);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-546">
<p>Compilons et migrons les contrats depuis la console Truffle¬†:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt; <strong>compile</strong>
Compiling ./contracts/Faucet.sol...
Writing artifacts to ./build/contracts

truffle(ganache)&gt; <strong>migrate</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x89f6a7bd2a596829c60a483ec99665c7af71e68c77a417fab503c394fcd7a0c9
  Migrations: 0xa1ccce36fb823810e729dce293b75f40fb6ea9c9
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing METoken...
  ... 0x28d0da26f48765f67e133e99dd275fac6a25fdfec6594060fd1a0e09a99b44ba
  METoken: 0x7d6bf9d5914d37bcba9d46df7107e71c59f3791f
Saving artifacts...
Running migration: 3_deploy_faucet.js
  Deploying Faucet...
  ... 0x6fbf283bcc97d7c52d92fd91f6ac02d565f5fded483a6a0f824f66edc6fa90c3
  Faucet: 0xb18a42e9468f7f1342fa3c329ec339f254bc7524
Saving artifacts...

</pre>
<div class="paragraph data-line-577">
<p>G√©nial. Envoyons maintenant du MET au contrat Faucet¬†:</p>
</div>
<pre data-type="programlist">
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.transfer(Faucet.address, 100000) })</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(Faucet.address).then(console.log)})</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 5, c: [ 100000 ] }</strong>

</pre>
<div class="paragraph data-line-590">
<p>D&#39;accord, nous avons transf√©r√© 1 000 MET au contrat Faucet. Maintenant, comment retirer ces jetons¬†?</p>
</div>
<div class="paragraph data-line-592">
<p>N&#39;oubliez pas que <em>Faucet.sol</em> est un contrat assez simple. Il n&#39;a qu&#39;une seule fonction, <span class="keep-together"><code>withdraw</code></span>, qui sert √† retirer de l'<em>ether</em>. Il n&#39;a pas de fonction pour retirer le MET, ou tout autre jeton ERC20. Si nous utilisons withdraw, il essaiera d&#39;envoyer de l&#39;ether, mais comme Faucet n&#39;a pas encore de solde d&#39;ether, il √©chouera.</p>
</div>
<div class="paragraph data-line-594">
<p>Le contrat METoken sait que Faucet a un solde, mais le seul moyen de transf√©rer ce solde est de recevoir un appel transfer de l&#39;adresse du contrat. D&#39;une mani√®re ou d&#39;une autre, nous devons faire en sorte que le contrat Faucet appelle la fonction transfer dans <span class="keep-together"><code>METoken</code></span>.</p>
</div>
<div class="paragraph data-line-596">
<p>Si vous vous demandez quoi faire ensuite, ne le faites pas. Il n&#39;y a pas de solution √† ce probl√®me. Le MET envoy√© √† Faucet est bloqu√©, pour toujours. Seul le contrat Faucet peut le transf√©rer, et le contrat Faucet n&#39;a pas de code pour appeler la fonction transfer d&#39;un contrat de jeton ERC20.</p>
</div>
<div class="paragraph data-line-598">
<p>Peut-√™tre avez-vous anticip√© ce probl√®me. Tr√®s probablement, vous ne l&#39;avez pas fait. En fait, des centaines d&#39;utilisateurs d&#39;Ethereum qui ont accidentellement transf√©r√© divers jetons vers des contrats qui n&#39;avaient aucune capacit√© ERC20 n&#39;en ont pas non plus fait. Selon certaines estimations, des jetons d&#39;une valeur de plus d&#39;environ 2,5 millions de dollars (au moment de la r√©daction) sont rest√©s &quot;bloqu√©s&quot; comme √ßa et sont perdus √† jamais.</p>
</div>
<div class="paragraph data-line-600">
<p>L&#39;une des fa√ßons dont les utilisateurs de jetons ERC20 peuvent perdre par inadvertance leurs jetons lors d&#39;un transfert, c&#39;est lorsqu&#39;ils tentent de transf√©rer vers un √©change ou un autre service. Ils copient une adresse Ethereum √† partir du site Web d&#39;un √©change, pensant qu&#39;ils peuvent simplement lui envoyer des jetons. Cependant, de nombreux √©changes publient des adresses de r√©ception qui sont en fait des contrats ! Ces contrats sont uniquement destin√©s √† recevoir de l&#39;√©ther, pas des jetons ERC20, balayant le plus souvent tous les fonds qui leur sont envoy√©s vers un ¬´ stockage √† froid ¬ª ou un autre portefeuille centralis√©. Malgr√© les nombreux avertissements indiquant &quot;n&#39;envoyez pas de jetons √† cette adresse&quot;, de nombreux jetons sont perdus de cette fa√ßon.</p>
</div>
</div>
<div class="sect4 data-line-603">
<h5 id="transfer_workflow_demo">D√©monstration du flux de travail &quot;approuver et transf√©rer de&quot;</h5>
<div class="paragraph data-line-605">
<p>Notre contrat Faucet ne pouvait pas g√©rer les jetons ERC20. L&#39;envoi de jetons √† l&#39;aide de la fonction + transfer + a entra√Æn√© la perte de ces jetons. R√©√©crivons maintenant le contrat et faisons en sorte qu&#39;il g√®re les jetons ERC20. Plus pr√©cis√©ment, nous allons le transformer en un robinet qui donne du MET √† quiconque le demande.</p>
</div>
<div class="paragraph data-line-607">
<p>Pour cet exemple, nous allons faire une copie du r√©pertoire du projet <em>truffle</em> (nous l&#39;appellerons <em>METoken_METFaucet</em>), initialiser truffle et npm, installer les d√©pendances OpenZeppelin et copier le contrat <em>METoken.sol</em>. Voir notre premier exemple, dans <a href="#METoken_example">Lancement de notre propre jeton ERC20</a>, pour les instructions d√©taill√©es.</p>
</div>
<div class="paragraph data-line-609">
<p>Notre nouveau contrat de robinetterie, <em>METFaucet.sol</em>, ressemblera √† <a href="#METFaucet">METFaucet.sol : Un robinet pour METoken</a>.</p>
</div>
<div id="METFaucet" class="exampleblock data-line-613">
<div class="title">Example 21. METFaucet.sol : Un robinet pour METoken</div>
<div class="content">
<div class="listingblock data-line-615">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version of Solidity compiler this program was written for
pragma solidity ^0.4.19;

import 'openzeppelin-solidity/contracts/token/ERC20/StandardToken.sol';


// A faucet for ERC20 token MET
contract METFaucet {

	StandardToken public METoken;
	address public METOwner;

	// METFaucet constructor, provide the address of METoken contract and
	// the owner address we will be approved to transferFrom
	function METFaucet(address _METoken, address _METOwner) public {

		// Initialize the METoken from the address provided
		METoken = StandardToken(_METoken);
		METOwner = _METOwner;
	}

	function withdraw(uint withdraw_amount) public {

    	// Limit withdrawal amount to 10 MET
    	require(withdraw_amount &lt;= 1000);

		// Use the transferFrom function of METoken
		METoken.transferFrom(METOwner, msg.sender, withdraw_amount);
    }

	// REJECT any incoming ether
	function () external payable { revert(); }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-620">
<p>Nous avons apport√© quelques modifications √† l&#39;exemple de base de Faucet. Puisque METFaucet utilisera la fonction transferFrom dans METoken, il aura besoin de deux variables suppl√©mentaires. L&#39;un contiendra l&#39;adresse du contrat METoken d√©ploy√©. L&#39;autre d√©tiendra l&#39;adresse du propri√©taire du MET, qui approuvera les retraits du robinet. Le contrat METFaucet appellera METoken.transferFrom et lui demandera de d√©placer le MET du propri√©taire vers l&#39;adresse d&#39;o√π provient la demande de retrait du robinet.</p>
</div>
<div class="paragraph data-line-623">
<p>Nous d√©clarons ici ces deux variables :</p>
</div>
<div class="listingblock data-line-626">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">StandardToken public METoken;
address public METOwner;</code></pre>
</div>
</div>
<div class="paragraph data-line-631">
<p>√âtant donn√© que notre robinet doit √™tre initialis√© avec les adresses correctes pour METoken et METOwner, nous devons d√©clarer un constructeur personnalis√©¬†:</p>
</div>
<div id="custom_constructor" class="listingblock data-line-635">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Constructeur METFaucet - fournir l&amp;#39;adresse du contrat METoken et
// l&amp;#39;adresse du propri√©taire que nous serons autoris√©s √† transf√©rer avec transferFrom
function METFaucet(address _METoken, address _METOwner) public {

	// Initialise le METoken √† partir de l&amp;#39;adresse fournie
	METoken = StandardToken(_METoken);
	METOwner = _METOwner;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-646">
<p>Le prochain changement concerne la fonction withdraw. Au lieu d&#39;appeler transfer, METFaucet utilise la fonction transferFrom dans METoken et demande √† METoken de transf√©rer MET au destinataire du robinet¬†:</p>
</div>
<div id="transfer_met" class="listingblock data-line-650">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Utiliser la fonction transferFrom de METoken
METoken.transferFrom(METOwner, msg.sender, withdraw_amount);</code></pre>
</div>
</div>
<div class="paragraph data-line-655">
<p>Enfin, puisque notre robinet n&#39;envoie plus d&#39;ether, nous devrions probablement emp√™cher quiconque d&#39;envoyer de l&#39;ether √† METFaucet, car nous ne voudrions pas qu&#39;il reste bloqu√©. Nous modifions la fonction de paiement de secours pour rejeter l&#39;ether entrant, en utilisant la fonction revert pour annuler tout paiement entrant¬†:</p>
</div>
<div id="reject_incoming_eth" class="listingblock data-line-659">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// REJETER tout ether entrant
function () external payable { revert(); }</code></pre>
</div>
</div>
<div class="paragraph data-line-664">
<p>Maintenant que notre code <em>METFaucet.sol</em> est pr√™t, nous devons modifier le script de migration pour le d√©ployer. Ce script de migration sera un peu plus complexe, car METFaucet d√©pend de l&#39;adresse de METoken. Nous utiliserons une promesse JavaScript pour d√©ployer les deux contrats en s√©quence. Cr√©ez <em>2_deploy_contracts.js</em> comme suit¬†:</p>
</div>
<div class="listingblock data-line-667">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var METoken = artifacts.require("METoken");
var METFaucet = artifacts.require("METFaucet");
var owner = web3.eth.accounts[0];

module.exports = function(deployer) {

	// D√©ployer d&amp;#39;abord le contrat METoken
	deployer.deploy(METoken, {from: owner}).then(function() {
		// Ensuite, d√©ployer METFaucet et passez l&amp;#39;adresse de METoken et
		// l'adresse du propri√©taire de tous les MET qui agr√©era METFaucet
		return deployer.deploy(METFaucet, METoken.address, owner);
  	});
}</code></pre>
</div>
</div>
<div class="paragraph data-line-683">
<p>Maintenant, nous pouvons tout tester dans la console Truffle. Tout d&#39;abord, nous utilisons migrate pour d√©ployer les contrats. Lorsque METoken est d√©ploy√©, il alloue tout le MET au compte qui l&#39;a cr√©√©, web3.eth.accounts[0]. Ensuite, nous appelons la fonction approve dans <code><span class="keep-together">METoken</span></code> pour approuver METFaucet afin d&#39;envoyer jusqu&#39;√† 1 000 MET au nom de web3.eth.accounts[0]. Enfin, pour tester notre faucet, nous appelons METFaucet.withdraw depuis web3.eth.accounts[1] et essayons de retirer 10 MET. Voici les commandes de la console¬†:</p>
</div>
<pre data-type="programlist">
$ <strong>truffle console --network ganache</strong>
truffle(ganache)&gt; <strong>migrate</strong>
Using network 'ganache'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x79352b43e18cc46b023a779e9a0d16b30f127bfa40266c02f9871d63c26542c7
  Migrations: 0xaa588d3737b611bafd7bd713445b314bd453a5c8
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing METoken...
  ... 0xc42a57f22cddf95f6f8c19d794c8af3b2491f568b38b96fef15b13b6e8bfff21
  METoken: 0xf204a4ef082f5c04bb89f7d5e6568b796096735a
  Replacing METFaucet...
  ... 0xd9615cae2fa4f1e8a377de87f86162832cf4d31098779e6e00df1ae7f1b7f864
  METFaucet: 0x75c35c980c0d37ef46df04d31a140b65503c0eed
Saving artifacts...
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.approve(METFaucet.address, 100000) })</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(web3.eth.accounts[1]).then(console.log) })</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 0, c: [ 0 ] }</strong>
truffle(ganache)&gt; <strong>METFaucet.deployed().then(instance =>
                  { instance.withdraw(1000, {from:web3.eth.accounts[1]}) } )</strong>
truffle(ganache)&gt; <strong>METoken.deployed().then(instance =>
                  { instance.balanceOf(web3.eth.accounts[1]).then(console.log) })</strong>
truffle(ganache)&gt; <strong>BigNumber { s: 1, e: 3, c: [ 1000 ] }</strong>

</pre>
<div class="paragraph data-line-718">
<p>Comme vous pouvez le voir sur les r√©sultats, nous pouvons utiliser le flux de travail approve et transferFrom pour autoriser un contrat √† transf√©rer des jetons d√©finis dans un autre jeton. S&#39;ils sont correctement utilis√©s, les jetons ERC20 peuvent √™tre utilis√©s par les EOA et d&#39;autres contrats.</p>
</div>
<div class="paragraph data-line-720">
<p>Cependant, la charge de g√©rer correctement les jetons ERC20 est transmise √† l&#39;interface utilisateur. Si un utilisateur tente √† tort de transf√©rer des jetons ERC20 vers une adresse de contrat et que ce contrat n&#39;est pas √©quip√© pour recevoir des jetons ERC20, les jetons seront perdus.</p>
</div>
</div>
</div>
<div class="sect3 data-line-723">
<h4 id="ERC20_issues">Probl√®mes avec les jetons ERC20</h4>
<div class="paragraph data-line-725">
<p>L&#39;adoption de la norme de jeton ERC20 a √©t√© vraiment explosive. Des milliers de jetons ont √©t√© lanc√©s, √† la fois pour exp√©rimenter de nouvelles capacit√©s et pour lever des fonds dans diverses ench√®res et &quot;financements participatifs&quot; ICO. Cependant, il existe des pi√®ges potentiels, comme nous l&#39;avons vu avec la question du transfert de jetons vers des adresses contractuelles.</p>
</div>
<div class="paragraph data-line-727">
<p>L&#39;un des probl√®mes les moins √©vidents avec les jetons ERC20 est qu&#39;ils exposent des diff√©rences subtiles entre les jetons et l&#39;ether lui-m√™me. Lorsque l&#39;ether est transf√©r√© par une transaction qui a une adresse de destinataire comme destination, les transferts de jeton se produisent dans l&#39;_√©tat sp√©cifique du contrat de jeton_ et ont le contrat de jeton comme destination, et non l&#39;adresse du destinataire. Le contrat de jeton suit les soldes et √©met des √©v√©nements. Dans un transfert de jeton, aucune transaction n&#39;est r√©ellement envoy√©e au destinataire du jeton. Au lieu de cela, l&#39;adresse du destinataire est ajout√©e √† un tableau dans le contrat de jeton lui-m√™me. Une transaction envoyant de l&#39;ether √† une adresse modifie l&#39;√©tat d&#39;une adresse. Une transaction transf√©rant un jeton √† une adresse ne modifie que l&#39;√©tat du contrat de jeton, pas l&#39;√©tat de l&#39;adresse du destinataire. M√™me un portefeuille prenant en charge les jetons ERC20 ne prend pas connaissance d&#39;un solde de jetons √† moins que l&#39;utilisateur n&#39;ajoute explicitement un contrat de jeton sp√©cifique √† ¬´ surveiller ¬ª. Certains portefeuilles surveillent les contrats de jetons les plus populaires pour d√©tecter les soldes d√©tenus par les adresses qu&#39;ils contr√¥lent, mais cela est limit√© √† une petite fraction des <span class="keep-together">contrats</span> ERC20 existants.</p>
</div>
<div class="paragraph data-line-729">
<p>En fait, il est peu probable qu&#39;un utilisateur veuille suivre tous les soldes de tous les contrats de jetons ERC20 possibles. De nombreux jetons ERC20 ressemblent plus √† du courrier ind√©sirable qu&#39;√† des jetons utilisables. Ils cr√©ent automatiquement des soldes pour les comptes qui ont une activit√© ether, afin d&#39;attirer les utilisateurs. Si vous avez une adresse Ethereum avec une longue histoire d&#39;activit√©, surtout si elle a √©t√© cr√©√©e lors de la pr√©vente, vous la trouverez pleine de jetons &quot;ind√©sirables&quot; qui sont apparus de nulle part. Bien s√ªr, l&#39;adresse n&#39;est pas vraiment pleine de jetons ; ce sont les contrats symboliques qui contiennent votre adresse. Vous ne voyez ces soldes que si ces contrats de jetons sont surveill√©s par l&#39;explorateur de blocs ou le portefeuille que vous utilisez pour afficher votre adresse.</p>
</div>
<div class="paragraph data-line-731">
<p>Les jetons ne se comportent pas de la m√™me mani√®re que l&#39;ether. L&#8217;ether est envoy√© avec la fonction send et accept√© par toute fonction payante dans un contrat ou toute adresse d√©tenue en externe. Les jetons sont envoy√©s √† l&#39;aide des fonctions transfer ou approve et transferFrom qui n&#39;existent que dans le contrat ERC20, et ne d√©clenchent (du moins dans ERC20) aucune fonction payante dans un contrat destinataire. Les jetons sont cens√©s fonctionner comme une cryptomonnaie telle que l&#39;ether, mais ils pr√©sentent certaines diff√©rences qui brisent cette illusion.</p>
</div>
<div class="paragraph data-line-733">
<p>Envisagez un autre probl√®me. Pour envoyer de l&#39;ether ou utiliser un contrat Ethereum, vous avez besoin d&#39;ether pour payer le gaz. Pour envoyer des jetons, vous avez <em>√©galement besoin d&#39;ether</em>. Vous ne pouvez pas payer le gaz d&#39;une transaction avec un jeton et le contrat de jeton ne peut pas payer le gaz pour vous. Cela peut changer √† un moment donn√© dans un avenir lointain, mais entre-temps, cela peut entra√Æner des exp√©riences utilisateur plut√¥t √©tranges. Par exemple, supposons que vous utilisiez un √©change ou ShapeShift pour convertir du bitcoin en jeton. Vous &quot;recevez&quot; le jeton dans un portefeuille qui suit le contrat de ce jeton et affiche votre solde. Il ressemble √† toutes les autres crypto-monnaies que vous avez dans votre portefeuille. Essayez d&#39;envoyer le jeton et votre portefeuille vous informera que vous avez besoin d&#39;ether pour le faire. Vous pourriez √™tre confus - apr√®s tout, vous n&#39;aviez pas besoin d&#39;ether pour recevoir le jeton. Peut-√™tre que vous n&#39;avez pas d&#39;ether. Peut-√™tre ne saviez-vous m√™me pas que le jeton √©tait un jeton ERC20 sur Ethereum; peut-√™tre pensiez-vous qu&#39;il s&#39;agissait d&#39;une cryptomonnaie avec sa propre cha√Æne de blocs. L&#39;illusion vient de se briser.</p>
</div>
<div class="paragraph data-line-735">
<p>Certains de ces probl√®mes sont sp√©cifiques aux jetons ERC20. D&#39;autres sont des probl√®mes plus g√©n√©raux li√©s √† l&#39;abstraction et aux limites d&#39;interface au sein d&#39;Ethereum. Certains peuvent √™tre r√©solus en modifiant l&#39;interface du jeton, tandis que d&#39;autres peuvent n√©cessiter des modifications des structures fondamentales au sein d&#39;Ethereum (comme la distinction entre EOA et contrats, et entre transactions et messages). Certains peuvent ne pas √™tre exactement &quot;solvable&quot; et peuvent n√©cessiter une conception d&#39;interface utilisateur pour masquer les nuances et rendre l&#39;exp√©rience utilisateur coh√©rente, quelles que soient les distinctions sous-jacentes.</p>
</div>
<div class="paragraph data-line-737">
<p>Dans les prochaines sections, nous examinerons diverses propositions qui tentent de r√©soudre certains de ces probl√®mes.</p>
</div>
</div>
<div class="sect3 data-line-740">
<h4 id="ERC223_std">ERC223¬†: une norme d&#39;interface de contrat de jeton propos√©e</h4>
<div class="paragraph data-line-742">
<p>La proposition ERC223 tente de r√©soudre le probl√®me du transfert par inadvertance de jetons vers un contrat (qui peut ou non prendre en charge jetons) en d√©tectant si l&#39;adresse de destination est un contrat ou non. ERC223 exige que les contrats con√ßus pour accepter des jetons impl√©mentent une fonction nomm√©e tokenFallback. Si la destination d&#39;un transfert est un contrat et que le contrat ne prend pas en charge les jetons (c&#39;est-√†-dire qu&#39;il n&#39;impl√©mente pas tokenFallback), le transfert √©choue.</p>
</div>
<div id="is_contract" class="paragraph data-line-745">
<p>Pour d√©tecter si l&#39;adresse de destination est un contrat, l&#39;impl√©mentation de r√©f√©rence ERC223 utilise un petit segment de bytecode en ligne d&#39;une mani√®re plut√¥t cr√©ative¬†:</p>
</div>
<div class="listingblock data-line-748">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">function isContract(address _addr) private view returns (bool is_contract) {
  uint length;
    assembly {
       // r√©cup√®re la taille du code sur l&amp;#39;adresse cible¬†; cela n√©cessite un assemblage
       length := extcodesize(_addr)
    }
    return (length&gt;0);
}</code></pre>
</div>
</div>
<div id="ERC223_interface" class="paragraph data-line-760">
<p>La sp√©cification de l&#39;interface de contrat ERC223 est¬†:</p>
</div>
<div class="listingblock data-line-763">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC223Token {
  uint public totalSupply;
  function balanceOf(address who) public view returns (uint);

  function name() public view returns (string _name);
  function symbol() public view returns (string _symbol);
  function decimals() public view returns (uint8 _decimals);
  function totalSupply() public view returns (uint256 _supply);

  function transfer(address to, uint value) public returns (bool ok);
  function transfer(address to, uint value, bytes data) public returns (bool ok);
  function transfer(address to, uint value, bytes data, string custom_fallback)
      public returns (bool ok);

  event Transfer(address indexed from, address indexed to, uint value,
                 bytes indexed data);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-783">
<p>ERC223 n&#39;est pas largement mis en ≈ìuvre, et il y a un d√©bat dans le fil <a href="https://github.com/ethereum/EIPs/issues/223" data-href="https://github.com/ethereum/EIPs/issues/223">de discussion ERC</a> sur la r√©trocompatibilit√© et les compromis entre la mise en ≈ìuvre des changements au niveau de l&#39;interface du contrat par rapport √† l&#8217;interface utilisateur. Le d√©bat continue.</p>
</div>
</div>
<div class="sect3 data-line-785">
<h4 id="_erc777_une_norme_dinterface_de_contrat_de_jeton_propos√©e">ERC777¬†: une norme d&#39;interface de contrat de jeton propos√©e</h4>
<div class="paragraph data-line-787">
<p>Une autre proposition pour une norme de contrat de jeton am√©lior√©e est <a href="https://eips.ethereum.org/EIPS/eip-777" data-href="https://eips.ethereum.org/EIPS/eip-777">ERC777</a>. Cette proposition a plusieurs objectifs, notamment :</p>
</div>
<div class="ulist data-line-789">
<ul>
<li class="data-line-789">
<p>Offrir une interface compatible ERC20</p>
</li>
<li class="data-line-790">
<p>Pour transf√©rer des jetons √† l&#39;aide d&#39;une fonction send, similaire aux transferts d&#39;ether</p>
</li>
<li class="data-line-791">
<p>Pour √™tre compatible avec ERC820 pour l&#39;enregistrement de contrat de jeton</p>
</li>
<li class="data-line-792">
<p>Pour permettre aux contrats et aux adresses de contr√¥ler les jetons qu&#39;ils envoient via une fonction <code>tokensToSend</code> qui est appel√©e avant l&#39;envoi</p>
</li>
<li class="data-line-793">
<p>Pour permettre aux contrats et aux adresses d&#39;√™tre inform√©s de la r√©ception des jetons en appelant une fonction <code>tokensReceived</code> dans le destinataire, et pour r√©duire la probabilit√© que les jetons soient verrouill√©s dans des contrats en exigeant que les contrats fournissent une fonction <span class="keep-together"><code>tokensReceived</code></span></p>
</li>
<li class="data-line-794">
<p>Pour permettre aux contrats existants d&#39;utiliser des contrats par procuration pour les fonctions tokensToSend et tokensReceived</p>
</li>
<li class="data-line-795">
<p>Pour fonctionner de la m√™me mani√®re que vous envoyiez vers un contrat ou un EOA</p>
</li>
<li class="data-line-796">
<p>Pour fournir des √©v√©nements sp√©cifiques pour la frappe et la gravure de jetons</p>
</li>
<li class="data-line-797">
<p>Pour permettre aux op√©rateurs (tiers de confiance, destin√©s √† √™tre des contrats v√©rifi√©s) de d√©placer des jetons pour le compte d&#39;un d√©tenteur de jetons</p>
</li>
<li class="data-line-798">
<p>Pour fournir des m√©tadonn√©es sur les transactions de transfert de jetons dans les champs userData et operatorData</p>
</li>
</ul>
</div>
<div class="paragraph data-line-800">
<p>La discussion en cours sur ERC777 peut √™tre trouv√©e <a href="https://github.com/ethereum/EIPs/issues/777" data-href="https://github.com/ethereum/EIPs/issues/777">sur GitHub</a>.</p>
</div>
<div id="ERC777_interface" class="paragraph data-line-803">
<p>La sp√©cification de l&#39;interface de contrat ERC777 est¬†:</p>
</div>
<div class="listingblock data-line-806">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777Token {
    function name() public constant returns (string);
    function symbol() public constant returns (string);
    function totalSupply() public constant returns (uint256);
    function granularity() public constant returns (uint256);
    function balanceOf(address owner) public constant returns (uint256);

    function send(address to, uint256 amount, bytes userData) public;

    function authorizeOperator(address operator) public;
    function revokeOperator(address operator) public;
    function isOperatorFor(address operator, address tokenHolder)
        public constant returns (bool);
    function operatorSend(address from, address to, uint256 amount,
                          bytes userData,bytes operatorData) public;

    event Sent(address indexed operator, address indexed from,
               address indexed to, uint256 amount, bytes userData,
               bytes operatorData);
    event Minted(address indexed operator, address indexed to,
                 uint256 amount, bytes operatorData);
    event Burned(address indexed operator, address indexed from,
                 uint256 amount, bytes userData, bytes operatorData);
    event AuthorizedOperator(address indexed operator,
                             address indexed tokenHolder);
    event RevokedOperator(address indexed operator, address indexed tokenHolder);
}</code></pre>
</div>
</div>
<div class="sect4 data-line-837">
<h5 id="ERC777_hooks">Crochets ERC777</h5>
<div id="ERC777TokensSender_interface" class="paragraph data-line-840">
<p>La sp√©cification de crochet d&#39;exp√©diteur de jetons ERC777 est¬†:</p>
</div>
<div class="listingblock data-line-843">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777TokensSender {
    function tokensToSend(address operator, address from, address to,
                          uint value, bytes userData, bytes operatorData) public;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-850">
<p>La mise en place de cette interface est n√©cessaire pour toute adresse souhaitant √™tre notifi√©e, g√©rer ou emp√™cher le d√©bit de jetons. L&#39;adresse pour laquelle le contrat impl√©mente cette interface doit √™tre enregistr√©e via ERC820, que le contrat impl√©mente l&#39;interface pour lui-m√™me ou pour une autre adresse.</p>
</div>
<div id="ERC777TokensRecipient_interface" class="paragraph data-line-853">
<p>La sp√©cification du crochet du destinataire des jetons ERC777 est¬†:</p>
</div>
<div class="listingblock data-line-856">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC777TokensRecipient {
  function tokensReceived(
     address operator, address from, address to,
    uint amount, bytes userData, bytes operatorData
  ) public;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-865">
<p>La mise en place de cette interface est n√©cessaire pour toute adresse souhaitant √™tre notifi√©e, traiter ou rejeter la r√©ception de jetons. La m√™me logique et les m√™mes exigences s&#39;appliquent au destinataire des jetons qu&#39;√† l&#39;interface de l&#39;exp√©diteur des jetons, avec la contrainte suppl√©mentaire que les contrats destinataires doivent impl√©menter cette interface pour emp√™cher le verrouillage des jetons. Si le contrat destinataire n&#39;enregistre pas d&#39;adresse impl√©mentant cette interface, le transfert des jetons √©chouera.</p>
</div>
<div class="paragraph data-line-867">
<p>Un aspect important est qu&#39;un seul exp√©diteur de jeton et un seul destinataire de jeton peuvent √™tre enregistr√©s par adresse. Par cons√©quent, pour chaque transfert de jeton ERC777, les m√™mes fonctions de crochet sont appel√©es lors du d√©bit et de la r√©ception de chaque transfert de jeton ERC777. Un jeton sp√©cifique peut √™tre identifi√© dans ces fonctions √† l&#39;aide de l&#39;exp√©diteur du message, qui est l&#39;adresse de contrat de jeton sp√©cifique, pour g√©rer un cas d&#39;utilisation particulier.</p>
</div>
<div class="paragraph data-line-869">
<p>D&#39;autre part, les m√™mes hooks d&#39;exp√©diteur et de destinataire de jeton peuvent √™tre enregistr√©s pour plusieurs adresses et les hooks peuvent distinguer qui sont l&#39;exp√©diteur et le destinataire pr√©vu √† l&#39;aide des param√®tres &quot;from&quot; et &quot;to&quot;.</p>
</div>
<div class="paragraph data-line-871">
<p>Une <a href="http://bit.ly/2qkAKba" data-href="http://bit.ly/2qkAKba">impl√©mentation de r√©f√©rence</a> d&#39;ERC777 est li√©e dans la proposition. ERC777 d√©pend d&#39;une proposition parall√®le de contrat de registre, sp√©cifi√©e dans ERC820. Une partie du d√©bat sur ERC777 porte sur la complexit√© de l&#39;adoption simultan√©e de deux grands changements¬†: une nouvelle norme de jeton et une norme de registre. La discussion continue.</p>
</div>
</div>
</div>
<div class="sect3 data-line-874">
<h4 id="erc721">ERC721¬†: norme de jeton non fongible (acte)</h4>
<div class="paragraph data-line-876">
<p>Toutes les normes de jeton que nous avons examin√©es jusqu&#39;√† pr√©sent concernent les jetons <em>fungible</em>, ce qui signifie que les unit√©s de un jeton sont interchangeables. La norme de jeton ERC20 ne suit que le solde final de chaque compte et ne suit pas (explicitement) la provenance d&#39;un jeton.</p>
</div>
<div class="paragraph data-line-878">
<p> La <a href="http://bit.ly/2Ogs7Im" data-href="http://bit.ly/2Ogs7Im">proposition ERC721</a> concerne une norme pour les jetons <em>non fongibles</em>, √©galement appel√©s <em>actes</em>.</p>
</div>
<div class="paragraph data-line-880">
<p>Extrait du dictionnaire Oxford¬†:</p>
</div>
<div class="quoteblock data-line-882">
<blockquote>
<div class="paragraph data-line-883">
<p><em>acte</em>¬†: un document juridique qui est sign√© et remis, en particulier un document concernant la propri√©t√© d&#39;un bien ou des droits l√©gaux.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-886">
<p>L&#39;utilisation du mot &quot;acte&quot; est destin√©e √† refl√©ter la partie &quot;propri√©t√© d&#39;un bien&quot;, m√™me si ceux-ci ne sont pas reconnus comme des &quot;documents juridiques&quot; dans aucune juridiction - pour le moment. Il est probable qu&#39;√† un moment donn√© dans le futur, la propri√©t√© l√©gale bas√©e sur des signatures num√©riques sur une plate-forme cha√Æne de blocs sera l√©galement reconnue.</p>
</div>
<div class="paragraph data-line-888">
<p>Les jetons non fongibles suivent la propri√©t√© d&#39;une chose unique. L&#39;objet poss√©d√© peut √™tre un objet num√©rique, tel qu&#39;un objet de jeu ou un objet de collection num√©rique ; ou la chose peut √™tre un objet physique dont la propri√©t√© est suivie par un jeton, comme une maison, une voiture ou une ≈ìuvre d&#39;art. Les actes peuvent √©galement repr√©senter des choses de valeur n√©gative, telles que des pr√™ts (dettes), des privil√®ges, des servitudes, etc. La norme ERC721 n&#39;impose aucune limitation ou attente sur la nature de la chose dont la propri√©t√© est suivie par un acte et exige seulement qu&#39;elle puisse √™tre identifi√© de mani√®re unique, ce qui, dans le cas de cette norme, est obtenu par un <span class="keep-together">identifiant</span> de 256 bits¬†.</p>
</div>
<div class="paragraph data-line-890">
<p>Les d√©tails de la norme et de la discussion sont suivis sur deux <span class="keep-together">fils</span> GitHub diff√©rents:</p>
</div>
<div class="ulist data-line-892">
<ul>
<li class="data-line-892">
<p><a href="https://github.com/ethereum/EIPs/issues/721" data-href="https://github.com/ethereum/EIPs/issues/721">Proposition initiale</a></p>
</li>
<li class="data-line-894">
<p><a href="https://github.com/ethereum/EIPs/pull/841" data-href="https://github.com/ethereum/EIPs/pull/841">Discussion continue</a></p>
</li>
</ul>
</div>
<div id="map_deed_owner" class="paragraph data-line-897">
<p>Pour saisir la diff√©rence fondamentale entre ERC20 et ERC721, il suffit de regarder la structure de donn√©es interne utilis√©e dans ERC721¬†:</p>
</div>
<div class="listingblock data-line-900">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Mappage de l&amp;#39;ID de l&amp;#39;acte au propri√©taire
mapping (uint256 =&gt; address) private deedOwner;</code></pre>
</div>
</div>
<div class="paragraph data-line-905">
<p>Alors que l&#39;ERC20 suit les soldes appartenant √† chaque propri√©taire, le propri√©taire √©tant la cl√© primaire du mappage, l&#39;ERC721 suit chaque ID d&#39;acte et son propri√©taire, l&#39;ID d&#39;acte √©tant la cl√© primaire du mappage. De cette diff√©rence fondamentale d√©coulent toutes les propri√©t√©s d&#39;un jeton non fongible.</p>
</div>
<div id="ERC721_interface" class="paragraph data-line-908">
<p>La sp√©cification de l&#39;interface de contrat ERC721 est¬†:</p>
</div>
<div class="listingblock data-line-911">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721 /* is ERC165 */ {
    event Transfer(address indexed _from, address indexed _to, uint256 _deedId);
    event Approval(address indexed _owner, address indexed _approved,
                   uint256 _deedId);
    event ApprovalForAll(address indexed _owner, address indexed _operator,
                         bool _approved);

    function balanceOf(address _owner) external view returns (uint256 _balance);
    function ownerOf(uint256 _deedId) external view returns (address _owner);
    function transfer(address _to, uint256 _deedId) external payable;
    function transferFrom(address _from, address _to, uint256 _deedId)
        external payable;
    function approve(address _approved, uint256 _deedId) external payable;
    function setApprovalForAll(address _operateor, boolean _approved) payable;
    function supportsInterface(bytes4 interfaceID) external view returns (bool);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-930">
<p>ERC721 prend √©galement en charge deux interfaces <em>optionnelles</em>, une pour les m√©tadonn√©es et une pour l&#39;√©num√©ration des actes et des propri√©taires.</p>
</div>
<div id="ERC721_metadata" class="paragraph data-line-933">
<p>L&#39;interface optionnelle ERC721 pour les m√©tadonn√©es est¬†:</p>
</div>
<div class="listingblock data-line-936">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721Metadata /* is ERC721 */ {
    function name() external pure returns (string _name);
    function symbol() external pure returns (string _symbol);
    function deedUri(uint256 _deedId) external view returns (string _deedUri);
}</code></pre>
</div>
</div>
<div id="ERC721_enum" class="paragraph data-line-945">
<p>L&#39;interface optionnelle ERC721 pour l&#39;√©num√©ration est :</p>
</div>
<div class="listingblock data-line-948">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">interface ERC721Enumerable /* is ERC721 */ {
    function totalSupply() external view returns (uint256 _count);
    function deedByIndex(uint256 _index) external view returns (uint256 _deedId);
    function countOfOwners() external view returns (uint256 _count);
    function ownerByIndex(uint256 _index) external view returns (address _owner);
    function deedOfOwnerByIndex(address _owner, uint256 _index) external view
        returns (uint256 _deedId);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-960">
<h3 id="token_std_review">Utilisation des normes de jeton</h3>
<div class="paragraph data-line-962">
<p>Dans la section pr√©c√©dente, nous avons examin√© plusieurs normes propos√©es et quelques normes largement d√©ploy√©es pour les contrats de jetons. A quoi servent exactement ces normes ? Devez-vous utiliser ces normes ? Comment devriez-vous les utiliser? Devriez-vous ajouter des fonctionnalit√©s au-del√† de ces normes¬†? Quelles normes devez-vous utiliser ? Nous examinerons ensuite certaines de ces questions.</p>
</div>
<div class="sect3 data-line-965">
<h4 id="token_std_purpose">Que sont les normes de jeton¬†? Quel est leur but ?</h4>
<div class="paragraph data-line-967">
<p>Les normes de jetons sont les sp√©cifications <em>minimales</em> pour une impl√©mentation. Cela signifie que pour √™tre conforme, par exemple, √† ERC20, vous devez au minimum impl√©menter les fonctions et le comportement sp√©cifi√©s par la norme ERC20. Vous √™tes √©galement libre d&#39;_ajouter_ √† la fonctionnalit√© en impl√©mentant des fonctions qui ne font pas partie de la norme.</p>
</div>
<div class="paragraph data-line-969">
<p>L&#39;objectif principal de ces normes est d&#39;encourager l&#39;_interop√©rabilit√©_ entre les contrats. Ainsi, tous les portefeuilles, √©changes, interfaces utilisateur et autres composants d&#39;infrastructure peuvent <em>s&#39;interfacer</em> de mani√®re pr√©visible avec tout contrat qui suit la sp√©cification. En d&#39;autres termes, si vous d√©ployez un contrat qui suit la norme ERC20, tous les utilisateurs de portefeuille existants peuvent commencer √† √©changer votre jeton de mani√®re transparente sans aucune mise √† niveau de portefeuille ni effort de votre part.</p>
</div>
<div class="paragraph data-line-971">
<p>Les normes sont cens√©es √™tre <em>descriptives</em> plut√¥t que <em>prescriptives</em>. La fa√ßon dont vous choisissez de mettre en ≈ìuvre ces fonctions d√©pend de vous - le fonctionnement interne du contrat n&#39;est pas pertinent pour la norme. Ils ont des exigences fonctionnelles, qui r√©gissent le comportement dans des circonstances sp√©cifiques, mais ils ne prescrivent pas de mise en ≈ìuvre. Un exemple de ceci est le comportement d&#39;une fonction transfer si la valeur est d√©finie sur z√©ro.</p>
</div>
</div>
<div class="sect3 data-line-974">
<h4 id="should_use_std">Devriez-vous utiliser ces normes¬†?</h4>
<div class="paragraph data-line-976">
<p>Compte tenu de tous ces standards, chaque d√©veloppeur est confront√© √† un dilemme : utiliser les standards existants ou innover au-del√† des contraintes qu&#39;ils imposent ?</p>
</div>
<div class="paragraph data-line-978">
<p>Ce dilemme n&#39;est pas facile √† r√©soudre. Les normes restreignent n√©cessairement votre capacit√© √† innover, en cr√©ant une &quot;orni√®re&quot; √©troite que vous devez suivre. D&#39;autre part, les normes de base ont √©merg√© de l&#39;exp√©rience de centaines d&#39;applications et s&#39;adaptent souvent bien √† la grande majorit√© des cas d&#39;utilisation.</p>
</div>
<div class="paragraph data-line-980">
<p>Dans le cadre de cette consid√©ration, il y a un probl√®me encore plus important¬†: la valeur de l&#39;interop√©rabilit√© et de l&#39;adoption √† grande √©chelle. Si vous choisissez d&#39;utiliser une norme existante, vous gagnez la valeur de tous les syst√®mes con√ßus pour fonctionner avec cette norme. Si vous choisissez de vous √©carter de la norme, vous devez prendre en compte le co√ªt de la construction de toute l&#39;infrastructure de support par vous-m√™me ou persuader les autres de prendre en charge votre mise en ≈ìuvre en tant que nouvelle norme. La tendance √† forger votre propre chemin et √† ignorer les normes existantes est connue sous le nom de syndrome &quot;Not Invented Here&quot; (Non invent√© ici) et est contraire √† la culture open source. D&#39;autre part, le progr√®s et l&#39;innovation d√©pendent parfois de l&#39;abandon de la tradition. C&#39;est un choix d√©licat, alors r√©fl√©chissez bien !</p>
</div>
<div class="admonitionblock note data-line-983">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-984">
<p>Selon Wikipedia, <a href="https://en.wikipedia.org/wiki/Not_invented_here" data-href="https://en.wikipedia.org/wiki/Not_invented_here">&quot;Not Invented Here&quot;</a> est une position adopt√©e par les cultures sociales, d&#39;entreprise ou institutionnelles qui √©vitent d&#39;utiliser ou d&#39;acheter des produits, des recherches, des normes ou des connaissances d√©j√† existants en raison de leurs origines externes et de leurs co√ªts, tels que les redevances.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-989">
<h4 id="s√©curit√©_maturit√©">S√©curit√© par maturit√©</h4>
<div class="paragraph data-line-991">
<p>Au-del√† du choix de la norme, il y a le choix parall√®le de <em>la mise en oeuvre</em>. Lorsque vous d√©cidez d&#39;utiliser une norme telle que ERC20, vous devez ensuite d√©cider comment mettre en ≈ìuvre une conception compatible. Il existe un certain nombre d&#39;impl√©mentations &quot;de r√©f√©rence&quot; existantes qui sont largement utilis√©es dans l&#39;√©cosyst√®me Ethereum, ou vous pouvez √©crire la v√¥tre √† partir de z√©ro. Encore une fois, ce choix repr√©sente un dilemme qui peut avoir de graves implications en mati√®re de s√©curit√©.</p>
</div>
<div class="paragraph data-line-993">
<p>Les impl√©mentations existantes sont &quot;test√©es au combat&quot;. Bien qu&#39;il soit impossible de prouver qu&#39;ils sont s√©curis√©s, beaucoup d&#39;entre eux sous-tendent des millions de dollars de jetons. Ils ont √©t√© attaqu√©s, √† plusieurs reprises et vigoureusement. Jusqu&#39;√† pr√©sent, aucune vuln√©rabilit√© significative n&#39;a √©t√© d√©couverte. R√©diger le v√¥tre n&#39;est pas facile - il existe de nombreuses fa√ßons subtiles de compromettre un contrat. Il est beaucoup plus s√ªr d&#39;utiliser une impl√©mentation largement test√©e et largement utilis√©e. Dans nos exemples, nous avons utilis√© l&#39;impl√©mentation OpenZeppelin de la norme ERC20, car cette impl√©mentation est enti√®rement ax√©e sur la s√©curit√©.</p>
</div>
<div class="paragraph data-line-995">
<p>Si vous utilisez une impl√©mentation existante, vous pouvez √©galement l&#39;√©tendre. Encore une fois, cependant, soyez prudent avec cette impulsion. La complexit√© est l&#39;ennemie de la s√©curit√©. Chaque ligne de code que vous ajoutez √©tend la <em>surface d&#39;attaque</em> de votre contrat et pourrait repr√©senter une vuln√©rabilit√© en attente. Vous ne remarquerez peut-√™tre pas un probl√®me jusqu&#39;√† ce que vous accordiez beaucoup de valeur au contrat et que quelqu&#39;un le rompe.</p>
</div>
<div class="admonitionblock tip data-line-998">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-999">
<p>Les normes et les choix de mise en ≈ìuvre sont des √©l√©ments importants de la conception globale des contrats intelligents s√©curis√©s, mais ce ne sont pas les seules consid√©rations. Voir <a href="#smart_contract_security">S√©curit√© des contrats intelligents</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-1004">
<h3 id="extend_token_interface">Extensions aux normes d&#39;interface de jeton</h3>
<div class="paragraph data-line-1006">
<p>Les normes de jetons abord√©es dans ce chapitre fournissent une interface tr√®s minimale, avec des fonctionnalit√©s limit√©es. De nombreux projets ont cr√©√© des impl√©mentations √©tendues pour prendre en charge les fonctionnalit√©s dont ils ont besoin pour leurs applications. Certaines de ces fonctionnalit√©s incluent¬†:</p>
</div>
<div class="dlist data-line-1008">
<dl>
<dt class="hdlist1">Contr√¥le du propri√©taire</dt>
<dd>
<p>La possibilit√© de donner des adresses sp√©cifiques ou des ensembles d&#39;adresses (c&#39;est-√†-dire des sch√©mas multisignatures), des capacit√©s sp√©ciales, telles que la liste noire, la liste blanche, la frappe, la r√©cup√©ration, etc.</p>
</dd>
<dt class="hdlist1">Br√ªlure</dt>
<dd>
<p>La capacit√© de d√©truire d√©lib√©r√©ment (&quot;br√ªler&quot;) des jetons en les transf√©rant √† une adresse inutilisable ou en effa√ßant un solde et en r√©duisant l&#39;approvisionnement.</p>
</dd>
<dt class="hdlist1">Frappe</dt>
<dd>
<p>La possibilit√© d&#39;ajouter √† l&#39;offre totale de jetons, √† un rythme pr√©visible ou par &quot;fiat&quot; du cr√©ateur du jeton.</p>
</dd>
<dt class="hdlist1">Financement participatif</dt>
<dd>
<p>La possibilit√© de proposer des jetons √† la vente, par exemple par le biais d&#39;une vente aux ench√®res, d&#39;une vente sur le march√©, d&#39;une vente aux ench√®res invers√©e, etc.</p>
</dd>
<dt class="hdlist1">Limites</dt>
<dd>
<p>La possibilit√© de fixer des limites pr√©d√©finies et immuables sur l&#39;offre totale (√† l&#39;oppos√© de la fonction &quot;frappe&quot;).</p>
</dd>
<dt class="hdlist1">Portes d√©rob√©es de r√©cup√©ration</dt>
<dd>
<p>Fonctions pour r√©cup√©rer des fonds, annuler des transferts ou d√©manteler le jeton qui peuvent √™tre activ√©s par une adresse d√©sign√©e ou un ensemble d&#39;adresses.</p>
</dd>
<dt class="hdlist1">Liste blanche</dt>
<dd>
<p>La possibilit√© de restreindre les actions (telles que les transferts de jetons) √† des adresses sp√©cifiques. Le plus souvent utilis√© pour offrir des jetons √† des &quot;investisseurs accr√©dit√©s&quot; apr√®s v√©rification par les r√®gles de diff√©rentes juridictions. Il existe g√©n√©ralement un m√©canisme de mise √† jour de la liste blanche.</p>
</dd>
<dt class="hdlist1">Liste noire</dt>
<dd>
<p>La possibilit√© de restreindre les transferts de jetons en interdisant des adresses sp√©cifiques. Il existe g√©n√©ralement une fonction de mise √† jour de la liste noire.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1024">
<p>Il existe des impl√©mentations de r√©f√©rence pour bon nombre de ces fonctions, par exemple dans la biblioth√®que OpenZeppelin. Certains d&#39;entre eux sont sp√©cifiques √† un cas d&#39;utilisation et ne sont impl√©ment√©s que dans quelques jetons. Il n&#39;existe pas, √† l&#39;heure actuelle, de normes largement accept√©es pour les interfaces avec ces fonctions.</p>
</div>
<div class="paragraph data-line-1026">
<p>Comme indiqu√© pr√©c√©demment, la d√©cision d&#39;√©tendre une norme de jeton avec des fonctionnalit√©s suppl√©mentaires repr√©sente un compromis entre innovation/risque et interop√©rabilit√©/s√©curit√©.</p>
</div>
</div>
<div class="sect2 data-line-1029">
<h3 id="tokens_ico">Jetons et ICO</h3>
<div class="paragraph data-line-1031">
<p>Les jetons ont connu un d√©veloppement explosif dans l&#39;√©cosyst√®me Ethereum. Il est probable qu&#39;ils deviendront un √©l√©ment tr√®s important de toutes les plateformes de contrats intelligents comme Ethereum.</p>
</div>
<div class="paragraph data-line-1033">
<p>N√©anmoins, l&#39;importance et l&#39;impact futur de ces normes ne doivent pas √™tre confondus avec une approbation des offres de jetons actuelles. Comme dans toute technologie √† un stade pr√©coce, la premi√®re vague de produits et d&#39;entreprises √©chouera presque toutes, et certaines √©choueront de mani√®re spectaculaire. La plupart des jetons propos√©s dans Ethereum aujourd&#39;hui sont des escroqueries √† peine d√©guis√©es, des syst√®mes pyramidaux et des prises d&#39;argent.</p>
</div>
<div class="paragraph data-line-1035">
<p>L&#39;astuce consiste √† s√©parer la vision et l&#39;impact √† long terme de cette technologie, qui risque d&#39;√™tre √©norme, de la bulle √† court terme des ICO symboliques, qui sont en proie √† la fraude. Les normes de jetons et la plate-forme survivront √† la manie actuelle des jetons, puis ils changeront probablement le monde.</p>
</div>
</div>
<div class="sect2 data-line-1037">
<h3 id="_conclusion_7">Conclusion</h3>
<div class="paragraph data-line-23">
<p>Les jetons sont un concept tr√®s puissant dans Ethereum et peuvent constituer la base de nombreuses applications d√©centralis√©es importantes. Dans ce chapitre, nous avons examin√© les diff√©rents types de jetons et les normes de jeton, et vous avez construit votre premier jeton et l&#39;application associ√©e. Nous reviendrons √† nouveau sur les jetons dans <a href="#decentralized_applications_chap">Applications d√©centralis√©es (DApps)</a>, o√π vous utiliserez un jeton non fongible comme base pour un DApp d&#39;ench√®res.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="oracles_chap">Oracles</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>In this chapter we discuss <em>oracles</em>, which are systems that can provide external data sources to Ethereum smart contracts. The term "oracle" comes from Greek mythology, where it referred to a person in communication with the gods who could see visions of the future. In the context of blockchains, an oracle is a system that can answer questions that are external to Ethereum. Ideally oracles are systems that are <em>trustless</em>, meaning that they do not need to be trusted because they operate on decentralized principles.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="why_oracles">Why Oracles Are Needed</h3>
<div class="paragraph data-line-9">
<p>A key component of the Ethereum platform is the Ethereum Virtual Machine, with its ability to execute programs and update the state of Ethereum, constrained by consensus rules, on any node in the decentralized network. In order to maintain consensus, EVM execution must be totally deterministic and based only on the shared context of the Ethereum state and signed transactions. This has two particularly important consequences: the first is that there can be no intrinsic source of randomness for the EVM and smart contracts to work with; the second is that extrinsic data can only be introduced as the data payload of a transaction.</p>
</div>
<div class="paragraph data-line-11">
<p>Let&#8217;s unpack those two consequences further. To understand the prohibition of a true random function in the EVM to provide randomness for smart contracts, consider the effect on attempts to achieve consensus after the execution of such a function: node A would execute the command and store 3 on behalf of the smart contract in its storage, while node B, executing the same smart contract, would store 7 instead. Thus, nodes A and B would come to different conclusions about what the resulting state should be, despite having run exactly the same code in the same context. Indeed, it could be that a different resulting state would be achieved every time that the smart contract is evaluated. As such, there would be no way for the network, with its multitude of nodes running independently around the world, to ever come to a decentralized consensus on what the resulting state should be. In practice, it would get much worse than this example very quickly, because knock-on effects, including ether transfers, would build up exponentially.</p>
</div>
<div class="paragraph data-line-13">
<p>Note that pseudorandom functions, such as cryptographically secure hash functions (which are deterministic and therefore can be, and indeed are, part of the EVM), are not enough for many applications. Take a gambling game that simulates coin flips to resolve bet payouts, which needs to randomize heads or tails&#x2014;a miner can gain an advantage by playing the game and only including their transactions in blocks for which they will win. So how do we get around this problem? Well, all nodes can agree on the contents of signed transactions, so extrinsic information, including sources of randomness, price information, weather forecasts, etc., can be introduced as the data part of transactions sent to the network. However, such data simply cannot be trusted, because it comes from unverifiable sources. As such, we have just deferred the problem. We use oracles to attempt to solve these problems, which we will discuss in detail, in the rest of this chapter.</p>
</div>
</div>
<div class="sect2 data-line-16">
<h3 id="oracle_use_cases">Oracle Use Cases and Examples</h3>
<div class="paragraph data-line-18">
<p>Oracles, ideally, provide a trustless (or at least near-trustless) way of getting extrinsic (i.e., "real-world" or off-chain) information, such as the results of football games, the price of gold, or truly random numbers, onto the Ethereum platform for smart contracts to use. They can also be used to relay data securely to DApp frontends directly. Oracles can therefore be thought of as a mechanism for bridging the gap between the off-chain world and smart contracts. Allowing smart contracts to enforce contractual relationships based on real-world events and data broadens their scope dramatically. However, this can also introduce external risks to Ethereum&#8217;s security model. Consider a "smart will" contract that distributes assets when a person dies. This is something frequently discussed in the smart contract space, and highlights the risks of a trusted oracle. If the inheritance amount controlled by such a contract is high enough, the incentive to hack the oracle and trigger distribution of assets <em>before</em> the owner dies is very high.</p>
</div>
<div class="paragraph data-line-20">
<p>Note that some oracles provide data that is particular to a specific private data source, such as academic certificates or government IDs. The source of such data, such as a university or government department, is fully trusted, and the truth of the data is subjective (truth is only determined by appeal to the authority of the source). Such data cannot therefore be provided trustlessly‚Äîi.e., without  trusting a source‚Äîas there is no independently verifiably objective truth. As such, we include these data sources in our definition of what counts as "oracles" because they also provide a data bridge for smart contracts. The data they provide generally takes the form of attestations, such as passports or records of achievement. Attestations will become a big part of the success of blockchain platforms in the future, particularly in relation to the related issues of verifying identity or reputation, so it is important to explore how they can be served by blockchain platforms.</p>
</div>
<div class="paragraph data-line-22">
<p>Some more examples of data that might be provided by oracles include:</p>
</div>
<div class="ulist data-line-24">
<ul>
<li class="data-line-24">
<p>Random numbers/entropy from physical sources such as quantum/thermal processes: e.g., to fairly select a winner in a lottery smart contract</p>
</li>
<li class="data-line-25">
<p>Parametric triggers indexed to natural hazards: e.g., triggering of catastrophe bond smart contracts, such as Richter scale measurements for an earthquake bond</p>
</li>
<li class="data-line-26">
<p>Exchange rate data: e.g., for accurate pegging of cryptocurrencies to fiat currency</p>
</li>
<li class="data-line-27">
<p>Capital markets data: e.g., pricing baskets of tokenized assets/securities</p>
</li>
<li class="data-line-28">
<p>Benchmark reference data: e.g., incorporating interest rates into smart financial derivatives</p>
</li>
<li class="data-line-29">
<p>Static/pseudostatic data: security identifiers, country codes, currency codes, etc.</p>
</li>
<li class="data-line-30">
<p>Time and interval data: for event triggers grounded in precise time measurements</p>
</li>
<li class="data-line-31">
<p>Weather data: e.g., insurance premium calculations based on weather forecasts</p>
</li>
<li class="data-line-32">
<p>Political events: for prediction market resolution</p>
</li>
<li class="data-line-33">
<p>Sporting events: for prediction market resolution and fantasy sports contracts</p>
</li>
<li class="data-line-34">
<p>Geolocation data: e.g., as used in supply chain tracking</p>
</li>
<li class="data-line-35">
<p>Damage verification: for insurance contracts</p>
</li>
<li class="data-line-36">
<p>Events occurring on other blockchains: interoperability functions</p>
</li>
<li class="data-line-37">
<p>Ether market price: e.g., for fiat gas price oracles</p>
</li>
<li class="data-line-38">
<p>Flight statistics: e.g., as used by groups and clubs for flight ticket pooling</p>
</li>
</ul>
</div>
<div class="paragraph data-line-41">
<p>In the following sections, we will examine some of the ways oracles can be implemented, including basic oracle patterns, computation oracles, decentralized oracles, and oracle client implementations in Solidity.</p>
</div>
</div>
<div class="sect2 data-line-44">
<h3 id="oracle_design_patterns">Oracle Design Patterns</h3>
<div class="paragraph data-line-46">
<p>All oracles provide a few key functions, by definition. These include the ability to:</p>
</div>
<div class="ulist data-line-48">
<ul>
<li class="data-line-48">
<p>Collect data from an off-chain source.</p>
</li>
<li class="data-line-49">
<p>Transfer the data on-chain with a signed message.</p>
</li>
<li class="data-line-50">
<p>Make the data available by putting it in a smart contract&#8217;s storage.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-52">
<p>Once the data is available in a smart contract&#8217;s storage, it can be accessed by other smart contracts via message calls that invoke a "retrieve" function of the oracle&#8217;s smart contract; it can also be accessed by Ethereum nodes or network-enabled clients directly by "looking into&#x201d; the oracle&#8217;s storage.</p>
</div>
<div class="paragraph data-line-54">
<p>The three main ways to set up an oracle can be categorized as <em>request‚Äìresponse</em>, <span class="keep-together"><em>publish-subscribe</em></span>, and <em>immediate-read</em>.</p>
</div>
<div class="paragraph data-line-56">
<p>Starting with the simplest, <em>immediate-read</em> oracles are those that provide data that is only needed for an immediate decision, like "What is the address for <em>ethereumbook.info</em>?" or "Is this person over 18?" Those wishing to query this kind of data tend to do so on a "just-in-time" basis; the lookup is done when the information is needed and possibly never again. Examples of such oracles include those that hold data about or issued by organizations, such as academic certificates, dial codes, institutional memberships, airport identifiers, self-sovereign IDs, etc. This type of oracle stores data once in its contract storage, whence any other smart contract can look it up using a request call to the oracle contract. It may be updated. The data in the oracle&#8217;s storage is also available for direct lookup by blockchain-enabled (i.e., Ethereum <span class="keep-together">client‚Äìconnected</span>) applications without having to go through the palaver and incurring the gas costs of issuing a transaction. A shop wanting to check the age of a customer wishing to purchase alcohol could use an oracle in this way. This type of oracle is attractive to an organization or company that might otherwise have to run and maintain servers to answer such data requests. Note that the data stored by the oracle is likely not to be the raw data that the oracle is serving, e.g., for efficiency or privacy reasons. A university might set up an oracle for the certificates of academic achievement of past students. However, storing the full details of the certificates (which could run to pages of courses taken and grades achieved) would be excessive. Instead, a hash of the certificate is sufficient. Likewise, a government might wish to put citizen IDs onto the Ethereum platform, where clearly the details included need to be kept private. Again, hashing the data (more carefully, in Merkle trees with salts) and only storing the root hash in the smart contract&#8217;s storage would be an efficient way to organize such a service.</p>
</div>
<div class="paragraph data-line-58">
<p>The next setup is <em>publish‚Äìsubscribe</em>, where an oracle that effectively provides a broadcast service for data that is expected to change (perhaps both regularly and frequently) is either polled by a smart contract on-chain, or watched by an off-chain daemon for updates. This category has a pattern similar to RSS feeds, WebSub, and the like, where the oracle is updated with new information and a flag signals that new data is available to those who consider themselves "subscribed." Interested parties must either poll the oracle to check whether the latest information has changed, or listen for updates to oracle contracts and act when they occur. Examples include price feeds, weather information, economic or social statistics, traffic data, etc. Polling is very inefficient in the world of web servers, but not so in the peer-to-peer context of blockchain platforms: Ethereum clients have to keep up with all state changes, including changes to contract storage, so polling for data changes is a local call to a synced client. Ethereum event logs make it particularly easy for applications to look out for oracle updates, and so this pattern can in some ways even be considered a "push" service. However, if the polling is done from a smart contract, which might be necessary for some decentralized applications (e.g., where activation incentives are not possible), then significant gas expenditure may be incurred.</p>
</div>
<div class="paragraph data-line-60">
<p>The <em>request‚Äìresponse</em> category is the most complicated: this is where the data space is too huge to be stored in a smart contract and users are expected to only need a small part of the overall dataset at a time. It is also an applicable model for data provider businesses. In practical terms, such an oracle might be implemented as a system of on-chain smart contracts and off-chain infrastructure used to monitor requests and retrieve and return data. A request for data from a decentralized application would typically be an asynchronous process involving a number of steps. In this pattern, firstly, an EOA transacts with a decentralized application, resulting in an interaction with a function defined in the oracle smart contract. This function initiates the request to the oracle, with the associated arguments detailing the data requested in addition to supplementary information that might include callback functions and scheduling parameters. Once this transaction has been validated, the oracle request can be observed as an EVM event emitted by the oracle contract, or as a state change; the arguments can be retrieved and used to perform the actual query of the off-chain data source. The oracle may also require payment for processing the request, gas payment for the callback, and permissions to access the requested data. Finally, the resulting data is signed by the oracle owner, attesting to the validity of the data at a given time, and delivered in a transaction to the decentralized application that made the request‚Äîeither directly or via the oracle contract. Depending on the scheduling parameters, the oracle may broadcast further transactions updating the data at regular intervals (e.g., end-of-day pricing information).</p>
</div>
<div class="paragraph data-line-62">
<p>The steps for a request‚Äìresponse oracle may be summarized as follows:</p>
</div>
<div class="olist arabic data-line-64">
<ol class="arabic">
<li class="data-line-64">
<p>Receive a query from a DApp.</p>
</li>
<li class="data-line-65">
<p>Parse the query.</p>
</li>
<li class="data-line-66">
<p>Check that payment and data access permissions are provided.</p>
</li>
<li class="data-line-67">
<p>Retrieve relevant data from an off-chain source (and encrypt it if necessary).</p>
</li>
<li class="data-line-68">
<p>Sign the transaction(s) with the data included.</p>
</li>
<li class="data-line-69">
<p>Broadcast the transaction(s) to the network.</p>
</li>
<li class="data-line-70">
<p>Schedule any further necessary transactions, such as notifications, etc.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-72">
<p>A range of other schemes are also possible; for example, data can be requested from and returned directly by an EOA, removing the need for an oracle smart contract. Similarly, the request and response could be made to and from an Internet of Things‚Äìenabled hardware sensor. Therefore, oracles can be human, software, or hardware.</p>
</div>
<div class="paragraph data-line-74">
<p>The request‚Äìresponse pattern described here is commonly seen in client‚Äìserver architectures. While this is a useful messaging pattern that allows applications to have a two-way conversation, it is perhaps inappropriate under certain conditions. For example, a smart bond requiring an interest rate from an oracle might have to request the data on a daily basis under a request‚Äìresponse pattern in order to ensure the rate is always correct. Given that interest rates change infrequently, a publish‚Äìsubscribe pattern may be more appropriate here‚Äîespecially when taking into consideration Ethereum&#8217;s limited bandwidth.</p>
</div>
<div class="paragraph data-line-76">
<p>Publish‚Äìsubscribe is a pattern where publishers (in this context, oracles) do not send messages directly to receivers, but instead categorize published messages into distinct classes. Subscribers are able to express an interest in one or more classes and retrieve only those messages that are of interest. Under such a pattern, an oracle might write the interest rate to its own internal storage each time it changes. Multiple subscribed DApps can simply read it from the oracle contract, thereby reducing the impact on network bandwidth while minimizing storage costs.</p>
</div>
<div class="paragraph data-line-78">
<p>In a broadcast or multicast pattern, an oracle would post all messages to a channel and subscribing contracts would listen to the channel under a variety of subscription modes. For example, an oracle might publish messages to a cryptocurrency exchange rate channel. A subscribing smart contract could request the full content of the channel if it required the time series for, e.g., a moving average calculation; another might require only the latest rate for a spot price calculation. A broadcast pattern is appropriate where the oracle does not need to know the identity of the subscribing <span class="keep-together">contract</span>.</p>
</div>
</div>
<div class="sect2 data-line-81">
<h3 id="data_authentication_sec">Data Authentication</h3>
<div class="paragraph data-line-83">
<p>If we assume that the source of data being queried by a DApp is both authoritative and trustworthy (a not insignificant assumption), an outstanding question remains: given that the oracle and the request‚Äìresponse mechanism may be operated by distinct entities, how are we able trust this mechanism? There is a distinct possibility that data may be tampered with in transit, so it is critical that off-chain methods are able to attest to the returned data&#8217;s integrity. Two common approaches to data authentication are <em>authenticity proofs</em> and <em>trusted execution environments</em> (TEEs).</p>
</div>
<div class="paragraph data-line-85">
<p>Authenticity proofs are cryptographic guarantees that data has not been tampered with. Based on a variety of attestation techniques (e.g., digitally signed proofs), they effectively shift the trust from the data carrier to the attestor (i.e., the provider of the attestation). By verifying the authenticity proof on-chain, smart contracts are able to verify the integrity of the data before operating upon it. <a href="http://www.oraclize.it/" data-href="http://www.oraclize.it/">Oraclize</a> is an example of an oracle service leveraging a variety of authenticity proofs. One such proof that is currently available for data queries from the Ethereum main network is the TLSNotary proof. TLSNotary proofs allow a client to provide evidence to a third party that HTTPS web traffic occurred between the client and a server. While HTTPS is itself secure, it doesn‚Äôt support data signing. As a result, TLSNotary proofs rely on TLSNotary (via PageSigner) signatures. TLSNotary proofs leverage the Transport Layer Security (TLS) protocol, enabling the TLS master key, which signs the data after it has been accessed, to be split between three parties: the server (the oracle), an auditee (Oraclize), and an auditor. Oraclize uses an Amazon Web Services (AWS) virtual machine instance as the auditor, which can be verified as having been unmodified since instantiation. This AWS instance stores the TLSNotary secret, allowing it to provide honesty proofs. Although it offers higher assurances against data tampering than a pure request‚Äìresponse mechanism, this approach does require the assumption that Amazon itself will not tamper with the VM instance.</p>
</div>
<div class="paragraph data-line-87">
<p><a href="http://www.town-crier.org/" data-href="http://www.town-crier.org/">Town Crier</a> is an authenticated data feed oracle system based on the TEE approach; such methods utilize hardware-based secure enclaves to ensure data integrity. Town Crier uses Intel&#8217;s  Software Guard eXtensions (SGX) to ensure that responses from HTTPS queries can be verified as authentic. SGX provides guarantees of integrity, ensuring that applications running within an enclave are protected by the CPU against tampering by any other process. It also provides confidentiality, ensuring that an application&#8217;s state is opaque to other processes when running within the enclave. And finally, SGX allows attestation, by generating a digitally signed proof that an application‚Äîsecurely identified by a hash of its build‚Äîis actually running within an enclave. By verifying this digital signature, it is possible for a decentralized application to prove that a Town Crier instance is running securely within an SGX enclave. This, in turn, proves that the instance has not been tampered with and that the data emitted by Town Crier is therefore authentic. The confidentiality property additionally enables Town Crier to handle private data by allowing data queries to be encrypted using the Town Crier instance&#8217;s public key. Operating an oracle&#8217;s query/response mechanism within an enclave such as SGX effectively allows us to think of it as running securely on trusted third-party hardware, ensuring that the requested data is returned untampered with (assuming that we trust Intel/SGX).</p>
</div>
</div>
<div class="sect2 data-line-90">
<h3 id="computation_oracles_sec">Computation Oracles</h3>
<div class="paragraph data-line-92">
<p>So far, we have only discussed oracles in the context of requesting and delivering data. However, oracles can also be used to perform arbitrary computation, a function that can be especially useful given Ethereum‚Äôs inherent block gas limit and comparatively expensive computation costs. Rather than just relaying the results of a query, computation oracles can be used to perform computation on a set of inputs and return a calculated result that may have been infeasible to calculate on-chain. For example, one might use a computation oracle to perform a computationally intensive regression calculation in order to estimate the yield of a bond contract.</p>
</div>
<div class="paragraph data-line-94">
<p>If you are willing to trust a centralized but auditable service, you can go again to Oraclize. They provide a service that allows decentralized applications to request the output of a computation performed in a sandboxed AWS virtual machine. The AWS instance creates an executable container from a user-configured Dockerfile packed in an archive that is uploaded to the Inter-Planetary File System (IPFS; see <a href="#data_storage_sec">Data Storage</a>). On request, Oraclize retrieves this archive using its hash and then initializes and executes the Docker container on AWS, passing any arguments that are provided to the application as environment variables. The containerized application performs the calculation, subject to a time constraint, and writes the result to standard output, where it can be retrieved by Oraclize and returned to the decentralized application. Oraclize currently offers this service on an auditable t2.micro AWS instance, so if the computation is of some nontrivial value, it is possible to check that the correct Docker container was executed. Nonetheless, this is not a truly decentralized solution.</p>
</div>
<div class="paragraph data-line-96">
<p>The concept of a 'cryptlet' as a standard for verifiable oracle truths has been formalized as part of Microsoft&#8217;s wider ESC Framework.  Cryptlets execute within an encrypted capsule that abstracts away the infrastructure, such as I/O, and has the CryptoDelegate attached so incoming and outgoing messages are signed, validated, and proven automatically.  Cryptlets support distributed transactions so that contract logic can take on complex multistep, multiblockchain, and external system transactions in an ACID manner.  This allows developers to create portable, isolated, and private resolutions of the truth for use in smart contracts. Cryptlets follow the format shown here:</p>
</div>
<div class="listingblock data-line-99">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">public class SampleContractCryptlet : Cryptlet
  {
        public SampleContractCryptlet(Guid id, Guid bindingId, string name,
            string address, IContainerServices hostContainer, bool contract)
            : base(id, bindingId, name, address, hostContainer, contract)
        {
            MessageApi = new CryptletMessageApi(GetType().FullName,
                new SampleContractConstructor())</code></pre>
</div>
</div>
<div class="paragraph data-line-110">
<p>For a more decentralized solution, we can turn to <a href="https://truebit.io/" data-href="https://truebit.io/">TrueBit</a>, which offers a solution for scalable and verifiable off-chain computation. They use a system of solvers and verifiers who are incentivized to perform computations and verification of those computations, respectively. Should a solution be challenged, an iterative verification process on subsets of the computation is performed on-chain‚Äîa kind of 'verification game'. The game proceeds through a series of rounds, each recursively checking a smaller and smaller subset of the computation. The game eventually reaches a final round, where the challenge is sufficiently trivial such that the judges‚ÄîEthereum miners‚Äîcan make a final ruling on whether the challenge was met, on-chain. In effect, TrueBit is an implementation of a computation market, allowing decentralized applications to pay for verifiable computation to be performed outside of the network, but relying on Ethereum to enforce the rules of the verification game. In theory, this enables trustless smart contracts to securely perform any computation task.</p>
</div>
<div class="paragraph data-line-112">
<p>A broad range of applications exist for systems like TrueBit, ranging from machine learning to verification of proof of work. An example of the latter is the Doge‚ÄìEthereum bridge, which uses TrueBit to verify Dogecoin‚Äôs proof of work (Scrypt), which is a memory-hard and computationally intensive function that cannot be computed within the Ethereum block gas limit. By performing this verification on TrueBit, it has been possible to securely verify Dogecoin transactions within a smart contract on Ethereum&#8217;s Rinkeby testnet.</p>
</div>
</div>
<div class="sect2 data-line-115">
<h3 id="decentralized_orackes_sec">Decentralized Oracles</h3>
<div class="paragraph data-line-117">
<p>While centralized data or computation oracles suffice for many applications, they represent single points of failure in the Ethereum network. A number of schemes have been proposed around the idea of decentralized oracles as a means of ensuring data availability and the creation of a network of individual data providers with an on-chain data aggregation system.</p>
</div>
<div class="paragraph data-line-119">
<p><a href="https://www.smartcontract.com/link" data-href="https://www.smartcontract.com/link">ChainLink</a> has proposed a decentralized oracle network consisting of three key smart contracts&#x2014;a reputation contract, an order-matching contract, and an aggregation contract&#x2014;and an off-chain registry of data providers. The reputation contract is used to keep track of data providers' performance. Scores in the reputation contract are used to populate the off-chain registry. The order-matching contract selects bids from oracles using the reputation contract. It then finalizes a service-level agreement, which includes query parameters and the number of oracles required. This means that the purchaser needn‚Äôt transact with the individual oracles directly. The aggregation contract collects responses (submitted using a commit‚Äìreveal scheme) from multiple oracles, calculates the final collective result of the query, and finally feeds the results back into the reputation contract.</p>
</div>
<div class="paragraph data-line-121">
<p>One of the main challenges with such a decentralized approach is the formulation of the aggregation function. ChainLink proposes calculating a weighted response, allowing a validity score to be reported for each oracle response. Detecting an 'invalid' score here is nontrivial, since it relies on the premise that outlying data points, measured by deviations from responses provided by peers, are incorrect. Calculating a validity score based on the location of an oracle response among a distribution of responses risks penalizing correct answers over average ones. Therefore, ChainLink offers a standard set of aggregation contracts, but also allows customized aggregation contracts to be specified.</p>
</div>
<div class="paragraph data-line-123">
<p>A related idea is the SchellingCoin protocol. Here, multiple participants report values and the median is taken as the &#x201c;correct&#x201d; answer. Reporters are required to provide a deposit that is redistributed in favor of values that are closer to the median, therefore incentivizing the reporting of values that are similar to others. A common value, also known as the Schelling point, which respondents might consider as the natural and obvious target around which to coordinate is expected to be close to the actual value.</p>
</div>
<div class="paragraph data-line-125">
<p>Jason Teutsch of TrueBit recently proposed a new design for a decentralized off-chain data availability oracle. This design leverages a dedicated proof-of-work blockchain that is able to correctly report on whether or not registered data is available during a given epoch. Miners attempt to download, store, and propagate all currently registered data, thereby guaranteeing data is available locally. While such a system is expensive in the sense that every mining node stores and propagates all registered data, the system allows storage to be reused by releasing data after the registration period ends.</p>
</div>
</div>
<div class="sect2 data-line-128">
<h3 id="oracle_client_interfaces_in_solidity_sec">Oracle Client Interfaces in Solidity</h3>
<div class="paragraph data-line-130">
<p><a href="#using_oraclize_to_update_the_eth_usd">Using Oraclize to update the ETH/USD exchange rate from an external source</a> is a Solidity example demonstrating how Oraclize can be used to continuously poll for the ETH/USD price from an API and store the result in a usable manner.</p>
</div>
<div id="using_oraclize_to_update_the_eth_usd" class="exampleblock data-line-134">
<div class="title">Example 22. Using Oraclize to update the ETH/USD exchange rate from an external source</div>
<div class="content">
<div class="listingblock data-line-136">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">/*
   ETH/USD price ticker leveraging CryptoCompare API

   This contract keeps in storage an updated ETH/USD price,
   which is updated every 10 minutes.
 */

pragma solidity ^0.4.1;
import "github.com/oraclize/ethereum-api/oraclizeAPI.sol";

/*
   "oraclize_" prepended methods indicate inheritance from "usingOraclize"
 */
contract EthUsdPriceTicker is usingOraclize {

    uint public ethUsd;

    event newOraclizeQuery(string description);
    event newCallbackResult(string result);

    function EthUsdPriceTicker() payable {
        // signals TLSN proof generation and storage on IPFS
        oraclize_setProof(proofType_TLSNotary | proofStorage_IPFS);

        // requests query
        queryTicker();
    }

    function __callback(bytes32 _queryId, string _result, bytes _proof) public {
        if (msg.sender != oraclize_cbAddress()) throw;
        newCallbackResult(_result);

        /*
         * Parse the result string into an unsigned integer for on-chain use.
         * Uses inherited "parseInt" helper from "usingOraclize", allowing for
         * a string result such as "123.45" to be converted to uint 12345.
         */
        ethUsd = parseInt(_result, 2);

        // called from callback since we're polling the price
        queryTicker();
    }

    function queryTicker() external payable {
        if (oraclize_getPrice("URL") &gt; this.balance) {
            newOraclizeQuery("Oraclize query was NOT sent, please add some ETH
                to cover for the query fee");
        } else {
            newOraclizeQuery("Oraclize query was sent, standing by for the
                answer...");

            // query params are (delay in seconds, datasource type,
            // datasource argument)
            // specifies JSONPath, to fetch specific portion of JSON API result
            oraclize_query(60 * 10, "URL",
                "json(https://min-api.cryptocompare.com/data/price?\
                fsym=ETH&amp;tsyms=USD,EUR,GBP).USD");
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-200">
<p>To integrate with Oraclize, the contract EthUsdPriceTicker must be a child of <span class="keep-together"><code>usingOraclize</code></span>; the usingOraclize contract is defined in the <em>oraclizeAPI</em> file. The data request is made using the oraclize_query function, which is inherited from the usingOraclize contract. This is an overloaded function that expects at least two arguments:</p>
</div>
<div class="ulist data-line-202">
<ul>
<li class="data-line-202">
<p>The supported data source to use, such as URL, WolframAlpha, IPFS, or computation</p>
</li>
<li class="data-line-203">
<p>The argument for the given data source, which may include the use of JSON or XML parsing helpers</p>
</li>
</ul>
</div>
<div class="paragraph data-line-205">
<p>The price query is performed in the queryTicker function. In order to perform the query, Oraclize requires the payment of a small fee in ether, covering the gas cost for processing the result and transmitting it to the __callback function and an accompanying surcharge for the service. This amount is dependent on the data source and, where specified, the type of authenticity proof that is required. Once the data has been retrieved, the __callback function is called by an Oraclize-controlled account permissioned to do the callback; it passes in the response value and a unique queryId argument, which, for example, can be used to handle and track multiple pending callbacks from Oraclize.</p>
</div>
<div class="paragraph data-line-207">
<p>Financial data provider Thomson Reuters also provides an oracle service for Ethereum, called BlockOne IQ, allowing market and reference data to be requested by smart contracts running on private or permissioned networks. <a href="#contract_calling_the_blockone_iq_service_for_market_data">Contract calling the BlockOne IQ service for market data</a> shows the interface for the oracle, and a client contract that will make the request.</p>
</div>
<div id="contract_calling_the_blockone_iq_service_for_market_data" class="exampleblock data-line-211">
<div class="title">Example 23. Contract calling the BlockOne IQ service for market data</div>
<div class="content">
<div class="listingblock data-line-213">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.11;

contract Oracle {
    uint256 public divisor;
    function initRequest(
       uint256 queryType, function(uint256) external onSuccess,
       function(uint256
    ) external onFailure) public returns (uint256 id);
    function addArgumentToRequestUint(uint256 id, bytes32 name, uint256 arg) public;
    function addArgumentToRequestString(uint256 id, bytes32 name, bytes32 arg)
        public;
    function executeRequest(uint256 id) public;
    function getResponseUint(uint256 id, bytes32 name) public constant
        returns(uint256);
    function getResponseString(uint256 id, bytes32 name) public constant
        returns(bytes32);
    function getResponseError(uint256 id) public constant returns(bytes32);
    function deleteResponse(uint256 id) public constant;
}

contract OracleB1IQClient {

    Oracle private oracle;
    event LogError(bytes32 description);

    function OracleB1IQClient(address addr) external payable {
        oracle = Oracle(addr);
        getIntraday("IBM", now);
    }

    function getIntraday(bytes32 ric, uint256 timestamp) public {
        uint256 id = oracle.initRequest(0, this.handleSuccess, this.handleFailure);
        oracle.addArgumentToRequestString(id, "symbol", ric);
        oracle.addArgumentToRequestUint(id, "timestamp", timestamp);
        oracle.executeRequest(id);
    }

    function handleSuccess(uint256 id) public {
        assert(msg.sender == address(oracle));
        bytes32 ric = oracle.getResponseString(id, "symbol");
        uint256 open = oracle.getResponseUint(id, "open");
        uint256 high = oracle.getResponseUint(id, "high");
        uint256 low = oracle.getResponseUint(id, "low");
        uint256 close = oracle.getResponseUint(id, "close");
        uint256 bid = oracle.getResponseUint(id, "bid");
        uint256 ask = oracle.getResponseUint(id, "ask");
        uint256 timestamp = oracle.getResponseUint(id, "timestamp");
        oracle.deleteResponse(id);
        // Do something with the price data
    }

    function handleFailure(uint256 id) public {
        assert(msg.sender == address(oracle));
        bytes32 error = oracle.getResponseError(id);
        oracle.deleteResponse(id);
        emit LogError(error);
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-276">
<p>The data request is initiated using the initRequest function, which allows the query type (in this example, a request for an intraday price) to be specified, in addition to two callback functions.
This returns a uint256 identifier that can then be used to provide additional arguments. The addArgumentToRequestString function is used to specify the Reuters Instrument Code (RIC), here for IBM stock, and <span class="keep-together"><code>addArgumentToRequestUint</code></span> allows the timestamp to be specified. Now, passing in an alias for block.timestamp will retrieve the current price for IBM. The request is then executed by the executeRequest function. Once the request has been processed, the oracle contract will call the onSuccess callback function with the query identifier, allowing the resulting data to be retrieved; in the event of retrieval failure, the <span class="keep-together"><code>onFailure</code></span> callback will return an error code instead. The available fields that can be retrieved on success include open, high, low, close (OHLC), and bid/ask prices.</p>
</div>
</div>
<div class="sect2 data-line-280">
<h3 id="_conclusions">Conclusions</h3>
<div class="paragraph data-line-282">
<p>As you can see, oracles provide a crucial service to smart contracts: they bring external facts to contract execution. With that, of course, oracles also introduce a significant risk&#x2014;if they are trusted sources and can be compromised, they can result in compromised execution of the smart contracts they feed.</p>
</div>
<div class="paragraph data-line-284">
<p>Generally, when considering the use of an oracle be very careful about the <em>trust model</em>. If you assume the oracle can be trusted, you may be undermining the security of your smart contract by exposing it to potentially false inputs. That said, oracles can be very useful if the security assumptions are carefully considered.</p>
</div>
<div class="paragraph data-line-25">
<p>Decentralized oracles can resolve some of these concerns and offer Ethereum smart contracts trustless external data. Choose carefully and you can start exploring the bridge between Ethereum and the "real world" that oracles offer.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="decentralized_applications_chap">Applications d√©centralis√©es (DApps)</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>In this chapter we will explore the world of <em>decentralized applications</em>, or <em>DApps</em>. From the early days of Ethereum, the founders' vision was much broader than "smart contracts": no less than reinventing the web and creating a new world of DApps, aptly called <em>web3</em>. Smart contracts are a way to decentralize the controlling logic and payment functions of applications. Web3 DApps are about decentralizing all other aspects of an application: storage, messaging, naming, etc. (see <a href="#image_web3_suite">Web3: A decentralized web using smart contracts and P2P technologies</a>).</p>
</div>
<div id="image_web3_suite" class="imageblock data-line-8">
<div class="content">
<img src="images/web3suite.png" alt="Web3: A decentralized web using smart contracts and P2P Technologies">
</div>
<div class="title">Figure 41. Web3: A decentralized web using smart contracts and P2P technologies</div>
</div>
<div class="admonitionblock warning data-line-11">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-12">
<p>While "decentralized apps" are an audacious vision of the future, the term "DApp" is often applied to any smart contract with a web frontend. Some of these so-called DApps are highly centralized applications (CApps?). Beware of false DApps!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-15">
<p>In this chapter we will develop and deploy a sample DApp: an auction platform. You can find the source code in the book&#8217;s repository under <a href="http://bit.ly/2DcmjyA" data-href="http://bit.ly/2DcmjyA"><em>code/auction_dapp</em></a>. We will look at each aspect of an auction application and see how we can decentralize the application as much as possible. First, though, let&#8217;s take a closer look at the defining characteristics and advantages of DApps.</p>
</div>
<div class="sect2 data-line-18">
<h3 id="what_is_a_dapp_sec">What Is a DApp?</h3>
<div class="paragraph data-line-20">
<p>A DApp is an application that is mostly or entirely decentralized.</p>
</div>
<div class="paragraph data-line-22">
<p>Consider all the possible aspects of an application that may be decentralized:</p>
</div>
<div class="ulist data-line-24">
<ul>
<li class="data-line-24">
<p>Backend software (application logic)</p>
</li>
<li class="data-line-25">
<p>Frontend software</p>
</li>
<li class="data-line-26">
<p>Data storage</p>
</li>
<li class="data-line-27">
<p>Message communications</p>
</li>
<li class="data-line-28">
<p>Name resolution</p>
</li>
</ul>
</div>
<div class="paragraph data-line-30">
<p>Each of these can be somewhat centralized or somewhat decentralized. For example, a frontend can be developed as a web app that runs on a centralized server, or as a mobile app that runs on your device. The backend and storage can be on private servers and proprietary databases, or you can use a smart contract and P2P storage.</p>
</div>
<div class="paragraph data-line-32">
<p>There are many advantages to creating a DApp that a typical centralized architecture cannot provide:</p>
</div>
<div class="dlist data-line-34">
<dl>
<dt class="hdlist1">Resiliency</dt>
<dd>
<p>Because the business logic is controlled by a smart contract, a DApp backend will be fully distributed and managed on a blockchain platform. Unlike an application deployed on a centralized server, a DApp will have no downtime and will continue to be available as long as the platform is still operating.</p>
</dd>
<dt class="hdlist1">Transparency</dt>
<dd>
<p>The on-chain nature of a DApp allows everyone to inspect the code and be more sure about its function. Any interaction with the DApp will be stored forever in the blockchain.</p>
</dd>
<dt class="hdlist1">Censorship resistance</dt>
<dd>
<p>As long as a user has access to an Ethereum node (running one if necessary), the user will always be able to interact with a DApp without interference from any centralized control. No service provider, or even the owner of the smart contract, can alter the code once it is deployed on the network.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-43">
<p>In the Ethereum ecosystem as it stands today, there are very few truly decentralized apps&#x2014;most still rely on centralized services and servers for some part of their operation. In the future, we expect that it will be possible for every part of any DApp to be operated in a fully decentralized way.</p>
</div>
<div class="sect3 data-line-46">
<h4 id="blockchain_smart_contracts_sec">Backend (Smart Contract)</h4>
<div class="paragraph data-line-48">
<p>In a DApp, smart contracts are used to store the business logic (program code) and the related state of your application. You can think of a smart contract replacing a server-side (aka "backend") component in a regular application. This is an oversimplification, of course. One of the main differences is that any computation executed in a smart contract is very expensive and so should be kept as minimal as possible. It is therefore important to identify which aspects of the application need a trusted and decentralized execution platform.</p>
</div>
<div class="paragraph data-line-50">
<p>Ethereum smart contracts allow you to build architectures in which a network of smart contracts call and pass data between each other, reading and writing their own state variables as they go, with their complexity restricted only by the block gas limit. After you deploy your smart contract, your business logic could well be used by many other developers in the future.</p>
</div>
<div class="paragraph data-line-52">
<p>One major consideration of smart contract architecture design is the inability to change the code of a smart contract once it is deployed. It can be deleted if it is programmed with an accessible SELFDESTRUCT opcode, but other than complete removal, the code cannot be changed in any way.</p>
</div>
<div class="paragraph data-line-54">
<p>The second major consideration of smart contract architecture design is DApp size. A really large monolithic smart contract may cost a lot of gas to deploy and use. Therefore, some applications may choose to have off-chain computation and an external data source. Keep in mind, however, that having the core business logic of the DApp be dependent on external data (e.g., from a centralized server) means your users will have to trust these external resources.</p>
</div>
</div>
<div class="sect3 data-line-57">
<h4 id="front_end_web_ui_cec">Frontend (Web User Interface)</h4>
<div class="paragraph data-line-59">
<p>Unlike the business logic of the DApp, which requires a developer to understand the EVM and new languages such as Solidity, the client-side interface of a DApp can use standard web technologies (HTML, CSS, JavaScript, etc.). This allows a traditional web developer to use familiar tools, libraries, and frameworks. Interactions with Ethereum, such as signing messages, sending transactions, and managing keys, are often conducted through the web browser, via an extension such as MetaMask (see <a href="#intro_chapter">Les bases d&#39;Ethereum</a>).</p>
</div>
<div class="paragraph data-line-61">
<p>Although it is possible to create a mobile DApp as well, currently there are few resources to help create mobile DApp frontends, mainly due to the lack of mobile clients that can serve as a light client with key-management functionality.</p>
</div>
<div class="paragraph data-line-63">
<p>The frontend is usually linked to Ethereum via the <em>web3.js</em> JavaScript library, which is bundled with the frontend resources and served to a browser by a web server.</p>
</div>
</div>
<div class="sect3 data-line-66">
<h4 id="data_storage_sec">Data Storage</h4>
<div class="paragraph data-line-68">
<p>Due to high gas costs and the currently low block gas limit, smart contracts are not well suited to storing or processing large amounts of data. Hence, most DApps utilize off-chain data storage services, meaning they store the bulky data off the Ethereum chain, on a data storage platform. That data storage platform can be centralized (for example, a typical cloud database), or the data can be decentralized, stored on a P2P platform such as the IPFS, or Ethereum&#8217;s own Swarm platform.</p>
</div>
<div class="paragraph data-line-70">
<p>Decentralized P2P storage is ideal for storing and distributing large static assets such as images, videos, and the resources of the application&#8217;s frontend web interface (HTML, CSS, JavaScript, etc.). We&#8217;ll look at a few of the options next.</p>
</div>
<div class="sect4 data-line-73">
<h5 id="ipfs_sec">IPFS</h5>
<div class="paragraph data-line-75">
<p>The <em>Inter-Planetary File System</em> (IPFS) is a decentralized content-addressable storage system that distributes stored objects among peers in a P2P network. "Content addressable" means that each piece of content (file) is hashed and the hash is used to identify that file. You can then retrieve any file from any IPFS node by requesting it by its hash.</p>
</div>
<div class="paragraph data-line-77">
<p>IPFS aims to replace HTTP as the protocol of choice for delivery of web applications. Instead of storing a web application on a single server, the files are stored on IPFS and can be retrieved from any IPFS node.</p>
</div>
<div class="paragraph data-line-79">
<p>More information about IPFS can be found at <a href="https://ipfs.io" class="undefined" data-href="https://ipfs.io">https://ipfs.io</a>.</p>
</div>
</div>
<div class="sect4 data-line-83">
<h5 id="swarm_sec">Swarm</h5>
<div class="paragraph data-line-85">
<p>Swarm is another content-addressable P2P storage system, similar to IPFS. Swarm was created by the Ethereum Foundation, as part of the Go-Ethereum suite of tools. Like IPFS, it allows you to store files that get disseminated and replicated by Swarm nodes. You can access any Swarm file by referring to it by a hash. Swarm allows you to access a website from a decentralized P2P system, instead of a central web server.</p>
</div>
<div class="paragraph data-line-87">
<p>The home page for Swarm is itself stored on Swarm and accessible on your Swarm node or a gateway:
<a href="https://swarm-gateways.net/bzz:/theswarm.eth/" class="undefined" data-href="https://swarm-gateways.net/bzz:/theswarm.eth/">https://swarm-gateways.net/bzz:/theswarm.eth/</a>.</p>
</div>
</div>
</div>
<div class="sect3 data-line-92">
<h4 id="interdapp_coammunications_protocol_sec">Decentralized Message Communications Protocols</h4>
<div class="paragraph data-line-94">
<p>Another major component of any application is inter-process communication. That means being able to exchange messages between applications, between different instances of the application, or between users of the application. Traditionally, this is achieved by reliance on a centralized server. However, there are a variety of decentralized alternatives to server-based protocols, offering messaging over a P2P network. The most notable P2P messaging protocol for DApps is <a href="http://bit.ly/2CSls5h" data-href="http://bit.ly/2CSls5h"><em>Whisper</em></a>, which is part of the Ethereum Foundation&#8217;s Go-Ethereum suite of tools.</p>
</div>
<div class="paragraph data-line-96">
<p>The final aspect of an application that can be decentralized is name resolution. We&#8217;ll take a close look at Ethereum&#8217;s name service later in this chapter; now, though, let&#8217;s dig into an example.</p>
</div>
</div>
</div>
<div class="sect2 data-line-99">
<h3 id="auction_dapp_intro">A Basic DApp Example: Auction DApp</h3>
<div class="paragraph data-line-101">
<p>In this section we will start building an example DApp, to explore the various decentralization tools. Our DApp will implement a decentralized auction.</p>
</div>
<div class="paragraph data-line-103">
<p>The Auction DApp allows a user to register a "deed" token, which represents some unique asset, such as a house, a car, a trademark, etc. Once a token has been registered, the ownership of the token is transferred to the Auction DApp, allowing it to be listed for sale. The Auction DApp lists each of the registered tokens, allowing other users to place bids. During each auction, users can join a chat room created specifically for that auction. Once an auction is finalized, the deed token ownership is transferred to the winner of the auction.</p>
</div>
<div class="paragraph data-line-105">
<p>The overall auction process can be seen in <a href="#auction_dapp_overview">Auction DApp: A simple example auction DApp</a>.</p>
</div>
<div class="paragraph data-line-107">
<p>The main components of our Auction DApp are:</p>
</div>
<div class="ulist data-line-109">
<ul>
<li class="data-line-109">
<p>A smart contract implementing ERC721 non-fungible "deed" tokens (<code><span class="keep-together">DeedRepository</span></code>)</p>
</li>
<li class="data-line-110">
<p>A smart contract implementing an auction (AuctionRepository) to sell the deeds</p>
</li>
<li class="data-line-111">
<p>A web frontend using the Vue/Vuetify JavaScript framework</p>
</li>
<li class="data-line-112">
<p>The <em>web3.js</em> library to connect to Ethereum chains (via MetaMask or other clients)</p>
</li>
<li class="data-line-113">
<p>A Swarm client, to store resources such as images</p>
</li>
<li class="data-line-114">
<p>A Whisper client, to create per-auction chat rooms for all participants</p>
</li>
</ul>
</div>
<div id="auction_dapp_overview" class="imageblock data-line-118">
<div class="content">
<img src="images/auction_diagram.png" alt="Auction DApp: A simple example auction DApp">
</div>
<div class="title">Figure 42. Auction DApp: A simple example auction DApp</div>
</div>
<div class="paragraph data-line-120">
<p>You can find the source code for the auction DApp <a href="http://bit.ly/2DcmjyA" data-href="http://bit.ly/2DcmjyA">in the book&#8217;s repository</a>.</p>
</div>
<div class="sect3 data-line-123">
<h4 id="_auction_dapp_backend_smart_contracts">Auction DApp: Backend Smart Contracts</h4>
<div class="paragraph data-line-125">
<p>Our Auction DApp example is supported by two smart contracts that we need to deploy on an Ethereum blockchain in order to support the application: <code><span class="keep-together">AuctionRepository</span></code> and DeedRepository.</p>
</div>
<div class="paragraph data-line-127">
<p>Let&#8217;s start by looking at DeedRepository, shown in <a href="#deed_repository_code">DeedRepository.sol: An ERC721 deed token for use in an auction</a>. This contract is an ERC721-compatible non-fungible token (see <a href="#erc721">ERC721¬†: norme de jeton non fongible (acte)</a>).</p>
</div>
<div id="deed_repository_code" class="exampleblock data-line-131">
<div class="title">Example 24. DeedRepository.sol: An ERC721 deed token for use in an auction</div>
<div class="content">
<div class="listingblock data-line-133">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.5.16;
import "./ERC721/ERC721Token.sol";

/**
 * @title Repository of ERC721 Deeds
 * This contract contains the list of deeds registered by users.
 * This is a demo to show how tokens (deeds) can be minted and added 
 * to the repository.
 */
contract DeedRepository is ERC721Token {


    /**
    * @dev Created a DeedRepository with a name and symbol
    * @param _name string represents the name of the repository
    * @param _symbol string represents the symbol of the repository
    */
    constructor(string memory _name, string memory _symbol) 
        public ERC721Token(_name, _symbol) {}
    
    /**
    * @dev Public function to register a new deed
    * @dev Call the ERC721Token minter
    * @param _tokenId uint256 represents a specific deed
    * @param _uri string containing metadata/uri
    */
    function registerDeed(uint256 _tokenId, string memory _uri) public {
        _mint(msg.sender, _tokenId);
        addDeedMetadata(_tokenId, _uri);
        emit DeedRegistered(msg.sender, _tokenId);
    }

    /**
    * @dev Public function to add metadata to a deed
    * @param _tokenId represents a specific deed
    * @param _uri text which describes the characteristics of a given deed
    * @return whether the deed metadata was added to the repository
    */
    function addDeedMetadata(uint256 _tokenId, string memory _uri) public returns(bool){
        _setTokenURI(_tokenId, _uri);
        return true;
    }

    /**
    * @dev Event is triggered if deed/token is registered
    * @param _by address of the registrar
    * @param _tokenId uint256 represents a specific deed
    */
    event DeedRegistered(address _by, uint256 _tokenId);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-138">
<p>As you can see, the DeedRepository contract is a straightforward implementation of an ERC721-compatible token.</p>
</div>
<div class="paragraph data-line-140">
<p>Our Auction DApp uses the DeedRepository contract to issue and track tokens for each auction. The auction itself is orchestrated by the AuctionRepository contract. This contract is too long to include here in full, but <a href="#auction_repository_code">AuctionRepository.sol: The main Auction DApp smart contract</a> shows the main definition of the contract and data structures. The entire contract is available in the book&#8217;s <a href="https://bit.ly/2IaOo9i" data-href="https://bit.ly/2IaOo9i">GitHub repository</a>.</p>
</div>
<div id="auction_repository_code" class="exampleblock data-line-144">
<div class="title">Example 25. AuctionRepository.sol: The main Auction DApp smart contract</div>
<div class="content">
<div class="listingblock data-line-146">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">contract AuctionRepository {

    // Array with all auctions
    Auction[] public auctions;

    // Mapping from auction index to user bids
    mapping(uint256 =&gt; Bid[]) public auctionBids;

    // Mapping from owner to a list of owned auctions
    mapping(address =&gt; uint[]) public auctionOwner;

    // Bid struct to hold bidder and amount
    struct Bid {
        address from;
        uint256 amount;
    }

    // Auction struct which holds all the required info
    struct Auction {
        string name;
        uint256 blockDeadline;
        uint256 startPrice;
        string metadata;
        uint256 deedId;
        address deedRepositoryAddress;
        address owner;
        bool active;
        bool finalized;
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-179">
<p>The AuctionRepository contract manages all auctions with the following functions:</p>
</div>
<div class="listingblock data-line-182">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">getCount()
getBidsCount(uint _auctionId)
getAuctionsOf(address _owner)
getCurrentBid(uint _auctionId)
getAuctionsCountOfOwner(address _owner)
getAuctionById(uint _auctionId)
createAuction(address _deedRepositoryAddress, uint256 _deedId,
              string _auctionTitle, string _metadata, uint256 _startPrice,
              uint _blockDeadline)
approveAndTransfer(address _from, address _to, address _deedRepositoryAddress,
                   uint256 _deedId)
cancelAuction(uint _auctionId)
finalizeAuction(uint _auctionId)
bidOnAuction(uint _auctionId)</code></pre>
</div>
</div>
<div class="paragraph data-line-199">
<p>You can deploy these contracts to the Ethereum blockchain of your choice (e.g., Ropsten) using truffle in the book&#8217;s repository:</p>
</div>
<pre data-type="programlisting">
$ <strong>cd code/auction_dapp/backend</strong>
$ <strong>truffle init</strong>
$ <strong>truffle compile</strong>
$ <strong>truffle migrate --network ropsten</strong>
</pre>
<div class="sect4 data-line-210">
<h5 id="_dapp_governance">DApp governance</h5>
<div class="paragraph data-line-212">
<p>If you read through the two smart contracts of the Auction DApp you will notice something important: there is no special account or role that has special privileges over the DApp. Each auction has an owner with some special capabilities, but the Auction DApp itself has no privileged user.</p>
</div>
<div class="paragraph data-line-214">
<p>This is a deliberate choice to decentralize the governance of the DApp and relinquish any control once it has been deployed. Some DApps, by comparison, have one or more privileged accounts with special capabilities, such as the ability to terminate the DApp contract, to override or change its configuration, or to "veto" certain operations. Usually, these governance functions are introduced in the DApp in order to avoid unknown problems that might arise due to a bug.</p>
</div>
<div class="paragraph data-line-216">
<p>The issue of governance is a particularly difficult one to solve, as it represents a double-edged sword. On the one side, privileged accounts are dangerous; if compromised, they can subvert the security of the DApp. On the other side, without any privileged account, there are no recovery options if a bug is found. We have seen both of these risks manifest in Ethereum DApps. In the case of The DAO (<a href="#real_world_example_the_dao">Exemple concret¬†: le DAO</a> and <a href="#ethereum_fork_history">Historique de la fourche Ethereum</a>), there were some privileged accounts called the "curators," but they were very limited in their capabilities. Those accounts were not able to override the DAO attacker&#8217;s withdrawal of the funds. In a more recent case, the decentralized exchange Bancor experienced a massive theft because a privileged management account was compromised. Turns out, Bancor was not as decentralized as initially assumed.</p>
</div>
<div class="paragraph data-line-218">
<p>When building a DApp, you have to decide if you want to make the smart contracts truly independent, launching them and then having no control, or create privileged accounts and run the risk of those being compromised. Either choice carries risk, but in the long run, true DApps cannot have specialized access for privileged accounts&#x2014;that&#8217;s not decentralized.</p>
</div>
</div>
</div>
<div class="sect3 data-line-220">
<h4 id="_auction_dapp_frontend_user_interface">Auction DApp: Frontend User Interface</h4>
<div class="paragraph data-line-222">
<p>Once the Auction DApp&#8217;s contracts are deployed, you can interact with them using your favorite JavaScript console and web3.js, or another web3 library. However, most users will need an easy-to-use interface. Our Auction DApp user interface is built using the Vue2/Vuetify JavaScript framework from Google.</p>
</div>
<div class="paragraph data-line-224">
<p>You can find the user interface code in the <em>code/auction_dapp/frontend</em> folder in <a href="https://github.com/ethereumbook/ethereumbook" data-href="https://github.com/ethereumbook/ethereumbook">the book&#8217;s repository</a>. The directory has the following structure and contents:</p>
</div>
<div class="listingblock data-line-226">
<div class="content">
<pre>frontend/
|-- build
|   |-- build.js
|   |-- check-versions.js
|   |-- logo.png
|   |-- utils.js
|   |-- vue-loader.conf.js
|   |-- webpack.base.conf.js
|   |-- webpack.dev.conf.js
|   `-- webpack.prod.conf.js
|-- config
|   |-- dev.env.js
|   |-- index.js
|   `-- prod.env.js
|-- index.html
|-- package.json
|-- package-lock.json
|-- README.md
|-- src
|   |-- App.vue
|   |-- components
|   |   |-- Auction.vue
|   |   `-- Home.vue
|   |-- config.js
|   |-- contracts
|   |   |-- AuctionRepository.json
|   |   `-- DeedRepository.json
|   |-- main.js
|   |-- models
|   |   |-- AuctionRepository.js
|   |   |-- ChatRoom.js
|   |   `-- DeedRepository.js
|   `-- router
|       `-- index.js</pre>
</div>
</div>
<div class="paragraph data-line-263">
<p>Once you have deployed the contracts, edit the frontend configuration in <em>frontend/src/config.js</em> and enter the addresses of the DeedRepository and AuctionRepository contracts, as deployed. The frontend application also needs access to an Ethereum node offering a JSON-RPC and WebSockets interface. Once you&#8217;ve configured the frontend, launch it with a web server on your local machine:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm install</strong>
$ <strong>npm run dev</strong>
</pre>
<div class="paragraph data-line-272">
<p>The Auction DApp frontend will launch and will be accessible via any web browser at <a href="http://localhost:8080" class="undefined" data-href="http://localhost:8080">http://localhost:8080</a>.</p>
</div>
<div class="paragraph data-line-274">
<p>If all goes well you should see the screen shown in <a href="#auction_dapp_screen">Auction DApp user interface</a>, which illustrates the Auction DApp running in a web browser.</p>
</div>
<div id="auction_dapp_screen" class="imageblock data-line-278">
<div class="content">
<img src="images/auction_dapp_home_screen.png" alt="Auction DApp User interface">
</div>
<div class="title">Figure 43. Auction DApp user interface</div>
</div>
</div>
</div>
<div class="sect2 data-line-280">
<h3 id="_further_decentralizing_the_auction_dapp">Further Decentralizing the Auction DApp</h3>
<div class="paragraph data-line-282">
<p>Our DApp is already quite decentralized, but we can improve things.</p>
</div>
<div class="paragraph data-line-284">
<p>The AuctionRepository contract operates independently of any oversight, open to anyone. Once deployed it cannot be stopped, nor can any auction be controlled. Each auction has a separate chat room that allows anyone to communicate about the auction without censorship or identification. The various auction assets, such as the description and associated image, are stored on Swarm, making them hard to censor or block.</p>
</div>
<div class="paragraph data-line-286">
<p>Anyone can interact with the DApp by constructing transactions manually or by running the Vue frontend on their local machine. The DApp code itself is open source and developed collaboratively on a public repository.</p>
</div>
<div class="paragraph data-line-288">
<p>There are two things we can do to make this DApp decentralized and resilient:</p>
</div>
<div class="ulist data-line-290">
<ul>
<li class="data-line-290">
<p>Store all the application code on Swarm or IPFS.</p>
</li>
<li class="data-line-291">
<p>Access the DApp by reference to a name, using the Ethereum Name Service.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-293">
<p>We&#8217;ll explore the first option in the next section, and we&#8217;ll dig into the second in <a href="#ethereum_naming_system_ens">The Ethereum Name Service (ENS)</a>.</p>
</div>
</div>
<div class="sect2 data-line-295">
<h3 id="_storing_the_auction_dapp_on_swarm">Storing the Auction DApp on Swarm</h3>
<div class="paragraph data-line-297">
<p>We introduced Swarm in <a href="#swarm_sec">Swarm</a>, earlier in this chapter. Our Auction DApp already uses Swarm to store the icon image for each auction. This is a much more efficient solution than attempting to store data on Ethereum, which is expensive. It is also a lot more resilient than if these images were stored in a centralized service like a web server or file server.</p>
</div>
<div class="paragraph data-line-299">
<p>But we can take things one step further. We can store the entire frontend of the DApp itself in Swarm and run it from a Swarm node directly, instead of running a web server.</p>
</div>
<div class="sect3 data-line-301">
<h4 id="_preparing_swarm">Preparing Swarm</h4>
<div class="paragraph data-line-303">
<p>To get started, you need to install Swarm and initialize your Swarm node. Swarm is part of the Ethereum Foundation&#8217;s Go-Ethereum suite of tools. Refer to the instructions for installing Go-Ethereum in <a href="#go_ethereum_geth">Go-Ethereum (Geth)</a>, or to install a Swarm binary release, follow the instructions in the <a href="http://bit.ly/2Q75KXw" data-href="http://bit.ly/2Q75KXw">Swarm documentation</a>.</p>
</div>
<div class="paragraph data-line-305">
<p>Once you have installed Swarm, you can check that it is working correctly by running it with the version command:</p>
</div>
<pre data-type="programlisting">
$ <strong>swarm version</strong>
Version: 0.3
Git Commit: 37685930d953bcbe023f9bc65b135a8d8b8f1488
Go Version: go1.10.1
OS: linux
</pre>
<div class="paragraph data-line-317">
<p>To start running Swarm, you must tell it how to connect to an instance of Geth, to access the JSON-RPC API. Get it started by following the instructions in the <a href="https://swarm-guide.readthedocs.io/en/latest/gettingstarted.html" data-href="https://swarm-guide.readthedocs.io/en/latest/gettingstarted.html">Getting Started guide</a>.</p>
</div>
<div class="paragraph data-line-319">
<p>When you start Swarm, you should see something like this:</p>
</div>
<div class="listingblock data-line-321">
<div class="content">
<pre>Maximum peer count                       ETH=25 LES=0 total=25
Starting peer-to-peer node               instance=swarm/v0.3.1-225171a4/linux...
connecting to ENS API                    url=http://127.0.0.1:8545
swarm[5955]: [189B blob data]
Starting P2P networking
UDP listener up                          self=enode://f50c8e19ff841bcd5ce7d2d...
Updated bzz local addr                   oaddr=9c40be8b83e648d50f40ad3... uaddr=e
Starting Swarm service
9c40be8b hive starting
detected an existing store. trying to load peers
hive 9c40be8b: peers loaded
Swarm network started on bzz address: 9c40be8b83e648d50f40ad3d35f...
Pss started
Streamer started
IPC endpoint opened                      url=/home/ubuntu/.ethereum/bzzd.ipc
RLPx listener up                         self=enode://f50c8e19ff841bcd5ce7d2d...</pre>
</div>
</div>
<div class="paragraph data-line-340">
<p>You can confirm that your Swarm node is running correctly by connecting to the local Swarm gateway web interface:
<a href="http://localhost:8500" class="undefined" data-href="http://localhost:8500">http://localhost:8500</a>.</p>
</div>
<div class="paragraph data-line-343">
<p>You should see a screen like the one in <a href="#image_swarm_gateway">Swarm gateway on localhost</a> and be able to query any Swarm hash or ENS name.</p>
</div>
<div id="image_swarm_gateway" class="imageblock data-line-347">
<div class="content">
<img src="images/swarm-gateway.png" alt="Swarm gateway on localhost">
</div>
<div class="title">Figure 44. Swarm gateway on localhost</div>
</div>
</div>
<div class="sect3 data-line-349">
<h4 id="_uploading_files_to_swarm">Uploading Files to Swarm</h4>
<div class="paragraph data-line-351">
<p>Once you have your local Swarm node and gateway running, you can upload to Swarm and the files will be accessible on any Swarm node, simply by reference to the file hash.</p>
</div>
<div class="paragraph data-line-353">
<p>Let&#8217;s test this by uploading a file:</p>
</div>
<pre data-type="programlisting">
$ <strong>swarm up code/auction_dapp/README.md</strong>
ec13042c83ffc2fb5cb0aa8c53f770d36c9b3b35d0468a0c0a77c97016bb8d7c
</pre>
<div class="paragraph data-line-362">
<p>Swarm has uploaded the <em>README.md</em> file and returned a hash that you can use to access the file from any Swarm node. For example, you could use the <a href="https://bit.ly/2znWUP9" data-href="https://bit.ly/2znWUP9">public Swarm gateway</a>.</p>
</div>
<div class="paragraph data-line-364">
<p>While uploading one file is relatively straightforward, it is a bit more complex to upload an entire DApp frontend. That&#8217;s because the various DApp resources (HTML, CSS, JavaScript, libraries, etc.) have embedded references to each other. Normally, a web server translates URLs to local files and serves the correct resources. We can achieve the same for Swarm by packaging our DApp.</p>
</div>
<div class="paragraph data-line-366">
<p>In the Auction DApp, there&#8217;s a script for packaging all the resources:</p>
</div>
<pre data-type="programlisting">
$ <strong>cd code/auction_dapp/frontend</strong>
$ <strong>npm run build</strong>

> <strong>frontend@1.0.0 build /home/aantonop/Dev/ethereumbook/code/auction_dapp/frontend</strong>
> <strong>node build/build.js</strong>

Hash: 9ee134d8db3c44dd574d
Version: webpack 3.10.0
Time: 25665ms
Asset     Size
static/js/vendor.77913f316aaf102cec11.js  1.25 MB
static/js/app.5396ead17892922422d4.js   502 kB
static/js/manifest.87447dd4f5e60a5f9652.js  1.54 kB
static/css/app.0e50d6a1d2b1ed4daa03d306ced779cc.css  1.13 kB
static/css/app.0e50d6a1d2b1ed4daa03d306ced779cc.css.map  2.54 kB
static/js/vendor.77913f316aaf102cec11.js.map  4.74 MB
static/js/app.5396ead17892922422d4.js.map   893 kB
static/js/manifest.87447dd4f5e60a5f9652.js.map  7.86 kB
index.html  1.15 kB

Build complete.
</pre>
<div class="paragraph data-line-394">
<p>The result of this command will be a new directory, <em>code/auction_dapp/frontend/dist</em>, that contains the entire Auction DApp frontend, packed together:</p>
</div>
<div class="listingblock data-line-396">
<div class="content">
<pre>dist/
|-- index.html
`-- static
    |-- css
    |   |-- app.0e50d6a1d2b1ed4daa03d306ced779cc.css
    |   `-- app.0e50d6a1d2b1ed4daa03d306ced779cc.css.map
    `-- js
        |-- app.5396ead17892922422d4.js
        |-- app.5396ead17892922422d4.js.map
        |-- manifest.87447dd4f5e60a5f9652.js
        |-- manifest.87447dd4f5e60a5f9652.js.map
        |-- vendor.77913f316aaf102cec11.js
        `-- vendor.77913f316aaf102cec11.js.map</pre>
</div>
</div>
<div class="paragraph data-line-413">
<p>Now you can upload the entire DApp to Swarm, by using the up command and the --recursive option. Here, we also tell Swarm that index.html is the defaultpath for loading this DApp:</p>
</div>
<pre data-type="programlisting">
$ <strong>swarm --bzzapi http://localhost:8500 --recursive \
  --defaultpath dist/index.html up dist/</strong>

ab164cf37dc10647e43a233486cdeffa8334b026e32a480dd9cbd020c12d4581
</pre>
<div class="paragraph data-line-424">
<p>Now, our entire Auction DApp is hosted on Swarm and accessible by the Swarm URL:</p>
</div>
<ul class="simplelist">
<li><em>bzz://ab164cf37dc10647e43a233486cdeffa8334b026e32a480dd9cbd020c12d4581</em></li>
</ul>
<div class="paragraph data-line-432">
<p>We&#8217;ve made some progress in decentralizing our DApp, but we&#8217;ve made it harder to use. A URL like that is much less user-friendly than a nice name like <em>auction_dapp.com</em>. Are we forced to sacrifice usability in order to gain decentralization? Not necessarily. In the next section we will examine Ethereum&#8217;s name service, which allows us to use easy-to-read names but still preserves the decentralized nature of our application.</p>
</div>
</div>
</div>
<div class="sect2 data-line-435">
<h3 id="ethereum_naming_system_ens">The Ethereum Name Service (ENS)</h3>
<div class="paragraph data-line-437">
<p>You can design the best smart contract in the world, but if you don&#8217;t provide a good interface for users, they won&#8217;t be able to access it.</p>
</div>
<div class="paragraph data-line-439">
<p>On the traditional internet, the Domain Name System (DNS) allows us to use human-readable names in the browser while resolving those names to IP addresses or other identifiers behind the scenes. On the Ethereum blockchain, the <em>Ethereum Naming System</em> (ENS) solves the same problem, but in a decentralized manner.</p>
</div>
<div class="paragraph data-line-441">
<p>For example, the Ethereum Foundation donation address is 0xfB6916095ca1df60bB79Ce92cE3Ea74c37c5d359; in a wallet that supports ENS, it&#8217;s simply ethereum.eth.</p>
</div>
<div class="paragraph data-line-443">
<p>ENS is more than a smart contract; it&#8217;s a fundamental DApp itself, offering a decentralized name service. Furthermore, ENS is supported by a number of DApps for registration, management, and auctions of registered names. ENS demonstrates how DApps can work together: it&#8217;s DApp built to serve other DApps, supported by an ecosystem of DApps, embedded in other DApps, and so on.</p>
</div>
<div class="paragraph data-line-445">
<p>In this section we will look at how ENS works. We&#8217;ll demonstrate how you can set up your own name and link it to a wallet or Ethereum address, how you can embed ENS in another DApp, and how you can use ENS to name your DApp resources to make them easier to use.</p>
</div>
<div class="sect3 data-line-447">
<h4 id="_history_of_ethereum_name_services">History of Ethereum Name Services</h4>
<div class="paragraph data-line-449">
<p>Name registration was the first noncurrency application of blockchains, pioneered by Namecoin. The Ethereum <a href="http://bit.ly/2Of1gfZ" data-href="http://bit.ly/2Of1gfZ">White Paper</a> gave a two-line Namecoin-like registration system as one of its example applications.</p>
</div>
<div class="paragraph data-line-451">
<p>Early releases of Geth and the C++ Ethereum client had a built-in namereg contract (not used any more), and many proposals and ERCs for name services were made, but it was only when Nick Johnson started working for the Ethereum Foundation in 2016 and took the project under his wing that serious work on a registrar started.</p>
</div>
<div class="paragraph data-line-453">
<p>ENS was launched on Star Wars Day, May 4, 2017 (after a failed attempt to launch it on Pi Day, March 15).</p>
</div>
</div>
<div class="sect3 data-line-455">
<h4 id="_the_ens_specification">The ENS Specification</h4>
<div class="paragraph data-line-457">
<p>ENS is specified mainly in three Ethereum Improvement Proposals: EIP-137, which specifies the basic functions of ENS; EIP-162, which describes the auction system for the .eth root; and EIP-181, which specifies reverse resolution of addresses.</p>
</div>
<div class="paragraph data-line-459">
<p>ENS follows a "sandwich" design philosophy: a very simple layer on the bottom, followed by layers of more complex but replaceable code, with a very simple top layer that keeps all the funds in separate accounts.</p>
</div>
</div>
<div class="sect3 data-line-461">
<h4 id="_bottom_layer_name_owners_and_resolvers">Bottom Layer: Name Owners and Resolvers</h4>
<div class="paragraph data-line-463">
<p>The ENS operates on "nodes" instead of human-readable names: a human-readable name is converted to a node using the "Namehash" algorithm.</p>
</div>
<div class="paragraph data-line-465">
<p>The base layer of ENS is a cleverly simple contract (less than 50 lines of code) defined by ERC137 that allows only nodes' owners to set information about their names and to create subnodes (the ENS equivalent of DNS subdomains).</p>
</div>
<div class="paragraph data-line-467">
<p>The only functions on the base layer are those that enable a node owner to set information about their own node (specifically the resolver, time to live, or transferring the ownership) and to create owners of new subnodes.</p>
</div>
<div class="sect4 data-line-469">
<h5 id="_the_namehash_algorithm">The Namehash algorithm</h5>
<div class="paragraph data-line-471">
<p>Namehash is a recursive algorithm that can convert any name into a hash that identifies the name.</p>
</div>
<div class="paragraph data-line-473">
<p>"Recursive" means that we solve the problem by solving a subproblem that is a smaller problem of the same type, and then use the solution to the subproblem to solve the original problem.</p>
</div>
<div class="paragraph data-line-475">
<p>Namehash recursively hashes components of the name, producing a unique, fixed-length string (or &#x201c;node&#x201d;) for any valid input domain. For example, the Namehash node of subdomain.example.eth is <code>keccak('&lt;example.eth&gt;' node) + keccak('&lt;subdomain&gt;')</code>. The subproblem we must solve is to compute the node for example.eth, which is <code>keccak('&lt;.eth&gt;' node) + keccak('&lt;example&gt;')</code>.  To begin, we must compute the node for eth, which is <code>keccak(&lt;root node&gt;) + keccak('&lt;eth&gt;')</code>.</p>
</div>
<div class="paragraph data-line-477">
<p>The root node is what we call the "base case" of our recursion, and we obviously can&#8217;t define it recursively, or the algorithm will never terminate! The root node is defined as <code>0x0000000000000000000000000000000000000000000000000000000000000000</code> (32 zero bytes).</p>
</div>
<div class="paragraph data-line-479">
<p>Putting this all together, the node of subdomain.example.eth is therefore <code><span class="keep-together">keccak</span>(keccak(keccak(0x0...0 + keccak('eth')) + keccak('example')) + keccak('subdomain'))</code>.</p>
</div>
<div class="paragraph data-line-481">
<p>Generalizing, we can define the Namehash function as follows (the base case for the root node, or empty name, followed by the recursive step):</p>
</div>
<div class="literalblock data-line-483">
<div class="content">
<pre>namehash([]) = 0x0000000000000000000000000000000000000000000000000000000000000000
namehash([label, ...]) = keccak256(namehash(...) + keccak256(label))</pre>
</div>
</div>
<div class="paragraph data-line-488">
<p>In Python this becomes:</p>
</div>
<div class="literalblock data-line-490">
<div class="content">
<pre>def namehash(name):
  if name == '':
    return '\0' * 32
  else:
    label, _, remainder = name.partition('.')
    return sha3(namehash(remainder) + sha3(label))</pre>
</div>
</div>
<div class="paragraph data-line-499">
<p>Thus, mastering-ethereum.eth will be processed as follows:</p>
</div>
<div class="literalblock data-line-501">
<div class="content">
<pre>namehash('mastering-ethereum.eth')
‚áí sha3(namehash('eth') + sha3('mastering-ethereum'))
‚áí sha3(sha3(namehash('') + sha3('eth')) + sha3('mastering-ethereum'))
‚áí sha3(sha3(('\0' * 32) + sha3('eth')) + sha3('mastering-ethereum'))</pre>
</div>
</div>
<div class="paragraph data-line-508">
<p>Of course, subdomains can themselves have subdomains: there could be a sub.subdomain.example.eth after subdomain.example.eth, then a sub.sub.subdomain.example.eth, and so on. To avoid expensive recomputation, since Namehash depends only on the name itself, the node for a given name can be precomputed and inserted into a contract, removing the need for string manipulation and permitting immediate lookup of ENS records regardless of the number of components in the raw name.</p>
</div>
</div>
<div class="sect4 data-line-510">
<h5 id="_how_to_choose_a_valid_name">How to choose a valid name</h5>
<div class="paragraph data-line-511">
<p>Names consist of a series of dot-separated labels. Although upper- and lowercase letters are allowed, all labels should follow a UTS &#x23;46 normalization process that case-folds labels before hashing them, so names with different case but identical spelling will end up with the same Namehash.</p>
</div>
<div class="paragraph data-line-513">
<p>You could use labels and domains of any length, but for the sake of compatibility with legacy DNS, the following rules are recommended:</p>
</div>
<div class="ulist data-line-515">
<ul>
<li class="data-line-515">
<p>Labels should be no more than 64 characters each.</p>
</li>
<li class="data-line-516">
<p>Complete ENS names should be no more than 255 characters.</p>
</li>
<li class="data-line-517">
<p>Labels should not start or end with hyphens, or start with digits.</p>
</li>
</ul>
</div>
</div>
<div class="sect4 data-line-519">
<h5 id="_root_node_ownership">Root node ownership</h5>
<div class="paragraph data-line-521">
<p>One of the results of this hierarchical system is that it relies on the owners of the root node, who are able to create top-level domains (TLDs).</p>
</div>
<div class="paragraph data-line-523">
<p>While the eventual goal is to adopt a decentralized decision-making process for new TLDs, at the time of writing the root node is controlled by a 4-of-7 multisig, held by people in different countries (built as a reflection of the 7 keyholders of the DNS system).
As a result, a majority of at least 4 of the 7 keyholders is required to effect any change.</p>
</div>
<div class="paragraph data-line-526">
<p>Currently the purpose and goal of these keyholders is to work in consensus with the community to:</p>
</div>
<div class="ulist data-line-528">
<ul>
<li class="data-line-528">
<p>Migrate and upgrade the temporary ownership of the .eth TLD to a more permanent contract once the system is evaluated.</p>
</li>
<li class="data-line-529">
<p>Allow adding new TLDs, if the community agrees they are needed.</p>
</li>
<li class="data-line-530">
<p>Migrate the ownership of the root multisig to a more decentralized contract, when such a system is agreed upon, tested, and implemented.</p>
</li>
<li class="data-line-531">
<p>Serve as a last-resort way to deal with any bugs or vulnerabilities in the top-level registries.</p>
</li>
</ul>
</div>
</div>
<div class="sect4 data-line-533">
<h5 id="_resolvers">Resolvers</h5>
<div class="paragraph data-line-535">
<p>The basic ENS contract can&#8217;t add metadata to names; that is the job of so-called "resolver contracts." These are user-created contracts that can answer questions about the name, such as what Swarm address is associated with the app, what address receives payments to the app (in ether or tokens), or what the hash of the app is (to verify its integrity).</p>
</div>
</div>
</div>
<div class="sect3 data-line-537">
<h4 id="_middle_layer_the_eth_nodes">Middle Layer: The .eth Nodes</h4>
<div class="paragraph data-line-539">
<p>At the time of writing, the only top-level domain that is uniquely registrable in a smart contract is .eth.</p>
</div>
<div class="admonitionblock note data-line-542">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-543">
<p>There&#8217;s work underway on enabling traditional DNS domain owners to claim ENS ownership.
While in theory this could work for .com, the only domain that this has been implemented for so far is <a href="http://bit.ly/2SwUuFC" data-href="http://bit.ly/2SwUuFC">.xyz, and only on the Ropsten testnet</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-547">
<p>.eth domains are distributed via an auction system. There is no reserved list or priority, and the only way to acquire a name is to use the system. The auction system is a complex piece of code (over 500 lines); most of the early development efforts (and bugs!) in ENS were in this part of the system. However, it&#8217;s also replaceable and upgradeable, without risk to the funds‚Äîmore on that later.</p>
</div>
<div class="sect4 data-line-550">
<h5 id="vickrey_auction">Vickrey auctions</h5>
<div class="paragraph data-line-552">
<p>Names are distributed via a modified Vickrey auction. In a traditional Vickrey auction, every bidder submits a sealed bid, and all of them are revealed simultaneously, at which point the highest bidder wins the auction but only pays the second-highest bid. Therefore bidders are incentivized not to bid less than the true value of the name to them, since bidding their true value increases the chance they will win but does not affect the price they will eventually pay.</p>
</div>
<div class="paragraph data-line-554">
<p>On a blockchain, some changes are required:</p>
</div>
<div class="ulist data-line-556">
<ul>
<li class="data-line-556">
<p>To ensure bidders don&#8217;t submit bids they have no intention of paying, they must lock up a value equal to or higher than their bid beforehand, to guarantee the bid is valid.</p>
</li>
<li class="data-line-557">
<p>Because you can&#8217;t hide secrets on a blockchain, bidders must execute at least two transactions (a commit‚Äìreveal process), in order to hide the original value and name they bid on.</p>
</li>
<li class="data-line-558">
<p>Since you can&#8217;t reveal all bids simultaneously in a decentralized system, bidders must reveal their own bids themselves; if they don&#8217;t, they forfeit their locked-up funds. Without this forfeit, one could make many bids and choose to reveal only one or two, turning a sealed-bid auction into a traditional increasing price <span class="keep-together">auction</span>.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-560">
<p>Therefore, the auction is a four-step process:</p>
</div>
<div class="olist arabic data-line-562">
<ol class="arabic">
<li class="data-line-562">
<p>Start the auction. This is required to broadcast the intent to register a name.
This creates all auction deadlines. The names are hashed, so that only those who have the name in their dictionary will know which auction was opened. This allows some privacy, which is useful if you are creating a new project and don&#8217;t want to share details about it.
You can open multiple dummy auctions at the same time, so if someone is following you they cannot simply bid on all auctions you open.</p>
</li>
<li class="data-line-566">
<p>Make a sealed bid. You must do this before the bidding deadline, by tying a given amount of ether to the hash of a secret message (containing, among other things, the hash of the name, the actual amount of the bid, and a salt).
You can lock up more ether than you are actually bidding in order to mask your true valuation.</p>
</li>
<li class="data-line-569">
<p>Reveal the bid. During the reveal period, you must make a transaction that reveals the bid, which will then calculate the highest bid and the second-highest bid and send ether back to unsuccessful bidders.
Every time the bid is revealed the current winner is recalculated; therefore, the last one to be set before the revealing deadline expires becomes the overall winner.</p>
</li>
<li class="data-line-572">
<p>Clean up after. If you are the winner, you can finalize the auction in order to get back the difference between your bid and the second-highest bid.
If you forgot to reveal you can make a late reveal and recover a little of your bid.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3 data-line-575">
<h4 id="_top_layer_the_deeds">Top Layer: The Deeds</h4>
<div class="paragraph data-line-577">
<p>The top layer of ENS is yet another super-simple contract with a single purpose: to hold the funds.</p>
</div>
<div class="paragraph data-line-579">
<p>When you win a name, the funds are not actually sent anywhere, but are just locked up for the period you want to hold the name (at least a year).
This works like a guaranteed buyback: if the owner does not want the name any more they can sell it back to the system and recover their ether (so the cost of holding the name is the opportunity cost of doing something with a return greater than zero).</p>
</div>
<div class="paragraph data-line-582">
<p>Of course, having a single contract hold millions of dollars in ether has proven to be very risky, so instead ENS creates a deed contract for each new name.
The deed contract is very simple (about 50 lines of code), and it only allows the funds to be transferred back to a single account (the deed owner) and to be called by a single entity (the registrar contract).
This approach drastically reduces the attack surface where bugs can put the funds at risk.</p>
</div>
</div>
<div class="sect3 data-line-586">
<h4 id="_registering_a_name">Registering a Name</h4>
<div class="paragraph data-line-588">
<p>Registering a name in ENS is a four-step process, as we saw in  <a href="#vickrey_auction">Vickrey auctions</a>. First we place a bid for any available name, then we reveal our bid after 48 hours to secure the name. <a href="#ens_registration_timeline">ENS timeline for registration</a> is a diagram showing the timeline of registration.</p>
</div>
<div class="paragraph data-line-590">
<p>Let&#8217;s register our first name!</p>
</div>
<div class="paragraph data-line-592">
<p>We will use one of several available user-friendly interfaces to search for available names, place a bid on the name ethereumbook.eth, reveal the bid, and secure the name.</p>
</div>
<div class="paragraph data-line-594">
<p>There are a number of web-based interfaces to ENS that allow us to interact with the ENS DApp. For this example, we will use the <a href="https://mycrypto.com/" data-href="https://mycrypto.com/">MyCrypto interface</a>, in conjunction with MetaMask as our wallet.</p>
</div>
<div id="ens_registration_timeline" class="imageblock data-line-598">
<div class="content">
<img src="images/ens-flow.png" alt="ens flow">
</div>
<div class="title">Figure 45. ENS timeline for registration</div>
</div>
<div class="paragraph data-line-602">
<p>First, we need to make sure the name we want is available. While writing this book, we really wanted to register the name mastering.eth, but alas, <a href="#ens-name-search">Searching for ENS names on MyCrypto.com</a> revealed it was already taken! Because ENS registrations only last one year, it might become possible to secure that name in the future. In the meantime, let&#8217;s search for ethereumbook.eth (<a href="#ens-name-search">Searching for ENS names on MyCrypto.com</a>).</p>
</div>
<div id="ens-name-search" class="imageblock data-line-606">
<div class="content">
<img src="images/ens-checkname.png" alt="Searching for ENS names on MyCrypto.com">
</div>
<div class="title">Figure 46. Searching for ENS names on MyCrypto.com</div>
</div>
<div class="paragraph data-line-608">
<p>Great! The name is available. In order to register it, we need to move forward with <a href="#ens-auction">Starting an auction for an ENS name</a>. Let&#8217;s unlock MetaMask and start an auction for ethereumbook.eth.</p>
</div>
<div id="ens-auction" class="imageblock data-line-613">
<div class="content">
<img src="images/ens-auction.png" alt="Starting an auction for an ENS name">
</div>
<div class="title">Figure 47. Starting an auction for an ENS name</div>
</div>
<div class="paragraph data-line-616">
<p>Let&#8217;s make our bid. In order to do that we need to follow the steps in <a href="#ens-bid">Placing a bid for an ENS name</a>.</p>
</div>
<div id="ens-bid" class="imageblock data-line-621">
<div class="content">
<img src="images/ens-bid.png" alt="Placing a bid for an ENS name">
</div>
<div class="title">Figure 48. Placing a bid for an ENS name</div>
</div>
<div class="admonitionblock warning data-line-624">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-625">
<p>As mentioned in <a href="#vickrey_auction">Vickrey auctions</a>, you must reveal your bid within 48 hours after the auction is complete, or you <em>lose the funds in your bid</em>. Did we forget to do this and lose 0.01 ETH ourselves? You bet we did.</p>
</div>
<div class="paragraph data-line-627">
<p>Take a screenshot, save your secret phrase (as a backup for your bid), and add a reminder in your calendar for the reveal date and time, so you don&#8217;t forget and lose your funds.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-630">
<p>Finally, we confirm the transaction by clicking the big green submit button shown in <a href="#ens-metamask-bid">MetaMask transaction containing your bid</a>.</p>
</div>
<div id="ens-metamask-bid" class="imageblock data-line-634">
<div class="content">
<img src="images/ens-metamask-bid.png" alt="MetaMask transaction containing your bid">
</div>
<div class="title">Figure 49. MetaMask transaction containing your bid</div>
</div>
<div class="paragraph data-line-636">
<p>If all goes well, after submitting a transaction in this way you can return and reveal the bid in 48 hours, and the name you requested will be registered to your Ethereum address.</p>
</div>
</div>
<div class="sect3 data-line-638">
<h4 id="_managing_your_ens_name">Managing Your ENS Name</h4>
<div class="paragraph data-line-640">
<p>Once you have registered an ENS name, you can manage it using another user-friendly interface: <a href="https://manager.ens.domains/" data-href="https://manager.ens.domains/">ENS Manager</a>.</p>
</div>
<div class="paragraph data-line-643">
<p>Once there, enter the name you want to manage in the search box (see <a href="#ens-manager">The ENS Manager web interface</a>). You need to have your Ethereum wallet  (e.g., MetaMask) unlocked, so that the ENS Manager DApp can manage the name on your behalf.</p>
</div>
<div id="ens-manager" class="imageblock data-line-647">
<div class="content">
<img src="images/ens-manager.png" alt="The ENS Manager web interface">
</div>
<div class="title">Figure 50. The ENS Manager web interface</div>
</div>
<div class="paragraph data-line-649">
<p>From this interface, we can create subdomains, set a resolver contract (more on that later), and connect each name to the appropriate resource, such as the Swarm address of a DApp frontend.</p>
</div>
<div class="sect4 data-line-651">
<h5 id="_creating_an_ens_subdomain">Creating an ENS subdomain</h5>
<div class="paragraph data-line-653">
<p>First, let&#8217;s create a subdomain for our example Auction DApp (see <a href="#ens-manager-add-subdomain">Adding the subdomain auction.ethereumbook.eth</a>). We will name the subdomain auction, so the fully qualified name will be auction.ethereumbook.eth.</p>
</div>
<div id="ens-manager-add-subdomain" class="imageblock data-line-657">
<div class="content">
<img src="images/ens_manager_add_subdomain.png" alt="Adding the subdomain auction.ethereumbook.eth">
</div>
<div class="title">Figure 51. Adding the subdomain auction.ethereumbook.eth</div>
</div>
<div class="paragraph data-line-659">
<p>Once we&#8217;ve created the subdomain, we can enter auction.ethereumbook.eth in the search box and manage it, just as we managed the domain ethereumbook.eth <span class="keep-together">previously</span>.</p>
</div>
</div>
</div>
<div class="sect3 pagebreak-before data-line-662">
<h4 id="_ens_resolvers">ENS Resolvers</h4>
<div class="paragraph data-line-664">
<p>In ENS, resolving a name is a two-step process:</p>
</div>
<div class="olist arabic data-line-666">
<ol class="arabic">
<li class="data-line-666">
<p>The ENS registry is called with the name to resolve after hashing it.
If the record exists, the registry returns the address of its resolver.</p>
</li>
<li class="data-line-669">
<p>The resolver is called, using the method appropriate to the resource being requested. The resolver returns the desired result.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-671">
<p>This two-step process has several benefits. Separating the functionality of resolvers from the naming system itself gives us a lot more flexibility. The owners of names can use custom resolvers to resolve any type or resource, extending the functionality of ENS. For example, if in the future you wanted to link a geolocation resource (longitude/lattitude) to an ENS name, you could create a new resolver that answers a <span class="keep-together"><code>geolocation</code></span> query. Who knows what applications might be useful in the future? With custom resolvers, the only limitation is your imagination.</p>
</div>
<div class="paragraph data-line-673">
<p>For convenience, there is a default public resolver that can resolve a variety of resources, including the address (for wallets or contracts) and content (a Swarm hash for DApps or contract source code).</p>
</div>
<div class="paragraph data-line-675">
<p>Since we want to link our Auction DApp to a Swarm hash, we can use the public resolver, which supports content resolution, as shown in <a href="#ens-manager-set-default-resolver">Setting the default public resolver for auction.ethereumbook.eth</a>; we don&#8217;t need to code or deploy a custom resolver.</p>
</div>
<div id="ens-manager-set-default-resolver" class="imageblock data-line-679">
<div class="content">
<img src="images/ens-manager-set-default-resolver.png" alt="Set the default public resolver for auction.ethereumbook.eth">
</div>
<div class="title">Figure 52. Setting the default public resolver for auction.ethereumbook.eth</div>
</div>
</div>
<div class="sect3 data-line-681">
<h4 id="_resolving_a_name_to_a_swarm_hash_content">Resolving a Name to a Swarm Hash (Content)</h4>
<div class="paragraph data-line-683">
<p>Once the resolver for auction.ethereumbook.eth is set to be the public resolver, we can set it to return the Swarm hash as the content of our name (see <a href="#ens-set-content">Setting the 'content' to return for auction.ethereumbook.eth</a>).</p>
</div>
<div id="ens-set-content" class="imageblock data-line-687">
<div class="content">
<img src="images/ens-manager-set-content.png" alt="Set the 'content' return for auction.ethereumbook.eth">
</div>
<div class="title">Figure 53. Setting the 'content' to return for auction.ethereumbook.eth</div>
</div>
<div class="paragraph data-line-689">
<p>After waiting a short time for our transaction to be confirmed, we should be able to resolve the name correctly. Before setting a name, our Auction DApp could be found on a Swarm gateway by its hash:</p>
</div>
<ul class="simplelist">
<li><em>https://swarm-gateways.net/bzz:/ab164cf37dc10647e43a233486cdeffa8334b026e32a480dd9cbd020c12d4581</em></li>
</ul>
<div class="paragraph data-line-697">
<p>or by searching in a DApp browser or Swarm gateway for the Swarm URL:</p>
</div>
<ul class="simplelist">
<li><em>bzz://ab164cf37dc10647e43a233486cdeffa8334b026e32a480dd9cbd020c12d4581</em></li>
</ul>
<div class="paragraph pagebreak-before data-line-706">
<p>Now that we have attached it to a name, it is much easier:</p>
</div>
<ul class="simplelist">
<li><em>http://swarm-gateways.net/bzz:/auction.ethereumbook.eth/</em></li>
</ul>
<div class="paragraph data-line-714">
<p>We can also find it by searching for "auction.ethereumbook.eth" in any ENS-compatible wallet or DApp browser (e.g., Mist).</p>
</div>
</div>
</div>
<div class="sect2 data-line-716">
<h3 id="_from_app_to_dapp">From App to DApp</h3>
<div class="paragraph data-line-718">
<p>Over the past several sections, we have gradually built a decentralized application. We started with a pair of smart contracts to run an auction for ERC721 deeds. These contracts were designed to have no governing or privileged accounts, so that their operation is truly decentralized. We  added a frontend, implemented in JavaScript, that offers a convenient and user-friendly interface to our DApp. The auction DApp uses the decentralized storage system Swarm to store application resources such as images. The DApp also uses the decentralized communications protocol Whisper to offer an encrypted chat room for each auction, without any central servers.</p>
</div>
<div class="paragraph data-line-720">
<p>We uploaded the entire frontend to Swarm, so that our DApp doesn&#8217;t rely on any web servers to serve the files. Finally, we allocated a name for our DApp using ENS, connecting it to the Swarm hash of the frontend, so that users can access it with a simple and easy-to-remember human-readable name.</p>
</div>
<div class="paragraph data-line-722">
<p>With each of these steps, we increased the decentralization of our application. The final result is a DApp that has no central point of authority, no central point of failure, and expresses the "web3" vision.</p>
</div>
<div class="paragraph data-line-724">
<p><a href="#auction_dapp_final_architecture">Auction DApp architecture</a> shows the complete architecture of the Auction DApp.</p>
</div>
<div id="auction_dapp_final_architecture" class="imageblock data-line-728">
<div class="content">
<img src="images/auction_dapp_final_architecture.png" alt="Auction DApp architecture">
</div>
<div class="title">Figure 54. Auction DApp architecture</div>
</div>
</div>
<div class="sect2 data-line-730">
<h3 id="_conclusions_2">Conclusions</h3>
<div class="paragraph data-line-27">
<p>Decentralized applications are the culmination of the Ethereum vision, as expressed by the founders from the very earliest designs. While a lot of applications call themselves "DApps" today, most are not fully decentralized. However, it is already possible to construct applications that are almost completely decentralized. Over time, as the technology matures further, more and more of our applications can be decentralized, resulting in a more resilient, censorship-resistant, and free web.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="evm_chapter">La machine virtuelle Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>At the heart of the Ethereum protocol and operation is the Ethereum Virtual Machine, or EVM for short. As you might guess from the name, it is a computation engine, not hugely dissimilar to the virtual machines of Microsoft&#8217;s .NET Framework, or interpreters of other bytecode-compiled programming languages such as Java. In this chapter we take a detailed look at the EVM, including its instruction set, structure, and operation, within the context of Ethereum state updates.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="evm_description">What Is the EVM?</h3>
<div class="paragraph data-line-8">
<p>The EVM is the part of Ethereum that handles smart contract deployment and execution. Simple value transfer transactions from one EOA to another don&#8217;t need to involve it, practically speaking, but everything else will involve a state update computed by the EVM. At a high level, the EVM running on the Ethereum blockchain can be thought of as a global decentralized computer containing millions of executable objects, each with its own permanent data store.</p>
</div>
<div class="paragraph data-line-10">
<p>The EVM is a quasi‚ÄìTuring-complete state machine; "quasi" because all execution processes are limited to a finite number of computational steps by the amount of gas available for any given smart contract execution. As such, the halting problem is "solved" (all program executions will halt) and the situation where execution might (accidentally or maliciously) run forever, thus bringing the Ethereum platform to halt in its entirety, is avoided.</p>
</div>
<div class="paragraph data-line-12">
<p>The EVM has a stack-based architecture, storing all in-memory values on a stack. It works with a word size of 256 bits (mainly to facilitate native hashing and elliptic curve operations) and has several addressable data components:</p>
</div>
<div class="ulist pagebreak-before data-line-15">
<ul>
<li class="data-line-15">
<p>An immutable <em>program code ROM</em>, loaded with the bytecode of the smart contract to be executed</p>
</li>
<li class="data-line-16">
<p>A volatile <em>memory</em>, with every location explicitly initialized to zero</p>
</li>
<li class="data-line-17">
<p>A permanent <em>storage</em> that is part of the Ethereum state, also zero-initialized</p>
</li>
</ul>
</div>
<div class="paragraph data-line-19">
<p>There is also a set of environment variables and data that is available during execution. We will go through these in more detail later in this chapter.</p>
</div>
<div class="paragraph data-line-21">
<p><a href="#evm_architecture">The Ethereum Virtual Machine (EVM) Architecture and Execution Context</a> shows the EVM architecture and execution context.</p>
</div>
<div id="evm_architecture" class="imageblock data-line-25">
<div class="content">
<img src="images/evm-architecture.png" alt="The Ethereum Virtual Machine (EVM) Architecture and Execution Context">
</div>
<div class="title">Figure 55. The Ethereum Virtual Machine (EVM) Architecture and Execution Context</div>
</div>
<div class="sect3 data-line-28">
<h4 id="evm_comparison">Comparison with Existing Technology</h4>
<div class="paragraph data-line-30">
<p>The term "virtual machine" is often applied to the virtualization of a real computer, typically by a "hypervisor" such as VirtualBox or QEMU, or of an entire operating system instance, such as Linux&#8217;s KVM. These must provide a software abstraction, respectively, of actual hardware, and of system calls and other kernel functionality.</p>
</div>
<div class="paragraph data-line-32">
<p>The EVM operates in a much more limited domain: it is just a computation engine, and as such provides an abstraction of just computation and storage, similar to the Java Virtual Machine (JVM) specification, for example. From a high-level viewpoint, the JVM is designed to provide a runtime environment that is agnostic of the underlying host OS or hardware, enabling compatibility across a wide variety of systems. High-level programming languages such as Java or Scala (which use the JVM) or C# (which uses .NET) are compiled into the bytecode instruction set of their respective virtual machine. In the same way, the EVM executes its own bytecode instruction set (described in the next section), which higher-level smart contract programming languages such as LLL, Serpent, Mutan, or Solidity are compiled into.</p>
</div>
<div class="paragraph data-line-34">
<p>The EVM, therefore, has no scheduling capability, because execution ordering is organized externally to it&#x2014;Ethereum clients run through verified block transactions to determine which smart contracts need executing and in which order. In this sense, the Ethereum world computer is single-threaded, like JavaScript. Neither does the EVM have any "system interface" handling or &#x201c;hardware support&#x201d;&#x2014;there is no physical machine to interface with. The Ethereum world computer is completely virtual.</p>
</div>
</div>
<div class="sect3 data-line-37">
<h4 id="evm_bytecode_overview">The EVM Instruction Set (Bytecode Operations)</h4>
<div class="paragraph data-line-39">
<p>The EVM instruction set offers most of the operations you might expect, including:</p>
</div>
<div class="ulist data-line-41">
<ul>
<li class="data-line-41">
<p>Arithmetic and bitwise logic operations</p>
</li>
<li class="data-line-42">
<p>Execution context inquiries</p>
</li>
<li class="data-line-43">
<p>Stack, memory, and storage access</p>
</li>
<li class="data-line-44">
<p>Control flow operations</p>
</li>
<li class="data-line-45">
<p>Logging, calling, and other operators</p>
</li>
</ul>
</div>
<div class="paragraph data-line-47">
<p>In addition to the typical bytecode operations, the EVM also has access to account information (e.g., address and balance) and block information (e.g., block number and current gas price).</p>
</div>
<div class="paragraph data-line-49">
<p>Let&#8217;s start our exploration of the EVM in more detail by looking at the available opcodes and what they do. As you might expect, all operands are taken from the stack, and the result (where applicable) is often
put back on the top of the stack.</p>
</div>
<div class="admonitionblock note data-line-53">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-54">
<p>A complete list of opcodes and their corresponding gas cost can be found in <a href="#evm_opcodes">Opcodes Ethereum EVM et consommation de gaz</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-57">
<p>The available opcodes can be divided into the following categories:</p>
</div>
<div id="arithmetic_opcodes" class="dlist data-line-60">
<dl>
<dt class="hdlist1">Arithmetic operations</dt>
<dd>
<p>Arithmetic opcode instructions:</p>
<div class="listingblock data-line-62">
<div class="content">
<pre>ADD        //Add the top two stack items
MUL        //Multiply the top two stack items
SUB        //Subtract the top two stack items
DIV        //Integer division
SDIV       //Signed integer division
MOD        //Modulo (remainder) operation
SMOD       //Signed modulo operation
ADDMOD     //Addition modulo any number
MULMOD     //Multiplication modulo any number
EXP        //Exponential operation
SIGNEXTEND //Extend the length of a two's complement signed integer
SHA3       //Compute the Keccak-256 hash of a block of memory</pre>
</div>
</div>
<div class="paragraph data-line-77">
<p>Note that all arithmetic is performed modulo 2<sup>256</sup> (unless otherwise noted), and that the zeroth power of zero, 0<sup>0</sup>, is taken to be 1.</p>
</div>
</dd>
</dl>
</div>
<div id="stack_opcodes" class="dlist data-line-81">
<dl>
<dt class="hdlist1">Stack operations</dt>
<dd>
<p>Stack, memory, and storage management instructions:</p>
<div class="listingblock data-line-83">
<div class="content">
<pre>POP     //Remove the top item from the stack
MLOAD   //Load a word from memory
MSTORE  //Save a word to memory
MSTORE8 //Save a byte to memory
SLOAD   //Load a word from storage
SSTORE  //Save a word to storage
MSIZE   //Get the size of the active memory in bytes
PUSHx   //Place x byte item on the stack, where x can be any integer from
        // 1 to 32 (full word) inclusive
DUPx    //Duplicate the x-th stack item, where x can be any integer from
        // 1 to 16 inclusive
SWAPx   //Exchange 1st and (x+1)-th stack items, where x can be any
        // integer from 1 to 16 inclusive</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="flow_opcodes" class="dlist data-line-101">
<dl>
<dt class="hdlist1">Process flow operations</dt>
<dd>
<p>Instructions for control flow:</p>
<div class="listingblock data-line-103">
<div class="content">
<pre>STOP      //Halt execution
JUMP      //Set the program counter to any value
JUMPI     //Conditionally alter the program counter
PC        //Get the value of the program counter (prior to the increment
          //corresponding to this instruction)
JUMPDEST  //Mark a valid destination for jumps</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="system_opcodes" class="dlist data-line-113">
<dl>
<dt class="hdlist1">System operations</dt>
<dd>
<p>Opcodes for the system executing the program:</p>
<div class="listingblock data-line-115">
<div class="content">
<pre>LOGx          //Append a log record with x topics, where x is any integer
              //from 0 to 4 inclusive
CREATE        //Create a new account with associated code
CALL          //Message-call into another account, i.e. run another
              //account's code
CALLCODE      //Message-call into this account with another
              //account's code
RETURN        //Halt execution and return output data
DELEGATECALL  //Message-call into this account with an alternative
              //account's code, but persisting the current values for
              //sender and value
STATICCALL    //Static message-call into an account
REVERT        //Halt execution, reverting state changes but returning
              //data and remaining gas
INVALID       //The designated invalid instruction
SELFDESTRUCT  //Halt execution and register account for deletion</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="logic_opcides" class="dlist data-line-135">
<dl>
<dt class="hdlist1">Logic operations</dt>
<dd>
<p>Opcodes for comparisons and bitwise logic:</p>
<div class="listingblock data-line-137">
<div class="content">
<pre>LT     //Less-than comparison
GT     //Greater-than comparison
SLT    //Signed less-than comparison
SGT    //Signed greater-than comparison
EQ     //Equality comparison
ISZERO //Simple NOT operator
AND    //Bitwise AND operation
OR     //Bitwise OR operation
XOR    //Bitwise XOR operation
NOT    //Bitwise NOT operation
BYTE   //Retrieve a single byte from a full-width 256-bit word</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="environment_opcodes" class="dlist data-line-152">
<dl>
<dt class="hdlist1">Environmental operations</dt>
<dd>
<p>Opcodes dealing with execution environment information:</p>
<div class="listingblock data-line-154">
<div class="content">
<pre>GAS            //Get the amount of available gas (after the reduction for
               //this instruction)
ADDRESS        //Get the address of the currently executing account
BALANCE        //Get the account balance of any given account
ORIGIN         //Get the address of the EOA that initiated this EVM
               //execution
CALLER         //Get the address of the caller immediately responsible
               //for this execution
CALLVALUE      //Get the ether amount deposited by the caller responsible
               //for this execution
CALLDATALOAD   //Get the input data sent by the caller responsible for
               //this execution
CALLDATASIZE   //Get the size of the input data
CALLDATACOPY   //Copy the input data to memory
CODESIZE       //Get the size of code running in the current environment
CODECOPY       //Copy the code running in the current environment to
               //memory
GASPRICE       //Get the gas price specified by the originating
               //transaction
EXTCODESIZE    //Get the size of any account's code
EXTCODECOPY    //Copy any account's code to memory
RETURNDATASIZE //Get the size of the output data from the previous call
               //in the current environment
RETURNDATACOPY //Copy data output from the previous call to memory</pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="block_opcodes" class="dlist data-line-182">
<dl>
<dt class="hdlist1">Block operations</dt>
<dd>
<p>Opcodes for accessing information on the current block:</p>
<div class="listingblock data-line-184">
<div class="content">
<pre>BLOCKHASH  //Get the hash of one of the 256 most recently completed
           //blocks
COINBASE   //Get the block's beneficiary address for the block reward
TIMESTAMP  //Get the block's timestamp
NUMBER     //Get the block's number
DIFFICULTY //Get the block's difficulty
GASLIMIT   //Get the block's gas limit</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-195">
<h4 id="evm_state_descriptions">Ethereum State</h4>
<div class="paragraph data-line-197">
<p>The job of the EVM is to update the Ethereum state by computing valid state transitions as a result of smart contract code execution, as defined by the Ethereum protocol. This aspect leads to the description of Ethereum as a <em>transaction-based state machine</em>, which reflects the fact that external actors (i.e., account holders and miners) initiate state transitions by creating, accepting, and ordering transactions. It is useful at this point to consider what constitutes the Ethereum state.</p>
</div>
<div class="paragraph data-line-199">
<p>At the top level, we have the Ethereum <em>world state</em>. The world state is a mapping of Ethereum addresses (160-bit values) to <em>accounts</em>. At the lower level, each Ethereum address represents an account comprising an ether <em>balance</em> (stored as the number of wei owned by the account), a <em>nonce</em> (representing the number of transactions successfully sent from this account if it is an EOA, or the number of contracts created by it if it is a contract account), the account&#8217;s <em>storage</em> (which is a permanent data store, only used by smart contracts), and the account&#8217;s <em>program code</em> (again, only if the account is a smart contract account). An EOA will always have no code and an empty storage.</p>
</div>
<div class="paragraph data-line-205">
<p>When a transaction results in smart contract code execution, an EVM is instantiated with all the information required in relation to the current block being created and the specific transaction being processed. In particular, the EVM&#8217;s program code ROM is loaded with the code of the contract account being called, the program counter is set to zero, the storage is loaded from the contract account&#8217;s storage, the memory is set to all zeros, and all the block and environment variables are set. A key variable is the gas supply for this execution, which is set to the amount of gas paid for by the sender at the start of the transaction (see <a href="#gas">Gas</a> for more details). As code execution progresses, the gas supply is reduced according to the gas cost of the operations executed. If at any point the gas supply is reduced to zero we get an "Out of Gas" (OOG) exception; execution immediately halts and the transaction is abandoned. No changes to the Ethereum state are applied, except for the sender&#8217;s nonce being incremented and their ether balance going down to pay the block&#8217;s beneficiary for the resources used to execute the code to the halting point. At this point, you can think of the EVM running on a sandboxed copy of the Ethereum world state, with this sandboxed version being discarded completely if execution cannot complete for whatever reason. However, if execution does complete successfully, then the real-world state is updated to match the sandboxed version, including any changes to the called contract&#8217;s storage data, any new contracts created, and any ether balance transfers that were initiated.</p>
</div>
<div class="paragraph data-line-207">
<p>Note that because a smart contract can itself effectively initiate transactions, code execution is a recursive process. A contract can call other contracts, with each call resulting in another EVM being instantiated around the new target of the call. Each instantiation has its sandbox world state initialized from the sandbox of the EVM at the level above. Each instantiation is also given a specified amount of gas for its gas supply (not exceeding the amount of gas remaining in the level above, of course), and so may itself halt with an exception due to being given too little gas to complete its execution. Again, in such cases, the sandbox state is discarded, and execution returns to the EVM at the level above.</p>
</div>
</div>
<div class="sect3 data-line-210">
<h4 id="compiling_solidity_to_evm">Compiling Solidity to EVM Bytecode</h4>
<div id="solc_help" class="paragraph data-line-213">
<p>Compiling a Solidity source file to EVM bytecode can be accomplished via several methods. In <a href="#intro_chapter">Les bases d&#39;Ethereum</a> we used the online Remix compiler. In this chapter, we will use the solc executable at the command line. For a list of options, run the following <span class="keep-together">command</span>:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc --help</strong>
</pre>
<div id="solc_opcodes_option" class="paragraph data-line-222">
<p>Generating the raw opcode stream of a Solidity source file is easily achieved with the --opcodes command-line option. This opcode stream leaves out some information (the --asm option produces the full information), but it is sufficient for this discussion. For example, compiling an example Solidity file, <em>Example.sol</em>, and sending the opcode output into a directory named <em>BytecodeDir</em> is accomplished with the following command:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --opcodes Example.sol</strong>
</pre>
<div class="paragraph data-line-230">
<p>or:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --asm Example.sol</strong>
</pre>
<div id="solc_bin_option" class="paragraph data-line-239">
<p>The following command will produce the bytecode binary for our example program:</p>
</div>
<pre data-type="programlisting">
$ <strong>solc -o BytecodeDir --bin Example.sol</strong>
</pre>
<div class="paragraph data-line-247">
<p>The output opcode files generated will depend on the specific contracts contained within the Solidity source file. Our simple Solidity file <em>Example.sol</em> has only one contract, named example:</p>
</div>
<div id="simple_solidity_example" class="listingblock data-line-251">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.19;

contract example {

  address contractOwner;

  function example() {
    contractOwner = msg.sender;
  }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-264">
<p>As you can see, all this contract does is hold one persistent state variable, which is set as the address of the last account to run this contract.</p>
</div>
<div class="paragraph data-line-266">
<p>If you look in the <em>BytecodeDir</em> directory you will see the opcode file <em>example.opcode</em>, which contains the EVM opcode instructions of the example contract. Opening the <em>example.opcode</em> file in a text editor will show the following:</p>
</div>
<div id="opcode_output" class="listingblock data-line-269">
<div class="content">
<pre>PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH1 0xE JUMPI PUSH1 0x0 DUP1
REVERT JUMPDEST CALLER PUSH1 0x0 DUP1 PUSH2 0x100 EXP DUP2 SLOAD DUP2 PUSH20
0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF MUL NOT AND SWAP1 DUP4 PUSH20
0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF AND MUL OR SWAP1 SSTORE POP PUSH1
0x35 DUP1 PUSH1 0x5B PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x60 PUSH1
0x40 MSTORE PUSH1 0x0 DUP1 REVERT STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 JUMP
0xb9 SWAP14 0xcb 0x1e 0xdd RETURNDATACOPY 0xec 0xe0 0x1f 0x27 0xc9 PUSH5
0x9C5ABCC14A NUMBER 0x5e INVALID EXTCODESIZE 0xdb 0xcf EXTCODESIZE 0x27
EXTCODESIZE 0xe2 0xb8 SWAP10 0xed 0x</pre>
</div>
</div>
<div class="paragraph data-line-281">
<p>Compiling the example with the --asm option produces a file named <em>example.evm</em> in our <em>BytecodeDir</em> directory. This contains a slightly higher-level description of the EVM bytecode instructions, together with some helpful annotations:</p>
</div>
<div id="asm_output" class="listingblock data-line-285">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">/* "Example.sol":26:132  contract example {... */
  mstore(0x40, 0x60)
    /* "Example.sol":74:130  function example() {... */
  jumpi(tag_1, iszero(callvalue))
  0x0
  dup1
  revert
tag_1:
    /* "Example.sol":115:125  msg.sender */
  caller
    /* "Example.sol":99:112  contractOwner */
  0x0
  dup1
    /* "Example.sol":99:125  contractOwner = msg.sender */
  0x100
  exp
  dup2
  sload
  dup2
  0xffffffffffffffffffffffffffffffffffffffff
  mul
  not
  and
  swap1
  dup4
  0xffffffffffffffffffffffffffffffffffffffff
  and
  mul
  or
  swap1
  sstore
  pop
    /* "Example.sol":26:132  contract example {... */
  dataSize(sub_0)
  dup1
  dataOffset(sub_0)
  0x0
  codecopy
  0x0
  return
stop

sub_0: assembly {
        /* "Example.sol":26:132  contract example {... */
      mstore(0x40, 0x60)
      0x0
      dup1
      revert

    auxdata: 0xa165627a7a7230582056b99dcb1edd3eece01f27c9649c5abcc14a435efe3b...
}</code></pre>
</div>
</div>
<div class="paragraph data-line-339">
<p>The --bin-runtime option produces the machine-readable hexadecimal bytecode:</p>
</div>
<div id="bin_output" class="listingblock data-line-342">
<div class="content">
<pre>60606040523415600e57600080fd5b336000806101000a81548173
ffffffffffffffffffffffffffffffffffffffff
021916908373
ffffffffffffffffffffffffffffffffffffffff
160217905550603580605b6000396000f3006060604052600080fd00a165627a7a7230582056b...</pre>
</div>
</div>
<div class="paragraph data-line-350">
<p>You can investigate what&#8217;s going on here in detail using the opcode list given in <a href="#evm_bytecode_overview">The EVM Instruction Set (Bytecode Operations)</a>. However, that&#8217;s quite a task, so let&#8217;s just start by examining the first four instructions:</p>
</div>
<div id="opcode_analysis_1" class="listingblock data-line-353">
<div class="content">
<pre>PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE</pre>
</div>
</div>
<div class="paragraph data-line-357">
<p>Here we have PUSH1 followed by a raw byte of value 0x60. This EVM instruction takes the single byte following the opcode in the program code (as a literal value) and pushes it onto the stack. It is possible to push values of size up to 32 bytes onto the stack, as in:</p>
</div>
<div class="listingblock data-line-359">
<div class="content">
<pre>PUSH32 0x436f6e67726174756c6174696f6e732120536f6f6e20746f206d617374657221</pre>
</div>
</div>
<div class="paragraph data-line-363">
<p>The second PUSH1 opcode from <em>example.opcode</em> stores 0x40 onto the top of the stack (pushing the 0x60 already present there down one slot).</p>
</div>
<div class="paragraph data-line-365">
<p>Next is MSTORE, which is a memory store operation that saves a value to the EVM&#8217;s memory. It takes two arguments and, like most EVM operations, obtains them from the stack. For each argument the stack is &#x201c;popped&#x201d;; i.e., the top value on the stack is taken off and all the other values on the stack are shifted up one position. The first argument for MSTORE is the address of the word in memory where the value to be saved will be put. For this program we have 0x40 at the top of the stack, so that is removed from the stack and used as the memory address. The second argument is the value to be saved, which is 0x60 here. After the MSTORE operation is executed our stack is empty again, but we have the value 0x60 (96 in decimal) at the memory location 0x40.</p>
</div>
<div class="paragraph data-line-367">
<p>The next opcode is CALLVALUE, which is an environmental opcode that pushes onto the top of the stack the amount of ether (measured in wei) sent with the message call that initiated this execution.</p>
</div>
<div class="paragraph data-line-369">
<p>We could continue to step through this program in this way until we had a full understanding of the low-level state changes that this code effects, but it wouldn&#8217;t help us at this stage. We&#8217;ll come back to it later in the chapter.</p>
</div>
</div>
<div class="sect3 data-line-372">
<h4 id="contract_deployment_code">Contract Deployment Code</h4>
<div class="paragraph data-line-374">
<p>There is an important but subtle difference between the code used when creating and deploying a new contract on the Ethereum platform and the code of the contract itself. In order to create a new contract, a special transaction is needed that has its to field set to the special 0x0 address and its data field set to the contract&#8217;s <em>initiation code</em>. When such a contract creation transaction is processed, the code for the new contract account is <em>not</em> the code in the data field of the transaction. Instead, an EVM is instantiated with the code in the data field of the transaction loaded into its program code ROM, and then the output of the execution of that deployment code is taken as the code for the new contract account. This is so that new contracts can be programmatically initialized using the Ethereum world state at the time of deployment, setting values in the contract&#8217;s storage and even sending ether or creating further new contracts.</p>
</div>
<div class="paragraph data-line-376">
<p>When compiling a contract offline, e.g., using solc on the command line, you can either get the <em>deployment bytecode</em> or the <em>runtime bytecode</em>.</p>
</div>
<div class="paragraph data-line-378">
<p>The deployment bytecode is used for every aspect of the initialization of a new contract account, including the bytecode that will actually end up being executed when transactions call this new contract (i.e., the runtime bytecode) and the code to initialize everything based on the contract&#8217;s constructor.</p>
</div>
<div class="paragraph data-line-380">
<p>The runtime bytecode, on the other hand, is exactly the bytecode that ends up being executed when the new contract is called, and nothing more; it does not include the bytecode needed to initialize the contract during deployment.</p>
</div>
<div class="paragraph data-line-382">
<p>Let&#8217;s take the simple <em>Faucet.sol</em> contract we created earlier as an example:</p>
</div>
<div id="faucet_example" class="listingblock data-line-386">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version of Solidity compiler this program was written for
pragma solidity ^0.4.19;

// Our first contract is a faucet!
contract Faucet {

  // Give out ether to anyone who asks
  function withdraw(uint withdraw_amount) public {

      // Limit withdrawal amount
      require(withdraw_amount &lt;= 100000000000000000);

      // Send the amount to the address that requested it
      msg.sender.transfer(withdraw_amount);
    }

  // Accept any incoming amount
  function () external payable {}

}</code></pre>
</div>
</div>
<div class="paragraph data-line-409">
<p>To get the deployment bytecode, we would run <code>solc --bin Faucet.sol</code>. If we instead wanted just the runtime bytecode, we would run <code>solc --bin-runtime <span class="keep-together">Faucet.sol</span></code>.</p>
</div>
<div class="paragraph data-line-411">
<p>If you compare the output of these commands, you will see that the runtime bytecode is a subset of the deployment bytecode. In other words, the runtime bytecode is entirely contained within the deployment bytecode.</p>
</div>
</div>
<div class="sect3 data-line-414">
<h4 id="disassembling_the_bytecode">Disassembling the Bytecode</h4>
<div class="paragraph data-line-416">
<p>Disassembling EVM bytecode is a great way to understand how high-level Solidity acts in the EVM. There are a few disassemblers you can use to do this:</p>
</div>
<div class="ulist data-line-418">
<ul>
<li class="data-line-418">
<p><a href="https://github.com/comaeio/porosity" data-href="https://github.com/comaeio/porosity"><em>Porosity</em></a> is a popular open source decompiler.</p>
</li>
<li class="data-line-419">
<p><a href="https://github.com/trailofbits/ethersplay" data-href="https://github.com/trailofbits/ethersplay"><em>Ethersplay</em></a> is an EVM plug-in for Binary Ninja, a disassembler.</p>
</li>
<li class="data-line-420">
<p><a href="https://github.com/trailofbits/ida-evm" data-href="https://github.com/trailofbits/ida-evm"><em>IDA-Evm</em></a> is an EVM plugin for IDA, another disassembler.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-422">
<p>In this section, we will be using the Ethersplay plug-in for Binary Ninja and to start <a href="#Faucet_disassembled">Disassembling the Faucet runtime bytecode</a>. After getting the runtime bytecode of <em>Faucet.sol</em>, we can feed it into Binary Ninja (after loading the Ethersplay plug-in) to see what the EVM instructions look like.</p>
</div>
<div id="Faucet_disassembled" class="imageblock data-line-426">
<div class="content">
<img src="images/Faucet_disassembled.png" alt="Faucet.sol runtime bytecode disassembled">
</div>
<div class="title">Figure 56. Disassembling the Faucet runtime bytecode</div>
</div>
<div class="paragraph data-line-428">
<p>When you send a transaction to an ABI-compatible smart contract (which you can assume all contracts are), the transaction first interacts with that smart contract&#8217;s <em>dispatcher</em>. The dispatcher reads in the data field of the transaction and sends the relevant part to the appropriate function. We can see an example of a dispatcher at the beginning of our disassembled <em>Faucet.sol</em> runtime bytecode. After the familiar MSTORE instruction, we see the following instructions:</p>
</div>
<div id="faucet_instructions" class="listingblock data-line-431">
<div class="content">
<pre>PUSH1 0x4
CALLDATASIZE
LT
PUSH1 0x3f
JUMPI</pre>
</div>
</div>
<div class="paragraph data-line-439">
<p>As we have seen, PUSH1 0x4 places 0x4 onto the top of the stack, which is otherwise empty. CALLDATASIZE gets the size in bytes of the data sent with the transaction (known as the <em>calldata</em>) and pushes that number onto the stack. After these operations have been executed, the stack looks like this:</p>
</div>
<table class="tableblock frame-ends grid-all data-line-442" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;length of calldata from tx&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-448">
<p>This next instruction is LT, short for ‚Äúless than.‚Äù The LT instruction checks whether the top item on the stack is less than the next item on the stack. In our case, it checks to see if the result of CALLDATASIZE is less than 4 bytes.</p>
</div>
<div class="paragraph data-line-450">
<p>Why does the EVM check to see that the calldata of the transaction is at least 4 bytes? Because of how function identifiers work. Each function is identified by the first 4 bytes of its Keccak-256 hash. By placing the function&#8217;s name and what arguments it takes into a keccak256 hash function, we can deduce its function identifier. In our case, we have:</p>
</div>
<div id="faucet_function_identifier" class="listingblock data-line-453">
<div class="content">
<pre class="highlight"><code>keccak256("withdraw(uint256)") = 0x2e1a7d4d...</code></pre>
</div>
</div>
<div class="paragraph data-line-457">
<p>Thus, the function identifier for the withdraw(uint256) function is 0x2e1a7d4d, since these are the first 4 bytes of the resulting hash. A function identifier is always 4 bytes long, so if the entire data field of the transaction sent to the contract is less than 4 bytes, then there‚Äôs no function with which the transaction could possibly be communicating, unless a <em>fallback function</em> is defined. Because we implemented such a fallback function in <em>Faucet.sol</em>, the EVM jumps to this function when the calldata&#8217;s length is less than 4 bytes.</p>
</div>
<div class="paragraph data-line-459">
<p>LT pops the top two values off the stack and, if the transaction&#8217;s data field is less than 4 bytes, pushes 1 onto it. Otherwise, it pushes 0. In our example, let&#8217;s assume the data field of the transaction sent to our contract <em>was</em> less than 4 bytes.</p>
</div>
<div class="paragraph data-line-461">
<p>The PUSH1 0x3f instruction pushes the byte 0x3f onto the stack. After this instruction, the stack looks like this:</p>
</div>
<table class="tableblock frame-ends grid-all data-line-464" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3f</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-470">
<p>The next instruction is JUMPI, which stands for "jump if." It works like so:</p>
</div>
<div id="faucet_jump_instruction_text" class="listingblock data-line-473">
<div class="content">
<pre>jumpi(label, cond) // Jump to "label" if "cond" is true</pre>
</div>
</div>
<div class="paragraph data-line-477">
<p>In our case, label is 0x3f, which is where our fallback function lives in our smart contract. The cond argument is 1, which was the result of the LT instruction earlier. To put this entire sequence into words, the contract jumps to the fallback function if the transaction data is less than 4 bytes.</p>
</div>
<div class="paragraph data-line-479">
<p>At 0x3f, only a STOP instruction follows, because although we declared a fallback function, we kept it empty. As you can see in <a href="#Faucet_jumpi_instruction">JUMPI instruction leading to fallback function</a>, had we not implemented a fallback function, the contract would throw an exception instead.</p>
</div>
<div id="Faucet_jumpi_instruction" class="imageblock data-line-483">
<div class="content">
<img src="images/Faucet_jumpi_instruction.png" alt="JUMPI instruction leading to fallback function">
</div>
<div class="title">Figure 57. JUMPI instruction leading to fallback function</div>
</div>
<div class="paragraph data-line-485">
<p>Let&#8217;s examine the central block of the dispatcher. Assuming we received calldata that was <em>greater</em> than 4 bytes in length, the JUMPI instruction would not jump to the fallback function. Instead, code execution would proceed to the following instructions:</p>
</div>
<div id="faucet_instructions2" class="listingblock data-line-488">
<div class="content">
<pre>PUSH1 0x0
CALLDATALOAD
PUSH29 0x1000000...
SWAP1
DIV
PUSH4 0xffffffff
AND
DUP1
PUSH4 0x2e1a7d4d
EQ
PUSH1 0x41
JUMPI</pre>
</div>
</div>
<div class="paragraph data-line-503">
<p>PUSH1 0x0 pushes 0 onto the stack, which is now otherwise empty again. CALLDATALOAD accepts as an argument an index within the calldata sent to the smart contract and reads 32 bytes from that index, like so:</p>
</div>
<div id="faucet_calldataload_instruction_text" class="listingblock data-line-506">
<div class="content">
<pre>calldataload(p) //load 32 bytes of calldata starting from byte position p</pre>
</div>
</div>
<div class="paragraph data-line-510">
<p>Since 0 was the index passed to it from the PUSH1 0x0 command, CALLDATALOAD reads 32 bytes of calldata starting at byte 0, and then pushes it to the top of the stack (after popping the original 0x0). After the PUSH29 0x1000000&#8230;&#8203; instruction, the stack is then:</p>
</div>
<table class="tableblock frame-ends grid-all data-line-513" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000000&#8230;&#8203; (29 bytes in length)</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;32 bytes of calldata starting at byte 0&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-519">
<p>SWAP1 switches the top element on the stack with the <em>i</em>-th element after it. In this case, it swaps 0x1000000&#8230;&#8203; with the calldata. The new stack is:</p>
</div>
<table class="tableblock frame-ends grid-all data-line-522" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;32 bytes of calldata starting at byte 0&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000000&#8230;&#8203; (29 bytes in length)</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-528">
<p>The next instruction is DIV, which works as follows:</p>
</div>
<div id="faucet_div_instruction_text" class="listingblock data-line-531">
<div class="content">
<pre>div(x, y) // integer division x / y</pre>
</div>
</div>
<div class="paragraph data-line-535">
<p>In this case, x = 32 bytes of calldata starting at byte 0, and y = 0x100000000&#8230;&#8203; (29 bytes total). Can you think of why the dispatcher is doing the division? Here&#8217;s a hint: we read 32 bytes from calldata earlier, starting at index 0. The first 4 bytes of that calldata is the function identifier.</p>
</div>
<div class="paragraph data-line-538">
<p>The 0x100000000&#8230;&#8203; we pushed earlier is 29 bytes long, consisting of a 1 at the beginning, followed by all 0s. Dividing our 32 bytes of calldata by this value will leave us only the <em>topmost 4 bytes</em> of our calldata load, starting at index 0. These 4 bytes‚Äîthe first 4 bytes in the calldata starting at index 0‚Äîare the function identifier, and this is how the EVM extracts that field.</p>
</div>
<div class="paragraph data-line-540">
<p>If this part isn‚Äôt clear to you, think of it like this: in base 10, 1234000 / 1000 = 1234. In base 16, this is no different. Instead of every place being a multiple of 10, it is a multiple of 16. Just as dividing by 10<sup>3</sup> (1000) in our smaller example kept only the topmost digits, dividing our 32-byte base 16 value by 16<sup>29</sup> does the same.</p>
</div>
<div class="paragraph data-line-542">
<p>The result of the DIV (the function identifier) gets pushed onto the stack, and our stack is now:</p>
</div>
<table class="tableblock frame-ends grid-all data-line-545" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-550">
<p>Since the PUSH4 0xffffffff and AND instructions are redundant, we can ignore them entirely, as the stack will remain the same after they are done. The DUP1 instruction duplicates the first item on the stack, which is the function identifier. The next instruction, PUSH4 0x2e1a7d4d, pushes the precalculated function identifier of the <code><span class="keep-together">withdraw</span>(uint256)</code> function onto the stack. The stack is now:</p>
</div>
<table class="tableblock frame-ends grid-all data-line-553" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2e1a7d4d</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt;</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-560">
<p>The next instruction, EQ, pops off the top two items of the stack and compares them. This is where the dispatcher does its main job: it compares whether the function identifier sent in the msg.data field of the transaction matches that of <code><span class="keep-together">withdraw</span>(uint256)</code>. If they are equal, EQ pushes 1 onto the stack, which will ultimately be used to jump to the withdraw function. Otherwise, EQ pushes 0 onto the stack.</p>
</div>
<div class="paragraph data-line-562">
<p>Assuming the transaction sent to our contract indeed began with the function identifier for withdraw(uint256), our stack has become:</p>
</div>
<table class="tableblock frame-ends grid-all data-line-565" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;function identifier sent in data&gt; (now known to be 0x2e1a7d4d)</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-571">
<p>Next, we have PUSH1 0x41, which is the address at which the withdraw(uint256) function lives in the contract. After this instruction, the stack looks like this:</p>
</div>
<table class="tableblock frame-ends grid-all data-line-574" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x41</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">function identifier sent in msg.data</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-581">
<p>The JUMPI instruction is next, and it once again accepts the top two elements on the stack as arguments. In this case, we have jumpi(0x41, 1), which tells the EVM to execute the jump to the location of the withdraw(uint256) function, and the execution of that function&#8217;s code can proceed.</p>
</div>
</div>
</div>
<div class="sect2 data-line-584">
<h3 id="turing_completeness_and_gas">Turing Completeness and Gas</h3>
<div class="paragraph data-line-586">
<p>As we have already touched on, in simple terms, a system or programming language is <em>Turing complete</em> if it can run any program. This capability, however, comes with a very important caveat: some programs take forever to run. An important aspect of this is that we can&#8217;t tell, just by looking at a program, whether it will take forever or not to execute. We have to actually go through with the execution of the program and wait for it to finish to find out. Of course, if it is going to take forever to execute, we will have to wait forever to find out. This is called the <em>halting problem</em> and would be a huge problem for Ethereum if it were not addressed.</p>
</div>
<div class="paragraph data-line-588">
<p>Because of the halting problem, the Ethereum world computer is at risk of being asked to execute a program that never stops. This could be by accident or malice. We have discussed that Ethereum acts like a single-threaded machine, without any scheduler, and so if it became stuck in an infinite loop this would mean it would become unusable.</p>
</div>
<div class="paragraph data-line-590">
<p>However, with gas, there is a solution: if after a prespecified maximum amount of computation has been performed, the execution hasn&#8217;t ended, the execution of the program is halted by the EVM. This makes the EVM a <em>quasi</em>&#x2013;Turing-complete machine: it can run any program you feed into it, but only if the program terminates within a particular amount of computation. That limit isn&#8217;t fixed in Ethereum&#x2014;you can pay to increase it up to a maximum (called the "block gas limit"), and everyone can agree to increase that maximum over time. Nevertheless, at any one time, there is a limit in place, and transactions that consume too much gas while executing are <span class="keep-together">halted</span>.</p>
</div>
<div class="paragraph data-line-592">
<p>In the following sections, we will look at gas and examine how it works in detail.</p>
</div>
</div>
<div class="sect2 data-line-595">
<h3 id="gas">Gas</h3>
<div class="paragraph data-line-597">
<p><em>Gas</em> is Ethereum&#8217;s unit for measuring the computational and storage resources required to perform actions on the Ethereum blockchain. In contrast to Bitcoin, whose transaction fees only take into account the size of a transaction in kilobytes, Ethereum must account for every computational step performed by transactions and smart contract code execution.</p>
</div>
<div class="paragraph data-line-599">
<p>Each operation performed by a transaction or contract costs a fixed amount of gas. Some examples, from the Ethereum Yellow Paper:</p>
</div>
<div class="ulist data-line-601">
<ul>
<li class="data-line-601">
<p>Adding two numbers costs 3 gas</p>
</li>
<li class="data-line-602">
<p>Calculating a Keccak-256 hash costs 30 gas + 6 gas for each 256 bits of data being hashed</p>
</li>
<li class="data-line-603">
<p>Sending a transaction costs 21,000 gas</p>
</li>
</ul>
</div>
<div class="paragraph data-line-605">
<p>Gas is a crucial component of Ethereum, and serves a dual role: as a buffer between the (volatile) price of Ethereum and the reward to miners for the work they do, and as a defense against denial-of-service attacks. To prevent accidental or malicious infinite loops or other computational wastage in the network, the initiator of each transaction is required to set a limit to the amount of computation they are willing to pay for. The gas system thereby disincentivizes attackers from sending "spam" transactions, as they must pay proportionately for the computational, bandwidth, and storage resources that they consume.</p>
</div>
<div class="sect3 data-line-608">
<h4 id="gas_accounting_execution">Gas Accounting During Execution</h4>
<div class="paragraph data-line-609">
<p>When an EVM is needed to complete a transaction, in the first instance it is given a gas supply equal to the amount specified by the gas limit in the transaction. Every opcode that is executed has a cost in gas, and so the EVM&#8217;s gas supply is reduced as the EVM steps through the program. Before each operation, the EVM checks that there is enough gas to pay for the operation&#8217;s execution. If there isn&#8217;t enough gas, execution is halted and the transaction is reverted.</p>
</div>
<div class="paragraph data-line-611">
<p>If the EVM reaches the end of execution successfully, without running out of gas, the  gas cost used is paid to the miner as a transaction fee, converted to ether based on the gas price specified in the transaction:</p>
</div>
<div class="listingblock data-line-613">
<div class="content">
<pre>miner fee = gas cost * gas price</pre>
</div>
</div>
<div class="paragraph data-line-618">
<p>The gas remaining in the gas supply is refunded to the sender, again converted to ether based on the gas price specified in the transaction:</p>
</div>
<div class="listingblock data-line-620">
<div class="content">
<pre>remaining gas = gas limit - gas cost
refunded ether = remaining gas * gas price</pre>
</div>
</div>
<div class="paragraph data-line-625">
<p>If the transaction &#x201c;runs out of gas&#x201d; during execution, the operation is immediately terminated, raising an &#x201c;out of gas&#x201d; exception. The transaction is reverted and all changes to the state are rolled back.</p>
</div>
<div class="paragraph data-line-627">
<p>Although the transaction was unsuccessful, the sender will be charged a transaction fee, as miners have already performed the computational work up to that point and must be compensated for doing so.</p>
</div>
</div>
<div class="sect3 data-line-629">
<h4 id="_gas_accounting_considerations">Gas Accounting Considerations</h4>
<div class="paragraph data-line-631">
<p>The relative gas costs of the various operations that can be performed by the EVM have been carefully chosen to best protect the Ethereum blockchain from attack. You can see a detailed table of gas costs for different EVM opcodes in <a href="#evm_opcodes_table">EVM opcodes and gas cost</a>.</p>
</div>
<div class="paragraph data-line-633">
<p>More computationally intensive operations cost more gas. For example, executing the SHA3 function is 10 times more expensive (30 gas) than the ADD operation (3 gas). More importantly, some operations, such as EXP, require an additional payment based on the size of the operand. There is also a gas cost to using EVM memory and for storing data in a contract&#8217;s on-chain storage.</p>
</div>
<div class="paragraph data-line-635">
<p>The importance of matching gas cost to the real-world cost of resources was demonstrated in 2016 when an attacker found and exploited a mismatch in costs. The attack generated transactions that were very computationally expensive, and made the Ethereum mainnet almost grind to a halt. This mismatch was resolved by a hard fork (codenamed "Tangerine Whistle") that tweaked the relative gas costs.</p>
</div>
</div>
<div class="sect3 data-line-637">
<h4 id="_gas_cost_versus_gas_price">Gas Cost Versus Gas Price</h4>
<div class="paragraph data-line-638">
<p>While the gas <em>cost</em> is a measure of computation and storage used in the EVM, the gas itself also has a <em>price</em> measured in ether. When performing a transaction, the sender specifies the gas price they are willing to pay (in ether) for each unit of gas, allowing the market to decide the relationship between the price of ether and the cost of computing operations (as measured in gas):</p>
</div>
<div class="listingblock data-line-640">
<div class="content">
<pre>transaction fee = total gas used * gas price paid  (in ether)</pre>
</div>
</div>
<div class="paragraph data-line-644">
<p>When constructing a new block, miners on the Ethereum network can choose among pending transactions by selecting those that offer to pay a higher gas price. Offering a higher gas price will therefore incentivize miners to include your transaction and get it confirmed faster.</p>
</div>
<div class="paragraph data-line-646">
<p>In practice, the sender of a transaction will set a gas limit that is higher than or equal to the amount of gas expected to be used. If the gas limit is set higher than the amount of gas consumed, the sender will receive a refund of the excess amount, as miners are only compensated for the work they actually perform.</p>
</div>
<div class="paragraph data-line-648">
<p>It is important to be clear about the distinction between the <em>gas cost</em> and the <em>gas price</em>. To recap:</p>
</div>
<div class="ulist data-line-650">
<ul>
<li class="data-line-650">
<p>Gas cost is the number of units of gas required to perform a particular operation.</p>
</li>
<li class="data-line-652">
<p>Gas price is the amount of ether you are willing to pay per unit of gas when you send your transaction to the Ethereum network.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip data-line-655">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-656">
<p>While gas has a price, it cannot be "owned" nor "spent." Gas exists only inside the EVM, as a count of how much computational work is being performed. The sender is charged a transaction fee in ether, which is then converted to gas for EVM accounting and then back to ether as a transaction fee paid to the miners.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-660">
<h5 id="_negative_gas_costs">Negative gas costs</h5>
<div class="paragraph data-line-662">
<p>Ethereum encourages the deletion of used storage variables and accounts by refunding some of the gas used during contract execution.</p>
</div>
<div class="paragraph data-line-664">
<p>There are two operations in the EVM with negative gas costs:</p>
</div>
<div class="ulist data-line-666">
<ul>
<li class="data-line-666">
<p>Deleting a contract (SELFDESTRUCT) is worth a refund of 24,000 gas.</p>
</li>
<li class="data-line-667">
<p>Changing a storage address from a nonzero value to zero (SSTORE[x] = 0) is worth a refund of 15,000 gas.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-669">
<p>To avoid exploitation of the refund mechanism, the maximum refund for a transaction is set to half the total amount of gas used (rounded down).</p>
</div>
</div>
</div>
<div class="sect3 data-line-671">
<h4 id="_block_gas_limit">Block Gas Limit</h4>
<div class="paragraph data-line-673">
<p>The block gas limit is the maximum amount of gas that may be consumed by all the transactions in a block, and constrains how many transactions can fit into a block.</p>
</div>
<div class="paragraph data-line-675">
<p>For example, let‚Äôs say we have 5 transactions whose gas limits have been set to 30,000, 30,000, 40,000, 50,000, and 50,000. If the block gas limit is 180,000, then any four of those transactions can fit in a block, while the fifth will have to wait for a future block. As previously discussed, miners decide which transactions to include in a block. Different miners are likely to select different combinations, mainly because they receive transactions from the network in a different order.</p>
</div>
<div class="paragraph data-line-677">
<p>If a miner tries to include a transaction that requires more gas than the current block gas limit, the block will be rejected by the network. Most Ethereum clients will stop you from issuing such a transaction by giving a warning along the lines of ‚Äútransaction exceeds block gas limit.‚Äù The block gas limit on the Ethereum mainnet is 8 million gas at the time of writing according to <a href="https://etherscan.io" class="undefined" data-href="https://etherscan.io">https://etherscan.io</a>, meaning that around 380 basic transactions (each consuming 21,000 gas) could fit into a block.</p>
</div>
<div class="sect4 data-line-679">
<h5 id="_who_decides_what_the_block_gas_limit_is">Who decides what the block gas limit is?</h5>
<div class="paragraph data-line-681">
<p>The miners on the network collectively decide the block gas limit. Individuals who want to mine on the Ethereum network use a mining program, such as Ethminer, which connects to a Geth or Parity Ethereum client. The Ethereum protocol has a built-in mechanism where miners can vote on the gas limit so capacity can be increased or decreased in subsequent blocks. The miner of a block can vote to adjust the block gas limit by a factor of 1/1,024 (0.0976%) in either direction. The result of this is an adjustable block size based on the needs of the network at the time. This mechanism is coupled with a default mining strategy where miners vote on a gas limit that is at least 4.7 million gas, but which targets a value of 150% of the average of recent total gas usage per block (using a 1,024-block exponential moving average).</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-683">
<h3 id="_conclusions_3">Conclusions</h3>
<div class="paragraph data-line-29">
<p>In this chapter we have explored the Ethereum Virtual Machine, tracing the execution of various smart contracts and looking at how the EVM executes bytecode. We also looked at gas, the EVM&#8217;s accounting mechanism, and saw how it solves the halting problem and protects Ethereum from denial-of-service attacks. Next, in <a href="#consensus">Consensus</a>, we will look at the mechanism used by Ethereum to achieve decentralized consensus.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="consensus">Consensus</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Throughout this book we have talked about "consensus rules&#x201d;&#x2014;the rules that everyone must agree to for the system to operate in a decentralized, yet deterministic, manner. In computer science, the term <em>consensus</em> predates blockchains and is related to the broader problem of synchronizing state in distributed systems, such that different participants in a distributed system all (eventually) agree on a single system-wide state. This is called "reaching consensus."</p>
</div>
<div class="paragraph data-line-6">
<p>When it comes to the core function of decentralized record keeping and verification, it can become problematic to rely on trust alone to ensure that information derived from state updates is correct. This rather general challenge is particularly pronounced in decentralized networks because there is no central entity to decide what is true. The lack of a central decision-making entity is one of the main attractions of blockchain platforms, because of the resulting capacity to resist censorship and the lack of dependence on authority for permission to access information. However, these benefits come at a cost: without a trusted arbitrator, any disagreements, deceptions, or differences need to be reconciled using other means. Consensus algorithms are the  mechanism used to reconcile security and decentralization.</p>
</div>
<div class="paragraph data-line-8">
<p>In blockchains, consensus is a critical property of the system. Simply put, there is money at stake! So, in the context of blockchains, <em>consensus</em> is about being able to arrive at a common state, while maintaining decentralization. In other words, consensus is intended to produce a system of <em>strict rules without rulers</em>. There is no one person, organization, or group "in charge&#x201d;; rather, power and control are diffused across a broad network of participants, whose self-interest is served by following the rules and behaving honestly.</p>
</div>
<div class="paragraph data-line-10">
<p>The ability to come to consensus across a distributed network, under adversarial conditions, without centralizing control is the core principle of all open public blockchains. To address this challenge and maintain the valued property of decentralization, the community continues to experiment with different models of consensus. This chapter explores these consensus models and their expected impact on smart contract blockchains such as Ethereum.</p>
</div>
<div class="admonitionblock note data-line-13">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-14">
<p>While consensus algorithms are an important part of how blockchains work, they operate at a foundational layer, far below the abstraction of smart contracts. In other words, most of the details of consensus are hidden from the writers of smart contracts. You don&#8217;t need to know how they work to use Ethereum, any more than you need to know how routing works to use the internet.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2 data-line-17">
<h3 id="_consensus_via_proof_of_work">Consensus via Proof of Work</h3>
<div class="paragraph data-line-19">
<p>The creator of the original blockchain, Bitcoin, invented a <em>consensus algorithm</em> called <em>proof of work</em> (PoW). Arguably, PoW is the most important invention underpinning Bitcoin. The colloquial term for PoW is "mining," which creates a misunderstanding about the primary purpose of consensus. Often people assume that the purpose of mining is the creation of new currency, since the purpose of real-world mining is the extraction of precious metals or other resources. Rather, the real purpose of mining (and all other consensus models) is to <em>secure the blockchain</em>, while keeping control over the system decentralized and diffused across as many participants as possible. The reward of newly minted currency is an incentive to those who contribute to the security of the system: a means to an end. In that sense, the reward is the means and decentralized security is the end. In PoW consensus there is also a corresponding "punishment," which is the cost of energy required to participate in mining. If participants do not follow the rules and earn the reward, they risk the funds they have already spent on electricity to mine. Thus, PoW consensus is a careful balance of risk and reward that drives participants to behave honestly out of self-interest.</p>
</div>
<div class="paragraph data-line-21">
<p>Ethereum is currently a PoW blockchain, in that it uses a PoW algorithm with the same basic incentive system for the same basic goal: securing the blockchain while decentralizing control. Ethereum&#8217;s PoW algorithm is slightly different than Bitcoin&#8217;s and is called <em>Ethash</em>. We will examine the function and design characteristics of the algorithm in <a href="#ethash">Ethash: Ethereum&#8217;s Proof-of-Work Algorithm</a>.</p>
</div>
</div>
<div class="sect2 data-line-23">
<h3 id="_consensus_via_proof_of_stake_pos">Consensus via Proof of Stake (PoS)</h3>
<div class="paragraph data-line-25">
<p>Historically, proof of work was not the first consensus algorithm proposed. Preceding the introduction of proof of work, many researchers had proposed variations of consensus algorithms based on financial stake, now called <em>proof of stake</em> (PoS). In some respects, proof of work was invented as an alternative to proof of stake. Following the success of Bitcoin, many blockchains have emulated proof of work. Yet the explosion of research into consensus algorithms has also resurrected proof of stake, significantly advancing the state of the technology. From the beginning, Ethereum&#8217;s founders were hoping to eventually migrate its consensus algorithm to proof of stake. In fact, there is a deliberate handicap on Ethereum&#8217;s proof of work called the <em>difficulty bomb</em>, intended to gradually make proof-of-work mining of Ethereum more and more difficult, thereby forcing the transition to proof of stake.</p>
</div>
<div class="paragraph data-line-27">
<p>At the time of publication of this book, Ethereum is still using proof of work, but the ongoing research toward a proof-of-stake alternative is nearing completion. Ethereum&#8217;s planned PoS algorithm is called <em>Casper</em>. The introduction of Casper as a replacement for Ethash has been postponed several times over the past two years, necessitating interventions to defuse the difficulty bomb and postpone its forced obsolescence of proof of work.</p>
</div>
<div class="paragraph data-line-29">
<p>In general, a PoS algorithm works as follows. The blockchain keeps track of a set of validators, and anyone who holds the blockchain&#8217;s base cryptocurrency (in Ethereum&#8217;s case, ether) can become a validator by sending a special type of transaction that locks up their ether into a deposit. The validators take turns proposing and voting on the next valid block, and the weight of each validator&#8217;s vote depends on the size of its deposit (i.e., stake). Importantly, a validator risks losing their deposit if the block they staked it on is rejected by the majority of validators. Conversely, validators earn a small reward, proportional to their deposited stake, for every block that is accepted by the majority. Thus, PoS forces validators to act honestly and follow the consensus rules, by a system of reward and punishment. The major difference between PoS and PoW is that the punishment in PoS is intrinsic to the blockchain (e.g., loss of staked ether), whereas in PoW the punishment is extrinsic (e.g., loss of funds spent on <span class="keep-together">electricity</span>).</p>
</div>
</div>
<div class="sect2 data-line-32">
<h3 id="ethash">Ethash: Ethereum&#8217;s Proof-of-Work Algorithm</h3>
<div class="paragraph data-line-34">
<p>Ethash is the Ethereum PoW algorithm. It uses an evolution of the Dagger‚ÄìHashimoto algorithm, which is a combination of Vitalik Buterin&#8217;s Dagger algorithm and Thaddeus Dryja&#8217;s Hashimoto algorithm. Ethash is dependent on the generation and analysis of a large dataset, known as a <em>directed acyclic graph</em> (or, more simply, &#x201c;the DAG&#x201d;). The DAG had an initial size of about 1 GB and will continue to slowly and linearly grow in size, being updated once every epoch (30,000 blocks, or roughly 125 hours).</p>
</div>
<div class="paragraph data-line-36">
<p>The purpose of the DAG is to make the Ethash PoW algorithm dependent on maintaining a large, frequently accessed data structure. This in turn is intended to make Ethash "ASIC resistant," which means that it is more difficult to make <em>application-specific integrated circuits</em> (ASIC) mining equipment that is orders of magnitude faster than a fast <em>graphics processing unit</em> (GPU). Ethereum&#8217;s founders wanted to avoid centralization in PoW mining, where those with access to specialized silicon fabrication factories and big budgets could dominate the mining infrastructure and undermine the security of the consensus algorithm.</p>
</div>
<div class="paragraph data-line-38">
<p>Use of consumer-level GPUs for carrying out the PoW on the Ethereum network means that more people around the world can participate in the mining process. The more independent miners there are the more decentralized the mining power is, which means we can avoid a situation like in Bitcoin, where much of the mining power is concentrated in the hands of a few large industrial mining operations. The downside of the use of GPUs for mining is that it precipitated a worldwide shortage GPUs in 2017, causing their price to skyrocket and an outcry from gamers. This led to purchase restrictions at retailers, limiting buyers to one or two GPUs per customer.</p>
</div>
<div class="paragraph data-line-40">
<p>Until recently, the threat of ASIC miners on the Ethereum network was largely nonexistent. Using ASICs for Ethereum requires the design, manufacture, and distribution of highly customized hardware. Producing them requires considerable investment of time and money. The Ethereum developers' long-expressed plans to move to a PoS consensus algorithm likely kept ASIC suppliers away from targeting the Ethereum network for a long time. As soon as Ethereum moves to PoS, ASICs designed for the PoW algorithm will be rendered useless‚Äîthat is, unless miners can use them to mine other cryptocurrencies instead. The latter possibility is now a reality with a range of other Ethash-based consensus coins available, such as PIRL and Ubiq, and Ethereum Classic has pledged to remain a PoW blockchain for the foreseeable future. This means that we will likely see ASIC mining begin to become a force on the Ethereum network while is it still operating on PoW consensus.</p>
</div>
</div>
<div class="sect2 data-line-42">
<h3 id="_casper_ethereums_proof_of_stake_algorithm">Casper: Ethereum&#8217;s Proof-of-Stake Algorithm</h3>
<div class="paragraph data-line-44">
<p>Casper is the proposed name for Ethereum&#8217;s PoS consensus algorithm. It is still under active research and development and is not implemented on the Ethereum blockchain at the time of publication of this book. Casper is being developed in two competing "flavors":</p>
</div>
<div class="ulist data-line-46">
<ul>
<li class="data-line-46">
<p>Casper FFG: "The Friendly Finality Gadget"</p>
</li>
<li class="data-line-47">
<p>Casper CBC: "The Friendly GHOST/Correct-by-Construction"</p>
</li>
</ul>
</div>
<div class="paragraph data-line-49">
<p>Initially, Casper FFG was proposed as a hybrid PoW/PoS algorithm to be implemented as a transition to a more permanent "pure PoS" algorithm. But in June 2018, Vitalik Buterin, who was leading the research work on Casper FFG, decided to "scrap" the hybrid model in favor of a pure PoS algorithm. Now, Casper FFG and Casper CBC are both being developed in parallel. As Vitalik explains:</p>
</div>
<div class="quoteblock data-line-51">
<blockquote>
<div class="paragraph data-line-52">
<p>The main tradeoff between FFG and CBC is that CBC seems to have nicer theoretical properties, but FFG seems to be easier to implement.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-55">
<p>More information about Casper&#8217;s history, ongoing research and future plans can be found at the following links:</p>
</div>
<div class="ulist data-line-57">
<ul>
<li class="data-line-57">
<p><a href="http://bit.ly/2RO5HAl" data-href="http://bit.ly/2RO5HAl">Ethereum Casper (Proof of Stake)</a></p>
</li>
<li class="data-line-58">
<p><a href="http://bit.ly/2FlBojb" data-href="http://bit.ly/2FlBojb">History of Casper, Part 1</a></p>
</li>
<li class="data-line-59">
<p><a href="http://bit.ly/2QyHiic" data-href="http://bit.ly/2QyHiic">History of Casper, Part 2</a></p>
</li>
<li class="data-line-60">
<p><a href="http://bit.ly/2JWWFyt" data-href="http://bit.ly/2JWWFyt">History of Casper, Part 3</a></p>
</li>
<li class="data-line-61">
<p><a href="http://bit.ly/2FsaExI" data-href="http://bit.ly/2FsaExI">History of Casper, Part 4</a></p>
</li>
<li class="data-line-62">
<p><a href="http://bit.ly/2PPhhOv" data-href="http://bit.ly/2PPhhOv">History of Casper, Part 5</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-64">
<h3 id="_principles_of_consensus">Principles of Consensus</h3>
<div class="paragraph data-line-66">
<p>The principles and assumptions of consensus algorithms can be more clearly understood by asking a few key questions:</p>
</div>
<div class="ulist data-line-68">
<ul>
<li class="data-line-68">
<p>Who can change the past, and how? (This is also known as <em>immutability</em>.)</p>
</li>
<li class="data-line-69">
<p>Who can change the future, and how? (This is also known as <em>finality</em>.)</p>
</li>
<li class="data-line-70">
<p>What is the cost to make such changes?</p>
</li>
<li class="data-line-71">
<p>How decentralized is the power to make such changes?</p>
</li>
<li class="data-line-72">
<p>Who will know if something has changed, and how will they know?</p>
</li>
</ul>
</div>
<div class="paragraph data-line-74">
<p>Consensus algorithms are evolving rapidly, attempting to answer these questions in increasingly innovative ways.</p>
</div>
</div>
<div class="sect2 data-line-76">
<h3 id="_controversy_and_competition">Controversy and Competition</h3>
<div class="paragraph data-line-78">
<p>At this point you might be wondering: Why do we need so many different consensus algorithms? Which one works better? The answer to the latter question is at the center of the most exciting area of research in distributed systems of the past decade. It all boils down to what you consider "better&#x201d;&#x2014;which in the context of computer science is about assumptions, goals, and the unavoidable trade-offs.</p>
</div>
<div class="paragraph data-line-80">
<p>It is likely that no  algorithm can optimize across all dimensions of the problem of decentralized consensus. When someone suggests that one consensus algorithm is "better" than the others, you should start asking questions that clarify: Better at what? Immutability, finality, decentralization, cost? There is no clear answer to these questions, at least not yet. Furthermore, the design of consensus algorithms is at the center of a multi-billion-dollar industry and generates enormous controversy and heated arguments. In the end, there might not be a "correct" answer, just as there might be different answers for different applications.</p>
</div>
<div class="paragraph data-line-82">
<p>The entire blockchain industry is one giant experiment where these questions will be tested under adversarial conditions, with enormous monetary value at stake. In the end, history will answer the controversy.</p>
</div>
</div>
<div class="sect2 data-line-84">
<h3 id="_conclusions_4">Conclusions</h3>
<div class="paragraph data-line-31">
<p>Ethereum&#8217;s consensus algorithm is still in flux at the time of completion of this book. In a future edition, we will likely add more detail about Casper and other related technologies as these mature and are deployed on Ethereum. This chapter represents the end of our journey, completing <em>Mastering Ethereum</em>. Additional reference material follows in the appendixes. Thank you for reading this book, and congratulations on reaching the end!</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="ethereum_fork_history">Appendix A: Historique de la fourche Ethereum</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Most hard forks are planned as part of an upgrade roadmap and consist of updates that the community generally agrees to (i.e., there is social consensus). However, some hard forks lack consensus, which leads to multiple distinct blockchains. The events that led to the Ethereum/Ethereum Classic split are one such case, and are discussed in this appendix.</p>
</div>
<div class="sect2 data-line-7">
<h3 id="etc_origin">Ethereum Classic (ETC)</h3>
<div class="paragraph data-line-8">
<p>Ethereum Classic came to be after members of the Ethereum community implemented a time-sensitive hard fork (codenamed &#x201c;DAO&#x201d;). On July 20, 2016, at a block height of 1.92 million, Ethereum introduced an irregular state change via a hard fork in an effort to return approximately 3.6 million ether that had been taken from a smart contract known as The DAO. Almost everyone agreed that the ether taken had been stolen and that leaving it all in the hands of the thief would be of significant detriment to the development of the Ethereum ecosystem as well as the platform itself.</p>
</div>
<div class="paragraph data-line-10">
<p>Returning the ether to its respective owners as though The DAO had never even existed was technically easy, if rather politically controversial. A number of people in the ecosystem disagreed with this change, believing immutability should be a fundamental principle of the Ethereum blockchain without exception; they elected to continue the original chain under the moniker of Ethereum Classic. While the split itself was initially ideological, the two chains have since evolved into separate entities.</p>
</div>
</div>
<div class="sect2 data-line-13">
<h3 id="dao_origin">The Decentralized Autonomous Organization (The DAO)</h3>
<div class="paragraph data-line-15">
<p>The DAO was created by Slock.it, with the aim of providing community-based funding and governance for projects. The core idea was that proposals would be submitted, curators would manage proposals, funds would be raised from investors within the Ethereum community, and, if the projects proved successful, investors would receive a share of the profits.</p>
</div>
<div class="paragraph data-line-17">
<p>The DAO was also one of the first experiments in an Ethereum token. Rather than funding projects directly with ether, participants would trade their ether for DAO tokens, use them to vote on project funding, and later be able to trade them back for ether.</p>
</div>
<div class="paragraph data-line-19">
<p>DAO tokens were available to purchase in a crowdsale that ran from April 5 through April 30, 2016, amassing <a href="https://econ.st/2qfJO1g" data-href="https://econ.st/2qfJO1g">nearly 14%</a> of the total ether in existence, which was worth ~$150 million at the time.</p>
</div>
</div>
<div class="sect2 data-line-22">
<h3 id="dao_reentrancy_bug">The Reentrancy Bug</h3>
<div class="paragraph data-line-24">
<p>On June 9, 2016, developers Peter Vessenes and Chriseth reported that most Ethereum-based contracts that managed funds were potentially <a href="http://bit.ly/2AAaDmA" data-href="http://bit.ly/2AAaDmA">vulnerable to an exploit</a> that could empty contract funds. A few days later, on June 12, Stephen Tual (cofounder of Slock.it) reported that <a href="http://bit.ly/2qmo3g1" data-href="http://bit.ly/2qmo3g1">The DAO&#8217;s code was not vulnerable</a> to the bug described by Peter and Chriseth. Worried DAO contributors breathed a sigh of relief&#x2014;until five days later, when an unknown attacker started <a href="http://bit.ly/2Q7zR1h" data-href="http://bit.ly/2Q7zR1h">draining The DAO</a> using an exploit similar to the one for which the warning had been issued. Ultimately, the DAO attacker siphoned ~3.6 million ether out of The DAO.</p>
</div>
<div class="paragraph data-line-26">
<p>Simultaneously, an assemblage of volunteers calling themselves the Robin Hood Group (RHG) started using the same exploit to withdraw the remaining funds in order to save them from being stolen by the DAO attacker. On June 21, <a href="http://bit.ly/2PtX4xl" data-href="http://bit.ly/2PtX4xl">the RHG announced</a> that they had secured about 70% of The DAO&#8217;s funds (roughly 7.2 million ether), with plans to return it to the community (which they successfully did on the ETC network, and didn&#8217;t need to do on the Ethereum network after the fork). Many thanks and commendations were given to the RHG for their quick thinking and fast actions that helped secure the bulk of the community&#8217;s ether.</p>
</div>
<div class="sect3 data-line-29">
<h4 id="dao_reentrancy_bug_technicals">Technical Details</h4>
<div class="paragraph data-line-30">
<p>While a more detailed and thorough explanation of the bug is given by <a href="http://bit.ly/2EQaLCI" data-href="http://bit.ly/2EQaLCI">Phil Daian</a>, the short explanation is that a crucial function in the DAO had two lines of code in the wrong order, meaning that the attacker could have requests to withdraw ether acted upon repeatedly, before the check of whether the attacker was entitled to the withdrawal was completed. This type of vulnerability is described in <a href="#reentrancy_security">R√©entrance</a>.</p>
</div>
</div>
<div class="sect3 data-line-33">
<h4 id="dao_reentrancy_bug_attack_flow">Attack Flow</h4>
<div class="paragraph data-line-34">
<p>Imagine you had $100 in your bank account and you could bring your bank teller any number of withdrawal slips. The teller would give you money for each slip in order, and only after processing all the slips would they record your withdrawal. What if you brought them three slips, each requesting withdraw $100? What if you brought them three thousand?</p>
</div>
<div class="paragraph data-line-36">
<p>The DAO attack worked like this:</p>
</div>
<div class="olist arabic data-line-38">
<ol class="arabic">
<li class="data-line-38">
<p>The DAO attacker asks the DAO contract to withdraw DAO tokens (DAO).</p>
</li>
<li class="data-line-39">
<p>The attacker asks the contract to withdraw DAO <em>again</em>, before the contract updates its records to show that DAO was withdrawn.</p>
</li>
<li class="data-line-40">
<p>The attacker repeats step 2 as many times as possible.</p>
</li>
<li class="data-line-41">
<p>The contract finally logs a single DAO withdrawal, losing track of the withdrawals that happened in the interim.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2 data-line-44">
<h3 id="dao_hard_fork">The DAO Hard Fork</h3>
<div class="paragraph data-line-45">
<p>Fortunately, there were several safeguards built into The DAO: notably, all withdrawal requests were subject to a 28-day delay. This gave the community a little while to discuss what to do about the exploit, because from roughly June 17&#x2013;July 20 the DAO attacker would be unable to convert their DAO tokens into ether.</p>
</div>
<div class="paragraph data-line-47">
<p>Several developers focused on finding a viable solution, and multiple avenues were explored in this short space of time. Among them were a <a href="http://bit.ly/2qhruEK" data-href="http://bit.ly/2qhruEK"><em>DAO soft fork</em></a>, announced on June 24, to delay DAO withdrawals until consensus was reached, and a <a href="http://bit.ly/2AAGjIu" data-href="http://bit.ly/2AAGjIu"><em>DAO hard fork</em></a>, announced on July 15, to reverse the effects of the DAO attack with an exceptional state change.</p>
</div>
<div class="paragraph data-line-49">
<p>On June 28, developers discovered <a href="http://bit.ly/2zgOxUn" data-href="http://bit.ly/2zgOxUn">a DoS exploit in the DAO soft fork</a>  and concluded that the DAO hard fork would be the only viable option to fully resolve the situation. The DAO hard fork would transfer all ether that had been invested in The DAO into a new refund smart contract, allowing the original owners of the ether to claim full refunds. This provided a solution for returning the hacked funds, but also meant interfering with the balances of specific addresses on the network, however isolated they were. There would also be some leftover ether in portions of The DAO known as <em>childDAOs</em>. A group of trustees would manually authorize the leftover ether, worth <a href="http://bit.ly/2RuUrJh" data-href="http://bit.ly/2RuUrJh">~$6‚Äì7 million</a> at the time.</p>
</div>
<div class="paragraph data-line-51">
<p>With time running out, multiple Ethereum development teams created clients that allowed a user to decide whether they wanted to enable this fork. However, the client creators wanted to decide whether to make this choice opt-in (don&#8217;t fork by default) or opt-out (fork by default). On July 15, a vote was opened on <a href="http://bit.ly/2ABkTuV" data-href="http://bit.ly/2ABkTuV"><em>carbonvote.com</em></a>. The next day, at block height <a href="http://bit.ly/2yHb7Gl" data-href="http://bit.ly/2yHb7Gl">1,894,000</a>, it was closed. Of the <a href="http://bit.ly/2RuUrJh" data-href="http://bit.ly/2RuUrJh">5.5% of the total ether supply</a> that voted, &#x7e;80% of the votes (&#x7e;4.5% of the total ether supply) voted for opt-out. One-quarter of the opt-out vote came from a single address.</p>
</div>
<div class="paragraph data-line-53">
<p>Ultimately the decision became opt-out, so those who opposed the DAO hard fork would need to explicitly state their opposition by changing a configuration option in the software they were running.</p>
</div>
<div class="paragraph data-line-55">
<p>On July 20, at block height <a href="http://bit.ly/2zfaIKB" data-href="http://bit.ly/2zfaIKB">1,920,000</a>, Ethereum <a href="http://bit.ly/2yJxZ83" data-href="http://bit.ly/2yJxZ83">implemented the DAO hard fork</a> and thus two Ethereum networks were created: one including the state change, and the other ignoring it.</p>
</div>
<div class="paragraph data-line-57">
<p>When the DAO hard-forked Ethereum (present-day Ethereum) gained a majority of the mining power, many assumed that consensus was achieved and the minority chain would fade away, as in previous forks. Despite this, a sizable portion of the Ethereum community (roughly 10% by value and mining power) started supporting the non-forked chain, which came to be known as Ethereum Classic.</p>
</div>
<div class="paragraph data-line-59">
<p>Within days of the fork, several exchanges began to list both Ethereum ("ETH") and Ethereum Classic ("ETC"). Due to the nature of hard forks, all Ethereum users holding ether at the time of the split then held funds on both of the chains, and a market value for ETC was soon established with <a href="http://bit.ly/2qhuNvP" data-href="http://bit.ly/2qhuNvP">Poloniex</a> listing ETC on July 24.</p>
</div>
<div class="sect3 data-line-62">
<h4 id="dao_hard_fork_timeline">Timeline of the DAO Hard Fork</h4>
<div class="ulist data-line-64">
<ul>
<li class="data-line-64">
<p>April 5, 2016: Slock.it <a href="http://bit.ly/2Db4boE" data-href="http://bit.ly/2Db4boE">releases a security review</a> of the generic DAO framework smart contracts by Deja Vu Security.</p>
</li>
<li class="data-line-65">
<p>April 30, 2016: The DAO crowdsale <a href="http://bit.ly/2qhwhpI" data-href="http://bit.ly/2qhwhpI">launches</a>.</p>
</li>
<li class="data-line-66">
<p>May 27, 2016: The DAO crowdsale ends.</p>
</li>
<li class="data-line-67">
<p>June 9, 2016: A generic <a href="http://bit.ly/2AAaDmA" data-href="http://bit.ly/2AAaDmA">recursive call bug</a> is discovered and believed to affect many Solidity contracts that track users' balances.</p>
</li>
<li class="data-line-68">
<p>June 12, 2016: Stephen Tual <a href="http://bit.ly/2qmo3g1" data-href="http://bit.ly/2qmo3g1">declares</a> that The DAO&#8217;s funds are not at risk.</p>
</li>
<li class="data-line-69">
<p>June 17, 2016: <a href="http://bit.ly/2EQaLCI" data-href="http://bit.ly/2EQaLCI">The DAO is exploited</a> and a variant of the discovered bug (termed the "reentrancy bug") is used to start draining the funds, eventually nabbing ~30% of the ether.</p>
</li>
<li class="data-line-70">
<p>June 21, 2016: The RHG <a href="http://bit.ly/2zgl3Gk" data-href="http://bit.ly/2zgl3Gk">announces</a> it has secured the other ~70% of the ether stored within The DAO.</p>
</li>
<li class="data-line-71">
<p>June 24, 2016: A <a href="http://bit.ly/2qhruEK" data-href="http://bit.ly/2qhruEK">soft fork vote</a> is announced via opt-in signaling through Geth and Parity clients, designed to temporarily withhold funds until the community can better decide what to do.</p>
</li>
<li class="data-line-72">
<p>June 28, 2016: A <a href="http://bit.ly/2zgOxUn" data-href="http://bit.ly/2zgOxUn">vulnerability</a> is discovered in the soft fork and it&#8217;s abandoned.</p>
</li>
<li class="data-line-73">
<p>June 28, 2016 to July 15: Users debate whether or not to hard fork; most of the vocal public debate occurs on the <em>/r/ethereum</em> subreddit.</p>
</li>
<li class="data-line-74">
<p>July 15, 2016: The <a href="http://bit.ly/2qmo3g1" data-href="http://bit.ly/2qmo3g1">DAO hard fork</a> is proposed, to return the funds taken in the DAO attack.</p>
</li>
<li class="data-line-75">
<p>July 15, 2016: A <a href="http://bit.ly/2ABkTuV" data-href="http://bit.ly/2ABkTuV">vote is held</a> on CarbonVote to decide if the DAO hard fork will be opt-in (don&#8217;t fork by default) or opt-out (fork by default).</p>
</li>
<li class="data-line-76">
<p>July 16, 2016: <a href="http://bit.ly/2RuUrJh" data-href="http://bit.ly/2RuUrJh">5.5% of the total ether supply votes</a>; ~80% of the votes (~4.5% of the total supply) are pro the opt-out hard fork, with one-quarter of the pro-vote coming from a single address.</p>
</li>
<li class="data-line-77">
<p>July 20, 2016: The <a href="http://bit.ly/2yJxZ83" data-href="http://bit.ly/2yJxZ83">hard fork</a> occurs at block 1,920,000.</p>
</li>
<li class="data-line-78">
<p>July 20, 2016: Those against the DAO hard fork continue running the old client software; this leads to issues with <a href="http://bit.ly/2qjJm27" data-href="http://bit.ly/2qjJm27">transactions being replayed on both chains</a>.</p>
</li>
<li class="data-line-79">
<p>July 24, 2016: <a href="http://bit.ly/2qhuNvP" data-href="http://bit.ly/2qhuNvP">Poloniex lists</a> the original Ethereum chain under the ticker symbol ETC; it&#8217;s the first exchange to do so.</p>
</li>
<li class="data-line-80">
<p>August 10, 2016: The RHG <a href="http://bit.ly/2JrLpK2" data-href="http://bit.ly/2JrLpK2">transfers 2.9</a> million of the recovered ETC to Poloniex in order to convert it to ETH on the advice of Bity SA; 14% of the total RHG holdings are converted from ETC to ETH and other cryptocurrencies, and <a href="http://bit.ly/2ETDdUc" data-href="http://bit.ly/2ETDdUc">Poloniex freezes</a> the other 86% of deposited ETH.</p>
</li>
<li class="data-line-81">
<p>August 30, 2016: The frozen funds are sent by Poloniex back to the RHG, which then sets up a refund contract on the ETC chain.</p>
</li>
<li class="data-line-82">
<p>December 11, 2016: IOHK&#8217;s ETC development team forms, led by Ethereum founding member Charles Hoskinson.</p>
</li>
<li class="data-line-83">
<p>January 13, 2017: The ETC network is updated to resolve transaction replay issues; the chains are now functionally separate.</p>
</li>
<li class="data-line-84">
<p>February 20, 2017: The ETCDEVTeam forms, led by early ETC developer Igor Artamonov (splix).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 data-line-87">
<h3 id="eth_etc_differences">Ethereum and Ethereum Classic</h3>
<div class="paragraph data-line-89">
<p>While the initial split was centered around The DAO, the two networks, Ethereum and Ethereum Classic, are now separate projects, although most development is still done by the Ethereum community and simply ported to Ethereum Classic codebases. Nevertheless, the full set of differences is constantly evolving and too extensive to cover in this appendix. However, it is worth noting that the chains do differ significantly in their core development and community structure. A few of the technical differences are discussed next.</p>
</div>
<div class="sect3 data-line-93">
<h4 id="eth_etc_differences_evm">The EVM</h4>
<div class="paragraph data-line-94">
<p>For the most part (at the time of writing), the two networks remain highly compatible: contract code produced for one chain runs as expected on the other; but there are some small differences in EVM OPCODES (see EIPs <a href="http://bit.ly/2yIajkF" data-href="http://bit.ly/2yIajkF">140</a>, <a href="http://bit.ly/2qhKz9Y" data-href="http://bit.ly/2qhKz9Y">145</a>, and <a href="http://bit.ly/2SxsrFR" data-href="http://bit.ly/2SxsrFR">214</a>).</p>
</div>
</div>
<div class="sect3 data-line-97">
<h4 id="eth_etc_differences_core_development">Core Network Development</h4>
<div class="paragraph data-line-98">
<p>Being open projects, blockchain platforms often have many users and contributors. However, the core network development (i.e., of the code that runs the network) is often done by small groups due to the expertise and knowledge required to develop this type of software. On Ethereum, this work is done by the Ethereum Foundation and volunteers. On Ethereum Classic, it&#8217;s done by ETCDEV, IOHK, and volunteers.</p>
</div>
</div>
</div>
<div class="sect2 data-line-101">
<h3 id="ethereum_forks">Other Notable Ethereum Forks</h3>
<div class="paragraph data-line-103">
<p><a href="https://ellaism.org/about/" data-href="https://ellaism.org/about/">Ellaism</a> is an Ethereum-based network that intends to use PoW exclusively to secure the blockchain. It has no pre-mine and no mandatory developer fees, with all support and development donated freely by the community. Its developers believe this makes theirs &#x201c;one of the most honest pure Ethereum projects,&#x201d; and one that is &#x201c;uniquely interesting as a platform for serious developers, educators, and enthusiasts. Ellaism is a pure smart contract platform. Its goal is to create a smart contract platform that is both fair and trustworthy.&#x201d; The principles of the platform are as follows:</p>
</div>
<div class="quoteblock data-line-105">
<blockquote>
<div class="ulist data-line-106">
<ul>
<li class="data-line-106">
<p>All changes and upgrades to the protocol should strive to maintain and reinforce these Principles of Ellaism.</p>
</li>
<li class="data-line-107">
<p>Monetary Policy: 280 million coins.</p>
</li>
<li class="data-line-108">
<p>No Censorship: Nobody should be able to prevent valid txs from being confirmed.</p>
</li>
<li class="data-line-109">
<p>Open-Source: Ellaism source code should always be open for anyone to read, modify, copy, share.</p>
</li>
<li class="data-line-110">
<p>Permissionless: No arbitrary gatekeepers should ever prevent anybody from being part of the network (user, node, miner, etc).</p>
</li>
<li class="data-line-111">
<p>Pseudonymous: No ID should be required to own, use Ellaism.</p>
</li>
<li class="data-line-112">
<p>Fungible: All coins are equal and should be equally spendable.</p>
</li>
<li class="data-line-113">
<p>Irreversible Transactions: Confirmed blocks should be set in stone. Blockchain History should be immutable.</p>
</li>
<li class="data-line-114">
<p>No Contentious Hard Forks: Never hard fork without consensus from the whole community. Only break the existing consensus when necessary.</p>
</li>
<li class="data-line-115">
<p>Many feature upgrades can be carried out without a hard fork, such as improving the performance of the EVM.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph data-line-118">
<p>Several other forks have occurred on Ethereum as well. Some of these are hard forks, in the sense that they split directly off of the preexisting Ethereum network. Others are software forks: they use Ethereum&#8217;s client/node software but run entirely separate networks without any history shared with Ethereum. There will likely be more forks over the life of Ethereum.</p>
</div>
<div class="paragraph data-line-120">
<p>There are also several other projects that claim to be Ethereum forks but are actually based on ERC20 tokens and run on the Ethereum network. Two examples of these are EtherBTC (ETHB) and Ethereum Modification (EMOD). These are not forks in the traditional sense, and may sometimes be called &#x201c;airdrops.&#x201d;</p>
</div>
<div class="paragraph data-line-122">
<p>Here&#8217;s a brief rundown of some of the more notable forks that have occurred:</p>
</div>
<div class="ulist data-line-124">
<ul>
<li class="data-line-124">
<p><em>Expanse</em> was the first fork of the Ethereum blockchain to gain traction. It was announced via the Bitcoin Talk forum on September 7, 2015. The actual fork occurred a week later on September 14, 2015, at a block height of 800,000. It was originally founded by Christopher Franko and James Clayton. Their stated vision was to create an advanced chain for: "identity, governance, charity, commerce, and equity".</p>
</li>
<li class="data-line-125">
<p><em>EthereumFog</em> (ETF) was launched on December 14, 2017, and forked at a block height of 4,730,660. The project&#8217;s stated aim is to develop "world decentralized fog computing" by focusing on fog computing and decentralized storage. There is still little information on what this will actually entail.</p>
</li>
<li class="data-line-126">
<p><em>EtherZero</em> (ETZ) was launched on January 19, 2018, at a block height of 4,936,270. Its notable innovations were the introduction of a masternode architecture and the removal of transaction fees for smart contracts to enable a wider diversity of DApps. There has been some criticism from some prominent members of the Ethereum community, MyEtherWallet, and MetaMask, due to the lack of clarity surrounding development and some accusations of possible phishing.</p>
</li>
<li class="data-line-127">
<p><em>EtherInc</em> (ETI) was launched on February 13, 2018, at a block height of 5,078,585, with a focus on building decentralized organizations. Stated goals include the reduction of block times, increased miner rewards, the removal of uncle rewards, and setting a cap on mineable coins. EtherInc uses the same private keys as Ethereum and has implemented replay protection to protect ether on the original non-forked chain.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="ethereum_standards">Appendix B: Normes Ethereum</h2>
<div class="sectionbody">
<div class="sect2 data-line-6">
<h3 id="eips">Ethereum Improvement Proposals (EIPs)</h3>
<div class="paragraph data-line-8">
<p>The Ethereum Improvement Proposal repository is located at <a href="https://github.com/ethereum/EIPs/" class="undefined" data-href="https://github.com/ethereum/EIPs/">https://github.com/ethereum/EIPs/</a>. The workflow is illustrated in <a href="#eip_workflow">Ethereum Improvement Proposal workflow</a>.</p>
</div>
<div class="paragraph data-line-10">
<p>From <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1.md" data-href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1.md">EIP-1</a>:</p>
</div>
<div class="quoteblock data-line-12">
<blockquote>
<div class="paragraph data-line-13">
<p>EIP stands for Ethereum Improvement Proposal. An EIP is a design document providing information to the Ethereum community, or describing a new feature for Ethereum or its processes or environment. The EIP should provide a concise technical specification of the feature and a rationale for the feature. The EIP author is responsible for building consensus within the community and documenting dissenting opinions.</p>
</div>
</blockquote>
</div>
<div id="eip_workflow" class="imageblock data-line-18">
<div class="content">
<img src="images/eip_workflow.png" alt="Ethereum Improvement Proposal Workflow">
</div>
<div class="title">Figure 58. Ethereum Improvement Proposal workflow</div>
</div>
</div>
<div class="sect2 data-line-21">
<h3 id="eip_table">Table of Most Important EIPs and ERCs</h3>
<table class="tableblock frame-all grid-all stretch data-line-25">
<caption class="title">Table 8. Important EIPs and ERCs</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">EIP/ERC #</th>
<th class="tableblock halign-left valign-top">Title/Description</th>
<th class="tableblock halign-left valign-top">Author</th>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Created</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OVq6qa" data-href="http://bit.ly/2OVq6qa">EIP-1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIP Purpose and Guidelines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Martin Becze, Hudson Jameson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Meta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yJtTNa" data-href="http://bit.ly/2yJtTNa">EIP-2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Homestead Hard-fork Changes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Jrx93V" data-href="http://bit.ly/2Jrx93V">EIP-5</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gas Usage for <code>RETURN</code> and <code>CALL*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OYbc2t" data-href="http://bit.ly/2OYbc2t">EIP-6</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renaming SUICIDE Opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hudson Jameson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2JxdBeN" data-href="http://bit.ly/2JxdBeN">EIP-7</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELEGATECALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Q6Oly6" data-href="http://bit.ly/2Q6Oly6">EIP-8</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">devp2p Forward Compatibility Requirements for Homestead</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Felix Lange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Networking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CUf7WG" data-href="http://bit.ly/2CUf7WG">EIP-20</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC-20 Token Standard. Describes standard functions a token contract may implement to allow DApps and wallets to handle tokens across multiple interfaces/DApps. Methods include: <code>totalSupply</code>, balanceOf(address), <code>transfer</code>, <code>transferFrom</code>, <code>approve</code>, <code>allowance</code>. Events include: <code>Transfer</code> (triggered when tokens are transferred), <span class="keep-together"><code>Approval</code></span> (triggered when <code>approve</code> is called).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fabian Vogelsteller, Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frontier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Q6R4YB" data-href="http://bit.ly/2Q6R4YB">EIP-55</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mixed-case checksum address encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OgE5la" data-href="http://bit.ly/2OgE5la">EIP-86</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstraction of transaction origin and signature. Sets the stage for "abstracting out" account security and allowing users to create "account contracts," moving toward a model where in the long term all accounts are contracts that can pay for gas, and users are free to define their own security models that perform any desired signature verification and nonce checks (instead of using the in-protocol mechanism where ECDSA and the default nonce scheme are the only "standard" way to secure an account, which is currently hardcoded into transaction processing).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deferred (to be replaced)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constantinople</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2QedSFC" data-href="http://bit.ly/2QedSFC">EIP-96</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blockhash and state root changes. Stores blockhashes in the state to reduce protocol complexity and need for complex client implementations to process the <code>BLOCKHASH</code> opcode. Extends range of how far back blockhash checking may go, with the side effect of creating direct links between blocks with very distant block numbers to facilitate much more efficient initial light client syncing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deferred</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constantinople</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2AC05DM" data-href="http://bit.ly/2AC05DM">EIP-100</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change difficulty adjustment to target mean block time and including uncles.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Jr1zDv" data-href="http://bit.ly/2Jr1zDv">EIP-101</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity Currency and Crypto Abstraction. Abstracts ether up a level with the benefit of allowing ether and subtokens to be treated similarly by contracts, reduces the level of indirection required for custom-policy accounts such as multisigs, and purifies the underlying Ethereum protocol by reducing the minimal consensus implementation complexity.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity feature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity Casper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Q5sdEv" data-href="http://bit.ly/2Q5sdEv">EIP-105</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary sharding plus contract calling semantics. "Sharding scaffolding" EIP to allow Ethereum transactions to be parallelized using a binary tree sharding mechanism, and to set the stage for a later sharding scheme. Research in progress; see <a href="https://github.com/ethereum/sharding" class="undefined" data-href="https://github.com/ethereum/sharding">https://github.com/ethereum/sharding</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity feature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serenity Casper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yG2Dzi" data-href="http://bit.ly/2yG2Dzi">EIP-137</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethereum Domain Name Service - Specification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nick Johnson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yJtWZm" data-href="http://bit.ly/2yJtWZm">EIP-140</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New Opcode: REVERT. Adds <code>REVERT</code> opcode instruction, which stops execution and rolls back the EVM execution state changes without consuming all provided gas (instead the contract only has to pay for memory) or losing logs, and returns to the caller a pointer to the memory location with the error code or message.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Beregszaszi, Nikolai Mushegian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CQMXfe" data-href="http://bit.ly/2CQMXfe">EIP-141</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated invalid EVM instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Beregszaszi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qhKz9Y" data-href="http://bit.ly/2qhKz9Y">EIP-145</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise shifting instructions in EVM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Beregszaszi, Pawe≈Ç Bylica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deferred</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qhxflQ" data-href="http://bit.ly/2qhxflQ">EIP-150</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gas cost changes for IO-heavy operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CQUgne" data-href="http://bit.ly/2CQUgne">EIP-155</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple replay attack protection. Replay Attack allows any transaction using a pre-EIP-155 Ethereum node or client to become signed so it is valid and executed on both the Ethereum and Ethereum Classic chains.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Homestead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2JryBmT" data-href="http://bit.ly/2JryBmT">EIP-158</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State clearing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superseded</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR6VGY" data-href="http://bit.ly/2CR6VGY">EIP-160</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXP cost increase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OfU96M" data-href="http://bit.ly/2OfU96M">EIP-161</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State trie clearing (invariant-preserving alternative)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Wood</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2JxdKil" data-href="http://bit.ly/2JxdKil">EIP-162</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial ENS Hash Registrar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maurelian, Nick Johnson, Alex Van de Sande</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OgsOkO" data-href="http://bit.ly/2OgsOkO">EIP-165</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC-165 Standard Interface Detection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Reitwiessner et al.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OgCWu1" data-href="http://bit.ly/2OgCWu1">EIP-170</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract code size limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2ERNv7g" data-href="http://bit.ly/2ERNv7g">EIP-181</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENS support for reverse resolution of Ethereum addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nick Johnson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2P0wPz5" data-href="http://bit.ly/2P0wPz5">EIP-190</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethereum Smart Contract Packaging Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Piper Merriam et al.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2SwNQiz" data-href="http://bit.ly/2SwNQiz">EIP-196</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precompiled contracts for addition and scalar multiplication on the elliptic curve alt_bn128. Required in order to perform zkSNARK verification within the block gas limit.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2ETDC9a" data-href="http://bit.ly/2ETDC9a">EIP-197</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precompiled contracts for optimal ate pairing check on the elliptic curve alt_bn128. Combined with EIP-196.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin, Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2DdTCRN" data-href="http://bit.ly/2DdTCRN">EIP-198</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Big integer modular exponentiation. Precompile enabling RSA signature verification and other cryptographic applications.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qjYJr3" data-href="http://bit.ly/2qjYJr3">EIP-211</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New opcodes: <code>RETURNDATASIZE</code> and <code>RETURNDATACOPY</code>. Adds support for returning variable-length values inside the EVM with simple gas charging and minimal change to calling opcodes using new opcodes <code>RETURNDATASIZE</code> and <code>RETURNDATACOPY</code>. Handles similar to existing <code>calldata</code>, whereby after a call, return data is kept inside a virtual buffer from which the caller can copy it (or parts thereof) into memory, and upon the next call, the buffer is overwritten.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OgV0Eb" data-href="http://bit.ly/2OgV0Eb">EIP-214</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New opcode: <code>STATICCALL</code>. Permits non-state-changing calls to itself or other contracts while disallowing any modifications to state during the call (and its subcalls, if present) to increase smart contract security and assure developers that re-entrancy bugs cannot arise from the call. Calls the child with <code>STATIC</code> flag set to <code>true</code> for execution of child, causing exception to be thrown upon any attempts to make state-changing operations inside an execution instance where <code>STATIC</code> is <code>true</code>, and resets flag once call returns.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vitalik Buterin, Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2JssHlJ" data-href="http://bit.ly/2JssHlJ">EIP-225</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rinkeby testnet using proof of authority where blocks are only mined by trusted signers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P√©ter Szil√°gyi</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Homestead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yPBavd" data-href="http://bit.ly/2yPBavd">EIP-234</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add <code>blockHash</code> to JSON-RPC filter options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micah Zoltu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2yKrBNM" data-href="http://bit.ly/2yKrBNM">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subroutines and Static Jumps for the EVM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greg Colvin, Pawe≈Ç Bylica, Christian Reitwiessner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2AzGX99" data-href="http://bit.ly/2AzGX99">EIP-616</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIMD Operations for the EVM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greg Colvin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qjYX1n" data-href="http://bit.ly/2qjYX1n">EIP-681</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL Format for Transaction Requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel A. Nagy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2OYgE5n" data-href="http://bit.ly/2OYgE5n">EIP-649</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Difficulty Bomb Delay and Block Reward Reduction. Delayed the Ice Age (aka Difficulty Bomb) by 1 year, and reduced the block reward from 5 to 3 ether.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Afri Schoedon, Vitalik Buterin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2RoGCvH" data-href="http://bit.ly/2RoGCvH">EIP-658</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Embedding transaction status code in receipts. Fetches and embeds a status field indicative of success or failure state to transaction receipts for callers, as it&#8217;s no longer possible to assume the transaction failed if and only if it consumed all gas after the introduction of the <code>REVERT</code> opcode in EIP-140.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nick Johnson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metropolis Byzantinium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Ogwpzs" data-href="http://bit.ly/2Ogwpzs">EIP-706</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEVp2p snappy compression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P√©ter Szil√°gyi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Networking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2AAkCIP" data-href="http://bit.ly/2AAkCIP">EIP-721</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC-721 Non-Fungible Token Standard. A standard API that allows smart contracts to operate as unique tradable non-fungible tokens (NFTs) that may be tracked in standardized wallets and traded on exchanges as assets of value, similar to ERC20. CryptoKitties was the first popularly adopted implementation of a digital NFT in the Ethereum ecosystem.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">William Entriken, Dieter Shirley, Jacob Evans, Nastassia Sachs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2qmuDmJ" data-href="http://bit.ly/2qmuDmJ">EIP-758</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscriptions and filters for completed transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jack Peterson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2RnqlHy" data-href="http://bit.ly/2RnqlHy">EIP-801</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC-801 Canary Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ligi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2DdTKkf" data-href="http://bit.ly/2DdTKkf">EIP-827</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC827 Token Standard. An extension of the standard interface ERC20 for tokens with methods that allow the execution of calls inside transfer and approvals. This standard provides basic functionality to transfer tokens, as well as allowing tokens to be approved so they can be spent by another on-chain third party. Also, it allows the developer to execute calls on transfers and approvals.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Augusto Lemble</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2Jq2hAM" data-href="http://bit.ly/2Jq2hAM">EIP-930</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC930 Eternal Storage. The ES (Eternal Storage) contract is owned by an address that has write permissions. The storage is public, which means everyone has read permissions. It stores the data in mappings, using one mapping per type of variable. The use of this contract allows the developer to migrate the storage easily to another contract if needed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Augusto Lemble</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="evm_opcodes">Appendix C: Opcodes Ethereum EVM et consommation de gaz</h2>
<div class="sectionbody">
<div class="paragraph data-line-5">
<p>This appendix is based on the consolidation work done by the people of <a href="https://github.com/trailofbits/evm-opcodes" class="undefined" data-href="https://github.com/trailofbits/evm-opcodes">https://github.com/trailofbits/evm-opcodes</a> as a reference for Ethereum VM (EVM) opcodes and instruction information licensed under the <a href="http://bit.ly/2zfrv0b" data-href="http://bit.ly/2zfrv0b">Apache License 2.0</a>.</p>
</div>
<table id="evm_opcodes_table" class="tableblock frame-all grid-all stretch data-line-10">
<caption class="title">Table 9. EVM opcodes and gas cost</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Opcode</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Extra info</th>
<th class="tableblock halign-left valign-top">Gas</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halts execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x01</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addition operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x02</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x03</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtraction operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer division operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x05</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDIV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed integer division operation (truncated)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x06</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo remainder operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x07</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed modulo remainder operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x08</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDMOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo addition operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x09</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULMOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo multiplication operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exponential operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10***</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIGNEXTEND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extend length of two&#8217;s complement signed integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0c</code> - <code>0x0f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less-than comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater-than comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed less-than comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SGT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed greater-than comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equality comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISZERO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple NOT operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise AND operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise OR operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x18</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise XOR operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x19</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise NOT operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x1a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BYTE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve single byte from word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x1b</code> - <code>0x1f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHA3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Keccak-256 hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x21</code> - <code>0x2f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get address of currently executing account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BALANCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get balance of the given account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORIGIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get execution origination address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x33</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get caller address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x34</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLVALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get deposited value by the instruction/transaction responsible for this execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x35</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLDATALOAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get input data of current environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x36</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLDATASIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get size of input data in current environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x37</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLDATACOPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy input data in current environment to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x38</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CODESIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get size of code running in current environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x39</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CODECOPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy code running in current environment to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GASPRICE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get price of gas in current environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXTCODESIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get size of an account&#8217;s code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXTCODECOPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy an account&#8217;s code to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETURNDATASIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pushes the size of the return data buffer onto the stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2zaBcNe" data-href="http://bit.ly/2zaBcNe">EIP-211</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETURNDATACOPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copies data from the return data buffer to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2zaBcNe" data-href="http://bit.ly/2zaBcNe">EIP-211</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x40</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLOCKHASH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the hash of one of the 256 most recent complete blocks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x41</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COINBASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s beneficiary address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x42</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x43</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NUMBER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x44</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIFFICULTY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s difficulty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x45</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GASLIMIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the block&#8217;s gas limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x46</code> - <code>0x4f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x50</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove word from stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x51</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MLOAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load word from memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x52</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSTORE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save word to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x53</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSTORE8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save byte to memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x54</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLOAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load word from storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x55</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSTORE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save word to storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x56</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alter the program counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x57</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditionally alter the program counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x58</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GETPC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the value of the program counter prior to the increment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x59</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the size of active memory in bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x5a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the amount of available gas, including the corresponding reduction in the amount of available gas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x5b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPDEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a valid destination for jumps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x5c</code> - <code>0x5f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x60</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 1-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x61</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 2-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x62</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 3-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x63</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 4-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x64</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 5-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x65</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 6-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x66</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 7-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x67</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 8-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x68</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 9-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x69</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 10-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 11-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 12-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 13-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 14-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 15-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x6f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 16-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x70</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 17-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x71</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 18-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x72</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 19-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 20-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x74</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 21-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x75</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 22-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x76</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 23-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x77</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 24-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x78</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 25-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x79</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 26-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 27-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 28-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 29-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 30-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 31-byte item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place 32-byte (full word) item on stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 1st stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x81</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 2nd stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x82</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 3rd stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x83</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 4th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x84</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 5th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x85</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 6th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x86</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 7th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x87</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 8th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x88</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 9th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x89</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 10th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 11th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 12th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 13th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 14th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 15th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUP16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate 16th stack item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x90</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 2nd stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x91</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 3rd stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x92</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 4th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x93</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 5th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x94</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 6th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x95</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 7th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x96</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 8th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x97</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 9th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x98</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 10th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x99</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 11th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 12th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 13th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 14th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 15th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 16th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x9f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWAP16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange 1st and 17th stack items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with no topics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">375</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with one topic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with two topics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1125</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with three topics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Append log record with four topics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1875</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xa5</code> - <code>0xaf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPTO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative <a href="http://bit.ly/2Sx2Vkg" data-href="http://bit.ly/2Sx2Vkg">libevmasm has different numbers</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP 615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPSUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUMPSUBV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEGINSUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEGINDATA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETURNSUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUTLOCAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xba</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GETLOCA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tentative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/2CR77pu" data-href="http://bit.ly/2CR77pu">EIP-615</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xbb</code> - <code>0xe0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xe1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLOADBYTES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only referenced in pyethereum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xe2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSTOREBYTES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only referenced in pyethereum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xe3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only referenced in pyethereum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xe4</code> - <code>0xef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new account with associated code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-call into an account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complicated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLCODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-call into this account with alternative account&#8217;s code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complicated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETURN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halt execution returning output data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELEGATECALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-call into this account with an alternative account&#8217;s code, but persisting into this account with an alternative account&#8217;s code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complicated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALLBLACKBOX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf6</code> - <code>0xf9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STATICCALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to CALL, but does not modify state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new account and set creation address to <code>sha3(sender + sha3(init code)) % 2**160</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TXEXECGAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not in yellow paper FIXME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REVERT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop execution and revert state changes, without consuming all provided gas and providing a reason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfe</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INVALID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated invalid instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELFDESTRUCT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halt execution and register account for later deletion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000*</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="dev_tools_frameworks">Appendix D: Outils de d√©veloppement, cadres de d√©veloppement, <span class="keep-together">et biblioth√®ques</span></h2>
<div class="sectionbody">
<div class="sect2 data-line-5">
<h3 id="_frameworks">Frameworks</h3>
<div class="paragraph data-line-7">
<p>Frameworks can be used to ease Ethereum smart contract development. By doing everything yourself you get a better understanding of how everything fits together, but it&#8217;s a lot of tedious, repetitive work. The frameworks described in this section can automate certain tasks and make development easier.</p>
</div>
<div class="sect3 data-line-10">
<h4 id="truffle">Truffle</h4>
<div class="paragraph data-line-12">
<p>GitHub: <a href="https://github.com/trufflesuite/truffle" class="undefined" data-href="https://github.com/trufflesuite/truffle">https://github.com/trufflesuite/truffle</a></p>
</div>
<div class="paragraph data-line-14">
<p>Website: <a href="https://truffleframework.com" class="undefined" data-href="https://truffleframework.com">https://truffleframework.com</a></p>
</div>
<div class="paragraph data-line-16">
<p>Documentation: <a href="https://truffleframework.com/docs" class="undefined" data-href="https://truffleframework.com/docs">https://truffleframework.com/docs</a></p>
</div>
<div class="paragraph data-line-18">
<p>Truffle Boxes: <a href="http://truffleframework.com/boxes/" class="undefined" data-href="http://truffleframework.com/boxes/">http://truffleframework.com/boxes/</a></p>
</div>
<div class="paragraph data-line-20">
<p>npm package repository: <a href="https://www.npmjs.com/package/truffle" class="undefined" data-href="https://www.npmjs.com/package/truffle">https://www.npmjs.com/package/truffle</a></p>
</div>
<div class="sect4 data-line-24">
<h5 id="installing_truffle">Installing the Truffle framework</h5>
<div class="paragraph data-line-26">
<p>The Truffle framework comprises several Node.js packages. Before you install truffle, you need to have an up-to-date and working installation of Node.js and the Node Package Manager (npm).</p>
</div>
<div class="paragraph data-line-28">
<p>The recommended way to install Node.js and npm is to use the Node Version Manager (nvm). Once you install nvm, it will handle all the dependencies and updates for you. Follow the instructions found at <a href="http://nvm.sh" class="undefined" data-href="http://nvm.sh">http://nvm.sh</a>.</p>
</div>
<div class="paragraph data-line-30">
<p>Once nvm is installed on your operating system, installing Node.js is simple. Use the --lts flag to tell nvm that you want the most recent &#x201c;long-term support&#x201d; (LTS) version of Node.js:</p>
</div>
<pre data-type="programlisting">
$ <strong>nvm install --lts</strong>
</pre>
<div class="paragraph data-line-38">
<p>Confirm you have node and npm installed:</p>
</div>
<pre data-type="programlisting">
$ <strong>node -v</strong>
v8.9.4
$ <strong>npm -v</strong>
5.6.0
</pre>
<div class="paragraph data-line-49">
<p>Next, create a hidden file, <em>.nvmrc</em>, that contains the Node.js version supported by your DApp so developers just need to run <code>nvm install</code> in the root of the project directory and it will automatically install and switch to using that version:</p>
</div>
<pre data-type="programlisting">
$ <strong>node -v &gt; .nvmrc</strong>
$ <strong>nvm install</strong>
</pre>
<div class="paragraph data-line-58">
<p>Looking good. Now to install truffle:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm -g install truffle</strong>

+ truffle@4.0.6
installed 1 package in 37.508s
</pre>
</div>
<div class="sect4 data-line-70">
<h5 id="truffle_box">Integrating a prebuilt Truffle project (Truffle Box)</h5>
<div class="paragraph data-line-72">
<p>If you want to use or create a DApp that builds upon prebuilt boilerplate, go to the Truffle Boxes website, choose an existing Truffle project, and then run the following command to download and extract it:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle unbox <em>BOX_NAME</em></strong>
</pre>
</div>
<div class="sect4 data-line-81">
<h5 id="truffle_project_directory">Creating a truffle project directory</h5>
<div class="paragraph data-line-83">
<p>For each project where you will use truffle, create a project directory and initialize truffle within that directory. truffle will create the necessary directory structure inside your project directory. It&#8217;s customary to give the project directory a name that describes the project. For this example, we will use truffle to deploy our Faucet contract from <a href="#simple_contract_example">[simple_contract_example]</a>, and therefore we will name the project folder <em>Faucet</em>:</p>
</div>
<pre data-type="programlisting">
$ <strong>mkdir Faucet</strong>
$ <strong>cd Faucet</strong>
Faucet $
</pre>
<div class="paragraph data-line-93">
<p>Once inside the <em>Faucet</em> directory, we initialize truffle:</p>
</div>
<pre data-type="programlisting">
Faucet $ <strong>truffle init</strong>
</pre>
<div class="paragraph data-line-101">
<p>truffle creates a directory structure and some default files:</p>
</div>
<div class="listingblock data-line-103">
<div class="content">
<pre>Faucet
+---- contracts
|   `---- Migrations.sol
+---- migrations
|   `---- 1_initial_migration.js
+---- test
+---- truffle-config.js
`---- truffle.js</pre>
</div>
</div>
<div class="paragraph data-line-114">
<p>We will also use a number of JavaScript (Node.js) support packages, in addition to truffle itself. We can install these with npm. We initialize the npm directory structure and accept the defaults suggested by npm:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm init</strong>

package name: (faucet)
version: (1.0.0)
description:
entry point: (truffle-config.js)
test command:
git repository:
keywords:
author:
license: (ISC)
About to write to Faucet/package.json:

{
  "name": "faucet",
  "version": "1.0.0",
  "description": "",
  "main": "truffle-config.js",
  "directories": {
    "test": "test"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "",
  "license": "ISC"
}


Is this ok? (yes)
</pre>
<div class="paragraph data-line-151">
<p>Now, we can install the dependencies that we will use to make working with truffle easier:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm install dotenv truffle-wallet-provider ethereumjs-wallet</strong>
</pre>
<div class="paragraph data-line-159">
<p>We now have a <em>node_modules</em> directory with several thousand files inside our <em>Faucet</em> directory.</p>
</div>
<div class="paragraph data-line-161">
<p>Prior to deploying a DApp to a cloud production or continuous integration environment, it is important to specify the engines field so that your DApp is built with the correct Node.js version and its associated dependencies are installed. For details on configuring this field, see the <a href="http://bit.ly/2zp2GPF" data-href="http://bit.ly/2zp2GPF">documentation</a>.</p>
</div>
</div>
<div class="sect4 data-line-163">
<h5 id="_configuring_truffle">Configuring truffle</h5>
<div class="paragraph data-line-165">
<p>truffle creates some empty configuration files, <em>truffle.js</em> and <em>truffle-config.js</em>. On Windows systems the <em>truffle.js</em> name may cause a conflict when you try to run the command truffle and Windows attempts to run <em>truffle.js</em> instead. To avoid this, we will delete <em>truffle.js</em> and use <em>truffle-config.js</em> (in support of Windows users, who, honestly, suffer enough already):</p>
</div>
<pre data-type="programlisting">
$ <strong>rm truffle.js</strong>
</pre>
<div class="paragraph data-line-173">
<p>Now we edit <em>truffle-config.js</em> and replace the contents with the sample configuation shown here:</p>
</div>
<div class="listingblock data-line-176">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">module.exports = {
  networks: {
    localnode: { // Whatever network our local node connects to
      network_id: "*", // Match any network ID
      host: "localhost",
      port: 8545,
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph data-line-188">
<p>This configuration is a good starting point. It sets up one default Ethereum network (named localnode), which assumes we are running an Ethereum client such as Parity, either as a full node or as a light client. This configuration will instruct truffle to communicate with the local node over RPC, on port 8545. truffle will use whatever Ethereum network the local node is connected to, such as the Ethereum main network, or a test network like Ropsten. The local node will also be providing the wallet functionality.</p>
</div>
<div class="paragraph data-line-190">
<p>In following sections, we will configure additional networks for truffle to use, such as the ganache local test blockchain and Infura, a hosted network provider. As we add more networks, the configuration file will get more complex, but it will also give us more options for our testing and development workflow.</p>
</div>
</div>
<div class="sect4 data-line-192">
<h5 id="_using_truffle_to_deploy_a_contract">Using truffle to deploy a contract</h5>
<div class="paragraph data-line-194">
<p>We now have a basic working directory for our <em>Faucet</em> project, and we have truffle and its dependencies configured. Contracts go in the <em>contracts</em> subdirectory of our project. The directory already contains a "helper" contract, <em>Migrations.sol</em>, which manages contract upgrades for us. We&#8217;ll examine the use of <em>Migrations.sol</em> in the next section.</p>
</div>
<div class="paragraph data-line-196">
<p>Let&#8217;s copy the <em>Faucet.sol</em> contract (from <a href="#solidity_faucet_example">Faucet.sol: Un contrat Solidity mettant en place un robinet</a>) into the <em>contracts</em> subdirectory, so that the project directory looks like this:</p>
</div>
<div class="listingblock data-line-198">
<div class="content">
<pre>Faucet
+---- contracts
|   +---- Faucet.sol
|   `---- Migrations.sol
...</pre>
</div>
</div>
<div class="paragraph data-line-206">
<p>We can now ask truffle to compile the contract for us:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle compile</strong>
Compiling ./contracts/Faucet.sol...
Compiling ./contracts/Migrations.sol...
Writing artifacts to ./build/contracts
</pre>
</div>
<div class="sect4 data-line-218">
<h5 id="truffle_migrations_understanding_deployment_scripts">Truffle migrations&#x2014;understanding deployment scripts</h5>
<div class="paragraph data-line-220">
<p>Truffle offers a deployment system called a <em>migration</em>. If you have worked in other frameworks, you may have seen something similar: Ruby on Rails, Python Django, and many other languages and frameworks have a migrate command.</p>
</div>
<div class="paragraph data-line-222">
<p>In all those frameworks, the purpose of a migration is to handle changes in the data schema between different versions of the software. The purpose of migrations in Ethereum is slightly different. Because Ethereum contracts are immutable and cost gas to deploy, Truffle offers a migration mechanism to keep track of which contracts (and which versions) have already been deployed. In a complex project with dozens of contracts and complex dependencies, you would not want to have to pay to redeploy contracts that haven&#8217;t changed. You would also not want to manually track which versions of which contracts have been deployed already. The Truffle migration mechanism does all that by deploying the smart contract <em>Migrations.sol</em>, which then keeps track of all other contract deployments.</p>
</div>
<div class="paragraph data-line-224">
<p>We have only one contract, <em>Faucet.sol</em>, which means that the migration system is overkill, to say the least. Unfortunately, we have to use it. But, by learning how to use it for one contract, we can start practicing some good habits for our development workflow. The effort will pay off as things get more complicated.</p>
</div>
<div class="paragraph data-line-226">
<p>Truffle&#8217;s <em>migrations</em> directory is where the migration scripts are found. Right now there&#8217;s only one script, <em>1_initial_migration.js</em>, which deploys the <em>Migrations.sol</em> contract itself:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var Migrations = artifacts.require("./Migrations.sol");

module.exports = function(deployer) {
  deployer.deploy(Migrations);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-234">
<p>We need a second migration script, to deploy <em>Faucet.sol</em>. Let&#8217;s call it <em>2_deploy_contracts.js</em>. It is very simple, just like <em>1_initial_migration.js</em>, with only a few small changes. In fact, you can copy the contents of <em>1_initial_migration.j</em> and simply replace all instances of Migrations with Faucet:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var Faucet = artifacts.require("./Faucet.sol");

module.exports = function(deployer) {
  deployer.deploy(Faucet);
};</code></pre>
</div>
</div>
<div class="paragraph data-line-241">
<p>The script initializes a variable Faucet, identifying the <em>Faucet.sol</em> Solidity source code as the artifact that defines Faucet. Then it calls the <code>deploy</code> function to deploy this contract.</p>
</div>
<div class="paragraph data-line-243">
<p>We&#8217;re all set. Let&#8217;s use truffle migrate to deploy it on. We have to specify which network to deploy the contract, using the --network argument. We only have one network specified in the configuration file, which we named localnode. Make sure your local Ethereum client is running and then type:</p>
</div>
<pre data-type="programlisting">
Faucet $ <strong>truffle migrate --network localnode</strong>
</pre>
<div class="paragraph data-line-251">
<p>Because we are using a local node to connect to the Ethereum network and manage our wallet, we have to authorize the transaction that truffle creates. We&#8217;re running parity connected to the Ropsten test blockchain, so during the migration we&#8217;ll see a pop-up like the one in <a href="#parity_deployment_confirmation">Parity asking for confirmation to deploy Faucet</a> on Parity&#8217;s web console.</p>
</div>
<div id="parity_deployment_confirmation" class="imageblock data-line-255">
<div class="content">
<img src="images/parity_deployment_confirmation.png" alt="Parity asking for confirmation to deploy Faucet">
</div>
<div class="title">Figure 59. Parity asking for confirmation to deploy Faucet</div>
</div>
<div class="paragraph data-line-257">
<p>There are four transactions in total: one to deploy Migrations, one to update the deployments counter to 1, one to deploy Faucet, and one to update the deployments counter to 2.</p>
</div>
<div class="paragraph data-line-259">
<p>Truffle will show the migrations completing, show each of the transactions, and show the contract addresses:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle migrate --network localnode</strong>
Using network 'localnode'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xfa090db179d023d2abae543b4a21a1479e70ca7d35a469a5d1a98bfc6bd80fe8
  Migrations: 0x8861c27715550bed8362c0345add158489df6db0
Saving successful migration to network...
  ... 0x985c4a32716826ddbe4eae284104bef8bc69e959899f62246a1b27c9dfcd6c03
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Faucet...
  ... 0xecdbeef77f0558edc689440e34b7bba0a3ba7a45e4b680b071b47c30a930e9d6
  Faucet: 0xd01cd8e7bd29e4bff8c1693f59eee46137a9f300
Saving successful migration to network...
  ... 0x11f376bd7307edddfd40dc4a14c3f7cb84b6c921ac2465602060b67d08f9fd8a
Saving artifacts...
</pre>
</div>
<div class="sect4 data-line-283">
<h5 id="_using_the_truffle_console">Using the Truffle console</h5>
<div class="paragraph data-line-285">
<p>Truffle offers a JavaScript console that we can use to interact with the Ethereum network (via the local node), interact with deployed contracts, and interact with the wallet provider. In our current configuration (localnode), the node and wallet provider is our local Parity client.</p>
</div>
<div class="paragraph data-line-287">
<p>Let&#8217;s start the Truffle console and try some commands:</p>
</div>
<pre data-type="programlisting">
$ <strong>truffle console --network localnode</strong>
truffle(localnode)>
</pre>
<div class="paragraph data-line-296">
<p>Truffle presents a prompt, showing the selected network configuration (localnode).</p>
</div>
<div class="admonitionblock tip data-line-299">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-300">
<p>It&#8217;s important to remember and be aware of which network you are using. You wouldn&#8217;t want to accidentally deploy a test contract or make a transaction on the Ethereum main network. That could be an expensive mistake!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-303">
<p>The Truffle console offers an autocomplete function that makes it easy for us to explore the environment. If we press Tab after a partially completed command, Truffle will complete the command for us. Pressing Tab twice will show all possible completions if more than one command matches our input. In fact, if we press Tab twice on an empty prompt, Truffle lists all the available commands:</p>
</div>
<pre data-type="programlisting" class="codewrap">
truffle(localnode)&gt;
Array Boolean Date Error EvalError Function Infinity JSON Math NaN Number Object RangeError ReferenceError RegExp String SyntaxError TypeError URIError decodeURI decodeURIComponent encodeURI encodeURIComponent eval isFinite isNaN parseFloat parseInt undefined

ArrayBuffer Buffer DataView Faucet Float32Array Float64Array GLOBAL Int16Array Int32Array Int8Array Intl Map Migrations Promise Proxy Reflect Set StateManager Symbol Uint16Array Uint32Array Uint8Array Uint8ClampedArray WeakMap WeakSet WebAssembly XMLHttpRequest _ assert async_hooks buffer child_process clearImmediate clearInterval clearTimeout cluster console crypto dgram dns domain escape events fs global http http2 https module net os path perf_hooks process punycode querystring readline repl require root setImmediate setInterval setTimeout stream string_decoder tls tty unescape url util v8 vm web3 zlib

__defineGetter__ __defineSetter__ __lookupGetter__ __lookupSetter__ __proto__ constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf
</pre>
<div class="paragraph data-line-316">
<p>The vast majority of the wallet- and node-related functions are provided by the web3 object, which is an instance of the web3.js library. The web3 object abstracts the RPC interface to our Parity node. You will also notice two objects with familiar names: Migrations and Faucet. Those represent the contracts we just deployed. We will use the Truffle console to interact with a contract. First, let&#8217;s check our wallet via the web3 object:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.accounts</strong>
[ '0x9e713963a92c02317a681b9bb3065a8249de124f',
  '0xdb5dc1a13e3a55cf3b4587cd8d1e5fdeb6738145' ]
</pre>
<div class="paragraph data-line-326">
<p>Our Parity client has two wallets, with some test ether on Ropsten. The web3.eth.accounts attribute contains a list of all the accounts. We can check the balance of the first account using the getBalance function:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.getBalance(web3.eth.accounts[0]).toNumber()</strong>
191198572800000000
truffle(localnode)&gt;
</pre>
<div class="paragraph data-line-336">
<p>web3.js is a large JavaScript library that offers a comprehensive interface to the Ethereum system, via a provider such as a local client. We will examine web3.js in more detail in <a href="#web3js_tutorial">Tutoriel web3.js</a>. Now let&#8217;s try to interact with our contracts:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>Faucet.address</strong>
'0xd01cd8e7bd29e4bff8c1693f59eee46137a9f300'
truffle(localnode)&gt; <strong>web3.eth.getBalance(Faucet.address).toNumber()</strong>
0
truffle(localnode)&gt;
</pre>
<div class="paragraph data-line-348">
<p>Next, we&#8217;ll use sendTransaction to send some test ether to fund the Faucet contract. Note the use of web3.utils.toWei to convert ether units for us. Typing 18 zeros without making a mistake is both difficult and dangerous, so it&#8217;s always better to use a unit converter for values. Here&#8217;s how we send the transaction:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.sendTransaction({from:web3.eth.accounts[0],
                    to:Faucet.address, value:web3.utils.toWei(0.5, 'ether')});</strong>
'0xf134c75b985dc0e0c27c2f0412251e0860eb530a5055e660f21e7483ab336808'
</pre>
<div class="paragraph data-line-358">
<p>If we switch to the Parity web interface, we&#8217;ll see a pop-up asking us to confirm this transaction. Once the transaction is mined, we&#8217;ll be able to see the balance of our Faucet contract:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.getBalance(Faucet.address).toNumber()</strong>
500000000000000000
</pre>
<div class="paragraph data-line-367">
<p>Let&#8217;s call the withdraw function now, to withdraw some test ether from the contract:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>Faucet.deployed().then(instance =>
                       {instance.withdraw(web3.utils.toWei(0.1,
                       'ether'))}).then(console.log)</strong>
</pre>
<div class="paragraph data-line-377">
<p>Again, we&#8217;ll need to approve the transaction in the Parity web interface. If we check again we&#8217;ll see that the balance of the Faucet contract has decreased, and our test wallet has received 0.1 ether:</p>
</div>
<pre data-type="programlisting">
truffle(localnode)&gt; <strong>web3.eth.getBalance(Faucet.address).toNumber()</strong>
400000000000000000
truffle(localnode)&gt; <strong>Faucet.deployed().then(instance =>
                    {instance.withdraw(web3.utils.toWei(1, 'ether'))})</strong>
StatusError: Transaction: 0xe147ae9e3610334...8612b92d3f9c
  exited with an error (status 0).
</pre>
</div>
</div>
<div class="sect3 data-line-390">
<h4 id="_embark">Embark</h4>
<div class="paragraph data-line-392">
<p>GitHub: <a href="https://github.com/embark-framework/embark/" class="undefined" data-href="https://github.com/embark-framework/embark/">https://github.com/embark-framework/embark/</a></p>
</div>
<div class="paragraph data-line-394">
<p>Documentation: <a href="https://embark.status.im/docs/" class="undefined" data-href="https://embark.status.im/docs/">https://embark.status.im/docs/</a></p>
</div>
<div class="paragraph data-line-396">
<p>npm package repository: <a href="https://www.npmjs.com/package/embark" class="undefined" data-href="https://www.npmjs.com/package/embark">https://www.npmjs.com/package/embark</a></p>
</div>
<div class="paragraph data-line-398">
<p>Embark is a framework built to allow developers to easily develop and deploy decentralized applications.
Embark integrates with Ethereum, IPFS, Whisper, and Swarm to offer the following features:</p>
</div>
<div class="ulist data-line-401">
<ul>
<li class="data-line-401">
<p>Automatically deploy contracts and make them available in JS code.</p>
</li>
<li class="data-line-402">
<p>Watch for changes and update contracts to redeploy if needed.</p>
</li>
<li class="data-line-403">
<p>Manage and interact with different chains (e.g., testnet, local, mainnet).</p>
</li>
<li class="data-line-404">
<p>Manage complex systems of interdependent contracts.</p>
</li>
<li class="data-line-405">
<p>Store and retrieve data, including uploading and retrieving files hosted in IPFS.</p>
</li>
<li class="data-line-406">
<p>Ease the process of deploying the full application to IPFS or Swarm.</p>
</li>
<li class="data-line-407">
<p>Send and receive messages through Whisper.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-409">
<p>You can install it with npm:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm -g install embark</strong>
</pre>
</div>
<div class="sect3 pagebreak-before data-line-418">
<h4 id="_openzeppelin">OpenZeppelin</h4>
<div class="paragraph data-line-420">
<p>GitHub: <a href="https://github.com/OpenZeppelin/openzeppelin-solidity" class="undefined" data-href="https://github.com/OpenZeppelin/openzeppelin-solidity">https://github.com/OpenZeppelin/openzeppelin-solidity</a></p>
</div>
<div class="paragraph data-line-422">
<p>Website: <a href="https://openzeppelin.org/" class="undefined" data-href="https://openzeppelin.org/">https://openzeppelin.org/</a></p>
</div>
<div class="paragraph data-line-424">
<p>Documentation: <a href="https://openzeppelin.org/api/docs/open-zeppelin.html" class="undefined" data-href="https://openzeppelin.org/api/docs/open-zeppelin.html">https://openzeppelin.org/api/docs/open-zeppelin.html</a></p>
</div>
<div class="paragraph data-line-426">
<p><a href="https://openzeppelin.org/" data-href="https://openzeppelin.org/">OpenZeppelin</a> is an open framework of reusable and secure smart contracts in the Solidity language.</p>
</div>
<div class="paragraph data-line-428">
<p>It is community-driven, led by the <a href="https://zeppelin.solutions/" data-href="https://zeppelin.solutions/">Zeppelin</a> team, with over a hundred external contributors. The main focus of the framework is security, achieved by applying industry-standard contract security patterns and best practices, drawing on all the experience the Zeppelin devs have gained from <a href="https://blog.zeppelin.solutions/tagged/security" data-href="https://blog.zeppelin.solutions/tagged/security">auditing</a> a huge number of contracts, and through constant testing and auditing from the community that uses the framework as a base for their real-world applications.</p>
</div>
<div class="paragraph data-line-430">
<p>The OpenZeppelin framework is the most widely used solution for Ethereum smart contracts. The framework currently has an ample library of contracts including implementations of ERC20 and ERC721 tokens, many flavors of crowdsale models, and simple behaviors commonly found in contracts such as <code>Ownable</code>, <code>Pausable</code>, or <code>LimitBalance</code>. The contracts in this repository in some cases function as <em>de facto</em> standard implementations.</p>
</div>
<div class="paragraph data-line-432">
<p>The framework is licensed under an MIT license, and all the contracts have been designed with a modular approach to guarantee ease of reuse and extension. These are clean and basic building blocks, ready to be used in your next Ethereum project. Let&#8217;s set up the framework and build a simple crowdsale using the OpenZeppelin contracts, to demonstrate how easy it is to use. This example also stresses the importance of reusing secure components instead of writing them by yourself.</p>
</div>
<div class="paragraph data-line-434">
<p>First, we will need to install the openzeppelin-solidity library into our workspace. The latest release as of the time of this writing is v1.9.0, so we will use that one:</p>
</div>
<pre data-type="programlisting">
$ <strong>mkdir sample-crowdsale</strong>
$ <strong>cd sample-crowdsale</strong>
$ <strong>npm install openzeppelin-solidity@1.9.0</strong>
$ <strong>mkdir contracts</strong>
</pre>
<div class="paragraph data-line-445">
<p>At the time of writing, OpenZeppelin includes multiple basic token contracts that follow the ERC20, ERC721, and ERC827 standards, with different characteristics for emission, limits, vesting, life cycle, etc.</p>
</div>
<div class="paragraph data-line-447">
<p>Let&#8217;s make an ERC20 token that&#8217;s mintable, meaning that the initial supply starts at 0 and new tokens can be created by the token owner (in our case, the crowdsale <span class="keep-together">contract</span>) and sold to buyers. In order to do this, we&#8217;ll create a <em>contracts/SampleToken.sol</em> file with the following contents:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity 0.4.23;

import 'openzeppelin-solidity/contracts/token/ERC20/MintableToken.sol';

contract SampleToken is MintableToken {
  string public name = "SAMPLE TOKEN";
  string public symbol = "SAM";
  uint8 public decimals = 18;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-454">
<p>OpenZeppelin already provides a MintableToken contract that we can use as a base for our token, so we only define the details that are specific to our case. Next, let&#8217;s make the crowdsale contract. Just like with tokens, OpenZeppelin already provides a wide variety of crowdsale flavors. Currently, you will find contracts for various scenarios involving distribution, emission, price, and validation. So, let‚Äôs say that you want to set a goal for your crowdsale and if it‚Äôs not met by the time the sale finishes, you want to refund all your investors. For that, you can use the <a href="http://bit.ly/2yHoh65" data-href="http://bit.ly/2yHoh65">RefundableCrowdsale</a> contract. Or maybe you want to define a crowdsale with an increasing price to incentivize early buyers; there is an <a href="http://bit.ly/2PtWOys" data-href="http://bit.ly/2PtWOys">IncreasingPriceCrowdsale</a> contract just for that. You can also end the crowdsale when a specified amount of ether has been received by the contract (<a href="http://bit.ly/2OVsCN8" data-href="http://bit.ly/2OVsCN8">CappedCrowdsale</a>), or set a finishing time with the <a href="http://bit.ly/2zp2Nuz" data-href="http://bit.ly/2zp2Nuz">TimedCrowdsale</a> contract, or create a whitelist of buyers with the <a href="http://bit.ly/2CN8Hc9" data-href="http://bit.ly/2CN8Hc9">WhitelistedCrowdsale</a> contract.</p>
</div>
<div class="paragraph data-line-456">
<p>As we said before, the OpenZeppelin contracts are basic building blocks. These crowdsale contracts have been designed to be combined; just read the source code of the base <a href="http://bit.ly/2ABIQSI" data-href="http://bit.ly/2ABIQSI">Crowdsale</a> contract for directions on how to extend it. For the crowdsale of our token, we need to mint tokens when ether is received by the crowdsale contract, so let&#8217;s use <a href="http://bit.ly/2Sx3HOc" data-href="http://bit.ly/2Sx3HOc">MintedCrowdsale</a> as a base. And to make it more interesting, let&#8217;s also make it a <a href="http://bit.ly/2Qef0Jm" data-href="http://bit.ly/2Qef0Jm">PostDeliveryCrowdsale</a> so the tokens can only be withdrawn after the crowdsale ends. To do this, we&#8217;ll write the following into <em>contracts/SampleCrowdsale.sol</em>:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity 0.4.23;

import './SampleToken.sol';
import 'openzeppelin-solidity/contracts/crowdsale/emission/MintedCrowdsale.sol';
import 'openzeppelin-solidity/contracts/crowdsale/ \
  distribution/PostDeliveryCrowdsale.sol';

contract SampleCrowdsale is PostDeliveryCrowdsale, MintedCrowdsale {

  constructor(
    uint256 _openingTime,
    uint256 _closingTime
    uint256 _rate,
    address _wallet,
    MintableToken _token
  )
    public
    Crowdsale(_rate, _wallet, _token)
    PostDeliveryCrowdsale(_openingTime, _closingTime)
  {
  }
}</code></pre>
</div>
</div>
<div class="paragraph data-line-463">
<p>Again, we barely had to write any code; we just reused the battle-tested code that the OpenZeppelin community made available. However, it is important to note that this case is different than that of our <code>SampleToken</code> contract. If you go to the <a href="http://bit.ly/2Q8lQ3o" data-href="http://bit.ly/2Q8lQ3o">Crowdsale automated tests</a> you will see that they are tested in isolation. When you integrate different units of code into a bigger component, it&#8217;s not enough to test all the units separately, because the interactions between them might cause behaviors that you didn&#8217;t expect. In particular, you will see that here we introduced multiple inheritance, which can surprise the developer if they don&#8217;t understand the details of Solidity. Our <span class="keep-together"><code>SampleCrowdsale</code></span> contract is simple, and it will work just as we expect because the framework was designed to make cases like these straightforward; but do not relax your vigilance because of the simplicity that this framework introduces. Every time you integrate parts of the OpenZeppelin framework to build a more complex solution, you must fully test every aspect of your solution to ensure that all the interactions of the units work as you intend.</p>
</div>
<div class="paragraph data-line-465">
<p>Finally, when we are happy with our solution and have tested it thoroughly, we need to deploy it. OpenZeppelin integrates well with Truffle, so we can just write a migrations file like the following (<em>migrations/2_deploy_contracts.js</em>), as explained in <a href="#truffle_migrations_understanding_deployment_scripts">Truffle migrations&#x2014;understanding deployment scripts</a>:</p>
</div>
<div class="listingblock data-line-0">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">const SampleCrowdsale = artifacts.require('./SampleCrowdsale.sol');
const SampleToken = artifacts.require('./SampleToken.sol');

module.exports = function(deployer, network, accounts) {
  const openingTime = web3.eth.getBlock('latest').timestamp + 2; // 2s in future
  const closingTime = openingTime + 86400 * 20; // 20 days
  const rate = new web3.BigNumber(1000);
  const wallet = accounts[1];

  return deployer
    .then(() =&gt; {
      return deployer.deploy(SampleToken);
    })
    .then(() =&gt; {
      return deployer.deploy(
        SampleCrowdsale,
        openingTime,
        closingTime,
        rate,
        wallet,
        SampleToken.address
      );
    });
};</code></pre>
</div>
</div>
<div class="admonitionblock note data-line-473">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-474">
<p>This was just a quick overview of a few of the contracts that are part of the OpenZeppelin framework. You are welcome to join the OpenZeppelin development community to learn and contribute.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-477">
<h4 id="_zeppelinos">ZeppelinOS</h4>
<div class="paragraph data-line-479">
<p>GitHhub: <a href="https://github.com/zeppelinos" class="undefined" data-href="https://github.com/zeppelinos">https://github.com/zeppelinos</a></p>
</div>
<div class="paragraph data-line-481">
<p>Website: <a href="https://zeppelinos.org" class="undefined" data-href="https://zeppelinos.org">https://zeppelinos.org</a></p>
</div>
<div class="paragraph data-line-483">
<p>Blog: <a href="https://blog.zeppelinos.org" class="undefined" data-href="https://blog.zeppelinos.org">https://blog.zeppelinos.org</a></p>
</div>
<div class="paragraph data-line-485">
<p><a href="https://github.com/zeppelinos" data-href="https://github.com/zeppelinos">ZeppelinOS</a> is &#x201c;an open source, distributed platform of tools and services on top of the EVM
to develop and manage smart contract applications securely.&#x201d;</p>
</div>
<div class="paragraph data-line-488">
<p>Unlike OpenZeppelin&#8217;s code, which needs to be redeployed with each application every time it&#8217;s used, ZeppelinOS&#8217;s code lives on-chain. Applications that need a given functionality&#x2014;say, an ERC20 token&#x2014;not only do not have to redesign and reaudit its implementation (something that OpenZeppelin solved) but do not even need to deploy it. With ZeppelinOS, an application interacts with the token&#8217;s on-chain implementation directly, in much the same way as a desktop application interacts with the components of its underlying OS.</p>
</div>
<div class="paragraph data-line-490">
<p>At the core of ZeppelinOS sits a very clever contract known as a <em>proxy</em>. A proxy is a contract that is capable of wrapping any other contract, exposing its interface without having to manually implement setters and getters for it, and can upgrade it without losing state. In Solidity terms, it can be seen as a normal contract whose business logic is contained within a library, which can be swapped for a new library at any time without losing its state. The way in which the proxy links to its implementation is completely automated and encapsulated for the developer. Practically any contract can be made upgradeable with little to no change in its code. More about ZeppelinOS&#8217;s proxy mechanism can be found in the  <a href="http://bit.ly/2OfuNpu" data-href="http://bit.ly/2OfuNpu">blog</a>, and an example of how to use it can be found <a href="http://bit.ly/2OfuE5q" data-href="http://bit.ly/2OfuE5q">on GitHub</a>.</p>
</div>
<div class="paragraph data-line-492">
<p>Developing applications using ZeppelinOS is similar to developing JavaScript applications using npm. An AppManager handles an application package for each version of the application. A package is simply a directory of contracts, each of which can have one or more upgradeable proxies. The AppManager not only provides proxies for application-specific contracts, but also does so for ZeppelinOS implementations, in the form of a standard library. To see a full example of this, please visit <a href="http://bit.ly/2PtyJb3" data-href="http://bit.ly/2PtyJb3">examples/complex</a>.</p>
</div>
<div class="paragraph data-line-494">
<p>Although currently in development, ZeppelinOS aims to provide a wide set of additional features, such as developer tools, a scheduler that automates background operations within contracts, development bounties, a marketplace that facilitates communication and exchange of value between applications, and much more. All of this is described in ZeppelinOS&#8217;s <a href="http://bit.ly/2QcxV7K" data-href="http://bit.ly/2QcxV7K">whitepaper</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-499">
<h3 id="_utilities">Utilities</h3>
<div class="sect3 data-line-501">
<h4 id="_ethereumjs_helpeth_a_command_line_utility">EthereumJS helpeth: A Command-Line Utility</h4>
<div class="paragraph data-line-503">
<p>GitHub: <a href="https://github.com/ethereumjs/helpeth" class="undefined" data-href="https://github.com/ethereumjs/helpeth">https://github.com/ethereumjs/helpeth</a></p>
</div>
<div class="paragraph data-line-505">
<p>helpeth is a command-line tool for key and transaction manipulation that makes a developer&#8217;s job a lot easier.</p>
</div>
<div class="paragraph data-line-507">
<p>It is part of the EthereumJS collection of JavaScript-based libraries and tools:</p>
</div>
<div class="listingblock data-line-511">
<div class="content">
<pre>Usage: helpeth [command]

Commands:
  signMessage &lt;message&gt;                     Sign a message
  verifySig &lt;hash&gt; &lt;sig&gt;                    Verify signature
  verifySigParams &lt;hash&gt; &lt;r&gt; &lt;s&gt; &lt;v&gt;        Verify signature parameters
  createTx &lt;nonce&gt; &lt;to&gt; &lt;value&gt; &lt;data&gt;      Sign a transaction
  &lt;gasLimit&gt; &lt;gasPrice&gt;
  assembleTx &lt;nonce&gt; &lt;to&gt; &lt;value&gt; &lt;data&gt;    Assemble a transaction from its
  &lt;gasLimit&gt; &lt;gasPrice&gt; &lt;v&gt; &lt;r&gt; &lt;s&gt;         components
  parseTx &lt;tx&gt;                              Parse raw transaction
  keyGenerate [format] [icapdirect]         Generate new key
  keyConvert                                Convert a key to V3 keystore format
  keyDetails                                Print key details
  bip32Details &lt;path&gt;                       Print key details for a given path
  addressDetails &lt;address&gt;                  Print details about an address
  unitConvert &lt;value&gt; &lt;from&gt; &lt;to&gt;           Convert between Ethereum units

Options:
  -p, --private      Private key as a hex string                        [string]
  --password         Password for the private key                       [string]
  --password-prompt  Prompt for the private key password               [boolean]
  -k, --keyfile      Encoded key file                                   [string]
  --show-private     Show private key details                          [boolean]
  --mnemonic         Mnemonic for HD key derivation                     [string]
  --version          Show version number                               [boolean]
  --help             Show help                                         [boolean]</pre>
</div>
</div>
</div>
<div class="sect3 data-line-541">
<h4 id="_dapp_tools">dapp.tools</h4>
<div class="paragraph data-line-543">
<p>Website: <a href="https://dapp.tools/" class="undefined" data-href="https://dapp.tools/">https://dapp.tools/</a></p>
</div>
<div class="paragraph data-line-545">
<p>dapp.tools is a comprehensive suite of blockchain-oriented developer tools created in the spirit of the Unix philosophy. The tools included are:</p>
</div>
<div class="dlist data-line-548">
<dl>
<dt class="hdlist1">Dapp</dt>
<dd>
<p>Dapp is the basic user-facing tool, for creating new DApps, running Solidity unit tests, debugging and deploying contracts, launching testnets, and more.</p>
</dd>
<dt class="hdlist1">Seth</dt>
<dd>
<p>Seth is used for composing transactions, querying the blockchain, converting between data formats, performing remote calls, and similar everyday tasks.</p>
</dd>
<dt class="hdlist1">Hevm</dt>
<dd>
<p>Hevm is a Haskell EVM implementation with a nimble terminal-based Solidity debugger. It‚Äôs used to test and debug DApps.</p>
</dd>
<dt class="hdlist1">evmdis</dt>
<dd>
<p>evmdis is an EVM disassembler; it performs static analysis on the bytecode to provide a higher level of abstraction than raw EVM operations.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-561">
<h4 id="_sputnikvm">SputnikVM</h4>
<div class="paragraph data-line-563">
<p><a href="https://github.com/etcdevteam/sputnikvm" data-href="https://github.com/etcdevteam/sputnikvm">SputnikVM</a> is a standalone pluggable virtual machine for different Ethereum-based blockchains. It&#8217;s written in Rust and can be used as a binary, cargo crate, or shared library, or integrated through FFI, Protobuf, and JSON interfaces. It has a separate binary, sputnikvm-dev, intended for testing purposes, which emulates most of the JSON-RPC API and block mining.</p>
</div>
</div>
</div>
<div class="sect2 data-line-565">
<h3 id="_libraries">Libraries</h3>
<div class="sect3 data-line-567">
<h4 id="_web3_js">web3.js</h4>
<div class="paragraph data-line-569">
<p>web3.js is the Ethereum-compatible JavaScript API for communicating with clients via JSON-RPC, developed by the Ethereum Foundation.</p>
</div>
<div class="paragraph data-line-571">
<p>GitHub: <a href="https://github.com/ethereum/web3.js" class="undefined" data-href="https://github.com/ethereum/web3.js">https://github.com/ethereum/web3.js</a></p>
</div>
<div class="paragraph data-line-573">
<p>npm package repository: <a href="https://www.npmjs.com/package/web3" class="undefined" data-href="https://www.npmjs.com/package/web3">https://www.npmjs.com/package/web3</a></p>
</div>
<div class="paragraph data-line-575">
<p>Documentation for web3.js API 0.2x.x: <a href="http://bit.ly/2Qcyq1C" class="undefined" data-href="http://bit.ly/2Qcyq1C">http://bit.ly/2Qcyq1C</a></p>
</div>
<div class="paragraph data-line-577">
<p>Documentation for web3.js API 1.0.0-beta.xx: <a href="http://bit.ly/2CT33p0" class="undefined" data-href="http://bit.ly/2CT33p0">http://bit.ly/2CT33p0</a></p>
</div>
</div>
<div class="sect3 pagebreak-before data-line-580">
<h4 id="_web3_py">web3.py</h4>
<div class="paragraph data-line-582">
<p>web3.py is a Python library for interacting with the Ethereum blockchain, maintained by the Ethereum Foundation.</p>
</div>
<div class="paragraph data-line-584">
<p>GitHub: <a href="https://github.com/ethereum/web3.py" class="undefined" data-href="https://github.com/ethereum/web3.py">https://github.com/ethereum/web3.py</a></p>
</div>
<div class="paragraph data-line-586">
<p>PyPi: <a href="https://pypi.python.org/pypi/web3/4.0.0b9" class="undefined" data-href="https://pypi.python.org/pypi/web3/4.0.0b9">https://pypi.python.org/pypi/web3/4.0.0b9</a></p>
</div>
<div class="paragraph data-line-588">
<p>Documentation: <a href="https://web3py.readthedocs.io/" class="undefined" data-href="https://web3py.readthedocs.io/">https://web3py.readthedocs.io/</a></p>
</div>
</div>
<div class="sect3 data-line-590">
<h4 id="_ethereumjs">EthereumJS</h4>
<div class="paragraph data-line-592">
<p>EthereumJS is collection of libraries and utilities for Ethereum.</p>
</div>
<div class="paragraph data-line-594">
<p>GitHub: <a href="https://github.com/ethereumjs" class="undefined" data-href="https://github.com/ethereumjs">https://github.com/ethereumjs</a></p>
</div>
<div class="paragraph data-line-596">
<p>Website: <a href="https://ethereumjs.github.io/" class="undefined" data-href="https://ethereumjs.github.io/">https://ethereumjs.github.io/</a></p>
</div>
</div>
<div class="sect3 data-line-598">
<h4 id="_web3j">web3j</h4>
<div class="paragraph data-line-600">
<p>web3j is a Java and Android library for integrating with Ethereum clients and working with smart contracts.</p>
</div>
<div class="paragraph data-line-602">
<p>GitHub: <a href="https://github.com/web3j/web3j" class="undefined" data-href="https://github.com/web3j/web3j">https://github.com/web3j/web3j</a></p>
</div>
<div class="paragraph data-line-604">
<p>Website: <a href="https://web3j.io" class="undefined" data-href="https://web3j.io">https://web3j.io</a></p>
</div>
<div class="paragraph data-line-606">
<p>Documentation: <a href="https://docs.web3j.io" class="undefined" data-href="https://docs.web3j.io">https://docs.web3j.io</a></p>
</div>
</div>
<div class="sect3 data-line-608">
<h4 id="_etherjar">EtherJar</h4>
<div class="paragraph data-line-610">
<p>EtherJar is another Java library for integrating with Ethereum and working with smart contracts. It&#8217;s designed for server-side projects based on Java 8+ and provides low-level access and a high-level wrapper around RPC, Ethereum data structures, and smart contract access.</p>
</div>
<div class="paragraph data-line-612">
<p>GitHub: <a href="https://github.com/infinitape/etherjar" class="undefined" data-href="https://github.com/infinitape/etherjar">https://github.com/infinitape/etherjar</a></p>
</div>
</div>
<div class="sect3 data-line-614">
<h4 id="_nethereum">Nethereum</h4>
<div class="paragraph data-line-616">
<p>Nethereum is the .Net integration library for Ethereum.</p>
</div>
<div class="paragraph data-line-618">
<p>GitHub: <a href="https://github.com/Nethereum/Nethereum" class="undefined" data-href="https://github.com/Nethereum/Nethereum">https://github.com/Nethereum/Nethereum</a></p>
</div>
<div class="paragraph data-line-620">
<p>Website: <a href="http://nethereum.com/" class="undefined" data-href="http://nethereum.com/">http://nethereum.com/</a></p>
</div>
<div class="paragraph data-line-622">
<p>Documentation: <a href="https://nethereum.readthedocs.io/en/latest/" class="undefined" data-href="https://nethereum.readthedocs.io/en/latest/">https://nethereum.readthedocs.io/en/latest/</a></p>
</div>
</div>
<div class="sect3 data-line-624">
<h4 id="_ethers_js">ethers.js</h4>
<div class="paragraph data-line-626">
<p>The ethers.js library is a compact, complete, full-featured, extensively tested MIT-licensed Ethereum library, which has received a DevEx grant from the Ethereum Foundation toward its extension and maintenance.</p>
</div>
<div class="paragraph data-line-628">
<p>GitHub link: <a href="https://github.com/ethers-io/ethers.js" class="undefined" data-href="https://github.com/ethers-io/ethers.js">https://github.com/ethers-io/ethers.js</a></p>
</div>
<div class="paragraph data-line-630">
<p>Documentation: <a href="https://docs.ethers.io" class="undefined" data-href="https://docs.ethers.io">https://docs.ethers.io</a></p>
</div>
</div>
<div class="sect3 data-line-633">
<h4 id="_emerald_platform">Emerald Platform</h4>
<div class="paragraph data-line-635">
<p>Emerald Platform provides libraries and UI components to build DApps on top of Ethereum. Emerald JS and Emerald JS UI provide sets of modules and React components to build JavaScript applications and websites; Emerald SVG Icons is a set of blockchain-related icons. In addition to JavaScript libraries Emerald has a Rust library to operate private keys and transaction signatures. All Emerald libraries and components are licensed under the Apache License, version 2.0.</p>
</div>
<div class="paragraph data-line-637">
<p>GitHub: <a href="https://github.com/etcdevteam/emerald-platform" class="undefined" data-href="https://github.com/etcdevteam/emerald-platform">https://github.com/etcdevteam/emerald-platform</a></p>
</div>
<div class="paragraph data-line-639">
<p>Documentation: <a href="https://docs.etcdevteam.com" class="undefined" data-href="https://docs.etcdevteam.com">https://docs.etcdevteam.com</a></p>
</div>
</div>
</div>
<div class="sect2 data-line-642">
<h3 id="testing_frameworks">Testing Smart Contracts</h3>
<div class="paragraph data-line-644">
<p>There are several commonly used test frameworks for smart contract development, summarized in <a href="#testing_frameworks_table">Smart contract test frameworks summary</a>:</p>
</div>
<table id="testing_frameworks_table" class="tableblock frame-all grid-all stretch data-line-649">
<caption class="title">Table 10. Smart contract test frameworks summary</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Framework</th>
<th class="tableblock halign-left valign-top">Test language(s)</th>
<th class="tableblock halign-left valign-top">Testing framework</th>
<th class="tableblock halign-left valign-top">Chain emulator</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Truffle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript/Solidity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mocha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TestRPC/Ganache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://truffleframework.com/" class="undefined" data-href="https://truffleframework.com/">https://truffleframework.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Embark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mocha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TestRPC/Ganache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://embark.status.im/docs/" class="undefined" data-href="https://embark.status.im/docs/">https://embark.status.im/docs/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dapp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solidity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ds-test (custom)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ethrun (Parity)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://dapp.tools/dapp/" class="undefined" data-href="https://dapp.tools/dapp/">https://dapp.tools/dapp/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Populus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pytest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python chain emulator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://populus.readthedocs.io" class="undefined" data-href="https://populus.readthedocs.io">https://populus.readthedocs.io</a></p></td>
</tr>
</tbody>
</table>
<div class="dlist data-line-658">
<dl>
<dt class="hdlist1">Truffle</dt>
<dd>
<p>Truffle allows for unit tests to be written in JavaScript (Mocha-based) or Solidity. These tests are run against Ganache.</p>
</dd>
<dt class="hdlist1">Embark</dt>
<dd>
<p>Embark integrates with Mocha to run unit tests written in JavaScript. The tests are in turn run against contracts deployed on TestRPC/Ganache. The Embark framework automatically deploys smart contracts, and will automatically redeploy the contracts when they are changed. It also keeps track of deployed contracts and deploys contracts only when truly needed. Embark includes a testing library to rapidly run and test your contracts in an EVM, with functions like assert.equal. The command embark test will run any test files under the directory <em>test</em>.</p>
</dd>
<dt class="hdlist1">Dapp</dt>
<dd>
<p>Dapp uses native Solidity code (a library called ds-test) and a Parity-built Rust library called ethrun to execute Ethereum bytecode and then assert correctness. The ds-test library provides assertion functions for validating correctness and events for logging data in the console.</p>
<div class="paragraph data-line-664">
<p>The assertion functions include:</p>
</div>
<div class="listingblock data-line-666">
<div class="content">
<pre>assert(bool condition)
assertEq(address a, address b)
assertEq(bytes32 a, bytes32 b)
assertEq(int a, int b)
assertEq(uint a, uint b)
assertEq0(bytes a, bytes b)
expectEventsExact(address target)</pre>
</div>
</div>
<div class="paragraph data-line-676">
<p>The logging commands will log information to the console, making them useful for debugging:</p>
</div>
<div class="listingblock data-line-678">
<div class="content">
<pre>logs(bytes)
log_bytes32(bytes32)
log_named_bytes32(bytes32 key, bytes32 val)
log_named_address(bytes32 key, address val)
log_named_int(bytes32 key, int val)
log_named_uint(bytes32 key, uint val)
log_named_decimal_int(bytes32 key, int val, uint decimals)
log_named_decimal_uint(bytes32 key, uint val, uint decimals)</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Populus</dt>
<dd>
<p>Populus uses Python and its own chain emulator to run contracts written in Solidity. Unit tests are written in Python with the pytest library. Populus supports writing contracts specifically for testing. These contract filenames should match the glob pattern <em>Test*.sol</em> and be located anywhere under the project tests directory, <em>tests</em>.</p>
</dd>
</dl>
</div>
<div class="sect3 data-line-693">
<h4 id="on_blockchain_testing_sec">On-Blockchain Testing</h4>
<div class="paragraph data-line-695">
<p>Although most testing shouldn&#8217;t occur on deployed contracts, a contract&#8217;s behavior can be checked via Ethereum clients.  The following commands can be used to assess a smart contract&#8217;s state. These commands should be typed at the geth terminal, although any web3 console will also support them.</p>
</div>
<div class="paragraph data-line-697">
<p>To get the address of a contract at <em>txhash</em>, use:</p>
</div>
<pre data-type="programlisting">
web3.eth.getTransactionReceipt(<em>txhash</em>);
</pre>
<div class="paragraph data-line-706">
<p>This command gets the code of a contract deployed at <em>contractaddress</em>; this can be used to verify proper deployment:</p>
</div>
<pre data-type="programlisting">
web3.eth.getCode(<em>contractaddress</em>)
</pre>
<div class="paragraph data-line-714">
<p>This gets the full logs of the contract located at the address specified in <em>options</em>, which is helpful for viewing the history of a contract&#8217;s calls:</p>
</div>
<pre data-type="programlisting">
web3.eth.getPastLogs(<em>options</em>)
</pre>
<div class="paragraph data-line-722">
<p>Finally, this command gets the storage located at <em>address</em> with an offset of <em>position</em>:</p>
</div>
<pre data-type="programlisting">
web3.eth.getStorageAt(<em>address</em>, <em>position</em>)
</pre>
</div>
<div class="sect3 data-line-731">
<h4 id="ganache">Ganache: A Local Test Blockchain</h4>
<div class="paragraph data-line-733">
<p>Ganache is a local test blockchain that you can use to deploy contracts, develop your applications, and run tests. It is available as a desktop application (with a graphical user interface) for Windows, macOS, and Linux. It is also available as a command-line utility called ganache-cli. For more details and installation instructions for the Ganache desktop application, see <a href="https://truffleframework.com/ganache" class="undefined" data-href="https://truffleframework.com/ganache">https://truffleframework.com/ganache</a>.</p>
</div>
<div class="paragraph data-line-735">
<p>The ganache-cli code can be found at <a href="https://github.com/trufflesuite/ganache-cli/" class="undefined" data-href="https://github.com/trufflesuite/ganache-cli/">https://github.com/trufflesuite/ganache-cli/</a>.</p>
</div>
<div class="paragraph data-line-737">
<p>To install the command line ganache-cli, use npm:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm install -g ganache-cli</strong>
</pre>
<div class="paragraph data-line-745">
<p>You can use ganache-cli to start a local blockchain for testing as follows:</p>
</div>
<pre data-type="programlisting">
$ <strong>ganache-cli \
  --networkId=3 \
  --port="8545" \
  --verbose \
  --gasLimit=8000000 \
  --gasPrice=4000000000;</strong>
</pre>
<div class="paragraph data-line-758">
<p>A few notes on this command line:</p>
</div>
<div class="ulist checklist data-line-760">
<ul class="checklist">
<li class="data-line-760">
<p>&#10063; Check the <code>--networkId</code> and <code>--port</code> flag values match your configuration in <em>truffle.js</em>.</p>
</li>
<li class="data-line-761">
<p>&#10063; Check the <code>--gasLimit</code> flag value matches the latest mainnet gas limit (e.g., 8,000,000 gas) shown at <a href="https://ethstats.net" class="undefined" data-href="https://ethstats.net">https://ethstats.net</a> to avoid encountering &#x201c;out of gas&#x201d; exceptions unnecessarily. Note that a <code>--gasPrice</code> of 4000000000 represents a gas price of 4 gwei.</p>
</li>
<li class="data-line-762">
<p>&#10063; You can optionally enter a <code>--mnemonic</code> flag value to restore a previous HD wallet and associated addresses.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="web3js_tutorial">Appendix E: Tutoriel web3.js</h2>
<div class="sectionbody">
<div class="sect2 data-line-5">
<h3 id="_description">Description</h3>
<div class="paragraph data-line-6">
<p>This tutorial is based on web3@1.0.0-beta.29 web3.js. It is intended as an introduction to web3.js.</p>
</div>
<div class="paragraph data-line-8">
<p>The web3.js JavaScript library is a collection of modules that contain specific functionality for the Ethereum ecosystem, together with an Ethereum-compatible JavaScript API that implements the Generic JSON RPC spec.</p>
</div>
<div class="paragraph data-line-10">
<p>To run this script you don‚Äôt need to run your own local node, because it uses the <a href="https://infura.io" data-href="https://infura.io">Infura services</a>.</p>
</div>
</div>
<div class="sect2 data-line-12">
<h3 id="_web3_js_contract_basic_interaction_in_a_nonblocked_async_fashion">web3.js Contract Basic Interaction in a Nonblocked (Async) Fashion</h3>
<div class="paragraph data-line-14">
<p>Check you have a valid npm version:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm -v</strong>
5.6.0
</pre>
<div class="paragraph data-line-23">
<p>If you haven&#8217;t, initialize npm:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm init</strong>
</pre>
<div class="paragraph data-line-31">
<p>Install basic dependencies:</p>
</div>
<pre data-type="programlisting">
$ <strong>npm i command-line-args</strong>
$ <strong>npm i web3</strong>
$ <strong>npm i node-rest-client-promise</strong>
</pre>
<div class="paragraph data-line-41">
<p>This will update your <em>package.json</em> configuration file with your new dependencies.</p>
</div>
<div class="sect3 data-line-43">
<h4 id="_node_js_script_execution">Node.js Script Execution</h4>
<div class="paragraph data-line-45">
<p>Basic execution:</p>
</div>
<pre data-type="programlisting">
$ <strong>node code/web3js/web3-contract-basic-interaction.js</strong>
</pre>
<div class="paragraph data-line-53">
<p>Use your own Infura token (register at <a href="https://infura.io/" class="undefined" data-href="https://infura.io/">https://infura.io/</a> and store the api-key in a local file called <em>infura_token</em>):</p>
</div>
<pre data-type="programlisting">
$ <strong>node code/web3js/web3-contract-basic-interaction.js \
  --infuraFileToken /path/to/file/with/infura_token</strong>
</pre>
<div class="paragraph data-line-62">
<p>or:</p>
</div>
<pre data-type="programlisting">
$ <strong>node code/web3js/web3-contract-basic-interaction.js \
  /path/to/file/with/infura_token</strong>
</pre>
<div class="paragraph data-line-71">
<p>This will read the file with your own token and pass it in as a command-line argument to the actual command.</p>
</div>
</div>
</div>
<div class="sect2 data-line-73">
<h3 id="_reviewing_the_demo_script">Reviewing the Demo Script</h3>
<div class="paragraph data-line-75">
<p>Next, let&#8217;s review our demo script, <em>web3-contract-basic-interaction</em>.</p>
</div>
<div class="paragraph data-line-77">
<p>We use the Web3 object to obtain a basic web3 provider:</p>
</div>
<div class="listingblock data-line-80">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var web3 = new Web3(infura_host);</code></pre>
</div>
</div>
<div class="paragraph data-line-84">
<p>We can then interact with web3 and try some basic functions. Let&#8217;s see the protocol version:</p>
</div>
<div class="listingblock data-line-87">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getProtocolVersion().then(function(protocolVersion) {
      console.log(`Protocol Version: ${protocolVersion}`);
  })</code></pre>
</div>
</div>
<div class="paragraph data-line-93">
<p>Now let&#8217;s look at the current gas price:</p>
</div>
<div class="listingblock data-line-96">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getGasPrice().then(function(gasPrice) {
      console.log(`Gas Price: ${gasPrice}`);
  })</code></pre>
</div>
</div>
<div class="paragraph data-line-102">
<p>What&#8217;s the last mined block in the current chain?</p>
</div>
<div class="listingblock data-line-105">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getBlockNumber().then(function(blockNumber) {
      console.log(`Block Number: ${blockNumber}`);
  })</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-111">
<h3 id="_contract_interaction">Contract Interaction</h3>
<div class="paragraph data-line-113">
<p>Now let&#8217;s try some basic interactions with a contract. For these examples, we&#8217;ll use the <a href="https://bit.ly/2MPZZLx" data-href="https://bit.ly/2MPZZLx">WETH9_ contract</a> on the Kovan testnet.</p>
</div>
<div class="paragraph pagebreak-before data-line-116">
<p>First, let&#8217;s initialize our contract address:</p>
</div>
<div class="listingblock data-line-119">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var our_contract_address = "0xd0A1E359811322d97991E03f863a0C30C2cF029C";</code></pre>
</div>
</div>
<div class="paragraph data-line-123">
<p>We can then look at its balance:</p>
</div>
<div class="listingblock data-line-126">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getBalance(our_contract_address).then(function(balance) {
      console.log(`Balance of ${our_contract_address}: ${balance}`);
})</code></pre>
</div>
</div>
<div class="paragraph data-line-132">
<p>and see its bytecode:</p>
</div>
<div class="listingblock data-line-135">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">web3.eth.getCode(our_contract_address).then(function(code) {
      console.log(code);
})</code></pre>
</div>
</div>
<div class="paragraph data-line-141">
<p>Next, we&#8217;ll prepare our environment to interact with the Etherscan explorer API.</p>
</div>
<div class="paragraph data-line-143">
<p>Let&#8217;s initialize our contract URL in the Etherscan explorer API for the Kovan chain:</p>
</div>
<div class="listingblock data-line-146">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var etherscan_url =
  "https://kovan.etherscan.io/api?module=contract&amp;action=getabi&amp;
  address=${our_contract_address}"</code></pre>
</div>
</div>
<div class="paragraph data-line-152">
<p>And let&#8217;s initialize a REST client to interact with the Etherscan API:</p>
</div>
<div class="listingblock data-line-155">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">var client = require('node-rest-client-promise').Client();</code></pre>
</div>
</div>
<div class="paragraph data-line-159">
<p>and get a client promise:</p>
</div>
<div class="listingblock data-line-162">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">client.getPromise(etherscan_url)</code></pre>
</div>
</div>
<div class="paragraph data-line-166">
<p>Once we&#8217;ve got a valid client promise, we can get our contract ABI from the Etherscan API:</p>
</div>
<div class="listingblock data-line-169">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">.then((client_promise) =&gt; {
  our_contract_abi = JSON.parse(client_promise.data.result);</code></pre>
</div>
</div>
<div class="paragraph data-line-174">
<p>And now we can create our contract object as a promise to consume later:</p>
</div>
<div class="listingblock data-line-177">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">  return new Promise((resolve, reject) =&gt; {
      var our_contract = new web3.eth.Contract(our_contract_abi,
                                               our_contract_address);
      try {
        // If all goes well
        resolve(our_contract);
      } catch (ex) {
        // If something goes wrong
        reject(ex);
      }
    });
})</code></pre>
</div>
</div>
<div class="paragraph data-line-192">
<p>If our contract promise returns successfully, we can start interacting with it:</p>
</div>
<div class="listingblock data-line-195">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">.then((our_contract) =&gt; {</code></pre>
</div>
</div>
<div class="paragraph data-line-199">
<p>Let&#8217;s see our contract address:</p>
</div>
<div class="listingblock data-line-202">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">console.log(`Our Contract address:
            ${our_contract._address}`);</code></pre>
</div>
</div>
<div class="paragraph data-line-207">
<p>or alternatively:</p>
</div>
<div class="listingblock data-line-210">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">console.log(`Our Contract address in another way:
            ${our_contract.options.address}`);</code></pre>
</div>
</div>
<div class="paragraph data-line-215">
<p>Now let&#8217;s query our contract ABI:</p>
</div>
<div class="listingblock data-line-218">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">console.log("Our contract abi: " +
            JSON.stringify(our_contract.options.jsonInterface));</code></pre>
</div>
</div>
<div class="paragraph data-line-223">
<p>We can see our contract&#8217;s total supply using a callback:</p>
</div>
<div class="listingblock data-line-226">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">our_contract.methods.totalSupply().call(function(err, totalSupply) {
    if (!err) {
        console.log(`Total Supply with a callback:  ${totalSupply}`);
    } else {
        console.log(err);
    }
});</code></pre>
</div>
</div>
<div class="paragraph data-line-236">
<p>Or we can use the returned promise instead of passing in the callback:</p>
</div>
<div class="listingblock data-line-239">
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">our_contract.methods.totalSupply().call().then(function(totalSupply){
    console.log(`Total Supply with a promise:  ${totalSupply}`);
}).catch(function(err) {
    console.log(err);
});</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-247">
<h3 id="_asynchronous_operation_with_await">Asynchronous Operation with Await</h3>
<div class="paragraph data-line-41">
<p>Now that you&#8217;ve seen the basic tutorial, you can try the same interactions using an asynchronous await construct. Review the <em>web3-contract-basic-interaction-async-await.js</em> script in <a href="http://bit.ly/2ABrFkl" data-href="http://bit.ly/2ABrFkl"><em>code/web3js</em></a> and compare it to this tutorial to see how they differ. Async-await is easier to read, as it makes the asynchronous interaction behave more like a sequence of blocking calls.</p>
</div>
<div class="paragraph data-line-43">
<p>&lt;section data-type="index"/&gt;</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-05-10 17:52:45 -0400
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>